{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12465329","self":"https://issues.apache.org/jira/rest/api/latest/issue/12465329","key":"DERBY-4677","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313401","id":"12313401","description":"Head of 10.4 branch","name":"10.4.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314182","id":"12314182","description":"Old head of 10.5 branch","name":"10.5.3.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315343","id":"12315343","description":"Derby 10.6.2.1 Release","name":"10.6.2.1","archived":false,"released":true,"releaseDate":"2010-10-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-05-28 19:35:47.777","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24405","customfield_12310222":"1_*:*_1_*:*_2567992351_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-06-23T20:26:04.121+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4677/watchers","watchCount":2,"isWatching":false},"created":"2010-05-25T03:06:11.770+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313401","id":"12313401","description":"Head of 10.4 branch","name":"10.4.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314116","id":"12314116","description":"10.5.2 Release July 30 2009 (794445) Now deprecated","name":"10.5.2.0","archived":false,"released":true,"releaseDate":"2009-07-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314117","id":"12314117","description":"Next release after 10.5.2.0 release candidate #1","name":"10.5.3.0","archived":false,"released":true,"releaseDate":"2009-08-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:19:34.883+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"It appears that running SYSCS_UTIL.SYSCS_COMPRESS_TABLE on a table with a null-able unique constraint will disable the unique constraint. The script\r\nbelow should reproduce the problem. The expected behaviour is for the second insert to fail due to the unique constraint but instead it is allowed. The second insert will fail as expected if either the call to SYSCS_COMPRESS_TABLE is skipped or if the column is declared NOT NULL.\r\n\r\nI have reproduced the problem using embedded Derby 10.5.1.1, 10.5.3.0 and 10.6.1.0 using ij.\r\n\r\nCREATE TABLE TABLE1(NAME1 INT UNIQUE);\r\n\r\nCALL SYSCS_UTIL.SYSCS_COMPRESS_TABLE('APP', 'TABLE1', 1);\r\n\r\nINSERT INTO TABLE1(NAME1) VALUES(1);\r\n\r\nINSERT INTO TABLE1(NAME1) VALUES(1);\r\n\r\nSELECT * FROM TABLE1;\r\n\r\nDROP TABLE TABLE1;\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10364","value":"Data corruption","id":"10364"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10367","value":"Deviation from standard","id":"10367"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10421","value":"Seen in production","id":"10421"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37863","summary":"SYSCS_COMPRESS_TABLE disables unique constraints","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=b.mason%40adinstruments.com","name":"b.mason@adinstruments.com","emailAddress":"b dot mason at adinstruments dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Mason","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=b.mason%40adinstruments.com","name":"b.mason@adinstruments.com","emailAddress":"b dot mason at adinstruments dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Mason","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Output of sysinfo:\r\n------------------ Java Information ------------------\r\nJava Version:    1.6.0_20\r\nJava Vendor:     Sun Microsystems Inc.\r\nJava home:       C:\\Program Files (x86)\\Java\\jre6\r\nJava classpath:  .;C:\\Program Files (x86)\\Java\\jre6\\lib\\ext\\QTJava.zip;C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\\../lib/derby.jar;C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\\../lib/derbynet.jar;C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\\../lib/derbyclient.jar;C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\\../lib/derbytools.jar\r\nOS name:         Windows 7\r\nOS architecture: x86\r\nOS version:      6.1\r\nJava user name:  bmason\r\nJava user home:  C:\\Users\\BMASON\r\nJava user dir:   C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\r\njava.specification.name: Java Platform API Specification\r\njava.specification.version: 1.6\r\njava.runtime.version: 1.6.0_20-b02\r\n--------- Derby Information --------\r\nJRE - JDBC: Java SE 6 - JDBC 4.0\r\n[C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\lib\\derby.jar] 10.6.1.0 - (938214)\r\n[C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\lib\\derbytools.jar] 10.6.1.0 - (938214)\r\n[C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\lib\\derbynet.jar] 10.6.1.0 - (938214)\r\n[C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\lib\\derbyclient.jar] 10.6.1.0 - (938214)\r\n------------------------------------------------------\r\n----------------- Locale Information -----------------\r\nCurrent Locale :  [English/New Zealand [en_NZ]]\r\nFound support for locale: [cs]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [de_DE]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [es]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [fr]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [hu]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [it]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [ja_JP]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [ko_KR]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [pl]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [pt_BR]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [ru]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [zh_CN]\r\n\t version: 10.6.1.0 - (938214)\r\nFound support for locale: [zh_TW]\r\n\t version: 10.6.1.0 - (938214)\r\n------------------------------------------------------\r\n","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":20,"total":20,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12873123","id":"12873123","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I see that this fails even with 10.4.2.1 Prior to 10.4, it was to define a unique constraint, one also was required to define it not null column.  So, the above test case does not work prior to 10.4 unless the create table is defined as CREATE TABLE TABLE1(NAME1 INT UNIQUE NOT NULL); \r\n\r\nBut starting with 10.4, the above test case indeed fails. It has something to do with allow a column to be unique without requiring it to be non-null. Haven't looked at the cause of failure in the code yet.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-05-28T19:35:47.777+0000","updated":"2010-05-28T19:35:47.777+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12875166","id":"12875166","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Just to be little more clear, if the index is non-nullable, then compress does not break it. I tested this on 10.1 and onwards upto trunk, So the behavior for non-nullable indexes hasn't changed. \r\n\r\nNullable indexes on the other hand do not work after compress. Nullable indexes must have been introduced in 10.4 because such an index can't be created prior to 10.4. But doing a compress on table with nullable index appear to break those indexes. I will look into the code to see what is going on.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-03T15:56:38.396+0000","updated":"2010-06-03T15:56:38.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12875310","id":"12875310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"For compress table, code in AlterTableConstantAction kicks in to drop and recreate the indexes. When recreating the indexes, we forgot to take into account the property \"uniqueWithDuplicateNulls\" when asking store to recreate the index. For a new nullable index, CreateIndexConstantAction has following code for dbs at 10.4 and higher levels\r\n\tindexProperties.put( \"uniqueWithDuplicateNulls\", Boolean.toString(true));\r\nBut in AlterTableConstantAction, we did not check if the index is of type nullable unique and never set the property\r\n\"uniqueWithDuplicateNulls\".\r\n\r\nFollowing simple code change in AlterTableConstantActionhas fixed the problem, but the bigger issue is there might be databases lying around with duplicate values when the user thought that unique indexes were defined on their tables.\r\n\tif(cd.getIndexDescriptor().isUniqueWithDuplicateNulls())\r\n\t{\r\n\t\tproperties.put( \"uniqueWithDuplicateNulls\", Boolean.toString(true));\r\n\t}\r\n\r\nThe other troubling issue is are there other places in the code where we have forgotten about this property while recreating the indexes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-03T21:45:05.080+0000","updated":"2010-06-03T21:45:05.080+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12875320","id":"12875320","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"What happened was that store basically was instructed to build a non-unique index, and it did so.  I agree with the proposed fix, and will review when a patch is submitted.\r\n\r\nNote that this fix only will correct the issue for future compress calls.  Whatever has happened in the past will remain broken, until the user takes\r\nsome action.  It will be hard to determine if the broken index exists.  One\r\ncan run a query to see if a candidate index exists (basically is there a unique\r\nindex that contains nullable columns), but I can't think of a generic way to \r\ntell if compress has been run and broken the index.\r\n\r\nI believe if the user has not inserted any duplicates, than another call to offline compress using a version with the bug will fix the problem.\r\n\r\nIf the user has inserted duplicate data into the index after compress broke\r\nthe index, then automatic cleanup is not going to work.  Once a fix has\r\nbeen proposed we should verify the error that arises in this case.  And also verify that in this case the compress gets at least a statement level error backing out whatever the intermediate work that was done before failing.  Maybe \r\nwe can even catch the exception at appropriate places in the code and\r\nraise a new error giving instructions on what needs to be done.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2010-06-03T22:03:48.772+0000","updated":"2010-06-03T22:03:48.772+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12875323","id":"12875323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I did a quick search in the execute directory and there looks like there are two other cases in InsertResultSet, involving the bulk insert and bulk replace optimizations.  It would be good if test cases for these paths were also generated.  I think this means that we could also have broke the indexes on a insert as select into an empty table.  \r\n\r\nI looked at all the other places in the code that set \"nUniqueColumns\" and did not see any other problems.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2010-06-03T22:11:32.548+0000","updated":"2010-06-03T22:11:32.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12875485","id":"12875485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I wanted to try out the case where because of the bug in Derby, you are able to insert duplicate rows after compress table even though the table has unique nullable index defined on it. Next, I fixed the Derby code to properly copy the unique nullable property during index recreation time of the compress table process. I ran the buggy database with the new Derby code on my machine. First I inserted more duplicate rows(because store still thinks the index is not unique from the compress earlier with the buggy Derby version), and then did compress on the table. After this compress, I can't insert any more duplicate row. Interestingly enough though, no errors were raised during compress because of the duplicate rows. I will look into the code why we do not run into problems during index recreation when there are duplicate rows in the table.\r\n\r\n Following are the exact steps followed for this testing\r\n\r\nBuild Derby code based on the trunk codeline. This Derby version has the bug which allows duplicate rows after compress table. Use this buggy Derby version to run following ij scripts which shows that duplicate rows are allowed\r\n$ java -Dij.exceptionTrace=true org.apache.derby.tools.ij\r\nij version 10.7\r\nij> connect 'jdbc:derby:testDB4677;create=true';\r\nij> CREATE TABLE TABLE1(NAME1 INT UNIQUE);\r\n0 rows inserted/updated/deleted\r\nij> CALL SYSCS_UTIL.SYSCS_COMPRESS_TABLE('APP', 'TABLE1', 1);\r\n0 rows inserted/updated/deleted\r\nij> INSERT INTO TABLE1(NAME1) VALUES(1);\r\n1 row inserted/updated/deleted\r\nij> INSERT INTO TABLE1(NAME1) VALUES(1);\r\n1 row inserted/updated/deleted\r\nij> SELECT * FROM TABLE1;\r\nNAME1\r\n-----------\r\n1\r\n1\r\n\r\n2 rows selected\r\nij> exit;\r\n\r\nNotice the duplicate rows in TABLE1 in the above ij session.\r\n\r\nNext, in my trunk codeline, fix AlterTableConstantAction to use the unique nullable property during index recreation if the index was defined unique nullable. This is done when the table is compressed. \r\n\r\nWhen I run the above db with this fixed code, it first allows duplicate row creations because I have not yet run compress table. \r\n$ java -Dij.exceptionTrace=true org.apache.derby.tools.ij\r\nij version 10.7\r\nij> connect 'jdbc:derby:testDB4677;create=true';\r\nWARNING 01J01: Database 'testDB4677' not created, connection made to existing da\r\ntabase instead.\r\nij> INSERT INTO TABLE1(NAME1) VALUES(1);\r\n1 row inserted/updated/deleted\r\nij> SELECT * FROM TABLE1;\r\nNAME1\r\n-----------\r\n1\r\n1\r\n1\r\n\r\n3 rows selected\r\n\r\nBut once I do compress table, now we start disallowing creation of further duplicate rows. \r\nij> CALL SYSCS_UTIL.SYSCS_COMPRESS_TABLE('APP', 'TABLE1', 1);\r\n0 rows inserted/updated/deleted\r\nij> SELECT * FROM TABLE1;\r\nNAME1\r\n-----------\r\n1\r\n1\r\n1\r\n\r\n3 rows selected\r\nij> INSERT INTO TABLE1(NAME1) VALUES(1);\r\nERROR 23505: The statement was aborted because it would have caused a duplicate key value in a unique or primary key constraint or unique index identified by 'SQL100603220123640' defined on 'TABLE1'.\r\n\r\nBut I had thought that with my changes, the compress table operation would fail because of the duplicate rows but it does not fail. I will look further into this.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-04T05:10:16.906+0000","updated":"2010-06-04T05:10:16.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12875522","id":"12875522","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I thought it would fail also, maybe compress is optimized to not do the duplicate checking on index rebuild since it \"knows\" that there were no duplicates before.  I would concentrate on fixing the bugs first.   This behavior is probably not worth changing and we should come up with some other way to catch the bad duplicates that were inserted. One option would be a real drop and recreate of the index should find the problem.\r\n\r\nTo track this down you could compare the code that is in create index to the code that is in alter table.  I think there is some call back that is used to check duplicates.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2010-06-04T08:03:56.215+0000","updated":"2010-06-04T08:03:56.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12876369","id":"12876369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I researched the code Create Index code and Alter Table code and found that for Create Index, we generate different SortObserver(s) depending on the type of the index. If it is a unique non-nullable index, then Create index creates UniqueIndexSortObserver. For a unique nullable index, it creates UniqueWithDuplicateNullsIndexSortObserver. For non-unique indexes, BasicSortObserver gets created. Alter Table on the other hand creates BasicSortObserver for all kinds of indexes and that is why the duplicates don't get caught for unique indexes. As Mike suggested, this may have been a conscious decision since the assumption was made that there were no duplicates before. \r\n\r\nFor now, I will leave this assumption as it is. I will go and focus back on two InsertResultSet cases where we don't seem to be using uniqueWithDuplicateNulls. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-07T19:10:19.980+0000","updated":"2010-06-07T19:10:19.980+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12877622","id":"12877622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Attachine patch, DERBY4677_diff_patch1.txt, which involves transferring unique nullable properties from sql layer to store layer. System catalogs have the information correct, but unique nullability information was not getting transferred to store during btree recreation in case of compress table and bulk insert operations. Please share any comments you may have. Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-10T23:16:07.920+0000","updated":"2010-06-10T23:16:07.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12877631","id":"12877631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Forgot to mention that I got one failure when I ran junit All suite. When I ran the replication suite by itself, I didn't see the failure again. Not sure if the following failure is a known intermittent failure. derbyall ran fine with no errors\r\n1) testReplication_Local_1_Indexing(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_1Indexing)junit.framework.ComparisonFailure: Unexpected SQL state. expected:<...0> but was:<...1>\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:762)\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:811)\r\n\tat org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.failOver_direct(ReplicationRun.java:1385)\r\n\tat org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.failOver(ReplicationRun.java:1314)\r\n\tat org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_1Indexing.testReplication_Local_1_Indexing(ReplicationRun_Local_1Indexing.java:97)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)\r\n\tat org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.runBare(ReplicationRun.java:207)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:16)\r\nCaused by: java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE21, SQLERRMC: Error occurred while performing failover for database 'C:\\p4clients\\svnmain\\client4\\trunk\\systest\\out142\\db_master\\wombat', Failover attempt was aborted.::SQLSTATE: XRE04Connection lost for replicated database 'null'.\r\n\tat org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:96)\r\n\tat org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:358)\r\n\tat org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:149)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:317)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:273)\r\n\tat org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun.failOver_direct(ReplicationRun.java:1372)\r\n\t... 31 more\r\nCaused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE21, SQLERRMC: Error occurred while performing failover for database 'C:\\p4clients\\svnmain\\client4\\trunk\\systest\\out142\\db_master\\wombat', Failover attempt was aborted.::SQLSTATE: XRE04Connection lost for replicated database 'null'.\r\n\tat org.apache.derby.client.am.Connection.completeSqlca(Connection.java:2118)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(NetConnectionReply.java:541)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:434)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:297)\r\n\tat org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:121)\r\n\tat org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:834)\r\n\tat org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:758)\r\n\tat org.apache.derby.client.net.NetConnection.flowUSRIDONLconnect(NetConnection.java:591)\r\n\tat org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:398)\r\n\tat org.apache.derby.client.net.NetConnection.<init>(NetConnection.java:218)\r\n\tat org.apache.derby.client.net.NetConnection40.<init>(NetConnection40.java:77)\r\n\tat org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:269)\r\n\tat org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:83)\r\n\t... 34 more\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-10T23:35:08.017+0000","updated":"2010-06-10T23:35:08.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12877966","id":"12877966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I have reviewed the  \tDERBY4677_diff_patch1.txt patch, and the fix and the tests look good to me.  +1 on committing it to trunk and after it passes tests across platforms backporting as appropriate.\r\n\r\nThere should be a good release note describing the corruption and that the fix does not actually fix the existing problems, just stops it from happening in the future.  Seems like a drop and recreate of unique indexes on nullable columns is only guaranteed way to fix existing issues.  And the recreate index will fail if the bug has allowed unique violations.  There may be a query one can write to identify unique violations, but it may be tricky as DERBY may optimize based on \"knowing\" there can't be unique violations.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2010-06-11T21:11:21.952+0000","updated":"2010-06-11T21:11:21.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12878704","id":"12878704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Attaching the release note. Please let me know if there are any comments to it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-14T19:10:16.857+0000","updated":"2010-06-14T19:10:16.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12879681","id":"12879681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Committed changes into trunk(revision 954544) and 10.5(revision  955487) so far. Working on backporting to other affected codelines.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-17T06:08:40.505+0000","updated":"2010-06-17T06:08:40.505+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12880006","id":"12880006","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Backported change into 10.6 codeline with revision 955790.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-17T23:44:50.104+0000","updated":"2010-06-17T23:44:50.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12880887","id":"12880887","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Attaching an updated release note. Please review to see if you have any comments.\r\n\r\nAlso, a little bit more information on the stored procedures that would cause this bug to allow duplicates.\r\n  A unique nullable index can be defined in one of the following 2 ways\r\n\tCREATE TABLE TABLE1(NAME1 INT UNIQUE); \r\n\t\tOR\r\n\tCREATE TABLE TABLE1(NAME1 INT constraint uniq_null UNIQUE); \r\n\r\nA table compress can be done using procedure. SYSCS_UTIL.SYSCS_COMPRESS_TABLE. eg\r\n\tCALL SYSCS_UTIL.SYSCS_COMPRESS_TABLE('APP', 'TABLE1', 1)\r\n\r\n A bulk insert into a table can be done using procedure SYSCS_UTIL.SYSCS_IMPORT_TABLE. The bulk insert can either REPLACE the existing contents of the table or it can add to the existing contents of the table. The intention of which bulk insert is intended is indicated by the last parameter to the procedure call. \r\n\teg of bulk insert with REPLACE option\r\n\tcall SYSCS_UTIL.SYSCS_IMPORT_TABLE('APP', 'TABLE1' , 'data.txt' , null, null, 'utf-8', 1)\r\n\teg of bulk insert with INSERT option\r\n\tcall SYSCS_UTIL.SYSCS_IMPORT_TABLE('APP', 'TABLE1' , 'data.txt' , null, null, 'utf-8', 0)\r\nBulk insert caused problems with unique nullable indexes only for the following 2 scenarios\r\n1)When bulk insert with REPLACE is being done with 0 rows from the data file. It does not matter if the table was empty before bulk insert with REPLACE.\r\n2)When bulk insert with INSERT is being done on an empty table with multiple rows from the data file.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-21T16:38:06.788+0000","updated":"2010-06-21T16:38:06.788+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12881165","id":"12881165","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Mamta,\r\n\r\nThe release note looks good to me. Thanks for writing it. Two small comments:\r\n\r\n- I think the summary is supposed to be a one-liner. I suggest that it is changed to \"Unique nullable constraint may be disabled after compress or import operations\" and that the details are moved to the sections below.\r\n\r\n- typo: \"may find that duplicates rows exist\" - duplicates -> duplicate","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-06-22T11:03:40.098+0000","updated":"2010-06-22T11:03:40.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12881853","id":"12881853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Attaching another update to release note based on the feedback from Knut.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2010-06-23T20:17:43.763+0000","updated":"2010-06-23T20:17:43.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12882856","id":"12882856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks, Mamta!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-06-26T17:01:16.672+0000","updated":"2010-06-26T17:01:16.672+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/12907397","id":"12907397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Change the reference 10.4.2.1 from 10.4.x.x per Rick's suggestion for release note 10.6.2.0 (refer DERBY-4878).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2010-09-08T20:11:35.877+0000","updated":"2010-09-08T20:11:35.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465329/comment/13685287","id":"13685287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:34.861+0000","updated":"2013-06-17T09:19:34.861+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4677/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06ufb:"}}