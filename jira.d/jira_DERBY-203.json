{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"31564","self":"https://issues.apache.org/jira/rest/api/latest/issue/31564","key":"DERBY-203","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-04-18 15:58:22.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21834","customfield_12310222":"1_*:*_1_*:*_3959992000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_74000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2005-05-25T16:53:04.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-203/watchers","watchCount":2,"isWatching":false},"created":"2005-04-09T20:53:12.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10991","id":"10991","description":"snapshot","name":"10.0.2.1","archived":false,"released":true,"releaseDate":"2004-12-06"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-07-08T10:01:22.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"}],"timeoriginalestimate":null,"description":"Trying to execute batch on which setNull(x,DATE) was called gives the following exception:\nSQL Exception: An attempt was made to get a data value of type 'DATE' from a data value of type 'null'.\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java)\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java)\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java)\n        at org.apache.derby.impl.jdbc.EmbedConnection.newSQLException(EmbedConnection.java)\n        at org.apache.derby.impl.jdbc.ConnectionChild.newSQLException(ConnectionChild.java)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.dataTypeConversion(EmbedPreparedStatement.java)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.setObject(EmbedPreparedStatement.java)\n        at org.apache.derby.iapi.types.DataType.setInto(DataType.java)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeBatchElement(EmbedPreparedStatement.java)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeBatch(EmbedStatement.java)\n        at net.sf.hibernate.impl.BatchingBatcher.doExecuteBatch(BatchingBatcher.java:54)\n\nDATE column is nullable in db schema, so it should pass there ok. I believe the problem is in org.apache.derby.iapi.types.SQLDate, which does not implement setInto method, so DataType.setInto method is executed, calling setObject(x,null). setObject thinks this is JDBC spec violation and fails on exception.\n\nProblem exists in both 10.0.2.1 and 10.0.2.0","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40597","summary":"setNull(x,JDBCType.DATE) does not work when batching is turned on","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m0nstermind","name":"m0nstermind","emailAddress":"oleganas at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=m0nstermind&avatarId=18633","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=m0nstermind&avatarId=18633","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=m0nstermind&avatarId=18633","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=m0nstermind&avatarId=18633"},"displayName":"Oleg Anastasyev","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=m0nstermind","name":"m0nstermind","emailAddress":"oleganas at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=m0nstermind&avatarId=18633","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=m0nstermind&avatarId=18633","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=m0nstermind&avatarId=18633","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=m0nstermind&avatarId=18633"},"displayName":"Oleg Anastasyev","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"------------------ Java Information ------------------\nJava Version:    1.4.2_07\nJava Vendor:     Sun Microsystems Inc.\nJava home:       /usr/local/java/j2sdk1.4.2_07/jre\nJava classpath:  /home/oleg/prg/cs/lib/derby.jar:/home/oleg/prg/cs/lib/derbytools.jar:\nOS name:         Linux\nOS architecture: i386\nOS version:      2.6.8.1-24mdk\nJava user name:  oleg\nJava user home:  /home/oleg\nJava user dir:   /usr/local/home/oleg/prg/cs/frameworks/embedded/bin\n--------- Derby Information --------\n[/usr/local/home/oleg/prg/cs/lib/derby.jar] 10.0.2.0 - (30301)\n[/usr/local/home/oleg/prg/cs/lib/derbytools.jar] 10.0.2.0 - (30301)\n------------------------------------------------------\n----------------- Locale Information -----------------\n------------------------------------------------------\n","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":9,"total":9,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/63028","id":"63028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"body":"I had fixed smilar problem with Blob and Timestamp. I will look into this and other types with which this problem can arise.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"created":"2005-04-18T15:58:22.000+0000","updated":"2005-04-18T15:58:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/64245","id":"64245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"body":"Test changes for parameterMapping.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"created":"2005-05-02T19:35:18.000+0000","updated":"2005-05-02T19:35:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/64246","id":"64246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"body":"The output file after running test parameterMapping.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"created":"2005-05-02T19:36:16.000+0000","updated":"2005-05-02T19:36:16.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/64247","id":"64247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"body":"  I have attached the changes I did to parameterMapping.java and the output I got. It is slightly tricky to figure out the failures when they occur for certain datatypes with the setNull method with batching turned on.\r\n\r\n  Firstly, I want to confirm the addition I did to the test is fine. If the additions are fine then I can start to figuring out which tests failed ( with batching turned on ) but are supposed to pass. The only way I found was comparing the output, the addition to the test case produces with the output got when batching is not performed, i.e comparing the output of executeUpdate() with executeBatch().\r\n \r\n  A peek into the output file I have attached will give a clearer picture of what I am trying to say. Correct me if I am wrong or suggest a better way to detect failures than what I am doing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"created":"2005-05-02T19:47:43.000+0000","updated":"2005-05-02T19:47:43.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/65174","id":"65174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Changes to the test look good, and your method for finding which are right/wrong is correct.\r\nI would advise that a good thing to do once you have fixed this issue is to then perform a similar test modification for setting a valid value and using batching.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2005-05-13T04:25:23.000+0000","updated":"2005-05-13T04:25:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/65598","id":"65598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"body":"     I have attached the latest test diff and test output file.\r\n\r\n      I feel with this issue we should fix the setNull aspect related to batching. For testing the batching with a valid value I can raise a new JIRA issue for that and then build on  parameterMapping.java to test batching with valid values.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"created":"2005-05-17T19:56:54.000+0000","updated":"2005-05-17T19:56:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/65856","id":"65856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Patch committed - svn revision 171115\r\n\r\nUse explicit setXXX methods for binary, DATE and TIME types when setting\r\na DataValueDescriptor into a PreparedStatement. Replaced the use of setObject\r\nfor these types which lead to un-typed NULLs being set into a PreparedStatement.\r\n\r\nPatch contributed by Shreyas Kaushik <Shreyas.Kaushik@Sun.COM>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2005-05-20T22:31:02.000+0000","updated":"2005-05-20T22:31:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/66244","id":"66244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"body":"Fixed, as the earlier comment says","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"created":"2005-05-25T16:52:59.000+0000","updated":"2005-05-25T16:52:59.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31564/comment/66245","id":"66245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"body":"Patch submitted","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shreyas","name":"shreyas","emailAddress":"Shreyas at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shreyas Kaushik","active":true},"created":"2005-05-25T16:54:18.000+0000","updated":"2005-05-25T16:54:18.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-203/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07bav:"}}