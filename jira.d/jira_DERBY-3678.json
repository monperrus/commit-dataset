{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12396285","self":"https://issues.apache.org/jira/rest/api/latest/issue/12396285","key":"DERBY-3678","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-05-19 08:20:43.765","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23781","customfield_12310222":"1_*:*_1_*:*_2086456588_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-06-11T23:43:56.398+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3678/watchers","watchCount":0,"isWatching":false},"created":"2008-05-18T20:09:39.810+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12320382","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12320382","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"27923","key":"DERBY-48","self":"https://issues.apache.org/jira/rest/api/2/issue/27923","fields":{"summary":" A connection request that has a default schema that is being created by another transaction will fail to connect","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12324848","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12324848","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12425714","key":"DERBY-4233","self":"https://issues.apache.org/jira/rest/api/2/issue/12425714","fields":{"summary":"Lower tablescan performance right after database creation in 10.5","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-05-10T23:57:11.382+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"I am getting a deadlock in SYSTABLE. When I turn on Dderby.locks.deadlockTrace=true, I get a StackOverflowException\n\nDerby version The Apache Software Foundation - Apache Derby - 10.3.2.2\n- (618335): instance 80220011-0119-f93f-b912-00000000bced\non database directory /db/domains/geoff  \n\nDatabase Class Loader started - derby.database.classpath=''\n2008-05-17 23:44:36.380\nGMT Thread[btpool0-2,5,main] (XID = 7556), (SESSIONID = 4), (DATABASE =\ndomains/geoff), (DRDAID = null), Cleanup action starting\njava.lang.StackOverflowError\n        at org.apache.derby.impl.sql.execute.GenericExecutionFactory.getValueRow(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.SYSCONGLOMERATESRowFactory.makeRow(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.SYSCONGLOMERATESRowFactory.makeEmptyRow(Unknown\nSource)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.hashAllConglomerateDescriptorsByNumber(Unknown\nSource)\n        at org.apache.derby.impl.services.locks.TableNameInfo.<init>(Unknown Source)\n        at org.apache.derby.impl.services.locks.Timeout.buildLockTableString(Unknown Source)\n        at org.apache.derby.impl.services.locks.Timeout.createException(Unknown Source)\n        at org.apache.derby.impl.services.locks.Timeout.buildException(Unknown Source)\n        at org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(Unknown Source)\n        at org.apache.derby.impl.services.locks.AbstractPool.lockObject(Unknown Source)\n        at org.apache.derby.impl.services.locks.ConcurrentPool.lockObject(Unknown Source)\n        at org.apache.derby.impl.store.raw.xact.RowLocking3.lockRecordForRead(Unknown Source)\n        at org.apache.derby.impl.store.access.heap.HeapController.lockRow(Unknown Source)\n        at org.apache.derby.impl.store.access.heap.HeapController.lockRow(Unknown Source)\n        at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.lockRowOnPage(Unknown\nSource)\n        at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3._lockScanRow(Unknown\nSource)\n        at org.apache.derby.impl.store.access.btree.index.B2IRowLockingRR.lockScanRow(Unknown\nSource)\n        at org.apache.derby.impl.store.access.btree.BTreeForwardScan.fetchRows(Unknown Source)\n        at org.apache.derby.impl.store.access.btree.BTreeScan.next(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(Unknown\nSource)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(Unknown\nSource)\n        at org.apache.derby.impl.sql.catalog.SYSTABLESRowFactory.buildDescriptor(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.hashAllTableDescriptorsByTableId(Unknown\nSource)\n        at org.apache.derby.impl.services.locks.TableNameInfo.<init>(Unknown Source)\n        at org.apache.derby.impl.services.locks.Timeout.buildLockTableString(Unknown Source)\n        at org.apache.derby.impl.services.locks.Timeout.createException(Unknown Source)\n        at org.apache.derby.impl.services.locks.Timeout.buildException(Unknown Source)\n        at org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(Unknown Source)\n        at org.apache.derby.impl.services.locks.AbstractPool.lockObject(Unknown Source)\n        at org.apache.derby.impl.services.locks.ConcurrentPool.lockObject(Unknown Source)\n        at org.apache.derby.impl.store.raw.xact.RowLocking3.lockRecordForRead(Unknown Source)\n        at org.apache.derby.impl.store.access.heap.HeapController.lockRow(Unknown Source)\n        at org.apache.derby.impl.store.access.heap.HeapController.lockRow(Unknown Source)\n        at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.lockRowOnPage(Unknown\nSource)\n        at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3._lockScanRow(Unknown\nSource)\n        at org.apache.derby.impl.store.access.btree.index.B2IRowLockingRR.lockScanRow(Unknown\nSource)\n        at org.apache.derby.impl.store.access.btree.BTreeForwardScan.fetchRows(Unknown Source)\n        at org.apache.derby.impl.store.access.btree.BTreeScan.next(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(Unknown\nSource)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(Unknown\nSource)\n        at org.apache.derby.impl.sql.catalog.SYSTABLESRowFactory.buildDescriptor(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.hashAllTableDescriptorsByTableId(Unknown\nSource)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38088","summary":"StackOverflowException in deadlock trace","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"(this is actually in version 10.3.2.2)\nMacOS 10, JDK 1.6","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":19,"total":19,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12597893","id":"12597893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Bryan Pendleton said this about the problem on derby-user (http://mail-archives.apache.org/mod_mbox/db-derby-user/200805.mbox/%3c48304502.8050602@amberpoint.com%3e):\r\n\r\n> 2) When the deadlock happens, the lock table tracing logic that is run\r\n> by derby.locks.deadlockTrace is itself encountering the same lock\r\n> problem, only that code has a bug and as you say you get stuck in an\r\n> infinite recursion:\r\n>  - got a deadlock, which causes\r\n>    - deadlockTrace code to run, which\r\n>      - get a deadlock, which causes\r\n>        - deadlockTrace code to run, which\r\n>          - get a deadlock, which causes ...\r\n> and so forth.\r\n\r\nI think that's a correct observation (except it's not clear to me if it's a lock timeout or a deadlock). From the stack trace, it seems like we fail to get the scan protection lock on an index page for the SYS.SYSSCHEMAS table. That probably means that one thread is holding an exclusive lock on the scan protection row. Not sure how that could happen. Could be an index split deadlock (DERBY-2991), but that doesn't sound very likely since this is the SYSSCHEMAS table. Or do you have multiple threads creating lots of schemas?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-05-19T08:20:43.765+0000","updated":"2008-05-19T08:20:43.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12597964","id":"12597964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"body":"\"Or do you have multiple threads creating lots of schemas?\"   \r\nI'm not creating any schemas at the time this problem happens.\r\n\r\nI will try to describe what I am doing, as background. There are two databases, naturally each has a different connection URL. Let's call them Database A and Database B. I read in a configuration file that describes a set of tables in Database A, and then I create those tables, and store some information about them in Database B.\r\n\r\n1) define tables in Database A\r\n2) store some information about tables in Database A in a table in Database B\r\n3) alter tables in Database A to add a named foreign key constraint to some of the tabes\r\n4) store some more information about tables in A into a table in Database B\r\n\r\nThe problem only occurs on step 4, and it only occurs when there are 9 insertions into Database B as part of step (4). If I remove a single item from my configuration file, so that step (4) only processes 8 items, there is no problem.\r\n\r\nHere is the trace from derby.language.logQueryPlan. I excerpted only the portions related to \"SYS....\". There are two groups of relevant trace, and I separated them with \"=================\" in the cut-and-paste that follows. The lock timeout (or StackOverflowException if I turn on derby.locks.deadlockTrace) occurs after the second set of information in the logQueryPlan.\r\n\r\n2008-05-18 19:24:52.764 GMT Thread[btpool0-4,5,main] (XID = 8142), (SESSIONID = 2), EXECUTE STATEMENT SYS.\"getTables\" ******* Sort ResultSet:\r\nNumber of opens = 1\r\nRows input = 13\r\nRows returned = 13\r\nEliminate duplicates = false\r\nIn sorted order = false\r\nSort information:\r\n        Number of rows input=13\r\n        Number of rows output=13\r\n        Sort type=internal\r\n        constructor time (milliseconds) = 0\r\n        open time (milliseconds) = 0\r\n        next time (milliseconds) = 0\r\n        close time (milliseconds) = 0\r\n        optimizer estimated row count:            0.24\r\n        optimizer estimated cost:            5.71\r\n\r\nSource result set:\r\n        Project-Restrict ResultSet (20):\r\n        Number of opens = 1\r\n        Rows seen = 13\r\n        Rows filtered = 0\r\n        restriction = false\r\n        projection = true\r\n                constructor time (milliseconds) = 0\r\n                open time (milliseconds) = 0\r\n                next time (milliseconds) = 0\r\n                close time (milliseconds) = 0\r\n                restriction time (milliseconds) = 0\r\n                projection time (milliseconds) = 0\r\n                optimizer estimated row count:            0.24\r\n                optimizer estimated cost:            5.71\r\n\r\n        Source result set:\r\n                Nested Loop Join ResultSet:\r\n                Number of opens = 1\r\n                Rows seen from the left = 13\r\n                Rows seen from the right = 13\r\n                Rows filtered = 0\r\n                Rows returned = 13\r\n                        constructor time (milliseconds) = 0\r\n                        open time (milliseconds) = 0\r\n                        next time (milliseconds) = 0\r\n                        close time (milliseconds) = 0\r\n                        optimizer estimated row count:            0.24\r\n                        optimizer estimated cost:            5.71\r\n\r\n                Left result set:\r\n                        Nested Loop Exists Join ResultSet:\r\n                        Number of opens = 1\r\n                        Rows seen from the left = 13\r\n                        Rows seen from the right = 13\r\n                        Rows filtered = 0\r\n                        Rows returned = 13\r\n                                constructor time (milliseconds) = 0\r\n                                open time (milliseconds) = 0\r\n                                next time (milliseconds) = 0\r\n                                close time (milliseconds) = 0\r\n                                optimizer estimated row count:            0.06\r\n                                optimizer estimated cost:            5.71\r\n\r\n                        Left result set:\r\n                                Project-Restrict ResultSet (5):\r\n                                Number of opens = 1\r\n                                Rows seen = 32\r\n                                Rows filtered = 19\r\n                                restriction = true\r\n                                projection = true\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        restriction time (milliseconds) = 0\r\n                                        projection time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.06\r\n                                        optimizer estimated cost:            5.43\r\n\r\n                                Source result set:\r\n                                        Index Row to Base Row ResultSet for SYSTABLES:\r\n                                        Number of opens = 1\r\n                                        Rows seen = 32\r\n                                        Columns accessed from heap = {1, 2, 3}\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.06\r\n                                                optimizer estimated cost:            5.43\r\n\r\n                                                Index Scan ResultSet for SYSTABLES using index SYSTABLES_INDEX1 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                                Number of opens = 1\r\n                                                Rows seen = 32\r\n                                                Rows filtered = 0\r\n                                                Fetch Size = 16\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        next time in milliseconds/row = 0\r\n\r\n                                                scan information:\r\n                                                        Bit set of columns fetched={0, 2}\r\n                                                        Number of columns fetched=2\r\n                                                        Number of deleted rows visited=8\r\n                                                        Number of pages visited=1\r\n                                                        Number of rows qualified=32\r\n                                                        Number of rows visited=40\r\n                                                        Scan type=btree\r\n                                                        Tree height=1\r\n                                                        start position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        stop position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        qualifiers:\r\nNone\r\n                                                        optimizer estimated row count:            0.06\r\n                                                        optimizer estimated cost:            5.43\r\n\r\n\r\n                        Right result set:\r\n                                Project-Restrict ResultSet (8):\r\n                                Number of opens = 13\r\n                                Rows seen = 13\r\n                                Rows filtered = 0\r\n                                restriction = true\r\n                                projection = true\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        restriction time (milliseconds) = 0\r\n                                        projection time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.06\r\n                                        optimizer estimated cost:            0.27\r\n\r\n                                Source result set:\r\n                                        Index Row to Base Row ResultSet for SYSSCHEMAS:\r\n                                        Number of opens = 13\r\n                                        Rows seen = 13\r\n                                        Columns accessed from heap = {1}\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.06\r\n                                                optimizer estimated cost:            0.27\r\n\r\n                                                Index Scan ResultSet for SYSSCHEMAS using index SYSSCHEMAS_INDEX2 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                                Number of opens = 13\r\n                                                Rows seen = 13\r\n                                                Rows filtered = 0\r\n                                                Fetch Size = 1\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        next time in milliseconds/row = 0\r\n\r\n                                                scan information:\r\n                                                        Bit set of columns fetched=All\r\n                                                        Number of columns fetched=2\r\n                                                        Number of deleted rows visited=0\r\n                                                        Number of pages visited=13\r\n                                                        Number of rows qualified=13\r\n                                                        Number of rows visited=13\r\n                                                        Scan type=btree\r\n                                                        Tree height=1\r\n                                                        start position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n0\r\n                                                        stop position:\r\n        > on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n0\r\n                                                        qualifiers:\r\nNone\r\n                                                        optimizer estimated row count:            0.06\r\n                                                        optimizer estimated cost:            0.27\r\n\r\n\r\n\r\n                Right result set:\r\n                        Project-Restrict ResultSet (19):\r\n                        Number of opens = 13\r\n                        Rows seen = 52\r\n                        Rows filtered = 39\r\n                        restriction = true\r\n                        projection = false\r\n                                constructor time (milliseconds) = 0\r\n                                open time (milliseconds) = 0\r\n                                next time (milliseconds) = 0\r\n                                close time (milliseconds) = 0\r\n                                restriction time (milliseconds) = 0\r\n                                projection time (milliseconds) = 0\r\n                                optimizer estimated row count:            0.24\r\n                                optimizer estimated cost:            0.00\r\n\r\n                        Source result set:\r\n                                Union ResultSet:\r\n                                Number of opens = 13\r\n                                Rows seen from the left = 39\r\n                                Rows seen from the right = 13\r\n                                Rows returned = 52\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.24\r\n                                        optimizer estimated cost:            0.00\r\n\r\n                                Left result set:\r\n                                        Union ResultSet:\r\n                                        Number of opens = 13\r\n                                        Rows seen from the left = 26\r\n                                        Rows seen from the right = 13\r\n                                        Rows returned = 39\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.18\r\n                                                optimizer estimated cost:            0.00\r\n\r\n                                        Left result set:\r\n                                                Union ResultSet:\r\n                                                Number of opens = 13\r\n                                                Rows seen from the left = 13\r\n                                                Rows seen from the right = 13\r\n                                                Rows returned = 26\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        optimizer estimated row count:            0.12\r\n                                                        optimizer estimated cost:            0.00\r\n\r\n                                                Left result set:\r\n                                                        Normalize ResultSet:\r\n                                                        Number of opens = 13\r\n                                                        Rows seen = 13\r\n                                                                constructor time (milliseconds) = 0\r\n                                                                open time (milliseconds) = 0\r\n                                                                next time (milliseconds) = 0\r\n                                                                close time (milliseconds) = 0\r\n                                                                optimizer estimated row count:            0.12\r\n                                                                optimizer estimated cost:            0.00\r\n\r\n                                                        Source result set:\r\n                                                                Row ResultSet:\r\n                                                                Number of opens = 13\r\n                                                                Rows returned = 13\r\n                                                                        constructor time (milliseconds) = 0\r\n                                                                        open time (milliseconds) = 0\r\n                                                                        next time (milliseconds) = 0\r\n                                                                        close time (milliseconds) = 0\r\n                                                                        optimizer estimated row count:            0.06\r\n                                                                        optimizer estimated cost:            0.00\r\n\r\n\r\n\r\n                                                Right result set:\r\n                                                        Row ResultSet:\r\n                                                        Number of opens = 13\r\n                                                        Rows returned = 13\r\n                                                                constructor time (milliseconds) = 0\r\n                                                                open time (milliseconds) = 0\r\n                                                                next time (milliseconds) = 0\r\n                                                                close time (milliseconds) = 0\r\n                                                                optimizer estimated row count:            0.06\r\n                                                                optimizer estimated cost:            0.00\r\n\r\n\r\n\r\n                                        Right result set:\r\n                                                Normalize ResultSet:\r\n                                                Number of opens = 13\r\n                                                Rows seen = 13\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        optimizer estimated row count:            0.18\r\n                                                        optimizer estimated cost:            0.00\r\n\r\n                                                Source result set:\r\n                                                        Row ResultSet:\r\n                                                        Number of opens = 13\r\n                                                        Rows returned = 13\r\n                                                                constructor time (milliseconds) = 0\r\n                                                                open time (milliseconds) = 0\r\n                                                                next time (milliseconds) = 0\r\n                                                                close time (milliseconds) = 0\r\n                                                                optimizer estimated row count:            0.06\r\n                                                                optimizer estimated cost:            0.00\r\n\r\n\r\n\r\n\r\n                                Right result set:\r\n                                        Normalize ResultSet:\r\n                                        Number of opens = 13\r\n                                        Rows seen = 13\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.24\r\n                                                optimizer estimated cost:            0.00\r\n\r\n                                        Source result set:\r\n                                                Row ResultSet:\r\n                                                Number of opens = 13\r\n                                                Rows returned = 13\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        optimizer estimated row count:            0.06\r\n                                                        optimizer estimated cost:            0.00\r\n\r\n\r\n\r\n\r\n\r\n\r\n2008-05-18 19:24:52.848 GMT Thread[btpool0-4,5,main] (XID = 8145), (SESSIONID = 2), EXECUTE STATEMENT SYS.\"getColumns\" ******* Sort ResultSet:\r\nNumber of opens = 1\r\nRows input = 6\r\nRows returned = 6\r\nEliminate duplicates = false\r\nIn sorted order = false\r\nSort information:\r\n        Number of rows input=6\r\n        Number of rows output=6\r\n        Sort type=internal\r\n        constructor time (milliseconds) = 0\r\n        open time (milliseconds) = 0\r\n        next time (milliseconds) = 0\r\n        close time (milliseconds) = 0\r\n        optimizer estimated row count:            0.18\r\n        optimizer estimated cost:            7.30\r\n\r\nSource result set:\r\n        Project-Restrict ResultSet (12):\r\n        Number of opens = 1\r\n        Rows seen = 6\r\n        Rows filtered = 0\r\n        restriction = false\r\n        projection = true\r\n                constructor time (milliseconds) = 0\r\n                open time (milliseconds) = 0\r\n                next time (milliseconds) = 0\r\n                close time (milliseconds) = 0\r\n                restriction time (milliseconds) = 0\r\n                projection time (milliseconds) = 0\r\n                optimizer estimated row count:            0.18\r\n                optimizer estimated cost:            7.30\r\n\r\n        Source result set:\r\n                Nested Loop Join ResultSet:\r\n                Number of opens = 1\r\n                Rows seen from the left = 1\r\n                Rows seen from the right = 6\r\n                Rows filtered = 0\r\n                Rows returned = 6\r\n                        constructor time (milliseconds) = 0\r\n                        open time (milliseconds) = 0\r\n                        next time (milliseconds) = 0\r\n                        close time (milliseconds) = 0\r\n                        optimizer estimated row count:            0.18\r\n                        optimizer estimated cost:            7.30\r\n\r\n                Left result set:\r\n                        Nested Loop Join ResultSet:\r\n                        Number of opens = 1\r\n                        Rows seen from the left = 15\r\n                        Rows seen from the right = 1\r\n                        Rows filtered = 0\r\n                        Rows returned = 1\r\n                                constructor time (milliseconds) = 0\r\n                                open time (milliseconds) = 0\r\n                                next time (milliseconds) = 0\r\n                                close time (milliseconds) = 0\r\n                                optimizer estimated row count:            0.05\r\n                                optimizer estimated cost:            6.22\r\n\r\n                        Left result set:\r\n                                Project-Restrict ResultSet (5):\r\n                                Number of opens = 1\r\n                                Rows seen = 15\r\n                                Rows filtered = 0\r\n                                restriction = true\r\n                                projection = true\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        restriction time (milliseconds) = 0\r\n                                        projection time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.43\r\n                                        optimizer estimated cost:            4.99\r\n\r\n                                Source result set:\r\n                                        Index Row to Base Row ResultSet for SYSSCHEMAS:\r\n                                        Number of opens = 1\r\n                                        Rows seen = 15\r\n                                        Columns accessed from heap = {0, 1}\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.43\r\n                                                optimizer estimated cost:            4.99\r\n\r\n                                                Index Scan ResultSet for SYSSCHEMAS using index SYSSCHEMAS_INDEX1 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                                Number of opens = 1\r\n                                                Rows seen = 15\r\n                                                Rows filtered = 0\r\n                                                Fetch Size = 16\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        next time in milliseconds/row = 0\r\n\r\n                                                scan information:\r\n                                                        Bit set of columns fetched=All\r\n                                                        Number of columns fetched=2\r\n                                                        Number of deleted rows visited=12\r\n                                                        Number of pages visited=1\r\n                                                        Number of rows qualified=15\r\n                                                        Number of rows visited=27\r\n                                                        Scan type=btree\r\n                                                        Tree height=1\r\n                                                        start position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        stop position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        qualifiers:\r\nNone\r\n                                                        optimizer estimated row count:            0.43\r\n                                                        optimizer estimated cost:            4.99\r\n\r\n\r\n                        Right result set:\r\n                                Project-Restrict ResultSet (8):\r\n                                Number of opens = 15\r\n                                Rows seen = 13\r\n                                Rows filtered = 12\r\n                                restriction = true\r\n                                projection = true\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        restriction time (milliseconds) = 0\r\n                                        projection time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.05\r\n                                        optimizer estimated cost:            1.23\r\n\r\n                                Source result set:\r\n                                        Index Row to Base Row ResultSet for SYSTABLES:\r\n                                        Number of opens = 15\r\n                                        Rows seen = 13\r\n                                        Columns accessed from heap = {0, 1, 3}\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.05\r\n                                                optimizer estimated cost:            1.23\r\n\r\n                                                Index Scan ResultSet for SYSTABLES using index SYSTABLES_INDEX1 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                                Number of opens = 15\r\n                                                Rows seen = 13\r\n                                                Rows filtered = 0\r\n                                                Fetch Size = 16\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        next time in milliseconds/row = 0\r\n\r\n                                                scan information:\r\n                                                        Bit set of columns fetched=All\r\n                                                        Number of columns fetched=3\r\n                                                        Number of deleted rows visited=120\r\n                                                        Number of pages visited=15\r\n                                                        Number of rows qualified=13\r\n                                                        Number of rows visited=330\r\n                                                        Scan type=btree\r\n                                                        Tree height=1\r\n                                                        start position:\r\n        >= on first 2 column(s).\r\n        Ordered null semantics on the following columns:\r\n1\r\n                                                        stop position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        qualifiers:\r\nColumn[0][0] Id: 1\r\nOperator: =\r\nOrdered nulls: false\r\nUnknown return value: false\r\nNegate comparison result: false\r\n\r\n                                                        optimizer estimated row count:            0.05\r\n                                                        optimizer estimated cost:            1.23\r\n\r\n\r\n\r\n                Right result set:\r\n                        Project-Restrict ResultSet (11):\r\n                        Number of opens = 1\r\n                        Rows seen = 6\r\n                        Rows filtered = 0\r\n                        restriction = true\r\n                        projection = true\r\n                                constructor time (milliseconds) = 0\r\n                                open time (milliseconds) = 0\r\n                                next time (milliseconds) = 0\r\n                                close time (milliseconds) = 0\r\n                                restriction time (milliseconds) = 0\r\n                                projection time (milliseconds) = 0\r\n                                optimizer estimated row count:            0.18\r\n                                optimizer estimated cost:            1.08\r\n\r\n                        Source result set:\r\n                                Index Row to Base Row ResultSet for SYSCOLUMNS:\r\n                                Number of opens = 1\r\n                                Rows seen = 6\r\n                                Columns accessed from heap = {0, 1, 2, 3, 4, 7, 8}\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.18\r\n                                        optimizer estimated cost:            1.08\r\n\r\n                                        Index Scan ResultSet for SYSCOLUMNS using index SYSCOLUMNS_INDEX1 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                        Number of opens = 1\r\n                                        Rows seen = 6\r\n                                        Rows filtered = 0\r\n                                        Fetch Size = 16\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                next time in milliseconds/row = 0\r\n\r\n                                        scan information:\r\n                                                Bit set of columns fetched=All\r\n                                                Number of columns fetched=3\r\n                                                Number of deleted rows visited=0\r\n                                                Number of pages visited=2\r\n                                                Number of rows qualified=6\r\n                                                Number of rows visited=7\r\n                                                Scan type=btree\r\n                                                Tree height=2\r\n                                                start position:\r\n        >= on first 2 column(s).\r\n        Ordered null semantics on the following columns:\r\n0\r\n                                                stop position:\r\n        >= on first 2 column(s).\r\n        Ordered null semantics on the following columns:\r\n0\r\n                                                qualifiers:\r\nNone\r\n                                                optimizer estimated row count:            0.18\r\n                                                optimizer estimated cost:            1.08\r\n\r\n\r\n\r\n\r\n2008-05-18 19:24:52.891 GMT Thread[btpool0-4,5,main] (XID = 8148), (SESSIONID = 3), SELECT CONSTRAINTNAME FROM SYS.SYSCONSTRAINTS ******* Index Scan ResultSet for SYSCONSTRAINTS using index SYSCONSTRAINTS_INDEX2 at read uncommitted isolation level using share row locking chosen by the optimizer\r\nNumber of opens = 1\r\nRows seen = 24\r\nRows filtered = 0\r\nFetch Size = 16\r\n        constructor time (milliseconds) = 0\r\n        open time (milliseconds) = 0\r\n        next time (milliseconds) = 0\r\n        close time (milliseconds) = 0\r\n        next time in milliseconds/row = 0\r\n\r\nscan information:\r\n        Bit set of columns fetched={0}\r\n        Number of columns fetched=1\r\n        Number of deleted rows visited=20\r\n        Number of pages visited=3\r\n        Number of rows qualified=24\r\n        Number of rows visited=44\r\n        Scan type=btree\r\n        Tree height=-1\r\n        start position:\r\n        None\r\n        stop position:\r\n        None\r\n        qualifiers:\r\nNone\r\n        optimizer estimated row count:           43.00\r\n        optimizer estimated cost:           61.46\r\n\r\n\r\n\r\n\r\n\r\n==========================\r\n\r\n\r\n\r\n2008-05-18 19:40:06.154 GMT Thread[btpool0-4,5,main] (XID = 8189), (SESSIONID = 2), EXECUTE STATEMENT SYS.\"getTables\" ******* Sort ResultSet:\r\nNumber of opens = 1\r\nRows input = 13\r\nRows returned = 13\r\nEliminate duplicates = false\r\nIn sorted order = false\r\nSort information:\r\n        Number of rows input=13\r\n        Number of rows output=13\r\n        Sort type=internal\r\n        constructor time (milliseconds) = 0\r\n        open time (milliseconds) = 0\r\n        next time (milliseconds) = 0\r\n        close time (milliseconds) = 0\r\n        optimizer estimated row count:            0.24\r\n        optimizer estimated cost:            5.71\r\n\r\nSource result set:\r\n        Project-Restrict ResultSet (20):\r\n        Number of opens = 1\r\n        Rows seen = 13\r\n        Rows filtered = 0\r\n        restriction = false\r\n        projection = true\r\n                constructor time (milliseconds) = 0\r\n                open time (milliseconds) = 0\r\n                next time (milliseconds) = 0\r\n                close time (milliseconds) = 0\r\n                restriction time (milliseconds) = 0\r\n                projection time (milliseconds) = 0\r\n                optimizer estimated row count:            0.24\r\n                optimizer estimated cost:            5.71\r\n\r\n        Source result set:\r\n                Nested Loop Join ResultSet:\r\n                Number of opens = 1\r\n                Rows seen from the left = 13\r\n                Rows seen from the right = 13\r\n                Rows filtered = 0\r\n                Rows returned = 13\r\n                        constructor time (milliseconds) = 0\r\n                        open time (milliseconds) = 0\r\n                        next time (milliseconds) = 0\r\n                        close time (milliseconds) = 0\r\n                        optimizer estimated row count:            0.24\r\n                        optimizer estimated cost:            5.71\r\n\r\n                Left result set:\r\n                        Nested Loop Exists Join ResultSet:\r\n                        Number of opens = 1\r\n                        Rows seen from the left = 13\r\n                        Rows seen from the right = 13\r\n                        Rows filtered = 0\r\n                        Rows returned = 13\r\n                                constructor time (milliseconds) = 0\r\n                                open time (milliseconds) = 0\r\n                                next time (milliseconds) = 0\r\n                                close time (milliseconds) = 0\r\n                                optimizer estimated row count:            0.06\r\n                                optimizer estimated cost:            5.71\r\n\r\n                        Left result set:\r\n                                Project-Restrict ResultSet (5):\r\n                                Number of opens = 1\r\n                                Rows seen = 32\r\n                                Rows filtered = 19\r\n                                restriction = true\r\n                                projection = true\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        restriction time (milliseconds) = 0\r\n                                        projection time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.06\r\n                                        optimizer estimated cost:            5.43\r\n\r\n                                Source result set:\r\n                                        Index Row to Base Row ResultSet for SYSTABLES:\r\n                                        Number of opens = 1\r\n                                        Rows seen = 32\r\n                                        Columns accessed from heap = {1, 2, 3}\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.06\r\n                                                optimizer estimated cost:            5.43\r\n\r\n                                                Index Scan ResultSet for SYSTABLES using index SYSTABLES_INDEX1 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                                Number of opens = 1\r\n                                                Rows seen = 32\r\n                                                Rows filtered = 0\r\n                                                Fetch Size = 16\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        next time in milliseconds/row = 0\r\n\r\n                                                scan information:\r\n                                                        Bit set of columns fetched={0, 2}\r\n                                                        Number of columns fetched=2\r\n                                                        Number of deleted rows visited=8\r\n                                                        Number of pages visited=1\r\n                                                        Number of rows qualified=32\r\n                                                        Number of rows visited=40\r\n                                                        Scan type=btree\r\n                                                        Tree height=1\r\n                                                        start position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        stop position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        qualifiers:\r\nNone\r\n                                                        optimizer estimated row count:            0.06\r\n                                                        optimizer estimated cost:            5.43\r\n\r\n\r\n                        Right result set:\r\n                                Project-Restrict ResultSet (8):\r\n                                Number of opens = 13\r\n                                Rows seen = 13\r\n                                Rows filtered = 0\r\n                                restriction = true\r\n                                projection = true\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        restriction time (milliseconds) = 0\r\n                                        projection time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.06\r\n                                        optimizer estimated cost:            0.27\r\n\r\n                                Source result set:\r\n                                        Index Row to Base Row ResultSet for SYSSCHEMAS:\r\n                                        Number of opens = 13\r\n                                        Rows seen = 13\r\n                                        Columns accessed from heap = {1}\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.06\r\n                                                optimizer estimated cost:            0.27\r\n\r\n                                                Index Scan ResultSet for SYSSCHEMAS using index SYSSCHEMAS_INDEX2 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                                Number of opens = 13\r\n                                                Rows seen = 13\r\n                                                Rows filtered = 0\r\n                                                Fetch Size = 1\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        next time in milliseconds/row = 0\r\n\r\n                                                scan information:\r\n                                                        Bit set of columns fetched=All\r\n                                                        Number of columns fetched=2\r\n                                                        Number of deleted rows visited=0\r\n                                                        Number of pages visited=13\r\n                                                        Number of rows qualified=13\r\n                                                        Number of rows visited=13\r\n                                                        Scan type=btree\r\n                                                        Tree height=1\r\n                                                        start position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n0\r\n                                                        stop position:\r\n        > on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n0\r\n                                                        qualifiers:\r\nNone\r\n                                                        optimizer estimated row count:            0.06\r\n                                                        optimizer estimated cost:            0.27\r\n\r\n\r\n\r\n                Right result set:\r\n                        Project-Restrict ResultSet (19):\r\n                        Number of opens = 13\r\n                        Rows seen = 52\r\n                        Rows filtered = 39\r\n                        restriction = true\r\n                        projection = false\r\n                                constructor time (milliseconds) = 0\r\n                                open time (milliseconds) = 0\r\n                                next time (milliseconds) = 0\r\n                                close time (milliseconds) = 0\r\n                                restriction time (milliseconds) = 0\r\n                                projection time (milliseconds) = 0\r\n                                optimizer estimated row count:            0.24\r\n                                optimizer estimated cost:            0.00\r\n\r\n                        Source result set:\r\n                                Union ResultSet:\r\n                                Number of opens = 13\r\n                                Rows seen from the left = 39\r\n                                Rows seen from the right = 13\r\n                                Rows returned = 52\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.24\r\n                                        optimizer estimated cost:            0.00\r\n\r\n                                Left result set:\r\n                                        Union ResultSet:\r\n                                        Number of opens = 13\r\n                                        Rows seen from the left = 26\r\n                                        Rows seen from the right = 13\r\n                                        Rows returned = 39\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.18\r\n                                                optimizer estimated cost:            0.00\r\n\r\n                                        Left result set:\r\n                                                Union ResultSet:\r\n                                                Number of opens = 13\r\n                                                Rows seen from the left = 13\r\n                                                Rows seen from the right = 13\r\n                                                Rows returned = 26\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        optimizer estimated row count:            0.12\r\n                                                        optimizer estimated cost:            0.00\r\n\r\n                                                Left result set:\r\n                                                        Normalize ResultSet:\r\n                                                        Number of opens = 13\r\n                                                        Rows seen = 13\r\n                                                                constructor time (milliseconds) = 0\r\n                                                                open time (milliseconds) = 0\r\n                                                                next time (milliseconds) = 0\r\n                                                                close time (milliseconds) = 0\r\n                                                                optimizer estimated row count:            0.12\r\n                                                                optimizer estimated cost:            0.00\r\n\r\n                                                        Source result set:\r\n                                                                Row ResultSet:\r\n                                                                Number of opens = 13\r\n                                                                Rows returned = 13\r\n                                                                        constructor time (milliseconds) = 0\r\n                                                                        open time (milliseconds) = 0\r\n                                                                        next time (milliseconds) = 0\r\n                                                                        close time (milliseconds) = 0\r\n                                                                        optimizer estimated row count:            0.06\r\n                                                                        optimizer estimated cost:            0.00\r\n\r\n\r\n\r\n                                                Right result set:\r\n                                                        Row ResultSet:\r\n                                                        Number of opens = 13\r\n                                                        Rows returned = 13\r\n                                                                constructor time (milliseconds) = 0\r\n                                                                open time (milliseconds) = 0\r\n                                                                next time (milliseconds) = 0\r\n                                                                close time (milliseconds) = 0\r\n                                                                optimizer estimated row count:            0.06\r\n                                                                optimizer estimated cost:            0.00\r\n\r\n\r\n\r\n                                        Right result set:\r\n                                                Normalize ResultSet:\r\n                                                Number of opens = 13\r\n                                                Rows seen = 13\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        optimizer estimated row count:            0.18\r\n                                                        optimizer estimated cost:            0.00\r\n\r\n                                                Source result set:\r\n                                                        Row ResultSet:\r\n                                                        Number of opens = 13\r\n                                                        Rows returned = 13\r\n                                                                constructor time (milliseconds) = 0\r\n                                                                open time (milliseconds) = 0\r\n                                                                next time (milliseconds) = 0\r\n                                                                close time (milliseconds) = 0\r\n                                                                optimizer estimated row count:            0.06\r\n                                                                optimizer estimated cost:            0.00\r\n\r\n\r\n\r\n\r\n                                Right result set:\r\n                                        Normalize ResultSet:\r\n                                        Number of opens = 13\r\n                                        Rows seen = 13\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.24\r\n                                                optimizer estimated cost:            0.00\r\n\r\n                                        Source result set:\r\n                                                Row ResultSet:\r\n                                                Number of opens = 13\r\n                                                Rows returned = 13\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        optimizer estimated row count:            0.06\r\n                                                        optimizer estimated cost:            0.00\r\n\r\n\r\n\r\n\r\n\r\n\r\n2008-05-18 19:40:06.201 GMT Thread[btpool0-4,5,main] (XID = 8191), (SESSIONID = 2), EXECUTE STATEMENT SYS.\"getColumns\" ******* Sort ResultSet:\r\nNumber of opens = 1\r\nRows input = 6\r\nRows returned = 6\r\nEliminate duplicates = false\r\nIn sorted order = false\r\nSort information:\r\n        Number of rows input=6\r\n        Number of rows output=6\r\n        Sort type=internal\r\n        constructor time (milliseconds) = 0\r\n        open time (milliseconds) = 0\r\n        next time (milliseconds) = 0\r\n        close time (milliseconds) = 0\r\n        optimizer estimated row count:            0.18\r\n        optimizer estimated cost:            7.30\r\n\r\nSource result set:\r\n        Project-Restrict ResultSet (12):\r\n        Number of opens = 1\r\n        Rows seen = 6\r\n        Rows filtered = 0\r\n        restriction = false\r\n        projection = true\r\n                constructor time (milliseconds) = 0\r\n                open time (milliseconds) = 0\r\n                next time (milliseconds) = 0\r\n                close time (milliseconds) = 0\r\n                restriction time (milliseconds) = 0\r\n                projection time (milliseconds) = 0\r\n                optimizer estimated row count:            0.18\r\n                optimizer estimated cost:            7.30\r\n\r\n        Source result set:\r\n                Nested Loop Join ResultSet:\r\n                Number of opens = 1\r\n                Rows seen from the left = 1\r\n                Rows seen from the right = 6\r\n                Rows filtered = 0\r\n                Rows returned = 6\r\n                        constructor time (milliseconds) = 0\r\n                        open time (milliseconds) = 0\r\n                        next time (milliseconds) = 0\r\n                        close time (milliseconds) = 0\r\n                        optimizer estimated row count:            0.18\r\n                        optimizer estimated cost:            7.30\r\n\r\n                Left result set:\r\n                        Nested Loop Join ResultSet:\r\n                        Number of opens = 1\r\n                        Rows seen from the left = 15\r\n                        Rows seen from the right = 1\r\n                        Rows filtered = 0\r\n                        Rows returned = 1\r\n                                constructor time (milliseconds) = 0\r\n                                open time (milliseconds) = 0\r\n                                next time (milliseconds) = 0\r\n                                close time (milliseconds) = 0\r\n                                optimizer estimated row count:            0.05\r\n                                optimizer estimated cost:            6.22\r\n\r\n                        Left result set:\r\n                                Project-Restrict ResultSet (5):\r\n                                Number of opens = 1\r\n                                Rows seen = 15\r\n                                Rows filtered = 0\r\n                                restriction = true\r\n                                projection = true\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        restriction time (milliseconds) = 0\r\n                                        projection time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.43\r\n                                        optimizer estimated cost:            4.99\r\n\r\n                                Source result set:\r\n                                        Index Row to Base Row ResultSet for SYSSCHEMAS:\r\n                                        Number of opens = 1\r\n                                        Rows seen = 15\r\n                                        Columns accessed from heap = {0, 1}\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.43\r\n                                                optimizer estimated cost:            4.99\r\n\r\n                                                Index Scan ResultSet for SYSSCHEMAS using index SYSSCHEMAS_INDEX1 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                                Number of opens = 1\r\n                                                Rows seen = 15\r\n                                                Rows filtered = 0\r\n                                                Fetch Size = 16\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        next time in milliseconds/row = 0\r\n\r\n                                                scan information:\r\n                                                        Bit set of columns fetched=All\r\n                                                        Number of columns fetched=2\r\n                                                        Number of deleted rows visited=12\r\n                                                        Number of pages visited=1\r\n                                                        Number of rows qualified=15\r\n                                                        Number of rows visited=27\r\n                                                        Scan type=btree\r\n                                                        Tree height=1\r\n                                                        start position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        stop position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        qualifiers:\r\nNone\r\n                                                        optimizer estimated row count:            0.43\r\n                                                        optimizer estimated cost:            4.99\r\n\r\n\r\n                        Right result set:\r\n                                Project-Restrict ResultSet (8):\r\n                                Number of opens = 15\r\n                                Rows seen = 13\r\n                                Rows filtered = 12\r\n                                restriction = true\r\n                                projection = true\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        restriction time (milliseconds) = 0\r\n                                        projection time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.05\r\n                                        optimizer estimated cost:            1.23\r\n\r\n                                Source result set:\r\n                                        Index Row to Base Row ResultSet for SYSTABLES:\r\n                                        Number of opens = 15\r\n                                        Rows seen = 13\r\n                                        Columns accessed from heap = {0, 1, 3}\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                optimizer estimated row count:            0.05\r\n                                                optimizer estimated cost:            1.23\r\n\r\n                                                Index Scan ResultSet for SYSTABLES using index SYSTABLES_INDEX1 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                                Number of opens = 15\r\n                                                Rows seen = 13\r\n                                                Rows filtered = 0\r\n                                                Fetch Size = 16\r\n                                                        constructor time (milliseconds) = 0\r\n                                                        open time (milliseconds) = 0\r\n                                                        next time (milliseconds) = 0\r\n                                                        close time (milliseconds) = 0\r\n                                                        next time in milliseconds/row = 0\r\n\r\n                                                scan information:\r\n                                                        Bit set of columns fetched=All\r\n                                                        Number of columns fetched=3\r\n                                                        Number of deleted rows visited=120\r\n                                                        Number of pages visited=15\r\n                                                        Number of rows qualified=13\r\n                                                        Number of rows visited=330\r\n                                                        Scan type=btree\r\n                                                        Tree height=1\r\n                                                        start position:\r\n        >= on first 2 column(s).\r\n        Ordered null semantics on the following columns:\r\n1\r\n                                                        stop position:\r\n        >= on first 1 column(s).\r\n        Ordered null semantics on the following columns:\r\n\r\n                                                        qualifiers:\r\nColumn[0][0] Id: 1\r\nOperator: =\r\nOrdered nulls: false\r\nUnknown return value: false\r\nNegate comparison result: false\r\n\r\n                                                        optimizer estimated row count:            0.05\r\n                                                        optimizer estimated cost:            1.23\r\n\r\n\r\n\r\n                Right result set:\r\n                        Project-Restrict ResultSet (11):\r\n                        Number of opens = 1\r\n                        Rows seen = 6\r\n                        Rows filtered = 0\r\n                        restriction = true\r\n                        projection = true\r\n                                constructor time (milliseconds) = 0\r\n                                open time (milliseconds) = 0\r\n                                next time (milliseconds) = 0\r\n                                close time (milliseconds) = 0\r\n                                restriction time (milliseconds) = 0\r\n                                projection time (milliseconds) = 0\r\n                                optimizer estimated row count:            0.18\r\n                                optimizer estimated cost:            1.08\r\n\r\n                        Source result set:\r\n                                Index Row to Base Row ResultSet for SYSCOLUMNS:\r\n                                Number of opens = 1\r\n                                Rows seen = 6\r\n                                Columns accessed from heap = {0, 1, 2, 3, 4, 7, 8}\r\n                                        constructor time (milliseconds) = 0\r\n                                        open time (milliseconds) = 0\r\n                                        next time (milliseconds) = 0\r\n                                        close time (milliseconds) = 0\r\n                                        optimizer estimated row count:            0.18\r\n                                        optimizer estimated cost:            1.08\r\n\r\n                                        Index Scan ResultSet for SYSCOLUMNS using index SYSCOLUMNS_INDEX1 at read uncommitted isolation level using share row locking chosen by the optimizer\r\n                                        Number of opens = 1\r\n                                        Rows seen = 6\r\n                                        Rows filtered = 0\r\n                                        Fetch Size = 16\r\n                                                constructor time (milliseconds) = 0\r\n                                                open time (milliseconds) = 0\r\n                                                next time (milliseconds) = 0\r\n                                                close time (milliseconds) = 0\r\n                                                next time in milliseconds/row = 0\r\n\r\n                                        scan information:\r\n                                                Bit set of columns fetched=All\r\n                                                Number of columns fetched=3\r\n                                                Number of deleted rows visited=0\r\n                                                Number of pages visited=3\r\n                                                Number of rows qualified=6\r\n                                                Number of rows visited=7\r\n                                                Scan type=btree\r\n                                                Tree height=2\r\n                                                start position:\r\n        >= on first 2 column(s).\r\n        Ordered null semantics on the following columns:\r\n0\r\n                                                stop position:\r\n        >= on first 2 column(s).\r\n        Ordered null semantics on the following columns:\r\n0\r\n                                                qualifiers:\r\nNone\r\n                                                optimizer estimated row count:            0.18\r\n                                                optimizer estimated cost:            1.08\r\n\r\n\r\n\r\n\r\n2008-05-18 19:40:06.219 GMT Thread[btpool0-4,5,main] (XID = 8193), (SESSIONID = 3), SELECT CONSTRAINTNAME FROM SYS.SYSCONSTRAINTS ******* Index Scan ResultSet for SYSCONSTRAINTS using index SYSCONSTRAINTS_INDEX2 at read uncommitted isolation level using share row locking chosen by the optimizer\r\nNumber of opens = 1\r\nRows seen = 24\r\nRows filtered = 0\r\nFetch Size = 16\r\n        constructor time (milliseconds) = 0\r\n        open time (milliseconds) = 0\r\n        next time (milliseconds) = 0\r\n        close time (milliseconds) = 0\r\n        next time in milliseconds/row = 0\r\n\r\nscan information:\r\n        Bit set of columns fetched={0}\r\n        Number of columns fetched=1\r\n        Number of deleted rows visited=24\r\n        Number of pages visited=3\r\n        Number of rows qualified=24\r\n        Number of rows visited=48\r\n        Scan type=btree\r\n        Tree height=-1\r\n        start position:\r\n        None\r\n        stop position:\r\n        None\r\n        qualifiers:\r\nNone\r\n        optimizer estimated row count:           26.00\r\n        optimizer estimated cost:           59.49\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"created":"2008-05-19T14:23:38.124+0000","updated":"2008-05-19T14:23:38.124+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12599713","id":"12599713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"body":"Any plan to investigate? this is a major issue for us. Especially if you run derby embedded, this will freeze the webserver that shares the JVM with the database. I have to \"kill -9\" the process, it is frozen so badly. I can gather as much information as you need to help resolve this, just tell me what you need.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"created":"2008-05-25T20:11:04.998+0000","updated":"2008-05-25T20:11:04.998+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12599769","id":"12599769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Dag H. Wanvik posted the following comment on derby-dev:\r\n\r\nThe following scenario creates a hang when a 2nd connection is made\r\nfor the user \"newuser\":\r\n\r\n> java -Dij.exceptionTrace=true org.apache.derby.tools.ij\r\n\r\nij> connect 'jdbc:derby:wombat;user=newuser';\r\n                            -- no schema is yet created for newuser.                          \r\nij> autocommit off;\r\nij> create table i (i int); -- the schema is only created for 'newuser' at this point\r\n0 rows inserted/updated/deleted\r\n\r\nNotice that this session has not yet committed... now we make a new\r\nsession with the same user:\r\n\r\nij> connect 'jdbc:derby:wombat;user=newuser';\r\nERROR 40XL1: A lock could not be obtained within the time requested\r\n\r\nMight this be what happens for you?  The first time a new user\r\nconnects and creates a database object, his schema will be\r\ncreated. But until that session commits, another session cannot login\r\nwith the same user name, since the new entry in SYSSCHEMAS\r\ncorresponding to the new user's schema has not been committed either\r\n(it has a write lock on it so it can't be read by the second session).\r\n\r\nNote, even if you don't use explicit users, there will still be be an\r\nimplicit user, so the same thing applies.\r\n\r\nDag\r\n\r\nERROR 40XL1: A lock could not be obtained within the time requested\r\n(full stack trace I got):\r\n\r\njava.sql.SQLTransactionRollbackException: A lock could not be obtained within the time requested\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:88)\r\n\tat org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:201)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:391)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2179)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1197)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.checkUserCredentials(EmbedConnection.java:1130)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.java:398)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection30.<init>(EmbedConnection30.java:73)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection40.<init>(EmbedConnection40.java:54)\r\n\tat org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)\r\n\tat org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:238)\r\n\tat org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:582)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:154)\r\n\tat org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:1237)\r\n\tat org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:1087)\r\n\tat org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:915)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:328)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)\r\n\tat org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\r\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\r\n\tat org.apache.derby.impl.tools.ij.Main.main(Main.java:73)\r\n\tat org.apache.derby.tools.ij.main(ij.java:59)\r\nCaused by: java.sql.SQLException: A lock could not be obtained within the time requested\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)\r\n\t... 23 more\r\nCaused by: ERROR 40XL1: A lock could not be obtained within the time requested\r\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276)\r\n\tat org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(ConcurrentLockSet.java:602)\r\n\tat org.apache.derby.impl.services.locks.AbstractPool.lockObject(AbstractPool.java:117)\r\n\tat org.apache.derby.impl.services.locks.ConcurrentPool.lockObject(ConcurrentPool.java:28)\r\n\tat org.apache.derby.impl.store.raw.xact.RowLocking3.lockRecordForRead(RowLocking3.java:187)\r\n\tat org.apache.derby.impl.store.access.heap.HeapController.lockRow(HeapController.java:520)\r\n\tat org.apache.derby.impl.store.access.heap.HeapController.lockRow(HeapController.java:638)\r\n\tat org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.lockRowOnPage(B2IRowLocking3.java:335)\r\n\tat org.apache.derby.impl.store.access.btree.index.B2IRowLocking3._lockScanRow(B2IRowLocking3.java:628)\r\n\tat org.apache.derby.impl.store.access.btree.index.B2IRowLockingRR.lockScanRow(B2IRowLockingRR.java:112)\r\n\tat org.apache.derby.impl.store.access.btree.BTreeForwardScan.fetchRows(BTreeForwardScan.java:304)\r\n\tat org.apache.derby.impl.store.access.btree.BTreeScan.next(BTreeScan.java:1756)\r\n\tat org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(DataDictionaryImpl.java:8243)\r\n\tat org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(DataDictionaryImpl.java:1559)\r\n\tat org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(DataDictionaryImpl.java:1469)\r\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initDefaultSchemaDescriptor(GenericLanguageConnectionContext.java:370)\r\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.initialize(GenericLanguageConnectionContext.java:347)\r\n\tat org.apache.derby.impl.db.BasicDatabase.setupConnection(BasicDatabase.java:309)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.startTransaction(TransactionResourceImpl.java:188)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.checkUserIsNotARole(EmbedConnection.java:1166)\r\n\t... 18 more\r\nij>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-05-26T07:07:28.639+0000","updated":"2008-05-26T07:07:28.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12599770","id":"12599770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Kathey Marsden posted a comment on derby-dev saying that the issue mentioned by Dag is filed as DERBY-48.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-05-26T07:09:05.259+0000","updated":"2008-05-26T07:09:05.259+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12599772","id":"12599772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"When I try Dag's test case with derby.locks.deadlockTrace=true, I see the originally reported StackOverflowException:\r\n\r\n$ java -Dderby.locks.waitTimeout=1 -Dderby.locks.deadlockTrace=true -jar derbyrun.jar ij\r\nij version 10.5\r\nij> connect 'jdbc:derby:wombat;user=newuser;create=true';\r\nij> autocommit off; \r\nij> create table i (i int);\r\n0 rows inserted/updated/deleted\r\nij> connect 'jdbc:derby:wombat;user=newuser';\r\nERROR XJ001: Java exception: ': java.lang.StackOverflowError'.\r\nij>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-05-26T07:29:54.193+0000","updated":"2008-05-26T07:29:54.193+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12600488","id":"12600488","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"body":"I only have one connection open to the given database. So it seems this problem will occur even with only one connection. However, I found that the problem can be made to go away, in my case, by more carefully closing my prepared statements immediately after I am done with them, instead of relying on Connection.close. So the problem seems, in my case,  to be related to having 9 or more PreparedStatements open through a given connection.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"created":"2008-05-28T14:32:18.349+0000","updated":"2008-05-28T14:32:18.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12600669","id":"12600669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"\"geoff hendrey (JIRA)\" <jira@apache.org> writes:\r\n\r\n> I only have one connection open to the given database. So it seems\r\n> this problem will occur even with only one connection. However, I\r\n> found that the problem can be made to go away, in my case, by more\r\n> carefully closing my prepared statements immediately after I am done\r\n> with them, instead of relying on Connection.close. So the problem\r\n> seems, in my case, to be related to having 9 or more\r\n> PreparedStatements open through a given connection.\r\n\r\nWould you be able to post a repro with and without the mod that made it work? It would help a lot in pin-pointing\r\nyour problem...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-05-29T02:48:00.452+0000","updated":"2008-05-29T02:48:00.452+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12601654","id":"12601654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The underlying issue that provoked the bug in the deadlock detection (DERBY-48) in this case,\r\nhas been fixed on trunk. \r\nTo reproduce the stack overflow now that DERBY-48 is fixed, one could roll back that fix or find some other\r\nway of provoking it.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-06-02T15:41:32.531+0000","updated":"2008-06-02T15:41:32.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12602130","id":"12602130","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"This patch, derby-3678-1, adds a testcase, testDerby3678, to\r\nLazyDefaultSchemaCreationTest. This reproduces the infinite recursion\r\nseen by this issue, if applied without the rest of the patch, which\r\nalso contains a fix.\r\n\r\nDescription of the problem:\r\n\r\nA time-out occurs when a second transaction tries to connect if\r\nanother connection creates a schema and populates it with a table\r\nwithout committing. See also DERBY-48.\r\n\r\nIn the repro test case, after the timeout occurs on the second\r\nconnect, the code in Timeout.java tries to construct the diagnostic\r\nlock table when tracing is enabled\r\n(derby.locks.deadlockTrace=true). The first thing Timeout does when\r\ncontructing an exception (inside buildLockTableString), is to create a\r\nnew instance of TableNameInfo, which it uses to map conglomerate ids\r\nto names to make the print-out more user friendly.\r\n\r\nThe constructor of TableNameInfo calls\r\nDataDictionary#hashAllTableDescriptorsByTableId, which scans\r\nSYS.SYSTABLES in read uncommitted mode. When an entry is found, a\r\ndescriptor for that table is built\r\n(SYSTABLESRowFactory#buildDescriptor).\r\n\r\nAs part of building the descriptor for the table, buildDescriptor\r\ntries to look up thats table's schema using the UUID of the schema\r\n(found in the row from SYSTABLES describing the table) using\r\ndd.getSchemaDescriptor. This method tries to read SYS.SYSSCHEMAS with\r\nrepeatable read mode, which leads to the recursive lock and finally\r\nstack overflow for the thread.\r\n\r\nIf the lookup of the table's schema is done with read uncommitted\r\ninstead, the recursion will not happen. This seems permissible, since\r\nSYS.SYSTABLES is also read in read uncommitted mode from\r\nhashAllTableDescriptorsByTableId, which is only ever called from\r\nTableNameInfo, which, in turn, is only used for diagnostics, as far as\r\nI can tell.\r\n\r\nPatch description:\r\n\r\n- Adds a new testcase to LazyDefaultSchemaCreationTest\r\n- Makes hashAllTableDescriptorsByTableId use read uncommitted mode when\r\n  accessing SYS.SYSSCHEMAS. Unfortunately I had to add many overloads\r\n  to be able to propagate the isolation mode all the way down. Is\r\n  there a better way?\r\n\r\nRunning regressions now.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-06-04T00:27:00.625+0000","updated":"2008-06-04T00:33:37.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12602255","id":"12602255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Regressions passed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-06-04T11:50:02.818+0000","updated":"2008-06-04T11:50:02.818+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12603583","id":"12603583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I will commit this patch soon if nobody has any objections. I'd still appreciate a review of this one, though.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-06-09T15:09:31.246+0000","updated":"2008-06-09T15:09:31.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12603855","id":"12603855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The approach looks fine to me. Two tiny nits:\r\n\r\n1. Javadoc for hashAllTableDescriptorsByTableId() should be updated:\r\n  \"This method will scan SYS.SYSTABLES at READ UNCOMMITTED.\" --> \"This method will scan SYS.SYSTABLES and SYS.SYSSCHEMAS at READ UNCOMMITTED.\"\r\n\r\n2. The indentation seems to have been accidentally deleted for a line in DataDictionaryImpl:\r\n-\t/**\r\n+\r\n+/**\r\n \t * Get the target schema by searching for a matching row\r\n \t * in SYSSCHEMAS by schema name.  Read only scan.\r\n \t * ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-06-10T12:51:25.104+0000","updated":"2008-06-10T12:51:25.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12603861","id":"12603861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I also noticed that hashAllTableDescriptorsByTableId() says:\r\n\r\n        // it is important for read uncommitted scans to use fetchNext() rather\r\n        // than fetch, so that the fetch happens while latch is held, otherwise\r\n        // the next() might position the scan on a row, but the subsequent\r\n        // fetch() may find the row deleted or purged from the table.\r\n\r\nWith the patch, getDescriptorViaIndexMinion() sometimes uses read uncommitted isolation level, but still it uses next() + fetch() instead of fetchNext(). Do you think this could cause any problems?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-06-10T13:04:59.862+0000","updated":"2008-06-10T13:04:59.862+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12604041","id":"12604041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for looking at this, Knut Anders. Fixed the javadoc and the\r\naccidental whitespace thing.  As for your second, comment, I agree it\r\nis probably better to use the idiom for reading the index row under\r\nread uncommitted mode, so I did that.\r\n\r\nAdditionally, I modified the existing sanity code which asserts that\r\nthe base row is always there to just run when repeatable read is used,\r\nand added an extra check for this case for read uncommitted mode in\r\nwhich case I just throw an error (RAWSTORE_RECORD_VANISHED).  This\r\nshould be very unlikely, but if it happens we have seen that TimeOut\r\nswallows exceptions when building TableNameInfo and prints the lock\r\ntable even without table information, so I think it is ok. We could\r\npossibly catch this exception in hashAllTableDescriptorsByTableId and\r\njust skip that table (which has gone anyway since its schema has\r\ngone...:), but I didn't.\r\n\r\nI also added javadoc to say that only repeatable read (normal case)\r\nand read uncommitted are supported (in the new signatures).\r\n\r\nRe-running tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-06-10T21:02:29.449+0000","updated":"2008-06-10T21:02:29.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12604196","id":"12604196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for the new patch, Dag. Some more comments:\r\n\r\n1) typo in javadoc: SYS:SYSSCHEMAS -> SYS.SYSSCHEMAS (colon -> comma)\r\n\r\n2) Message for SQLState.RAWSTORE_RECORD_VANISHED needs a parameter (recordName)\r\n\r\n3) In the code below, couldn't the nested if statements be combined into a single one? Then the debug code doesn't have to be reindented.\r\n+\t\t\t\tif (! base_row_exists) {\r\n+\t\t\t\t\tif (isolationLevel ==\r\n+\t\t\t\t\t\t\tTransactionController.ISOLATION_REPEATABLE_READ) {\r\n--> if (!base_row_exists && isolationLevel == ...)\r\n\r\n4) I don't know the store API well enough to say whether the code is correct or not, but isn't there a risk in getDescriptorViaIndexMinion() that heapCC.fetch() reads the wrong row, as the row isn't protected by a lock between retrieving the row location from the index and actually reading the value?\r\n\r\n5) If getDescriptorViaIndex() only supports repeatable read and read uncommitted, should it have an assert so that no one accidentally calls it with another isolation level?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-06-11T12:17:13.277+0000","updated":"2008-06-11T12:17:13.277+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12604300","id":"12604300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for your comment, Knut Anders.\r\nA new version of the patch, #3, addresses all your comments so:\r\n\r\n1) Typo fixed\r\n2) Moved away from throwing the vanished exception, I just return an empty descriptor.\r\n    I tried this by simulating that the base row had gone and the diagnostics printed ok.\r\n    Please see the new comment in the code. \r\n3) Done\r\n4) I think this can only happen is a compress managed to squeeze in between the \r\n    reading of the index row adn the base row; as far as i remember the row location \r\n    is not reused until a compress happens...\r\n5) Added sanity checks.\r\n\r\nRe-running regression tests \r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-06-11T18:28:00.177+0000","updated":"2008-06-11T18:28:00.177+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12604313","id":"12604313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks again, Dag!\r\n\r\nI guess you're right that the problem is limited to concurrent compress of SYS.SYSSCHEMAS and is not very likely, nor very harmful given that this code is only used for diagnostics. Great that you added a comment about this in the code! I have no more comments to the latest patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-06-11T19:37:02.053+0000","updated":"2008-06-11T19:37:02.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12396285/comment/12604381","id":"12604381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Patch derby-3678-3 committed as svn 666901, resolving.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-06-11T23:43:56.369+0000","updated":"2008-06-11T23:43:56.369+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3678/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06vtb:"}}