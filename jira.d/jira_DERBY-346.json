{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12311251","self":"https://issues.apache.org/jira/rest/api/latest/issue/12311251","key":"DERBY-346","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/3","id":"3","description":"The problem is a duplicate of an existing issue.","name":"Duplicate"},"customfield_12310220":null,"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21910","customfield_12310222":"1_*:*_1_*:*_1039085000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_29000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2005-06-23T03:16:42.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-346/watchers","watchCount":0,"isWatching":false},"created":"2005-06-11T02:38:37.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12310266","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12310266","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"27488","key":"DERBY-8","self":"https://issues.apache.org/jira/rest/api/2/issue/27488","fields":{"summary":"Connection object gets created with un-supported holdability on getting Connection object from XAConnection \"inside\" the global transaction","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-06-23T03:17:11.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11690","id":"11690","name":"Network Client"}],"timeoriginalestimate":null,"description":"Running jdbcapi/xaSimplePositive.sql with network client  causes  an error  in the last case:\n\nCannot set holdability ResultSet.HOLD_CURSORS_OVER_COMMIT for a global transaction.\n\nThe trace on the client is:\nij(XA)> select * from APP.global_xactTable where gxid is not null order by gxid;\nERROR XJ05C: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ05C, SQLERRMC: XJ05C.S\norg.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ05C, SQLERRMC: XJ05C.S\n\tat org.apache.derby.client.am.Statement.completeSqlca(Statement.java:1354)\n\tat org.apache.derby.client.am.Statement.completeOpenQuery(Statement.java:1025)\n\tat org.apache.derby.client.net.NetStatementReply.parseOpenQueryFailure(NetStatementReply.java:503)\n\tat org.apache.derby.client.net.NetStatementReply.parseOPNQRYreply(NetStatementReply.java:226)\n\tat org.apache.derby.client.net.NetStatementReply.readOpenQuery(NetStatementReply.java:56)\n\tat org.apache.derby.client.net.StatementReply.readOpenQuery(StatementReply.java:49)\n\tat org.apache.derby.client.net.NetStatement.readOpenQuery_(NetStatement.java:151)\n\tat org.apache.derby.client.am.Statement.readOpenQuery(Statement.java:1021)\n\tat org.apache.derby.client.am.Statement.flowExecute(Statement.java:1556)\n\tat org.apache.derby.client.am.Statement.executeX(Statement.java:631)\n\tat org.apache.derby.client.am.Statement.execute(Statement.java:622)\n\tat org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:299)\n\tat org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:433)\n\tat org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:312)\n\tat org.apache.derby.impl.tools.ij.Main.go(Main.java:203)\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)\n\tat org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)\n\tat org.apache.derby.tools.ij.main(ij.java:60)\n\n\nOn the server, the trace is:\n\nCannot set holdability ResultSet.HOLD_CURSORS_OVER_COMMIT for a global transaction.\nSQL Exception: Cannot set holdability ResultSet.HOLD_CURSORS_OVER_COMMIT for a global transaction.\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:79)\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:96)\n\tat org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:160)\n\tat org.apache.derby.jdbc.EmbedXAConnection.checkHoldCursors(EmbedXAConnection.java:712)\n\tat org.apache.derby.jdbc.XAStatementControl.checkHoldCursors(XAStatementControl.java:193)\n\tat org.apache.derby.iapi.jdbc.BrokeredPreparedStatement.execute(BrokeredPreparedStatement.java:426)\n\tat org.apache.derby.impl.drda.DRDAStatement.execute(DRDAStatement.java:548)\n\tat org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTT(DRDAConnThread.java:3533)\n\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:871)\n\tat org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:226)\nhandle SQLException here\n\n\nI have been trying to get the jdbcapi/xaSimplePostive.sql test running with network client.  The changes for  DERBY -246 and DERBY-339  allow all but the last case in xaSimplePositve to pass.   Unfortunately I have not  yet been able  to strip down the test to get a smaller reproducable case.  \n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40934","summary":"running jdbcapi/xaSimplePostive.sql under the DerbyNetClient framework gives   error \"Cannot set holdability ResultSet.HOLD_CURSORS_OVER_COMMIT for a global transaction.\"","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311251/comment/12313336","id":"12313336","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"This patch changes Network Server to pass the holdability to the prepare method of BrokeredConnection30 when running under JDK14. \r\nIt also adds the jdbcapi/xaSimplePositive.sql test to the derbynetclientmats test suite.  The netxapositive test has been removed as it was a subset of \r\nxaSimplePositive.\r\n\r\nNote:It seems that under JDK13 the default holdability for BrokeredConnections in global transactions is  consistently, CLOSE_CURSORS_AT_COMMIT, but for JDK141,  the default holdability is sometimes set to HOLD_CURSORS_OVER_COMMIT. \r\n\r\nRan  jdbcapi/xaSimplePositive.sql test under JDK131 and JDK142 as well as derbyentclientmats.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-06-11T08:04:24.000+0000","updated":"2005-06-11T08:04:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311251/comment/12313654","id":"12313654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Mamta posted this summary of   holdability behaviour for use in debugging this issue.  Client should match the embedded behaviour.\r\n\r\n\r\nJust to summarize, the holdability table will look the same for EmbedConnection as well as BrokeredConnection.\r\n \r\n                        Global Transaction                             Local Transaction\r\nJDK13    CLOSE_CURSORS_AT_COMMIT        conn holdability (Default HOLD_CURSORS_OVER_COMMIT)\r\nJDK14+   CLOSE_CURSORS_AT_COMMIT       conn holdability (Default HOLD_CURSORS_OVER_COMMIT)\r\n \r\nA Connection object will have it's holdability set to default which is HOLD_CURSORS_OVER_COMMIT. When the connection joins a global transaction, the holdability will get switched internally to CLOSE_CURSORS_AT_COMMIT. When the connection leaves the global transaction and becomes part of local transaction, the holdability is restored to what it was before entering the global transaction. It works this way in both jdk13 and jdk14+. One thing to keep in mind is that PreparedStatement get the holdability from where they are prepared and not where they are executed,\r\n\r\n for instance,\r\nStart Local Transaction\r\nConnection holdability (default - HOLD_CURSORS_OVER_COMMIT)\r\nPreparedStatement (holdability will be HOLD_CURSORS_OVER_COMMIT)\r\nResultSet from PreparedStatement will have holdability as HOLD_CURSORS_OVER_COMMIT\r\nStart Global Transaction\r\nConnection holdability switches to CLOSE_CURSORS_AT_COMMIT\r\nAnother ResultSet from PreparedStatement will attempt to have the preparedStatement's holdability and that will cause exception because Global transactions do not support holdable cursors.\r\nExit Global Transaction and become part of Local Transaction\r\nConnection holdability back to HOLD_CURSORS_OVER_COMMIT\r\n \r\nI have come across one bug with jdk13 though, where the holdability is not getting restored back to HOLD_CURSORS_OVER_COMMIT when the connection becomes part of local transaction after leaving global transaction. I will enter a JIRA entry for it and start working on it.\r\n \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-06-15T07:58:12.000+0000","updated":"2005-06-15T07:58:12.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311251/comment/12314247","id":"12314247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"This issue was fixed by Mamta's fixes for embedded holdability for DERBY-8 and DERBY-366.\r\n\r\nThe following checkin adds the xaSimplePositive.sql test to the client suite and removes netxaPositve, which was a subset of xaSimplePositive.\r\n\r\nTransmitting file data ...\r\nCommitted revision 192968.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-06-23T03:12:17.000+0000","updated":"2005-06-23T03:12:17.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311251/comment/12314248","id":"12314248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"This issue was fixed with Mamta's fix for DERBY-8 and DERBY366.  I think this one is actually a dup of DERBY-8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-06-23T03:15:15.000+0000","updated":"2005-06-23T03:15:15.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311251/comment/12314250","id":"12314250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Fixed with fix for DERBY-8, DERBY-366","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-06-23T03:16:42.000+0000","updated":"2005-06-23T03:16:42.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-346/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07ddr:"}}