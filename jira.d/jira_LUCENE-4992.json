{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12646841","self":"https://issues.apache.org/jira/rest/api/latest/issue/12646841","key":"LUCENE-4992","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324323","id":"12324323","description":"Major release after 4.3","name":"4.4","archived":false,"released":true,"releaseDate":"2013-07-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321663","id":"12321663","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-05-09 19:27:16.926","customfield_12312323":null,"customfield_12310420":"327198","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1066574968_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-05-22T03:38:38.086+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-4992/watchers","watchCount":2,"isWatching":false},"created":"2013-05-09T19:22:23.179+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321140","id":"12321140","description":"Major release after 4.0","name":"4.1","archived":false,"released":true,"releaseDate":"2013-01-22"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-23T18:37:01.003+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310235","id":"12310235","name":"core/search","description":"issues with search code"}],"timeoriginalestimate":null,"description":"Seeing following exception in BooleanScorer2 in our production system:\r\nException in thread \"main\" java.lang.ArrayIndexOutOfBoundsException: 2147483647\r\n\tat org.apache.lucene.search.BooleanScorer2.score(BooleanScorer2.java:312)\r\n\tat org.apache.lucene.queries.CustomScoreQuery$CustomScorer.score(CustomScoreQuery.java:324)\r\n\tat org.apache.lucene.search.DisjunctionMaxScorer.score(DisjunctionMaxScorer.java:84)\r\n\tat org.apache.lucene.search.TopScoreDocCollector$InOrderTopScoreDocCollector.collect(TopScoreDocCollector.java:47)\r\n\tat org.apache.lucene.search.Scorer.score(Scorer.java:64)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:605)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:482)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:438)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\r\n\t","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10121","value":"New","id":"10121"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10120","value":"Patch Available","id":"10120"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"327542","summary":"ArrayOutOfBoundsException in BooleanScorer2","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":20,"total":20,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13653074","id":"13653074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"in DisjunctionSumScorer, line 96:\r\n\r\nprivate void afterNext() throws IOException {\r\nfinal Scorer sub = subScorers[0];\r\ndoc = sub.docID();\r\nif (doc == NO_MORE_DOCS)\r\n{ nrMatchers = Integer.MAX_VALUE; // stop looping <--- this is set }\r\n\r\nelse\r\n{ score = sub.score(); nrMatchers = 1; countMatches(1); countMatches(2); }\r\n\r\n}\r\n\r\nand in BooleanScorer2, line 167:\r\ncoordinator.nrMatchers += super.nrMatchers;\r\n\r\nand then it breaks on line 312.\r\n\r\nAttached is a patch. \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-09T19:23:06.855+0000","updated":"2013-05-09T19:23:06.855+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13653079","id":"13653079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"Do you have a test John? its not clear that the maybe the problem is calling score() on a scorer that already returned NO_MORE_DOCS (which is undefined)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-05-09T19:27:16.926+0000","updated":"2013-05-09T19:27:16.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13653083","id":"13653083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"Hi Rob:\r\n\r\n   I do have a test that reproduces this and with the patch it is fixed. (I also made sure all tests pass in lucene)\r\n\r\n   Unfortunately this is very difficult to reproduce. I was only able to reproduce it with our in house query builder and data corpus.\r\n\r\n-John","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-09T19:34:01.825+0000","updated":"2013-05-09T19:34:01.825+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13653084","id":"13653084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"re: its not clear that the maybe the problem is calling score() on a scorer that already returned NO_MORE_DOCS (which is undefined)\r\n\r\nI stepped thru my test program and that is exactly what is happening.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-09T19:34:40.617+0000","updated":"2013-05-09T19:34:40.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13653096","id":"13653096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"Rob, I dug into the code a little more, seems like the better fix would be in CustomScoreQuery, line 309:\r\n\r\nvalSrcScorer.advance(doc);\r\n\r\nwhat I am finding is that valSrcScorer impl when advance is called, can set the inner docid to NO_MORE_DOCS but that is not retrieved, and instead the doc returned previously from subQueryScorer is used.\r\n\r\nBy changing the line to:\r\ndoc = valSrcScorer.advance(doc);\r\n\r\nalso fixes the problem. I am not sure if that is the right thing to do though.\r\n\r\n-John","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-09T19:45:49.935+0000","updated":"2013-05-09T19:45:49.935+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13653099","id":"13653099","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"Forgot to mention, in my test, the valSrcScorer is an instance of BooleanScorer2.\r\n\r\n-John","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-09T19:47:18.480+0000","updated":"2013-05-09T19:47:18.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13653107","id":"13653107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"I'll review CustomScoreQuery and see if its doing the right thing: its definitely possible its doing the wrong thing. Thanks for reporting this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-05-09T19:51:27.188+0000","updated":"2013-05-09T19:51:27.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13654749","id":"13654749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"John I see: so I think the whole design of this thing doesnt work today for your use case (where valSrcScorer is BooleanScorer2).\r\n\r\nIt seems implicit in this CustomScoreQuery's implementation that the value source scorers will match all documents, yet nothing about the API enforces this, instead it takes arbitrary Query (but won't actually work correctly today with arbitrary queries!):\r\n\r\n{code}\r\n  public CustomScoreQuery(Query subQuery, Query... scoringQueries) {\r\n{code}\r\n\r\nI feel like one of three things should happen:\r\n1. Change behavior of CustomScoreQuery to act more conjunction-like as you suggest. Though this means this query would be doing a significantly different thing than its current javadocs describe.\r\n2. Keep the behavior of today, except add NO_MORE_DOCS checks. But this can be confusing too, e.g. what would vScores[i] contain for an exhausted valSrcScorer? \r\n2. Current behavior, but scoringQueries changed to *FunctionQuery* to be type-safe.\r\n\r\nAny ideas?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-05-10T19:13:51.949+0000","updated":"2013-05-10T19:13:51.949+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13654822","id":"13654822","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"Thanks Rob for following up!\r\nI think the right thing to do would be the third option, that is the least intrusive while keeping the functionality consistent. And you are absolutely right, by doing the hacks I am suggesting would provide unexpected behavior, which would be worse.\r\nI will follow up on my end to make sure we would be ok with this change.\r\n\r\n-John","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-10T20:53:19.984+0000","updated":"2013-05-10T20:53:19.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13654837","id":"13654837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"Another nice thing about the last approach (actually, you can do it today to fix your bug), is that you can always pass an arbitrary query anyway:\r\n\r\nnew FunctionQuery(new QueryValueSource(MyBooleanQueryOrWhatever, 5.0f))\r\n\r\nThe QueryValueSource has that additional argument that lets you specify what the score (in this example: 5.0f) should be for documents that don't match, so it removes any ambiguity.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-05-10T21:07:54.638+0000","updated":"2013-05-10T21:07:54.638+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13654857","id":"13654857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"Oh! that's nice!\r\nWe will just do that!\r\n\r\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-10T21:21:11.292+0000","updated":"2013-05-10T21:21:11.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13654940","id":"13654940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"Hey Rob:\r\n\r\n    Just verified your suggestion works in our env.\r\n\r\n    Feel free to resolve this.\r\n\r\n-john","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-10T22:31:45.015+0000","updated":"2013-05-10T22:31:45.015+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13655320","id":"13655320","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"Here's a patch to change the signature to FunctionQuery to prevent the trap.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-05-11T17:29:44.753+0000","updated":"2013-05-11T17:29:44.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13655463","id":"13655463","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"Thanks Rob for the patch!\r\nThis makes the api much safer.\r\n\r\nI am inclined to think option 2) above with the NO_MORE_DOCS check is a still good thing to do for BooleanScorer2 (unrelated to CustomScoreQuery).\r\n\r\nWhat do you think?\r\n\r\n=John","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-12T04:25:59.957+0000","updated":"2013-05-12T04:25:59.957+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13655473","id":"13655473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"I dont think we should add this check (because only broken consumers would trigger it).\r\n\r\nMaybe an assert is ok though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-05-12T05:47:48.066+0000","updated":"2013-05-12T05:47:48.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13655478","id":"13655478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"body":"makes senses, agreed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=john.wang%40gmail.com","name":"john.wang@gmail.com","emailAddress":"john dot wang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Wang","active":true},"created":"2013-05-12T06:25:36.728+0000","updated":"2013-05-12T06:25:36.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13663726","id":"13663726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[trunk commit] rmuir\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1485040\r\n\r\nLUCENE-4992: CustomScoreQuery does not work with arbitrary queries: scoringQueries must match every document","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-05-22T03:35:22.450+0000","updated":"2013-05-22T03:35:22.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13663727","id":"13663727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[branch_4x commit] rmuir\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1485041\r\n\r\nLUCENE-4992: CustomScoreQuery does not work with arbitrary queries: scoringQueries must match every document","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-05-22T03:37:59.992+0000","updated":"2013-05-22T03:37:59.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13663728","id":"13663728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"I committed this: thanks for reporting this John!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-05-22T03:38:38.102+0000","updated":"2013-05-22T03:38:38.102+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12646841/comment/13716718","id":"13716718","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"body":"Bulk close resolved 4.4 issues","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"created":"2013-07-23T18:37:01.000+0000","updated":"2013-07-23T18:37:01.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-4992/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1kgdr:"}}