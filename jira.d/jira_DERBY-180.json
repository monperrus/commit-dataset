{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"31143","self":"https://issues.apache.org/jira/rest/api/latest/issue/31143","key":"DERBY-180","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-05-23 18:16:30.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21822","customfield_12310222":"3_*:*_1_*:*_979000_*|*_1_*:*_1_*:*_5865235000_*|*_6_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2005-06-01T03:38:00.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-180/watchers","watchCount":0,"isWatching":false},"created":"2005-03-25T06:07:46.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10920","id":"10920","description":"initial source drop","name":"10.0.2.0","archived":false,"released":true,"releaseDate":"2004-08-30"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-06-01T03:38:00.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"In the messages_en.properties file, there are two items that are similar:\n\nXCL47.S=Use of ''{0}'' requires database to be upgraded from version {1} to version {2} or later.\nXCL478.S=The requested function can not reference tables in SESSION schema.\n\nSQLSTATEs are supposed to be 5 characters long. When I issue a CREATE VIEW on a SESSION table, I receive the proper error message:\n\nij> declare global temporary table x (a int) not logged;\n0 rows inserted/updated/deleted\nij> create view z as (select * from session.x);\nERROR XCL47: The requested function can not reference tables in SESSION schema.\n\nSo, was XCL478 truncated to XCL47? Does this mean that if I tried to do something that invokes the other version of XCL47 that I will get the wrong message? I suspect one of the message numbers needs to be changed and that the SQL error be fixed to be 5 characters long instead of 6.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"41008","summary":"XCL47 SQLState duplicated in messages_en.properties?","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=baklarz","name":"baklarz","emailAddress":"baklarz at ca dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Baklarz","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=baklarz","name":"baklarz","emailAddress":"baklarz at ca dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"George Baklarz","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Windows XP SP1 Professional","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":4,"total":4,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/31143/comment/66053","id":"66053","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Yes the messageId was truncated. I think you will get the correct message, because the full messageId is stored in the \r\nException object. getSQLState() will only return a string made up of the first 5 characters. getMessageId() (not a part of \r\nSQLException, but found in EmbedSQLException) will return the full string, including \".S\".\r\n\r\nI haven't figured out how ij finds the string to print, but by modifying SimpleApp.java (renamed Try.java) to trigger your exception you can see the that the full string is in the exception thrwon:\r\n\r\n dt136804@atum10~/java$ java -classpath $(find-jars.sh ~/derbyjars):. Try\r\nTry starting in embedded mode.\r\nLoaded the appropriate driver.\r\nConnected to and created database derbyDB\r\nCreated table derbyDB\r\nInserted 1956 Webster\r\nInserted 1910 Union\r\nUpdated 1956 Webster to 180 Grand\r\nUpdated 180 Grand to 300 Lakeshore\r\nVerified the rows\r\n Venturing into unknown territory...\r\nexception thrown:\r\nSQL Exception: The requested function can not reference tables in SESSION schema.\r\nSQLState: XCL47 MessageId: XCL478.S\r\n--> note the difference between SQLState and MessageId\r\n\r\nERROR XCL47: The requested function can not reference tables in SESSION schema.\r\n--> This looks very much like the string printed by ij, but I don't know if printStackTrace and ij use a common function --> for this\r\n \r\n       at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:301)\r\n        at org.apache.derby.impl.sql.compile.CreateViewNode.bindViewDefinition(CreateViewNode.java:281)\r\n        at org.apache.derby.impl.sql.compile.CreateViewNode.bind(CreateViewNode.java:184)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:332)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:107)\r\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:688)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:501)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:475)\r\n        at Try.go(Try.java:162)\r\n        at Try.main(Try.java:64)\r\nnull\r\nTry finished\r\n\r\nI think you're right about the MessageId for XCL478 being too long. I tried to use svn blame to see when this was done\r\n(and perhaps why), but it looks like this was inherited from Cloudscape. From what I could see, there are only about 50 other XCLxx messages, so it should be easy to find a unique id. \r\n\r\nOf course, changing error codes/ids is dangerous, since you risk breaking existing client code that relies on the old (incorrect) behavior. Maybe some of the Derby/Cloudscape gurus can shed some more light on this?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2005-05-23T18:16:30.000+0000","updated":"2005-05-23T18:16:30.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31143/comment/66066","id":"66066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"It seems to me that the MessageId XCL478 may have been an oversight when it was picked up to be 6 characters in length.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2005-05-24T00:26:18.000+0000","updated":"2005-05-24T00:26:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31143/comment/66647","id":"66647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"attaching patch previously submitted to derby-dev","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2005-06-01T03:22:20.000+0000","updated":"2005-06-01T03:22:20.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31143/comment/66650","id":"66650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Committed, revision 179260.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2005-06-01T03:38:00.000+0000","updated":"2005-06-01T03:38:00.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-180/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07du7:"}}