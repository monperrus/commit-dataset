{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12357596","self":"https://issues.apache.org/jira/rest/api/latest/issue/12357596","key":"DERBY-2141","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313478","id":"12313478","description":"Head of 10.1 branch. Maintenance version bump for sps update ","name":"10.1.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312251","id":"12312251","description":"Head of 10.2 branch","name":"10.2.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-05-06 15:13:16.668","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22907","customfield_12310222":"1_*:*_1_*:*_13629442036_*|*_6_*:*_2_*:*_175102403659_*|*_5_*:*_2_*:*_3319087798_*|*_4_*:*_2_*:*_484670548","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-01-09T20:57:04.987+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2141/watchers","watchCount":1,"isWatching":false},"created":"2006-12-04T10:50:21.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12319994","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12319994","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12393006","key":"DERBY-3591","self":"https://issues.apache.org/jira/rest/api/2/issue/12393006","fields":{"summary":"Cleanup action starting Failed Statement is: null  Less severe exception raised during cleanup (ignored) An exception was thrown during transaction abort.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:27:18.648+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"Seen in the nightly regression tests:\nhttp://dbtg.thresher.com/derby/test/Daily/jvm1.6/testing/testlog/lin/481811-org.apache.derbyTesting.functionTests.suites.All_diff.txt\nhttp://dbtg.thresher.com/derby/test/Daily/jvm1.6/testing/testlog/lin/480626-org.apache.derbyTesting.functionTests.suites.All_diff.txt","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39046","summary":"BlobClob4BlobTest.testPositionBlob() fails with NullPointerException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Java SE 6, Java SE 5.0 (less frequently). Linux and Solaris.","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":23,"total":23,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12468594","id":"12468594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"This only seems to happen with jdk6. It also happens with other test methods, for instance testPositionBytes(). http://dbtg.thresher.com/derby/test/Daily/jvm1.6/testing/testlog/lin/498143-suitesAll_diff.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-01-30T12:35:41.583+0000","updated":"2007-01-30T12:35:41.583+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12468595","id":"12468595","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"When this error happens, we don't get the stack trace of the original exception. Instead, we get something like:\r\n\r\nCaused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\r\n\t... 44 more\r\n\r\nThe attached patch makes the SQLExceptionFactory for the JDBC 4.0 driver preserve the stack trace of the original exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-01-30T12:46:31.572+0000","updated":"2007-01-30T12:46:31.572+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12468597","id":"12468597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed stacktrace.diff with revision 501392 so we can see where the NullPointerException is thrown the next time it happens.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-01-30T12:53:21.347+0000","updated":"2007-01-30T12:53:21.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12469228","id":"12469228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"And now we have a stack trace. http://dbtg.thresher.com/derby/test/Daily/jvm1.6/testing/testlog/lin/501472-suitesAll_diff.txt\r\n\r\nCaused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\r\n\tat org.apache.derby.impl.store.raw.data.BaseContainerHandle.close(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.BaseContainerHandle.update(Unknown Source)\r\n\tat java.util.Observable.notifyObservers(Observable.java:142)\r\n\tat org.apache.derby.iapi.store.raw.xact.RawTransaction.notifyObservers(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.dropContainer(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.xact.Xact.dropContainer(Unknown Source)\r\n\tat org.apache.derby.impl.store.access.heap.Heap.drop(Unknown Source)\r\n\tat org.apache.derby.impl.store.access.RAMTransaction.dropConglomerate(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.DropTableConstantAction.executeConstantAction(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\r\n\t... 36 more","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-01-31T22:29:04.214+0000","updated":"2007-01-31T22:29:04.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12469230","id":"12469230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The stack trace is identical to the first error in http://dbtg.thresher.com/derby/test/Daily/jvm1.5/testing/testlog/sles/490538-suitesAll_diff.txt (error in testClobFinalizer()), so the problem is not limited to JDK6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-01-31T22:32:21.041+0000","updated":"2007-01-31T22:32:21.041+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12471227","id":"12471227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The tinderbox showed another NullPointerException in BlobClob4BlobTest, but this time in client/server mode:\r\n\r\nhttp://dbtg.thresher.com/derby/test/tinderbox_trunk16/jvm1.6/testing/Limited/testSummary-504740.html\r\n\r\n2) testBlobAfterClosingConnection(org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest)java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerExceptionXJ001.U\r\n\tat org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source)\r\n\tat org.apache.derby.client.am.SqlException.getSQLException(Unknown Source)\r\n\tat org.apache.derby.client.am.Connection.rollback(Unknown Source)\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.rollback(BaseJDBCTestCase.java:172)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest.testBlobAfterClosingConnection(BlobClob4BlobTest.java:2278)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:76)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\nCaused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerExceptionXJ001.U\r\n\tat org.apache.derby.client.am.Connection.completeSqlca(Unknown Source)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseRDBRLLBCKreply(Unknown Source)\r\n\tat org.apache.derby.client.net.NetConnectionReply.readLocalRollback(Unknown Source)\r\n\tat org.apache.derby.client.net.ConnectionReply.readLocalRollback(Unknown Source)\r\n\tat org.apache.derby.client.net.NetConnection.readLocalRollback_(Unknown Source)\r\n\tat org.apache.derby.client.am.Connection.readRollback(Unknown Source)\r\n\tat org.apache.derby.client.am.Connection.flowRollback(Unknown Source)\r\n\t... 43 more","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-02-08T08:47:51.966+0000","updated":"2007-02-08T08:47:51.966+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12493928","id":"12493928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I think these errors are caused by the lack of synchronization between the finalization thread and the user thread. For LOBs that are not materialized in memory, the finalizers of EmbedBlob and EmbedClob call OverflowInputStream.closeStream() which again calls BaseContainerHandle.close(). Since the finalization thread doesn't synchronize on the connection synchronization object, the user thread and the finalization thread might run BaseContainerHandle.close() concurrently on the same object.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-05-06T14:37:11.309+0000","updated":"2007-05-06T14:37:11.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12493931","id":"12493931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I don't know if this is the bug, but I think you are right about OverflowInputStream.  Most of store doesn't require synchronization as it assumes single thread access to it's objects as controlled by the derby's jdbc level which only allows one thread into a given\r\nxact at the same time.\r\n\r\nBut, OverflowInputStream is handed back to the caller and then can be accessed outside of jdbc.  Does jdbc say anything about\r\ncallers responsibility regarding multi-thread access to a stream handed back through jdbc?  Seems safer if possible to just\r\ncorrectly synchronize OverflowInputStream, but this will add some overhead to the streams coming out of the server.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-05-06T15:13:16.668+0000","updated":"2007-05-06T15:13:16.668+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12493932","id":"12493932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"before adding the synchonization, what effect will that have on possible finalizer/synchronization deadlock?  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-05-06T15:31:26.523+0000","updated":"2007-05-06T15:31:26.523+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12493933","id":"12493933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I am raising priority of this issue.  Anything that causes 58 errors in the nightly regression test may cause problems for\r\nall developers on the project.  At the very least lost time in trying to figure out if they caused the issue or not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-05-06T15:34:15.143+0000","updated":"2007-05-06T15:34:15.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12493935","id":"12493935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I don't think synchronizing on the OverflowInputStream solves this problem since only one of the threads access the BaseContainerHandle through the stream. To me it seems like this is what happens (T1 == main thread, T2 == finalization):\r\n\r\n  T1_1: An unmaterialized lob object is obtained by the test method.\r\n  T1_2: The test method returns, and the lob is no longer referenced and is free to be garbage collected.\r\n  T1_3: tearDown() calls rollback() which drops the table containing the lob and and the base container handle is notified and closed.\r\n  T2_1: [BC]lob.finalize() calls OverflowInputStream.closeStream() which calls BaseContainerHandle.close().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-05-06T15:42:37.144+0000","updated":"2007-05-06T15:42:37.144+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12493936","id":"12493936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"> before adding the synchonization, what effect will that have on possible finalizer/synchronization deadlock?\r\n\r\nDepends on what we synchronize on. If we synchronize on the connection sync object, it could definitely lead to deadlocks since we sometimes call System.runFinalization() while holding the monitor on the object. Having a synchronized flag or something locally in BaseContainerHandle that only prevented threads to enter close() concurrently would be safe, I think.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-05-06T15:48:40.083+0000","updated":"2007-05-06T15:48:40.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12493937","id":"12493937","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"BaseContainerHandle.close() already has some synchronized calls.\r\n\r\n  - informObservers() calls the synchronized methods countObservers(), setChanged() and notifyObservers() which are inherited from java.util.Observable.\r\n  - getLockingPolicy().unlockContainer(xact, this) will synchronize on objects in the lock manager.\r\n  - xact.deleteObserver(this) is actually a synchronized call to Observable.deleteObserver().\r\n\r\nSo perhaps putting this code first in close() wouldn't be too expensive in comparison:\r\n\r\n  synchronized (this) {\r\n    if (!active) return;\r\n    active = false;\r\n  }\r\n\r\nIt would at least not introduce a risk of deadlock since the method already (implicitly) synchronizes on this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-05-06T16:26:57.444+0000","updated":"2007-05-06T16:26:57.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12494810","id":"12494810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"As you point out, performance of close may not be much of an issue.  I was taking the leap that there may be more problems\r\nwith OverflowInputStream than close.  I am just not sure if it is our job or the calling code to fix them.  Should we prevent a \r\nclient jdbc app from calling any interface on a single OverflowInputStream from 2 threads at the same time (for example read)?  \r\n\r\nAlso  I don't understand the issue enough, does this fix have to happen in BaseContainerHandle?  It seems reasonable to add\r\nextra synchronization to OverflowInputStream as we hand that out of the jdbc layer to direct callers, but if we start changing  the\r\nclasses only indirectly called I think we may not know where to stop.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-05-10T18:14:19.367+0000","updated":"2007-05-10T18:14:19.367+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12494823","id":"12494823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"Anyone see a problem with just syncronizing the BaseContainerHandle.close() method.  I don't think the suggested code with active works as it looks like there is a path through the code where active is false but we still need to do some work (the open container for lock only path still needs to unlock ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-05-10T19:40:53.038+0000","updated":"2007-05-10T19:40:53.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12494954","id":"12494954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I am hoping the following checkin fixes this issue.  I was not actually able to reproduce the timing on my single processor machine.\r\nIf anyone else see's the problem in a codeline build after this checkin please go ahead and reopen the issue.\r\n\r\ndescription:\r\nDERBY-2141\r\n\r\nMade BaseContainerHandle.close() synchronized as it may be called concurrently\r\nby a stream passed outside the store and an abort triggered concurrently.\r\nMaking it synchronized will allow the first close to do the proper work and\r\nthe subsequent calls will just return with no work to do.\r\nAlso made some of the fields private to convince myself no-one outside the\r\nclass was counting on something being changed during close.\r\n\r\nActual commit:\r\nm1_ibm15:38>svn commit\r\n\r\nSending        java\\engine\\org\\apache\\derby\\impl\\store\\raw\\data\\BaseContainerHandle.java\r\nSending        java\\engine\\org\\apache\\derby\\impl\\store\\raw\\data\\D_BaseContainerHandle.java\r\nTransmitting file data ..\r\nCommitted revision 537091.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-05-11T04:47:43.021+0000","updated":"2007-05-11T04:47:43.021+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12590634","id":"12590634","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mkutty","name":"mkutty","emailAddress":"mkutty at remulak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manjula Kutty","active":true},"body":"Found this error with weme6.1 on trunk\r\nHere is the stack trace\r\n\r\ntestRetrieveMoreThan32KLobs(sts.tests.jdbcapi.BlobClob4BlobTest)java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Soorg.apache.derbyTesting.functionTeurce)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.commit(Unknown Source)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest.testRetrieveMoreThan32KLobs(BlobClob4BlobTest.java:3424)\r\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\r\n\tat <unknown class>.<unknown method>(Unknown Source)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:103)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.clearLOBMapping(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.commit(Unknown Source)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest.testRetrieveMoreThan32KLobs(BlobClob4BlobTest.java:3424)\r\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\r\n\t... 30 more\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mkutty","name":"mkutty","emailAddress":"mkutty at remulak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Manjula Kutty","active":true},"created":"2008-04-18T22:37:29.380+0000","updated":"2008-04-18T22:37:29.380+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12590725","id":"12590725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"That's a different NPE than the one reported in this issue, so I suggest that a new bug report is filed. The NPE reported here was thrown by BaseContainerHandle.close(), whereas the new NPE is thrown by EmbedConnection.clearLOBMapping().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-04-19T22:07:10.332+0000","updated":"2008-04-19T22:07:10.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12722396","id":"12722396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I just saw the NPE Manjula described (in clearLOBMapping) on 10.5 with weme6.1.  I am wondering if there was ever an issue filed.  I don't see one immediately on searching Jira.  Here is the trace from derby.log:\r\n\r\n), (DATABASE = wombat), (DRDAID = null), Cleanup action starting\r\n\r\n2009-06-20 03:21:13.484 GMT Thread[main,5,main] (XID = 351920), (SESSIONID = 117), (DATABASE = wombat), (DRDAID = null), Failed Statement is: null\r\n\r\njava.lang.NullPointerException\r\n\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.clearLOBMapping(Unknown Source)\r\n\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.commit(Unknown Source)\r\n\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbcapi.BlobClob4BlobTest.testRetrieveMoreThan32KLobs(BlobClob4BlobTest.java:3498)\r\n\r\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\r\n\r\n\tat java.lang.reflect.Method.invoke(Method.java:253)\r\n\r\n\tat junit.framework.TestCase.runTest(TestCase.java:154)\r\n\r\n\tat junit.framework.TestCase.runBare(TestCase.java:127)\r\n\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:106)\r\n\r\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\r\n\r\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\r\n\r\n\tat junit.framework.TestResult.run(TestResult.java:109)\r\n\r\n\tat junit.framework.TestCase.run(TestCase.java:118)\r\n\r\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n\r\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\r\n\r\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n\r\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\r\n\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\r\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\r\n\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\r\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\r\n\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\r\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n\r\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\r\n\r\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n\r\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\r\n\r\n\tat junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n\r\n\tat junit.framework.TestSuite.run(TestSuite.java:203)\r\n\r\n\tat junit.textui.TestRunner.doRun(TestRunner.java:116)\r\n\r\n\tat junit.textui.TestRunner.start(TestRunner.java:172)\r\n\r\n\tat junit.textui.TestRunner.main(TestRunner.java:138)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-06-21T18:12:23.171+0000","updated":"2009-06-21T18:12:23.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/12722397","id":"12722397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"That exception looks similar to DERBY-4261.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-06-21T18:22:35.056+0000","updated":"2009-06-21T18:22:35.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/13544591","id":"13544591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Reopen for 10.1 backport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-01-05T05:48:55.458+0000","updated":"2013-01-05T05:48:55.458+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/13546290","id":"13546290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Date: Mon Jan  7 17:24:11 2013\r\nNew Revision: 1429912\r\nFixed in 10.1 and 10.2\r\n\r\nURL: http://svn.apache.org/viewvc?rev=1429912&view=rev\r\nLog:\r\nDERBY-2141  BlobClob4BlobTest.testPositionBlob() fails with NullPointerException\r\n\r\n\r\n\r\nModified:\r\n    db/derby/code/branches/10.1/   (props changed)\r\n    db/derby/code/branches/10.1/java/engine/org/apache/derby/impl/store/raw/data/BaseContainerHandle.java\r\n    db/derby/code/branches/10.1/java/engine/org/apache/derby/impl/store/raw/data/D_BaseContainerHandle.java\r\n\r\n\r\nDate: Mon Jan  7 21:28:03 2013\r\nNew Revision: 1430021\r\n\r\nURL: http://svn.apache.org/viewvc?rev=1430021&view=rev\r\nLog:\r\nDERBY-2141  BlobClob4BlobTest.testPositionBlob() fails with NullPointerException\r\n\r\n\r\nModified:\r\n    db/derby/code/branches/10.2/   (props changed)\r\n    db/derby/code/branches/10.2/java/engine/org/apache/derby/impl/store/raw/data/BaseContainerHandle.java\r\n    db/derby/code/branches/10.2/java/engine/org/apache/derby/impl/store/raw/data/D_BaseContainerHandle.java\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-01-07T21:37:33.363+0000","updated":"2013-01-07T21:37:33.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357596/comment/13548992","id":"13548992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Merged to 10.1 and 10.2\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-01-09T20:57:05.015+0000","updated":"2013-01-09T20:57:05.015+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2141/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i071q7:"}}