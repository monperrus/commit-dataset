{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"32326","self":"https://issues.apache.org/jira/rest/api/latest/issue/32326","key":"DERBY-265","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-05-19 14:03:00.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21868","customfield_12310222":"1_*:*_1_*:*_2242258000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_156340000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2005-06-03T06:19:58.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-265/watchers","watchCount":0,"isWatching":false},"created":"2005-05-08T07:29:00.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2005-06-05T01:45:38.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"}],"timeoriginalestimate":null,"description":"problem when retreiving rows with BLOB \nvalues with network server with autocommit on.  The workaround \nwas to turn autocommit off.  The Problem manifested itself with \nthis trace but there was  an underlying NPE in the \nderby.log\njava.lang.NullPointerException\n at com.ibm.db2.jcc.c.md.a(md.java:289)\n at \ncom.ibm.db2.jcc.c.SqlException.getMessage(SqlException.java:194)\n\n at \njava.lang.Throwable.getLocalizedMessage(Throwable.java:266)\n at java.lang.Throwable.toString(Throwable.java:343)\n at java.lang.String.valueOf(String.java:2131)\n at java.io.PrintStream.print(PrintStream.java:462)\n at java.io.PrintStream.println(PrintStream.java:599)\n at java.lang.Throwable.printStackTrace(Throwable.java:461)\n at java.lang.Throwable.printStackTrace(Throwable.java:451)\n at temp.CloudscapeTest.<init>(CloudscapeTest.java:28)\n at temp.CloudscapeTest.main(CloudscapeTest.java:92)\n\nWhen run with a SANE Build with the attached repro, the \nderby.log shows this trace.\n}), Committing\n\n2005-02-08 21:19:45.626 GMT Thread[DRDAConnThread_2,5,main] \n(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = \nNF000001.G838-866941820371235014{10}), Executing prepared \nstatement: SELECT \"MAP_ID\", \"MAP_NAME\", \"REGION\", \"AREA\", \n\"PHOTO_FORMAT\", \"PICTURE\" FROM \"MAPS\" :End prepared statement\n\n2005-02-08 21:19:45.686 GMT Thread[DRDAConnThread_2,5,main] \n(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = \nNF000001.G838-866941820371235014{10}), Executing prepared \nstatement: SELECT \"MAP_ID\", \"MAP_NAME\", \"REGION\", \"AREA\", \n\"PHOTO_FORMAT\", \"PICTURE\" FROM \"MAPS\" :End prepared statement\n\n2005-02-08 21:19:45.726 GMT Thread[DRDAConnThread_2,5,main] \n(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = \nNF000001.G838-866941820371235014{10}), Committing\n\n2005-02-08 21:19:45.726 GMT Thread[DRDAConnThread_2,5,main] \n(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = \nNF000001.G838-866941820371235014{10}), Cleanup action starting\n\n2005-02-08 21:19:45.726 GMT Thread[DRDAConnThread_2,5,main] \n(XID = 2845), (SESSIONID = 1), (DATABASE = toursDB), (DRDAID = \nNF000001.G838-866941820371235014{10}), Failed Statement is: \nnull\n\norg.apache.derby.iapi.services.sanity.AssertFailure: ASSERT \nFAILED\n\n\tat \norg.apache.derby.iapi.services.sanity.SanityManager.ASSERT(Sanit\nyManager.java:99)\n\n\tat \norg.apache.derby.impl.store.raw.data.BaseContainerHandle.getTran\nsaction(BaseContainerHandle.java:830)\n\n\tat \norg.apache.derby.impl.store.raw.data.OverflowInputStream.initStr\neam(OverflowInputStream.java:158)\n\n\tat \norg.apache.derby.iapi.services.io.FormatIdInputStream.initStream\n(FormatIdInputStream.java:226)\n\n\tat \norg.apache.derby.impl.jdbc.EmbedBlob.<init>(EmbedBlob.java:12\n8)\n\n\tat \norg.apache.derby.impl.jdbc.EmbedResultSet20.getBlob(EmbedResultS\net20.java:1552)\n\n\tat \norg.apache.derby.impl.drda.DRDAConnThread.writeFDODTA(DRDAConnTh\nread.java:5871)\n\n\tat \norg.apache.derby.impl.drda.DRDAConnThread.writeQRYDTA(DRDAConnTh\nread.java:5754)\n\n\tat \norg.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDACo\nnnThread.java:595)\n\n\tat \norg.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.jav\na:226)\n\nIt seems that network server is somehow closing the resultset \nor committing too early. This problem may be related to DERBY-213\n\n\nThere seem to be some scenario in which Store throws this \nASSERTION instead of the proper user error if the blob is \naccessed outside of the transaction, but we don't have a repro \noutside of network server right now.\n\n\n\nThis occurred with JCC 2.4. I have not tried it with derby client\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40982","summary":"In Network Server retrieving BLOB values with autocommit off causes NullPointerException in INSANE build / AssertFailure in in BaseContainerHandle.getTransaction in SANE Build","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":2,"total":2,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/32326/comment/65738","id":"65738","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"MsgNpe does not have schema details etc. So attaching MsgNpe2.java -  a modified version of MsgNpe, which reproduces the problem mentioned in this bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2005-05-19T14:03:00.000+0000","updated":"2005-05-19T14:03:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32326/comment/66922","id":"66922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"Committed revision 178803.\r\n\r\nFix includes\r\n--    Adds check in  OverflowInputStream.initStream  to see if transaction of the container handle is null and throws a StandardException with SQLState.DATA_CONTAINER_CLOSED\r\n--    And at  the jdbc layer, this exception is wrapped with a user exception with an existing  SQLState XJ073             (SQLState.BLOB_ACCESSED_AFTER_COMMIT) for both getBlob and getClob.\r\nThe error message corresponding to this sqlstate is  \"The data in this Blob or Clob is no longer available. Possible reasons are that its transaction committed, or its  connection closed.\"\r\n--   Removed the ASSERT in BaseContainerHandle.getTransaction() ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2005-06-03T06:19:58.000+0000","updated":"2005-06-03T06:19:58.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-265/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07dof:"}}