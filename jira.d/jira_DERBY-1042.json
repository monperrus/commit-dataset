{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12329400","self":"https://issues.apache.org/jira/rest/api/latest/issue/12329400","key":"DERBY-1042","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-03-10 02:40:00.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22277","customfield_12310222":"1_*:*_1_*:*_1567224000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_32098932039","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-03-14T08:34:57.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1042/watchers","watchCount":0,"isWatching":false},"created":"2006-02-24T05:14:33.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-03-20T20:57:09.034+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"store/OnlineBackupTest3.java hangs.\n\nMore info:\n\nhttp://article.gmane.org/gmane.comp.apache.db.derby.devel/15336\n\nhttp://www.multinet.no/~solberg/public/Apache/DerbyJvm1.4/Limited/testSummary-379835.html [Linux-2.6.14-1.1644 FC4]\n> ERROR XSRS5: Error copying file (during backup) from /export/home/tmp/os136789/testingDerbyJvm1.4/Linux-2.6.14-1.1644_FC4_i686-i686/derbyall/derbyall/storeall/storemore/OnlineBackupTest3/wombat/jar/APP to extinout/onlinebackuptest/wombat/jar/APP.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40158","summary":"store/OnlineBackupTest3.java intermittently hangs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=olesolberg","name":"olesolberg","emailAddress":"Ole dot Solberg at Sun dot COM","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ole Solberg","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=olesolberg","name":"olesolberg","emailAddress":"Ole dot Solberg at Sun dot COM","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ole Solberg","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"OS: Linux RedHat 4(Stentz 2.6.14-1.1644_FC4 i686) - Linux 2.6.14-1.1644_FC4 #1 Sun Nov 27 03:25:11 EST 2005, JVM: Sun Microsystems Inc. 1.4.2_10\nOS: Linux 2.6.13-1.1532_FC4 #1 Thu Oct 20 01:30:08 EDT 2005 i686 i686 i386 GNU/Linux, JVM: Java HotSpot(TM) Client VM (1.4.2_02-b03 mixed mode)","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":2,"total":2,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329400/comment/12369706","id":"12369706","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"I could not reproduce this problem on my machine. By looking at the code I\r\nfound backup is getting unblocked before the post commit work is done. \r\nThis may cause the error that is reported, if the jar files to copied to the\r\nbackup is deleted by the post commit.  Attached patch unblocks the backup\r\nonly after the post commit work that is schedules to run in the same\r\ntransaction is done. While scanning the code for this problem, I also noticed \r\ncouple of other small issues, this patch addresses them also. \r\n\r\n\r\nDERBY-1042:\r\n\r\n-- unblock the backup only after the post commit work to be done on the same\r\n   transaction is complete. \r\n-- when backup is in progress drop stub files are not deleted during\r\n   checkpoint. These are necessary to perform recovery starting from the \r\n   backup checkpoint. \r\n-- synchronized getContaineNames() that gets the containers to be written to\r\n   the backup. This method need to be synchronized so that other privileged\r\n   actions does not run in parallel and vice versa. \r\n \r\n-- Modified the OnlineBackupTest1.java and OnlineBackupTest3.java  tests to\r\n   abort if there is a error during the backup instead of waiting incorrectly\r\n   for the failed backup to complete forever. \r\n\r\n\r\nTESTS : derbyall test suite passed on Windows XP/JDK142\r\n\r\nIt would be great if some can review and commit this patch. \r\n\r\nsvn stat:\r\nM      java\\engine\\org\\apache\\derby\\impl\\store\\raw\\xact\\Xact.java\r\nM      java\\engine\\org\\apache\\derby\\impl\\store\\raw\\log\\LogToFile.java\r\nM      java\\engine\\org\\apache\\derby\\impl\\store\\raw\\data\\BaseDataFileFactory.java\r\n\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\OnlineBackup.java\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\OnlineBackupTest1.java\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\OnlineBackupTest3.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2006-03-10T02:40:00.000+0000","updated":"2006-03-10T02:40:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329400/comment/12369765","id":"12369765","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I tested/reviewed/committed the submitted patch:\r\n\r\nm1_142:70>svn commit\r\n\r\nSending        java\\engine\\org\\apache\\derby\\impl\\store\\raw\\data\\BaseDataFileFact\r\nory.java\r\nSending        java\\engine\\org\\apache\\derby\\impl\\store\\raw\\log\\LogToFile.java\r\nSending        java\\engine\\org\\apache\\derby\\impl\\store\\raw\\xact\\Xact.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\On\r\nlineBackup.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\On\r\nlineBackupTest1.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\On\r\nlineBackupTest3.java\r\nTransmitting file data ......\r\nCommitted revision 384661.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-03-10T09:00:55.000+0000","updated":"2006-03-10T09:00:55.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1042/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i078lb:"}}