{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12497948","self":"https://issues.apache.org/jira/rest/api/latest/issue/12497948","key":"DERBY-5010","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-02-08 12:17:27.625","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24592","customfield_12310222":"1_*:*_1_*:*_12725440815_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-07-05T11:57:34.652+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5010/watchers","watchCount":1,"isWatching":false},"created":"2011-02-08T05:06:53.912+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.png","name":"Trivial","id":"5"},"labels":["derby_backport_reject_10_8"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":3600,"aggregatetimeoriginalestimate":3600,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbrosius%40apache.org","name":"dbrosius@apache.org","emailAddress":"dbrosius at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dbrosius%40apache.org&avatarId=14133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dbrosius%40apache.org&avatarId=14133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dbrosius%40apache.org&avatarId=14133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dbrosius%40apache.org&avatarId=14133"},"displayName":"Dave Brosius","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:19:30.149+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":3600,"description":"code attempts to compare two BaseColumnNodes but doesn't compare the tableName correctly.","customfield_10010":null,"timetracking":{"originalEstimate":"1h","remainingEstimate":"1h","originalEstimateSeconds":3600,"remainingEstimateSeconds":3600},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":3600,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36311","summary":"[patch] bad equivalence check","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbrosius%40apache.org","name":"dbrosius@apache.org","emailAddress":"dbrosius at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dbrosius%40apache.org&avatarId=14133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dbrosius%40apache.org&avatarId=14133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dbrosius%40apache.org&avatarId=14133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dbrosius%40apache.org&avatarId=14133"},"displayName":"Dave Brosius","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dbrosius%40apache.org","name":"dbrosius@apache.org","emailAddress":"dbrosius at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dbrosius%40apache.org&avatarId=14133","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dbrosius%40apache.org&avatarId=14133","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dbrosius%40apache.org&avatarId=14133","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dbrosius%40apache.org&avatarId=14133"},"displayName":"Dave Brosius","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":3600,"percent":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":3600,"percent":0},"comment":{"startAt":0,"maxResults":21,"total":21,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/12991950","id":"12991950","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The current code looks wrong and the suggested fix looks right.\r\n\r\nNone of our regression tests seem to exercise this code path, though. It would be good if someone could come up with a statement that caused this code to be executed so that we can verify that it behaves as expected after the proposed changes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-02-08T12:17:27.625+0000","updated":"2011-02-08T12:17:27.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13021634","id":"13021634","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"There was some discussion on the list about tracking down the statement that goes through BaseColumnNode.isEquivalient() , by adding a thread dump in the method.  I wanted to suggest an alternate method that might make things easier to track down.  I may be missing the mark as I have not been folllowing the thread on the list carefully.\r\n\r\nI think if you set the system property derby.language.logStatementText=true with -Dderby.language.logStatementText=true and then in the method call org.apache.derby.iapi.services.monitor.Monitor.getMonitor().logThrowable(new Exception(\"Trace in isEquivalent\")\r\nyou should get the stack trace right after the statement that goes there in derby.log\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-04-19T16:07:16.893+0000","updated":"2011-04-19T16:07:16.893+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13021931","id":"13021931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"The getmonitor() method returns a modulefactory interface which doesnt have a logThrowable method in it.. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-04-20T03:09:01.049+0000","updated":"2011-04-20T03:09:01.049+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13047891","id":"13047891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"Modified the BasecolumnNode class's IsEquivalent method to add the monitor method... But still when executing test.lang.__Suite, the log doesn't show any trace of the newly  added trace , i am attaching the patch and the __Suite  output","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-06-11T12:14:17.405+0000","updated":"2011-06-11T12:14:17.405+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13047913","id":"13047913","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Perhaps the code is simply never run, or perhaps the traces are getting swallowed\r\nup. The tests sometimes redirect the output, so it can be hard to figure out where the\r\ntraces might go.\r\n\r\nChange the method to perform System.exit(1);\r\n\r\nThen see if any of the tests in the test suite fail.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-06-11T14:36:09.402+0000","updated":"2011-06-11T14:36:09.402+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13049591","id":"13049591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"After adding the system.exit(1) to the BaseColumnNode.IsEquivalent method  and the running  java -Dderby.tests.trace=true junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.lang._Suite > runoutputJune14.out 2>&1\r\nis causing the log  output to stop at the \"aggregate\" test. \r\nAttaching the output log and the diff for reference.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-06-15T03:29:57.268+0000","updated":"2011-06-15T03:29:57.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13049601","id":"13049601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"If it's definitely the 'aggregate' test which is touching the code, then you should be able\r\nto confirm this by doing something like:\r\n\r\n  java org.apache.derbyTesting.functionTests.harness.RunTest lang/aggregate.sql\r\n\r\nwith and without your \"System.exit(1)\", and see the test pass without your change, and\r\nexit early with your change.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-06-15T04:17:10.634+0000","updated":"2011-06-15T04:17:10.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13049712","id":"13049712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Alternatively, since the test will probably fail with some spurious diffs when run in the old test harness now even when it's unmodified, aggregate.sql can be run as a standalone JUnit test by invoking this command:\r\n\r\n  java org.apache.derbyTesting.functionTests.tests.lang.LangScripts aggregate\r\n\r\nThanks for continuing the digging, Jayaram!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-15T10:54:54.675+0000","updated":"2011-06-15T10:54:54.675+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13050205","id":"13050205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"Modified the the basecolumnNode class isequivalent method to do a Thread.dumpStack(); and then ran the aggregate test alone by doing \r\n$  java org.apache.derbyTesting.functionTests.tests.lang.LangScripts aggregate\r\n>june15.out 2>&1\r\n\r\nVerified that executing aggregate resulted in the dump getting  produced . But the dump didnt indicate the sql statement which resulted in calling the isquivalent method.. Attaching the june15.out file for reference","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-06-16T03:50:52.119+0000","updated":"2011-06-16T03:50:52.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13050437","id":"13050437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Now that you know that the aggregate test exercises this code, can you try Kathey's suggestion from\r\nhttps://issues.apache.org/jira/browse/DERBY-5010?focusedCommentId=13021634&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13021634\r\n\r\nto see if you can further isolate the particular statement that is being executed?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-06-16T14:13:41.301+0000","updated":"2011-06-16T14:13:41.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13051723","id":"13051723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"As mentioned added the Monitor.getMonitor().logThrowable(new Exception(\"Trace in isEquivalent\")  and then executed  java org.apache.derbyTesting.functionTests.tests.lang.LangScripts aggregate >> June19.out .. \r\n\r\n\r\nin the derby log file got \r\nSun Jun 19 14:08:06 CDT 2011 Thread[main,5,main] (XID = 624), (SESSIONID = 3), (DATABASE = wombat), (DRDAID = null), Failed Statement is: null\r\n\r\nthe failed statement is coming as null..   Attaching the log file for reference...  The log file shows the \"isequivalent\" method being invoked but the statement could not be traced out..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-06-19T19:35:31.215+0000","updated":"2011-06-19T19:35:31.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13052072","id":"13052072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Looking at the derby.log, it seems to me that the derby.language.logStatementText=true property is not getting picked up.\r\nIf you look at the top of the log, there is no statement listed before the first instance of the stack trace printing, \r\n\r\nDatabase Class Loader started - derby.database.classpath=''\r\njava.lang.Exception: Trace in isEquivalent\r\n\tat org.apache.derby.impl.sql.compile.BaseColumnNode.isEquivalent(BaseColumnNode.java:183)\r\n\tat org.apache.derby.impl.sql.compile.SubstituteExpressionVisitor.visit(SubstituteExpressionVisitor.java:62)\r\n\tat org.apache.derby.impl.sql.compile.QueryTreeNode.accept(QueryTreeNode.java:718)\r\n\tat org.apache.derby.impl.sql.compile.ResultColumn.acceptChildren(ResultColumn.java:1550)\r\n\r\nIn your previous comment, you mentioned you ran it as:\r\njava org.apache.derbyTesting.functionTests.tests.lang.LangScripts aggregate\r\n\r\ntry \r\njava -Dderby.language.logStatementText=true  org.apache.derbyTesting.functionTests.tests.lang.LangScripts aggregate\r\n\r\n\r\nIf that still doesn't show the statement before the exception prints, try running the java/testing/org/apache/derbyTesting/functionTests/tests/lang/aggregate.sql ust with ij, outside of the harness, making sure you start ij with the property\r\n\r\njava -Dderby.language.logStatementText=true org.apache.derby.tools.ij\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-06-20T17:05:49.622+0000","updated":"2011-06-20T17:05:49.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13053290","id":"13053290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"As suggested ran the aggregate test with logstatementtext=true option and was able to get the sql statement causing the isequivalent method to be called\r\n\r\nselect c1 from t1\r\ngroup by c1\r\nhaving (max(c2) in (select c1 from t2)) OR\r\n\t\t(max(c1) in (select c2-999 from t2)) OR\r\n\t\t(count(*) > 0)\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-06-22T14:49:59.667+0000","updated":"2011-06-22T14:49:59.667+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13053503","id":"13053503","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thank you Jayaram for tracking this down!\r\nCan you post the full stack trace from isEquivalent when this statement is executed?\r\n\r\nNow that we know how to get into isEquivalent(), the next step will be to try to find a variation of this statement that fails without Dave's patch and passes with it.  First, to get yourself setup to debug the situation, I would suggest you break out an SQL script with just the first part of aggregate.sql to setup these two tables call it create.sql or some such. Then you can use that to create a database with ij and then you can just connect with ij to the database and run this one sql statement and variations to understand what is happening in isEquivalent, either by printing the values for tableName and other.tableName or using the debugger.\r\n\r\n\r\n\r\n\r\n \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-06-22T22:25:30.503+0000","updated":"2011-06-22T22:25:30.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13054811","id":"13054811","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"adding the full stack trace of isequivalent when the statement got executed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-06-25T03:19:17.276+0000","updated":"2011-06-25T03:19:17.276+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13054812","id":"13054812","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"When executing the sql statement  select c1 from t1 group by c1 having (max(c2) in (select c1 from t2)) OR (max(c1) in (select c2-999 from t2)) OR (count(*) > 0); in ij observed the following\r\n\r\n1) the control goes to isequivalent method but if (isSameNodeType(o)) is returning false making the flow not to go in to the modified section of code\r\n2) the reason why if (isSameNodeType(o)) is returning false is \r\n      2.1) in valuenode class nodetype has a value 62\r\n      2.2) in querytreenode class nodetype has a value 94\r\n\r\nI am not able to infer what these values mean or how they got assigned... but if we are able to get to make them equal then  control would go to the modified section of code...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-06-25T03:58:00.928+0000","updated":"2011-06-25T03:58:00.928+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13055592","id":"13055592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Jayaram,\r\n\r\nI think these constants come from C_NodeTypes:\r\n\r\n>    static final int COLUMN_REFERENCE = 62;\r\n\r\nand\r\n\r\n>    static final int BASE_COLUMN_NODE = 94;\r\n\r\nSo it looks like we're calling isEquivalent() to check whether a ColumnReference instance is equivalent to a BaseColumnNode in this query.\r\n\r\nI think the ColumnReference here is the reference to C1 in the GROUP BY clause, and to exercise the code using a variant of this query, we'd have to get the GROUP BY clause to contain a BaseColumnNode somehow. I'm afraid I don't have any good ideas on how to do that (I'm not even sure if it's possible).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-27T15:04:48.164+0000","updated":"2011-06-27T15:04:48.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13059667","id":"13059667","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"Hi Knut,\r\nI tried all the following variations but nothing seem to break the basecolumn to columnreference comparison.. So shall i jump on to the next task\r\nselect c1 from t1 group by c1 having (max(c2) in (select c1 from t2)) OR (max(c1) in (select c2-999 from t2)) OR (count(*) > 0);\r\nselect c1 from t1 group by c1 having (max(c1) in (select c1 from t2)) OR (max(c1) in (select c2-999 from t2)) OR (count(*) > 0);\r\nselect c1 from t1 group by c1 having (max(c1) in (select c1 from t2)) OR (max(c1) in (select c1-999 from t2)) OR (count(*) > 0);\r\nselect c1,count(c1) from t1 group by c1 having (max(c1) in (select c1 from t2)) OR (max(c1) in (select c1-999 from t2)) OR (count(*) > 0);","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-07-05T03:07:11.095+0000","updated":"2011-07-05T03:07:11.095+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13059849","id":"13059849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for the continued investigation, Jayaram.\r\n\r\nThe more I look at this code, the more convinced I get that the broken code cannot currently be exercised, and your experiments seem to support that.\r\n\r\nIn any case, the patch looks correct, so I've committed it to trunk (revision 1143002). Thanks, Dave, for the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-07-05T11:57:34.673+0000","updated":"2011-07-05T11:57:34.673+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13094760","id":"13094760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"It seems the code may not be reachable so no need to backport.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-08-31T18:31:34.093+0000","updated":"2011-08-31T18:31:34.093+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497948/comment/13685261","id":"13685261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:30.146+0000","updated":"2013-06-17T09:19:30.146+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5010/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06kuf:"}}