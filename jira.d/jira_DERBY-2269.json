{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12361223","self":"https://issues.apache.org/jira/rest/api/latest/issue/12361223","key":"DERBY-2269","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-01-29 15:49:22.246","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22976","customfield_12310222":"1_*:*_1_*:*_458886624_*|*_6_*:*_2_*:*_9018954248_*|*_4_*:*_1_*:*_37473","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-05-14T17:36:28.801+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2269/watchers","watchCount":0,"isWatching":false},"created":"2007-01-25T00:51:50.456+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-05-14T17:36:28.797+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"When running any of the tests (e.g. \n  j9 org.apache.derbyTesting.functionTests.harness.RunTest lang/supersimple.sql\n    or\n  j9 [-Dclienthost...-Dserverhost...] junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.tools._Suite)\nwith j9 and derbyrun.jar in the classpath, the tests (most - actually 5 tests out of derbyall will pass) will bail out, and no results will be returned. The stack trace (from RunTest lang/supersimple) is like this:\n------------------------------\nException in thread \"main\" java.lang.NoClassDefFoundError: javax.naming.Referenceable\n        at java.lang.ClassLoader.defineClassImpl(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:226)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:109)\n        at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1029)\n        at java.net.URLClassLoader.findInExtensions(URLClassLoader.java:328)\n        at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1038)\n        at java.net.URLClassLoader$4.run(URLClassLoader.java:549)\n        at java.security.AccessController.doPrivileged(AccessController.java:213)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:547)\n        at com.ibm.oti.vm.URLSystemClassLoader.findClass(URLSystemClassLoader.java:27)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:606)\n        at com.ibm.oti.vm.URLSystemClassLoader.loadClass(URLSystemClassLoader.java:60)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:563)\n        at java.lang.ClassLoader.defineClassImpl(Native Method)\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:226)\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:109)\n        at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1029)\n        at java.net.URLClassLoader.findInExtensions(URLClassLoader.java:328)\n        at java.net.URLClassLoader.findClassImpl(URLClassLoader.java:1038)\n        at java.net.URLClassLoader$4.run(URLClassLoader.java:549)\n        at java.security.AccessController.doPrivileged(AccessController.java:213)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:547)\n        at com.ibm.oti.vm.URLSystemClassLoader.findClass(URLSystemClassLoader.java:27)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:606)\n        at com.ibm.oti.vm.URLSystemClassLoader.loadClass(URLSystemClassLoader.java:60)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:563)\n        at java.lang.Class.forNameImpl(Native Method)\n        at java.lang.Class.forName(Class.java:114)\n        at org.apache.derbyTesting.junit.SecurityManagerSetup.getURL(SecurityManagerSetup.java:318)\n        at org.apache.derbyTesting.junit.SecurityManagerSetup.determineClasspath(SecurityManagerSetup.java:280)\n        at org.apache.derbyTesting.junit.SecurityManagerSetup.<clinit>(SecurityManagerSetup.java:57)\n        at java.lang.J9VMInternals.initializeImpl(Native Method)\n        at java.lang.J9VMInternals.initialize(J9VMInternals.java:177)\n        at org.apache.derbyTesting.functionTests.harness.jvm.getSecurityProps(jvm.java:385)\n        at org.apache.derbyTesting.functionTests.harness.jvm.setSecurityProps(jvm.java:345)\n        at org.apache.derbyTesting.functionTests.harness.RunTest.buildTestCommand(RunTest.java:2350)\n        at org.apache.derbyTesting.functionTests.harness.RunTest.testRun(RunTest.java:498)\n        at org.apache.derbyTesting.functionTests.harness.RunTest.main(RunTest.java:368)\n------------------------\n\nI had been tracking down a similar problem when derbynet.jar is in the classpath, but derbynet.jar should not be in the classpath when running with this jvm, so that was irritating but understandable.\n\nBut, to note, I had tracked that (new to me when I first noticed it about a week ago) failure down to probably related to a change in junit.SecurityManagerSetup.java with revision 492822, which changed the error to be caught with derbynet.jar/derbyclient.jar from NoClassDefFoundError to the more logical ClassNotFoundException.\nPossibly this issue was exposed by the same change. \n\nNot sure what the solution is yet.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40029","summary":"running tests (derbyall, or suites.All) with weme6.1 (or wctme5.7) with derbyrun.jar fails with NoClassDefFoundError: javax.naming.Referenceable","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"weme 6.1.(.1) or wctme5.7 (foundation)","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":3,"total":3,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361223/comment/12468143","id":"12468143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I'm attaching two possible approaches to prevent this.\r\n\r\nDERBY-2269_a.diff basically adds back the catch NoClassDefFoundError that used to happen before change 492822.\r\n\r\nDERBY-2269_b.diff puts an if !JDBC.vmSupportsJSR169() block around the getURL(\"org.apache.derby.jdbc.ClientDataSource\") which was resulting in loading of javax.naming.Referenceable down the line.\r\n\r\nI'd like input on which approach is preferable. \r\nOnce I get that, I'll (re)run derbyall & suites.All. If I don't get any input, I'll go with approach b.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2007-01-28T19:54:36.578+0000","updated":"2007-01-28T19:54:36.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361223/comment/12468310","id":"12468310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I agree that b) is the correct approach.\r\n a) I think is wrong because it will mask situations where the class can not be loaded due to a bug. E.g. ClientDataSource depends on a class in derbytools.jar.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-01-29T15:49:22.246+0000","updated":"2007-01-29T15:49:22.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12361223/comment/12468529","id":"12468529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"The patch I had attached actually only resolved the problem for running derbyall, for running suites.All a similar if(!JDBC.supportsJSR169()) section was required in org.apache.derbyTesting.junit.Derby.java. \r\nMade changes, tested with weme6.1 (j9 2.3/j2ME 1.1) and jdk14.\r\ncommitted with revision 501337:  http://svn.apache.org/viewvc?view=rev&revision=501337","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2007-01-30T08:19:57.042+0000","updated":"2007-01-30T08:19:57.042+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2269/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i077sn:"}}