{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12359991","self":"https://issues.apache.org/jira/rest/api/latest/issue/12359991","key":"LUCENE-766","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12312322":null,"customfield_12310220":"2007-09-29 11:49:38.237","customfield_12312323":null,"customfield_12310420":"12986","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_31093689143_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-01-03T07:35:28.143+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-766/watchers","watchCount":0,"isWatching":false},"created":"2007-01-08T10:27:19.103+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310854","id":"12310854","description":"","name":"2.1","archived":false,"released":true,"releaseDate":"2007-02-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-01-03T07:35:28.097+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310232","id":"12310232","name":"core/index","description":"issues with indexing code"}],"timeoriginalestimate":null,"description":"On a empty index, adding a document with two fields with the same name but with different term vector option fail. The field with TermVector.WITH_POSITIONS_OFFSETS is correctly indexed, as the offset are correclty extracted. The field with TermVector.NO is not. The TermVectorsWriter tries to add offset info given to the data of the filedinfo from the \"fnm\" file, but the DocumentWriter didn't prepared offset datas as it gets its info from the field itself, not from the fieldinfo.\n\nAttaching a patch with a test. The test without the fix make this stack trace :\n\njava.lang.IllegalStateException: Trying to write offsets that are null!\n\tat org.apache.lucene.index.TermVectorsWriter.writeField(TermVectorsWriter.java:311)\n\tat org.apache.lucene.index.TermVectorsWriter.closeField(TermVectorsWriter.java:142)\n\tat org.apache.lucene.index.TermVectorsWriter.closeDocument(TermVectorsWriter.java:100)\n\tat org.apache.lucene.index.TermVectorsWriter.close(TermVectorsWriter.java:240)\n\tat org.apache.lucene.index.DocumentWriter.writePostings(DocumentWriter.java:365)\n\tat org.apache.lucene.index.DocumentWriter.addDocument(DocumentWriter.java:114)\n\tat org.apache.lucene.index.IndexWriter.addDocument(IndexWriter.java:618)\n\tat org.apache.lucene.index.IndexWriter.addDocument(IndexWriter.java:601)\n\tat org.apache.lucene.index.TestDocumentWriter.testTermVector(TestDocumentWriter.java:147)\n","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10121","value":"New","id":"10121"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10120","value":"Patch Available","id":"10120"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"27282","summary":"Two same new field with and without Term vector make an IllegalStateException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","emailAddress":"nicolas dot lalevee at hibnet dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","emailAddress":"nicolas dot lalevee at hibnet dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12359991/comment/12531237","id":"12531237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"Hi Nicolas,\r\n\r\nCan you still produce this against the trunk now with the latest changes?  There has been quite a bit of rework...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2007-09-29T11:49:38.237+0000","updated":"2007-09-29T11:49:38.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12359991/comment/12531239","id":"12531239","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","emailAddress":"nicolas dot lalevee at hibnet dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true},"body":"well, I have attached a patch with a test. Add the test and you'll see if it has been fixed ;)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","emailAddress":"nicolas dot lalevee at hibnet dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true},"created":"2007-09-29T12:08:13.306+0000","updated":"2007-09-29T12:08:13.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12359991/comment/12555336","id":"12555336","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","emailAddress":"nicolas dot lalevee at hibnet dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true},"body":"Finally I ran the test against the trunk. And the test is successful.\r\nSo here is the patch with just the unit test.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hibou","name":"hibou","emailAddress":"nicolas dot lalevee at hibnet dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hibou&avatarId=15047","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hibou&avatarId=15047","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hibou&avatarId=15047","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hibou&avatarId=15047"},"displayName":"Nicolas Lalevée","active":true},"created":"2008-01-02T16:32:12.981+0000","updated":"2008-01-02T16:32:12.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12359991/comment/12555492","id":"12555492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"The test passes for me too.\r\nI will add the test anyhow and resolve this issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2008-01-03T07:06:58.301+0000","updated":"2008-01-03T07:06:58.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12359991/comment/12555494","id":"12555494","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"Issue was apparently solved along the way.\r\nTest committed.\r\nThanks Nicolas!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2008-01-03T07:35:28.087+0000","updated":"2008-01-03T07:35:28.087+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-766/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i05153:"}}