{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12521834","self":"https://issues.apache.org/jira/rest/api/latest/issue/12521834","key":"CASSANDRA-3154","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316349","id":"12316349","description":"","name":"1.0.0","archived":false,"released":true,"releaseDate":"2011-10-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-09-07 23:30:14.419","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"3_*:*_2_*:*_55520_*|*_10002_*:*_1_*:*_65547011_*|*_1_*:*_2_*:*_98190_*|*_5_*:*_1_*:*_0","customfield_12310420":"4059","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-09-08T17:36:27.677+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-3154/watchers","watchCount":0,"isWatching":false},"created":"2011-09-07T23:21:27.415+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bcoverston","name":"bcoverston","emailAddress":"ben dot coverston at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Coverston","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tupshin","name":"tupshin","emailAddress":"tupshin at tupshin dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tupshin Harper","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-09T11:19:45.850+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"The equality check in isCompleteSSTables() always fails because it tries to call equals() with a Set and a List. This might result in failure to purge tombstones in some cases.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12493534","id":"12493534","filename":"3154.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-09-08T01:31:26.691+0000","size":23586,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12493534/3154.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12493527","id":"12493527","filename":"CASSANDRA-3154.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tupshin","name":"tupshin","emailAddress":"tupshin at tupshin dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tupshin Harper","active":true},"created":"2011-09-07T23:23:44.819+0000","size":1087,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12493527/CASSANDRA-3154.diff"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"94096","summary":"Bad equality check in ColumnFamilyStore.isCompleteSSTables()","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tupshin","name":"tupshin","emailAddress":"tupshin at tupshin dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tupshin Harper","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tupshin","name":"tupshin","emailAddress":"tupshin at tupshin dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tupshin Harper","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521834/comment/13099660","id":"13099660","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bcoverston","name":"bcoverston","emailAddress":"ben dot coverston at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Coverston","active":true},"body":"The cardinality restriction of .isEqualCollection is probably more restrictive than we need, but this does indeed fix the existing shallow equality problem.\r\n\r\n+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bcoverston","name":"bcoverston","emailAddress":"ben dot coverston at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Coverston","active":true},"created":"2011-09-07T23:30:14.419+0000","updated":"2011-09-07T23:30:14.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521834/comment/13099697","id":"13099697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I'd rather get rid of that code.  It's not useful because\r\n\r\n- for leveled compactions, you are effectively guaranteed that once you have more than a couple sstables, you'll never compact all sstables at once\r\n- for non-leveled compactions, you have a small enough number of sstables that isKeyInRemainingSSTables is fine without adding additional optimization for the \"major\" case\r\n\r\nThis patch gets rid of isMajor, and additionally renames CompactionType to OperationType to better reflect the \"compaction\" stage's role as generic background IO manager.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-09-08T01:31:26.725+0000","updated":"2011-09-08T01:31:26.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521834/comment/13099727","id":"13099727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tupshin","name":"tupshin","emailAddress":"tupshin at tupshin dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tupshin Harper","active":true},"body":"+1 to getting rid of the code instead.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tupshin","name":"tupshin","emailAddress":"tupshin at tupshin dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tupshin Harper","active":true},"created":"2011-09-08T03:11:40.882+0000","updated":"2011-09-08T03:11:40.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521834/comment/13100470","id":"13100470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bcoverston","name":"bcoverston","emailAddress":"ben dot coverston at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Coverston","active":true},"body":"Patch is good.\r\n+1 Getting rid of isMajor makes the logic behind the determination of the compaction operation much cleaner.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bcoverston","name":"bcoverston","emailAddress":"ben dot coverston at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Benjamin Coverston","active":true},"created":"2011-09-08T17:22:12.033+0000","updated":"2011-09-08T17:22:12.033+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521834/comment/13100485","id":"13100485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-09-08T17:36:27.686+0000","updated":"2011-09-08T17:36:27.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521834/comment/13100536","id":"13100536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #1091 (See [https://builds.apache.org/job/Cassandra/1091/])\r\n    remove isMajor compaction designation\r\npatch by jbellis; reviewed by Tupshin Harper and Ben Coverston for CASSANDRA-3154\r\n\r\njbellis : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1166822\r\nFiles : \r\n* /cassandra/trunk/CHANGES.txt\r\n* /cassandra/trunk/src/java/org/apache/cassandra/cache/AutoSavingCache.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/cli/CliClient.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/ColumnFamilyStore.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/AbstractCompactionIterable.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/CompactionController.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/CompactionInfo.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/CompactionIterable.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/CompactionManager.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/CompactionTask.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/CompactionType.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/OperationType.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/ParallelCompactionIterable.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/index/SecondaryIndexBuilder.java\r\n* /cassandra/trunk/test/unit/org/apache/cassandra/io/LazilyCompactedRowTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-09-08T18:23:09.321+0000","updated":"2011-09-08T18:23:09.321+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521834/comment/13101126","id":"13101126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #1093 (See [https://builds.apache.org/job/Cassandra/1093/])\r\n    Remove wrongly added import (by CASSANDRA-3154)\r\n\r\nslebresne : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1167078\r\nFiles : \r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/ColumnFamilyStore.java\r\n* /cassandra/trunk/src/java/org/apache/cassandra/db/compaction/CompactionTask.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-09-09T11:19:45.850+0000","updated":"2011-09-09T11:19:45.850+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-3154/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0gggf:"}}