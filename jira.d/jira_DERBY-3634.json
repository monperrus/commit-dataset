{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12394334","self":"https://issues.apache.org/jira/rest/api/latest/issue/12394334","key":"DERBY-3634","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-05-16 12:45:43.437","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23758","customfield_12310222":"1_*:*_1_*:*_47777044615_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-10-23T18:07:53.090+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3634/watchers","watchCount":1,"isWatching":false},"created":"2008-04-18T18:43:48.475+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"20.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12326431","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12326431","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12375659","key":"DERBY-2998","self":"https://issues.apache.org/jira/rest/api/2/issue/12375659","fields":{"summary":"Add support for ROW_NUMBER() window function","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}},{"id":"12326430","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12326430","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12415425","key":"DERBY-4069","self":"https://issues.apache.org/jira/rest/api/2/issue/12415425","fields":{"summary":"Wrong behavior when ROW_NUMBER is combined with ORDER BY","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12326429","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12326429","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12394338","key":"DERBY-3635","self":"https://issues.apache.org/jira/rest/api/2/issue/12394338","fields":{"summary":"Cannot build SELECT LIST expressions involving row_number()","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-07-13T18:03:38.562+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"The following query works correctly:\r\n\r\nselect abs(a), row_number() over ()\r\nfrom t\r\nwhere a > 100 and a < 111\r\norder by abs(a)\r\n\r\nI expected the following query to also work, but it raised an exception:\r\n\r\nselect abs(a), row_number() over ()\r\nfrom t\r\nwhere a > 100 and a < 111\r\norder by row_number() over ()\r\n\r\nThis is the error I saw: \"ERROR 42X01: Syntax error: Encountered \"over\" at line 5, column 23\".\r\n\r\nHere are the reasons why I think that this syntax is supposed to be supported:\r\n\r\nAccording to my reading of the 2003 SQL spec, the ORDER BY clause should be able to sort on any expression in the SELECT list. That includes OLAP expressions. I believe this is so because, according to part 2, section 10.10 (<sort specification>), a <sort key> can be any <value expression> and if you follow the grammar for <value expression>, it can resolve to be a <value expression primary> (see section 6.3), which can in turn resolve to be a <window function>. This reasoning is supported by tracing the hotlinks on the following page which lays out the SQL 2003 BNF: http://savage.net.au/SQL/sql-2003-2.bnf.html This interpretation is further supported by the example of an ORDER BY clause referencing an OLAP expression which is provided on page 23 of the introduction to OLAP written by Fred Zemke, Krishna Kulkarni, Andy Witkowski, and Bob Lyle: www.cse.iitb.ac.in/dbms/Data/Papers-Other/SQL1999/OLAP-99-154r2.pdf\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37961","summary":"Cannot use row_number() in ORDER BY clause","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":44,"total":44,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12597452","id":"12597452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Fixed typo in summary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-05-16T12:45:43.437+0000","updated":"2008-05-16T12:45:43.437+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12645775","id":"12645775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"There's a similar problem when you use an alias in the ORDER BY clause:\r\n\r\nThis query works:\r\n\r\nselect abs(a) c, row_number() over ()\r\nfrom t\r\nwhere a > 100 and a < 111\r\norder by c\r\n\r\nWhereas this query fails (ERROR 42X78: Column 'C' is not in the result of the query expression.):\r\n\r\nselect abs(a), row_number() over () c\r\nfrom t\r\nwhere a > 100 and a < 111\r\norder by c","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-11-07T14:49:20.925+0000","updated":"2008-11-07T14:49:20.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12728076","id":"12728076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Triaged for 10.5.2. Made it Unassigned because there has been no activity.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-07-07T12:58:26.217+0000","updated":"2009-07-07T12:58:26.217+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12744825","id":"12744825","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"While looking into the issues logged against the present\r\nROW_NUMBER/WINDOW functionality (DERBY-3634(1), DERBY-3635(2),\r\nDERBY-4069(3), I was hard pressed to find a way to fix these without\r\ndoing a major rewrite.\r\n\r\n1) DERBY-3634 Cannot use row_number() in ORDER BY clause\r\n2) DERBY-3635 Cannot build SELECT LIST expressions involving row_number()\r\n3) DERBY-4069 Wrong behavior when ROW_NUMBER is combined with ORDER BY\r\n\r\nThis patch is a proof-of-concept (not for commit!) for restructuring\r\nthe row_number/windowing code, which solves the three issues above and\r\nadds some generality as well. \r\n\r\nIt does not yet address DERBY-3505 \"Current implementation of\r\nROW_NUMBER() window function does not stop execution once criteria is\r\nmet\".\r\n\r\nFor details, see the write-up in derby-3634-a.txt.\r\n\r\nThe patch adds new tests for the new functionality. Regressions ran cleanly.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-08-19T01:12:31.199+0000","updated":"2009-08-19T01:12:31.199+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12745001","id":"12745001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I noticed another row_number() problem that I don't think is mentioned in any of the bug reports. You cannot use row_number() in EXCEPT queries. (It works in UNION queries, though.)\r\n\r\nij> select x, row_number() over() from t except select x, row_number() over () from t;\r\nERROR 42X77: Column position '2' is out of range for the query expression.\r\n\r\nWith your patch, this query starts working too, so it looks like it must be doing something right. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-08-19T11:11:41.338+0000","updated":"2009-08-19T11:11:41.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12745732","id":"12745732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Attaching version \"b\" of this patch. Relative to \"a\", it adds:\r\n\r\n- formatting cleanup, whitespace, long lines etc.\r\n\r\n- Makes ROW_NUMBER work inside an ORDER BY clause in the presence of\r\n  a WHERE clause. It was optimized away because it was erroneously\r\n  found to be constant relative to the restriction, see SelectNode's\r\n  call to orderByList.removeConstantColumns(wherePredicates). \r\n\r\n  Letting WdwFunctionNode overload methods isConstantExpression and\r\n  constantExpression to return \"false\" solved the problem. A new test\r\n  case has been added to OLAPTest to verify this use case.\r\n\r\nThe patch it not production-ready, it lacks some Javadocs still, but\r\notherwise, I think it is ready for a review.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-08-21T00:00:41.833+0000","updated":"2009-08-21T00:01:42.282+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12747691","id":"12747691","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Dag, thanks for working on this. I've just started reading your detailed writeups; they are very helpful -- thanks!\r\n\r\nI think it would be nice to spell out the word \"Window\" in the code, so we'd have\r\nWindowFunctionNode, not WdwFunctionNode, etc.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-08-25T22:27:11.552+0000","updated":"2009-08-25T22:27:11.552+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12748014","id":"12748014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for looking at this, Bryan!\r\nI agree, I intend to change the names to \"window\" all over;\r\nI only shortened it because the old windowing code is still in the code base (the present patch doesn't remove it except for in the grammar), intention being that it would be easy to see what's old and what's new.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-08-26T16:26:53.386+0000","updated":"2009-08-26T16:26:53.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12748616","id":"12748616","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I read through your writeup in more detail -- it looks great!\r\n\r\nAm I correct in understanding that the \"window function node\" classes would be the place\r\nwhere we could add additional window functions in the future, such as RANK, NTILE, or\r\nmaybe moving averages and things like that?\r\n\r\nRegarding leaving the complete syntax present in the parser, but with parts commented out,\r\nwhat is the tradeoff between doing that, versus having the unsupported syntax variants be\r\npresent and recognized by the parser, but throw some sort of \"sorry, not yet implemented\" exception?\r\n\r\nRegarding keeping the patch simpler for review, perhaps you could post two patches:\r\n1) the first patch would delete the old code that we aren't going to keep around any more\r\n2) the second patch would be your proposed new code, with all the function names, etc.\r\nas you actually intend them to be.\r\n\r\nThat way, patch #2 would still be a manageable size (wouldn't include large diffs for removal\r\nof old code) but it would also be possible to apply both patches in sequence and see the\r\nproposed codeline as you intend it to really look (\"window\" rather than 'wdw\", etc.)\r\n\r\nAnyway, now that I've read through your design notes, I'll try to find some time to read\r\nthrough the actual code soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-08-27T23:27:18.703+0000","updated":"2009-08-27T23:27:18.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12748661","id":"12748661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for looking at this, Bryan!\r\n\r\nYes, that was indeed my intention for the \"window function node\" classes.\r\n\r\nRegarding the ordering of patches, what you propose makes sense, I\r\nguess I hesitated to do that at first since I wasn't sure how long it\r\nwould take to replace the old code, and it's tedious to maintain\r\nsequences of dependent patches. But the removal patch would be quite stable, \r\nso I'll get on to that.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-08-28T03:40:58.441+0000","updated":"2009-08-28T03:40:58.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12751226","id":"12751226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading patch derby-3634-remove, which removes the old windowing\r\ncode so as to make the new patch able to use legible \"window\"\r\nidentifiers wihtout risk of crashing with old code as well as make\r\nthat patch smaller, as suggested by Bryan.\r\n\r\nThis patch is essentially a \"backwards merge\" of DERBY-2998 mods, cf.\r\nhttp://svnbook.red-bean.com/en/1.5/svn-book.html#svn.branchmerge.basicmerging.undo\r\n\r\nsvn merge -c -634057 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -633251 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -633067 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -633058 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -632992 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -632988 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -632494 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -601311 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -601309 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\nsvn merge -c -601021 https://svn.eu.apache.org/repos/asf/db/derby/code/trunk\r\n\r\nplus some conflict resolutions and final svn deletes. Running\r\nregressions.\r\n\r\nBtw, if the new patch doesn't make the cut, it should be easy to \"undo\"\r\nthis one again, reviving the old functionality :)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-09-03T23:58:51.419+0000","updated":"2009-09-03T23:58:51.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12751474","id":"12751474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Regressions passed with the patch derby-3634-remove applied. I intend to commit this patch\r\nif there are no objections to my approach here.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-09-04T14:19:52.536+0000","updated":"2009-09-04T14:19:52.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12754244","id":"12754244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"+1 to your approach, Dag. I think it will make it easier to follow your new approach to modelling the window structures.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2009-09-11T17:36:38.141+0000","updated":"2009-09-11T17:36:38.141+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12759017","id":"12759017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"body":"I am a user for derby.\r\n\r\nI don't know how to apply this patch. It seems that I need to checkout all sources codes and apply this patch then recompile all and jar them to derby.jar. But I don't think it's a good way to do for me.\r\n\r\nWill the new release of derby apply the patch and when will be released?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"created":"2009-09-24T05:30:01.720+0000","updated":"2009-09-24T05:31:34.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12759125","id":"12759125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Micky. Your general understanding of how to use the patch is correct. It's not hard, but you have\r\nto be comfortable with the overall concepts of working with Java source code. You can find more\r\ninformation about working directly with the Derby source code here:\r\nhttp://db.apache.org/derby/dev/derby_source.html\r\nhttp://wiki.apache.org/db-derby/ForNewDevelopers\r\n\r\nSuccessful usage of a patch in a variety of environments increases the likelihood that\r\nit will be committed to Derby and incorporated in future releases.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-09-24T14:06:54.779+0000","updated":"2009-09-24T14:06:54.779+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12760372","id":"12760372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"body":"Hi, does this patch only be applied to trunk at svn?\r\n\r\nI  checkout two source codes, one is from trunk, the other is from branch 10.5.\r\nOnly the codes from trunk will be compiled after applying the patch. And this trunk is 10.6 beta which is not suitable for my derby database (10.5)\r\n\r\nWhen I apply the patch to branch 10.5 and run Ant to compile it, there are some errors I don't know how to solve as following\r\n\r\n====\r\n\r\ncompile:\r\n    [javac] Compiling 417 source files to C:\\eclipse-galileo\\workspace\\derby-10.5\\classes\r\n    [javac] C:\\eclipse-galileo\\workspace\\derby-10.5\\java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\ResultColumnList.java:4223: cannot find symbol\r\n    [javac] symbol  : method isWindowFunction()\r\n    [javac] location: class org.apache.derby.impl.sql.compile.ResultColumn\r\n    [javac] \t\t\tif (rc.isWindowFunction()){\r\n    [javac] \t\t\t      ^\r\n    [javac] C:\\eclipse-galileo\\workspace\\derby-10.5\\java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\ResultColumnList.java:4238: cannot find symbol\r\n    [javac] symbol  : method isWindowFunction()\r\n    [javac] location: class org.apache.derby.impl.sql.compile.ResultColumn\r\n    [javac] \t\t\tif (rc.isWindowFunction()){\r\n    [javac] \t\t\t      ^\r\n    [javac] 2 errors\r\n\r\nBUILD FAILED\r\n====\r\n\r\nIs any suggesstion?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"created":"2009-09-28T20:29:34.947+0000","updated":"2009-09-28T20:29:34.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12760440","id":"12760440","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Micky,\r\n\r\nCurrently, the patch only applies to the trunk.\r\n\r\nYou can use the trunk code with your current 10.5 database as follows:\r\n1) Make a backup of your 10.5 database and restore it to a testing location (IMPORTANT!)\r\n2) When you run the modified, patched, trunk software to access your test copy\r\nof your database, pass -Dderby.database.allowPreReleaseUpgrade=true\r\n\r\nThis special flag tells the Derby software that it's OK to open your database using\r\nthe unreleased trunk code, and it will automatically be upgraded to 10.6 trunk format.\r\nThis automatic upgrade, which cannot be undone, is why it is CRITICAL that you\r\ndo this with a testing copy of your database, NOT with your production data.\r\n\r\nIf these instructions are confusing, please let us know and I can try to explain some more.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-09-28T23:44:41.164+0000","updated":"2009-09-28T23:44:41.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12760490","id":"12760490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"body":"Dear Bryan,\r\n\r\nAfter apply the patch and use it as you said \"pass -Dderby.database.allowPreReleaseUpgrade=true\" to run, \r\nthere is syntax error as following, \"語法錯誤：Encountered \"(\" at line 1, column 41。\" (in chinese)\r\nthe error may be translated to \"Syntax error: Encountered \"(\" at line 1, column 41.\" in english.\r\n\r\nthe SQL query string is\r\n---\r\nSELECT * FROM ( SELECT ROW_NUMBER() OVER() AS rownum, event_log.* FROM event_log WHERE event_log.id<=2147483647) AS TR WHERE rownum >= 2189 AND rownum <= 2288\r\n---\r\n\r\nNotice that the SQL query string just doesn't include the \"ORDER BY\" clause and cause error.\r\nBefore apply the patch, the SQL query string works well.\r\n\r\nThe trunk revision I checkout is 819006.\r\n\r\nHow to solve this?\r\n\r\nThanks your help in advance.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"created":"2009-09-29T04:02:05.977+0000","updated":"2009-09-29T04:02:05.977+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12760520","id":"12760520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Which patch did you apply? derby-3634-remove.diff removes the support for ROW_NUMBER from trunk in preparation for the fix, so that it will be easier to understand the final patch that will add a completely new implementation of ROW_NUMBER later. If this was the patch you tried, you'll probably have more luck with derby-3634-b.diff, which is a proof of concept for the planned fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-09-29T07:24:58.234+0000","updated":"2009-09-29T07:24:58.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12760618","id":"12760618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Hi Micky, I upload derby-3634-c, a slight revision of the proof-of-concept patch (not for production!) which applies\r\ncleanly against the current trunk at svn (@819907) , so that you may try it out. \r\nI am currently running full regression tests on it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-09-29T14:27:09.632+0000","updated":"2009-09-29T14:27:09.632+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12760636","id":"12760636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"body":"@Knut\r\nThank for your help.\r\nI just used the wrong patch derby-3634-remove.diff as you said. After I apply derby-3634-b.diff, SQL query works well but can't be used for \"ORDER BY\" query. It show error as later description.\r\n\r\n@Dag\r\nThank for your help.\r\nWhen I use browser to open http://svn.apache.org/repos/asf/db/derby/code/trunk/, it shows 819978 revision. But I use the same link in Eclipse SVN Repository, the trunk revision always shows 819006 from yesterday even I refresh it. I don't know why ..., and I also use TortoiseSVN (Windows version) to explore that link, it still shows 819006 at trunk and 819547 at branch in Repository Browser of TortoiseSVN.\r\n\r\nAfter apply the derby-3634-c.diff patch, it compiles and jar OK. The SQL query string as I mentioned at 28/Sep/09 09:02 PM works well.\r\nMy target is to use ROW_NUMBER() with ORDER BY in one SQL query, but there shows a error as following:\r\n'Syntax error: Encountered \"ORDER\" at line 1, column 113'\r\n\r\nthe SQL query string is\r\n---\r\nSELECT * FROM ( SELECT ROW_NUMBER() OVER() AS rownum, event_log.* FROM event_log WHERE event_log.id<=2147483647 ORDER BY id DESC) AS TR WHERE rownum >= 2189 AND rownum <= 2288\r\n---\r\n\r\nIt clearly that the syntax error is caused by the ORDER which is added. But I think the derby-3634-c.diff patch is to solve this problem, am I right?\r\n\r\nIs there something I missed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"created":"2009-09-29T16:10:12.278+0000","updated":"2009-09-29T16:10:12.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12760936","id":"12760936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The problem here is that you have an ORDER BY in a sub-select, which\r\nis currently not allowed by Derby. ORDER BY is only allowed on the\r\nouter SELECT. This patch does allow you to use ROW_NUMBER() in the\r\norder by clause, but this is not what you want, it seems.\r\n\r\nE.g. SELECT ... ORDER BY ROW_NUMBER() OVER () \r\nis allowed by the patch\r\n\r\nI plan to work on relaxing this restriction as part of the 10.6 work.\r\n\r\nYou could probably achieve what you want by using the new OFFSET/FETCH\r\nFIRST syntax introduced in 10.5, cf.\r\n\r\nhttp://db.apache.org/derby/docs/10.5/ref/rrefsqljoffsetfetch.html\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-09-30T15:53:57.933+0000","updated":"2009-09-30T15:53:57.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12761032","id":"12761032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed derby-3634-remove-2 as svn 820483 and 820494.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-09-30T22:43:16.297+0000","updated":"2009-09-30T23:22:37.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12761035","id":"12761035","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Note that the proof-of-concept patch is no longer applicable on trunk after derby-3634-remove-2 was committed. Update to svn 820482 if you need it. A new version of derby-3634-c with the proper window naming will appear soon, meanwhile ROW_NUMBER() is unavailable on trunk.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-09-30T22:45:54.392+0000","updated":"2009-09-30T22:45:54.392+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12761308","id":"12761308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"body":"Thank you, Dag.\r\n\r\nThe OFFSET/FETCH function is suitable for my application. It works well. I just wanted to use LIMIT and searched results in ROW_NUMBER of derby before. \r\n\r\nNow I wonder what's the different between them? And which one has better efficiency in core codes?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mickyp","name":"mickyp","emailAddress":"micky_lee at cyberpowersystems dot com dot tw","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Micky Li","active":true},"created":"2009-10-01T19:25:33.862+0000","updated":"2009-10-01T19:25:33.862+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12761326","id":"12761326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The row_number() is part of SQL's OLAP machinery and has been in the standard since 1999, I think.\r\nUntil SQL 008 added the new OFFSET/FETCH FIRST syntax, there was no way to achieve \"LIMIT\" functionality via standard SQL without using the rather more indirect ROW_NUMBER window function.\r\nIf the underlying result set is not materialized (depends on the actual query), the OFFSET/FETCH FIRST is better, because it will stop reading rows from the table once the the # of fetch rows have been seen. For the time being, a WHERE predicate on ROW_NUMBER() is not optimized, so as long as you keep draining the result set, all rows from the underlying (sub)query will be read. There is currently no optimization for skipping (OFFSET); all rows are read internally but discarded until we hit the offset.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-01T20:17:42.372+0000","updated":"2009-10-01T20:17:42.372+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12761780","id":"12761780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading a cleaned up version of the last prototype patch. Please see notes in\r\nderby-3634-newimpl-1.txt attached for details. \r\n\r\nThis version is fairly close to a committable state, I hope. \r\nComments are much appreciated!\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-02T23:50:14.549+0000","updated":"2009-10-02T23:50:14.549+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12762245","id":"12762245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading derby-3634-newimpl-2, which just adds a metadata test fixture for ROW_NUMBER() to OLAPTest, and fixes some end-of-line blanks/too long lines.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-05T16:33:57.377+0000","updated":"2009-10-05T16:33:57.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12762979","id":"12762979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Dag,\r\nI applied the patch and tried some random queries. Most of them worked as expected, but some of them caused assert failures:\r\n\r\nij> values row_number() over ();\r\nERROR XJ001: Java exception: 'ASSERT FAILED cannot get interface without operand: org.apache.derby.shared.common.sanity.AssertFailure'.\r\n\r\nij> select * from t where exists (select row_number() over () from t);\r\nERROR XJ001: Java exception: 'ASSERT FAILED generatedRef is null.  replaceCallsWithColumnReferences() has not been called on this WindowFunctionNode.  Make surethe node is under a ResultColumn as expected.: org.apache.derby.shared.common.sanity.AssertFailure'.\r\n\r\nij> select * from t where row_number() over () > 3;\r\nERROR XJ001: Java exception: 'ASSERT FAILED cannot get interface without operand: org.apache.derby.shared.common.sanity.AssertFailure'.\r\n\r\nij> select row_number() over (), count(*) from t group by row_number() over ();\r\nERROR XJ001: Java exception: 'ASSERT FAILED generatedRef is null.  replaceCallsWithColumnReferences() has not been called on this WindowFunctionNode.  Make surethe node is under a ResultColumn as expected.: org.apache.derby.shared.common.sanity.AssertFailure'.\r\n\r\nij> select count(*) from t group by row_number() over ();\r\nERROR XJ001: Java exception: 'ASSERT FAILED cannot get interface without operand: org.apache.derby.shared.common.sanity.AssertFailure'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-07T10:02:34.395+0000","updated":"2009-10-07T10:02:34.395+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12763132","id":"12763132","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for test driving this, Knut! More cases to handle, it seems! I'm not sure all of these are even allowed, will consult spec.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-07T17:04:58.766+0000","updated":"2009-10-07T17:04:58.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12763317","id":"12763317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Some comments on your cases, Knut.\r\n\r\nij> values row_number() over ();\r\n\r\nThis should be flagged. SQL 2003, section 4.14.9 Windowed tables says:\r\n\"A window is a transient data structure associated with a <table\r\nexpression>.\"  A window function like ROW_NUMBER is always defined\r\nrelative a window, and there is no <table expression> here and hence\r\nno window either.\r\n\r\nExplicitly, in 4.15.3: Window functions may only appear in the <select\r\nlist> of a <query specification> or <select statement: single row>, or\r\nthe <order by clause> of a simple table query.\r\n\r\nij> select * from t where exists (select row_number() over () from t);\r\n\r\nBug.\r\n\r\nij> select * from t where row_number() over () > 3;\r\n\r\nShould be flagged, cf. 4.15.3 quoted above.\r\n\r\nij> select row_number() over (), count(*) from t group by row_number() over ();\r\nij> select count(*) from t group by row_number() over ();\r\n\r\nBoth should be flagged, GROUP BY allows <ordinary grouping set> ->\r\n<grouping column reference>. Cf. 4.15.3 quoted above as well.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-08T00:29:36.265+0000","updated":"2009-10-08T00:29:36.265+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12763419","id":"12763419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Another thing I noticed, was a change in behaviour. Given this sequence of statements\r\n\r\ncreate table t (x int);\r\ninsert into t values 1,2,3;\r\nselect * from (select row_number() over (), x from t) s(r,x) where x > 2;\r\n\r\nthe old implementation would return (3,3) whereas the new implementation returns (1,3), probably because the restriction (x>2) is now pushed down. This is not a bug, as the order of the rows in the inner select is undefined, but it might have some consequences that need to be handled when ORDER BY in sub-selects is implemented (DERBY-4397).\r\n\r\nSimilarly, some may perhaps find it unintuitive that this query now returns 1 for all parameter values in (1,2,3), whereas it previously returned different values for different parameter values:\r\n\r\n    select r from (select row_number() over (), x from t) s(r,x) where x = ?\r\n\r\nBut again, it's not a bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-08T08:51:51.268+0000","updated":"2009-10-08T08:51:51.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12763799","id":"12763799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading derby-3634-newimpl-3. Re-running regressions now.\r\n\r\n- Inserted code to avoid pushdown of predicate if there is an ORDER BY\r\n  and a window function because that would make ROW_NUMBER give wrong\r\n  result, e.g.\r\n\r\n    SELECT * from (SELECT ROW_NUMBER() OVER (), j FROM T\r\n                   ORDER BY j) WHERE j=5\r\n\r\n  Note that ORDER BY in a subselect is not supported until DERBY-4397\r\n  is completed, so this is just to future-proof the code.  We could\r\n  elect to always avoid push-down here, since the results may be\r\n  surprising to some users (ROW_NUMBER() always being 1 for first\r\n  matching row above), but relying on the order without an ORDER BY is\r\n  inherently not protable and brittle, so I chose still push down the\r\n  restrict in such cases, since it's a valid SQL result, but I am\r\n  willing to reconsider this decision.\r\n\r\n- Knut's bug: Remove an ASSERT in WindowFunctionNode#getGeneratedRef,\r\n  since there is a valid use case in which the reference is null when\r\n  retrieved, cf.\r\n\r\n  SELECT * FROM t WHERE EXISTS (SELECT ROW_NUMBER() OVER () FROM t)\r\n\r\n  in which case the top PRN of the subquery sitting over a\r\n  WindowResultSetNode just contains a RC which is boolean constant\r\n  true.  This means that the\r\n  WindowFunctionNode#replaceCallsWithColumnReferences will not have\r\n  been called for a window function call (one of\r\n  SelectNode.windowFuncCalls), so the returned {@code generatedRef} is\r\n  null. Another approach would have been to remove the window function\r\n  call from SelectNode.windowFuncCalls, but that seems more complex.\r\n\r\n  Since the generated ref may now be null, a test is added for this\r\n  case in WindowResultSetNode#addNewColumns.\r\n\r\n  Added a new test case to OLAPTest to check that this query works.\r\n\r\n- Added check that a window function is not used in a WHERE clause\r\n  (except when nested inside a subquery). Added test cases for this to\r\n  OLAPTest.\r\n\r\n- Added check that a window function is not used in a GROUP BY column\r\n  expression (except when nested inside a subquery, but see\r\n  DERBY-4403). Added test cases for this to OLAPTest.\r\n\r\n- Added check that a window function is not used in a HAVING BY column\r\n  expression (except when nested inside a subquery). Added test cases\r\n  for this to OLAPTest. SQL 2003, section 7.10 SR 4.\r\n\r\n- Fixed GroupByNode#addNewColumnsForAggregation to allow window\r\n  functions inside a subquery in a HAVING clause, e.g.\r\n\r\n  select sum(a) from t5 group by b\r\n               having b = (select row_number() over () + 3\r\n                               from t5 where a=1)\r\n\r\n- Added check that a window function is not used in a VALUES row\r\n  constructor (except when nested inside a subquery).  Added test\r\n  cases for this to OLAPTest.\r\n\r\n- Added check that a window function is not used inside an aggregate\r\n  function.  Added test cases for this to OLAPTest. SQL 2003, section\r\n  10.9 SR 7.\r\n\r\n- Added check that a window function is not used inside a JOIN ON\r\n  clause, (except when nested inside a subquery).  Added test cases\r\n  for this to OLAPTest. SQL 2003, section 7.7 SR 5.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-09T03:49:18.658+0000","updated":"2009-10-09T03:49:18.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12763979","id":"12763979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Patch #3 appears to be missing some files, so I'm not able to compile with it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-09T11:39:32.919+0000","updated":"2009-10-09T11:39:32.919+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12764052","id":"12764052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Sorry, here is the full patch. Regressions ran ok.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-09T15:31:57.225+0000","updated":"2009-10-09T15:31:57.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12766011","id":"12766011","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"After DERBY-3002, the patch needs to be refreshed because of a conflict in OLAPTest.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-15T11:05:40.745+0000","updated":"2009-10-15T11:05:40.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12766028","id":"12766028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks Dag, it looks like the problems I found in the previous patch have been fixed. Noticed another problem with this query (inspired by DERBY-4391):\r\n\r\nij> create table t(x int unique, y int);\r\n0 rows inserted/updated/deleted\r\nij> insert into t values (1,2);\r\n1 row inserted/updated/deleted\r\nij> select * from t where x > (select row_number() over () from sysibm.sysdummy1 union select 1-row_number() over () from sysibm.sysdummy1 where 1=0);\r\nERROR 21000: Scalar subquery is only allowed to return a single row.\r\n\r\nBut the scalar subquery does return a single row:\r\n\r\nij> select row_number() over () from sysibm.sysdummy1 union select 1-row_number() over () from sysibm.sysdummy1 where 1=0;\r\n1                   \r\n--------------------\r\n1                   \r\n\r\n1 row selected","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-15T11:36:12.460+0000","updated":"2009-10-15T11:36:12.460+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12766097","id":"12766097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for looking again, Knut. The last error you see seems not introduced by this patch, you can see it in this query as well (without the patch):\r\n\r\nselect * from t where i > (values 1 union select j from t where 1=0)\r\n\r\nIt only happens if the outer selected column (i) is unique; if I change the query to \r\n\r\nselect * from t where j > (values 1 union select j from t where 1=0)\r\n\r\nit works as expected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-15T15:38:56.038+0000","updated":"2009-10-15T15:38:56.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12766102","id":"12766102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Re-spinning this patch, resolving conflict in OLAPTest plus fixed an omission in the new GroupByColumn accept method (to heed any skipChildren).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-15T15:46:13.686+0000","updated":"2009-10-15T15:46:13.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12766228","id":"12766228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"OK, thanks, I'll file a separate bug then.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-15T20:29:48.948+0000","updated":"2009-10-15T20:29:48.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12766247","id":"12766247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Logged as DERBY-4411.\r\n\r\nBy the way, the syntax rules in SQL:2003, part 2, 14.1 <declare cursor> say\r\n\r\n18) If an <order by clause> is specified, then:\r\na) Let OBC be the <order by clause>. Let NSK be the number of <sort specification>s in OBC. For each\r\n   i between 1 (one) and NSK, let Ki be the <sort key> contained in the i-th <sort specification> in OBC.\r\nb) Each Ki shall contain a <column reference> and shall not contain a <subquery> or a <set function\r\n   specification>.\r\n\r\nWhat exactly does this mean? ROW_NUMBER() OVER () doesn't contain a <column reference>, so should ORDER BY ROW_NUMBER() OVER () be rejected because of this? On the other hand, (ROW_NUMBER() OVER () + COL1) does contain a <column reference>, so ORDER BY (ROW_NUMBER() OVER () + COL1) would be fine? I'm sure I'm missing something, but what?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-15T21:00:04.715+0000","updated":"2009-10-15T21:00:04.715+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12766346","id":"12766346","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Yes, that's how I read it, too (no col.ref -> rejection). A window function is explicitly allowed inside an ORDER BY clause, though, cf. SQL 2003:2, section 4.15.3 \"Window functions\":\r\n\r\n\"Window functions may only appear in the <select list> of a <query specification> or <select statement: single row>, or the <order by clause> of a simple table query.\"\r\n\r\nBut Derby is more lenient, allowing <sort key>s without column references, so I think ROW_NUMBER doesn't introduce anything new in this respect, as you found in DERBY-4406 (\"ORDER BY RANDOM()\")","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-16T00:25:09.309+0000","updated":"2009-10-16T00:25:09.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12766452","id":"12766452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I agree. Derby already accepts sort keys without column references, so there's no reason why we should treat ROW_NUMBER differently from any other no-arg function in an ORDER BY clause.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-16T07:40:55.445+0000","updated":"2009-10-16T07:40:55.445+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394334/comment/12769334","id":"12769334","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed derby-3634-newimpl-4 as svn 829155, resolving.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-10-23T18:07:10.287+0000","updated":"2009-10-23T18:07:10.287+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3634/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06v13:"}}