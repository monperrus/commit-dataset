{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12426130","self":"https://issues.apache.org/jira/rest/api/latest/issue/12426130","key":"CASSANDRA-197","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png","name":"New Feature","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-05-22 17:09:52.892","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"10002_*:*_2_*:*_2422705771_*|*_1_*:*_1_*:*_241091_*|*_5_*:*_2_*:*_5526789239_*|*_4_*:*_1_*:*_195986422","customfield_12310420":"27430","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-08-24T23:46:29.185+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-197/watchers","watchCount":0,"isWatching":false},"created":"2009-05-22T17:04:26.662+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-01-31T04:10:16.116+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"For certain applications, it would be nice if a read is sent to a node that owns the data locally. This saves an extra network hop. To do that, a client will need to cache the ring map and use it to figure out the nodes owning a row.\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12417425","id":"12417425","filename":"flexjson.jar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-23T23:19:15.741+0000","size":48995,"mimeType":"application/java-archive","content":"https://issues.apache.org/jira/secure/attachment/12417425/flexjson.jar"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12408824","id":"12408824","filename":"issue197.patchv1","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-05-22T17:08:11.874+0000","size":28405,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12408824/issue197.patchv1"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12417424","id":"12417424","filename":"patch197.v2","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-23T23:19:15.602+0000","size":24678,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12417424/patch197.v2"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12417536","id":"12417536","filename":"patch197.v3","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-24T22:15:08.076+0000","size":24442,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12417536/patch197.v3"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"91019","summary":"Expose ring map to client for more direct access","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":43,"total":43,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712169","id":"12712169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"Attach a patch.\r\n--a new thrift api for obtaining the ring map.\r\n\r\n--a RingCache class for the client to easily cache the ring map.\r\n\r\n--an example test/org.apache.cassandra.service.TestRingCache.java that uses RingCache","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-05-22T17:08:11.899+0000","updated":"2009-05-22T17:08:11.899+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712170","id":"12712170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"patch available for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-05-22T17:08:27.722+0000","updated":"2009-05-22T17:08:27.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712171","id":"12712171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"-1 on violating encapsulation wholesale.\r\n\r\ni could see maybe having a call \"endpoint_for_key\" that gives an ip/port pair for primary node owning a key, but would that be useful enough to bother with?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-05-22T17:09:52.892+0000","updated":"2009-05-22T17:09:52.892+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712176","id":"12712176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"If you look at the original Dynamo paper, it definitely talks about exposing key locations for shorter network path.\r\n\r\nYou can think of RingCache part of the cassandra client library. It's just a cache and only serves as hints. Note that bigtable/Hbase expose the locality to clients too. Ideally, such exposure should be hidden in the client library. However, this is a bit hard to do in Cassandra since the client code is generated by Thrift. In any case, I don't see any harm for exposing such information.\r\n\r\nAs for the endpoint_for_key call, this will force the client to cache the location for every row, which is likely more expensive.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-05-22T17:24:59.625+0000","updated":"2009-05-22T17:24:59.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712179","id":"12712179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"yes, dynamo and bigtable both do that, but we're implementing a much thinner client than they did.  you sometimes have higher latency but it's much easier to write a client.\r\n\r\nI don't think this is something we want to expose.  The mapping between tokens and keys is pluggable and should be treated as a black box by the client.  Violating that encapsulation gives the client a really really big gun with which to shoot himself in the foot for a rather small benefit.  (Oh, you switched from RP to OPP?  Now you have to rewrite all your calls because you were manually mapping keys to nodes, sorry.  Let alone writing your own Partioner.)\r\n\r\nIf you wanted to go for a more dynamo-like experience you could add a \"gossip only\" mode where a client \"node\" asks to be part of the gossip network but with no token of its own.  That way it would be as current as the rest of the cluster about ring status, and it would be very clear that if you were writing this kind of client you need to know cassandra internals and There Be Dragons Here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-05-22T17:42:57.093+0000","updated":"2009-05-22T17:42:57.093+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712216","id":"12712216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"What you said in the paragraph is not completely true. The purpose of RingCache is exactly to hide the detailed configurations from the client. RingCache picks up the setting from the server configuration file so it will adjust to things like partitioner changes (which likely require both server and client restart) accordingly. The client code doesn't have to change at all. Take a look at test/org.apache.cassandra.service.TestRingCache.java and see what you think.\r\n\r\nAlso, the RingCache layer is much thinner compared with the thrift client.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-05-22T19:06:57.888+0000","updated":"2009-05-22T19:06:57.888+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712249","id":"12712249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Okay, so you're kind of taking a hybrid approach where the \"client\" is including large parts of the cassandra server code, and needs the server config file, but doesn't actually get the benefits of being part of the gossip layer.\r\n\r\nI think that's fine as a halfway measure that you can use privately but the \"right thing\" is to go the other 10% of the way towards being a member of the cluster instead of hacking some of the data out via the client API.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-05-22T20:47:30.842+0000","updated":"2009-05-22T20:47:30.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712293","id":"12712293","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"I am not sure if we should make client a member of the cluster and receive all the gossiped messages. For request routing, the client only cares about the event of adding/removing nodes, which is infrequent. Making client a member of the cluster exposes it to way too many irrelevant messages. An out-of-date cached ring map only affects performance, not correctness. In practice, it's probably good enough for each client to simply refresh its cached ring map, say once per hour.\r\n\r\nAs for that the client has to include the server code and config file, I don't think it's a big deal. The server jar is already needed for java clients today and a client has to be aware of the thrift port. Further, each client has to explicitly maintain a list of cassandra servers to connect to (RingCache obviates that).\r\n\r\nIt is a bit awkward to expose the getRIngMap api in thrift, since only the client library really needs to see it, not the actual client code. However, thrift seems to be the only simple way for a client to talk to the server. MessageService is too heavy to use just for infrequent server calls. Could we just document that the api is not intended for direct client usage?\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-05-22T22:25:02.535+0000","updated":"2009-05-22T22:25:02.535+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712624","id":"12712624","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"It makes no sense to incur the disadvantages of making your client an add-on to the server code without going all the way.  The server already has perfectly good connection pooling code; it makes sense to use that instead of creating a separate pooling mechanism.  Nor does it make sense when you are building off the server jars to go through the extra thrift serialization; make the calls directly via MessagingService.\r\n\r\nThe right way to do this is to make the tweaks to the gossip layer necessary to let a specialized server-client get token ring information with server-level APIs.  I'm strongly against the kludge of doing this at the client layer.  Since the only consumers of that API will necessarily have access to the server codebase, keeping it in server APIs makes the most sense, and we already have an server API for distributing token information.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-05-25T02:03:39.249+0000","updated":"2009-05-25T02:03:39.249+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712836","id":"12712836","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeep_tata","name":"sandeep_tata","emailAddress":"sandeep dot tata at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Tata","active":true},"body":"I'd be +1 on supporting an endpoint-for-key call in the API. \r\n\r\nThat might be a good compromise between not including a lot of server code in the client, and still allowing the client the flexibility to behave in a more efficient way should it choose to.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeep_tata","name":"sandeep_tata","emailAddress":"sandeep dot tata at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Tata","active":true},"created":"2009-05-26T03:14:13.626+0000","updated":"2009-05-26T03:14:13.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712847","id":"12712847","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I don't think there's any question that if we had a patch adding the gossip feature I am positing, vs this one, that the gossip one is the Right Approach to take.  The only problem is that that is tricky code. :)\r\n\r\nIf you think about it that way, then I think it's clear that this patch is fine to use locally as a kludge to achieve what you want but it's not something we want to support as part of 0.4 and beyond.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-05-26T04:28:18.050+0000","updated":"2009-05-26T04:28:18.050+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12712851","id":"12712851","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeep_tata","name":"sandeep_tata","emailAddress":"sandeep dot tata at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Tata","active":true},"body":"The client participating in the gossip protocol without actually grabbing tokens is an interesting idea, but I'm not sure how it will work for non Java clients. What happens to python and ruby clients ? Will this be a Java-only option?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sandeep_tata","name":"sandeep_tata","emailAddress":"sandeep dot tata at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sandeep Tata","active":true},"created":"2009-05-26T04:42:34.680+0000","updated":"2009-05-26T04:42:34.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12713034","id":"12713034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"It will be a JVM-only option since that is what the server runs on, but that's less of an issue than you might think given how many languages have excellent JVM implementations (JRuby, Jython, ...)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-05-26T14:44:17.004+0000","updated":"2009-05-26T14:44:17.004+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12713091","id":"12713091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"I feel like that we are mixing the discussion of things at different levels. As a result, it is hard to see where the disagreement is. So, Let me step back and put an outline for further discussion.\r\n\r\n1. Should we expose any locality to the client?\r\n\r\n2. If we agree that some sort of locality is needed, what is the right api (independent of the implementation) to support such locality? I see two options here: expose per key locality or expose the whole ring map.\r\n\r\n3. Finally what is the right way to implement locality? One option is to use thrift. With this option, the client has to pull periodically to refresh locality information. Another option is to extend MessageService. With this option, the server can potentially push new locality information to the client (when changes occur).\r\n\r\nLet's discuss each of these a bit further and see if we can reach an agreement.\r\n\r\nHere is my opinion on those.\r\nFor 1, I strongly support exposing locality to clients for better performance. Some of my preliminary tests showed up to 50% improvement for simple get_column calls when locality is enabled.\r\n\r\nFor 2, I favor exposing the whole ring map. The main reason is that this makes invalidating locations cached at the client easier and potentially cheaper.\r\n\r\nFor 3, I can see the benefit of using extended MessageService. I am not exactly sure what it takes to implement such an extension though.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-05-26T16:35:42.524+0000","updated":"2009-05-26T16:35:42.524+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12713143","id":"12713143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"The problem is \"client\" in a loose sense means \"anything that can add data to or request data from the system.\"  So each cassandra node can be considered a \"client\" of the others which is meaningless.\r\n\r\nSo to me when I say a \"client level api\" I strictly mean one we expose via thrift to processes that are not expected to know anything about the Cassandra internals.  As soon as you say \"we should expose this to the client, but it will need to use (non-thrift) org.apache.cassandra classes and the server .xml file\" then we are in violation of this implicit contract.\r\n\r\nSo:\r\n\r\nNo, we should not expose any internals to thrift-based clients.  Other \"client\" processes based on the server internals can of course make use of those internals as much as they want, and the best way to do this is to have them use the existing apis as much as possible rather than adding hacks to shuttle some of this state from one server process to another via thrift.  Using the exising APIs promotes clean design and avoids other \"wheel re-invention\" problems as I described above.  (\"The server already has perfectly good connection pooling code; it makes sense to use that instead of creating a separate pooling mechanism. Nor does it make sense when you are building off the server jars to go through the extra thrift serialization; make the calls directly via MessagingService [i.e., storageproxy].\")\r\n\r\nSo having thought things through it is clear to me that my earlier suggestion (\"i could see maybe having a call \"endpoint_for_key\" that gives an ip/port pair for primary node owning a key\") is also a poor one, and I withdraw it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-05-26T17:32:58.666+0000","updated":"2009-05-26T17:32:58.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12713381","id":"12713381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"body":"\"So to me when I say a \"client level api\" I strictly mean one we expose via thrift to processes that are not expected to know anything about the Cassandra internals. As soon as you say \"we should expose this to the client, but it will need to use (non-thrift) org.apache.cassandra classes and the server .xml file\" then we are in violation of this implicit contract.\"\r\n\r\nI agree with this. In fact, I was concerned we doing exactly that (violating this implicit contract) when we added the new block_for arguments which assume client-side knowledge of the replication policy.\r\n\r\nPersonally, I'd hate to see us go any further in this direction.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"created":"2009-05-27T02:38:46.988+0000","updated":"2009-05-27T02:38:46.988+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12724914","id":"12724914","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Eric, how does Voldemort handle this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-06-28T00:48:47.590+0000","updated":"2009-06-28T00:48:47.590+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12725212","id":"12725212","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"body":"Voldemort does have an rpc'ish remote API like we do, and then they have a \"thick client\". \r\n\r\nThe thick client uses the same bootstrapping mechanism that nodes do so it knows each of them, their location in the ring, which partitions they are responsible for, etc. It knows of all the configured stores, the replication policy, and the serialization used for keys and values. \r\n\r\nReads and writes are made directly against the nodes, so for example, if you do a read where R=3, the client API determines where all of the copies are and attempts to fetch 3 of them concurrently.  If the corresponding store is configured for string serialization of the key and java serialization of values, the client API transparently de-serializes them accordingly.\r\n\r\nObviously the thick client and the nodes share a great deal of common code, which means it is Java-only. \r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"created":"2009-06-29T15:15:08.953+0000","updated":"2009-06-29T15:15:08.953+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12725221","id":"12725221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I tried to google this but was stymied by the Rowling fanboys' seo noise:\r\n\r\nDoes Voldemort make the fat clients part of the gossip network, or do the clients periodically refresh from the server nodes?  Does Voldemort even use gossip?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-06-29T15:39:55.780+0000","updated":"2009-06-29T15:39:55.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12725232","id":"12725232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"body":"Voldemort does not use gossip, no. In fact, when last I looked at it, there was no failure detection at all. Each node is configured with the same list as the others, the thick client uses one or more seeds to fetch that list from a special store using the same get() semantics as any other object.\r\n\r\nA cassandra thick client could learn the ring via gossip and utilize the same failure detection, but obviously there'd need to be some sort of distinction since the client isn't part of the ring. I suppose you could also periodically poll this information from one or more of the nodes, but that sounds ugly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"created":"2009-06-29T16:13:30.611+0000","updated":"2009-06-29T16:13:30.611+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12744208","id":"12744208","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"How about exposing the token-to-node map through the get_string_property() API?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-17T21:21:16.305+0000","updated":"2009-08-17T21:21:16.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12744266","id":"12744266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-08-17T23:06:01.443+0000","updated":"2009-08-17T23:06:01.443+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12744528","id":"12744528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"body":"How is the client going to know the Partitioner, ReplicaPlacementStrategy, and ReplicationFactor? Are non-java clients expected to re-implement the Partitioner and ReplicaPlacementStrategy? \r\n\r\nUnless I'm missing something, a token-to-node map doesn't seem very useful in the general sense without these.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"created":"2009-08-18T14:48:09.706+0000","updated":"2009-08-18T14:48:09.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12744543","id":"12744543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"I was thinking of putting the RingCache code in contrib. RingCache will reuse the partitioner etc code in the server, to determine which nodes a given key is mapped into. This will be a java-only solution for now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-18T15:12:44.154+0000","updated":"2009-08-18T15:12:44.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12746084","id":"12746084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=euphoria","name":"euphoria","emailAddress":"michael dot greene at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Greene","active":true},"body":"It looks like we'll be going with the more limited string property version.  Re-opening.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=euphoria","name":"euphoria","emailAddress":"michael dot greene at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Greene","active":true},"created":"2009-08-21T16:53:51.760+0000","updated":"2009-08-21T16:53:51.760+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12746410","id":"12746410","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"body":"Michael, is that comment still correct in light of CASSANDRA-342?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"created":"2009-08-22T04:25:14.573+0000","updated":"2009-08-22T04:25:14.573+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12746415","id":"12746415","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=euphoria","name":"euphoria","emailAddress":"michael dot greene at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Greene","active":true},"body":"I'm not exactly sure as I haven't been following this issue closely, but it sure sounds like it:\r\n(from CASSANDRA-342) \"We already have a proposal from Jun over in #197 to expose the ring as a string property, and (presumably) load it into a storageservice. Which would more or less take care of things, although the separation could be cleaner\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=euphoria","name":"euphoria","emailAddress":"michael dot greene at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Greene","active":true},"created":"2009-08-22T05:37:20.286+0000","updated":"2009-08-22T05:37:20.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12746517","id":"12746517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"body":"I'm assuming then that the type of the return value of get_string_property (or get_string_list_property) would change to accommodate a map instead of a simple string? Or am I missing something?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"created":"2009-08-22T22:55:22.083+0000","updated":"2009-08-22T22:55:22.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12746541","id":"12746541","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=euphoria","name":"euphoria","emailAddress":"michael dot greene at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Greene","active":true},"body":"The table description get_string_property returns a multi-level dictionary encoded as JSON would.  I'm not sure I agree with the 'non-official APIs need to be strings' de facto policy but if it stands I'd imagine we would also encode the return for this call like JSON would.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=euphoria","name":"euphoria","emailAddress":"michael dot greene at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Greene","active":true},"created":"2009-08-23T01:46:06.390+0000","updated":"2009-08-23T01:46:06.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12746691","id":"12746691","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"v2 patch:\r\n1. Extended get_string_property to support querying \"token map\". The returned string is a JSON encoded <token, host> map.\r\n2. A new class RingCache that caches the token map in a java application. RingCache uses storage-conf.xml to obtain things like seeds, various ports, the partitioning strategy, and the replication factor. During initialization, RingCache makes a get_string_property call to the seed node to get the initial token-to-host map. It then reuses the logic in the server to map a row key to a list of hosts owning the row. If the token map changes, it's the application's responsibility to refresh RingCache by calling refreshEndPointMap(). RingCache doesn't start a Cassandra instance and can be embedded in any java application. \r\n3. An example of how to use RingCache is provided at test/unit/org.apache.cassandra.client.TestRingCache. For Hadoop integration, one can use RingCache in InputFormat to generate splits with locality.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-23T23:19:15.745+0000","updated":"2009-08-23T23:19:15.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12746940","id":"12746940","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1 on the approach in general.  some nits:\r\n\r\n        partitioner_ = DatabaseDescriptor.getPartitioner();\r\n\r\ninline this in declaration\r\n\r\n        Map<Token,EndPoint>endpointMap\r\n\r\nspacing\r\n\r\n        for (String seed : seeds_)\r\n\r\nshouldn't this break after getting an answer?  shouldn't need to contact all seeds each time\r\n\r\n    private void retrofitPorts(EndPoint endPoints[])\r\n\r\nthis should be encapsulated in tokenmetadata (yeah, I know it's that way in existing code) -- have a cloneControl and cloneStorage method instead of forcing consumers of the api to know that they need to do this \"magic\" fixup later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-08-24T16:21:47.264+0000","updated":"2009-08-24T16:21:47.264+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747106","id":"12747106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"patch v3. Fixed all the above comments.\r\n\r\nAlso, the retrofitport code in AbstractStrategy doesn't seem to be necessary since all EndPoints registered to tokenMetaData are already initialized to storagePort. We probably need to open another ticket to fix that.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-24T22:15:08.094+0000","updated":"2009-08-24T22:15:08.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747108","id":"12747108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"    private static Logger LOG = Logger.getLogger(RingCache.class);\r\n\r\ncan we make this final and rename to \"logger\" for consistency w/ the rest of the code base?\r\n\r\n        EndPoint[] endPoints = nodePicker_.getStorageEndPoints(partitioner_.getToken(key));\r\n        return endPoints;\r\n\r\njust \"return nodePicker_.getStorageEndPoints(partitioner_.getToken(key))\" is fine now that retrofitports is unnecessary.\r\n\r\nthese are minor, so +1 on committing w/o a new patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-08-24T22:22:54.589+0000","updated":"2009-08-24T22:22:54.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747111","id":"12747111","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"body":"I'm really hesitant about pushing JSON through a string. We're going to be using this extensively in the hadoop code, why not just make it a real endpoint and lose the JSON library? I can whip up a patch tonight. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"created":"2009-08-24T22:30:15.305+0000","updated":"2009-08-24T22:30:15.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747116","id":"12747116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"> I'm really hesitant about pushing JSON through a string.\r\n\r\nWhy?  That's what it's designed for.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-08-24T22:36:09.071+0000","updated":"2009-08-24T22:36:09.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747117","id":"12747117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"Well, to return an endpoint map directly, we need to add a new thrift api. Also, to use RingCache with Hadoop, you already need to make the cassandra jar and all its dependent jars available to Hadoop, so adding another json library doesn't seem like a bit deal.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-24T22:38:18.757+0000","updated":"2009-08-24T22:38:18.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747142","id":"12747142","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"Committed with minor fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-24T23:46:29.168+0000","updated":"2009-08-24T23:46:29.168+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747149","id":"12747149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"body":"I find it very odd that we think we're going to \"hide\" functionality through an obscure endpoint. And we actually want this to a) be simple to implement a client side to and b) \"look and act\" like the rest of the client code because we're going to use it for the hadoop code.\r\n\r\nThe combination of this rather odd idea that we can \"hide\" functionality by making it harder on someone to use it and having to actually need it and want it working well for our own uses seem to be counter to one another. Why not just make it easier on ourselves, and make it clean and simple?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"created":"2009-08-25T00:05:53.576+0000","updated":"2009-08-25T00:05:53.576+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747153","id":"12747153","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"The intention of the new class RingCache is to make it easy to exploit the exposed endpoint map. You just need to instantiate it and then call getEndPoint() to get the endpoints for a given key. Take a look at it and see if it fits your need.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-25T00:15:52.569+0000","updated":"2009-08-25T00:15:52.569+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747164","id":"12747164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"body":"It doesn't for reasons already discussed in CASSANDRA-342. See https://issues.apache.org/jira/browse/CASSANDRA-342?focusedCommentId=12745809&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12745809","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jmhodges","name":"jmhodges","emailAddress":"jeff at somethingsimilar dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hodges","active":true},"created":"2009-08-25T00:50:31.840+0000","updated":"2009-08-25T00:50:31.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747170","id":"12747170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"body":"From the tokenToEndpoint map, it's not too hard to create the RangeToNodes map. You can reuse the logic in the server by making methods like StorageService.getAllRanges() static.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=junrao","name":"junrao","emailAddress":"junrao at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jun Rao","active":true},"created":"2009-08-25T01:27:37.047+0000","updated":"2009-08-25T01:27:37.047+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747171","id":"12747171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"> It doesn't [fit Jeff's needs] for reasons already discusse\r\n\r\nI don't follow.  Over in CASSANDRA-342 I see\r\n\r\n[Stu] Good call... the RingCache mentioned on CASSANDRA-197 is exactly what this ticket needs.\r\n\r\n[Jeff] Yep, that is exactly what I was thinking about. I'll nose myself around over there.\r\n\r\nI don't see where you explain how this doesn't work.  I'm sure I'm just missing something.\r\n\r\n> I find it very odd that we think we're going to \"hide\" functionality through an obscure endpoint. And we actually want this to a) be simple to implement a client side to and b) \"look and act\" like the rest of the client code\r\n\r\nNo\r\n\r\n> because we're going to use it for the hadoop code.\r\n\r\nYes.  One rule of API design is to make it easy to do the right thing and hard to do the wrong one.  99% of clients should not use this API and we do not want to encourage them.  Only Hadoop and some very specialized apps will want or need it.  Read Eric's comments above; this is not code that any Thrift client can just use with or without a \"real\" Thrift api; it requires embedding nontrivial parts of the Cassandra server (hence, the jvm as well, which immediately rules out many Thrift consumers).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-08-25T01:29:37.941+0000","updated":"2009-08-25T01:29:37.941+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12426130/comment/12747433","id":"12747433","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #177 (See [http://hudson.zones.apache.org/hudson/job/Cassandra/177/])\r\n    Expose ring map to client for more direct access; patch by junrao; reviewed by jbellis for \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2009-08-25T14:21:27.498+0000","updated":"2009-08-25T14:21:27.498+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-197/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0fxgn:"}}