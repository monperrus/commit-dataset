{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12333235","self":"https://issues.apache.org/jira/rest/api/latest/issue/12333235","key":"DERBY-1292","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-05-06 06:26:02.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22416","customfield_12310222":"3_*:*_1_*:*_1030888000_*|*_1_*:*_1_*:*_8955293000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_40691311424","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-08-29T09:56:24.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1292/watchers","watchCount":1,"isWatching":false},"created":"2006-05-05T20:00:03.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-12-13T09:04:55.423+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11690","id":"11690","name":"Network Client"}],"timeoriginalestimate":null,"description":"java.lang.ClassCastException: java.lang.String\n\tat org.apache.derby.client.net.NetStatementRequest.computeProtocolTypesAndLengths(Unknown Source)\n\tat org.apache.derby.client.net.NetStatementRequest.buildSQLDTAcommandData(Unknown Source)\n\tat org.apache.derby.client.net.NetStatementRequest.writeExecute(Unknown Source)\n\tat org.apache.derby.client.net.NetPreparedStatement.writeExecute_(Unknown Source)\n\tat org.apache.derby.client.am.PreparedStatement.writeExecute(Unknown Source)\n\tat org.apache.derby.client.am.PreparedStatement.executeBatchRequestX(Unknown Source)\n\tat org.apache.derby.client.am.PreparedStatement.executeBatchX(Unknown Source)\n\tat org.apache.derby.client.am.PreparedStatement.executeBatch(Unknown Source)\n\tat CCEBatchUpdateRepro.doInserts(CCEBatchUpdateRepro.java:71)\n\tat CCEBatchUpdateRepro.main(CCEBatchUpdateRepro.java:27)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39696","summary":"ClassCastException in ClientDriver when using CLOB columns and batch updates","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gekhin","name":"gekhin","emailAddress":"g dot khin at ids-scheer dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gerald Khin","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gekhin","name":"gekhin","emailAddress":"g dot khin at ids-scheer dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gerald Khin","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":17,"total":17,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12378023","id":"12378023","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gekhin","name":"gekhin","emailAddress":"g dot khin at ids-scheer dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gerald Khin","active":true},"body":"Here is a repro:\r\n\r\nimport java.sql.Connection;\r\nimport java.sql.DriverManager;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.SQLException;\r\nimport java.sql.Statement;\r\nimport java.sql.Types;\r\n\r\npublic class CCEBatchUpdateRepro {\r\n\r\n    public static void main(String[] args) {\r\n        \r\n        try {\r\n            Class.forName(\"org.apache.derby.jdbc.ClientDriver\");\r\n        }\r\n        catch(ClassNotFoundException e) {\r\n            e.printStackTrace();\r\n            System.exit(1);\r\n        }\r\n\r\n        Connection conn = null;\r\n        try {\r\n            conn = DriverManager.getConnection(\"jdbc:derby://localhost:1527/TESTDB\");;\r\n            conn.setAutoCommit(false);\r\n            \r\n            createTable(conn);\r\n\r\n            doInserts(conn);\r\n            \r\n            conn.rollback();\r\n            conn.close();\r\n        }\r\n        catch(Exception e) {\r\n            e.printStackTrace();\r\n            System.exit(1);\r\n        }\r\n        finally {\r\n            if (conn != null) {\r\n                try {\r\n                    conn.rollback();\r\n                    conn.close();\r\n                }\r\n                catch (Exception ex) {\r\n                }\r\n            }\r\n        }\r\n        \r\n        System.exit(0);\r\n    }\r\n    \r\n    private static void createTable(Connection conn) throws SQLException {\r\n        final Statement stmt = conn.createStatement();\r\n        \r\n        try {\r\n            stmt.execute(\"CREATE TABLE CCE_REPRO(text1 VARCHAR(100), text2 CLOB)\");\r\n        }\r\n        finally {\r\n            stmt.close();\r\n        }\r\n    }\r\n\r\n    private static void doInserts(Connection conn) throws SQLException {\r\n        final PreparedStatement stmt = conn.prepareStatement(\"INSERT INTO CCE_REPRO(text1,text2) VALUES (?,?)\");\r\n        \r\n        try {\r\n            stmt.setNull(1, Types.VARCHAR);\r\n            stmt.setString(2, \"clob\");\r\n            stmt.addBatch();\r\n            \r\n            stmt.setString(1, \"varchar\");\r\n            stmt.setNull(2, Types.CLOB);\r\n            stmt.addBatch();\r\n            \r\n            stmt.executeBatch();\r\n            stmt.close();\r\n        }\r\n        finally {\r\n            stmt.close();\r\n        }\r\n    }\r\n}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gekhin","name":"gekhin","emailAddress":"g dot khin at ids-scheer dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gerald Khin","active":true},"created":"2006-05-05T20:02:43.000+0000","updated":"2006-05-05T20:02:43.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12378169","id":"12378169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I was successfully able to reproduce your ClassCastException on the current trunk. Here's the stack trace from the current trunk, with line numbers:\r\n\r\njava.lang.ClassCastException\r\n        at org.apache.derby.client.net.NetStatementRequest.computeProtocolTypesAndLengths(NetStatementRequest.java:1204)\r\n        at org.apache.derby.client.net.NetStatementRequest.buildSQLDTAcommandData(NetStatementRequest.java:518)\r\n        at org.apache.derby.client.net.NetStatementRequest.writeExecute(NetStatementRequest.java:137)\r\n        at org.apache.derby.client.net.NetPreparedStatement.writeExecute_(NetPreparedStatement.java:172)\r\n        at org.apache.derby.client.am.PreparedStatement.writeExecute(PreparedStatement.java:1403)\r\n        at org.apache.derby.client.am.PreparedStatement.executeBatchRequestX(PreparedStatement.java:1879)\r\n        at org.apache.derby.client.am.PreparedStatement.executeBatchX(PreparedStatement.java:1798)\r\n        at org.apache.derby.client.am.PreparedStatement.executeBatch(PreparedStatement.java:1256)\r\n        at repro.doInserts(repro.java:74)\r\n        at repro.main(repro.java:28)\r\n\r\nLine 1204 of NetStatementRequest.java is this:\r\n\r\n   java.sql.Clob c = (java.sql.Clob) inputRow[i];\r\n\r\nInterestingly, I have to have *both* of the batch elements to make the bug happen. If I comment out either\r\nthe first group of 3 lines in the doInserts() try block, or if I comment out the second group of lines in the\r\ndoInserts() try block, the bug does not occur. It only occurs when *both* batch elements are present in\r\nthe batch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-05-06T06:26:02.000+0000","updated":"2006-05-06T06:26:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12378225","id":"12378225","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think there is a design issue here with respect to the PreparedStatement data structures, \r\nand the handling of batch operations.\r\n\r\nPreparedStatement.java records information about the types of the various columns in the \r\nstatement using a ColumnMetadata object named parameterMetaData_:\r\n\r\n  public ColumnMetaData parameterMetaData_; // type information for input sqlda\r\n\r\nBut in the batch statement scenario, each batch element can have a different set of data \r\ntype information. For example, in the reproduction program provided by Gerald Khin,\r\nthe first batch element has the type information (column1:Varchar, column2: String),\r\nwhile the second batch element has the type information (column1:String, column2:Clob).\r\n\r\nThe PreparedStatement appears to have a \"last element wins\" result here: each set of\r\nstmt.setString/stmt.setNull/stmt.setObject/etc. calls resets the values in the\r\nparameterMetaData_ object, so that when we reach the executeBatch call, the values\r\nin the parameterMetaData_ object record the types of the *last* batch element.\r\n\r\nBut then the executeBatch call proceeds to use those types to interpret the data, starting\r\nwith the *first* batch element.\r\n\r\nIn the case of the repro script, this causes us to try to interpret the string \"clob\" as a Clob.\r\n\r\nIf you change the repro program by replacing the Types.CLOB call in the second batch\r\nelement with Types.INTEGER, then you get a different ClassCastException elsewhere\r\nin the client code, as the code tries to interpret the string \"clob\" as an Integer.\r\n\r\nI suspect that, in the batch execution case, the client code cannot use just a single\r\nparameterMetaData_ member in the PreparedStatement object, but rather needs to\r\nhave a collection of ColumnMetaData instances, one for each batch element, and\r\nthe addBatch() operation needs to add a ColumnMetaData instance to the collection,\r\nrather than simply re-using the same parameterMetaData_ instance.\r\n\r\nFor the meantime, the workaround is to use the same type signatures in each\r\nbatch element. For example, the program will work, correctly, if Types.CLOB in the\r\nsecond batch element is replaced by Types.VARCHAR. As long as you use the\r\nsame types uniformly in each batch element, you can get your application to work.\r\n\r\nI will investigate a patch to the batch element handling in the client.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-05-06T22:33:46.000+0000","updated":"2006-05-06T22:33:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12378226","id":"12378226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The use of a collection of type information with an entry for each batch element\r\nappears to be the solution chosen by the embedded driver. Here is a comment\r\nfrom the addBatch() method in EmbedPreparedStatement.java:\r\n\r\n   //get a clone of the parameterValueSet and save it in the vector\r\n   //which will be used later on at the time of batch execution.\r\n   //This way we will get a copy of the current statement's parameter\r\n   //values rather than a pointer to the statement's parameter value\r\n   //set which will change with every new statement in the batch.\r\n\r\nSo this feels like the correct solution to pursue in the client.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-05-06T22:39:47.000+0000","updated":"2006-05-06T22:39:47.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12378302","id":"12378302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"ColumnMetaData does not seem to support a \"clone\" operation, unfortunately.\r\nSo I think I'll need to write one first. And that seems like more than just a\r\ncouple lines of code, because the ColumnMetaData class is full of lots of\r\narrays and collections and so forth. Is there a simpler way?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-05-07T23:30:43.000+0000","updated":"2006-05-07T23:30:43.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12378556","id":"12378556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I'm not going to have time to pursue this further for a while. Marking it unassigned\r\nin case somebody else wants to pick it up.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-05-09T09:24:03.000+0000","updated":"2006-05-09T09:24:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12423400","id":"12423400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"Since this is a show stopper for a project that I am working on, I would be happy to work on this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2006-07-25T18:27:32.000+0000","updated":"2006-07-25T18:27:32.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12428653","id":"12428653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"The attached patch contains the following:\r\n\r\n1) The addition of a copy method to org.apache.derby.client.am.ColumnMetaData.\r\n2) Modifications to org.apache.derby.client.am.PreparedStatement to hold on to a copy of the column meta data for each entry used in batch updates.\r\n3) A test was added to org.apache.derbyTestingfunctionTests.tests.derbynet.prepStmt.\r\n\r\nI ran derbynet/prepStmt as well as derbyall and did not see any new failures.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2006-08-17T13:32:53.000+0000","updated":"2006-08-17T13:32:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12429487","id":"12429487","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"The uploaded patch is ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2006-08-21T18:43:02.000+0000","updated":"2006-08-21T18:43:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12430012","id":"12430012","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Thanks, for working on this patch\r\n\r\nI have verified that the patch works, but I am a bit concerned with\r\nthe copying overhead this patch introduces.  The entire ColumnMetaData\r\nis copied, but it is only clientParamterType that will be changing\r\nbetween statements of a batch.  It should be sufficient to copy just\r\nthis array.  (IMO, this is an indication that clientParamterType\r\nshould not have been part of ColumnMetaData in the first place.\r\nAlmost all of the data in ColumnMetaData is received from the server\r\nas part of a prepare and that data is never changed by the client.\r\nclientParamterType (note the typo) on the other hand is set by the\r\nclient between executions or for each statement of a batch. It would\r\nhave been best if these two issues were separated, but I guess that is\r\na bit beyond what one can expect from a bug fix.)\r\n\r\nTo the implementation:\r\n\r\n1. I suggest making a list of just clientParamterType arrays, not\r\n   ColumnMetadata.\r\n\r\n2. I suggest not allocating this list until it is actually needed.\r\n   (No need to pay a penalty for clients not using batches.)  That is,\r\n   in addBatch do:\r\n      if (parameterTypeList == null) { \r\n          parameterTypeList = new ArrayList();\r\n      }\r\n\r\n3. Since clientParamterType is an int[], a shallow copy is sufficient.\r\n   Hence, there should be no need for a separate copy method. Instead,\r\n   you can just do:\r\n      parameterTypeList.add(parameterMetaData.clientParamtertype_.clone());\r\n\r\n4. Since the same bug exists in the IBM driver, your new test will\r\n   fail when running with this driver.  You can disable your test for\r\n   this framework by this if-test:\r\n       if (!TestUtil.isJCCFramework()) { jira1292test(); }\r\n\r\n5. I am not that fond of test names with bug numbers.  I would prefer\r\n   a name that described what was tested, but I see that bug numbers\r\n   is the pattern for this test, so I will not demand that you change\r\n   this.  (However, it is not very useful when the code refers to bug\r\n   reports in a system that is no longer in use.)  At least, add a\r\n   comment explaining what you are testing.\r\n\r\n6. I would think it would be useful to execute your test case also in\r\n   an embedded context.  Hence, I suggest to add it to the\r\n   jdbcapi/batchUpdate.java test instead.  That way, derbyall will run\r\n   the test case in both embedded and client/server.\r\n\r\n7. Nit pick: You have a comment line that is a bit above 80 characters.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2006-08-23T14:05:39.000+0000","updated":"2006-08-23T14:05:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12430315","id":"12430315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"Thanks for the review Øystein.  I have one question about item 6.  It appears that the jdbcapi/batchUpdate.java test is skipped when using the DerbyNetClient framework.  Should I add the test to both derbynet/perpStmt.java and jdbcapi/batchUpdate?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2006-08-24T19:43:37.000+0000","updated":"2006-08-24T19:43:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12430684","id":"12430684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"I have uploaded a new patch for review. \r\nI believe it addresses the issues raised with the previous patch.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2006-08-26T02:52:30.000+0000","updated":"2006-08-26T02:52:30.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12431049","id":"12431049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"I have reviewed the new version of the patch and the code looks fine (except for the minor issue of lines longer than 80 characters).  I have checked that it is fixes the bug, and also that it fixes the problem in the reproduction case for the duplicate bug report, DERBY-1321.  derbyall also ran without errors for this patch.  I recommend that a committer commits this patch.\r\n\r\nIf you wnat this patch to be included in the upcoming 10.2 version, you will need to lobby the release manager in order to get it ported to the 10.2 branch.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2006-08-28T20:01:56.000+0000","updated":"2006-08-28T20:01:56.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12431062","id":"12431062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Patch DERBY-1292-v2.diff Committed revision 437822 - Thanks James.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-28T20:45:55.000+0000","updated":"2006-08-28T20:45:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12431150","id":"12431150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I am running tests on 10.2 and will merge the fix into the 10.2 branch when they have completed successfully. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2006-08-29T06:36:50.000+0000","updated":"2006-08-29T06:36:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12431201","id":"12431201","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed into 10.2 with revision 438037.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2006-08-29T09:56:24.000+0000","updated":"2006-08-29T09:56:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12333235/comment/12551339","id":"12551339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"This issue has been resolved for over a year with no further movement. Closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2007-12-13T09:04:55.422+0000","updated":"2007-12-13T09:04:55.422+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1292/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i075qn:"}}