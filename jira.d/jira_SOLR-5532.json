{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12682942","self":"https://issues.apache.org/jira/rest/api/latest/issue/12682942","key":"SOLR-5532","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325762","id":"12325762","description":"Bugfix release after 4.6","name":"4.6.1","archived":false,"released":true,"releaseDate":"2014-01-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12325573","id":"12325573","description":"Major release after 4.6","name":"4.7","archived":false,"released":true,"releaseDate":"2014-02-26"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321664","id":"12321664","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-12-05 18:12:43.86","customfield_12312323":null,"customfield_12310420":"362199","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2693422399_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-01-05T21:02:13.453+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5532/watchers","watchCount":5,"isWatching":false},"created":"2013-12-05T16:51:51.089+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325000","id":"12325000","description":"Major release after 4.5","name":"4.6","archived":false,"released":true,"releaseDate":"2013-11-24"}],"issuelinks":[{"id":"12379601","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379601","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12683071","key":"SOLR-5537","self":"https://issues.apache.org/jira/rest/api/2/issue/12683071","fields":{"summary":"changing solr version 4.5.1 to 4.6.0 getting error","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png","name":"New Feature","subtask":false}}}},{"id":"12379602","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379602","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12683072","key":"SOLR-5538","self":"https://issues.apache.org/jira/rest/api/2/issue/12683072","fields":{"summary":"changing solr version 4.5.1 to 4.6.0 getting error","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png","name":"New Feature","subtask":false}}}},{"id":"12379609","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379609","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"inwardIssue":{"id":"12559914","key":"SOLR-3530","self":"https://issues.apache.org/jira/rest/api/2/issue/12559914","fields":{"summary":"better error messages / Content-Type validation in solrJ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-10-29T14:08:16.296+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"due to SOLR-3530, HttpSolrServer now does a string equivilence check between the \"Content-Type\" returned by the server, and a getContentTYpe() method declared by the ResponseParser .. but string equivilence is too strict, and can result in errors like this one reported by a user....\r\n\r\n----\r\n\r\nI just upgraded my Solr instance and with it I also upgraded the solrj library in our custom application which sends diverse requests and queries to Solr.\r\n\r\nI use the \"ping\" method to determine whether Solr started correctly under the configured address. Since the upgrade the ping response results in an error:\r\n{code:xml}\r\nCause: org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: Expected content type application/xml; charset=UTF-8 but got application/xml;charset=UTF-8.\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<response>\r\n<lst name=\"responseHeader\"><int name=\"status\">0</int><int name=\"QTime\">0</int><lst name=\"params\"><str name=\"df\">searchtext</str><str name=\"echoParams\">all</str><str name=\"rows\">10</str><str name=\"echoParams\">all</str><str name=\"wt\">xml</str><str name=\"version\">2.2</str><str name=\"q\">solrpingquery</str><str name=\"distrib\">false</str></lst></lst><str name=\"status\">OK</str>\r\n</response>\r\n{code}\r\n\r\nThe Solr application itself works fine.\r\nUsing an older version of the solrj library than solr-solrj-4.6.0.jar (e.g. solr-solrj-4.5.1.jar) in the custom application does not produce this error.\r\n\r\nThe Exception is produced in a Code block (_HttpSolrServer.java_, method _request(...)_, around. line 140) which has been introduced with version 4.6.0.\r\n\r\nCode to reproduce the error:\r\n{code}\r\ntry {\r\n\tHttpSolrServer solrServer = new HttpSolrServer(\"http://localhost:8080/Solr/collection\");\r\n\tsolrServer.setParser(new XMLResponseParser()); // this line is making all the difference\r\n\tsolrServer.ping();\r\n} catch (Exception e) {\r\n\te.printStackTrace();\r\n}\r\n{code}\r\n\r\nA global search for \"charset=UTF-8\" on the source code of solrj indicates that other functions besides \"ping\" might be affected as well, because there are several places where \"application/xml; charset=UTF-8\" is spelled without a space after the semicolon.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"362494","summary":"SolrJ Content-Type validation is too strict for some webcontainers / proxies, breaks on equivilent content types","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jafurrer","name":"jafurrer","emailAddress":"jafurrer at gmx dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakob Furrer","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jafurrer","name":"jafurrer","emailAddress":"jafurrer at gmx dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakob Furrer","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Windows 7, Java 1.7.0_45 (64bit), solr-solrj-4.6.0.jar","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":27,"total":27,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13840356","id":"13840356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elyograg","name":"elyograg","emailAddress":"apache at elyograg dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=elyograg&avatarId=20749","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=elyograg&avatarId=20749","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=elyograg&avatarId=20749","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=elyograg&avatarId=20749"},"displayName":"Shawn Heisey","active":true},"body":"My server is not upgraded to 4.6 - it's running 4.2.1 ... with that server, your test code works fine.  I am in the process of setting up a test server running 4.6, but I don't have it yet.  Is your server also running 4.6?\r\n\r\nIf your server is 4.6, this looks like the Solr server code has gotten more strict on the content type header, but SolrJ hasn't been updated to match, and the existing unit tests didn't catch the problem.\r\n\r\nWould you be able to try the following addition to your test code, right after you create the HttpSolrServer?\r\n\r\n{code}\r\nsolrServer.setRequestWriter(new BinaryRequestWriter());\r\n{code}\r\n\r\nIf that works, it's a potential workaround for you, with the added advantage that requests sent to Solr will be more compact and therefore more efficient.\r\n\r\nAlso, just in case I have any trouble reproducing, can you include the entire Java stacktrace from your Solr server log when the problem occurs?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elyograg","name":"elyograg","emailAddress":"apache at elyograg dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=elyograg&avatarId=20749","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=elyograg&avatarId=20749","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=elyograg&avatarId=20749","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=elyograg&avatarId=20749"},"displayName":"Shawn Heisey","active":true},"created":"2013-12-05T18:12:43.860+0000","updated":"2013-12-05T18:12:43.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13840368","id":"13840368","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elyograg","name":"elyograg","emailAddress":"apache at elyograg dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=elyograg&avatarId=20749","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=elyograg&avatarId=20749","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=elyograg&avatarId=20749","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=elyograg&avatarId=20749"},"displayName":"Shawn Heisey","active":true},"body":"Got the example 4.6 server set up.  With the following code, substantially similar to yours, I do *NOT* get the same problem.\r\n\r\n{code}\r\n\t\ttry\r\n\t\t{\r\n\t\t\tHttpSolrServer solrServer = new HttpSolrServer(\r\n\t\t\t\t\t\"http://localhost:8983/solr/collection1\");\r\n\t\t\tSolrPingResponse x = solrServer.ping();\r\n\t\t\tSystem.out.println(x);\r\n\t\t}\r\n\t\tcatch (Exception e)\r\n\t\t{\r\n\t\t\te.printStackTrace();\r\n\t\t}\r\n{code}\r\n\r\nIf I change \"collection1\" to \"collection\" (so the URL is invalid) then I do get a similar (but not exactly the same) message, but it's part of a much larger error.  Can you help me figure out what I might be doing that's different from your setup?\r\n\r\n{noformat}\r\norg.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: Expected content type application/octet-stream but got text/html;charset=ISO-8859-1. <html>\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"/>\r\n<title>Error 404 Not Found</title>\r\n</head>\r\n<body><h2>HTTP ERROR 404</h2>\r\n<p>Problem accessing /solr/collection/admin/ping. Reason:\r\n<pre>    Not Found</pre></p><hr /><i><small>Powered by Jetty://</small></i><br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n<br/>                                                \r\n\r\n</body>\r\n</html>\r\n\r\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:455)\r\n\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:197)\r\n\tat org.apache.solr.client.solrj.request.SolrPing.process(SolrPing.java:69)\r\n\tat org.apache.solr.client.solrj.SolrServer.ping(SolrServer.java:293)\r\n\tat org.elyograg.TestStuff.main(TestStuff.java:72)\r\n{noformat}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elyograg","name":"elyograg","emailAddress":"apache at elyograg dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=elyograg&avatarId=20749","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=elyograg&avatarId=20749","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=elyograg&avatarId=20749","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=elyograg&avatarId=20749"},"displayName":"Shawn Heisey","active":true},"created":"2013-12-05T18:22:00.429+0000","updated":"2013-12-05T18:22:00.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13840396","id":"13840396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"The specific error message being returned here by HttpSolrServer is from lines 438-456 _(*NOT* 140 as initially mentioned in the bug report)_ ...\r\n\r\n{code}\r\n      String procCt = processor.getContentType();\r\n      if (procCt != null) {\r\n        if (!contentType.equals(procCt)) {\r\n          // unexpected content type\r\n          String msg = \"Expected content type \" + procCt + \" but got \" + contentType + \".\";\r\n          Header encodingHeader = response.getEntity().getContentEncoding();\r\n          String encoding;\r\n          if (encodingHeader != null) {\r\n            encoding = encodingHeader.getValue();\r\n          } else {\r\n            encoding = \"UTF-8\"; // try UTF-8\r\n          }\r\n          try {\r\n            msg = msg + \" \" + IOUtils.toString(respBody, encoding);\r\n          } catch (IOException e) {\r\n            throw new RemoteSolrException(httpStatus, \"Could not parse response with encoding \" + encoding, e);\r\n          }\r\n          RemoteSolrException e = new RemoteSolrException(httpStatus, msg, null);\r\n          throw e;\r\n        }\r\n      }\r\n{code}\r\n\r\n...the intent of this code is to ensure that the Content-Type of the response it has received from the server is something that the ResponseParser it's configured to use is capable of handling.\r\n\r\nThe code as written definitely seems sketchy, because it's trying to do an exact string equality match on the Content-Type, even though (as in this example)...\r\n{{application/xml; charset=UTF-8}} (with space) \r\n...should be considered equivalent to...\r\n{{application/xml;charset=UTF-8}} (no space) \r\n... nothing in the spec requries whitespcae there, or makes them semantically un-equivilent.\r\n\r\nhaving said that however: i'm still not clear on how to actually reproduce this.\r\n\r\nAs far as i can tell from a quick check, the XML response writer (on the server) has always included a space in it's Content-Type, and that doesn't seem to have changed in 4.6, and the solrj expected XML Content-Type (on the client parser) has always expected a space in the Content-Type, and that doesn't seem to have changed in 4.6.\r\n\r\nCan you pleas show us..\r\n\r\n* the full source code of a test client that demonstrates this problem for you?\r\n* the full stack trace produced by your test code\r\n* the command line used to run your test case (with full classpath showing jar versions used)\r\n* the response you get from \"curl -v http://localhost:8983/solr/admin/system\"\r\n* the response you get from \"curl -v http://localhost:8983/solr/collection1/admin/ping\"\r\n\r\nbq. A global search for \"charset=UTF-8\" on the source code of solrj indicates that other functions besides \"ping\" might be affected as well, because there are several places where \"application/xml; charset=UTF-8\" is spelled without a space after the semicolon.\r\n\r\nCan you please be specific? I just did the same search of the 4.6 codebase and i can't find anything like what you are describing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2013-12-05T18:44:06.120+0000","updated":"2013-12-05T18:44:06.120+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13840406","id":"13840406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"[~hossman_lucene@fucit.org]: In any case we should fix the parser to accept the content type:\r\n- case insensitive (MIME types are defined to be case insensitive= -> this is partly a bug in Solr already, I noticed this in a code review\r\n- strip of the charset from the MIME type before comparing. ContentStreamBase has methods for this (to extract the charset from a ContentType).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-05T18:53:41.386+0000","updated":"2013-12-05T18:53:41.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13840444","id":"13840444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"bq.  In any case we should fix the parser to accept the content type: ...\r\n\r\nAgreed -- what you and i are talking about now is definitely a bug, I'm just not convinced i understand how Jakob ran into the specific error he's reportring -- which scares me and makes me worried that there is some subtle second bug i'm not seeing.\r\n\r\nFWIW: My personal preference would be to refactor the APIs and abstract the content-type checking out HttpSolrServer, so that instead of calling ResponseParser.getContentType() and doing anything with the value, it calls a new ResponseParser.canParseContentType(String) ... put the logic you are taking about into the XMLResponseParser.canParseContentType, and add some basic backcompat support into ResponseParser.canParseContentType that does a simple case/whitespace insensitive comparison.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2013-12-05T19:19:22.094+0000","updated":"2013-12-05T19:19:22.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13840468","id":"13840468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jafurrer","name":"jafurrer","emailAddress":"jafurrer at gmx dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakob Furrer","active":true},"body":"Thanks for looking into this issue so fast.\r\nAnd my apologies for being very sloppy in the bug description.\r\nDue to time constraints, I did not test the code provided above in a standalone setting.\r\nI am aware that this is a big no-no. Mea culpa.\r\n\r\nI only now figured out that setting the XMLResponseParser triggers the Exception\r\n{code}\r\nsolrServer.setParser(new XMLResponseParser());\r\n{code}\r\nSetting the BinaryRequestWriter or not does not influence the result for me.\r\n\r\nSide-Question:\r\nThe XMLResponseParser is set in my custom application since very long. I cannot recall when or why set that specific parser.\r\nCould anyone give my some information whether, when or why this parser should (not) be set?\r\n\r\nAs for\r\n{quote}\r\nA global search for \"charset=UTF-8\" on the source code of solrj indicates that other functions besides \"ping\" might be affected as well, because there are several places where \"application/xml; charset=UTF-8\" is spelled without a space after the semicolon.\r\n{quote}\r\nI am not familiar with the Solr sourcecode at all. I saw these search results, where \"; charset=utf-8\" appears 62 times and \";charset=utf-8\" appears 12 times.\r\nFrom that I conclude that there is an inconsistency how to spell this encoding type within this library.\r\n{code}\r\nSuchen nach: charset=UTF-8\r\nlucene\\common-build.xml(2241): html.append('<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\\n')\r\nlucene\\analysis\\common\\src\\java\\org\\apache\\lucene\\analysis\\cjk\\package.html(20): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\nlucene\\analysis\\common\\src\\java\\org\\apache\\lucene\\analysis\\cn\\package.html(20): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\nlucene\\analysis\\common\\src\\test\\org\\apache\\lucene\\analysis\\charfilter\\htmlStripReaderTest.html(4): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\nlucene\\analysis\\common\\src\\test\\org\\apache\\lucene\\analysis\\core\\LuceneResourcesWikiPage.html(4): <meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\">\r\nlucene\\analysis\\icu\\src\\java\\overview.html(19): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\nlucene\\analysis\\morfologik\\src\\java\\overview.html(20): <meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\" />\r\nlucene\\analysis\\morfologik\\src\\java\\org\\apache\\lucene\\analysis\\morfologik\\package.html(20): <meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\" />\r\nlucene\\analysis\\smartcn\\src\\java\\org\\apache\\lucene\\analysis\\cn\\smart\\package.html(20): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\nlucene\\analysis\\smartcn\\src\\java\\org\\apache\\lucene\\analysis\\cn\\smart\\hhmm\\package.html(19): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\nlucene\\analysis\\stempel\\src\\java\\overview.html(20): <meta content=\"text/html; charset=UTF-8\" http-equiv=\"content-type\">\r\nlucene\\benchmark\\src\\test\\org\\apache\\lucene\\benchmark\\byTask\\feeds\\TestHtmlParser.java(76): \"<meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html;charset=UTF-8\\\" />\" +\r\nlucene\\benchmark\\src\\test\\org\\apache\\lucene\\benchmark\\byTask\\feeds\\TestHtmlParser.java(84): assertEquals(\"text/html;charset=UTF-8\", tags.get(\"content-type\"));\r\nlucene\\demo\\src\\java\\overview.html(19): <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\nlucene\\queryparser\\docs\\xml\\LuceneContribQuery.dtd.entities.html(3): <meta http-equiv='CONTENT-TYPE' content='text/html; charset=UTF-8' />\r\nlucene\\queryparser\\docs\\xml\\LuceneContribQuery.dtd.html(3): <meta http-equiv='CONTENT-TYPE' content='text/html; charset=UTF-8' />\r\nlucene\\queryparser\\docs\\xml\\LuceneContribQuery.dtd.org.html(3): <meta http-equiv='CONTENT-TYPE' content='text/html; charset=UTF-8' />\r\nlucene\\queryparser\\docs\\xml\\LuceneCoreQuery.dtd.entities.html(3): <meta http-equiv='CONTENT-TYPE' content='text/html; charset=UTF-8' />\r\nlucene\\queryparser\\docs\\xml\\LuceneCoreQuery.dtd.html(3): <meta http-equiv='CONTENT-TYPE' content='text/html; charset=UTF-8' />\r\nlucene\\queryparser\\docs\\xml\\LuceneCoreQuery.dtd.org.html(3): <meta http-equiv='CONTENT-TYPE' content='text/html; charset=UTF-8' />\r\nlucene\\site\\changes\\changes2html.pl(258): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/>\r\nsolr\\CHANGES.txt(7359): have a valid contentType: curl -H 'Content-type:text/xml; charset=utf-8' \r\nsolr\\CHANGES.txt(7451): content.  Using the contentType: \"text/xml; charset=utf-8\" will force\r\nsolr\\contrib\\clustering\\src\\test-files\\clustering\\solr\\collection1\\conf\\solrconfig.xml(421): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\contrib\\dataimporthandler\\src\\test-files\\dih\\solr\\collection1\\conf\\contentstream-solrconfig.xml(296): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\contrib\\dataimporthandler\\src\\test-files\\dih\\solr\\collection1\\conf\\dataimport-nodatasource-solrconfig.xml(294): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\contrib\\dataimporthandler\\src\\test-files\\dih\\solr\\collection1\\conf\\dataimport-solrconfig.xml(295): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\contrib\\dataimporthandler-extras\\src\\test-files\\dihextras\\solr\\collection1\\conf\\dataimport-solrconfig.xml(292): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\contrib\\uima\\src\\test-files\\uima\\uima-tokenizers-solrconfig.xml(639): now requires: -H 'Content-type:text/xml; charset=utf-8' The response\r\nsolr\\contrib\\uima\\src\\test-files\\uima\\solr\\collection1\\conf\\solrconfig.xml(640): now requires: -H 'Content-type:text/xml; charset=utf-8' The response\r\nsolr\\contrib\\velocity\\src\\java\\org\\apache\\solr\\response\\VelocityResponseWriter.java(174): return request.getParams().get(\"v.contentType\", \"text/html;charset=UTF-8\");\r\nsolr\\core\\src\\java\\org\\apache\\solr\\response\\JSONResponseWriter.java(44): static String CONTENT_TYPE_JSON_UTF8 = \"application/json; charset=UTF-8\";\r\nsolr\\core\\src\\java\\org\\apache\\solr\\response\\PHPResponseWriter.java(27): static String CONTENT_TYPE_PHP_UTF8=\"text/x-php;charset=UTF-8\";\r\nsolr\\core\\src\\java\\org\\apache\\solr\\response\\PHPSerializedResponseWriter.java(42): static String CONTENT_TYPE_PHP_UTF8=\"text/x-php-serialized;charset=UTF-8\";\r\nsolr\\core\\src\\java\\org\\apache\\solr\\response\\QueryResponseWriter.java(46): public static String CONTENT_TYPE_XML_UTF8=\"application/xml; charset=UTF-8\";\r\nsolr\\core\\src\\java\\org\\apache\\solr\\response\\QueryResponseWriter.java(47): public static String CONTENT_TYPE_TEXT_UTF8=\"text/plain; charset=UTF-8\";\r\nsolr\\core\\src\\java\\org\\apache\\solr\\response\\RubyResponseWriter.java(26): static String CONTENT_TYPE_RUBY_UTF8=\"text/x-ruby;charset=UTF-8\";\r\nsolr\\core\\src\\java\\org\\apache\\solr\\servlet\\SolrRequestParsers.java(638): if( idx > 0 ) { // remove the charset definition \"; charset=utf-8\"\r\nsolr\\core\\src\\test\\org\\apache\\solr\\analysis\\htmlStripReaderTest.html(4): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\nsolr\\core\\src\\test\\org\\apache\\solr\\servlet\\SolrRequestParserTest.java(216): \"application/x-www-form-urlencoded; charset=utf-8\",\r\nsolr\\core\\src\\test-files\\solr\\collection1\\conf\\solrconfig-implicitproperties.xml(77): <str name=\"content-type\">text/plain; charset=UTF-8</str>\r\nsolr\\docs\\changes\\Changes.html(31): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"/>\r\nsolr\\docs\\changes\\Changes.html(7435): have a valid contentType: curl -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\docs\\changes\\Changes.html(7527): content.  Using the contentType: \"text/xml; charset=utf-8\" will force\r\nsolr\\example\\example-DIH\\solr\\db\\conf\\solrconfig.xml(407): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\example\\example-DIH\\solr\\db\\conf\\xslt\\example.xsl(27): <xsl:output media-type=\"text/html; charset=UTF-8\" encoding=\"UTF-8\"/> \r\nsolr\\example\\example-DIH\\solr\\db\\conf\\xslt\\luke.xsl(38): <meta http-equiv=\"Content-Type\" content=\"application/xhtml+xml; charset=UTF-8\"/>\r\nsolr\\example\\example-DIH\\solr\\mail\\conf\\solrconfig.xml(565): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\example\\example-DIH\\solr\\rss\\conf\\solrconfig.xml(406): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\example\\example-DIH\\solr\\solr\\conf\\solrconfig.xml(405): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\example\\example-DIH\\solr\\tika\\conf\\solrconfig.xml(326): the body. For example, curl now requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\example\\example-schemaless\\solr\\collection1\\conf\\solrconfig.xml(999): requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\example\\example-schemaless\\solr\\collection1\\conf\\solrconfig.xml(1710): <str name=\"content-type\">text/plain; charset=UTF-8</str>\r\nsolr\\example\\exampledocs\\test_utf8.sh(41): curl $URL/select --data-binary 'q=h%C3%A9llo&echoParams=explicit&wt=python' -H 'Content-type:application/x-www-form-urlencoded; charset=UTF-8' 2> /dev/null | grep 'h\\\\u00e9llo' > /dev/null 2>&1\r\nsolr\\example\\exampledocs\\test_utf8.sh(71): curl $URL/select --data-binary \"q=$URL_UTF8&echoParams=explicit&wt=python\"  -H 'Content-type:application/x-www-form-urlencoded; charset=UTF-8' 2> /dev/null | grep $EXPECTED > /dev/null 2>&1\r\nsolr\\example\\solr\\collection1\\conf\\solrconfig.xml(1006): requires: -H 'Content-type:text/xml; charset=utf-8'\r\nsolr\\example\\solr\\collection1\\conf\\solrconfig.xml(1751): <str name=\"content-type\">text/plain; charset=UTF-8</str>\r\nsolr\\example\\solr\\collection1\\conf\\velocity\\head.vm(7): <meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\"/>\r\nsolr\\scripts\\abc(95): rs=`curl ${curl_url} -s -H 'Content-type:text/xml; charset=utf-8' -d \"<commit/>\"`\r\nsolr\\scripts\\abo(94): rs=`curl ${curl_url} -s -H 'Content-type:text/xml; charset=utf-8' -d \"<optimize/>\"`\r\nsolr\\scripts\\commit(87): rs=`curl ${curl_url} -s -H 'Content-type:text/xml; charset=utf-8' -d \"<commit/>\"`\r\nsolr\\scripts\\optimize(87): rs=`curl ${curl_url} -s -H 'Content-type:text/xml; charset=utf-8' -d \"<optimize/>\"`\r\nsolr\\site\\html\\tutorial.html(20): <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\r\nsolr\\solrj\\src\\java\\org\\apache\\solr\\client\\solrj\\impl\\HttpSolrServer.java(273): \"application/x-www-form-urlencoded; charset=UTF-8\");\r\nsolr\\solrj\\src\\java\\org\\apache\\solr\\client\\solrj\\impl\\XMLResponseParser.java(50): public static final String XML_CONTENT_TYPE = \"application/xml; charset=UTF-8\";\r\nsolr\\solrj\\src\\java\\org\\apache\\solr\\client\\solrj\\util\\ClientUtils.java(54): public static final String TEXT_XML = \"application/xml; charset=UTF-8\";  \r\nsolr\\solrj\\src\\test\\org\\apache\\solr\\client\\solrj\\impl\\BasicHttpSolrServerTest.java(253): assertEquals(\"application/x-www-form-urlencoded; charset=UTF-8\", DebugServlet.headers.get(\"Content-Type\"));\r\nsolr\\solrj\\src\\test\\org\\apache\\solr\\client\\solrj\\impl\\BasicHttpSolrServerTest.java(289): assertEquals(\"application/x-www-form-urlencoded; charset=UTF-8\", DebugServlet.headers.get(\"Content-Type\"));\r\nsolr\\solrj\\src\\test\\org\\apache\\solr\\client\\solrj\\impl\\BasicHttpSolrServerTest.java(358): assertEquals(\"application/xml; charset=UTF-8\", DebugServlet.headers.get(\"Content-Type\"));\r\nsolr\\solrj\\src\\test\\org\\apache\\solr\\client\\solrj\\impl\\BasicHttpSolrServerTest.java(374): assertEquals(\"application/xml; charset=UTF-8\", DebugServlet.headers.get(\"Content-Type\"));\r\nsolr\\test-framework\\src\\java\\org\\apache\\solr\\util\\RestTestHarness.java(149): connection.setRequestProperty(\"Content-Type\", \"application/json; charset=utf-8\");\r\nsolr\\webapp\\web\\js\\scripts\\dashboard.js(57): core_basepath + '/admin/file/?file=admin-extra.menu-top.html&contentType=text/html;charset=utf-8',\r\nsolr\\webapp\\web\\js\\scripts\\dashboard.js(67): core_basepath + '/admin/file/?file=admin-extra.menu-bottom.html&contentType=text/html;charset=utf-8',\r\nsolr\\webapp\\web\\js\\scripts\\file.js(29): + '&contentType=text/xml;charset=utf-8';\r\nEs wurden 74 Vorkommen in 62 Datei(en) gefunden.\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jafurrer","name":"jafurrer","emailAddress":"jafurrer at gmx dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakob Furrer","active":true},"created":"2013-12-05T19:36:25.120+0000","updated":"2013-12-05T19:36:25.120+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13840501","id":"13840501","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elyograg","name":"elyograg","emailAddress":"apache at elyograg dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=elyograg&avatarId=20749","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=elyograg&avatarId=20749","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=elyograg&avatarId=20749","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=elyograg&avatarId=20749"},"displayName":"Shawn Heisey","active":true},"body":"{quote}\r\nSide-Question:\r\nThe XMLResponseParser is set in my custom application since very long. I cannot recall when or why set that specific parser.\r\nCould anyone give my some information whether, when or why this parser should (not) be set?\r\n{quote}\r\n\r\nThe XML parser typically is used for compatibility.\r\n\r\nHttpSolrServer defaults to the binary response parser and the XML request writer.  The javabin format (used by the binary writer/parser) changed a few years back.  Solr/SolrJ Version 1.4.1 used version 1, but the next version that was released (3.1.0) used version 2.  They are completely incompatible with each other, so when you need to have communication between incompatible versions, you need to change it to use XML.\r\n\r\nI tried setting my parser to a new XMLResponseParser, but I still can't duplicate your symptom.  I will attach a screenshot showing my code in eclipse along with the eclipse build path.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elyograg","name":"elyograg","emailAddress":"apache at elyograg dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=elyograg&avatarId=20749","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=elyograg&avatarId=20749","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=elyograg&avatarId=20749","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=elyograg&avatarId=20749"},"displayName":"Shawn Heisey","active":true},"created":"2013-12-05T20:01:02.891+0000","updated":"2013-12-05T20:01:02.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841295","id":"13841295","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"There were 2 more issues opened about the same, this time not with PingRequestHandler. The problem seems to be in HttpSolrServer's parsing of ContentType in general.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-06T14:23:02.411+0000","updated":"2013-12-06T14:23:02.411+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841379","id":"13841379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"bq. As far as i can tell from a quick check, the XML response writer (on the server) has always included a space in it's Content-Type, and that doesn't seem to have changed in 4.6, and the solrj expected XML Content-Type (on the client parser) has always expected a space in the Content-Type, and that doesn't seem to have changed in 4.6.\r\n\r\nOk, here's what i reallize now that i overlooked when i skimmed the old code yesterday:\r\n\r\n* the content type as written by the server has not changed\r\n* the content type as written by the server, and the content type as parsed by the client are in fact 100% identical (same variable)\r\n* what's new in 4.6 is the check to verify that the ContentType's are equal (In my previous skim i totally overlooked that the code throwing this error is new in 4.6, added as part of SOLR-3530\r\n\r\nThat still, however, doesn't explain the bug report, and why elyograg and i can't reproduce, and why the solrj xml tests aren't reproducing it -- specifically: and what's happening to the space character to cause this exception.\r\n\r\nMy best guess is that people encountering this problem aren't using the provided jetty server, and the server they are using (or some proxy in between their client and the server) is re-writing the the header slightly.  the fact that the initial problem report here refers to port \"8080\" smells like i may be on to something.\r\n\r\nEither way: we should fix how the Content-Type comparison is done.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2013-12-06T16:13:01.726+0000","updated":"2013-12-06T16:13:01.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841382","id":"13841382","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"clarify summary and description, not specific to ping.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2013-12-06T16:21:41.059+0000","updated":"2013-12-06T16:21:41.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841424","id":"13841424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"This is why using Jetty is the best choice :) We actually test it.\r\n\r\nI think we should make the comparison less strict right away, this can go out in 4.6.1.\r\n\r\nBeyond that, Hossman has some interesting ideas for improving the API's, but unless someone bangs that out right away, I think the straightforward fix is the right initial thing to do.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-12-06T16:57:20.887+0000","updated":"2013-12-06T16:57:20.887+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841425","id":"13841425","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"bq. the content type as written by the server, and the content type as parsed by the client are in fact 100% identical (same variable)\r\n\r\nI was careful to ensure that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-12-06T16:58:15.801+0000","updated":"2013-12-06T16:58:15.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841485","id":"13841485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"bq. My best guess is that people encountering this problem aren't using the provided jetty server, and the server they are using (or some proxy in between their client and the server) is re-writing the the header slightly. the fact that the initial problem report here refers to port \"8080\" smells like i may be on to something.\r\n\r\nWhen thinking about this, I know for example that Oracle iPlanet webserver does this! And iPlanet uses Catilina internally which is the servlet engine of Tomcat...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-06T18:05:32.726+0000","updated":"2013-12-06T18:05:32.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841502","id":"13841502","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"A first whack.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-12-06T18:18:18.778+0000","updated":"2013-12-06T18:18:18.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841513","id":"13841513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Validated this with the Catilina based PANGAEA server (Oracle iPlanet webserver):\r\n\r\n{noformat}\r\nVEGA:~ > curl -D - \"http://ws.pangaea.de/oai/?verb=Identify\"\r\nHTTP/1.1 200 OK\r\nServer: PANGAEA/1.0\r\nDate: Fri, 06 Dec 2013 18:17:59 GMT\r\nContent-type: text/xml;charset=UTF-8\r\nTransfer-encoding: chunked\r\n\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?><OAI-PMH xmlns=\"http://www.openarchives.org/OAI/2.0/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd\">\r\n...\r\n{noformat}\r\n\r\nAnd here is how the servlets sets Content-Type:\r\n\r\n{code:java}\r\nresp.setContentType(\"text/xml; charset=\"+charset);\r\n{code}\r\n\r\nIt looks like every Tomcat does this. The reason for this is: The Content-Type header is generally not passed unparsed to the output, the servlet container (Catilina) does some extra parsing, to detect the charset, so when you call the broken getWriter() that the writer has correct charset. Most webservers also do header normalization afterwards (they combine multiple headers into one and also remove whitespace).\r\n\r\nThe correct way to handle this is:\r\n- Use ContentStreamBase to extract the MIME-Type and the charset from the full Content-Type string (MIME-Type != Content-Type, that's the fault here). We have the methods already available and they should also be available to SolrJ.\r\n- Compare charset and MIME type with equalsIgnoreCase. But: charset does not need to be compared. The XML parser should do this afterwards, not need to enforce a specific charset in SolrJ. It should only enforce the MIME-Type!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-06T18:25:05.711+0000","updated":"2013-12-06T18:28:23.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841514","id":"13841514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jafurrer","name":"jafurrer","emailAddress":"jafurrer at gmx dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakob Furrer","active":true},"body":"I can confirm, that the problem I described above does not occur when I use Jetty to run the stock solr that is included in Solr 4.6.\r\nHowever, I see this problem when solr is run in Tomcat.\r\nIn my custom application that accesses solrI see that\r\na) the ping fails only when XMLResponseParser is set on the HttpSolrServer\r\nb) adding document also fails with the same error message as above (even if XMLResponseParser is not set on the HttpSolrServer)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jafurrer","name":"jafurrer","emailAddress":"jafurrer at gmx dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jakob Furrer","active":true},"created":"2013-12-06T18:25:31.768+0000","updated":"2013-12-06T18:25:31.768+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841517","id":"13841517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Mark: Patch looks ok. Exactly as I wanted to have it :-) Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-06T18:26:47.421+0000","updated":"2013-12-06T18:26:47.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841552","id":"13841552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1548659 from [~markrmiller@gmail.com] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1548659 ]\r\n\r\nSOLR-5532: SolrJ Content-Type validation is too strict for some webcontainers / proxies.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-06T19:01:04.318+0000","updated":"2013-12-06T19:01:04.318+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841555","id":"13841555","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1548661 from [~markrmiller@gmail.com] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1548661 ]\r\n\r\nSOLR-5532: SolrJ Content-Type validation is too strict for some webcontainers / proxies.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-06T19:02:16.687+0000","updated":"2013-12-06T19:02:16.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13841562","id":"13841562","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"As there is a bugfix release planned: I think this one should also go in 4.6.1. Looks like many people are affected. One of my customers called today, too (using Tomcat).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-06T19:05:25.162+0000","updated":"2013-12-06T19:05:25.162+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13858148","id":"13858148","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1553949 from [~markrmiller@gmail.com] in branch 'dev/branches/lucene_solr_4_6'\r\n[ https://svn.apache.org/r1553949 ]\r\n\r\nSOLR-5532: SolrJ Content-Type validation is too strict for some webcontainers / proxies.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-28T22:35:49.406+0000","updated":"2013-12-28T22:35:49.406+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13858149","id":"13858149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1553950 from [~markrmiller@gmail.com] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1553950 ]\r\n\r\nSOLR-5532: Move CHANGES entry to 4.6.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-28T22:36:50.329+0000","updated":"2013-12-28T22:36:50.329+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13858150","id":"13858150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1553951 from [~markrmiller@gmail.com] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1553951 ]\r\n\r\nSOLR-5532: Move CHANGES entry to 4.6.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-28T22:37:44.548+0000","updated":"2013-12-28T22:37:44.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/13862655","id":"13862655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"Thanks all!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2014-01-05T21:02:13.481+0000","updated":"2014-01-05T21:02:13.481+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/14188249","id":"14188249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=magloven","name":"magloven","emailAddress":"magloven71 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=magloven&avatarId=20836","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=magloven&avatarId=20836","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=magloven&avatarId=20836","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=magloven&avatarId=20836"},"displayName":"Magnus Lövgren","active":true},"body":"I've upgraded from 4.4 to 4.10.1 and have been struggling somewhat with my code that was affected by this change. Some observations that might be useful for others too:\r\n\r\nThe patch relies on the \"org.apache.http.entity.ContentType.parse\" method. It fails when parsing an empty string. That's fine (empty string should probably not be seen as a valid type anyway). The caveat is that an empty string is actually used as the \"fallback\" contentType if the response has no Content-Type header! This would be the typical case if the response is a 401 (typically has no Content-Type).\r\n\r\n- In prior versions a 401 response threw a SolrException with code() 401\r\n- Now a SolrServerException  is thrown (caused by a org.apache.http.ParseException). Hard to determine if it was due to bad credentials (401).\r\n\r\nTo restore previous behaviour, you'd presumably add the HttpStatus.SC_UNAUTHORIZED case to the switch and then throw a RemoteSolrException (with code 401). In other words - fail early for 401 response (there's no content to parse anyway)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=magloven","name":"magloven","emailAddress":"magloven71 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=magloven&avatarId=20836","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=magloven&avatarId=20836","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=magloven&avatarId=20836","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=magloven&avatarId=20836"},"displayName":"Magnus Lövgren","active":true},"created":"2014-10-29T11:19:44.367+0000","updated":"2014-10-29T11:19:44.367+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/14188262","id":"14188262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"I ran into this same issue in a review for Cloudera Search before I went on vacation a couple weeks ago. Technically, it was a back compat break. Please file a JIRA issue and we can address it. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2014-10-29T11:48:06.336+0000","updated":"2014-10-29T11:48:06.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12682942/comment/14188365","id":"14188365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=magloven","name":"magloven","emailAddress":"magloven71 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=magloven&avatarId=20836","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=magloven&avatarId=20836","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=magloven&avatarId=20836","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=magloven&avatarId=20836"},"displayName":"Magnus Lövgren","active":true},"body":"The 401 issue is now added as SOLR-6669","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=magloven","name":"magloven","emailAddress":"magloven71 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=magloven&avatarId=20836","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=magloven&avatarId=20836","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=magloven&avatarId=20836","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=magloven&avatarId=20836"},"displayName":"Magnus Lövgren","active":true},"created":"2014-10-29T14:08:16.296+0000","updated":"2014-10-29T14:08:16.296+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5532/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qfnj:"}}