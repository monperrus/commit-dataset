{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12530576","self":"https://issues.apache.org/jira/rest/api/latest/issue/12530576","key":"DERBY-5494","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-11-17 16:40:24.461","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"216314","customfield_12310222":"1_*:*_1_*:*_17815228274_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-05-31T18:47:31.243+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5494/watchers","watchCount":5,"isWatching":false},"created":"2011-11-07T14:07:03.106+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_backport_reject_10_8","derby_triage10_9"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315343","id":"12315343","description":"Derby 10.6.2.1 Release","name":"10.6.2.1","archived":false,"released":true,"releaseDate":"2010-10-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12345340","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12345340","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12530579","key":"DERBY-5495","self":"https://issues.apache.org/jira/rest/api/2/issue/12530579","fields":{"summary":"Master issue to track fixes to sequence generators","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12350730","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12350730","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12551640","key":"DERBY-5697","self":"https://issues.apache.org/jira/rest/api/2/issue/12551640","fields":{"summary":"Doc changes to account for correctness fixes for sequences","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12349739","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12349739","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12525593","key":"DERBY-5443","self":"https://issues.apache.org/jira/rest/api/2/issue/12525593","fields":{"summary":"reduce number of times sequence updater does it work on user thread rather than nested user thread.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12352999","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12352999","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"12557075","key":"DERBY-5780","self":"https://issues.apache.org/jira/rest/api/2/issue/12557075","fields":{"summary":"identity column performance has degredated","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-14T17:19:29.166+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"The following sequence of steps causes a sequence generator to return the same value on successive NEXT VALUE FOR calls.\r\n\r\n1) Bring up ij and issue the following commands:\r\n\r\nconnect 'jdbc:derby:db;create=true';\r\n\r\ncreate sequence s;\r\nvalues next value for s; \r\n\r\n2) Control-c out of ij so that the engine comes down hard without an orderly shutdown.\r\n\r\n3) Now bring up ij again and issue the following commands:\r\n\r\nconnect 'jdbc:derby:db';\r\n\r\nvalues next value for s; \r\n\r\nThanks to Knut for finding this one.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10367","value":"Deviation from standard","id":"10367"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35669","summary":"Same value returned by successive calls to a sequence generator flanking an unorderly shutdown.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10426","value":"Known fix","id":"10426"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10102","value":"Patch Available","id":"10102"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":35,"total":35,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13152128","id":"13152128","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Does this issue affect identity columns in 10.8 or trunk?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-11-17T16:40:24.461+0000","updated":"2011-11-17T16:40:24.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13152138","id":"13152138","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Kathey,\r\n\r\nThere may be a variant of this issue which affects identity columns in 10.9. There may also be a variant of this issue which affects identity columns in 10.8, 10.7, and all the way back. I say that because the transaction trickiness in the sequence generators was modelled on similar trickiness in the pre-exisiting identity implementation. But I haven't investigated the implications for identity columns yet. Hopefully the solution to this problem will address identity columns, at least in 10.9.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-11-17T16:58:26.154+0000","updated":"2011-11-17T16:58:26.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13238516","id":"13238516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"To answer Kathey's question more exactly: Yes, a version of this problem also affects identity columns. This is true regardless of whether you use the new identity generators (currently implemented in 10.9) or the old-style identity generators (in 10.8).\r\n\r\nAccording to the SQL Standard, part 2, section 4.14.7, identity columns are supposed to behave as though they are backed by internal sequence generators. That means that commits and rollbacks are not supposed to affect identity values.\r\n\r\nThe following scripts show that you can make an identity column produce the same value in two successive invocations.\r\n\r\nFirst run this script to generate a value and then rollback:\r\n\r\nconnect 'jdbc:derby:db;create=true';\r\n\r\ncreate procedure systemExit( in exitCode  int )\r\nlanguage java parameter style java no sql\r\nexternal name 'java.lang.System.exit';\r\n\r\ncreate table t( a int generated always as identity, b int );\r\n\r\nautocommit off;\r\n\r\nselect count(*) from sys.syscolumns with rs; \r\n\r\ninsert into t( b ) values ( 0 );\r\n\r\n-- here you see that the identity column has value 1\r\nselect * from t;\r\n\r\nrollback;\r\n\r\nselect * from t;\r\n\r\ncall systemExit( 0 );\r\n\r\nNow run this script to generate a new value (which turns out to be the original value):\r\n\r\nconnect 'jdbc:derby:db';\r\n\r\ninsert into t( b ) values ( 1 );\r\n\r\n-- here you see that the identity column again has value 1\r\nselect * from t;\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-03-26T16:09:54.231+0000","updated":"2012-03-26T16:09:54.231+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13251504","id":"13251504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Here is another view on the bug. In this view we add another connection which confirms that the original \"next value for\" statement durably commits a change to SYSSEQUENCES. But after the system crash, that supposedly durable change has rolled back.\r\n\r\n1) Run this script. The select from the second thread shows that SYSSEQUENCES has changed:\r\n\r\nconnect 'jdbc:derby:db;create=true' as dbo;\r\ncreate procedure systemExit( in exitCode int ) language java parameter style java no sql external name 'java.lang.System.exit';\r\ncreate sequence s;\r\n\r\nvalues next value for s;\r\n\r\nconnect 'jdbc:derby:db';\r\nselect currentvalue from sys.syssequences where sequencename='S';\r\n\r\nset connection dbo;\r\ncall systemExit( 1 );\r\n\r\n2) Now run this script. You will see that the change to SYSSEQUENCES has been rolled back:\r\n\r\nconnect 'jdbc:derby:db';\r\nselect currentvalue from sys.syssequences where sequencename='S';\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-04-11T12:38:17.112+0000","updated":"2012-04-11T12:38:17.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13251895","id":"13251895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"i am looking at the latest test case posted in comments.  Looking at log traces is seems like update of catalog row does get done in a nested transaction, and commit record is written to stream, but does not look like a force of the log is happening at that point.  Not sure why not, yet.  For some internal/nested transactions this behavior is ok as rather get the performance of a nosync commit and we don't really care as long as either all or none of the transaction gets done.  The is the case with btree splits.  I think it also makes sense for identity columns as the nested transaction only is important once some other transaction that uses one of the value commits, which in turn will force this transaction.  \r\n\r\nI don't think sequences should be using this optimization and thought that only would happen if they called commitNoSync() which I did not see in the code.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-11T20:26:10.047+0000","updated":"2012-04-11T20:26:10.047+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13252024","id":"13252024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I am not sure yet how to fix, but think I understand the issue now.  At least as far back as 10.1, the system always does a no sync commit for any transaction that is not a user transaction.  I don't think this is a problem for anything other than sequences, but welcome opinions.  \r\n\r\nThe comments in the code are correct but incomplete, I think the code was written before there were any nested user transactions.  the \r\ninternal and nested top transactions are store internal things that do not require flushing.  I am guessing since this code was added\r\nwe added the 2 new nested transactions, for the sql layer.\r\n\r\nI hacked the code below to always return true and the test case worked, but this is not correct fix.\r\n\r\nAn easy fix that might work is to return true for user transactions and NestedRawUpdateUserTransaction.  The problem with this change is it will\r\nslow down  operations that use NestedRawUpdateUserTransaction but not require forcing the log on commit.\r\n\r\nThe system already has commit and\r\ncommitNoSync interfaces, so I think the right longterm fix would be to get rid of this code completely and change all the callers to correctly call\r\ncommit or commitNoSync.  \r\n\r\nThe problem code is in xactfactory.java and then is called by Xact.java:\r\n    /**\r\n        Decide if a transaction of this contextId needs to flush the log when\r\n        it commits\r\n    */\r\n    public boolean flushLogOnCommit(String contextName)\r\n    {\r\n        //\r\n        // if this is a user transaction, flush the log\r\n        // if this is an internal or nested top transaction, do not\r\n        // flush, let it age out.\r\n        //\r\n        /*\r\n        return (contextName == USER_CONTEXT_ID ||\r\n                contextName.equals(USER_CONTEXT_ID));\r\n        */\r\n        return(true);\r\n    }","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-11T23:00:05.085+0000","updated":"2012-04-11T23:00:05.085+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13252117","id":"13252117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"patch not ready for commit. First step of proposed fix, this change causes all user level nested write transactions to flush commit log record.  Next step is to isolate the flushing to just sequences as I don't understand the performance ramifications of other usages in SQL layer of the nested write transaction.  Seems to fix ij repro in this JIRA, going to run tests over night to see if it has any obvious problems.  needs some comments also.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-12T01:13:38.998+0000","updated":"2012-04-12T01:13:38.998+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13252528","id":"13252528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"derby-5494_diff_1a.txt passed all tests, still more work needed for checkin. Note that this fix will decrease the performance of using sequences. The amount of the affect depends on how many \"block\" updates done per measured benchmark, and if the benchmark must wait on those updates. I think the worst case would be a single user insert benchmark that rarely commits, using one or more next sequence calls per inserted row. Large numbers of inserts per transaction is the usual case we recommend for users that want to insert as fast as possbile. I have not done the measurement recently but it use to be not unusual that you had to do > 10000 inserts per transaction to max out cpu on a single processor or you would just get I/O bottlenecked on the commit record. Make sure to measure on a machine that has proper disk syncing. After this fix each block update will have to wait for an I/O to hit disk at commit time. \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-12T16:12:07.246+0000","updated":"2012-04-12T16:12:07.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13254142","id":"13254142","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"This is the proposed code patch for this issue, it passes all tests on my machine (windows, xp).  Before committing I am planning on including the crash test that rick has as part of DERBY-5493.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-14T16:08:34.703+0000","updated":"2012-04-14T16:08:34.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13256413","id":"13256413","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"I noticed this code in the commit mail:\r\n\r\n+++ db/derby/code/trunk/java/engine/org/apache/derby/impl/store/raw/xact/XactFactory.java Tue Apr 17 18:40:15 2012\r\n@@ -943,12 +943,18 @@ public class XactFactory implements Tran\r\n \tpublic boolean flushLogOnCommit(String contextName)\r\n \t{\r\n \t\t//\r\n-\t\t// if this is a user transaction, flush the log\r\n+\t\t// if this is a user transaction, flush the log by default.\r\n+        // if this is a nested user update transaction, flush log by default.\r\n \t\t// if this is an internal or nested top transaction, do not\r\n \t\t// flush, let it age out.\r\n+        //\r\n+        // In all cases log will not be flushsed by Xact.prepareCommit() \r\n+        // if commitNoSync() has been called rather than commit.\r\n \t\t//\r\n-\t\treturn (contextName == USER_CONTEXT_ID || \r\n-\t\t\t\tcontextName.equals(USER_CONTEXT_ID));\r\n+\t\treturn (contextName == USER_CONTEXT_ID               || \r\n+\t\t\t\tcontextName.equals(USER_CONTEXT_ID)          ||\r\n+                contextName == NESTED_UPDATE_USER_CONTEXT_ID ||\r\n+                contextName.equals(NESTED_UPDATE_USER_CONTEXT_ID));\r\n \t}\r\n\r\nIt appears that reference equality is used as an optimization, i.e. to avoid calling equals in many/some cases. With that in mind, would it make sense to group the == together first, and then the equals next?\r\nAlso, a comment on the use of == for string comparison wouldn't hurt.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-04-18T10:11:47.643+0000","updated":"2012-04-18T10:11:47.643+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13256466","id":"13256466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Alternatively, since at least OpenJDK (and I expect most other implementations) already shortcuts String.equals() on reference equality, just skip the reference check?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-04-18T12:07:32.165+0000","updated":"2012-04-18T12:07:32.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13258384","id":"13258384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Mike,\r\n\r\nDo you think work on this issue has wrapped up and it can be resolved? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-04-20T17:17:18.403+0000","updated":"2012-04-20T17:17:18.403+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13258429","id":"13258429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I would like opinions on whether this should be backported to 10.8 or not.  The downside is that performance will go down.  I am leaning toward not backporting this or any of the sequence changes.  \r\n\r\nThere were a couple of comments after checkin, which I would rather address in a separate issue, but don't have time right now.  Long term I think the routine in question should be removed with no \"default\" syncing behavior.  All code should just make the expected commit calls that it wants.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-20T18:03:44.351+0000","updated":"2012-04-20T18:03:44.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13258453","id":"13258453","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I don't think this fix should be backported in isolation. We would want to boost the pre-allocation range as well to retrieve the lost concurrency. Then we would want to warn users to always shutdown their databases gracefully in order to avoid leaking the longer preallocation range. Won't this fix degrade the concurrency of identity columns also? That might be a surprising consequence of upgrading to a supposedly stable bug-fix release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-04-20T18:29:47.805+0000","updated":"2012-04-20T18:29:47.805+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13271362","id":"13271362","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Mike,\r\n\r\nHave you reached a conclusion about whether this patch should be backported to 10.8? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-09T12:35:36.390+0000","updated":"2012-05-09T12:35:36.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13281933","id":"13281933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"i do not think we should backport this change until DERBY-5780 is understood.  Even then I am still leaning toward not backporting any sequence/identity changes in this area.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-05-23T21:34:33.917+0000","updated":"2012-05-23T21:34:33.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13283582","id":"13283582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"Here is proposed fix for performance degredation of identity columns caused by previous patch.  All tests passed for me running sane, classes, write sync disabled, and no special handling for upgrade tests.  I am concerned that tests took a lot longer (9+ hours) vs around 6 hours for runs in the past on this new machine doing sane, classes, write sync enabled, but I changed both the write sync option and the patch so don't have a good baseline.  Am running more tests before commit.\r\n\r\nThe patch changes some interfaces to allow creaters of nested user transactions to set the default sync on transaction end when they\r\ncreate the transaction, rather than just relying on type of transaction.  The previous patch set the intended behavior for commit but \r\nabort did not pick up the intended behaviour and it turned out each insert of a identity column row did commit and then destroy which called abort.  Gets rid of the previous routine which would check type of xact for every commit so should eliminate some small codepath also.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-05-25T16:33:48.001+0000","updated":"2012-05-25T16:38:11.447+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13284868","id":"13284868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"Tests all pass and I have verified that the nightly test performance is same before and after the change.  plan on committing today unless there are any reviewers who don't think it should go in.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-05-29T15:05:30.349+0000","updated":"2012-05-29T15:05:30.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13285023","id":"13285023","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I applied the derby-5494_3.diff patch and built insane jars. Then I re-ran the experiments described in the 5471-performance.html report attached to DERBY-5471. I observed the following:\r\n\r\no The IDENTITY 10 and IDENTITY 1 tests now run at the same transaction rate on 10.8.2.2 and the patched trunk.\r\n\r\no The SEQUENCE 10 and SEQUENCE 1 tests run at the same transaction rate on the trunk and the patched trunk.\r\n\r\nThis evidence supports the following conclusions:\r\n\r\n1) The patch restores the concurrency of identity columns seen in 10.8.2.2.\r\n\r\n2) The patch does not affect the concurrency of sequence generators.\r\n\r\nSo I say +1 to the patch. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-29T19:13:01.325+0000","updated":"2012-05-29T19:13:01.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13285628","id":"13285628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Mike,\r\n\r\nI see that you checked derby-5494_3.diff into the trunk at subversion revision 1344065. It does not appear to me that the fix has been ported to the 10.9 branch yet. Does some additional work need to be done before we port this to 10.9? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-30T12:50:28.244+0000","updated":"2012-05-30T12:50:28.244+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13285829","id":"13285829","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"i am hoping no additional work is necessary.  I am waiting to see clean trunk results from the nightly tests across platforms that include change 1327471, and once they pass am happy to backport to \r\n10.9.\r\n\r\nJust realized that no public ibm tests have posted since 5/22.  I saw it saying tuesday result and assumed it was yesterday.\r\nSo at this point just have tinderbox nightly result which passed, and no other nightly results..\r\n\r\nlooks like i missed the window for the sun runs.  \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-05-30T17:22:03.930+0000","updated":"2012-05-30T17:31:03.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13286685","id":"13286685","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The Oracle nightly tests on the trunk passed cleanly except for a heisenbug in the replication tests on JDK 1.6: http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.6/testing/Limited/testSummary-1344319.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-31T16:05:01.263+0000","updated":"2012-05-31T16:05:01.263+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13286796","id":"13286796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The IBM tests raised no errors either. Here are the Windows results: http://people.apache.org/~myrnavl/derby_test_results/main/windows/testSummary-1344525.html Here are the Linux results: http://people.apache.org/~myrnavl/derby_test_results/main/linux/testSummary-1344524.html Are we waiting for some other confirmation before backporting derby-5494_3.diff to 10.9? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-31T18:19:19.931+0000","updated":"2012-05-31T18:19:19.931+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13286819","id":"13286819","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"Fixed in 10.10 and backported to unreleased 10.9 branch prior to 10.9 being released.  Because of \r\nchange in behavior in syncing and extent of changes I don't think we should backport the changes for\r\nDERBY-5780 or DERBY-5494 to 10.8 or previous.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-05-31T18:47:31.327+0000","updated":"2012-05-31T18:47:31.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13286837","id":"13286837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Changed the fix-in version to 10.9.1.0 so that this issue will appear in the 10.9.1.0 release notes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-31T19:04:25.325+0000","updated":"2012-05-31T19:04:25.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291063","id":"13291063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"For both identity column and sequences, I ran two kinds of tests as explained below. I have run these tests 3 times each for 10.9 release(10.9.1.0) candidate and 10.8.1.2 release and have included the results below. The tests were run with write caching disabled.\r\n\r\nThe 2 kinds of tests for sequences and identity columns were as follows\r\n1)default behavior : For the test, when we let it pick the default behavior, number of threads default to 1, preallocate defaults to 100 on 10.9 and 5 on 10.8, numberOfGenerator defaults to 1, tablesPerGenerator defaults to 1 and insertsPerTransaction default to 1\r\n2)In this kind of run, I passed following paramters to the test.- number of threads 1, preallocation of 1,  numberOfGenerator to 1, tablesPerGenerator to 1 and insertsPerTransaction to 100\r\n\r\n\r\nIdentity test(default behavior)\r\njava -Dderby.system.home=./systest/db1 org.apache.derbyTesting.perf.clients.Runner -driver org.apache.derby.jdbc.EmbeddedDriver -init -load seq_gen -load_opts debugging=0,identityTest=1 -gen b2b\r\n-----------------------------------------------------------------------------------------------------------\r\n                                              10.9.1.0|                   10.8.1.2                   \r\n-----------------------------------------------------------------------------------------------------------\r\n - of transactions | Average Thruput       | - of transactions | Average Thruput \r\n-----------------------------------------------------------------------------------------------------------\r\n       5015        |   83.58333333333333  |         3889           |    64.81666666666666  \r\n-----------------------------------------------------------------------------------------------------------\r\n       4697        |   78.28333333333333  |         4578           |    76.3  \r\n-----------------------------------------------------------------------------------------------------------\r\n       5150        |   85.83333333333333  |         5016           |    83.6  \r\n-----------------------------------------------------------------------------------------------------------\r\n\r\n\r\nSequence test(default behavior)\r\njava -Dderby.system.home=./systest/db4 org.apache.derbyTesting.perf.clients.Runner -driver org.apache.derby.jdbc.EmbeddedDriver -init -load seq_gen -load_opts debugging=0,identityTest=0 -gen b2b \r\n-----------------------------------------------------------------------------------------------------------\r\n                                              10.9.1.0|                   10.8.1.2                   \r\n-----------------------------------------------------------------------------------------------------------\r\n - of transactions | Average Thruput       | - of transactions | Average Thruput \r\n-----------------------------------------------------------------------------------------------------------\r\n      5228        |    87.13333333333334  |         4330           |    72.16666666666667  \r\n-----------------------------------------------------------------------------------------------------------\r\n      5206        |    86.76666666666667  |         5026           |    83.76527057882369\r\n-----------------------------------------------------------------------------------------------------------\r\n      5010        |    83.5                               |         4489           |    74.81541974300428  \r\n-----------------------------------------------------------------------------------------------------------\r\n\r\n\r\nIdentity test(number of threads 1, preallocation of 1,  numberOfGenerator to 1, tablesPerGenerator to 1 and insertsPerTransaction to 100)\r\njava -Dderby.system.home=./systest/db7 -Dderby.language.sequence.preallocator=1 org.apache.derbyTesting.perf.clients.Runner -driver org.apache.derby.jdbc.EmbeddedDriver -init -load seq_gen -load_opts debugging=0,numberOfGenerators=1,tablesPerGenerator=1,insertsPerTransaction=100,identityTest=1 -gen b2b -threads 1\r\n-----------------------------------------------------------------------------------------------------------\r\n                                              10.9.1.0|                   10.8.1.2                   \r\n-----------------------------------------------------------------------------------------------------------\r\n - of transactions | Average Thruput       | - of transactions | Average Thruput \r\n-----------------------------------------------------------------------------------------------------------\r\n       1537        |   25.616666666666667 |         1086           |    18.099698338361026\r\n-----------------------------------------------------------------------------------------------------------\r\n       1628        |   27.133333333333333 |         1518           |    25.3\r\n-----------------------------------------------------------------------------------------------------------\r\n       1514        |   25.230810252308103 |         1472           |    24.533333333333335\r\n-----------------------------------------------------------------------------------------------------------\r\n\r\n\r\n\r\nSequence test(number of threads 1, preallocation of 1,  numberOfGenerator to 1, tablesPerGenerator to 1 and insertsPerTransaction to 100)\r\njava -Dderby.system.home=./systest/db11 -Dderby.language.sequence.preallocator=1 org.apache.derbyTesting.perf.clients.Runner -driver org.apache.derby.jdbc.EmbeddedDriver -init -load seq_gen -load_opts debugging=0,numberOfGenerators=1,tablesPerGenerator=1,insertsPerTransaction=100,identityTest=0 -gen b2b -threads 1 \r\n-----------------------------------------------------------------------------------------------------------\r\n                                              10.9.1.0|                   10.8.1.2                   \r\n-----------------------------------------------------------------------------------------------------------\r\n - of transactions | Average Thruput       | - of transactions | Average Thruput \r\n-----------------------------------------------------------------------------------------------------------\r\n        50         |   0.8333333333333334 |         3054           |   50.9\r\n-----------------------------------------------------------------------------------------------------------\r\n        47         |   0.7833333333333333 |         3033           |   50.55\r\n-----------------------------------------------------------------------------------------------------------\r\n        49         |   0.8166666666666667 |         3000           |   50.0\r\n-----------------------------------------------------------------------------------------------------------\r\n\r\n\r\n\r\n\r\nAverage time for each of the tests above\r\n----------------------------------------------------------------------------------------------------------- \r\n                                              10.9.1.0| 10.8.1.2 \r\n----------------------------------------------------------------------------------------------------------- \r\n                 Test type | # of transactions | Average Thruput | # of transactions | Average Thruput \r\n----------------------------------------------------------------------------------------------------------- \r\n          Identity default |       5015 | 83.58333333333333  | 4578 | 76.3 \r\n----------------------------------------------------------------------------------------------------------- \r\n          Sequence default |       5206 | 86.76666666666667  | 4489 | 74.81541974300428  \r\n----------------------------------------------------------------------------------------------------------- \r\nIdentity prellocation of 1 |       1537 | 25.616666666666667 | 1472 | 24.533333333333335\r\n----------------------------------------------------------------------------------------------------------- \r\nSequence prellocation of 1 |         49 | 0.8166666666666667 | 3033 | 50.55\r\n----------------------------------------------------------------------------------------------------------- ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-06-07T15:09:28.961+0000","updated":"2012-06-07T18:52:56.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291202","id":"13291202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for running the latest batch of experiments, Mamta.  It is good to see that, on your platform, the 10.9.1 defaults result in slightly better throughput for sequences and identities than the previous 10.8.2 release. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-07T18:45:53.156+0000","updated":"2012-06-07T18:45:53.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291242","id":"13291242","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":" It looks like all the results between the 2 releases are very comparable except for sequences when the preallocation is set to 1. On 10.9.1.0, we got a thru put of 0.8166666666666667  where as on 10.8..1.2, we got thru put of 50.55 tx/sec","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-06-07T19:32:56.424+0000","updated":"2012-06-07T19:32:56.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291250","id":"13291250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Mamta,\r\n\r\nYes, that lower throughput for sequences when preallocation is set to 1 appears to be the cost of the correctness work done in 10.9. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-07T19:45:09.980+0000","updated":"2012-06-07T19:45:09.980+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291327","id":"13291327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"The perfomance results posted are along what I expect given the work gone into 10.9.  Default behavior seems better or same for both\r\nidentity and sequences.\r\n\r\nThe preallocation of 1, single user sequence is the worst case I can think of.  In order to insure that a sequence number is not given out\r\ntwice a synchonous commit is done for each allocation, where it was asynchronous in 10.8.  Not sure if we should document the \r\n50 fold slowdown in the worst case.  If user does not touch tuning knobs we expect no slow down, and on this platform see a slight\r\nperformance gain.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-06-07T21:38:30.672+0000","updated":"2012-06-07T21:38:30.672+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291761","id":"13291761","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I would be happy to build a new release candidate if we wanted to add a release note explaining how to get better concurrency for sequences by adjusting the value of derby.language.sequence.preallocator.\r\n\r\nNote, however, that the derby.language.sequence.preallocator knob is added by 10.9. It does not appear in 10.8. The knob was added by derby-4437-05-aa-pluggablePreallocation.diff (revision 1138434), ported to 10.8 by revision 1141645, but backed out of 10.8 by derby-5448-01-aa-backoutConcurrencyChanges.diff (revision 1179717).\r\n\r\nSo I would not expect that this knob would be set by users upgrading from 10.8. Users  upgrading from 10.8 will get the new default preallocation size of 100.\r\n\r\nMamta and I have run experiments with different settings of derby.language.sequence.preallocator. So far our only evidence is that the concurrency of sequences is better in 10.9 than in 10.8.\r\n\r\nAt this point, I don't know what a release note would say other than \"We expect that the concurrency of your sequence generators has gone up by upgrading to 10.9. If you want even better concurrency, consider adjusting derby.language.sequence.preallocator.\"\r\n\r\nDoes that advice merit a release note? Is there some other advice we should give in a release note? Does this advice merit a new release candidate?\r\n\r\nThanks,\r\n-Rick\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-08T13:07:32.641+0000","updated":"2012-06-08T13:07:32.641+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291780","id":"13291780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I don't think it merits a new release candidate. We already mention this in the reference manual, and I don't think it's worthwhile spinning a new RC just to copy that information into the release notes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-06-08T13:46:55.760+0000","updated":"2012-06-08T13:46:55.760+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291793","id":"13291793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I didn't realize that knob is new to 10.9 (at least for customer use).   So I think it is less important to note this is a release note vs whatever we have in documentation.  \r\n\r\nJust to verify the amount of preallocation is not stored in a catalog per table, correct?  A user either hard or soft upgrading a sequence from\r\n10.8 is still going to see the new default 100 preallocation, correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-06-08T14:15:17.988+0000","updated":"2012-06-08T14:15:17.988+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291813","id":"13291813","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The preallocation size is not persisted. In 10.9 the value defaults to 100 regardless of whether you hard or soft upgrade.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-08T15:03:04.154+0000","updated":"2012-06-08T15:03:04.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12530576/comment/13291849","id":"13291849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think  *if* we made a new release candidate, the performance improvement and relation to derby.language.sequence.preallocator would be worth mentioning in the release note.  Also might want to mention that users seeking increased performance for identity columns might want to try implementing as sequences. That way we might encourage users to exercise sequences more in preparation for ultimately transitioning identity columns to use this code.  If there is not a new release candidate, a blurb in the announcement might do just as well or even garner more attention.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-06-08T16:30:28.764+0000","updated":"2012-06-08T16:30:28.764+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5494/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06gvr:"}}