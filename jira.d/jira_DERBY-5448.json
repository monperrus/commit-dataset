{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12526066","self":"https://issues.apache.org/jira/rest/api/latest/issue/12526066","key":"DERBY-5448","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-10-06 17:38:14.492","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"49632","customfield_12310222":"1_*:*_1_*:*_11280571_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-10-06T18:53:03.743+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5448/watchers","watchCount":0,"isWatching":false},"created":"2011-10-06T15:45:03.215+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12344022","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12344022","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12523651","key":"DERBY-5422","self":"https://issues.apache.org/jira/rest/api/2/issue/12523651","fields":{"summary":"IndexOutOfBoundsException followed by NullPointerException in cleanup during system.nstest ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12349705","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12349705","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12548026","key":"DERBY-5671","self":"https://issues.apache.org/jira/rest/api/2/issue/12548026","fields":{"summary":"NsTest does not run on trunk do multiple issues stemming from concurrency improvements ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12344021","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12344021","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12524667","key":"DERBY-5430","self":"https://issues.apache.org/jira/rest/api/2/issue/12524667","fields":{"summary":"Embedded nstest shows ERROR 40001: A lock could not be obtained due to a deadlock,  in nstest","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12344076","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12344076","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12526493","key":"DERBY-5454","self":"https://issues.apache.org/jira/rest/api/2/issue/12526493","fields":{"summary":"ERROR 40001 deadlock in nstest on select max(serialkey)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12344020","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12344020","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12440016","key":"DERBY-4437","self":"https://issues.apache.org/jira/rest/api/2/issue/12440016","fields":{"summary":"Concurrent inserts into table with identity column perform poorly","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-14T17:21:21.187+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11406","id":"11406","name":"Documentation"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"New errors were seen while running NsTest against the 10.8.2 release candidates. These errors are recorded as DERBY-5430 and DERBY-5422. The first error is a deadlock which occurs when inserting into the main table of the test. The second error is a problem clearing the identity cache. These errors have caused people to lose confidence in the concurrency improvements introduced by DERBY-4437. We should back the DERBY-4437 changes out of the 10.8 branch and use the trunk to continue debugging the problems disclosed by NsTest.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35849","summary":"In the 10.8 branch, back out the concurrency improvements introduced by using SequenceUpdaters to allocate identity values.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":27,"total":27,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122025","id":"13122025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-5448-01-aa-backoutConcurrencyChanges.diff. Regression tests ran cleanly for me against this patch. This patch backs out the following ports to the 10.8 branch and reverts 10.8 to the old style of identity generation:\r\n\r\nDERBY-4437 1141645: This is the master commit which ported most of the 10.9 changes to 10.8\r\n\r\nDERBY-4437 1142052: This commit ported an upgrade test from 10.9 to 10.8. The test verifies the new identity behavior.\r\n\r\nDERBY-5408 1170178: This commit ported the localization fixes for the 2200H message from 10.9 to the 10.8 branch.\r\n\r\nDERBY-5426 1174297: This commit ported some SequenceUpdater changes from 10.9 to the 10.8 branch. The changes improved the error reporting when there was too much contention on an identity column. \r\n\r\n-----------------------------\r\n\r\nI still see deadlocks in NsTest after applying this patch. However, the deadlocks do not involve identity generation as far as I can tell. I don't know enough about NsTest to say whether these deadlocks warrant additional investigation before building a new 10.8.2 release candidate. Here is the deadlock cycle I see now:\r\n\r\njava.sql.SQLTransactionRollbackException: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:\r\nLock : ROW, NSTESTTAB, (605,25)\r\n  Waiting XID : {98562, S} , NSTEST, select max(serialkey) from nstesttab where serialkey > ?\r\n  Granted XID : {98556, X} \r\nLock : ROW, NSTESTTAB, (605,29)\r\n  Waiting XID : {98556, S} , NSTEST, select max(serialkey) from nstesttab where serialkey > ?\r\nLock : ROW, NSTESTTAB, (605,29)\r\n  Waiting XID : {98530, X} , NSTEST,  update nstesttab set t_char = ?  where serialkey = 36733\r\nLock : ROW, NSTESTTAB, (605,29)\r\n  Waiting XID : {98571, X} , NSTEST,  update nstesttab set t_double = ?  where serialkey = 36733\r\nLock : ROW, NSTESTTAB, (605,29)\r\n  Waiting XID : {98536, X} , NSTEST,  update nstesttab set t_timestamp = ?  where serialkey = 36733\r\nLock : ROW, NSTESTTAB, (605,29)\r\n  Waiting XID : {98509, X} , NSTEST,  delete from nstesttab where serialkey = ?\r\nLock : ROW, NSTESTTAB, (605,29)\r\n  Waiting XID : {98533, X} , NSTEST,  delete from nstesttab where serialkey = ?\r\n  Granted XID : {98516, X} \r\nLock : ROW, NSTESTTAB, (605,25)\r\n  Waiting XID : {98516, S} , NSTEST, select max(serialkey) from nstesttab where serialkey > ?\r\nLock : ROW, NSTESTTAB, (605,25)\r\n  Waiting XID : {98576, X} , NSTEST,  update nstesttab set t_longint = ?  where serialkey = 36729\r\n. The selected victim is XID : 98562.\r\n\r\n-----------------------------\r\n\r\nTouches the following files:\r\n\r\nM       java/storeless/org/apache/derby/impl/storeless/EmptyDictionary.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/CreateSequenceNode.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/NextSequenceNode.java\r\nM       java/engine/org/apache/derby/impl/sql/execute/InsertResultSet.java\r\nM       java/engine/org/apache/derby/impl/sql/execute/BaseActivation.java\r\nM       java/engine/org/apache/derby/impl/sql/execute/InsertConstantAction.java\r\nM       java/engine/org/apache/derby/impl/sql/catalog/SequenceGenerator.java\r\nM       java/engine/org/apache/derby/impl/sql/catalog/DataDictionaryImpl.java\r\nD       java/engine/org/apache/derby/impl/sql/catalog/SequenceRange.java\r\nM       java/engine/org/apache/derby/impl/sql/catalog/SequenceUpdater.java\r\nM       java/engine/org/apache/derby/impl/db/BasicDatabase.java\r\nM       java/engine/org/apache/derby/iapi/sql/dictionary/DataDictionary.java\r\nM       java/engine/org/apache/derby/iapi/sql/dictionary/SequenceDescriptor.java\r\nM       java/engine/org/apache/derby/iapi/reference/Property.java\r\nD       java/engine/org/apache/derby/catalog/SequencePreallocator.java\r\nM       java/engine/org/apache/derby/loc/messages_de_DE.properties\r\nM       java/engine/org/apache/derby/loc/messages_ko_KR.properties\r\nM       java/engine/org/apache/derby/loc/messages_fr.properties\r\nM       java/engine/org/apache/derby/loc/messages_es.properties\r\nM       java/engine/org/apache/derby/loc/messages_it.properties\r\nM       java/engine/org/apache/derby/loc/messages_ja_JP.properties\r\nM       java/engine/org/apache/derby/loc/messages.xml\r\nM       java/engine/org/apache/derby/loc/messages_zh_TW.properties\r\nM       java/shared/org/apache/derby/shared/common/reference/SQLState.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/AlterTableTest.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/AutoIncrementTest.java\r\nD       java/testing/org/apache/derbyTesting/functionTests/tests/lang/t_4437_2.dat\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/SequenceGeneratorTest.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/UpgradeRun.java\r\nD       java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/Changes10_8_2.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/UpgradeChange.java\r\nM       tools/javadoc/publishedapi.ant\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-06T16:00:36.336+0000","updated":"2011-10-06T16:00:36.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122091","id":"13122091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Committed derby-5448-01-aa-backoutConcurrencyChanges.diff to 10.8 branch at subversion revision 1179717.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-06T17:37:37.092+0000","updated":"2011-10-06T17:37:37.092+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122092","id":"13122092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"How disappointing. I'll apply your patch and see if I can see those deadlocks also.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-10-06T17:38:14.492+0000","updated":"2011-10-06T17:38:14.492+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122104","id":"13122104","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I see you committed. Thanks for doing the backing out Rick. I'll try nstest with the branch sync-ed up and will report back...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-10-06T17:53:02.819+0000","updated":"2011-10-06T17:53:02.819+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122152","id":"13122152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-5448-02-aa-backoutDocsChanges.diff. This patch removes the 10.8 documentation of the derby.language.sequence.preallocator property. Committed to the 10.8 docs branch at subversion revision 1179759.\r\n\r\nThis patch backs out the following commit:\r\n\r\nDERBY-5307 1141651: This commit ported documentation of the derby.language.sequence.preallocator property from 10.9 docs to 10.8 docs. Note that the property still has meaning for sequences although the property would be less capable after backing out 1141645. \r\n\r\n\r\nTouches the following files:\r\n\r\nM       src/ref/rrefsqlj37836.dita\r\nM       src/ref/rrefsqljcreatesequence.dita\r\nD       src/ref/rrefproperpreallocator.dita\r\nM       src/ref/crefproper22250.dita\r\nM       src/ref/refderby.ditamap\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-06T18:48:33.258+0000","updated":"2011-10-06T18:54:55.675+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122182","id":"13122182","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"One more thing I thought to mention: I've not seen deadlocks in this test since I started running them (for QA cycle for 10.5, I think), but comments in the test lead me to believe they may have been possible.\r\nI'm referring to this section in the Tester1 class:\r\n\t\t// Too many deadlocks amd locking issues if this is not commented out\r\n\t\ttry {\r\n\t\t\tconnex.setAutoCommit(false);\r\n\t\t} catch (Exception e) {\r\n\t\t\tSystem.out.println(\"FAIL: \" + getThread_id()\r\n\t\t\t\t\t+ \"'s setAutoCommit() failed:\");\r\n\t\t\tprintException(\"setting AutoCommit\", e);\r\n\t\t}\r\n\r\n\t\t// also set isolation level to Connection.TRANSACTION_READ_UNCOMMITTED\r\n\t\t// to reduce number of\r\n\t\t// deadlocks\r\n\t\tsetIsolationLevel(Connection.TRANSACTION_READ_UNCOMMITTED);\r\nSo perhaps a different hardware/jvm combination is more/less likely to run into deadlock situations...?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-10-06T19:22:26.970+0000","updated":"2011-10-06T19:22:26.970+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122212","id":"13122212","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I agree that the deadlocks do not seem identity related given the trace.  It might shed light if anyone can reproduce with full lock tracing on and get a full lock table dump.  \r\n\r\nit looks like muliple threads are doing \"max's\" while in a multi-statement transaction and holding previous X row locks on the table leading\r\nto classic user level deadlock.  \r\n\r\nThere was a change to MAX in 10.8 ( DERBY-642), but I do not know if these queries go through that code path.  That would not explain\r\nit if nstest is getting deadlock in 10.8 RC, but not in the initial 10.8 release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-10-06T20:08:07.949+0000","updated":"2011-10-06T20:08:07.949+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122253","id":"13122253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"DERBY-642 is marked as fixed in 10.8.1.2 - so the initial 10.8 release...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-10-06T20:28:26.088+0000","updated":"2011-10-06T20:28:26.088+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122272","id":"13122272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"That deadlock error message format is wierd to me.  Did it change?  I am used to seeing all grant and wait for each lock like this example from the documentation:\r\nERROR 40001: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:\r\nLock : ROW, T, (1,8)\r\n  Waiting XID : {235, S} , APP, select * from t where id = 2\r\n  Granted XID : {238, X}\r\nLock : ROW, T, (1,7)\r\n  Waiting XID : {238, S} , APP, select * from t where id = 1\r\n  Granted XID : {235, X}\r\n. The selected victim is XID : 235. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-10-06T20:41:34.559+0000","updated":"2011-10-06T20:41:34.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122793","id":"13122793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I have re-run NsTest on the sane jars on 10.8 (after checking in derby-5448-01-aa-backoutConcurrencyChanges.diff. I set the following switches on the command line but I don't see any additional information in derby.log. Mike, what switches should I set to get the additional information you need from the lock table?\r\n\r\n  -Dderby.stream.error.extendedDiagSeverityLevel=30000 \\\r\n  -Dderby.locks.monitor=true \\\r\n  -Dderby.locks.deadlockTrace=true \\\r\n\r\nUnfortunately, this time around I saw a deadlock which involved the identity column (i.e., the SYSCOLUMNS row). I am including the deadlock trace and the stack trace. The deadlock is found while trying to allocate the next identity value. You can see from the stack trace that this is the old identity generation logic which Derby has been using for the past several years. At this point it may be useful to do the following:\r\n\r\n1) come up with a repro which pops the deadlock faster\r\n\r\n2) perform a binary search on the 10.8 branch, looking for the checkin which introduced this deadlock\r\n\r\nERROR 40001: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:\r\nLock : ROW, SYSCOLUMNS, (5,16)\r\n  Waiting XID : {98270, X} , NSTEST,  insert into nstesttab (id, t_char, t_date, t_decimal, t_decimal_nn, t_double,  t_float, t_int, t_longint, t_numeric_large, t_real, t_smallint, t_time, t_timestamp, t_varchar,t_clob,t_blob) values ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,cast('00000000000000000000000000000000031' as clob(1K)),cast(X'000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031' as blob(10K)))\r\n  Granted XID : {98178, X} \r\nLock : ROW, NSTESTTAB, (603,39)\r\n  Waiting XID : {98178, S} , NSTEST, select max(serialkey) from nstesttab where serialkey > ?\r\n  Granted XID : {98245, X} \r\nLock : ROW, SYSCOLUMNS, (5,16)\r\n  Waiting XID : {98245, X} , NSTEST,  insert into nstesttab (id, t_char, t_date, t_decimal, t_decimal_nn, t_double,  t_float, t_int, t_longint, t_numeric_large, t_real, t_smallint, t_time, t_timestamp, t_varchar,t_clob,t_blob) values ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,cast('00000000000000000000000000000000031' as clob(1K)),cast(X'000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000031' as blob(10K)))\r\n. The selected victim is XID : 98270.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:303)\r\n\tat org.apache.derby.impl.services.locks.Deadlock.buildException(Deadlock.java:554)\r\n\tat org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(ConcurrentLockSet.java:629)\r\n\tat org.apache.derby.impl.services.locks.AbstractPool.lockObject(AbstractPool.java:119)\r\n\tat org.apache.derby.impl.services.locks.ConcurrentPool.lockObject(ConcurrentPool.java:28)\r\n\tat org.apache.derby.impl.store.raw.xact.RowLocking3.lockRecordForWrite(RowLocking3.java:248)\r\n\tat org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.lockPositionForWrite(OpenConglomerate.java:587)\r\n\tat org.apache.derby.impl.store.access.conglomerate.GenericConglomerateController.fetch(GenericConglomerateController.java:382)\r\n\tat org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSetAutoincrementValue(DataDictionaryImpl.java:8676)\r\n\tat org.apache.derby.impl.sql.execute.InsertResultSet.getSetAutoincrementValue(InsertResultSet.java:830)\r\n\tat org.apache.derby.impl.sql.execute.BaseActivation.getSetAutoincrementValue(BaseActivation.java:666)\r\n\tat org.apache.derby.exe.ac88e70ddcx0132xde76x081bx0000045c93288.e0(Unknown Source)\r\n\tat org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:139)\r\n\tat org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(RowResultSet.java:148)\r\n\tat org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(NormalizeResultSet.java:185)\r\n\tat org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127)\r\n\tat org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:504)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1686)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:308)\r\n\tat org.apache.derbyTesting.system.nstest.utils.DbUtil.add_one_row(DbUtil.java:201)\r\n\tat org.apache.derbyTesting.system.nstest.tester.TesterObject.doIUDOperation(TesterObject.java:148)\r\n\tat org.apache.derbyTesting.system.nstest.tester.Tester2.startTesting(Tester2.java:109)\r\n\tat org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:555)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-07T13:30:41.224+0000","updated":"2011-10-07T13:30:41.224+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122939","id":"13122939","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"rick, those are the switches I was think of.  It looks like lock output has changed since I last debugged these kinds of problems, I will look at code and see if anything else is possible.  \r\n\r\nYou don't mention how long it takes for you to repro.  Since you seem to have the hardware/jvm combination that repro's could you run a test against the existing 10.8 apache release (not the RC but the actual release), just to verify this is a regression in 10.8.  I believe these kinds of \r\nissues are very timing dependent and hardware/JVM can affect the runs greatly.  \r\n\r\nAlso anyone running nstest on top branch can you mention if you are seeing any of the other issues that we were hoping were going to be fixed\r\nby backing out 5448 (like DERBY-5422 and DERBY-5428 and maybe others).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-10-07T16:36:03.192+0000","updated":"2011-10-07T16:36:03.192+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122945","id":"13122945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I think the following option will print more info on deadlock.  It will only work in a SANE server.  Note that if you need to set more than one \r\ndebug option it takes a comma separated list of options.\r\n\r\nderby.debug.true=DeadlockTrace","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-10-07T16:41:12.710+0000","updated":"2011-10-07T16:41:12.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13122977","id":"13122977","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks, Mike. The identity deadlock happened 5.5 minutes after starting NsTest. I will run NsTest against 10.8.1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-07T17:31:54.780+0000","updated":"2011-10-07T17:31:54.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13123065","id":"13123065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I have run NsTest five times against the 10.8.1.2 insane jars. Each duration lasted around 10 minutes. I did not see any deadlocks. I will repeat this experiment against the 10.8.1.2 sane jars.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-07T18:54:25.703+0000","updated":"2011-10-07T18:54:54.559+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13123119","id":"13123119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I have run NsTest five times against the 10.8.1.2 sane jars. Each duration lasted around 10 minutes. I did not see any deadlocks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-07T19:51:20.190+0000","updated":"2011-10-07T19:51:20.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13123208","id":"13123208","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"rick, can you describe the environment of your test run.  machine, number of processors, speed, OS, JVM?  \r\n\r\nI did a scan of the svn log of all the changes done in 10.8 and nothing jumped out at me.  There have a been a few fixes that changed \r\nsychronization a little to fix bugs and that could have changed timing of the runs, I guess.  So far I have just been looking at descriptions\r\nnot code.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-10-07T21:24:32.337+0000","updated":"2011-10-07T21:24:32.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13123294","id":"13123294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I just reproduced against top of 10.8 branch, SANE, windows XP, single cpu, dual core, ibm laptop t60p.  took me 38 minutes.\r\nrunning nstest as:\r\njava \\\r\n-Dderby.stream.error.extendedDiagSeverityLevel=30000 \\\r\n-Dderby.locks.monitor=true \\\r\n-Dderby.locks.deadlockTrace=true \\\r\norg.apache.derbyTesting.system.nstest.NsTest \\\r\nEmbedded > nstest.out 2>&1\r\n\r\n\r\nFri Oct 07 15:17:28 PDT 2011 Thread[Thread 36,5,main] (XID = 130487), (SESSIONID = 88), (DATABASE = nstestdb), (DRDAID = null), Failed Statement is:\r\ninsert into nstesttab (id, t_char, t_date, t_decimal, t_decimal_nn, t_double,  t_float, t_int, t_longint, t_numeric_large, t_real, t_smallint, t_time,\r\n t_timestamp, t_varchar,t_clob,t_blob) values ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,cast('00000000000000000000000000000000031' as clob(1K)),ca\r\nst(X'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\r\n00000000000000000000000000000000000000000000031' as blob(10K))) with 15 parameters begin parameter #1: 684965125 :end parameter begin parameter #2: CV\r\nZXCVZXCV !@#$!@#$ asdfasdf 1 q a  :end parameter begin parameter #3: 3713-01-07 :end parameter begin parameter #4: 828.5777992596651 :end parameter be\r\ngin parameter #5: 0.2472237598957745 :end parameter begin parameter #6: 4.995415321343787E285 :end parameter begin parameter #7: 8.21632369503401E25 :\r\nend parameter begin parameter #8: -1314135079 :end parameter begin parameter #9: 777072442558566171 :end parameter begin parameter #10: 6.333797131351\r\n71 :end parameter begin parameter #11: 25.84169 :end parameter begin parameter #12: 32594 :end parameter begin parameter #13: 01:11:04 :end parameter\r\nbegin parameter #14: 2075-01-18 15:28:15.9 :end parameter begin parameter #15: qwerqwer 12341234 ZXCVZXCVZXCV !@#$!@#$ asdfasdf 1 q a z asdf ASDF qwer\r\nasdfzxcvasdfqwer1234asd# :end parameter ^M\r\nERROR 40001: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:\r\nLock : ROW, SYSCOLUMNS, (5,16)\r\n  Waiting XID : {130487, X} , NSTEST,  insert into nstesttab (id, t_char, t_date, t_decimal, t_decimal_nn, t_double,  t_float, t_int, t_longint, t_num\r\neric_large, t_real, t_smallint, t_time, t_timestamp, t_varchar,t_clob,t_blob) values ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,cast('0000000000000\r\n0000000000000000000031' as clob(1K)),cast(X'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\r\n00000000000000000000000000000000000000000000000000000000000000000000000000000000000031' as blob(10K)))\r\n  Granted XID : {130470, X}\r\nLock : ROW, NSTESTTAB, (687,40)\r\n  Waiting XID : {130470, S} , NSTEST, select max(serialkey) from nstesttab where serialkey > ?\r\n  Granted XID : {130455, X}\r\nLock : ROW, SYSCOLUMNS, (5,16)\r\n  Waiting XID : {130455, X} , NSTEST,  insert into nstesttab (id, t_char, t_date, t_decimal, t_decimal_nn, t_double,  t_float, t_int, t_longint, t_num\r\neric_large, t_real, t_smallint, t_time, t_timestamp, t_varchar,t_clob,t_blob) values ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,cast('0000000000000\r\n0000000000000000000031' as clob(1K)),cast(X'0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\r\n00000000000000000000000000000000000000000000000000000000000000000000000000000000000031' as blob(10K)))\r\n. The selected victim is XID : 130487.^M\r\n    at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:303)^M\r\n    at org.apache.derby.impl.services.locks.Deadlock.buildException(Deadlock.java:554)^M\r\n    at org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(ConcurrentLockSet.java:629)^M\r\n    at org.apache.derby.impl.services.locks.AbstractPool.lockObject(AbstractPool.java:119)^M\r\n    at org.apache.derby.impl.services.locks.ConcurrentPool.lockObject(ConcurrentPool.java:28)^M\r\n    at org.apache.derby.impl.store.raw.xact.RowLocking3.lockRecordForWrite(RowLocking3.java:248)^M\r\n    at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.lockPositionForWrite(OpenConglomerate.java:587)^M\r\n    at org.apache.derby.impl.store.access.conglomerate.GenericConglomerateController.fetch(GenericConglomerateController.java:382)^M\r\n    at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSetAutoincrementValue(DataDictionaryImpl.java:8676)^M\r\n    at org.apache.derby.impl.sql.execute.InsertResultSet.getSetAutoincrementValue(InsertResultSet.java:830)^M\r\n    at org.apache.derby.impl.sql.execute.BaseActivation.getSetAutoincrementValue(BaseActivation.java:666)^M\r\n    at org.apache.derby.exe.accf0fdf6ax0132xe04fxbf22x0000001a6cc01f.e0(Unknown Source)^M\r\n    at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:139)^M\r\n    at org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(RowResultSet.java:148)^M\r\n    at org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(NormalizeResultSet.java:185)^M\r\n    at org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(DMLWriteResultSet.java:127)^M\r\n    at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:504)^M\r\n    at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436)^M\r\n    at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317)^M\r\n    at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)^M\r\n    at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1686)^M\r\n    at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:308)^M\r\n    at org.apache.derbyTesting.system.nstest.utils.DbUtil.add_one_row(DbUtil.java:201)^M\r\n    at org.apache.derbyTesting.system.nstest.tester.TesterObject.doIUDOperation(TesterObject.java:148)^M\r\n    at org.apache.derbyTesting.system.nstest.tester.Tester2.startTesting(Tester2.java:109)^M\r\n    at org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:555)^M","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-10-07T23:16:32.323+0000","updated":"2011-10-07T23:16:32.323+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13123343","id":"13123343","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"For what it's worth, I kicked off 3 runs yesterday, and so far, there are no deadlocks.\r\n\r\nHowever, on one machine, with sane jars, I did see these errors:\r\nERROR XSLA6: Cannot recover the database.\r\nERROR 40XT4: An attempt was made to close a transaction that was still active. The transaction has been aborted.\r\n\r\nThe first hint of trouble here was:\r\norg.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED  inconsistency in space management during insert:  slot = 146 getSlotOffset(slot) = 3206 dataWritten = 19 freeSpace = -15 firstFreeByte = 3149 page = ---------------------------------------------------\r\npage id: Page(378,Container(0, 1153)) Overflow: false PageVersion: 895 SlotsInUse: 159 DeletedRowCount: 93 PageStatus: 1 NextId: 317 firstFreeByte: 3149 freeSpace: -15 totalSpace: 4028 spareSpace: 0% minimumRecordSize : 1 PageSize: 4096\r\n\r\nI logged DERBY-5450 for this and attached the derby.log.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-10-08T01:27:29.649+0000","updated":"2011-10-08T01:58:10.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13123745","id":"13123745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I was trying to binary search the deadlock error in the 10.8 branch, but it seems to not reproduce all the time for me.  So far I have \r\nreproduced once as far back as 1170106.  but running for 2 hours did not reproduce again.  I have not reproduced later than this but\r\nthat particular issue makes no sense to cause this.\r\nsvn update -r 1170106 deadlock in 34 minutes.\r\nsvn update -r 1170106 no deadlock in 120 minutes.\r\n\r\nI think the only thing that can be deduced is that deadlock is caused by something before 1170106 or it has always been around and\r\njust unlucky to cause it.  I'll try a few more, but if anyone has time and sees a deadlock in 10.8 sometime before this change post it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-10-09T18:06:39.053+0000","updated":"2011-10-09T18:06:39.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13123957","id":"13123957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Not sure if it's related, but DERBY-3980 (fixed in 10.8.1.2) made the deadlock detector able to recognize some deadlock situations that previously would have been reported as timeouts. So it might be that the deadlocks have always been there, but only recently started getting reported as deadlocks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-10-10T08:52:44.791+0000","updated":"2011-10-10T08:52:44.791+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13124036","id":"13124036","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Here is some information on my machine:\r\n\r\nProcessor: 2.4 GHz Intel core 2 duo\r\nMemory: 4 GB 667 MHz DDR2 SDRAM\r\nOS: Mac OS X 10.6.8\r\nJVM: Java(TM) SE Runtime Environment (build 1.6.0_26-b03-384-10M3515) Java HotSpot(TM) 64-Bit Server VM (build 20.1-b02-384, mixed mode)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-10T12:24:54.706+0000","updated":"2011-10-10T12:24:54.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13124152","id":"13124152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I ran NsTest 5 times against the 10.8 branch at revision 1170106. Each run lasted at least 10 minutes. I did not see any deadlocks although I did see lock timeouts.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-10T14:58:55.298+0000","updated":"2011-10-10T14:58:55.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13124283","id":"13124283","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"saw a deadlock at revision 1136020 after about an hour.  But no deadlock involved the system catalogs.  All were of the following form:\r\nERROR 40001: A lock could not be obtained due to a deadlock, cycle of locks and waiters is:\r\nLock : ROW, NSTESTTAB, (682,50)\r\n  Waiting XID : {138765, S} , NSTEST, select max(serialkey) from nstesttab where serialkey > ?\r\n  Granted XID : {138763, X}\r\nLock : ROW, NSTESTTAB, (682,53)\r\n  Waiting XID : {138763, S} , NSTEST, select max(serialkey) from nstesttab where serialkey > ?\r\n  Granted XID : {138765, X}\r\n. The selected victim is XID : 138765.^M\r\n    at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:303)^M\r\n    at org.apache.derby.impl.services.locks.Deadlock.buildException(Deadlock.java:554)^M\r\n    at org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(ConcurrentLockSet.java:629)^M\r\n    at org.apache.derby.impl.services.locks.ConcurrentLockSet.zeroDurationLockObject(ConcurrentLockSet.java:871)^M\r\n    at org.apache.derby.impl.services.locks.AbstractPool.zeroDurationlockObject(AbstractPool.java:297)^M\r\n    at org.apache.derby.impl.services.locks.ConcurrentPool.zeroDurationlockObject(ConcurrentPool.java:28)^M\r\n    at org.apache.derby.impl.store.raw.xact.RowLocking2nohold.lockRecordForRead(RowLocking2nohold.java:89)^M\r\n    at org.apache.derby.impl.store.access.heap.HeapController.lockRow(HeapController.java:520)^M\r\n    at org.apache.derby.impl.store.access.heap.HeapController.lockRow(HeapController.java:638)^M\r\n    at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3.lockRowOnPage(B2IRowLocking3.java:309)^M\r\n    at org.apache.derby.impl.store.access.btree.index.B2IRowLocking3._lockScanRow(B2IRowLocking3.java:599)^M\r\n    at org.apache.derby.impl.store.access.btree.index.B2IRowLockingRR.lockScanRow(B2IRowLockingRR.java:105)^M\r\n    at org.apache.derby.impl.store.access.btree.BTreeForwardScan.fetchRows(BTreeForwardScan.java:305)^M\r\n    at org.apache.derby.impl.store.access.btree.BTreeScan.fetchNextGroup(BTreeScan.java:1681)^M\r\n    at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.reloadArray(BulkTableScanResultSet.java:353)^M\r\n    at org.apache.derby.impl.sql.execute.BulkTableScanResultSet.getNextRowCore(BulkTableScanResultSet.java:294)^M\r\n    at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:261)^M\r\n    at org.apache.derby.impl.sql.execute.ScalarAggregateResultSet.getRowFromResultSet(ScalarAggregateResultSet.java:355)^M\r\n    at org.apache.derby.impl.sql.execute.ScalarAggregateResultSet.getNextRowCore(ScalarAggregateResultSet.java:179)^M\r\n    at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:261)^M\r\n    at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:478)^M\r\n    at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:430)^M\r\n    at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:374)^M\r\n    at org.apache.derbyTesting.system.nstest.utils.DbUtil.pick_one(DbUtil.java:527)^M\r\n    at org.apache.derbyTesting.system.nstest.utils.DbUtil.delete_one_row(DbUtil.java:440)^M\r\n    at org.apache.derbyTesting.system.nstest.tester.TesterObject.doIUDOperation(TesterObject.java:175)^M\r\n    at org.apache.derbyTesting.system.nstest.tester.Tester2.startTesting(Tester2.java:109)^M\r\n    at org.apache.derbyTesting.system.nstest.NsTest.run(NsTest.java:555)^M\r\nSun Oct 09 21:04:51 PDT 2011 Thread[Thread 2,5,main] (XID = 138763), (SESSIONID = 20), (DATABASE = nstestdb), (DRDAID = null), Clean\r\nup action starting^M\r\nSun Oct 09 21:04:51 PDT 2011 Thread[Thread 2,5,main] (XID = 138763), (SESSIONID = 20), (DATABASE = nstestdb), (DRDAID = null), Faile\r\nd Statement is: select max(serialkey) from nstesttab where serialkey > ? with 1 parameters begin parameter #1: 6002 :end parameter ^\r\nM","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-10-10T16:49:29.357+0000","updated":"2011-10-10T16:49:29.357+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13124316","id":"13124316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I seem to have lost my ability to reproduce the deadlocks. I have run NsTest 5 times against 10.8.2.1 insane jars without being able to pop the problem (each attempt lasted at least 10 minutes).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-10T17:23:02.390+0000","updated":"2011-10-10T17:23:02.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13124361","id":"13124361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I was able to pop a deadlock (but not the identity-generator deadlock) running NsTest against the 10.8.2.1 sane jars. I had to run the test 5 times (10 minutes per run) to pop this error. I don't believe that my experiments on 2011-10-07 demonstrate that the deadlocks are NOT present in 10.8.1.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-10T18:23:48.849+0000","updated":"2011-10-10T18:23:48.849+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13124392","id":"13124392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I too did see the select max(serialkey) deadlocks on one system - but only with insane jars (on the machine where I usually run insane jars/nstest Embedded during release QA cycles). \r\n\r\nIt appears to me that these deadlocks are different from what's described in DERBY-5430.\r\nAs such, I think we should log a separate issue for this, and move the discussion there.\r\n\r\nI think this issue can now be closed, as the backport was completed.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-10-10T18:51:47.169+0000","updated":"2011-10-10T18:51:47.169+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12526066/comment/13124401","id":"13124401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I agree that there are two different deadlocks:\r\n\r\n1) A deadlock involving locks on a user table and seen with the \"select max(serialkey)\" query.\r\n\r\n2) A deadlock involving locks on a SYSCOLUMNS row and seen with the \"insert into nstesttab\" statement.\r\n\r\n(1) may be a bug in NsTest and I agree that it deserves its own JIRA.. Note that I have seen both deadlocks on the 10.8 branch after backing out the DERBY-4437 work. (2) is still a problem in the 10.8 branch. I have no problem with closing this issue as long as DERBY-5430 remains open. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-10-10T19:09:42.679+0000","updated":"2011-10-10T19:09:42.679+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5448/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06hzr:"}}