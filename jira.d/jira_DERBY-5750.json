{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12554424","self":"https://issues.apache.org/jira/rest/api/latest/issue/12554424","key":"DERBY-5750","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323475","id":"12323475","description":"Head of 10.8 branch starting 2014-01-13","name":"10.8.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323562","id":"12323562","description":"Head of 10.9 branch after releasing 10.9.1.0","name":"10.9.2.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2012-06-20 12:37:37.334","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"238666","customfield_12310222":"1_*:*_1_*:*_4750956237_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-07-03T03:39:18.999+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5750/watchers","watchCount":3,"isWatching":false},"created":"2012-05-09T03:56:42.951+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-09-03T08:31:41.887+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"When empty string is passed for the index name to the update statistics procedure, it throws following exception(passing an empty string for table to compress table procedure also gives simiar exception). The new stored procedure being created through DERBY-4115 for dropping the statistics also gave similar exception\r\n\r\n\r\njava -Dij.exceptionTrace=true org.apache.derby.tools.ij\r\nconnect 'jdbc:derby:db1;create=true'; \r\ncreate table t1(c11 int, statistics int not null);\r\ncall syscs_util.SYSCS_UPDATE_STATISTICS( 'APP', 'T1', '' );\r\nERROR 38000: The exception 'java.sql.SQLException: Syntax error: Encountered \"\\\"\" at line 1, column 42.' was thrown while evaluating an expression.\r\njava.sql.SQLException: The exception 'java.sql.SQLException: Syntax error: Encountered \"\\\"\" at line 1, column 42.' was thrown while evaluating an expression.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)\r\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\r\n        at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:278)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:431)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2360)\r\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1334)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:630)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:559)\r\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:367)\r\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:527)\r\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:369)\r\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:245)\r\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:229)\r\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184)\r\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)\r\n        at org.apache.derby.tools.ij.main(ij.java:59)\r\nCaused by: java.sql.SQLException: The exception 'java.sql.SQLException: Syntax error: Encountered \"\\\"\" at line 1, column 42.' was thrown while evaluating an expression.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\r\n        ... 17 more\r\nCaused by: java.sql.SQLException: Syntax error: Encountered \"\\\"\" at line 1, column 42.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\r\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:424)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2360)\r\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.<init>(EmbedPreparedStatement.java:153)\r\n        at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:107)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1685)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1513)\r\n        at org.apache.derby.catalog.SystemProcedures.SYSCS_UPDATE_STATISTICS(SystemProcedures.java:753)\r\n        at org.apache.derby.exe.acace4c0a3x0137x2f19xcc22x00000013e5704.g0(Unknown Source)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)\r\n        at java.lang.reflect.Method.invoke(Method.java:611)\r\n        at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46)\r\n        at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:75)\r\n        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:443)\r\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:324)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)\r\n        ... 10 more\r\nCaused by: ERROR 42X01: Syntax error: Encountered \"\\\"\" at line 1, column 42.\r\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:278)\r\n        at org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(ParserImpl.java:153)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:357)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:99)\r\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:1103)\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.<init>(EmbedPreparedStatement.java:134)\r\n        ... 24 more\r\nERROR 42X01: Syntax error: Encountered \"\\\"\" at line 1, column 42.\r\njava.sql.SQLSyntaxErrorException: Syntax error: Encountered \"\\\"\" at line 1, column 42.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:92)\r\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:424)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:353)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2360)\r\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.<init>(EmbedPreparedStatement.java:153)\r\n        at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:107)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1685)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:1513)\r\n        at org.apache.derby.catalog.SystemProcedures.SYSCS_UPDATE_STATISTICS(SystemProcedures.java:753)\r\n        at org.apache.derby.exe.acace4c0a3x0137x2f19xcc22x00000013e5704.g0(Unknown Source)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:60)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:37)\r\n        at java.lang.reflect.Method.invoke(Method.java:611)\r\n        at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46)\r\n        at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:75)\r\n        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:443)\r\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:324)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:630)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:559)\r\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:367)\r\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:527)\r\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:369)\r\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:245)\r\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:229)\r\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:184)\r\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:75)\r\n        at org.apache.derby.tools.ij.main(ij.java:59)\r\nCaused by: java.sql.SQLException: Syntax error: Encountered \"\\\"\" at line 1, column 42.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:42)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\r\n        ... 30 more\r\nCaused by: ERROR 42X01: Syntax error: Encountered \"\\\"\" at line 1, column 42.\r\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:278)\r\n        at org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(ParserImpl.java:153)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:357)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:99)\r\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:1103)\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.<init>(EmbedPreparedStatement.java:134)\r\n        ... 24 more\r\nIssue the 'help' command for general information on IJ command syntax.\r\nAny unrecognized commands are treated as potential SQL commands and executed directly.\r\nConsult your DBMS server reference documentation for details of the SQL syntax supported by your server.\r\nij>\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35638","summary":"Sending an empty string as table name to compress table procedure or empty string as index name to update statistics procedure makes the parser throw an exception.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":11,"total":11,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13396053","id":"13396053","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Attaching a patch which will have no table name information to compress table/drop statistics/update statistics procedures result in the same exception that a user would get when issuing the compress table sql directly without the table name\r\neg alter table compress sequential\r\nNotice that the table name is missing in the compress sql above\r\n\r\n\r\nI have added few test cases for each of these procedures.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-06-18T17:33:47.748+0000","updated":"2012-06-18T17:33:47.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13397463","id":"13397463","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The String.isEmpty() method was introduced in Java 6, so the patch won't compile in my environment:\r\n\r\ncompile_catalog:\r\n    [javac] Compiling 1 source file to /code/derby/trunk/classes\r\n    [javac] /code/derby/trunk/java/engine/org/apache/derby/catalog/SystemProcedures.java:747: error: cannot find symbol\r\n    [javac]         if (!StringUtil.trimTrailing(schemaname).isEmpty())\r\n    [javac]                                                 ^\r\n    [javac]   symbol:   method isEmpty()\r\n    [javac]   location: class String\r\n    [javac] /code/derby/trunk/java/engine/org/apache/derby/catalog/SystemProcedures.java:750: error: cannot find symbol\r\n    [javac]         if (!StringUtil.trimTrailing(tablename).isEmpty())\r\n    [javac]                                                ^\r\n    [javac]   symbol:   method isEmpty()\r\n    [javac]   location: class String\r\n(...)\r\n    [javac] 8 errors\r\n\r\nBUILD FAILED\r\n/code/derby/trunk/build.xml:603: The following error occurred while executing this line:\r\n/code/derby/trunk/java/engine/build.xml:67: The following error occurred while executing this line:\r\n/code/derby/trunk/java/engine/org/apache/derby/catalog/build.xml:51: Compile failed; see the compiler error output for details.\r\n\r\nI couldn't test the patch because of this, but this check looks wrong to me:\r\n\r\n+        if (!StringUtil.trimTrailing(schemaname).isEmpty())\r\n+        \tquery.append(IdUtil.normalToDelimited(schemaname) + \".\");\r\n\r\nI think the intention here is to check if the schema name is empty, whereas it actually checks if it's free for non-whitespace characters. So I suspect statements like these might stop working:\r\n\r\nij> create table \"   \".\"   \" (x int);\r\n0 rows inserted/updated/deleted\r\nij> call syscs_util.syscs_compress_table('   ', '   ', 1);\r\n0 rows inserted/updated/deleted\r\n\r\nAlso, I think skipping the schema name in the internal ALTER TABLE statement if it's empty, will make the following statement compress the table T2 in the current schema instead of failing, which I believe is not the intention of the patch:\r\n\r\n    call syscs_util.syscs_compress_table('', 'T2', 1)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-06-20T12:37:37.334+0000","updated":"2012-06-20T12:37:37.334+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13399026","id":"13399026","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Knut, thanks for reviewing the patch. Thanks for catching the isEmpty() usage. I have changed that in my codeline to instead use length() to determine if we are dealing with empty name.\r\n\r\nAs for schema name, I did intentionally make the change to use the current schema, but we can determine if that is the right thing to do or not. While going through existing procedures, I have found that we have 2 flavors of procedures when it comes to dealing with empty or null schema name.\r\n\r\nFor instance, when '' is passed for the schema name, SYSCS_UTIL.SYSCS_EXPORT_TABLE uses curent schema, syscs_util.SYSCS_INPLACE_COMPRESS_TABLE gives error schema '' does not exist. Top of the trunk(without my changes in the patch attached here) syscs_util.SYSCS_UPDATE_STATISTICS gives parser error(because we pass the schema name as '').  \r\n-- uses current schema\r\ncall SYSCS_UTIL.SYSCS_EXPORT_TABLE ('', 'T1' , 't11.del' , null, null, null);\r\n-- gives parser error - Caused by: java.sql.SQLException: Syntax error: Encountered \"\\\"\" at line 1, column 13.\r\ncall syscs_util.SYSCS_UPDATE_STATISTICS( '', 'T1', '' ); \r\n-- Caused by: ERROR 42Y07: Schema '' does not exist\r\ncall syscs_util.SYSCS_INPLACE_COMPRESS_TABLE( '', 'T1', 1,1,1 ); \r\n\r\nWhen null is passed for the schema name, SYSCS_UTIL.SYSCS_EXPORT_TABLE uses curent schema, syscs_util.SYSCS_INPLACE_COMPRESS_TABLE gives error schema null doesn't exist, and top of the trunk, syscs_util.SYSCS_UPDATE_STATISTICS gives null pointer exception\r\n-- uses current schema\r\ncall SYSCS_UTIL.SYSCS_EXPORT_TABLE (null, 'T1' , 't111.del' , null, null, null);\r\n-- gives null pointer exception\r\ncall syscs_util.SYSCS_UPDATE_STATISTICS( null, 'T1', '' ); \r\n-- schema null doesn't exist - Caused by: ERROR 42Y07: Schema 'null' does not exist\r\ncall syscs_util.SYSCS_INPLACE_COMPRESS_TABLE( null, 'T1', 1,1,1 ); \r\n\r\nSo, we can have either of the two behaviors for SYSCS_UTIL.SYSCS_EXPORT_TABLE and '' or null for schema name \r\n1)Use current schema or\r\n2)Give parsing error (we internally generate ALTER TABLE sql here and parser will throw error before ALTER TABLE can throw exception for invalid schema name)\r\n\r\nNo matter what we decide, we definitely need to take care of null pointer exception when null is passed for schema name.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-06-22T00:27:32.617+0000","updated":"2012-06-22T00:27:32.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13399258","id":"13399258","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I'd prefer some kind of error if an empty name is specified, since one way to specify current schema (NULL) is enough. Although a parse error isn't very helpful, I agree. The proposed patch introduces checks for empty names and changes the internal SQL based on that check. Couldn't these checks be changed to raise an error with a proper error message instead? I see that empty table names still cause parse errors with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-06-22T10:58:43.885+0000","updated":"2012-06-22T10:58:43.885+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13400955","id":"13400955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Attaching patch#2 (DERBY5750_patch2_diff.txt). This patch will provide following functionality \r\na)if schema name is provided as an empty string, we will throw SQLState.LANG_SCHEMA_DOES_NOT_EXIST\r\nb)if table name is provided as an empty string, we will throw SQLState.LANG_TABLE_NOT_FOUND\r\nc)if schema name is null, we will use current schema to resolve the table name\r\nd)if table name is null, we will throw SQLState.LANG_TABLE_NOT_FOUND\r\n\r\nI have added few test cases for each of these procedures. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-06-25T22:06:30.175+0000","updated":"2012-06-25T22:06:30.175+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13401351","id":"13401351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Empty index name seems to be translated to all indexes in the latest patch. I think I'd prefer to keep it consistent with table and schema name and raise an error in that case too.\r\n\r\nSome small nits:\r\n\r\n- indentation seems to be a mix of tabs and spaces\r\n\r\n- method name \"basic_schema_table_validation\" should be camel-cased for consistency\r\n\r\n- javadoc for basic_schema_table_validation() has empty descriptions in @param and @throws\r\n\r\n- maybe use curly braces in the if/else statements for clarity\r\n\r\n- typos in comments (UpdateStatisticsTest.java): indedx, stiatistics\r\n\r\n- use of IdUtil.mkQualifiedName() would allow simplification of basic_schema_table_validation() (could eliminate the StringBuffer, the second \"if\" statement and the \"else\" branch of the last \"if\" statement)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-06-26T12:38:53.441+0000","updated":"2012-06-26T12:38:53.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13404176","id":"13404176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Knut, I just committed a patch for this jira after taking care of of your comments.\r\n\r\nThe commit comments are as follows\r\n*********************************\r\nDERBY-5750 Sending an empty string as table name to compress table procedure or empty string as index name to update statistics procedure makes the parser throw an exception. \r\n\r\nCommitting changes for DERBY-5750 which will provide following functionality \r\na)if schema name is provided as an empty string, we will throw SQLState.LANG_SCHEMA_DOES_NOT_EXIST\r\nb)if table name is provided as an empty string, we will throw SQLState.LANG_TABLE_NOT_FOUND\r\nc)if index name is provided as an empty string(this is for update and drop statistics procedures), we will throw \r\n\tSQLState.LANG_INDEX_NOT_FOUND\r\nd)if schema name is null, we will use current schema to resolve the table name\r\ne)if table name is null, we will throw SQLState.LANG_TABLE_NOT_FOUND\r\nf)if index name is null, we will drop/update statisitcs for all the indexes for the given table.\r\n\r\nI have added few test cases for each of these procedures. \r\n*********************************\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-06-29T20:26:03.770+0000","updated":"2012-06-29T20:26:03.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13723269","id":"13723269","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I am working on backporting this jira to 10.9 and 10.8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-07-30T02:01:29.154+0000","updated":"2013-08-02T19:08:50.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13723271","id":"13723271","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1508273 from [~mamtas] in branch 'code/branches/10.9'\r\n[ https://svn.apache.org/r1508273 ]\r\n\r\nDERBY-5750(Sending an empty string as table name to compress table procedure or empty string as index name to update statistics procedure makes the parser throw an exception.)\r\n\r\nBackporting to 10.9","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-30T02:03:34.467+0000","updated":"2013-07-30T02:03:34.467+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/13727964","id":"13727964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1509814 from [~mamtas] in branch 'code/branches/10.8'\r\n[ https://svn.apache.org/r1509814 ]\r\n\r\nDERBY-5750(Sending an empty string as table name to compress table procedure or empty string as index name to update statistics procedure makes the parser throw an exception.)\r\n\r\nBackporting to 10.8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-08-02T19:03:47.597+0000","updated":"2013-08-02T19:03:47.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12554424/comment/14119630","id":"14119630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-09-03T08:31:41.882+0000","updated":"2014-09-03T08:31:41.882+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5750/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06gov:"}}