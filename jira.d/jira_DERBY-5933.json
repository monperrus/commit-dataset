{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12608438","self":"https://issues.apache.org/jira/rest/api/latest/issue/12608438","key":"DERBY-5933","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323475","id":"12323475","description":"Head of 10.8 branch starting 2014-01-13","name":"10.8.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323562","id":"12323562","description":"Head of 10.9 branch after releasing 10.9.1.0","name":"10.9.2.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2012-09-20 14:31:20.211","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"240662","customfield_12310222":"1_*:*_1_*:*_11830161549_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-02-04T10:39:16.462+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5933/watchers","watchCount":7,"isWatching":false},"created":"2012-09-20T12:29:55.045+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_triage10_10"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10991","id":"10991","description":"snapshot","name":"10.0.2.1","archived":false,"released":true,"releaseDate":"2004-12-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12358185","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358185","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12366604","key":"DERBY-2526","self":"https://issues.apache.org/jira/rest/api/2/issue/12366604","fields":{"summary":"Wrong results with queries that use the JOIN ... ON syntax to join with views or other non-base table expressions.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12358183","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358183","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12376689","key":"DERBY-3023","self":"https://issues.apache.org/jira/rest/api/2/issue/12376689","fields":{"summary":"Different result rows depending on the sequence of INNER JOIN and OUTER JOIN","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12358184","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358184","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12465506","key":"DERBY-4679","self":"https://issues.apache.org/jira/rest/api/2/issue/12465506","fields":{"summary":"Several left outer joins causes unstable query with incorrect results","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12373395","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12373395","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12656863","key":"DERBY-6289","self":"https://issues.apache.org/jira/rest/api/2/issue/12656863","fields":{"summary":"Derby 10.8 backport issue (summer 2013)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12358182","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358182","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12466382","key":"DERBY-4695","self":"https://issues.apache.org/jira/rest/api/2/issue/12466382","fields":{"summary":"Internal assignment of tablenumer, columnnumber looks wrong in query tree, although no ill effects are seen.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-09-03T08:31:32.047+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"Hello \r\nI have a simple database with 100 records.\r\nI am running a SQL query from Netbeans GUI though JDBC\r\n\r\nThis query was generated by Hibernate ORM.\r\n\r\nIn certain circumstances the result rowset is not sorting.\r\n\r\nWhen I use  condition morefld2_.mf_id in (5) the result is unsortable.\r\nWhen I use  condition morefld2_.mf_id in (5,0) the result is sorting properly.\r\n    \r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10366","value":"Wrong query result","id":"10366"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"4477","summary":"SQL sorting error","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vigor","name":"vigor","emailAddress":"vigor78 at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlasov Igor","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vigor","name":"vigor","emailAddress":"vigor78 at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlasov Igor","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Windows 7 Netbeans JDBC GUI","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":27,"total":27,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13459559","id":"13459559","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vigor","name":"vigor","emailAddress":"vigor78 at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlasov Igor","active":true},"body":"The query is \r\n\r\n    select\r\n        projecttas0_.t_id as t1_4_0_,\r\n        project1_.p_id as p1_3_1_,\r\n        morefld2_.mf_id as mf1_2_2_,\r\n        user3_.usr_id as usr1_9_3_,\r\n        morefld4_.mf_id as mf1_2_4_,\r\n        projecttas0_.t_content as t2_4_0_,\r\n        projecttas0_.t_deadline as t3_4_0_,\r\n        projecttas0_.t_hours as t4_4_0_,\r\n        projecttas0_.mf_level as mf9_4_0_,\r\n        projecttas0_.sys_usr as sys10_4_0_,\r\n        projecttas0_.sys_cre as sys5_4_0_,\r\n        projecttas0_.sys_end as sys6_4_0_,\r\n        projecttas0_.sys_upd as sys7_4_0_,\r\n        projecttas0_.owner_id as owner11_4_0_,\r\n        projecttas0_.p_id as p12_4_0_,\r\n        projecttas0_.t_start as t8_4_0_,\r\n        projecttas0_.mf_status as mf13_4_0_,\r\n        projecttas0_.worker_id as worker14_4_0_,\r\n        project1_.mf_level as mf7_3_1_,\r\n        project1_.p_name as p2_3_1_,\r\n        project1_.sys_usr as sys8_3_1_,\r\n        project1_.sys_cre as sys3_3_1_,\r\n        project1_.sys_end as sys4_3_1_,\r\n        project1_.sys_upd as sys5_3_1_,\r\n        project1_.p_start as p6_3_1_,\r\n        morefld2_.dm_id as dm8_2_2_,\r\n        morefld2_.mf_key as mf2_2_2_,\r\n        morefld2_.mf_name as mf3_2_2_,\r\n        morefld2_.sys_usr as sys9_2_2_,\r\n        morefld2_.sys_cre as sys4_2_2_,\r\n        morefld2_.sys_end as sys5_2_2_,\r\n        morefld2_.sys_upd as sys6_2_2_,\r\n        morefld2_.mf_order as mf7_2_2_,\r\n        user3_.usr_blocked as usr2_9_3_,\r\n        user3_.usr_email as usr3_9_3_,\r\n        user3_.usr_fio as usr4_9_3_,\r\n        user3_.if_user as if5_9_3_,\r\n        user3_.last_login as last6_9_3_,\r\n        user3_.usr_login as usr7_9_3_,\r\n        user3_.sys_usr as sys14_9_3_,\r\n        user3_.sys_cre as sys8_9_3_,\r\n        user3_.sys_end as sys9_9_3_,\r\n        user3_.sys_upd as sys10_9_3_,\r\n        user3_.usr_password as usr11_9_3_,\r\n        user3_.usr_rme_code as usr12_9_3_,\r\n        user3_.usr_emailsend as usr13_9_3_,\r\n        user3_.usr_type as usr15_9_3_,\r\n        morefld4_.dm_id as dm8_2_4_,\r\n        morefld4_.mf_key as mf2_2_4_,\r\n        morefld4_.mf_name as mf3_2_4_,\r\n        morefld4_.sys_usr as sys9_2_4_,\r\n        morefld4_.sys_cre as sys4_2_4_,\r\n        morefld4_.sys_end as sys5_2_4_,\r\n        morefld4_.sys_upd as sys6_2_4_,\r\n        morefld4_.mf_order as mf7_2_4_ \r\n    from\r\n        project_task projecttas0_ \r\n    inner join\r\n        project project1_ \r\n            on projecttas0_.p_id=project1_.p_id \r\n    inner join\r\n        morefld morefld2_ \r\n            on projecttas0_.mf_status=morefld2_.mf_id \r\n    left outer join\r\n        user_ user3_ \r\n            on projecttas0_.worker_id=user3_.usr_id \r\n    inner join\r\n        morefld morefld4_ \r\n            on projecttas0_.mf_level=morefld4_.mf_id \r\n    where\r\n        1=1 \r\n        and (\r\n            projecttas0_.sys_end is null\r\n        ) \r\n        and (\r\n            morefld2_.mf_id in (\r\n                5\r\n            )\r\n        ) \r\n    order by\r\n        projecttas0_.t_id desc fetch first 30 rows only\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vigor","name":"vigor","emailAddress":"vigor78 at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlasov Igor","active":true},"created":"2012-09-20T12:32:34.447+0000","updated":"2012-09-20T12:32:34.447+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13459624","id":"13459624","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"If you could post the schema for the tables involved in the query, including indexes and constraints defined on those tables, it might help others reproduce the problem. For example you could post the output from running the dblook tool on the database. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-09-20T14:31:20.211+0000","updated":"2012-09-20T14:31:20.211+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13459716","id":"13459716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"It would also be good to do a consistency check on the database  to make sure there is not a problem with an index.  http://wiki.apache.org/db-derby/DatabaseConsistencyCheck and even attach the zipped database if he data is not confidential and  the database is small.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-09-20T16:31:05.811+0000","updated":"2012-09-20T16:31:05.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13460288","id":"13460288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vigor","name":"vigor","emailAddress":"vigor78 at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlasov Igor","active":true},"body":"sample database","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vigor","name":"vigor","emailAddress":"vigor78 at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vlasov Igor","active":true},"created":"2012-09-21T06:53:38.907+0000","updated":"2012-09-21T06:53:38.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13460535","id":"13460535","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks, Igor. I can reproduce the incorrect ordering on trunk. (I had to disable Derby's authentication checks to try the database, since it is password protected.)\r\n\r\nThe consistency checker didn't find any problems with the database.\r\n\r\nThe incorrect ordering is also seen in this simpler query:\r\n\r\nselect\r\n        projecttas0_.t_id\r\n    from\r\n        project_task projecttas0_\r\n    inner join\r\n        morefld morefld2_\r\n            on projecttas0_.mf_status=morefld2_.mf_id\r\n    left outer join\r\n        user_ user3_\r\n            on projecttas0_.worker_id=user3_.usr_id\r\n    inner join\r\n        morefld morefld4_\r\n            on projecttas0_.mf_level=morefld4_.mf_id\r\n    where\r\n            morefld2_.mf_id = 5\r\n    order by\r\n        projecttas0_.t_id desc;","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-09-21T14:51:38.162+0000","updated":"2012-09-21T14:51:38.162+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13461170","id":"13461170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching repro.sql, which is a standalone, stripped-down repro for the bug. Here is what I see when I run the script on trunk:\r\n\r\nij version 10.10\r\nij> connect 'jdbc:derby:memory:d5933;create=true';\r\nij> create table a (a1 int, a2 int, a3 int, a4 int);\r\n0 rows inserted/updated/deleted\r\nij> create table b (b1 int);\r\n0 rows inserted/updated/deleted\r\nij> create table c (c1 int);\r\n0 rows inserted/updated/deleted\r\nij> create table d (d1 int);\r\n0 rows inserted/updated/deleted\r\nij> insert into a values (1,2,1,2), (2,3,1,3), (1,4,1,4);\r\n3 rows inserted/updated/deleted\r\nij> insert into b values 1;\r\n1 row inserted/updated/deleted\r\nij> insert into d values 2,3,4;\r\n3 rows inserted/updated/deleted\r\nij> select a1\r\nfrom\r\n    a inner join b on a3 = b1\r\n      left outer join c on a4 = c1\r\n      inner join d on a2 = d1\r\nwhere b1 = 1\r\norder by a1;\r\nA1         \r\n-----------\r\n1          \r\n2          \r\n1          \r\n\r\n3 rows selected\r\n\r\nThe results come out unordered, even though there is an ORDER BY clause. The bug seems to go all the way back to 10.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-09-22T14:35:56.479+0000","updated":"2012-09-22T14:35:56.479+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13461188","id":"13461188","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think it must be related to the outer join. If you remove the outer join, \r\nthe optimizer tosses a SortResultSet as the top-most result set in the\r\nquery plan, giving the right results:\r\n\r\nselect a1\r\nfrom\r\n    a inner join b on a3 = b1\r\n      inner join d on a2 = d1\r\nwhere b1 = 1\r\norder by a1;\r\n        \r\nA1         \r\n-----------\r\n1          \r\n1          \r\n2          \r\n\r\n3 rows selected\r\n\r\nAnd if you populate table C with some matching values, and\r\nthen just change \"left outer\" to \"inner\" in the query, it again\r\ngives the correct results:\r\n\r\ninsert into c values (3), (4), (2);\r\nselect a1\r\nfrom\r\n    a inner join b on a3 = b1\r\n      inner join c on a4 = c1\r\n      inner join d on a2 = d1\r\nwhere b1 = 1\r\norder by a1;\r\n\r\nA1         \r\n-----------\r\n1          \r\n1          \r\n2          \r\n\r\n3 rows selected\r\n\r\nBut even with the data present in C, the OUTER JOIN query doesn't perform the sort.\r\n\r\nActually, if you run repro.sql with -Dderby.language.logQueryPlan=true, you can see\r\nthat if the OUTER JOIN is missing, the optimizer chooses a tree full of table scans,\r\nnested loop joins, and an outer-most SortResultSet at the end, while with the OUTER\r\nJOIN in place, the query plan is entirely comprised of HashJoin nodes.\r\n\r\nThat is, the two query plans are wildly different, just by changing \"left outer\" to \"inner\"\r\nin the query.\r\n\r\nNot sure if any of this helps, just wanted to share it.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2012-09-22T15:18:44.637+0000","updated":"2012-09-22T15:18:44.637+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13461790","id":"13461790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Another observation: The optimizer knows that the predicate B1=1 means that the results are always ordered on B1 (see FromTable.tellRowOrderingAboutConstantColumns()). Although this fact should have no significance for this query, whose results should be ordered on A1 and not on B1, disabling the optimization makes the rows come out in the correct order. This is consistent with Igor's observation that changing the predicate from IN (5) to IN (5,0) made the results ordered. So maybe the sort avoidance code is confusing the two columns for some reason.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-09-24T13:44:01.016+0000","updated":"2012-09-24T13:44:01.016+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13461806","id":"13461806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"> So maybe the sort avoidance code is confusing the two columns for some reason. \r\n\r\nIf so that wouldn't be the first bug in this area, sounds like a good candidate culprit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-09-24T14:02:30.145+0000","updated":"2012-09-24T14:02:30.145+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13461937","id":"13461937","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Enclosing dump of the compiler tree after parsing, binding and optimization, \"5933.log\". It shows that *both* B1 and A1 columns are labelled \r\n(4,1), i.e. tableNumber 4, columnNumber 1. In the debugger I see that the sort avoidance code checks and finds that (4,1) is indeed part of comparison with a constant. So, for some reason, the column reference for A1 here gets messed up.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-09-24T17:44:31.991+0000","updated":"2012-09-24T17:44:31.991+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13462068","id":"13462068","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Another data point: if I disable join flattening, the result is correct. I suspect the column reference remapping logic, e.g. used during \r\n\r\nPredicateList#remapColumnReferencesToExpressions\r\nJoinNode#flatten\r\nFromList#flattenTables\r\nSelectNode#preprocess\r\n\r\nis flawed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-09-24T20:09:44.907+0000","updated":"2012-09-24T20:09:44.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13462085","id":"13462085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I checked the resulting tree after the preprocess phase of optimization, and the column reference to A1 is indeed already labeled  (4,1). The enclosed log file shows this to be the case after end of the optimization phase. The problematic labelling happens during preprocess time, at which time the flattening occurs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-09-24T20:24:56.429+0000","updated":"2012-09-24T20:24:56.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13462151","id":"13462151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Looking again, I believe that A1 is correctly labelled (4,1). The column reference to \"B1\", however, should be (4,5), not (4,1), since B1 is the fifth column in the result set of the left outer join. So now we just need to find out why \"B1\" ends up with the wrong label after flattening.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-09-24T21:19:34.706+0000","updated":"2012-09-24T21:19:34.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13462203","id":"13462203","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading an experimental patch which makes the query work.\r\n\r\nI found that the wrong label to the column reference \"B1\" happened when that expression was pushed into the left outer join node at this stack position:\r\n\r\n.sql.compile.ResultColumn.getColumnPosition(ResultColumn.java:447)\r\n.sql.compile.ColumnReference.remapColumnReferences(ColumnReference.java:721)\r\n.sql.compile.RemapCRsVisitor.visit(RemapCRsVisitor.java:75)\r\n.sql.compile.QueryTreeNode.accept(QueryTreeNode.java:718)\r\n.sql.compile.BinaryOperatorNode.acceptChildren(BinaryOperatorNode.java:812)\r\n.sql.compile.QueryTreeNode.accept(QueryTreeNode.java:721)\r\n.sql.compile.BinaryOperatorNode.acceptChildren(BinaryOperatorNode.java:812)\r\n.sql.compile.QueryTreeNode.accept(QueryTreeNode.java:721)\r\n.sql.compile.PredicateList.getPushablePredicates(PredicateList.java:1780)\r\n.sql.compile.ProjectRestrictNode.pushExpressions(ProjectRestrictNode.java:1095)\r\n.sql.compile.FromList.pushPredicates(FromList.java:846)\r\n.sql.compile.SelectNode.preprocess(SelectNode.java:1238)\r\n...\r\n\r\nThe code in ResultColumn#getColumnPosition looks like this:\r\n\r\n\tpublic int getColumnPosition()\r\n\t{\r\n\t\tif (columnDescriptor!=null)\r\n\t\t\treturn columnDescriptor.getPosition();\r\n\t\telse\r\n\t\t\treturn virtualColumnId;\r\n\r\n\t}\r\n\r\nIn this case, there is a columnDescriptor present in the RC (maybe because it is also used in the join condition?), but that refers the the base table \"B\", in which \"B1\" has column position 1. However, here we are trying to push into the LOJ, in which the real position is 5, the value of virtualColumnId. So, the patch just uses virtualColumnId iff we are sitting on top of a join.\r\n\r\nI tried the patch briefly and it worked for the join and predicate pushdown tests, but I am still very wary of this hack, but I post it now anyway ;-). Running regressions to see what happens.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-09-24T22:28:32.007+0000","updated":"2012-09-24T22:33:22.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13462706","id":"13462706","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Good detective work, Dag!\r\n\r\nI noticed that ColumnReference.remapColumnReferencesToExpressions() had a fix for DERBY-3023 which made it use getVirtualColumnId() instead of getColumnPosition() if the source of the result column was a VirtualColumnNode. remapColumnReferences() does not have this fix.\r\n\r\nAdding a similar fix to remapColumnReferences() (see the attached d5933-remap.diff) also makes the results come out in the right order. It does essentially the same thing as the poc patch, only that it narrows down the change to only affect remapping.\r\n\r\nAll the regression tests ran cleanly with the remap patch, FWIW.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-09-25T12:44:14.065+0000","updated":"2012-09-25T12:44:14.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13462741","id":"13462741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks for the pointer to DERBY-3023. It was very helpful to re-read Army's \r\ncomments in that issue, and in the older DERBY-2526. Thank goodness for\r\n6 years of accumulated JIRA discussions to refer back to!\r\n\r\nI do wonder if, in some future patch, the logic contained in d5933-remap.diff could be\r\nsomehow moved down into the ResultColumn class itself, rather than being\r\nin its caller.\r\n\r\nBut this is incredibly delicate code and I'm not advocating to expand the\r\nscope of this issue. +1 to the approach outlined in d5933-remap.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2012-09-25T13:52:35.376+0000","updated":"2012-09-25T13:52:35.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13462889","id":"13462889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I agree it would be nice to move this logic down, but narrowing the impact as Knut's version does is probably safer.\r\nAttaching a new version which includes a test case: JoinTest#5933.\r\n\r\nNote the related issues concerning the brittleness of the column renumbering: DERBY-4679 and DERBY-4695.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-09-25T15:44:21.409+0000","updated":"2012-09-25T15:44:21.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13463139","id":"13463139","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The remap+test patch looks good to me. Thanks for explaining the cause of the bug so clearly in the test comment. +1 to commit.\r\n\r\nAs to pushing the logic down, I agree that that would be cleaner. However, it looks like there are parts of the code that expect the current behaviour of ResultColumn.getColumnPosition(). At least, I ran into trouble with some other statements when I attempted to push down the logic without the extra check for JoinNode that Dag put in the poc patch (I suspect that the JoinNode check was what made Dag call that patch a hack in the first place). So in that case I think we should create a new method rather than changing the existing one. And try to explain clearly when to use which method to retrieve the column number/position.\r\n\r\nMy main problem with this code is that I don't fully understand the invariants. My first thought was that (columnDescriptor == null) == (expression instanceof VirtualColumnNode) was one, but apparently not. And that makes it more difficult to understand when to use virtualColumnId and when to use columnDescriptor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-09-25T19:30:18.362+0000","updated":"2012-09-25T19:30:18.362+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13463312","id":"13463312","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for looking at the test and the further comments, Knut. You are right, the extra test for JoinNode made the fix so ugly I called it a hack ;-)\r\nI have the same problem with the code as you do as far as understanding the conditions under which the VCN has a columnDescriptor.\r\nI'll see if i can run some tracing over the set of regressions tests to see if I can understand it a little better.\r\n\r\nCommitted the patch d5933-remap+test as svn 1390205.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-09-25T22:57:07.608+0000","updated":"2012-09-25T22:57:07.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13463356","id":"13463356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Yes, the comment in the test code is very readable and helpful, and the\r\nreferences to the associated JIRAs are quite useful. Thanks for taking\r\nthe time to include that information, Dag!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2012-09-25T23:42:23.240+0000","updated":"2012-09-25T23:42:23.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13468811","id":"13468811","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Is there more work to do on this issue or is fixed?  It would be great to get the fix into 10.8.3.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-10-03T20:38:34.925+0000","updated":"2012-10-03T20:38:34.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13570103","id":"13570103","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I ran some trace on the lang suite, and it's pretty common that VCN nodes have a non-null columnDescriptor, so I don't understand the invariant either, Knut. I'll resolve this issue for now, though, since the fix went in some months ago and we haven't seen issues with it AFAIK.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-02-04T10:38:45.070+0000","updated":"2013-02-04T10:38:45.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13570106","id":"13570106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Igor, feel free to close the issue if you believe it's been sufficiently addressed. If you can build a Derby version from subversion trunk and test your case with it, that would be optimal. Thanks for uncovering this bug!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-02-04T10:54:52.974+0000","updated":"2013-02-04T10:54:52.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13729035","id":"13729035","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Assign to myself for backport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-08-05T00:26:41.435+0000","updated":"2013-08-05T00:26:41.435+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13729449","id":"13729449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1510445 from [~kmarsden] in branch 'code/branches/10.9'\r\n[ https://svn.apache.org/r1510445 ]\r\n\r\nDERBY-5933 SQL sorting error\r\nmerge from trunk revision 1510360\r\nContributed by Dag H.Wanvik","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-08-05T12:16:23.596+0000","updated":"2013-08-05T12:16:23.596+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/13729473","id":"13729473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1510456 from [~kmarsden] in branch 'code/branches/10.8'\r\n[ https://svn.apache.org/r1510456 ]\r\n\r\nDERBY-5933 SQL sorting error\r\nmerge from trunk revision 1510360\r\nContributed by Dag H.Wanvik","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-08-05T12:43:34.700+0000","updated":"2013-08-05T12:43:34.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12608438/comment/14119587","id":"14119587","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-09-03T08:31:32.034+0000","updated":"2014-09-03T08:31:32.034+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5933/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i014db:"}}