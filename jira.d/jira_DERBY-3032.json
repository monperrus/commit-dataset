{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12377113","self":"https://issues.apache.org/jira/rest/api/latest/issue/12377113","key":"DERBY-3032","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-08-30 20:20:56.757","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23386","customfield_12310222":"1_*:*_1_*:*_531952206_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_13680","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-09-04T22:12:24.745+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3032/watchers","watchCount":0,"isWatching":false},"created":"2007-08-29T18:26:32.539+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12317366","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12317366","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12375181","key":"DERBY-2986","self":"https://issues.apache.org/jira/rest/api/2/issue/12375181","fields":{"summary":"Query involving CASE statement significantly slower in 10.3.1.4 than in 10.2.2.0","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-30T15:55:44.860+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"The following query returning NULL date from a case statement in a subquery causees a ClassCastException in 10.3.\nThe query works fine in 10.2\n\nij> create table t (d date, vc varchar(30));\n0 rows inserted/updated/deleted\nij> insert into t values(CURRENT_DATE, 'hello');\n1 row inserted/updated/deleted\nij> SELECT d from t where d = (SELECT CASE WHEN 1 = 1 THEN CURRENT_DATE ELSE NULL END from t);\nD\n----------\n2007-08-28\n\n1 row selected\nij> SELECT d from t where d = (SELECT CASE WHEN 1 = 0 THEN CURRENT_DATE  ELSE NULL END from t);\nD\n----------\nERROR 38000: The exception 'java.lang.ClassCastException: org.apache.derby.iapi.types.SQLChar incompatible with org.apac\nhe.derby.iapi.types.DateTimeDataValue' was thrown while evaluating an expression.\njava.sql.SQLException: The exception 'java.lang.ClassCastException: org.apache.derby.iapi.types.SQLChar incompatible wit\nh org.apache.derby.iapi.types.DateTimeDataValue' was thrown while evaluating an expression.\n       at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\n       at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88)\n       at org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:224)\n       at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398)\n       at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\n       at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1572)\n       at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\n       at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4323)\n       at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:464)\n       at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:368)\n       at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:382)\n       at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:338)\n       at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:241)\n       at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:229)\n       at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:449)\n       at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:523)\n       at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:364)\n       at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:262)\n       at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\n       at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\n       at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56)\n       at org.apache.derby.tools.ij.main(ij.java:71)\nCaused by: java.sql.SQLException: Java exception: 'org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derb\ny.iapi.types.DateTimeDataValue: java.lang.ClassCastException'.\n       at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\n       at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88)\n       at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245)\n       at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\n       ... 19 more\nCaused by: java.lang.ClassCastException: org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.typ\nes.DateTimeDataValue\n       at org.apache.derby.exe.ac12564092x0114xaec2x9627x0000002183d82.g0(Unknown Source)\n       at org.apache.derby.exe.ac12564092x0114xaec2x9627x0000002183d82.e1(Unknown Source)\n       at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:141)\n       at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:267)\n       at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:468)\n       at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:424)\n       ... 13 more\nERROR XJ001: Java exception: 'org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.types.DateTime\nDataValue: java.lang.ClassCastException'.\njava.sql.SQLException: Java exception: 'org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.type\ns.DateTimeDataValue: java.lang.ClassCastException'.\n       at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\n       at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88)\n       at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245)\n       at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\n       at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398)\n       at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\n       at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1572)\n       at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\n       at org.apache.derby.impl.jdbc.EmbedResultSet.closeOnTransactionError(EmbedResultSet.java:4323)\n       at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:464)\n       at org.apache.derby.impl.jdbc.EmbedResultSet.next(EmbedResultSet.java:368)\n       at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:382)\n       at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:338)\n       at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:241)\n       at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:229)\n       at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:449)\n       at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:523)\n       at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:364)\n       at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:262)\n       at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\n       at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\n       at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56)\n       at org.apache.derby.tools.ij.main(ij.java:71)\nCaused by: java.lang.ClassCastException: org.apache.derby.iapi.types.SQLChar incompatible with org.apache.derby.iapi.typ\nes.DateTimeDataValue\n       at org.apache.derby.exe.ac12564092x0114xaec2x9627x0000002183d82.g0(Unknown Source)\n       at org.apache.derby.exe.ac12564092x0114xaec2x9627x0000002183d82.e1(Unknown Source)\n       at org.apache.derby.impl.services.reflect.DirectCall.invoke(ReflectGeneratedClass.java:141)\n       at org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.getNextRowCore(ProjectRestrictResultSet.java:267)\n       at org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(BasicNoPutResultSetImpl.java:468)\n       at org.apache.derby.impl.jdbc.EmbedResultSet.movePosition(EmbedResultSet.java:424)\n       ... 13 more\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38827","summary":"java.lang.ClassCastException returning null from a case statement  in subquery","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12377113/comment/12523883","id":"12523883","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"This issue was caused by svn 566217, the checkin for DERBY-2986\r\nT\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-08-30T17:02:15.434+0000","updated":"2007-08-30T17:02:15.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12377113/comment/12523923","id":"12523923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"\r\nThe change comments for DERBY-2986 say:\r\n\t\t/* Following call to \"findType()\" will indirectly bind the\r\n\t\t\t * expressions in the thenElseList, so no need to call\r\n\t\t\t * \"thenElseList.bindExpression(...)\" after we do this.\r\n\t\t\t * DERBY-2986.\r\n\t\t\t */\r\n\r\nThe javadoc for findtype says:\r\n\t/**\r\n\t * This method is a 'prebind.'  We need to determine what the types of\r\n\t * the nodes are going to be before we can set all the SQLParsed NULL's\r\n\t * to the appropriate type.  After we bind, however, we want to ignore\r\n\t * the SQLParsed NULL's which will be bound to CHAR.  Also, we might\r\n\t * have to delve into the CASE Expression tree.\r\n\r\nSo apparently findtype is not enough as it leaves all the SQL NULL's bound as CHARS.  Still we should be able to avoid the exponential processing, especially for the case where nulls are not involved as in DERBY-2986\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-08-30T19:53:33.038+0000","updated":"2007-08-30T19:53:33.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12377113/comment/12523930","id":"12523930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"> So apparently findtype is not enough as it leaves all the SQL NULL's bound as CHARS. \r\n\r\nGood catch, Kathey.  Thank you for picking this up and looking into it...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-08-30T20:20:56.757+0000","updated":"2007-08-30T20:20:56.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12377113/comment/12524176","id":"12524176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is an initial patch for this issue.  My solution was to have recastNullNodes rebind the expressions whenever a cast is performed.  This corrected the ClassCastException  and preserved the performance for the DERBY-2986 issue.\r\n\r\nWhile this approach seems to work fine, I somehow have the feeling that the indirect binding through both findType and recastNullNodes is a bit unclear.  I added comments to try to make it apparent that that is what is happenning, but wonder if there is better way to reorganize this to make it clearer.  Suggestions welcome.\r\n\r\nTests are running now.  \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-08-31T20:01:57.519+0000","updated":"2007-08-31T20:01:57.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12377113/comment/12524236","id":"12524236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Tests ran ok. Please review.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-01T00:10:39.840+0000","updated":"2007-09-01T00:10:39.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12377113/comment/12524774","id":"12524774","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thank you for the patch, Kathey.  I verified that it solves the reported problem and does not affect the performance as seen in DERBY-2986.  I also ran the new test case before and after applying the engine changes, and it behaved as expected (failed without the fix, passed with it).\r\n\r\n> I added comments to try to make it apparent that that is what is happenning, but wonder if \r\n> there is better way to reorganize this to make it clearer\r\n\r\nI think the comments help (thanks for adding them), but I also agree that some sort of code reorganization might be good here.  The code as it is feels a tad awkward.  Nonetheless, the patch as posted solves the problem so I'm +1 to commit.  If anyone has the time to do some re-org as follow-up work, that'd be great--but I wouldn't let that block the current patch.\r\n\r\nThank you again for picking this one up and resolving it so quickly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-09-04T16:07:17.882+0000","updated":"2007-09-04T16:07:17.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12377113/comment/12524900","id":"12524900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"fixed in trunk and 10.3 branch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-04T22:12:24.651+0000","updated":"2007-09-04T22:12:24.651+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3032/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i070dj:"}}