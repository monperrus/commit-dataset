{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12412996","self":"https://issues.apache.org/jira/rest/api/latest/issue/12412996","key":"DERBY-4027","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313401","id":"12313401","description":"Head of 10.4 branch","name":"10.4.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-01-22 14:46:48.117","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23974","customfield_12310222":"3_*:*_1_*:*_170747163_*|*_1_*:*_1_*:*_2152937302_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-02-18T12:04:47.828+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4027/watchers","watchCount":1,"isWatching":false},"created":"2009-01-22T14:36:43.363+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:52:13.372+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"When running our application we get the following error message:\r\n\r\nAn attempt was made to access an out of range slot on a page:\r\n\r\nINSERT INTO orders (operation, receptacle, vehicle_id, iata_origin, icao_origin, sta, eta, ata, pta, onb, arr_stand_id, arr_gate, arr_flight_no, arr_remarks, flight_no, icao_flight_no, icao_callsign, iata_destination, icao_destination, std, etd, atd, ofb, stand_id, pit_code, gate, aircraft_subtype_code, aircraft_registration, fuel_request, canceled, delay_ind, remarks, ptd, slot_request_code, slot_request, slot_granted, terminal, customer_name, customer_type, supplier_id, carnet_no, carnet_expiry, contract_id, authorization_reference, service_level, standby_at, started_at, completed_at, status, comment, meter1_start_volume_automatic, meter1_start_volume_manual, meter1_stop_volume_automatic, meter1_stop_volume_manual, meter2_start_volume_automatic, meter2_start_volume_manual, meter2_stop_volume_automatic, meter2_stop_volume_manual, temperature, density, created_at, updated_at, fuel_on_board, id) VALUES('FUELLING', NULL, NULL, NULL, NULL, '2009-01-22 07:25:00', '2009-01-22 07:30:00', '2009-01-22 07:27:00', '2009-01-22 07:27:00', '2009-01-22 07:29:46', 'anAEBO3yqr3zaaabxfoB_Q', NULL, 'DY 0201', NULL, 'DY 0242', 'NAX0242', 'NAX242', 'TOS', 'ENTC', '2009-01-22 07:50:00', NULL, '2009-01-22 08:13:00', '2009-01-22 08:06:08', 'anAEBO3yqr3zaaabxfoB_Q', NULL, '18', '733', 'LNKHA', 7200, 0, 'X', NULL, '2009-01-22 08:13:00', NULL, NULL, NULL, '1', NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, '2009-01-21 08:04:54', '2009-01-22 13:24:59', 0, 'aV9HYQ55ir3B9DabxfoB_Q')\r\n\r\nThe error occurs several times per day on different systems.  It started yesterday","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10364","value":"Data corruption","id":"10364"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37258","summary":"An attempt was made to access an out of range slot on a page","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Fedora 10 and Ubuntu 8.04\r\nSun Java 1.6.0_07 and 1.6.0_11\r\nderby 10.4.2.0","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10050","value":"Blocker","id":"10050"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":32,"total":32,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12666156","id":"12666156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Do you also have the stack trace for the exception?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-22T14:46:48.117+0000","updated":"2009-01-22T14:46:48.117+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12666162","id":"12666162","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"Thank you for your reply. \r\n\r\nI guess you mean an exception stack trace in derby.log?  The log was deleted when I restored the database, so I will send it the next time the problem occurs.\r\n\r\nIf you need something else than output from the derby.log, please specify.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-01-22T15:02:07.494+0000","updated":"2009-01-22T15:02:07.494+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12666164","id":"12666164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Yes, the exception stack trace in derby.log would be fine.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-22T15:07:34.612+0000","updated":"2009-01-22T15:07:34.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667128","id":"12667128","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"So, it has happened a couple of more times now, but when we look in the derby.log file, there is no exception.  There are only the startup messages:\r\n\r\n----------------------------------------------------------------\r\n2009-01-25 11:23:35.851 GMT:\r\n Booting Derby version The Apache Software Foundation - Apache Derby - 10.4.2.0 - (689064): instance a816c00e-011f-0d87-c36b-0000003a8778\r\non database directory /home/uwe/workspace/aifudis/aifudis.operator/javadb-activemq  \r\n\r\nDatabase Class Loader started - derby.database.classpath=''\r\n----------------------------------------------------------------\r\n2009-01-25 11:23:38.219 GMT:\r\n Booting Derby version The Apache Software Foundation - Apache Derby - 10.4.2.0 - (689064): instance 80840021-011f-0d87-c36b-0000003a8778\r\non database directory /home/uwe/workspace/aifudis/aifudis.operator/javadb-development  \r\n\r\nDatabase Class Loader started - derby.database.classpath=''\r\n\r\n\r\nPlease advise my next step.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-01-25T19:44:57.027+0000","updated":"2009-01-25T19:44:57.027+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667240","id":"12667240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It looks like this error has statement severity, which is not logged by default, so the derby.stream.error.logSeverityLevel property needs to be set to 20000 or lower in order to get it logged in derby.log. Set it to 0 to get all exceptions logged. http://db.apache.org/derby/docs/10.4/tuning/rtunproper26985.html\r\n\r\nAlternatively, you could modify your application to print the stack trace instead of just the error message.\r\n\r\nAny information about the transaction mix and the database schema would also be helpful.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-26T13:09:25.973+0000","updated":"2009-01-26T13:09:25.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667627","id":"12667627","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"I have attached a derby.log for after the problem occurs.  Please look at it and see if you can see how to solve the problem.\r\nI'll start reproducing the problem and attach another derby.log with the first exception we get, which is different.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-01-27T09:36:13.909+0000","updated":"2009-01-27T09:36:13.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667639","id":"12667639","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Can you try to run with the Derby debug version?\r\nLooking at your derby.log, the exception can be thrown in two places. By running with the debug build, we'll either get the line number of the exception, or possibly an assert error somewhere else. The debug version can be downloaded from the Apache Derby site.\r\n\r\nThere two cases are:\r\n 1) There is not enough data in the page to read the header (2 bytes).\r\n 2) There is not enough data in the page to read the user data according to the encoded byte length in the header.\r\n\r\nPossible causes:\r\n o The page is somehow corrupt.\r\n o The header is wrong.\r\n o A bug where wrong information about the field data is used.\r\n(o I also note that JRuby is being used.)\r\n\r\nTo investigate further, we need more information. The easiest thing to do is to run with the debug version to obtain line numbers (or an assert).\r\nI don't know too much about JRuby, but I assume you are not using JDBC directly?\r\nAlso, is the data you are inserting ASCII only, or are you inserting for instance CJK or nordic characters?\r\n\r\nAnother thing to do for those looking into this, could be to understand what exactly is going on in the BTree (i.e. comparePreviousRecord).\r\n\r\n\r\nFinally, in the description you wrote \"It started yesterday\". Does this mean that the application has been running successfully for a longer period of time?\r\nAnd on the different systems, are you running against the same database or regenerating it from scratch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-01-27T10:21:52.427+0000","updated":"2009-01-27T10:21:52.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667655","id":"12667655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"comparePreviousRecord() is used by B-trees that back a unique constraint on columns that could be null (new feature in Derby 10.4). Some possible problems with that method were identified in DERBY-4028. I don't know if it's related, though, since the data corruption may very well have happened before that method was called.\r\n\r\nThe original bug report mentioned another error message. If that error occurs again, it would be great if you could post that stack trace too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-27T11:57:52.485+0000","updated":"2009-01-27T11:57:52.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667669","id":"12667669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"Here is a derby.log with debug information.  I hope you can make sense out of it.\r\n\r\nAn additional information:  We recently (less than 2 weeks ago), started persisting ActiveMQ messages using derby.  ActiveMQ is running embedded in the same JVM, so we access 2 derby databases in the same JVM.\r\n\r\n> I don't know too much about JRuby, but I assume you are not using JDBC directly?\r\n\r\nWe access JDBC using ActiveRecord, but I expect this should not make a difference.\r\n\r\n> Also, is the data you are inserting ASCII only, or are you inserting for instance CJK or nordic characters?\r\n\r\nNordic characters are definitely possible.\r\n\r\n> Finally, in the description you wrote \"It started yesterday\". Does this mean that the application has been running successfully for a longer period of time?\r\n\r\nYes, the application has been running for long durations earlier, but we constantly develop the application, so circumstances change, and we regularly recreate the development database.\r\n\r\nTwo production databases are still running without problems, so something we changed in the last few days is triggering the error, but we are unable to identify any special changes.  We are possibly exercising the database slightly more than earlier by deleting/inserting some rows that were updated earlier.\r\n\r\n> And on the different systems, are you running against the same database or regenerating it from scratch?\r\n\r\nAll systems own their own embedded derby database.  There is no database network access.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-01-27T13:55:03.348+0000","updated":"2009-01-27T13:55:03.348+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667674","id":"12667674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Thanks.\r\n\r\nIs it possible for you to post the schema of the database (javadb-development)?\r\nIf that isn't possible, can you confirm if you are using a unique nullable constraint/index on one of the character columns?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-01-27T14:21:59.486+0000","updated":"2009-01-27T14:21:59.486+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667679","id":"12667679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"I can indeed confirm that we are using a unique nullable constraint (not index since it does not allow multiple rows with NULL) in a character column.\r\n\r\nAre we close?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-01-27T14:25:20.422+0000","updated":"2009-01-27T14:25:20.422+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667681","id":"12667681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"Here is a slightly different derby.log, with a slightly different error message.  I hope it helps.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-01-27T14:32:24.115+0000","updated":"2009-01-27T14:32:24.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667686","id":"12667686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"My mistake: There are indeed nullable unique indexes on the orders table.\r\n\r\nDo you still want the database schema?  Can you please tell me the easiest way to dump it?  We have ij available.\r\n\r\nHave you found a probable cause for the error?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-01-27T14:50:13.300+0000","updated":"2009-01-27T14:50:13.300+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667689","id":"12667689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Well, there's no repro available to test against...\r\nOne step forward would be to determine if the error is made when writing the page/record or when it is being read back.\r\n\r\nAs a work-around, maybe you could remove the constraint (or use just unique and insert unique values)? If that works, it strengthens the suspicion against the unique nullable code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-01-27T14:54:30.305+0000","updated":"2009-01-27T14:54:30.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667692","id":"12667692","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Looks like the latest error also happened in the index backing the nullable unique constraint (compareLeftAndRightSiblings() is only used by that kind of index):\r\n\r\nERROR XSDA1: An attempt was made to access an out of range slot on a page\r\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276)\r\n\tat org.apache.derby.impl.store.raw.data.BasePage.checkSlotOnPage(BasePage.java:1838)\r\n\tat org.apache.derby.impl.store.raw.data.BasePage.fetchFromSlot(BasePage.java:431)\r\n\tat org.apache.derby.impl.store.access.btree.BTreeController.compareNextRecord(BTreeController.java:454)\r\n\tat org.apache.derby.impl.store.access.btree.BTreeController.compareLeftAndRightSiblings(BTreeController.java:555)\r\n\tat org.apache.derby.impl.store.access.btree.BTreeController.doIns(BTreeController.java:812)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-27T15:03:37.779+0000","updated":"2009-01-27T15:03:37.779+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12667693","id":"12667693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The easiest way to dump the database schema is to use dblook.\r\n\r\n$ java -jar derbyrun.jar dblook -d jdbc:derby:mydb -o dblook.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-27T15:06:32.885+0000","updated":"2009-01-27T15:06:32.885+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12670321","id":"12670321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Uwe Kubosch wrote:\r\n-----\r\nDo you still want the database schema?\r\n-----\r\nYes, please.\r\nIt would also help to know more about the data you are inserting, and the access pattern.\r\nThe more information you provide, the better :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-02-04T12:37:16.065+0000","updated":"2009-02-04T12:37:16.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12670528","id":"12670528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"I attached a schema dump with the unique constraints.\r\n\r\nI used the command mentioned in this issue.  Is there a way to make the dump sorted the same way each time to enable easy diff of changes?\r\n\r\nOur usage pattern when triggering the error is typically to delete all rows in the orders table, and then insert about 1000 rows similar to the one in the description of this issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-02-04T22:15:20.355+0000","updated":"2009-02-04T22:15:20.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12670565","id":"12670565","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I was able to reproduce the error with the attached program Derby4027Repro.java.  To reproduce, create a database wombat and run the schema.sql script to set up the schema, then run the program.  It will fail with\r\n[C:/kmarsden/repro/derby-4027] java Derby4027Repro\r\nException in thread \"main\" java.sql.SQLException: An attempt was made to access an out of range slot on a page\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)\r\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:201)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:391)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2201)\r\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1323)\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1648)\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:294)\r\n        at Derby4027Repro.main(Derby4027Repro.java:15)\r\nCaused by: java.sql.SQLException: An attempt was made to access an out of range slot on a page\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:11\r\n9)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)\r\n        ... 9 more\r\nCaused by: ERROR XSDA1: An attempt was made to access an out of range slot on a page\r\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:276)\r\n        at org.apache.derby.impl.store.raw.data.BasePage.checkSlotOnPage(BasePage.java:1830)\r\n        at org.apache.derby.impl.store.raw.data.BasePage.fetchFromSlot(BasePage.java:431)\r\n        at org.apache.derby.impl.store.access.btree.BTreeController.compareNextRecord(BTreeController.java:455)\r\n        at org.apache.derby.impl.store.access.btree.BTreeController.compareLeftAndRightSiblings(BTreeController.java:556\r\n)\r\n        at org.apache.derby.impl.store.access.btree.BTreeController.doIns(BTreeController.java:813)\r\n        at org.apache.derby.impl.store.access.btree.BTreeController.insert(BTreeController.java:1261)\r\n        at org.apache.derby.impl.store.access.btree.index.B2IController.insert(B2IController.java:210)\r\n        at org.apache.derby.impl.sql.execute.IndexChanger.insertAndCheckDups(IndexChanger.java:439)\r\n        at org.apache.derby.impl.sql.execute.IndexChanger.doInsert(IndexChanger.java:383)\r\n        at org.apache.derby.impl.sql.execute.IndexChanger.insert(IndexChanger.java:589)\r\n        at org.apache.derby.impl.sql.execute.IndexSetChanger.insert(IndexSetChanger.java:267)\r\n        at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:453)\r\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1022)\r\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:495)\r\n        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)\r\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)\r\n        ... 3 more\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-02-04T23:58:51.750+0000","updated":"2009-02-04T23:58:51.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12670577","id":"12670577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"confirmed this is a regression and does not occur with 10.3.3.1 \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-02-05T00:23:46.543+0000","updated":"2009-02-05T00:23:46.543+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12670694","id":"12670694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"So now we have a way to reproduce it. Great! Thanks, Uwe and Kathey.\r\n\r\nI'm unchecking the regression checkbox since the repro uses a feature that is not present in 10.3 -- unique constraint on possibly null columns. The stack trace shows that the exception is thrown when updating an index for such a constraint. The reason why it works on 10.3 is that adding the unique constraint failed when running schema.sql:\r\n\r\nij> ALTER TABLE \"AIFUDIS\".\"ORDERS\" ADD CONSTRAINT \"ORDERS_FLIGHT_NO_STD_INDEX\" UNIQUE (\"FLIGHT_NO\", \"STD\");\r\nERROR 42831: 'FLIGHT_NO' cannot be a column of a primary key or unique key because it can contain null values.\r\nij> ALTER TABLE \"AIFUDIS\".\"ORDERS\" ADD CONSTRAINT \"ORDERS_ICAO_FLIGHT_NO_STD_INDEX\" UNIQUE (\"ICAO_FLIGHT_NO\", \"STD\");\r\nERROR 42831: 'ICAO_FLIGHT_NO' cannot be a column of a primary key or unique key because it can contain null values.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-05T09:44:46.721+0000","updated":"2009-02-05T09:44:46.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12670720","id":"12670720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"BTreeController.compareNextRecord() and comparePreviousRecord() are on a page boundary and therefore need to check the first record of the next page or the last record of the previous page, they don't check if the slot number is out of bounds when they go to the next/previous page. This causes problems if the neighbour page doesn't have any records. The attached patch (recheck-slot.diff) makes the methods recheck that the slot numbers are within bounds after moving to another page.\r\n\r\nWhat I don't quite understand about the code, is that the record with slot number 0 is not used. That is, the code only looks at slots 1 ... (recordCount() - 1). Does anyone know why? Slot 0 is a valid slot, as far as I read the code, but if I change those methods to look at slot 0, they start throwing EOFException.\r\n\r\nI haven't run the regression tests, but at least the repro ran without errors with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-05T11:09:09.333+0000","updated":"2009-02-05T11:09:09.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12670806","id":"12670806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"FWIW, all regression tests ran cleanly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-05T16:07:41.499+0000","updated":"2009-02-05T16:07:41.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12673577","id":"12673577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"So, this patch will be included in 10.4.2.1 ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-02-15T08:16:48.578+0000","updated":"2009-02-15T08:16:48.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12673682","id":"12673682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"In btree pages, the first row, ie. the row in slot 0 is a special row and not a normal key row.  It is a control row that has whatever meta data is necessary for linking up the pages.  There are 2 different control rows depending on whether it is a leaf or branch.  See BranchControlRow.java and LeafControlRow.java for details on what is in each.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2009-02-15T17:24:09.752+0000","updated":"2009-02-15T17:24:09.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12673862","id":"12673862","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for the explanation, Mike.\r\n\r\nHere's a new version of the patch. Same code changes as before, but now with comments. Also added a simplified version of Kathey's test case to NullableUniqueConstraintTest.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-16T12:31:30.164+0000","updated":"2009-02-16T12:31:30.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12673868","id":"12673868","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Uwe, I'm planning to commit the fix to trunk so that it will be part of the upcoming 10.5.1 release (http://wiki.apache.org/db-derby/DerbyTenFiveOneRelease), and also to backport it to the 10.4 branch so that it will be part of the next 10.4 release if there will be one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-16T12:45:22.415+0000","updated":"2009-02-16T12:45:22.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12673878","id":"12673878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"Excellent!  Thank you!\r\n\r\nOut of curiosity:  What about version 10.5.0.0 ? Where can I read about what the parts of the derby version numbers mean?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-02-16T13:48:33.391+0000","updated":"2009-02-16T13:48:33.391+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12673892","id":"12673892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"10.5.0.0 is the version number used for everything that is checked in on the development branch (trunk) until we create a separate 10.5 stable branch. There won't be a 10.5.0.0 release, instead the version number is bumped to 10.5.1.x when we create the stable branch. Some more explanation here: http://db.apache.org/derby/papers/versionupgrade.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-16T14:27:49.576+0000","updated":"2009-02-16T14:27:49.576+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12673894","id":"12673894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"body":"Thank you for the explanation and the link.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donv","name":"donv","emailAddress":"uwe at kubosch dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Uwe Kubosch","active":true},"created":"2009-02-16T14:36:15.368+0000","updated":"2009-02-16T14:36:15.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12674192","id":"12674192","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed to trunk with revision 744984.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-17T12:18:39.312+0000","updated":"2009-02-17T12:18:39.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12412996/comment/12674582","id":"12674582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I merged the fix to the 10.4 branch and committed revision 745485.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-18T12:04:47.714+0000","updated":"2009-02-18T12:04:47.714+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4027/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06qov:"}}