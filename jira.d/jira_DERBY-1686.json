{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12347842","self":"https://issues.apache.org/jira/rest/api/latest/issue/12347842","key":"DERBY-1686","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-08-24 06:58:52.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22638","customfield_12310222":"3_*:*_1_*:*_2061315000_*|*_1_*:*_1_*:*_1178754000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_38938645199","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-09-18T16:47:44.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1686/watchers","watchCount":0,"isWatching":false},"created":"2006-08-12T04:46:35.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"15.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12313149","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12313149","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12343197","key":"DERBY-1330","self":"https://issues.apache.org/jira/rest/api/2/issue/12343197","fields":{"summary":"Provide runtime privilege checking for grant/revoke functionality","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-12-13T09:05:09.197+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"With authentication on, attempting to execute a GRANT privilege  to 'user3' on a VIEW created by the 'user2' - who has only SELECT privilege\non the base table created by 'user1' does not fail. This results in 'user3' getting access to the table created by 'user1' through the view.\n\nI remember a discussion on the list to raise an error when an attempt is execute a GRANT on the view, until WITH GRANT option is implemented.\n\nHere is the repro:\n\njava -cp derby.jar;.\\derbytools.jar -Dderby.database.sqlAuthorization=true -Dij.exceptionTrace=true   org.apache.derby.tools.ij select_table_no_privilege.sql\nij version 10.2\nij> --\n--create db as user1\n--\nconnect 'jdbc:derby:grntrevokedb;create=true' user 'user1';\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\nij> create table t1(id int);\n0 rows inserted/updated/deleted\nij> insert into t1 values(100);\n1 row inserted/updated/deleted\nij> insert into t1 values(200);\n1 row inserted/updated/deleted\nij> --\n--Grant select to user2\n--\ngrant select on t1 to user2;\n0 rows inserted/updated/deleted\nij> --\n--Connect as user2\n--\nconnect 'jdbc:derby:grntrevokedb;create=true' user 'user2';\nWARNING 01J01: Database 'grntrevokedb' not created, connection made to existingdatabase instead.\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\nij(CONNECTION1)> select * from user1.t1;\nID\n-----------\n100\n200\n\n2 rows selected\nij(CONNECTION1)> --\n--Create view\n--\ncreate view v1 as select * from user1.t1;\n0 rows inserted/updated/deleted\nij(CONNECTION1)> select * from v1;\nID\n-----------\n100\n200\n\n2 rows selected\nij(CONNECTION1)> --\n--Grant select on view to user3. With the WITH GRANT option this should have failed\n--\ngrant select on v1 to user3;\n0 rows inserted/updated/deleted\nij(CONNECTION1)> --\n--Connect as user3\n--\nconnect 'jdbc:derby:grntrevokedb;create=true' user 'user3';\nWARNING 01J01: Database 'grntrevokedb' not created, connection made to existing\ndatabase instead.\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\nij(CONNECTION2)> --\n--No select privilege on base table user1.t1, hence will FAIL\n--\nselect * from user1.t1;\nERROR 28508: User 'USER3' does not have select permission on column 'ID' of table 'USER1'.'T1'.\nERROR 28508: User 'USER3' does not have select permission on column 'ID' of table 'USER1'.'T1'.\n        at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n        at org.apache.derby.iapi.sql.dictionary.StatementColumnPermission.check(Unknown Source)\n        at org.apache.derby.impl.sql.conn.GenericAuthorizer.authorize(Unknown Source)\n        at org.apache.derby.exe.ac295dc08bx010dx00a2x500ax00000011df100.fillResultSet(Unknown Source)\n        at org.apache.derby.exe.ac295dc08bx010dx00a2x500ax00000011df100.execute(Unknown Source)\n        at org.apache.derby.impl.sql.GenericActivationHolder.execute(Unknown Source)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)\n\n        at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main.go(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source)\n        at org.apache.derby.tools.ij.main(Unknown Source)\nij(CONNECTION2)> --\n--Select from the view on the base table should also FAIL, but does not\n--\nselect * from user2.v1;\nID\n-----------\n100\n200\n\n2 rows selected\nij(CONNECTION2)>","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39662","summary":"Grant/Revoke: Attempt to GRANT access to another user on a VIEW, created by the current user with only SELECT privilege on the base table does not fail","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kartha","name":"kartha","emailAddress":"kartha02 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kartha","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kartha","name":"kartha","emailAddress":"kartha02 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kartha","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Any","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10051","value":"Urgent","id":"10051"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":62,"total":62,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12430179","id":"12430179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"IMO, whoever plans to work on this issue should followup on thread titled \"Question on Grant revoke functional spec \" at http://www.nabble.com/Question-on-Grant-revoke-functional-spec-tf2005154.html#a5507724. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-24T06:58:52.000+0000","updated":"2006-08-24T06:58:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12430611","id":"12430611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Some discussion regarding permission cache can be found in DERBY-1539 and DERBY-1330.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-25T20:12:04.000+0000","updated":"2006-08-25T20:12:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12430644","id":"12430644","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"To resolve this issue, the permission cache problem needs to be addressed first.  Currently the permissions cache won't work properly when we are dealing with 2 types of keys associated with PermissionDescriptors. It looks like when calling getXXXPermissions(UUID), there is no choice but to load it from sys.sysdepends each time getXXXPermissions(UUID) is called since:\r\n\r\n1. The UUID of the PermissionDescriptor as a key will always miss the cache because the identity of the object is determined by the grantee and other related fields currently.\r\n\r\n2. The UUID of the PermissionDescriptor is not part of the equations of equals and hashCode method. It cannot because Derby do not know the \"other\" key value upfront during compilation of a statement until we retrieve it from the stored dependencies using the alternative key. \r\n\r\n3.  I think it is unsafe (and probably not a good idea) to modify equals and hashCode method to have 2 different type of logic for identity comparison as it may lead to unpredictable results if somehow the object's hash code is changed when it is in the hash table(cache).\r\n\r\nHence, I propose we first bypass the cache mechanism when we only know about the permission descriptor uuid.  For the other case, we can still use the permissions cache.  We can revisit this caching area later for performance improvements for grant and revoke statement.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-25T22:03:23.000+0000","updated":"2006-08-25T22:03:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12430704","id":"12430704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching experimental patch for DERBY-1686.  I ran derbyall on it and grantRevokeDDL.sql is the only diff I see.  It turns out that the master file of this testcase have incorrect expected behavior of certain test scenarios.  I think this patch outputs the correct results but will need to double check the grantRevokeDDL diffs.  Meanwhile, I welcome any comments for this patch.  It would be nice if the reviewer can also double check the master result file of this testcase.\r\n\r\nThe patch addresses the permissions cache problem that was mentioned in my previous comments.  When retrieving the permission descriptor via its UUID, it will bypass the cache.  For other case where it uses the grantee + other related fields as the key, it remains the same as before and use the cache.  This is to avoid having two different hash codes for the same object.\r\n\r\nNow, let's move on to the real problem of this jira.  =)  Before this patch, when granting a view whose underlying objects are not owned by the grantor, the grant will succeed which is not correct since the grantor does not have grant option for those objects unless he is DBA or the objects granted to him is with grant option).  So to resolve this issue, Derby will now checks each of the view's underlying object(s) to see if the grantor is the owner at execution time of the grant statement. (additonal checks are needed in the future when WITH GRANT OPTION is supported.)   If not, the grant will fail with an SQLException which is what the correct behavior should be.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-26T06:42:53.000+0000","updated":"2006-08-26T06:42:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12430923","id":"12430923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching updated patch derby1686-trunk-diff02.txt.  The only difference with this patch compared to the previous one is the grantRevokeDDL.sql and master file have been corrected.\r\n\r\nThe grantRevokeDDL.sql have a few testcases that are invalid.  So I have to go through them and made corrections to the master output and the testcase comments.  I think those particular tests need to be rewritten in mind that only the database owner or the owner of the objects can grant other users privileges to those objects.       ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-28T05:48:44.000+0000","updated":"2006-08-28T05:48:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12430941","id":"12430941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Please refer to SQL 2003 standard, section 12.1 <grant statement>, item 4 and 5 under general rules and section 12.2 <grant privilege statement>, item 6 under general rules for the correct semantics of grantable privileges.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-28T07:23:03.000+0000","updated":"2006-08-28T07:23:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431026","id":"12431026","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Yip, I am still looking through the patch but have a question after a quick look at the patch. \r\n\r\nIn new method bindPrivilegesForView() in TablePrivilegesNode.java, I noticed that we check if the current user is the database owner and if yes, then we do not build the provider list for the views. Is this happening at compile time? If yes, then it might not be correct. \r\n\r\nI think, at compile time, we want to build the provider list no matter who is compiling the statement. It is at run time that we want to disregard provider list if the database owner is granting the privilege. This is because, database owner might be the one to compile the statement first. But the view owner (assume that is not same as database owner) might execute the same statement later, but if we do not have the provider list attached to the statement plan created by database owner, then at execution time by view owner, we will not catach provider objects which are not owner by the view owner.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-28T17:53:12.000+0000","updated":"2006-08-28T17:53:12.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431068","id":"12431068","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Mamta, are you referring to the statement cache?  I thought there is a statement cache per connection.  So the DBA and the schema owner will have their own respective connection and hence won't be sharing the prepared grant statement.  Or am I missing something?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-28T20:58:06.000+0000","updated":"2006-08-28T20:58:06.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431088","id":"12431088","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"For example:  \r\n\r\nconnect 'jdbc:derby:wombat;create=true' user 'user1' as user1;\r\ncreate table t1 (i int);\r\ngrant select on t1 to user2;\r\nconnect 'jdbc:derby:wombat;create=true' user 'user2' as user2;\r\ncreate view v1 as select * from user1.t1;\r\nset connection user1;\r\ngrant select on user2.v1 to user3;\r\nset connection user2;\r\ngrant select on user2.v1 to user3;\r\n\r\nThe last grant statement won't be using the cached statement in the statement cache that is shared by different connections because it is compiling under a different schema.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-28T22:24:17.000+0000","updated":"2006-08-28T22:24:17.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431095","id":"12431095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Hmm... I probably should not make any assumptions for the equals method since it could changed in the future and not rely on the compilation schema.  I'll remove the dba check at compilation time and resubmit the patch.\r\nThanks for your comment, Mamta.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-28T23:08:11.000+0000","updated":"2006-08-28T23:08:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431098","id":"12431098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching derby1686-trunk-diff03.txt.  This patch removes the dba check at bind time and will collect the providers of a view regardless who the object owner is.  The runtime will check the authorization.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-28T23:25:11.000+0000","updated":"2006-08-28T23:25:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431141","id":"12431141","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Yip, I thought more about this issue and I think we might be able to get away with an easier solution. \r\n\r\nWith SQL authorization mode, for a view, in sys.sysdepends table, there will be zero/more rows for privilege dependencies. If the database owner is the owner of the view, then there will be no privilege dependencies rows in sys.sysdepends table. For a view whose owner is not the database owner, there will be no privilege dependencies rows in sys.sysdepends table if the view is not accessing any objects outside of the schema owned by the view owner. So, no privilege dependencies rows in sys.sysdepends table for a view would mean that the view owner can grant access to the view to other users.\r\n\r\nIf there are privilege dependencies rows in sys.sysdepends table for a view, then that would mean that the view is relying on privileges on external objects and hence, the view owner will not be able to grant access to the view to other users (the exception to this rule would be if the database owner is trying to grant access to any view to any user. That should work no matter if there are zero or more privilege dependencies rows in sys.sysdepends table for the view). \r\n\r\nSo, rather than building a list of providers for a view, we can simply have a flag which will be set to true at compile time if there are privilege dependencies rows in sys.sysdepends table for the given view. At execute time, if the grantor is the database owner, then we wil not worry about the flag and will succesfully grant the view access to the grantee. But if the grantor is the view owner and the flag is set to true, then we should throw an exception because the view owner does not own all the objects accessed by the view.\r\n\r\nI might not have thought over everything, so do let me know, if you find something in my proposed logic that might not work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-29T05:08:34.000+0000","updated":"2006-08-29T05:08:34.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431284","id":"12431284","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Mamta, I also thought about 2 alternative solutions before this patch.  One was your proposed idea and the other one was setting a persistent flag in the system table to indicate other schema dependency at compilation of CREATE VIEW statement so that this information is available in the ViewDescriptor.  I abandoned the latter idea since Derby needs to perform an upgrade and that this flag would render useless when it supports WITH GRANT OPTION in the future.  \r\n\r\nI think your proposed approach would also work but the flag information would become obsolete when WITH GRANT OPTION is supported and some sort of dependency list needs to be built eventually and supplied to the runtime since the privilege dependencies may now indicate that they are grantable.  I just thought it would be convenient to build this information now so that the compilation and execution interface does not need to be changed later.\r\n \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-29T16:10:31.000+0000","updated":"2006-08-29T16:10:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431291","id":"12431291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"How about if we still keep the logic of building the provider list instead of the flag and applied the proposed logic at execution time to throw exception when a privilege dependency is detected on the view?  I'll have to rerun derbyall and do some more analysis with the proposal.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-29T16:43:18.000+0000","updated":"2006-08-29T16:43:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431307","id":"12431307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Yip, even when we support WITH GRANT OPTION, we can modify the compile time privilege dependency rows check to see if the privilege has WITH GRANT OPTION set on it and if not, then set the flag to true. This will avoid having to carry the privilege list from compile time to execution time and will make the grant statement a bit faster. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-29T17:58:57.000+0000","updated":"2006-08-29T17:58:57.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431335","id":"12431335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Was there any reference to the SQL spec ever found to ensure we are handling the issue correctly?\r\n\r\nThe count of number of rows in SYSDEPENDS seems like a kludge to me, checking indirectly for some state rather than checking directly.\r\n\r\nWhat if the view is dependent on some function that is not owned by the view owner, how that does affect the solution and the desired behaviour?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-29T19:43:31.000+0000","updated":"2006-08-29T19:43:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431346","id":"12431346","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I think Yip has a reference to SQL specification section about the handling of this issue. It is part of the comments to this jira entry.\r\n\r\nAs for view being dependent on a function not owned by the view owner, there will be an entry in dependency system for view's requirement of execute privilege on the function and hence the logic should work fine for table/column/function dependencies.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-29T20:07:12.000+0000","updated":"2006-08-29T20:07:12.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431356","id":"12431356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I guess I'm a little lost from all the comments in this issue as to what exactly the proposed behaviour is. Looking at the references Yip provided didn't help me as they didn't seem to be related to accessing views., but there's a strong chance I'm misreading it. Looking on-line at Sybase and Postgres documentation I see two different ways of handling this, not sure if either is in-line with the standard or not.\r\n\r\nI guess the question is:\r\n\r\nFor a view V owned by user A what permissions are required by B to select from the view when:\r\n\r\n    1)  All the objects referenced in the view are owned by A?\r\n\r\n    2) Some objects referenced in the view are not owned by A?\r\n\r\n\r\nThe description for this bug seems to say that for case 2)\r\nGRANT SELECT ON V TO B\r\nshould fail. That's isn't what other systems seem to do.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-29T20:26:15.000+0000","updated":"2006-08-29T20:26:15.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431370","id":"12431370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Yes, in the case of some objects referenced in the view V that are not owned by the grantor A, the following statement should fail when it attempts to grant select privilege to user B:\r\n\r\nUser A:\r\nGRANT SELECT ON V TO B\r\n\r\nMy understanding of this behavior from reading the SQL2003 spec is deduced from WITH GRANT OPTION clause(grantable privilege).  I think the design spec also mentioned this as well.  If the owner of the object does not grant with grant on the specified privileges, then these privileges are not grantable to others.  So the above case should fail since user A has a view that references other objects that are not owned by A (and assuming those object owners did not grant with grant to user A.)  If such an action can take place without this clause, then I think having this clause does not make much sense.\r\n\r\nCurrently I am investigating what Mamta suggests.  However, the current patch derby1686-trunk-diff03.txt will resolve this jira issue.   It directly checks the view's underlying provider(s) to see if the grantor is its schema owner.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-29T21:12:24.000+0000","updated":"2006-08-29T21:12:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431377","id":"12431377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I'm still confused, please bear with me, some detailed reference to the specs and quotes would help.\r\n\r\nYou do say\r\n\"If the owner of the object does not grant with grant on the specified privileges, then these privileges are not grantable to others\"\r\n\r\nGranting SELECT on a view V to user B is not the same as granting SELECT TO B on the underlying tables, you seem to equate the two and then base all reasoning from that. I guess I can't see that leap of logic to equate those two.\r\n\r\nDisallowing the grant as indicated would not provide any additional fundamental security, which is why I'm trying to understand the reasoning for it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-29T21:40:08.000+0000","updated":"2006-08-29T21:40:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431393","id":"12431393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Yes, I agree that granting select on view V is not the same as granting select on base table.  I think I wasn't clear on my previous explanation.   \r\n\r\nDan stated \"Disallowing the grant as indicated would not provide any additional fundamental security\".\r\n\r\nIn contrast, I think this is a huge security issue.  e.g.:  Owner A permits non-grantable select privilege on table T to user B and does not want to grant this select privilege to other users in the system.  However, if Derby allows the current grant behavior as it is now, although user B is not able to grant select on the base table T (since he is not the owner), he can create a view that is own by him and grant this select privilege on this view to others, which is not what owner A would expect and want.  If owner A wants to allow this, he would have specified WITH GRANT OPTION when he granted the select privilege to user B.  So I believe it is vital to disallow this current behavior.\r\n\r\nI don't have the sql spec with me right now, so I'll have to reference it later when I have a chance...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-29T22:25:25.000+0000","updated":"2006-08-29T22:25:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431396","id":"12431396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Though user B can create a table T, do\r\n\r\ninsert into T select * from v;\r\n\r\ngrant select on public to T;\r\n\r\nand the data has still escaped from A's grasp.\r\n\r\nOr user B can publish the data from the view on a web-site.\r\n\r\nDisallowing the GRANT SELECT ON V TO C is no real help here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-29T22:35:19.000+0000","updated":"2006-08-29T22:35:19.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431408","id":"12431408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Right, I see your point.  There is not much one can do here if user B performs such actions.  Owner A would probably revoke this user's select privilege from now on.  =)  \r\n\r\nI think Oracle and DB2 disallows granting view who underyling objects are not own by the grantor but not sure if they are in-line with the standard.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-29T23:11:11.000+0000","updated":"2006-08-29T23:11:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431416","id":"12431416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kartha","name":"kartha","emailAddress":"kartha02 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kartha","active":true},"body":"I know DB2 disallows such granting of permissions on a view if the grantor does not own OR does not have the permission to perform GRANT (this is obtained when the original owner grants the permission  WITH GRANT option)  on the underlying objects.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kartha","name":"kartha","emailAddress":"kartha02 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rajesh Kartha","active":true},"created":"2006-08-29T23:54:20.000+0000","updated":"2006-08-29T23:54:20.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431431","id":"12431431","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Mamta, I thought about your proposal more with regard to checking SYSDEPENDS count on privilege dependencies.  I think there might be a case where this will not work.  Suppose the database owner dba creates a view v1 on the schema user2 owned by user2.  In this case, there is no table privilege entry in SYSDEPENDS so when user2 attempts to grant select on this view (which have underlying object that is not own by user2) to user3, it will succeed instead of fail.  i.e.:\r\n\r\nij version 10.3\r\nij> connect 'jdbc:derby:wombat;create=true' user 'dba' as dba;\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij> connect 'jdbc:derby:wombat;create=true' user 'user1' as user1;\r\nWARNING 01J01: Database 'wombat' not created, connection made to existing database instead.\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij(USER1)> connect 'jdbc:derby:wombat;create=true' user 'user2' as user2;\r\nWARNING 01J01: Database 'wombat' not created, connection made to existing database instead.\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij(USER2)> set connection user1;\r\nij(USER1)> create table t1 (i int);\r\n0 rows inserted/updated/deleted\r\nij(USER1)> grant select on t1 to user2;\r\n0 rows inserted/updated/deleted\r\nij(USER1)> set connection user2;\r\nij(USER2)> create table t2 (i int);\r\n0 rows inserted/updated/deleted\r\nij(USER2)> set connection dba;\r\nij(DBA)> create view user2.v1 as select * from user1.t1;\r\n0 rows inserted/updated/deleted\r\nij(DBA)> select * from sys.systableperms;\r\nTABLEPERMSID                        |GRANTEE                                                                                                                         |GRANTOR                                                                                                                         |TABLEID                             |&|&|&|&|&|&\r\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n2fb0c07e-010d-5cb9-2480-0000000f54c0|USER2                                                                                                                           |USER1                                                                                                                           |2753c07b-010d-5cb9-2480-0000000f54c0|y|N|N|N|N|N\r\n\r\n1 row selected\r\nij(DBA)> select * from sys.sysdepends;\r\nDEPENDENTID                         |DEPENDENTFINDER|PROVIDERID                          |PROVIDERFINDER \r\n---------------------------------------------------------------------------------------------------------\r\nf0b3c086-010d-5cb9-2480-0000000f54c0|View           |2753c07b-010d-5cb9-2480-0000000f54c0|ColumnsInTable \r\n\r\n1 row selected\r\nij(DBA)> set connection user2;\r\nij(USER2)> grant select on v1 to user3;\r\n0 rows inserted/updated/deleted\r\nij(USER2)> \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-30T01:44:20.000+0000","updated":"2006-08-30T01:44:20.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431443","id":"12431443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Dan, here are the two references from the SQL:2003 spec that I have read to deduce the grant behavior for the stated problem of this jira:\r\n\r\nIn section 12.1 <grant statement>, Under general rules item 4:\r\n\r\n4) For every table T specified by some involved privilege descriptor and for each view V owned by some\r\n   involved grantee G such that T or some column CT of T is referenced in the <query expression> QE of V,\r\n   or T is a supertable of the scoped table of a <reference resolution> contained in QE, let RTi, for i ranging\r\n   from 1 (one) to the number of tables identified by the <table reference>s contained in QE, be the <table name>s \r\n   of those tables. For every column CV of V:\r\n      a) Let CRTi,j, for j ranging from 1 (one) to the number of columns of RTi that are underlying columns of\r\n         CV, be the <column name>s of those columns.\r\n      b) If, following successful execution of the <grant statement>, all of the following are true:\r\n            i) The applicable privileges for G include grantable SELECT privileges on all of the columns CRTi,j.\r\n            ii) The applicable privileges for G include grantable EXECUTE privileges on all SQL-invoked\r\n                routines that are subject routines of <routine invocation>s contained in QE.\r\n   ...\r\n\r\n\r\nAnd in section 12.2 <grant privilege statement>, Under general rules item 6:\r\n\r\n6) If WITH GRANT OPTION was specified, then each privilege descriptor also indicates that the privilege\r\n   is grantable.\r\n\r\n\r\nIf I interpret the above correctly, then by enforcing the semantics of grantable privilege - \r\ngranting select privilege to a view owned by user A who have non-grantable select privileges\r\non the underlying objects should fail.  Comments?\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-30T03:24:19.000+0000","updated":"2006-08-30T03:24:19.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431456","id":"12431456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Yip, I think you are right about my logic not working for a view created by the database owner but it references objects not owned by the schema owner of the view. Considering that and Dan's comment \"The count of number of rows in SYSDEPENDS seems like a kludge to me, checking indirectly for some state rather than checking directly. \", we probably should go with your proposed logic.\r\n\r\nI thought of one case where the logic in the patch might not do the right stuff. If a user creates a view on a table owned by another user. Then dependency manager will keep the view's dependency on that table. Now, if the same user creates another view which is based on the view it created earlier, the dependency manager will not know of the new view's dependency on the base table at the outer view's level. We will need to go through view chains to make sure that we are not granting access to something that we are not allowed to. Here is an eg\r\nuser1\r\ncreate table t1(c11 int)\r\ngrant select on t1 to user2\r\nuser2\r\ncreate view v1 as select * from user1.t1 -- dependency manager will track v1's dependency on user1.t1\r\ncreate view v2 as select * from v1 -- dependency manager will track v2's dependency on v1\r\ngrant select on v2 to user3 -- we shouldn't just check v2's direct providers, but also see if those providers have any providers of their own\r\n-- And hence the grant above should not succeed\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-30T04:29:29.000+0000","updated":"2006-08-30T04:29:29.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431469","id":"12431469","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Mamta, I had this concern too when I was utilizing the dependency manager's getPersistentProviderInfos(dependable)\r\nmethod but it turns out that when you create the second view, the create view will add its providers to the new defined view.\r\nSo with the current patch, the grant fails as expected.\r\n\r\nij version 10.3\r\nij> connect 'jdbc:derby:wombat;create=true' user 'user1' as user1;\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij> create table t1 (c11 int);\r\n0 rows inserted/updated/deleted\r\nij> grant select on t1 to user2;\r\n0 rows inserted/updated/deleted\r\nij> connect 'jdbc:derby:wombat;create=true' user 'user2' as user2;\r\nWARNING 01J01: Database 'wombat' not created, connection made to existing database instead.\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij(USER2)> create view v1 as select * from user1.t1;\r\n0 rows inserted/updated/deleted\r\nij(USER2)> create view v2 as select * from v1;\r\n0 rows inserted/updated/deleted\r\nij(USER2)> grant select on v2 to user3;\r\nERROR 2850C: User 'USER2' is not the owner of Table/View 'USER1'.'T1'.\r\n\r\nI did find another minor problem with the current patch, the runtime check should only be performed in GRANT statement case \r\nonly since it does not applied to REVOKE.  So I am going to change that and resubmit the patch later.  I haven't move the runtime\r\ncheck logic to compilation phase yet, will get to that tomorrow.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-30T05:25:57.000+0000","updated":"2006-08-30T05:25:57.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431471","id":"12431471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching derby1686-trunk-diff04.txt, this patch fixes a minor problem on the execution check where it should only apply to GRANT statement only.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-30T05:34:25.000+0000","updated":"2006-08-30T05:34:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431474","id":"12431474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Thanks for your response on how dependency system takes care of chained view dependencies. \r\n\r\nIs derby1686-trunk-diff04.txt the latest patch that I can review? You mentioned that \"I haven't move the runtime check logic to compilation phase yet, will get to that tomorrow. \" Should I wait until tomorrow?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-30T05:40:21.000+0000","updated":"2006-08-30T05:40:21.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431477","id":"12431477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Yes, please wait till tomorrow.  I resubmit it because my laptop keeps on crashing on me today so just to be on \r\nthe safe side, I don't want to lose the diffs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-30T05:42:21.000+0000","updated":"2006-08-30T05:42:21.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431640","id":"12431640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching derby1686-trunk-diff05.txt for review.  With this patch, the view checking is moved to bind phase instead of execution.  It directly checks the relevent providers of the view to be granted and if the check fails, it will mark this in a flag for execution time to determine later if the grant should succeed based on who the grantor is.  It also introduced a new SQLSTATE for object permission in general.  Welcome any comments and suggestions.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-30T18:10:45.000+0000","updated":"2006-08-30T18:10:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431728","id":"12431728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Yip, the latest patch looks pretty good to me. Just 2 minor comments\r\n1)In code comments, I saw references to \"dba\". I think we want to refer to that user as \"database owner\". Dan had mentioned following in one of his emails to derby dev list \"DBA is a role (which doesn't (yet) exist in Derby).\"\r\n2)Secondly, can you please verify that the existing comments in the grant revoke test still make sense around the areas where you had to make changes to the test because of the functionality implemented by this Jira entry.\r\n\r\nThanks for being so patient with my feedback on this Jira entry.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-30T22:16:33.000+0000","updated":"2006-08-30T22:16:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431734","id":"12431734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Mamta, thanks for taking the time for reviewing the patch.  I apprecate your comments.\r\n\r\nMamta wrote:\r\n>>1)In code comments, I saw references to \"dba\". I think we want to refer to that user as \"database owner\". Dan had mentioned following in one of his emails to derby dev list \"DBA is a role (which >>doesn't (yet) exist in Derby).\"\r\n>>\r\n>>2)Secondly, can you please verify that the existing comments in the grant revoke test still make sense around the areas where you had to make changes to the test because of the functionality >>implemented by this Jira entry.\r\n\r\n1)  The DBA that you are referring to in the code comments are probably from the overloaded method that I copied from the super class.\r\n      Actually, there are quite a number of places where DBA occurs in the code comments, I think its best to clean this up in another jira entry since\r\n      it is not relevent to this jira and may make code reviewing abit difficult.\r\n\r\n2)  I have verified the changes in the comments reflects the current master output.  I thought it would be nice if another pair of eyes can also validate\r\n      the master output since for the last couple of jiras I fixed, their respective master outputs are incorrect...\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-30T22:36:22.000+0000","updated":"2006-08-30T22:36:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431737","id":"12431737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"OK, In that case, we are good to go.\r\n\r\nI will make a jira entry for changing \"dba\" to \"database owner\" whereever appropriate in the grant revoke code. \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-08-30T22:47:03.000+0000","updated":"2006-08-30T22:47:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431743","id":"12431743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"To address Dan's comment before a committer commits this jira.\r\n\r\nDan stated:\r\n\r\n\"Disallowing the grant as indicated would not provide any additional fundamental security, \r\n which is why I'm trying to understand the reasoning for it.\"\r\n\r\nInitially, I thought it had to do with security issue but as Dan pointed out this was not the case.  \r\nThis jira is about implementing the correct semantics according to the SQL:2003 standard \r\nwith respect to grantable privileges.  In short, one might have the right to grant privilege to others \r\nbut not the right to give other users the right to make further grants if WITH GRANT OPTIONS is \r\nnot specified.  Please refer to my previous comments for those spec references.\r\n\r\nIf there are no further comments, objections or concerns, this jira is ready for commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-30T23:17:12.000+0000","updated":"2006-08-30T23:17:12.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431751","id":"12431751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Thanks Yip - I finally understood the logic in section 12.1, sorry for being so slow.\r\n\r\nNext question is why does the GRANT fail?\r\nFrom my reading of  general rule 8) of section 12.2 it seems to me the statement should complete with a warning\r\n01007 privilege not granted\r\n\r\nI don't see any case in 12.2 where a GRANT fails.\r\n\r\nThough it is strange in 12.2 general rules 3)  & 4)  it adds descriptors to CPD only \"for which\r\nA holds the corresponding privilege with grant option.\" but that restriction does not exist in general rule 2).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-31T00:09:08.000+0000","updated":"2006-08-31T00:09:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431755","id":"12431755","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I'm guess the requirement to fail comes from the Access Rules for 12.2 which state:\r\n\r\n\"The applicable privileges shall include a privilege identifying O.\"\r\n\r\nThe Access rules are \"A specification in English of rules governing the accessibility of schema objects\",\r\nwhich sounds great, but I'm stumped as to what identifying means in \"privilege identifying O\" means. Any ideas?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-31T00:21:05.000+0000","updated":"2006-08-31T00:21:05.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431769","id":"12431769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"\"The applicable privileges shall include a privilege identifying O.\" \r\n\r\n\"O\" is defined in 12.2 under Syntax Rules item 1 and \"Identified\" is defined in 12.2 under Syntax Rules item 4.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-31T02:48:38.000+0000","updated":"2006-08-31T02:48:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431903","id":"12431903","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"OK - I can buy that,  12.2 SR 4) ties into 12.2 Access rules.\r\n\r\nI still think the statement should generate a warning instead of an error (though I've changed my mind three times so far :-)\r\n\r\nThe key (I think) is that 12.2 Access rules say:\r\n\r\n\"The applicable privileges shall include a privilege identifying O.\"\r\n\r\nNote 'a privilege\", *singular*, not all privliges identified explictly and implicitly by 12.2 SR 4). (we assume)\r\n\r\nIn the case in the description, user2 does have the privlege of grantabke SELECT  (with grant option) for view v1\r\nsince it owns view v1. Thus execution seems to satisfy the access rules for 12.2.\r\n\r\nTwo other ways of looking at this:\r\n\r\n1) If the grantor was required to have all the privileges identified in 12.2 SR 4), then I think it would be impossible\r\nfor the statement ever to generate a warning from 12.2 GR 8) and 9). I don't think the spec would contradict itself like this.\r\n\r\n2)  I belive a statement like\r\nGRANT SELECT, INSERT ON T TO FRED\r\nshould succeed if the grantor has grantable SELECT on T, but not grantable INSERT on T,\r\nand the result is SELECT is granted to FRED but not INSERT.\r\nThus would mean that the singular in 12.2 AR 1) is correct and has a purpose.\r\n\r\nThanks again for your patience.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-31T15:39:41.000+0000","updated":"2006-08-31T15:39:41.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431945","id":"12431945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Dan stated:\r\n\r\nTwo other ways of looking at this: \r\n\r\n1) If the grantor was required to have all the privileges identified in 12.2 SR 4), then I think it would be impossible\r\nfor the statement ever to generate a warning from 12.2 GR 8) and 9). I don't think the spec would contradict itself like this.\r\n\r\n2) I belive a statement like\r\nGRANT SELECT, INSERT ON T TO FRED\r\nshould succeed if the grantor has grantable SELECT on T, but not grantable INSERT on T,\r\nand the result is SELECT is granted to FRED but not INSERT.\r\nThus would mean that the singular in 12.2 AR 1) is correct and has a purpose. \r\n\r\nMy comments:\r\n\r\nFor 2)\r\n\r\nGRANT SELECT, INSERT ON T TO FRED\r\n\r\nOk, I agree the above statement should generate a warning when SELECT is grantable privilege and\r\nthe INSERT is not.  (The SELECT privilege on T is granted.)  This makes sense when 12.2 AR 1)\r\nis applied.\r\n\r\n   \r\nFor 1)\r\n  GRANT SELECT ON V TO FRED\r\n\r\nWhere V is a view, it is referring to a \"singular\" privilege which is SELECT in this case.  \r\nAccording to 12.1 GR 4), the above statement should only be executed successfully when all\r\nof its underlying objects (be that tables or views) have grantable select privilege as well.\r\nComments? \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-31T18:59:07.000+0000","updated":"2006-08-31T18:59:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12431953","id":"12431953","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I think from the standard a GRANT statement has three possible outcomes:\r\n\r\nA) Failed execution with SQL state 42xxx - Access Rule violation\r\n\r\nB) Successful execution - no privileges granted - warning raised 01007 - privilege not granted\r\n\r\nC) Successful execution - at least one privilege granted\r\n\r\nFor the examples above\r\n\r\n1) GRANT SELECT, INSERT ON T TO FRED  - I think it is outcome C), ie. no warning\r\n\r\nAs for case 2) Yip says: \"According to 12.1 GR 4), the above statement should only be executed successfully when all\r\nof its underlying objects (be that tables or views) have grantable select privilege as well. \"\r\n\r\nSo can you quote any piece of text in 12.1 GR 4) that indicates a possible outcome is a failure?\r\nThe standard indicates failure by saying \"then an exception condition is raised:<description of error>\"\r\nNote there are no Access Rules for 12.1, the only access rules that apply here is from 12.2.\r\n\r\nI think that 12.1 GR 4) is simply stating that if a creator of a view following *any* GRANT statement has grantable privileges for all\r\nthe privileges the view requires, then the creator of the view automatically gains grantable SELECT on the view.\r\nSo for the example in the description, if user1 subseqeuntly executes (after the view was created)\r\n\r\nGRANT SELECT ON user.t1 to user2 WITH GRANT OPTION\r\n\r\nthen this statement is implicitly executed\r\n\r\nGRANT SELECT ON user2.v1 to user2 WITH GRANT OPTION GRANTED BY _SYSTEM\r\n\r\nSo I think case 2) here is a B - warning raised.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-31T19:38:46.000+0000","updated":"2006-08-31T19:38:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432028","id":"12432028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Dan states:\r\n\r\n1) GRANT SELECT, INSERT ON T TO FRED  - I think it is outcome C), ie. no warning\r\n\r\nHmm... I found it abit strange if no warning is raised for the above case where \r\nINSERT is non-grantable privilege and SELECT is grantable.  The SELECT privilege\r\nis granted(12.2 AR item 1) and since the INSERT privilege is non-grantable, the\r\nsystem should raise a warning (12.1 GR item 8)\r\n\r\nIf no warning is raised, then how can a grantor can be informed by the system that all \r\nthe specified privileges he/she attempts to grant are all granted to the respective \r\ngrantee(s)?  i.e.:  If this very statement was issued by another user who happens to \r\nhave both SELECT and INSERT as grantable privileges.  So shouldn't C) be\r\n\r\nC) Successful execution - at least one privilege granted, warning issued \r\n\r\nAnd an additional outcome D) where\r\n\r\nD) Successful execution - all privileges granted, no warning issued\r\n\r\n  \r\n2)  GRANT SELECT ON V TO FRED\r\n\r\n    I cannot find any piece of info that is in 12.1 GR 4) that explicitly states it should return\r\n    as failure or warning.  All it states is that if the conditions in GR 4) are met,\r\n    then the grant statement is executed successfully.  I was inferring this implicitly\r\n    that if it is not executed successfully then it is an error.  \r\n\r\n\r\nI think at least we agree on that the problem statement of this jira should not be granted \r\nsuccessfully, so now the question is - should it be raised as a warning or an error\r\nin the \"singular\" privilege case?  In either case, there must be references somewhere\r\nin the spec that addresses this...\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-01T02:25:22.000+0000","updated":"2006-09-01T02:25:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432077","id":"12432077","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Ok, I think I have misread GR 4), so let's try this again.  =)\r\n\r\nDan stated:\r\n\r\nI think that 12.1 GR 4) is simply stating that if a creator of a view following *any* \r\nGRANT statement has grantable privileges for all the privileges the view requires, then \r\nthe creator of the view automatically gains grantable SELECT on the view.\r\n\r\nSo according to 12.1 GR 4), for the problem statement, the view owner does not have grantable \r\nSELECT on the view since he does NOT have select privilege WITH GRANT OPTIONS on the underlying \r\ntable(s) or view(s).\r\n\r\nWith that said, according to 12.2 AR 1)\r\n\r\n\"The applicable privileges shall include a privilege identifying O.\" \r\n\r\nAnd 12.2 SR 4)\r\n\r\n\"A set of privilege descriptors is identified. The privilege descriptors identified are those defining, for each\r\n<action> explicitly or implicitly in <privileges>, that <action> on O held by A with grant option.\"\r\n\r\nSo for\r\n\r\nGRANT SELECT ON V TO FRED\r\n\r\nHere, we are referring to a singular privilege identifying O and in this case, there is \r\nno applicable privilege identifying O; hence an access rule violation.  So I think it should \r\nreturn an error instead of a warning.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-01T07:06:51.000+0000","updated":"2006-09-01T07:06:51.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432148","id":"12432148","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Yip said:\r\n> So according to 12.1 GR 4), for the problem statement, the view owner does not have grantable\r\n> SELECT on the view since he does NOT have select privilege WITH GRANT OPTIONS on the underlying\r\n> table(s) or view(s). \r\n\r\nOf course, thanks for pointing that out Yip. So the rule I've been using to say it's not an error  is the rule that proves it's an error. :-)\r\nSorry I was dumb here. I think I was of in too much the mindset that the object owner was all powerful either from that's the\r\nway it's been discussed during design & implementation or I read too much into the functional spec.\r\n\r\nSo error it is.\r\n\r\nThis has been interesting in that the SQL standard describes a model with real (implict) GRANT's for various actions\r\nby the special grantor _SYSTEM. I think I also that these grants are expectedbe reflected in meta data.\r\nHowever, Derby's implementation choose not to implement the literal model, but instead have behaviour that\r\nmimics the model (which is fine if the end-result is the same thing). I wonder though if following the model literally\r\nwould lead to less special cases and not several back-and forths about how to address issues such as this.\r\nI mean here the back & forth on how to determine if the view select was grantable or not. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-09-01T14:17:52.000+0000","updated":"2006-09-01T14:17:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432149","id":"12432149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"The functional spec in DERBY-464 has this line:\r\n\r\n\"When a table, view, function, or procedure is created its owner (creator) has full privileges on it. \"\r\n\r\nI think we are now saying that is false, it might be better to explicitly state which permissions the owner has when an object is created.\r\nChecking the user docs to see how this was reflected would be a good idea.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-09-01T14:24:36.000+0000","updated":"2006-09-01T14:24:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432201","id":"12432201","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching derby1686-trunk-diff06.txt.  There was conflict with the latest code trunk's master file for grantRevokeDDL.sql, so resubmitting the patch.  It should apply cleanly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-01T18:56:38.000+0000","updated":"2006-09-01T18:56:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432202","id":"12432202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Thanks Dan and Mamta for taking the time to review and make valuable comments and suggestions. \r\nIf there are no further objections, then this jira is ready to be committed.  =)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-01T18:58:42.000+0000","updated":"2006-09-01T18:58:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432206","id":"12432206","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Yip, based on your and Dan's discussion of the SQL specification, does the functional spec need to be updated? If so, will you please take care of that?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-09-01T19:09:44.000+0000","updated":"2006-09-01T19:09:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432207","id":"12432207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I have not reviewed the patch but am planning to. All my comments have been around trying to clearly understand the behavior required which \r\nI thought was missing in the earlier discussion.\r\n\r\nIs there an overview of the patch: I see this comment above:\r\n\r\nhttp://issues.apache.org/jira/browse/DERBY-1686#action_12431640\r\n\r\n\"With this patch, the view checking is moved to bind phase instead of execution. It directly checks the relevent providers of the view to be granted and if the check fails, it will mark this in a flag for execution time to determine later if the grant should succeed based on who the grantor is.\"\r\n\r\nOne has to remember that committers and reviewers are not as closely involved in the work as the contributor is, obviously the contributor has been working\r\non the patch and knows the details inside & out. Others are coming from it fresh or having managed to spend 5mins looking at the issue,. so the patch\r\ndescription should be written assumign the reader knows nothing. This way patches can be committed much faster as the reviewers and  committers\r\ncan come up to speed faster.\r\n\r\nFor example, taking the above comment:\r\n\r\n  \"the view checking\" - what view checking, grant time, create view time, select from view time, revoke time, etc? I'm sure it's clear to you, but not to me.\r\n\r\n  \"checking moved to bind time ... determine later ...\" - looks like we are checking twice now, once at bind, once at execution, so why even check at bind time?\r\n   A  fuller description of the algorithm being used would help here. If it's in comments in the code, that's great, just provide a pointer of where to start looking.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-09-01T19:11:23.000+0000","updated":"2006-09-01T19:11:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432223","id":"12432223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Dan, let me try to summarize and clarify what this patch is doing.  \r\n\r\nFirst of all, at this point, we clearly understand that from the SQL:2003 spec, for the problem statement, the \r\nsystem needs to raise an error  when an owner of a view attempts to grant the view to others for which\r\nhe does not have all the required privilege(s)  (WITH GRANT OPTIONS) from the underlying objects.\r\nThe view owner has only privilege to select from the view but he does not have grantable select privilege;\r\ntherefore, he does not have the rights to grant to others.\r\n\r\nWith that said, let's move to the patch implementation details.  In order to resolve this issue, during the\r\nbind phase of GRANT statement (see TablePriviegeNode's bindPrivilegeForView for details), the logic\r\nis to retrieve the view relevent providers and check against if the current user is the owner of the schema\r\nfor those objects.  By relevent I mean we only check for the following providers:  TableDescriptor, ViewDescriptor \r\nand AliasDescriptor (for routine).  If the check fails, we will mark the flag for execution later to indicate the\r\nobject is grantable or not.  We do not fail this at bind time since this statement may be in the statement\r\ncache for reuse, so we need to make the final check at execution time.  Thus, at execution time (see \r\nTablePrivilegeInfo's checkOwnership method for details), we determine here if the object is grantable iff:\r\n\r\n1)  The current user is the database owner.\r\n2)  The current user is not the database owner but is the schema owner of the object to be granted\r\n3)  For view, we do an additional check to see if the grantable flag that was set in bind time is true\r\n4)  If the current user is not the owner, the system needs to do another check to see if the grantor \r\n      has grantable privilege(s) on that object.    This is not implemented yet since Derby doesn't support \r\n      FOR GRANT OPTIONS clause currently.\r\n\r\nSo in order for the logic above to work, one other thing needs to be resolved which was not quite clear in \r\nthe design specification - the permission cache.  I stumbled into this problem when I need to get all the\r\nproviders of the dependable (the view in this case) from the dependency manager(DM).  There are 2\r\nways to obtain a particular permission descriptor.  Let's take TablePermissionDescriptor for example.\r\nTo retrieve this descriptor, one way is to supply grantee + tableUUID as a key or another way is to use\r\nthe table permission UUID (this one is mainly used by the DM to instantiate the respective descriptor object)\r\nThe problem with the permission cache is, only the grantee and tableUUID is in the equations of computing\r\nthe hashCode and equals method but not the table perms UUID.  \r\n\r\nSo when the DM attempts to load the provider UUID for the various permission descriptors in SYSDEPENDS, \r\nthere is a problem of instantiating the permission descriptor since the equals and hashCode method used\r\nto set the identity of the object uses nothing of perms UUID, this eventually will lead to a NPE in the permission\r\ncaching logic.  To resolve this, the getXXXPermission(UUID) form no longer interacts with the permission cache.  \r\nBut for the other normal case where we know the grantee and the tableUUID from compilation time, the system will \r\nstill make use of this permission cache.  I think that is about it from the implementation perspective.\r\n\r\nThe latest patch for this jira is derby1686-trunk-diff06.txt.  Appreciate any suggestions and comments.\r\n\r\nNote:  I was reviewing the Grant/Revoke code, I noticed that for various access violations, the system is\r\n           throwing SQLSTATE with class code 28, shouldn't it be class code 42 instead?  e.g.:  \r\n\r\nClass code - 28\r\ninvalid authorization specification 28 (no subclass) 000\r\n\r\nClass code - 42\r\nsyntax error or access rule violation 42 (no subclass) 000\r\n\r\n\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-01T19:58:49.000+0000","updated":"2006-09-01T19:58:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432231","id":"12432231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Thanks Yip, from a quick read that looks really helpful.\r\n\r\nQuick question jumps out, you say this flag is based upon the current user, statements can be shared in the statement cache\r\nso how can a compiled statement have state that's dependent on the user compiling the query.\r\n\r\nI will review the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-09-01T20:22:10.000+0000","updated":"2006-09-01T20:22:10.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432236","id":"12432236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Dan, thanks for catching that!   I should have thought more thoroughly before applying this\r\nsort of optimization suggestion.  My original patch did not use this flag, it just collects the list of \r\nrelevent providers for the dependable and passed this list on to execution where it does the \r\nappropriate checking with respect to the current user.  I'll hold on to more comments from you \r\nbefore I revert it to my original fix.\r\n\r\nWith the current logic of the statement cache, the compiled grant/revoke statement \r\nwill not be reused for different connections since I think the equals method is checking if the \r\nstatement's  compilation schema is the same.  Just an implementation note.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-01T20:41:53.000+0000","updated":"2006-09-01T20:41:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432241","id":"12432241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I haven't thought about this a lot, but the optimization might make sense if instead of using the current user you used the\r\nowner of the view.\r\n\r\nThen again getting GRANT/REVOKE statements to work correctly should be the first thought, I don't think\r\nthat performance of them is going to be on anyone's critical list. Best to optimize once one knows where the bottle neck\r\nis.\r\n\r\nFrom reading of the description I'm concerned that we are even collecting providers at bind time, possibly doing a lot\r\nof extra work for little benefit (still need to look at the code to see what is meant by collecting the providers).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-09-01T20:58:36.000+0000","updated":"2006-09-01T20:58:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432245","id":"12432245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"In patch \r\n\r\n+\t// get all the providers of this view for execution time to see if\r\n+\t// this view is grantable to the grantees by this grantor\r\n+\t// go through the providers regardless who the owner is since the \r\n+\t// statement cache may be in effect.\t\r\n+\tprivate void bindPrivilegesForView ( TableDescriptor td) \r\n\r\n1) Please use javadoc comments (/** intro) for methods, fields classes, not regular comments. They will appear in the\r\nengine's javadoc and they appear in IDE's (at least Eclipse) when hovering over a call to that method. Makes\r\ndevelopment a lot easier.\r\n\r\nI saw this in your overview as well, you say here if the \"view is grantable\", and in the overview above \"indicate if the object is grantable\".\r\n\r\nBut objects or views are not grantable, privileges are grantable. Using clear, consistent and correct terminology really helps to clear up\r\nthe code and make it understandable for others to read.\r\n\r\nMinor harmess bug in bindPrivilegesForView  in that if the provider is not one of the types you handle then the sd checked\r\nwill be the same one checked on the previous iteration. Would be fixed by correctly moving the defintion of sd into the loop\r\nwhere it belongs.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-09-01T21:24:33.000+0000","updated":"2006-09-01T21:24:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432276","id":"12432276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"My apology.  I will clean up the comments and use consistent terminology in the next patch.\r\nI wrote the patch summary really fast and should have double check on the content to see \r\nif they make clear sense to the reviewers.\r\n\r\nAs for \"collecting the providers\" description, perhaps it is more clearer to state \"retrieving all the underlying \r\nstored dependencies such as table(s), view(s) and routine(s) descriptors which the view depends on.\" \r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-02T06:32:26.000+0000","updated":"2006-09-02T06:32:26.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432366","id":"12432366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching derby1686-trunk-diff07.txt.   This patch reverts to my original fix and the  optimization runtime flag checking has been removed.  The original fix retrieves all the relevent providers such as table, view, and routine descriptor(s) of the given view at bind time and pass this information to runtime later for it to determine if the privilege is grantable or not by the grantor.  It also corrected some of the comments in the code that was not entirely clear and concise.\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-03T18:33:19.000+0000","updated":"2006-09-03T18:33:19.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12432372","id":"12432372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Dan stated:\r\n\r\n\"From reading of the description I'm concerned that we are even collecting providers at bind time, possibly doing a lot\r\nof extra work for little benefit (still need to look at the code to see what is meant by collecting the providers).\"\r\n\r\nThe only reason I collect the providers at bind time instead of execution time is because Derby is retrieving these\r\nstored dependencies from SYSDEPENDS and I like to reduce the number of read locks that get held at execution \r\ntime.  If any of the providers are modified, then the dependency manager will invalidate the view which will trigger \r\na recompilation of the statement.  Do let me know if this approach is not worth the effort or it is not valid.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-03T19:17:42.000+0000","updated":"2006-09-03T19:17:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12433151","id":"12433151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I'm working on committing this latest patch.\r\n\r\nQuick question, why do we need a new SQL state 2850G, it's very similar to the existing 28508.\r\n\r\nERROR 2850G: User 'MAMTA2' does not have grant permission on object 'MAMTA2'.'V21VIEWTEST'.\r\n\r\nERROR 28508: User 'MAMTA3' does not have select permission on column 'C111' of table 'MAMTA2'.'V21VIEWTEST'.\r\n\r\nAlso there is no such thing as a 'grant' permission (see 2850G) above, so I think this message is somewhat confusing to the user.\r\n\r\nThis can be resolved after the commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-09-07T16:02:42.000+0000","updated":"2006-09-07T16:02:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12433161","id":"12433161","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Patch derby1686-trunk-diff07.txt Committed revision 441131 Thanks Yip","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-09-07T16:32:47.000+0000","updated":"2006-09-07T16:32:47.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12435142","id":"12435142","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Most of the 2850* SQLSTATE applies to a specific type of object.  i.e.:  tables.  The error here applies to view and \r\nI need something more general so I introduced 2850G.  I was thinking that the system probably might just need\r\na single generic SQLSTATE to address this.  But I see that you have already open a jira issue for this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-15T22:35:45.000+0000","updated":"2006-09-15T22:35:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347842/comment/12551396","id":"12551396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"This issue has been resolved for over a year with no further movement. Closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2007-12-13T09:05:09.196+0000","updated":"2007-12-13T09:05:09.196+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1686/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i075j3:"}}