{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12546940","self":"https://issues.apache.org/jira/rest/api/latest/issue/12546940","key":"DERBY-5663","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315436","id":"12315436","description":"Head of 10.5 branch - version bump for DERBY-4835","name":"10.5.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315434","id":"12315434","description":"Head of 10.6 branch as of 2014-01-13","name":"10.6.2.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315902","id":"12315902","description":"Head of 10.7 branch as of 2010-11-29","name":"10.7.1.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323456","id":"12323456","description":"Third release on the 10.8 branch","name":"10.8.3.0","archived":false,"released":true,"releaseDate":"2012-11-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323562","id":"12323562","description":"Head of 10.9 branch after releasing 10.9.1.0","name":"10.9.2.2","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2012-03-19 21:02:03.311","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"232098","customfield_12310222":"1_*:*_1_*:*_14738210564_*|*_5_*:*_2_*:*_611115965_*|*_4_*:*_1_*:*_585570630","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-09-18T15:06:48.254+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5663/watchers","watchCount":3,"isWatching":false},"created":"2012-03-18T04:45:11.107+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_triage10_9"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12357613","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12357613","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"inwardIssue":{"id":"12607119","key":"DERBY-5923","self":"https://issues.apache.org/jira/rest/api/2/issue/12607119","fields":{"summary":"10.8 Backport issue (Fall 2012)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-09-03T08:31:35.369+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"Derby has a large data suite which runs LobLimitsTest with small data size, large data size and with embedded and network server configurations. The large data suite is run as follows\r\ntime java  -Dderby.tests.trace=true -Dderby.infolog.append=true junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.largedata._Suite > runall.out 2>&1\r\n\r\nI made a simple change to the suite to log statement text as shown in the attached patch(DERBY5663_patch1.txt). This causes the large data suite to run into NPE (NPE can be seen in runall.out) as shown below. Not sure what I am doing wrong while trying to set the property, which results in NPE.\r\n.\r\n(emb)largedata.Derby5624Test.testDERBY_5624 used 411473 ms .\r\n(emb)largedata.LobLimitsTest.test_01_Blob used 1555 ms .\r\n(emb)largedata.LobLimitsTest.test_02_BlobNegative used 42 ms .\r\n(emb)largedata.LobLimitsTest.test_03_Clob1 used 1436 ms .\r\n(emb)largedata.LobLimitsTest.test_04_Clob2 used 1707 ms .\r\n(emb)largedata.LobLimitsTest.test_05_ClobNegative used 967 ms E.\r\n(emb)largedata.LobLimitsTest.test_01_Blob used 2929139 ms .\r\n(emb)largedata.LobLimitsTest.test_02_BlobNegative used 154 ms .\r\n(emb)largedata.LobLimitsTest.test_03_Clob1 used 2854121 ms .\r\n(emb)largedata.LobLimitsTest.test_04_Clob2 used 656137 ms .\r\n(emb)largedata.LobLimitsTest.test_05_ClobNegative used 331288 ms EF\r\nTime: 7,589.168\r\nThere were 2 errors:\r\n1) LobLimitsTestjava.lang.NullPointerException\r\n\tat org.apache.derbyTesting.junit.SystemPropertyTestSetup.setProperties(SystemPropertyTestSetup.java:116)\r\n\tat org.apache.derbyTesting.junit.SystemPropertyTestSetup.setUp(SystemPropertyTestSetup.java:87)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:18)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n2) LobLimitsTestjava.sql.SQLNonTransientConnectionException: DERBY SQL error: SQLCODE: -1, SQLSTATE: 08006, SQLERRMC: org.apache.derby.jdbc.EmbeddedDriver is not registered with the JDBC driver manager\r\n\tat org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\r\n\tat org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:364)\r\n\tat org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:166)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:322)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:297)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:100)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:67)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:43)\r\n\tat org.apache.derbyTesting.junit.TestConfiguration.openDefaultConnection(TestConfiguration.java:1633)\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestSetup.getConnection(BaseJDBCTestSetup.java:72)\r\n\tat org.apache.derbyTesting.junit.CleanDatabaseTestSetup.setUp(CleanDatabaseTestSetup.java:104)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:18)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\nCaused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: 08006, SQLERRMC: org.apache.derby.jdbc.EmbeddedDriver is not registered with the JDBC driver manager\r\n\tat org.apache.derby.client.am.Connection.completeSqlca(Connection.java:2125)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(NetConnectionReply.java:538)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:431)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:294)\r\n\tat org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:121)\r\n\tat org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:826)\r\n\tat org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:762)\r\n\tat org.apache.derby.client.net.NetConnection.flowUSRIDPWDconnect(NetConnection.java:591)\r\n\tat org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:406)\r\n\tat org.apache.derby.client.net.NetConnection.<init>(NetConnection.java:220)\r\n\tat org.apache.derby.client.net.NetConnection40.<init>(NetConnection40.java:74)\r\n\tat org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:269)\r\n\tat org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:157)\r\n\t... 43 more\r\nThere was 1 failure:\r\n1) LobLimitsTestjunit.framework.ComparisonFailure: Engine shutdown expected:<XJ015> but was:<08001>\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:790)\r\n\tat org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1751)\r\n\tat org.apache.derbyTesting.junit.SystemPropertyTestSetup.tearDown(SystemPropertyTestSetup.java:108)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:20)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\nCaused by: java.sql.SQLException: No suitable driver\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:330)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:297)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.getConnectionByAttributes(DriverManagerConnector.java:163)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.shutEngine(DriverManagerConnector.java:140)\r\n\tat org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1748)\r\n\t... 31 more\r\n\r\nFAILURES!!!\r\nTests run: 11,  Failures: 1,  Errors: 2\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35414","summary":"Getting NPE when trying to set derby.language.logStatementText property to true inside a junit suite.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10102","value":"Patch Available","id":"10102"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":21,"total":21,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13232800","id":"13232800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"The NPE seems to happen after the last fixture of the previous suite is finished and we are starting the new suite.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-03-19T18:27:13.959+0000","updated":"2012-03-19T18:27:13.959+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13232902","id":"13232902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Just glancing at the code, I wonder if you have gotten into a situation where the SystemPropertyTest decorator instance is somehow getting run twice.  It may be related to the order of decorators.  I am curious though what happens if you comment out this line:\r\n   // newValues = null;\r\n\r\nIn the tearDown() method of SystemPropertyTestSetup.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-03-19T21:02:03.311+0000","updated":"2012-03-19T21:02:03.311+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13239106","id":"13239106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey, I made the code change suggested by you but it still results into NPE. \r\n\r\nI looked at the line of the code(SystemPropertyTestSetup.tearDown()) where NPE is coming and it is as follows\r\n       \t\tif (oldValues.getProperty(key) == null)\r\n\r\noldValues is null which results into NPE. This happens because I think we have set oldValues = null; during the previous instance of the decorator. \r\n\r\nI am going to change oldValues = null; to oldValues = new Properties(); and see how that goes(I will leave the comment around newValues = null; )\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-03-27T01:36:29.694+0000","updated":"2012-03-27T01:36:29.694+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13239111","id":"13239111","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I ran large data suite with following changes in SystemPropertyTestSetup.tearDown()\r\n--- java/testing/org/apache/derbyTesting/junit/SystemPropertyTestSetup.java    (revision 1305533)\r\n+++ java/testing/org/apache/derbyTesting/junit/SystemPropertyTestSetup.java    (working copy)\r\n@@ -106,8 +106,8 @@\r\n        // shutdown engine to restore any static properties\r\n        if (staticProperties)\r\n                TestConfiguration.getCurrent().shutdownEngine();\r\n-        newValues = null;\r\n-        oldValues = null;\r\n+//        newValues = null;\r\n+        oldValues = new Properties();\r\n     }\r\n\r\nI don't get NPE anymore but I still get following failure/error while running large data suite with SystemPropertyTestSetup \r\n1) LobLimitsTestjava.sql.SQLNonTransientConnectionException: DERBY SQL error: SQLCODE: -1, SQLSTATE: 08006, SQLERRMC: org.apache.derby.jdbc.EmbeddedDriver is not registered with the JDBC driver manager\r\n\tat org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\r\n\tat org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:364)\r\n\tat org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:166)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:322)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:297)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:100)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:67)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:43)\r\n\tat org.apache.derbyTesting.junit.TestConfiguration.openDefaultConnection(TestConfiguration.java:1633)\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestSetup.getConnection(BaseJDBCTestSetup.java:72)\r\n\tat org.apache.derbyTesting.junit.CleanDatabaseTestSetup.setUp(CleanDatabaseTestSetup.java:104)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:18)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\nCaused by: org.apache.derby.client.am.SqlException: DERBY SQL error: SQLCODE: -1, SQLSTATE: 08006, SQLERRMC: org.apache.derby.jdbc.EmbeddedDriver is not registered with the JDBC driver manager\r\n\tat org.apache.derby.client.am.Connection.completeSqlca(Connection.java:2125)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseRdbAccessFailed(NetConnectionReply.java:538)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseAccessRdbError(NetConnectionReply.java:431)\r\n\tat org.apache.derby.client.net.NetConnectionReply.parseACCRDBreply(NetConnectionReply.java:294)\r\n\tat org.apache.derby.client.net.NetConnectionReply.readAccessDatabase(NetConnectionReply.java:121)\r\n\tat org.apache.derby.client.net.NetConnection.readSecurityCheckAndAccessRdb(NetConnection.java:826)\r\n\tat org.apache.derby.client.net.NetConnection.flowSecurityCheckAndAccessRdb(NetConnection.java:762)\r\n\tat org.apache.derby.client.net.NetConnection.flowUSRIDPWDconnect(NetConnection.java:591)\r\n\tat org.apache.derby.client.net.NetConnection.flowConnect(NetConnection.java:406)\r\n\tat org.apache.derby.client.net.NetConnection.<init>(NetConnection.java:220)\r\n\tat org.apache.derby.client.net.NetConnection40.<init>(NetConnection40.java:74)\r\n\tat org.apache.derby.client.net.ClientJDBCObjectFactoryImpl40.newNetConnection(ClientJDBCObjectFactoryImpl40.java:269)\r\n\tat org.apache.derby.jdbc.ClientDriver.connect(ClientDriver.java:157)\r\n\t... 36 more\r\nThere was 1 failure:\r\n1) LobLimitsTestjunit.framework.ComparisonFailure: Engine shutdown expected:<XJ015> but was:<08001>\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:790)\r\n\tat org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1751)\r\n\tat org.apache.derbyTesting.junit.SystemPropertyTestSetup.tearDown(SystemPropertyTestSetup.java:108)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:20)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:23)\r\nCaused by: java.sql.SQLException: No suitable driver\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:330)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:297)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.getConnectionByAttributes(DriverManagerConnector.java:163)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.shutEngine(DriverManagerConnector.java:140)\r\n\tat org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1748)\r\n\t... 24 more\r\n\r\nFAILURES!!!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-03-27T01:43:41.279+0000","updated":"2012-03-27T01:43:41.279+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13240659","id":"13240659","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I found that I was using SystemPropertyTestSetup decorator such that it would shutdown the engine before setting the passed properties. I do not need the engine to be shutdown and hence changed the invocation of SystemPropertyTestSetup from \r\nsuite = new SystemPropertyTestSetup(suite,sysprops,true);\r\nto \r\nsuite = new SystemPropertyTestSetup(suite,sysprops);\r\n\r\nAfter this change, I do not get following failure\r\nLobLimitsTestjunit.framework.ComparisonFailure: Engine shutdown expected:<XJ015> but was:<08001> \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-03-28T19:37:14.116+0000","updated":"2012-03-28T19:37:14.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13240696","id":"13240696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Attaching patch DERBY5663_patch2.txt for this issue. The patch touches following 2 files.\r\n$ svn stat -q\r\nM       java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\largedata\\LobLimitsTest.java\r\nM       java\\testing\\org\\apache\\derbyTesting\\junit\\SystemPropertyTestSetup.java\r\n\r\nChanges in LobLimitsTest.java now adds properties related to lock timeouts. In case the test ran into lock timeouts as noted by DERBY-5368, we should have relevant information in derby.log to debug the problem.\r\n\r\nChanges in SystemPropertyTestSetup.java. \r\nTwo of the variables defined in this class are\r\n\tprotected Properties newValues;\r\n\tprivate Properties oldValues;\r\nnewValues are the new properties requested by the junit suite through the SystemPropertyTestSetup decorator. These values become effective in SystemPropertyTestSetup.setUp() method.\r\noldValues are the original properties which we want to revert back to at the time of teardown of this decorator. \r\n\r\nIn trunk, both oldValues and newValues get set to null at the end of the tearDown which causes two problems\r\n1)npe in following piece of code in SystemPropertyTestSetup.tearDown()\r\n       \t\tif (oldValues.getProperty(key) == null)\r\nSolution to npe is that rather than nulling oldValues, we should initialize it to empty properties object(similar to what happens in the decorator constructor). To fix npe, in SystemPropertyTestSetup.tearDown(), I have replaced\r\n        oldValues = null;\r\nwith\r\n        oldValues = new Properties();\r\n2)new properties not getting reused when the same decorator instance is used for another suite. It is possible to use the same instance of SystemPropertyTestSetup for multiple runs of a suite. \r\nLobLimitsTest in the patch uses SystemPropertyTestSetup decorator to set locking related properties as shown below(attached patch shows these changes to LobLimitsTest)\r\n    static Test baseSuite(final int biggestSize, final int bigSize) {\r\n    \t//Run the suite with following properties in case we run into lock\r\n    \t// time out issues. It will help debug the problem if timeouts occur.\r\n        Properties sysprops = new Properties();\r\n        sysprops.setProperty(\"derby.locks.deadlockTrace\", \"true\");\r\n        sysprops.setProperty(\"derby.locks.monitor\", \"true\");\r\n        // Some of the test cases depend on certain other test cases to run\r\n        // first, so force the test cases to run in lexicographical order.\r\n        Test suite = new CleanDatabaseTestSetup(\r\n                TestConfiguration.orderedSuite(LobLimitsTest.class)) {\r\n            protected void decorateSQL(Statement s)\r\n                           throws SQLException {\r\n                setupTables(s, biggestSize, bigSize);\r\n            }\r\n        };\r\n        suite = new SystemPropertyTestSetup(suite,sysprops);//,true);\r\n\r\n        return new SupportFilesSetup(suite);\r\n    }\r\n\r\nNext, LobLimitsTest gets called by tests.largedata._Suite 4 times, one time each for different large object sizes and for embedded and network server runs. Nulling of newValues in SystemPropertyTestSetup.tearDown causes the subsequent use of SystemPropertyTestSetup instance to loose the properties requested by LobLimitsTest. In order to fix this, we should not null the newValues properties in SystemPropertyTestSetup.tearDown()\r\n\r\nI will run the entire junit suite one time to make sure nothing has broken as a result of these changes. Thanks\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-03-28T20:25:40.138+0000","updated":"2012-03-28T20:25:40.138+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13240748","id":"13240748","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I'm not so comfortable with the suggested changes in SystemPropertyTestSetup, as they look more like a workaround for a bug than a fix for the root cause. The changes will prevent freeing the contents of newValues for all tests that use SystemPropertyTestSetup, which will probably increase the memory requirements for suites.All.\r\n\r\nDid you get any closer to finding out why it would end up running setUp() after tearDown()?\r\n\r\nI didn't quite get the part about largedata._Suite calling LobLimitTest four times, and that tearDown() in one test would null out the references for the next test. There should be one instance of SystemPropertyTestSetup per instance of LobLimitTest, and one instance of SystemPropertyTestSetup should not null out the fields in another instance, or am I misunderstanding?\r\n\r\n[comment edited: added missing not in the last sentence]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-03-28T21:27:28.654+0000","updated":"2012-03-28T21:35:46.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13241347","id":"13241347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Hi Knut, first of all, thanks for looking at this jira. \r\n\r\nI am debugging further to get the exact details as to why setUp() is getting called after tearDown() but I believe it is because the same instance of SystemPropertyTestSetup is getting twice.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-03-29T16:11:27.914+0000","updated":"2012-03-29T16:11:27.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13241927","id":"13241927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Let me start first by just going over the large data suite at the top level.\r\n\r\ntests.largedata._Suite has following\r\n    public static Test suite() {\r\n        TestSuite suite = new TestSuite(\"largedata suite\");\r\n\r\n        // DERBY-5624, currently this runs out of file descriptors on unix\r\n        // systems with 1024 limit per user.  Setting to run only on windows\r\n        // until solution for unix is found.\r\n        if (isWindowsPlatform())\r\n            suite.addTest(Derby5624Test.suite());\r\n\r\n        suite.addTest(LobLimitsLiteTest.suite());\r\n        suite.addTest(LobLimitsTest.suite());\r\n        suite.addTest(LobLimitsClientTest.suite());\r\n        return suite;\r\n    }\r\n\r\nFor the sake of this jira, we can ignore Derby5624Test.suite since this suite has test fixture of it's own.\r\n\r\nThe next three suites are \r\n1)LobLimitsLiteTest\r\n2)LobLimitsTest and\r\n3)LobLimitsClientTest\r\n\r\nAll of the three suites above end up calling tests.LobLimitsTest suite.\r\n\r\nLobLimitsLiteTest specifically calls LobLimitsTest suite twice(once for embedded and once for network server) as shown below\r\nThe suite() method in LobLimitsLiteTest is as follows\r\n    public static Test suite() {\r\n        Test test = LobLimitsTest.baseSuite(_1MB, _100K);\r\n        TestSuite suite = new TestSuite(\"LobLimitsLiteTest\");\r\n        suite.addTest(test);\r\n        suite.addTest(TestConfiguration.clientServerDecorator(test));\r\n        return suite;\r\n        \r\n    }\r\n\r\nAs we can see, we create only one instance of LobLimitesTest suite and run that once in embedded and next in client server mode. Since we are using the same instance of LobLimitesTest suite twice, in turn we are using the same SystemPropertyTestSetup instance twice. \r\n\r\nAs for the next 2 suites in tests.largedata._Suite(namely LobLimitsTest and LobLimitsClientTest), they create their own LobLimitsTest suite and hence there is no reuse of the same instance of SystemPropertyTestSetup.\r\n\r\nI verified this by putting println in SystemPropertyTestSetup's constructor and found that the println gets printed only 3 times(rather than 4 times which is how many times the LobLimitesTest suite is invoked). \r\n\t\tSystem.out.println(\"in constructor \" + hashCode());\r\nI also put a println in SystemPropertyTestSetup.setUP() and see that it got called 4 times. But 2 of those 4 times printed the same hashCode() indicating we are dealing with the same instance of SystemPropertyTestSetup.\r\n\t\tSystem.out.println(\"in setUp \" + hashCode());\r\n\r\nI modified LobLimitsLiteTest.suite() just for testing purposes to create a new suite LobLimitsLiteTest for client server run and after that change, I see the SystemPropertyTestSetup's constructor getting called 4 times. With this temporary change in my codeline with each lob limits test using it's own instance, it doesn't matter if we null out oldValue and newValues in SystemPropertyTestSetup.tearDown() method since there is no resue of the same instance of SystemPropertyTestSetup\r\n    public static Test suite() {\r\n        Test test = LobLimitsTest.baseSuite(_1MB, _100K);\r\n        TestSuite suite = new TestSuite(\"LobLimitsLiteTest\");\r\n        suite.addTest(test);\r\n        Test test1 = LobLimitsTest.baseSuite(_1MB, _100K);\r\n        suite.addTest(TestConfiguration.clientServerDecorator(test1));\r\n        return suite;\r\n        \r\n    }\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-03-29T23:32:06.031+0000","updated":"2012-03-29T23:32:06.031+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13242440","id":"13242440","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks Mamta for explaining why the instance is used more than once.  I think from a practical perspective it is good to have it work both ways.\r\n\r\nLooking at SystemPropertyTestSetup, I think your change to remove the line setting newValues to null and inititializing odValues to new Properties() will work.  This will leave the instance in the correct state for the second iteration as the initialization where newValues has the new values that we want and oldValues is empty and ready to be populated when setProperties() is called by setup(). \r\n\r\nPerhaps a more intuitive fix would be to move the initialization of oldValues to setup() rather than the constructor  or tearDown() and add a comment there with the bug number, indicating oldValues needs to be initialized for each iteration if the instance is reused. \r\n\r\nThanks for fixing this up!\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-03-30T15:31:40.508+0000","updated":"2012-03-30T15:31:40.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13243875","id":"13243875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for that explanation, Mamta. I agree with Kathey that it would be more intuitive to move the initialization to setUp(), and that would allow us to continue nulling out newValues and oldValues in tearDown() in order to free up memory when the test is done. Note that DatabasePropertyTestSetup uses the same pattern as SystemPropertyTestSetup and would probably need to be changed too, if we think reuse of tests/decorators is OK.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-04-01T21:50:44.332+0000","updated":"2012-04-01T21:50:44.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13245422","id":"13245422","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey and Knut, thanks for looking at the patch.\r\n\r\n1)I will remove nulling out of oldValues and nullValues from tearDown(). \r\n2)I will also remove the intialization of oldValues to new Properties object from the constructor and move it to setUp(). \r\n\r\nKnut, we do not want to null newValues in tearDown because that will make us loose the new properties requested by the user when the same instance of SystemPropertyTestSetup gets used again. \r\n\r\nI will run the tests with all these changes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-04-03T15:46:51.471+0000","updated":"2012-04-03T15:46:51.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13447921","id":"13447921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"The changes went in as revision 1309244","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-09-04T18:42:51.976+0000","updated":"2012-09-04T18:42:51.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13453373","id":"13453373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Reopen for backport analysis. Temporarily assign to yourself if you backport and then reassign to Mamta before closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-09-11T20:27:17.634+0000","updated":"2012-09-11T20:27:17.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13456198","id":"13456198","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I will look at backporting this","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-09-14T22:25:09.815+0000","updated":"2012-09-14T22:25:09.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13457117","id":"13457117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Backported into 10.8.2.3 with revision 1386677","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-09-17T16:15:23.989+0000","updated":"2012-09-17T16:15:23.989+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13457362","id":"13457362","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Backported changes(without the test changes) into 10.7.1.4 with revision 1386854. The test changed(largedata/LobLimitsTest.java) does not exist in 10.7 and earlier releases","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-09-17T21:36:15.161+0000","updated":"2012-09-17T21:36:15.161+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13457549","id":"13457549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Backported changes(without the test changes) into 10.6.2.3 with revision 1386967. The test changed(largedata/LobLimitsTest.java) does not exist in 10.7 and earlier releases ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-09-18T02:14:47.763+0000","updated":"2012-09-18T02:14:47.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13457876","id":"13457876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Backported changes(without the test changes) into 10.5.3.2 with revision 1387211. The test changed(largedata/LobLimitsTest.java) does not exist in 10.7 and earlier releases","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-09-18T15:06:16.443+0000","updated":"2012-09-18T15:06:16.443+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/13457879","id":"13457879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I am not planning on backporting it any further","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-09-18T15:07:27.166+0000","updated":"2012-09-18T15:07:27.166+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12546940/comment/14119601","id":"14119601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-09-03T08:31:35.355+0000","updated":"2014-09-03T08:31:35.355+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5663/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06fb3:"}}