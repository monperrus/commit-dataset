{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12353308","self":"https://issues.apache.org/jira/rest/api/latest/issue/12353308","key":"DERBY-1963","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-01-11 11:21:34.269","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22817","customfield_12310222":"3_*:*_1_*:*_209825102_*|*_1_*:*_1_*:*_125902915351_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-10-15T08:03:56.453+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1963/watchers","watchCount":1,"isWatching":false},"created":"2006-10-16T16:44:56.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:19:41.118+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11414","id":"11414","name":"Tools"}],"timeoriginalestimate":null,"description":"After using this SQL to create a function with a delimited parameter name\r\n\r\nCREATE FUNCTION FRED (\"paramOne\" INTEGER) RETURNS INTEGER\r\nLANGUAGE JAVA PARAMETER STYLE JAVA \r\nEXTERNAL NAME 'fred.foo' \r\n\r\ndblook will output a CREATE FUNCTION statement with the parameter name without quotes:\r\n\r\nCREATE FUNCTION \"APP\".\"FRED\" (paramOne INTEGER) RETURNS INTEGER\r\nLANGUAGE JAVA PARAMETER STYLE JAVA\r\nREADS SQL DATA CALLED ON NULL INPUT\r\nEXTERNAL NAME 'fred.foo';\r\n\r\nUsing the output from dblook to re-create the function will result in a function with a different parameter name.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37859","summary":"Routine parameter names displayed by dblook are not escaped.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10423","value":"Newcomer","id":"10423"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353308/comment/12463865","id":"12463865","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sv204098","name":"sv204098","emailAddress":"vyassaurabh1 at rediffmai dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saurabh Vyas","active":true},"body":"I tried reproducing this, but while using the dblook output to create the function again, I got this error \"ERROR X0Y68: FUNCTION 'FRED' already exists.\"\r\nDid I missed any step.\r\n\r\nComments/Suggestions ?\r\n\r\nFollowing are the steps I tried : \r\n\r\nfierro@~/JavaDB/NewTest$ java org.apache.derby.tools.ij\r\nij version 10.3\r\nij> connect 'jdbc:derby:TestDB;create=true';\r\nij> CREATE FUNCTION FRED (\"paramOne\" INTEGER) RETURNS INTEGER\r\nLANGUAGE JAVA PARAMETER STYLE JAVA\r\nEXTERNAL NAME 'fred.foo' ;\r\n0 rows inserted/updated/deleted\r\nij> exit;\r\nfierro@~/JavaDB/NewTest$ java org.apache.derby.tools.dblook -d 'jdbc:derby:TestDB'\r\n-- Timestamp: 2007-01-11 16:44:49.285\r\n-- Source database is: TestDB\r\n-- Connection URL is: jdbc:derby:TestDB\r\n-- appendLogs: false\r\n\r\n-- ----------------------------------------------\r\n-- DDL Statements for functions\r\n-- ----------------------------------------------\r\n\r\nCREATE FUNCTION \"APP\".\"FRED\" (paramOne INTEGER) RETURNS INTEGER LANGUAGE JAVA PARAMETER STYLE JAVA READS SQL DATA CALLED ON NULL INPUT EXTERNAL NAME 'fred.foo' ;\r\n\r\nfierro@~/JavaDB/NewTest$ java org.apache.derby.tools.ij\r\nij version 10.3\r\nij> connect 'jdbc:derby:TestDB';\r\nij> CREATE FUNCTION \"APP\".\"FRED\" (paramOne INTEGER) RETURNS INTEGER LANGUAGE JAVA PARAMETER STYLE JAVA READS SQL DATA CALLED ON NULL INPUT EXTERNAL NAME 'fred.foo' ;\r\nERROR X0Y68: FUNCTION 'FRED' already exists.\r\nij> exit;","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sv204098","name":"sv204098","emailAddress":"vyassaurabh1 at rediffmai dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saurabh Vyas","active":true},"created":"2007-01-11T11:21:34.269+0000","updated":"2007-01-11T11:21:34.269+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353308/comment/12467217","id":"12467217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"the issue being reported is a problem with the parameter name \"paramOne\"  - not the function name.  The problem will show up if you use a jdbc interface that requires the parameter name rather than a ordernal of the parameter.  Also I assume the metadata will be wrong.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-01-25T01:16:06.835+0000","updated":"2007-01-25T01:16:06.835+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353308/comment/12467602","id":"12467602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Unsetting Fix Version on unassigned issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2007-01-25T20:38:26.374+0000","updated":"2007-01-25T20:38:26.374+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353308/comment/12728671","id":"12728671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Triaged for 10.5.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-07-08T12:49:28.738+0000","updated":"2009-07-08T12:49:28.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353308/comment/12920363","id":"12920363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"dblook uses the ALIASINFO column in SYS.SYSALIASES to produce the parameter list for procedures and functions. I found this comment in RoutineAliasInfo.toString():\r\n\r\n\t/**\r\n\t * Get this alias info as a string.  NOTE: The \"ALIASINFO\" column\r\n\t * in the SYSALIASES table will return the result of this method\r\n\t * on a ResultSet.getString() call.  That said, since the dblook\r\n\t * utility uses ResultSet.getString() to retrieve ALIASINFO and\r\n\t * to generate the DDL, THIS METHOD MUST RETURN A STRING THAT\r\n\t * IS SYNTACTICALLY VALID, or else the DDL generated by dblook\r\n\t * will be incorrect.\r\n\t */\r\n\r\nThat method does however not escape the parameter names, and that's also why dblook doesn't.\r\n\r\nThe attached patch makes RoutineAliasInfo.toString() escape parameter names using IdUtil.normalToDelimited(). It also adds a test case that demonstrates the bug in tools/dblook_test.java. I haven't run any other tests yet, and there will be other tests that need to be updated because of this change (at least all the variants of dblook_test, and there may be tests that check the SYSALIASES table and don't expect the quotes in the ALIASINFO column).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-10-12T21:42:16.407+0000","updated":"2010-10-12T21:42:16.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353308/comment/12920938","id":"12920938","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Here's an updated patch that changes more canons. All the regression tests passed.\r\n\r\nDescription of the patch:\r\n\r\n* RoutineAliasInfo.java: Escape the parameter names.\r\n\r\n* dblook_makeDB.sql: Add a procedure and a function that need escaping. Affects all variants of dblook_test.\r\n\r\n* dblook_test.out, dblook_test_territory.out, DerbyNet/dblook_test_net.out, DerbyNet/dblook_test_net_territory.out, DerbyNetClient/dblook_test_net.out, DerbyNetClient/dblook_test_net_territory.out:\r\nExpect extra output because of the added procedure and function, and expect all parameter names in existing test cases to have double quotes.\r\n\r\n* cast.out: Expect quoted identifiers when selecting ALIASINFO from SYS.SYSALIASES.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-10-14T12:23:12.004+0000","updated":"2010-10-14T12:23:12.004+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353308/comment/13685322","id":"13685322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:41.108+0000","updated":"2013-06-17T09:19:41.108+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1963/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06uef:"}}