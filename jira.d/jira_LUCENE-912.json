{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12370994","self":"https://issues.apache.org/jira/rest/api/latest/issue/12370994","key":"LUCENE-912","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312328","id":"12312328","description":"","name":"2.2","archived":false,"released":true,"releaseDate":"2007-06-19"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2007-06-06 07:29:17.484","customfield_12312323":null,"customfield_12310420":"12830","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_70738975_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_1058036031","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-06-07T02:21:01.975+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-912/watchers","watchCount":1,"isWatching":false},"created":"2007-06-06T06:42:03.084+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310853","id":"12310853","description":"mostly 1.9 with deprecated items removed","name":"2.0.0","archived":false,"released":true,"releaseDate":"2006-05-26"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12310854","id":"12310854","description":"","name":"2.1","archived":false,"released":true,"releaseDate":"2007-02-17"}],"issuelinks":[{"id":"12316342","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12316342","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12371086","key":"LUCENE-913","self":"https://issues.apache.org/jira/rest/api/2/issue/12371086","fields":{"summary":"Two consecutive score() calls return different scores for Boolean Queries.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-06-19T08:14:58.004+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"as reported on the mailing list, DisjunctionMaxScorer.skipTo is broken if called before next in some situations...\n\nhttp://www.nabble.com/Potential-issue-with-DisjunctionMaxScorer-tf3846366.html#a10894987","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10120","value":"Patch Available","id":"10120"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"27135","summary":"DisjunctionMaxScorer.skipTo has bug that keeps it from skipping","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":14,"total":14,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12501821","id":"12501821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"patch with test and fix ... it would be helpful if someone who understands scorers better then i do could take a look at this and make sure there isn't some obvious cases that aren't accounted for in the (existing or new) tests that are still obviously broken","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2007-06-06T06:44:12.629+0000","updated":"2007-06-06T06:44:12.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12501827","id":"12501827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paul.elschot%40xs4all.nl","name":"paul.elschot@xs4all.nl","emailAddress":"paul dot j dot elschot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=paul.elschot%40xs4all.nl&avatarId=23180","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paul.elschot%40xs4all.nl&avatarId=23180","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paul.elschot%40xs4all.nl&avatarId=23180","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paul.elschot%40xs4all.nl&avatarId=23180"},"displayName":"Paul Elschot","active":true},"body":"I'm not sure, but the patch allows to increment all generators right after the first time, and that might cause it to make a mistake in the score computation for its first doc.\r\n\r\nIt might be worthwhile to make DisjunctionMaxScorer use the same specialized queue/heap as DisjunctionSumScorer.\r\nFactoring this out could lead to a common superclass that provides e.g. an array of Scorers that match the disjunction.\r\nAt the same time the score computations of the subscorers could be delayed until an actual score value is needed.\r\nThat is a rather drastic approach, but the specialized queue/heap of DisjunctionSumScorer might also help performance of DisjunctionMaxScorer\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paul.elschot%40xs4all.nl","name":"paul.elschot@xs4all.nl","emailAddress":"paul dot j dot elschot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=paul.elschot%40xs4all.nl&avatarId=23180","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paul.elschot%40xs4all.nl&avatarId=23180","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paul.elschot%40xs4all.nl&avatarId=23180","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paul.elschot%40xs4all.nl&avatarId=23180"},"displayName":"Paul Elschot","active":true},"created":"2007-06-06T07:29:17.484+0000","updated":"2007-06-06T07:29:17.484+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502011","id":"12502011","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"> I'm not sure, but the patch allows to increment all generators right after the first time, and that might cause it to make a mistake in the score computation for its first doc. \r\n\r\nIf all the sub-scorers are on the correct document after skipTo is called (which looks to be the case), then everything should be OK when DisjunctionMaxScorer.score() is called after that (dismax score calculation isn't incremental... it's all done during the call to score()).  Is there an issue I'm not thinking of?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-06-06T18:08:56.123+0000","updated":"2007-06-06T18:08:56.123+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502048","id":"12502048","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"> dismax score calculation isn't incremental... it's all done during the call to score()). \r\n> Is there an issue I'm not thinking of? \r\n\r\nI was wondering why QueryUtils.checkSkipTo() did not expose that. But this is because that check skips doc by doc, always to docs found by the tested query. \r\n\r\nEnhancing that test reveals that for some scorers, two consecutive calls to score() return different scores (no next() or skipTo() calls in between).\r\nThis seems like a bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2007-06-06T19:09:15.141+0000","updated":"2007-06-06T19:09:15.141+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502054","id":"12502054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Yes, two calls to score() should yield the same score.\r\nWhat scorer was broken?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-06-06T19:18:58.808+0000","updated":"2007-06-06T19:18:58.808+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502067","id":"12502067","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"Attached adds to QueryUtils.check(Query q1, Searcher s):\r\n- score() stability test (two calls to score() should return same score)\r\n- first skipTo tests\r\n\r\nThe score() stability tests has failures for BooleanQueries and for DisjunctionMaxQuery.\r\n\r\nI didn't look into the failures cause yet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2007-06-06T20:00:34.536+0000","updated":"2007-06-06T20:00:34.536+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502078","id":"12502078","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"Updating  checkTwoCallsToScore.patch  (unintended comment out in previous file).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2007-06-06T20:18:57.769+0000","updated":"2007-06-06T20:18:57.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502090","id":"12502090","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelbusch","name":"michaelbusch","emailAddress":"buschmic at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Busch","active":true},"body":"In BooleanScorer2.score() the coordinator is initialized: coordinator.initDoc();\r\nThis results in Coordinator.nrMatchers = 0. \r\n\r\nNow look at the statements that change the value of nrMatchers in BooleanScorer.\r\nThere are three of those. E. g. in countingDisjunctionSumScorer:\r\n        if (this.doc() > lastScoredDoc) {\r\n          lastScoredDoc = this.doc();\r\n          coordinator.nrMatchers += super.nrMatchers;\r\n        }\r\n\t\t\r\nnrMatchers is only increased in case this.doc() is greater than lastScoredDoc.\r\nBut if score() is called twice, than those values are equal. So we have to\r\nfix the if statement to \r\n        if (this.doc() >= lastScoredDoc) {\r\n\r\nWith this patch and dismax_skipto.patch now all tests pass (including your\r\nnew ones, Doron).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelbusch","name":"michaelbusch","emailAddress":"buschmic at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Busch","active":true},"created":"2007-06-06T20:48:13.184+0000","updated":"2007-06-06T20:48:13.184+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502111","id":"12502111","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"This would recompute, but correctly. \r\nIf this fix is just for sanity, ie main search methods really call score() just once, then I guess this is good enough.\r\nI was thinking more on not recomputing score if it was already computed (for current doc).\r\n(That would require to also maintain the last score returned.)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2007-06-06T21:19:28.354+0000","updated":"2007-06-06T21:19:28.354+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502120","id":"12502120","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelbusch","name":"michaelbusch","emailAddress":"buschmic at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Busch","active":true},"body":"Yes I agree. Keeping the score in BooleanScorer until next() or skipTo() is \r\ncalled is a good optimization to avoid recomputation. I guess I was just \r\ncurios about the reasons why the tests failed. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelbusch","name":"michaelbusch","emailAddress":"buschmic at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Busch","active":true},"created":"2007-06-06T21:31:54.881+0000","updated":"2007-06-06T21:31:54.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502121","id":"12502121","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"Actually I changed my mind....  (and saw your reply just before clicking \"Add\" on this comment): \r\n  Taking back my last comment - with Michael's fix there are no extra cycles in the expected use of score().\r\n  If we try to avoid re-computation in case score() is called twice for same doc, there would be an additional if() for every call to score().\r\n\r\nI think I will take it from here to a new issue and handle these two separately.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2007-06-06T21:38:27.735+0000","updated":"2007-06-06T21:38:27.735+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502170","id":"12502170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"Committed the original lucene-912.patch by Hoss. \r\nThanks Hoss and Sudaakeran B. !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2007-06-07T02:21:01.875+0000","updated":"2007-06-07T02:21:01.875+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502704","id":"12502704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paul.elschot%40xs4all.nl","name":"paul.elschot@xs4all.nl","emailAddress":"paul dot j dot elschot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=paul.elschot%40xs4all.nl&avatarId=23180","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paul.elschot%40xs4all.nl&avatarId=23180","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paul.elschot%40xs4all.nl&avatarId=23180","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paul.elschot%40xs4all.nl&avatarId=23180"},"displayName":"Paul Elschot","active":true},"body":"> > I'm not sure, but the patch allows to increment all generators right after the first time, and that might cause it to make a mistake in the score computation for its first doc.\r\n\r\nThis is from code inspection only, I have no test cases showing wrong behaviour:\r\nWhat I meant is that during DisjunctionMaxScorer.next() initially the subscorers have next() called on them, so they are at their first docs, and then during next() (with the return statement deleted) the \"generators are incremented again\" even when at firstTime. That means that the score() might be computed on the wrong subscorer docs after the first call to next().\r\n\r\nBut this issue is about DisjunctionMaxScorer.skipTo(), and removing the firstTime return statement there is correct I think.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paul.elschot%40xs4all.nl","name":"paul.elschot@xs4all.nl","emailAddress":"paul dot j dot elschot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=paul.elschot%40xs4all.nl&avatarId=23180","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paul.elschot%40xs4all.nl&avatarId=23180","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paul.elschot%40xs4all.nl&avatarId=23180","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paul.elschot%40xs4all.nl&avatarId=23180"},"displayName":"Paul Elschot","active":true},"created":"2007-06-08T07:10:21.180+0000","updated":"2007-06-08T07:10:21.180+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12370994/comment/12502854","id":"12502854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"I think you're right, and actually wondered about the same thing while verifying that fix: \"why return in next() but not in skipTo()?\" - I believe this is the right thing to do because at the initialization (ie in add(Scorer)) each added sub-scorer is advanced to its first match. So the first time that next() is called, sub-scorers are already \"on the right spot\", and not so for the first time skipTo() is called, because skipTo does not necessarily goes to the first match.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2007-06-08T16:02:49.213+0000","updated":"2007-06-08T16:02:49.213+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-912/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0508f:"}}