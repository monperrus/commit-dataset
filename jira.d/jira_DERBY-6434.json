{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12684343","self":"https://issues.apache.org/jira/rest/api/latest/issue/12684343","key":"DERBY-6434","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324243","id":"12324243","description":"First release on the 10.11 branch","name":"10.11.1.1","archived":false,"released":true,"releaseDate":"2014-08-26"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2014-01-02 22:09:09.883","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"363415","customfield_12310222":"1_*:*_1_*:*_3008621104_*|*_5_*:*_2_*:*_3970778394_*|*_4_*:*_1_*:*_7602323522","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-05-30T14:54:42.545+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6434/watchers","watchCount":4,"isWatching":false},"created":"2013-12-12T20:25:59.573+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_backport_reject_10_10"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324243","id":"12324243","description":"First release on the 10.11 branch","name":"10.11.1.1","archived":false,"released":true,"releaseDate":"2014-08-26"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12379903","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379903","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12684313","key":"DERBY-6431","self":"https://issues.apache.org/jira/rest/api/2/issue/12684313","fields":{"summary":"Update Developer's Guide topic to include generated columns","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}},{"id":"12379902","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379902","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12683643","key":"DERBY-6429","self":"https://issues.apache.org/jira/rest/api/2/issue/12683643","fields":{"summary":"Privilege checks for UPDATE statements are wrong.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12379904","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379904","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12684332","key":"DERBY-6432","self":"https://issues.apache.org/jira/rest/api/2/issue/12684332","fields":{"summary":"INSERT/UPDATE incorrectly require user to have privilege to execute CHECK constraints on the target table.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12379905","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379905","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12684337","key":"DERBY-6433","self":"https://issues.apache.org/jira/rest/api/2/issue/12684337","fields":{"summary":"INSERT/UPDATE incorrectly require user to have privilege to run generation expressions.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12380784","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12380784","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12687869","key":"DERBY-6449","self":"https://issues.apache.org/jira/rest/api/2/issue/12687869","fields":{"summary":"Analyze and possibly correct the suspicious addition of in-memory dependencies during statement execution","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}},{"id":"12383601","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12383601","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12695601","key":"DERBY-6481","self":"https://issues.apache.org/jira/rest/api/2/issue/12695601","fields":{"summary":"Derby 10.10 backport issue (winter/spring 2014)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-01-21T00:23:36.474+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"This issue is a place to address problems with INSERT and DELETE statements similar to the problems affecting UPDATE statements recorded on DERBY-6429. In particular, DERBY-6432 and DERBY-6433 list some of the problems with INSERT statements.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10367","value":"Deviation from standard","id":"10367"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"363721","summary":"Incorrect privileges may be required for INSERT and DELETE statements.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":21,"total":21,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13860254","id":"13860254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The discussion on DERBY-6429 concluded that constraints, generated columns, and triggers do not impose any privilege burdens on INSERT/UPDATE/DELETE/MERGE statements. The privilege burdens related to constraints, generated columns, and triggers are satisfied at DDL time.\r\n\r\nAs a result, I would state the privilege requirements for INSERT statements as follows. Let P be the union of the privileges granted to the current user and the privileges granted to the current role.\r\n\r\n1) P must contain INSERT privilege for the target table.\r\n\r\n2) P must contain all privileges needed to evaluate the query expression in the INSERT statement. These privileges include:\r\n\r\na) SELECT privilege on all columns mentioned in the query expression.\r\n\r\nb) EXECUTE privilege on all functions mentioned in the query expression.\r\n\r\nc) USAGE privilege on all types, sequences, and aggregates mentioned in the query expression.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-02T15:14:16.454+0000","updated":"2014-01-02T15:14:16.454+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13860649","id":"13860649","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6434-01-aa-correctInsertPrivs.diff. This patch corrects privilege checking for INSERT statements. I will run the full tests to shake out additional problems.\r\n\r\nThe patch introduces a new VisitableFilter, which essentially short-circuits the addition of more permissions checks. The filter is applied after the INSERT's query source has been bound but before constraints, triggers, and generation expressions are attached.\r\n\r\n\r\n\r\nTouches the following files:\r\n\r\n-----------------\r\n\r\nA       java/engine/org/apache/derby/iapi/sql/compile/IgnoreFilter.java\r\n\r\nThe new, short-circuiting filter.\r\n\r\n-----------------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/InsertNode.java\r\n\r\nUse the short-circuiting filter after binding the query expression.\r\n\r\n-----------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GrantRevokeDDLTest.java\r\n\r\nNew tests.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-02T19:38:16.474+0000","updated":"2014-01-02T19:38:16.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13860855","id":"13860855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I guess P should include privileges granted to PUBLIC as well. Can the functions mentioned in the query contain SQL? If so, the set of privileges P should include any privileges required by any nested connections *if* the functions are declared to run by invoker's rights.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2014-01-02T22:09:09.883+0000","updated":"2014-01-02T22:09:09.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13861479","id":"13861479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for those clarifications, Dag.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-03T12:53:39.641+0000","updated":"2014-01-03T12:53:39.641+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13865477","id":"13865477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6434-01-ac-correctInsertPrivs.diff. This rev corrects some additional problems which surfaced when I ran the full regression tests on the previous rev of the patch. I will re-run the regression tests now.\r\n\r\nThis rev corrects two problems:\r\n\r\n1) A canonized wrong result in GeneratedColumnsPermsTest. There was a comment left over from work on DERBY-6429, noting that this wrong result would need to be addressed when INSERT privileges were corrected.\r\n\r\n2) A test case in RolesConferredPrivilegesTest broke because the previous rev altered the dependency checking for CHECK constraints which rely on role-based privileges.\r\n\r\nThe fix for 2 is simple but it was tricky to find. I had expected that all dependencies would be identified at bind() time. So I was surprised to find that some in-memory dependencies are added by the execute() phase of statement evaluation. This looks wrong to me. In a private discussion with Dag, we theorized that the execute() time additions are a holdover from how the code behaved before we added support for definer's rights.\r\n\r\nThe fix for 2 is to make ConstraintDescriptor.makeInvalid() call DependencyManager.invalidateFor() on the table descriptor after the CHECK constraint is implicitly dropped as a consequence of revoking a privilege. This forces Derby to take the same code path pursued when the CHECK constraint is explicitly dropped.\r\n\r\nI am highly suspicious of the many calls to DependencyManager.addDependency() which we see in the execute() time ConstantActions. Analyzing these suspicious calls is outside the scope of this JIRA. I will file a follow-on issue for this investigation.\r\n\r\n\r\nTouches the following additional files:\r\n\r\n------------------\r\n\r\nM       java/engine/org/apache/derby/iapi/sql/dictionary/ConstraintDescriptor.java\r\n\r\nThe fix for item 2.\r\n\r\n------------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsPermsTest.java\r\n\r\nThe fix for item 1.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-08T14:30:25.502+0000","updated":"2014-01-08T14:30:25.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13865602","id":"13865602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1556571 from [~rhillegas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1556571 ]\r\n\r\nDERBY-6434: Correct privileges required for INSERT statements; tests passed cleanly on derby-6434-01-ac-correctInsertPrivs.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-01-08T16:35:29.579+0000","updated":"2014-01-08T16:35:29.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13870861","id":"13870861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6434-02-ac-correctDeletePrivs.diff. This patch corrects privilege checking for DELETE statements. I will run regression tests. It's likely that the tests will disclose some problems.\r\n\r\nThe approach here is to add privilege checks only when compiling the WHERE clause of the DELETE statement. To accomplish this, the patch introduces two new concepts:\r\n\r\n1) Scope tracking - The compiler is given the capability to track what kind of clause it is processing. Currently, the compiler can analyze what's going on inside nodes BELOW the current node. This patch adds the capability to track what's going on ABOVE the current node. The patch gives the compiler the ability to record when it enters and leaves a particular scope. The patch adds the following new methods to CompilerContext:\r\n\r\n{noformat}\r\n    /**\r\n     * Record that the compiler is entering a named scope. Increment the\r\n     * depth counter for that scope.\r\n     */\r\n    public  void    beginScope( String scopeName );\r\n    \r\n    /**\r\n     * Record that the compiler is exiting a named scope. Decrement the\r\n     * depth counter for that scope.\r\n     */\r\n    public  void    endScope( String scopeName );\r\n\r\n    /**\r\n     * Get the current depth for the named scope. For instance, if\r\n     * we are processing a WHERE clause inside a subquery which is\r\n     * invoked inside an outer WHERE clause, the depth of the whereScope\r\n     * would be 2. Returns 0 if the compiler isn't inside any such scope.\r\n     */\r\n    public  int     scopeDepth( String scopeName );\r\n{noformat}\r\n\r\n2) Scope filtering - A new VisitableFilter is added: ScopeFilter. This filter passes nodes only if the compiler is operating within a named scope.\r\n\r\nI think that we may be able to use this general scope tracking to eliminate the more limited scope tracking implemented by the following CompilerContext methods...\r\n\r\n{noformat}\r\n    int getReliability();\r\n    void setReliability(int reliability);\r\n{noformat}\r\n\r\n...but that improvement falls outside the boundaries of this JIRA.\r\n\r\nIn addition, I think that scope tracking can be used by other AST Visitors which need to be aware of how nodes nest. In particular, scope tracking may be useful for the work described in this derby-user email thread: http://apache-database.10148.n7.nabble.com/Using-ASTParser-and-TreeWalker-for-parsing-SQL-query-td131219.html#a131629\r\n\r\n\r\nTouches the following files:\r\n\r\n------------------\r\n\r\nM       java/engine/org/apache/derby/iapi/sql/compile/CompilerContext.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/CompilerContextImpl.java\r\n\r\nIntroduces scope tracking.\r\n\r\n------------------\r\n\r\nA       java/engine/org/apache/derby/iapi/sql/compile/ScopeFilter.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/SelectNode.java\r\n\r\nIntroduces scope filtering and uses it to mark the boundaries of WHERE clauses.\r\n\r\n------------------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/DeleteNode.java\r\n\r\nUses scopes to restrict privilege checks to WHERE clauses.\r\n\r\n------------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GrantRevokeDDLTest.java\r\n\r\nRegression tests for DELETE privileges.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-14T16:25:35.137+0000","updated":"2014-01-14T16:25:35.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13871367","id":"13871367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Tests passed cleanly for me on derby-6434-02-ac-correctDeletePrivs.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-14T23:30:07.163+0000","updated":"2014-01-14T23:30:07.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13872091","id":"13872091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1558387 from [~rhillegas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1558387 ]\r\n\r\nDERBY-6434: Correct privilege checks for DELETE statements; commit derby-6434-02-ac-correctDeletePrivs.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-01-15T14:03:51.764+0000","updated":"2014-01-15T14:03:51.764+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13872133","id":"13872133","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6434-03-ac-testCaseForDerby-6432.diff, a test case verifying that DERBY-6432 has been fixed.\r\n\r\nTouches the following file:\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GrantRevokeDDLTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-15T14:41:12.655+0000","updated":"2014-01-15T14:41:12.655+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13872134","id":"13872134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1558398 from [~rhillegas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1558398 ]\r\n\r\nDERBY-6434: Test case verifying that DERBY-6432 has been fixed; commit derby-6434-03-ac-testCaseForDerby-6432.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-01-15T14:42:16.331+0000","updated":"2014-01-15T14:42:16.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13872389","id":"13872389","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6434-04-aa-dontNeedPrivOnGeneratedColumnTypeForInsert.diff. This corrects INSERT privileges so that you no longer need USAGE privilege on the types of generated columns. I will run regression tests.\r\n\r\nThis fixes the remaining problem described by DERBY-6433.\r\n\r\nTouches the following files:\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/InsertNode.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GrantRevokeDDLTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-15T18:31:52.136+0000","updated":"2014-01-15T18:31:52.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13872553","id":"13872553","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1558559 from [~rhillegas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1558559 ]\r\n\r\nDERBY-6434: Don't make INSERT statements require USAGE privilege on the datatypes of generated columns; fix remaining problem described by DERBY-6433; commit derby-6434-04-aa-dontNeedPrivOnGeneratedColumnTypeForInsert.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-01-15T20:26:06.611+0000","updated":"2014-01-15T20:26:06.611+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13873534","id":"13873534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a first draft of the release note for this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-16T16:05:24.127+0000","updated":"2014-01-16T16:05:24.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13873543","id":"13873543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I believe that I am done with work on this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-16T16:09:40.668+0000","updated":"2014-01-16T16:09:40.668+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13913278","id":"13913278","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"consider for 10.10 backport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2014-02-26T18:30:42.919+0000","updated":"2014-02-26T18:30:42.919+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13918130","id":"13918130","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The work on DERBY-6491 has uncovered another case where INSERTs are requiring overbroad privileges. USAGE privilege is incorrectly required on the user-defined type of a target table column. The following script shows this problem:\r\n\r\n{noformat}\r\nconnect 'jdbc:derby:memory:db;user=test_dbo;create=true';\r\n\r\ncall syscs_util.syscs_create_user( 'TEST_DBO', 'test_dbopassword' );\r\ncall syscs_util.syscs_create_user( 'RUTH', 'ruthpassword' );\r\n\r\nconnect 'jdbc:derby:memory:db;shutdown=true';\r\n\r\nconnect 'jdbc:derby:memory:db;user=test_dbo;password=test_dbopassword' as dbo;\r\n\r\ncreate type SourceValueType_045 external name 'java.util.HashMap' language java;\r\ncreate type TargetValueType_045 external name 'java.util.HashMap' language java;\r\n\r\ncreate function sourceValueExtractor_045( hashMap SourceValueType_045, hashKey varchar( 32672 ) ) returns int\r\nlanguage java parameter style java deterministic no sql\r\nexternal name 'org.apache.derbyTesting.functionTests.tests.lang.UDTTest.getIntValue';\r\n\r\ncreate function sourceValueMaker_045( hashKey varchar( 32672 ), hashValue int ) returns SourceValueType_045\r\nlanguage java parameter style java deterministic no sql\r\nexternal name 'org.apache.derbyTesting.functionTests.tests.lang.UDTTest.makeHashMap';\r\n\r\ncreate function targetValueMaker_045( hashKey varchar( 32672 ), hashValue int ) returns TargetValueType_045\r\nlanguage java parameter style java deterministic no sql\r\nexternal name 'org.apache.derbyTesting.functionTests.tests.lang.UDTTest.makeHashMap';\r\n\r\ncreate table targetTable_045( a TargetValueType_045 );\r\ncreate table sourceTable_045( b SourceValueType_045 );\r\n\r\ngrant insert on targetTable_045 to ruth;\r\ngrant execute on function sourceValueExtractor_045 to ruth;\r\ngrant execute on function sourceValueMaker_045 to ruth;\r\ngrant execute on function targetValueMaker_045 to ruth;\r\ngrant select on sourceTable_045 to ruth;\r\n\r\n\r\nconnect 'jdbc:derby:memory:db;user=ruth;password=ruthpassword' as ruth;\r\n\r\n-- by themselves, the select and function calls don't require any type privileges\r\nselect test_dbo.targetValueMaker_045( 'bar', test_dbo.sourceValueExtractor_045( b, 'foo' ) )\r\nfrom test_dbo.sourceTable_045;\r\n\r\n-- but this insert incorrectly fails because ruth doesn't have USAGE privilege on TargetValueType_045;\r\ninsert into test_dbo.targetTable_045\r\n  select test_dbo.targetValueMaker_045( 'bar', test_dbo.sourceValueExtractor_045( b, 'foo' ) )\r\n  from test_dbo.sourceTable_045;\r\n\r\n\r\nset connection dbo;\r\n\r\ngrant usage on type TargetValueType_045 to ruth;\r\n\r\nset connection ruth;\r\n\r\n-- now the insert works\r\ninsert into test_dbo.targetTable_045\r\n  select test_dbo.targetValueMaker_045( 'bar', test_dbo.sourceValueExtractor_045( b, 'foo' ) )\r\n  from test_dbo.sourceTable_045;\r\n{noformat}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-03-03T15:09:19.066+0000","updated":"2014-03-03T15:09:19.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13918244","id":"13918244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6434-05-aa-selectDrivenInserts.diff. This patch removes privilege checks for user-defined types encountered while binding SELECTs. A special exception is made for explicit CASTs to user-defined types. Those CASTs should require that the user enjoy USAGE privilege on the target types. I am running tests now.\r\n\r\n\r\nTouches the following files:\r\n\r\n---------------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/SelectNode.java\r\n\r\nDisable UDT privilege checks when binding SELECTs.\r\n\r\n---------------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/CastNode.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/QueryTreeNode.java\r\n\r\nBut retain UDT privilege checks for explicit CASTs.\r\n\r\n---------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GrantRevokeDDLTest.java\r\n\r\nTests for this behavior change.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-03-03T16:46:52.366+0000","updated":"2014-03-03T16:46:52.366+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/13918470","id":"13918470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1573686 from [~rhillegas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1573686 ]\r\n\r\nDERBY-6434: Don't require privileges implicitly added by SELECT-driven INSERTS; tests passed cleanly on derby-6434-05-aa-selectDrivenInserts.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-03-03T19:26:13.837+0000","updated":"2014-03-03T19:26:13.837+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/14013722","id":"14013722","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I am done working on this issue. If there are further problems in this area, new issues can be logged.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-05-30T14:54:42.582+0000","updated":"2014-05-30T14:54:42.582+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12684343/comment/14284828","id":"14284828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"bulk change to close all issues resolved but not closed and not changed since June 1, 2014.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2015-01-21T00:23:36.468+0000","updated":"2015-01-21T00:23:36.468+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6434/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qn5z:"}}