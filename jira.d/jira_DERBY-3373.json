{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12387624","self":"https://issues.apache.org/jira/rest/api/latest/issue/12387624","key":"DERBY-3373","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313142","id":"12313142","description":"","name":"10.3.3.0","archived":false,"released":true,"releaseDate":"2008-05-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-03-06 15:13:25.574","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23603","customfield_12310222":"1_*:*_1_*:*_4286067363_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-03-22T01:39:00.479+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3373/watchers","watchCount":1,"isWatching":false},"created":"2008-02-01T11:04:33.116+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12319449","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12319449","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12363059","key":"DERBY-2351","self":"https://issues.apache.org/jira/rest/api/2/issue/12363059","fields":{"summary":"ORDER BY with expression with distinct in the select list returns incorrect result","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:51:25.178+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"I am pasting here the communication from the mailinglist. I am having a blocking and large problem with it because I have to make a release that needs the specified SQL query. \n\n\ntom_ wrote:\n\n> The errormessage is \n> \n> The ORDER BY clause may not specify an expression, since the query specifies \n> DISTINCT \n> [Error Code: 20000] \n> [SQL State: 4287A] \n> \n> The statement is \n> \n> select distinct \n> t1.t1_id, t2.t2value1, t2.t2value2, t2.t2value3 \n> from \n> t1, t2, t3   \n> where \n> ... \n> order by lower(t2.t2value2) , lower(t2.t2value1) , lower(t2.t2value3) \n> \n> \n> \n> \n> Dyre.Tjeldvoll wrote: \n>   \n>> tom_ <tom12167@...> writes: \n>> \n>>     \n>>> I am using \"disctinct\" because of some self-joins and also needed to add \n>>> an \n>>> \"order by\" clause. An error is shown. Is it not possible to use distinct \n>>> and \n>>> order by together? \n>>>       \n>> I think it is allowed. Executing \n>> \n>> select distinct * from sys.systables order by tablename; \n>> \n>> in ij works just fine. Could you show the error message you get, and \n>> perhaps what the table looks like? \n>> \n>> -- \n>> dt \n>> \n>> \n>>    \nÂ«  [hide part of quote]\n\nHi Tom - \n\nI see what you mean using the demo DB toursDB: \n\nij> select * from airlines order by lower(airline_full); \nA&|AIRLINE_FULL            |BASIC_RATE            |DISTANCE_DISCOUNT     \n|BUSINESS_LEVEL_FACTOR \n|FIRSTCLASS_LEVEL_FACT&|ECONOMY_SE&|BUSINESS_S&|FIRSTCLASS& \n----------------------------------------------------------------------------------------------------------------------------------------------------------- \nAA|Amazonian Airways       |0.18                  |0.03                   \n|0.5                   |1.5                   |20         |10         |5 \nUS|Union Standard Airlines |0.19                  |0.05                   \n|0.4                   |1.6                   |20         |10         |5 \n\n2 rows selected \nij> select distinct * from airlines order by lower(airline_full); \nERROR 4287A: The ORDER BY clause may not specify an expression, since \nthe query specifies DISTINCT. \nij> select distinct airline_full from airlines order by lower(airline_full); \nERROR 4287A: The ORDER BY clause may not specify an expression, since \nthe query specifies DISTINCT. \nij> \n\nI didn't find a JIRA enhancement to remove this restriction.  I suggest \nyou file an Enhancement request to remove the restriction reported by \nERROR 4287A. \n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37340","summary":"SQL \"distinct\" and \"order by\" needed together","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tom_","name":"tom_","emailAddress":"tom12167 at web dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Vatter","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tom_","name":"tom_","emailAddress":"tom12167 at web dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Vatter","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Solaris Dev Express, Java 5","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10050","value":"Blocker","id":"10050"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":13,"total":13,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12575736","id":"12575736","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"I'm marking this as a regression since it worked before the following fix was checked in:\r\n \r\n------------------------------------------------------------------------\r\nr555096 | bpendleton | 2007-07-11 00:06:02 +0200 (Wed, 11 Jul 2007) | 19 lines\r\n\r\nDERBY-2351: Certain ORDER BY clauses should be rejected as invalid\r\n\r\nThis change modifies the ORDER BY clause so that it rejects certain\r\nqueries as invalid: specifically, queries which:\r\na) specify the set quantifier DISTINCT,\r\nb) and also contain an ORDER BY clause which refers to a column\r\nor expression which is not in the query result.\r\n\r\nThe problem with such queries is that we are told to return only\r\na single instance of the DISTINCT columns, but since the ORDER BY\r\nclause refers to columns which are not in the DISTINCT set, if there\r\nshould be multiple candidate rows from which we choose the DISTINCT\r\nresult, we don't know which of those rows to use for the ORDER BY\r\nprocessing.\r\n\r\nWhen the DISTINCT and ORDER BY clauses are in conflict, Derby should\r\nreject the query. This change modifies Derby to do so.\r\n\r\n\r\n------------------------------------------------------------------------\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-06T15:13:25.574+0000","updated":"2008-03-06T15:13:25.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12575771","id":"12575771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I agree, this was definitely caused by the DERBY-2351 changes.\r\n\r\nA possible workaround would be to include the order by expressions\r\ninto the select list. That is, modify the query from:\r\n\r\n  select distinct airline_full from airlines order by lower(airline_full); \r\n\r\nto\r\n\r\n  select distinct airline_full, lower(airline_full) from airlines order by lower(airline_full); \r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-03-06T16:45:47.015+0000","updated":"2008-03-06T16:45:47.015+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12575866","id":"12575866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Changing the issue type to bug, since it is a regression","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-06T20:25:41.656+0000","updated":"2008-03-06T20:25:41.656+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12576546","id":"12576546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think that these lines in OrderByColumn, which were added by DERBY-2351,\r\nare the focus of this problem:\r\n\r\n                        if (addedColumnOffset >= 0 &&\r\n                                        target instanceof SelectNode &&\r\n                                        ( (SelectNode)target ).hasDistinct())\r\n                                throw StandardException.newException(SQLState.LANG_DISTINCT_ORDER_BY_EXPRESSION);\r\n\r\nThe problem is that these lines should have an additional\r\ncondition, along the lines of:\r\n\r\n  AND, there exists at least 1 column reference among the\r\n  column references in this ORDER BY expression, which\r\n  does not appear as one of the columns which are being\r\n  selected DISTINCT.\r\n\r\nThe problem is, I'm not sure how to code that AND test I'll have\r\nto study the SelectNode data structure to see if I can easily see\r\nhow to tell \"the columns which are being selected DISTINCT\".\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-03-08T14:41:32.859+0000","updated":"2008-03-08T14:41:32.859+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12576607","id":"12576607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is 'allowExpressions.diff', a patch proposal.\r\n\r\nThis proposal backs out the line of code added by DERBY-2351\r\nwhich was rejecting DISTINCT queries with ORDER BY expressions\r\nwhich did not appear explicitly in the SELECT list.\r\n\r\nWith this patch, Derby once again allows a range of legitimate\r\nqueries, such as:\r\n   select distinct name from person order by lower(name)\r\n   select distinct * from person order by age + 10\r\n\r\nUnfortunately, with this patch, Derby now also allows the invalid query:\r\n  select distinct name from person order by age*2\r\n\r\nI haven't been able to quickly find an easy way to distinguish the\r\nvalid queries from the invalid ones, and so as a short term measure\r\nI think it would be good to restore the previous (10.2 and prior)\r\nbehavior for DISTINCT queries involving ORDER BY expressions.\r\nIt was good that the DERBY-2351 patch rejected some invalid\r\nqueries, but it was far worse that the patch rejected some valid ones.\r\n\r\nI added a number of new test cases to illustrate the behavior.\r\n\r\nPlease have a look at the patch and let us know what you think!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-03-08T20:38:08.805+0000","updated":"2008-03-08T20:38:08.805+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12576926","id":"12576926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"body":"I agree it would probably be good to allow the legal queries once again, even if the expense is allowing an illegal one. \r\nThat said we should ultimately reject the bad illegal ones.\r\n\r\nIf that's our understanding, the patch looks ok. The changed test run successfully.\r\n\r\nIf I understand correctly what you're looking for in the removed if statement is something like \"if none of the columns in the orderby column list are in the target.rcl, and the target is a distinct query, then throw exception\" ?\r\n\r\nDidn't the removed if statement really said the inverse?\r\n\"if there is a column in the orderby columns that isn't in the target.rcl, and target is a distinct, then throw exception\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"created":"2008-03-10T10:11:29.102+0000","updated":"2008-03-10T10:11:29.102+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12578130","id":"12578130","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is 'mergeWith2351.diff', an update of the previous patch proposal\r\nwhich resolves the file conflicts with the DERBY-2351 patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-03-13T03:28:41.929+0000","updated":"2008-03-13T03:28:41.929+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12578590","id":"12578590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Thomas, thanks for looking at the patch. I'm sorry I didn't get back to you sooner.\r\n\r\nThe \"if\" statement that I wish I could write is something like:\r\n\r\n   if the query specified DISTINCT, and if this ORDER BY expression \r\n   references any column which is not one of the DISTINCT\r\n   columns, reject the query, for there may be multiple possible values of\r\n   that column and we don't know which one to use for ordering the results.\r\n\r\nHere's a great explanation of the problem:\r\nhttps://issues.apache.org/jira/browse/DERBY-2351?focusedCommentId=12473871#action_12473871\r\nThe only difference in this case is that we're concerned with ORDER BY *expressions*,\r\nnot simple column references, and so an example query might be:\r\n\r\n  SELECT DISTINCT name FROM person ORDER BY age * 2\r\n\r\nand we wouldn't know whether to order the results as:\r\n  John (age 10*2), then Mary (age 20*2)\r\nor\r\n  Mary (age 20*2), then John (age 30*2)\r\n\r\nWhat Derby *actually* does, with this patch in place, is to implicitly include (age*2)\r\ninto the DISTINCT list, so it sees *both* John records and produces the results:\r\n  John (age 10*2), Mary (age 20*2), John (age 30*2)\r\n\r\nThat is, even though the user specified \"DISTINCT name\", Derby produces two\r\nrows with the same name.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-03-14T03:56:19.006+0000","updated":"2008-03-14T03:56:19.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12579158","id":"12579158","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Committed the change to the trunk as revision 637529.\r\nI'll investigate merging this change back to the 10.4 branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-03-16T04:00:26.988+0000","updated":"2008-03-16T04:00:26.988+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12580383","id":"12580383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"I added 10.4 as a fix version. 10.3.2.2 is already listed, so if possible, I think it would be good to merge the fix to 10.3 as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-19T14:19:02.064+0000","updated":"2008-03-19T14:19:02.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12580417","id":"12580417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Sorry. I changed the wrong issue. Changing the assignee back to Bryan. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-19T15:47:33.983+0000","updated":"2008-03-19T15:47:33.983+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12580557","id":"12580557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Merged the trunk change to the 10.4 branch and committed as revision 639013.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-03-19T20:57:34.050+0000","updated":"2008-03-19T20:57:34.050+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387624/comment/12581233","id":"12581233","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Committed the patch to the 10.3 branch as revision 639935.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-03-22T01:39:00.439+0000","updated":"2008-03-22T01:39:00.439+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3373/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06r73:"}}