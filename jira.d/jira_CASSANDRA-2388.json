{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12502417","self":"https://issues.apache.org/jira/rest/api/latest/issue/12502417","key":"CASSANDRA-2388","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332167","id":"12332167","description":"A placeholder for a 2.1 series change","name":"2.1.x","archived":false,"released":false}],"aggregatetimespent":null,"resolution":null,"customfield_12310220":"2011-03-25 22:45:55.124","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":null,"customfield_12310420":"20597","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-2388/watchers","watchCount":13,"isWatching":false},"created":"2011-03-25T20:40:24.714+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","emailAddress":"pkolaczk at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Ko≈Çaczkowski","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":["hadoop","inputformat"],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"10.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12359676","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12359676","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12614208","key":"CASSANDRA-4886","self":"https://issues.apache.org/jira/rest/api/2/issue/12614208","fields":{"summary":"Remote ColumnFamilyInputFormat","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10002","description":"A patch for this issue has been uploaded to JIRA by a contributor.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Patch Available","id":"10002","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-08-25T15:10:39.074+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/10012","description":"Patch is being tested, to be approved or rejected.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/document.png","name":"Testing","id":"10012","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/4","id":4,"key":"indeterminate","colorName":"yellow","name":"In Progress"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313540","id":"12313540","name":"Hadoop","description":"ColumnFamilyInputFormat and friends"}],"timeoriginalestimate":null,"description":"ColumnFamilyRecordReader only tries the first location for a given split. We should try multiple locations for a given split.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12474683","id":"12474683","filename":"0002_On_TException_try_next_split.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eldondev","name":"eldondev","emailAddress":"apache-jira at eldondev dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eldon Stegall","active":true},"created":"2011-03-26T01:32:04.536+0000","size":2164,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12474683/0002_On_TException_try_next_split.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12652488","id":"12652488","filename":"1.2-CASSANDRA-2388.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2014-06-25T19:22:36.777+0000","size":3458,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12652488/1.2-CASSANDRA-2388.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12649379","id":"12649379","filename":"2.0-CASSANDRA-2388.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2014-06-09T14:11:17.952+0000","size":2826,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12649379/2.0-CASSANDRA-2388.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12652489","id":"12652489","filename":"2.0-CASSANDRA-2388-v2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2014-06-25T19:22:36.780+0000","size":2831,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12652489/2.0-CASSANDRA-2388-v2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12485071","id":"12485071","filename":"CASSANDRA-2388.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-07-02T22:14:48.790+0000","size":938,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12485071/CASSANDRA-2388.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12483441","id":"12483441","filename":"CASSANDRA-2388.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-22T13:46:37.714+0000","size":15479,"mimeType":"binary/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12483441/CASSANDRA-2388.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12482140","id":"12482140","filename":"CASSANDRA-2388.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-11T09:15:23.672+0000","size":14564,"mimeType":"binary/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12482140/CASSANDRA-2388.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12481890","id":"12481890","filename":"CASSANDRA-2388.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-09T06:29:04.801+0000","size":7690,"mimeType":"binary/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12481890/CASSANDRA-2388.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12484458","id":"12484458","filename":"CASSANDRA-2388-addition1.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-28T15:02:16.627+0000","size":5549,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12484458/CASSANDRA-2388-addition1.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12485146","id":"12485146","filename":"CASSANDRA-2388-extended.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-07-04T14:01:48.047+0000","size":3954,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12485146/CASSANDRA-2388-extended.patch"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"41642","summary":"ColumnFamilyRecordReader fails for a given split because a host is down, even if records could reasonably be read from other replica.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eldondev","name":"eldondev","emailAddress":"apache-jira at eldondev dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eldon Stegall","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eldondev","name":"eldondev","emailAddress":"apache-jira at eldondev dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eldon Stegall","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":86,"total":86,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13011464","id":"13011464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"I'm not sure special casing NoRouteToHostException to be blacklisted is the best thing to do.  I don't think connections are being setup so often that maintaining a blacklist for any reason is needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2011-03-25T22:45:55.124+0000","updated":"2011-03-25T22:45:55.124+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13011667","id":"13011667","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Unfortunately, I thought of another problem here.  If we go over the entire replica set, we're potentially going outside of the DC, which is bad since a lot of installations have a DC dedicated to analytics so it doesn't affect their app. It seems that the local address is preferred though, are your task trackers not on the same machines as Cassandra?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2011-03-26T18:24:39.652+0000","updated":"2011-03-26T18:24:39.652+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13035052","id":"13035052","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Eldon, are you planning to take another stab at this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-05-17T21:07:16.610+0000","updated":"2011-05-17T21:07:16.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13035053","id":"13035053","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"body":"We need to return the list of replicas in the same DC","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"created":"2011-05-17T21:09:01.890+0000","updated":"2011-05-17T21:09:13.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13037975","id":"13037975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Mck, do you want to take a stab at this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-05-23T14:45:44.358+0000","updated":"2011-05-23T14:45:44.358+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13038026","id":"13038026","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"I'm having a go currently at CASSANDRA-1125 so i might as well look at this too. (but you've caught me on a holiday-week...)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-05-23T16:27:46.513+0000","updated":"2011-05-23T16:27:46.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13045443","id":"13045443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"How do i obtain the DataCenter name for a given address?\r\n\r\nIEndpointSnitch.getDataCenter(inetAddress) would work nicely for me but how do i get the snitch client-side?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-07T14:11:07.463+0000","updated":"2011-06-07T14:11:07.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13045620","id":"13045620","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Initial attempt at solution. Although I'm a little apprehensive to the additions to cassandra.thrift\r\n(describe_rack(..) isn't used anywhere, it just made sense to add describe_datacenter(..) and describe_rack(..) at the same time).\r\n\r\nI've tested that existing hadoop jobs work but the new functionality hasn't been tested (as i currently don't have any RF=2 data setup).\r\n\r\nThis patch does not include the required re-generated Cassandra.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-07T20:41:15.028+0000","updated":"2011-06-08T06:04:31.507+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13046357","id":"13046357","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Second attempt. (god only knows what i was trying to test last patch ;)\r\nthis patch:\r\n - adds describe_datacenter and describe_rack to cassandra.thrift\r\n - adds locations in ColumnFamilyRecordReader from the split's alternative endpoints if dc is the same\r\n\r\nThis patch does not include the required re-generated Cassandra.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-09T06:29:04.881+0000","updated":"2011-06-09T06:29:04.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13046450","id":"13046450","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"I have tested this now on data w/ RF=2.\r\nSeems to work ~ok as far as i can see.\r\n\r\nOne side-effect of this patch is where once one could configure ConfigHelper.setInitialAddress(conf, \"localhost\") this will no longer work for tasks trying to run on the down node.\r\nColumnFamilyRecordReader.getLocations() will ConnectException trying to call describe_datacenter(..). This will lead to the task failing. Hadoop re-runs the task then on another node and eventually the job will complete. But the fall back to replica never is used.\r\n\r\nIf the initialAddress is hardcoded to one node then we no longer have a decentralised job.\r\n\r\nI would like to allow a comma-separated in initialAddress, for example it could be \"localhost, node01, node02, node03\". This would give preference to localhost and avoid any centralisation.\r\n\r\nI would also like to make ColumnFamilyRecordReader.getLocations() return an iterator instead of an array.\r\nThe createConnection(..) and client.describe_datacenter(..) calls are an unnecessary overhead when all nodes (or first endpoint location) are up, and could be avoided by lazy-loading the list.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-09T10:22:57.601+0000","updated":"2011-06-09T10:22:57.601+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13047871","id":"13047871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"New patch. I think i'm at last happy with it.\r\n\r\ngetLocations() returns an iterator so client.describe_datacenter() is only called when necessary.\r\n\r\nRather than provide a list in initialAddress it was possible to use either the initialAddress OR the endpoint. This gave the benefit in not listing a location that can't actually be connected to.\r\n\r\nThe \"only use replica from same DC\" is an option now in ConfigHelper. By default it is true.\r\n\r\nAgain the re-generated Cassandra.java is not included in the patch.\r\n\r\nI have tested this on normal jobs, and RF=2 jobs with a node down.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-11T09:15:23.698+0000","updated":"2011-06-11T09:15:23.698+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13048597","id":"13048597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"body":"The get_rack seems unused so it should be removed.\r\n\r\nAlso, it might be better to pass all locations in the get_datacenter thrift call since you can get the results in one shot and sort them by the dynamic snitch, filtering out the dead nodes:\r\n\r\n{noformat}\r\n  DatabaseDescriptor.getEndpointSnitch().sortByProximity(FBUtilities.getLocalAddress(), endpoints); \r\n{noformat}\r\n\r\n{noformat}\r\n  FailureDetector.instance.isAlive(endpoint)\r\n{noformat}\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"created":"2011-06-13T15:23:24.480+0000","updated":"2011-06-13T15:23:24.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13048622","id":"13048622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Then (if i understand you correctly) i would need in cassandra.thrift\r\n{noformat}\r\n      /** returns alive endpoints, sorted by proximity, that belong in the same datacenter as the given endpoint */\r\n  list<string> get_endpoints_in_same_datacenter(1: string endpoint, 2: required list<string> endpoints)\r\n    throws (1:InvalidRequestException ire)\r\n{noformat}\r\n\r\nThen the API becomes quite specific to this usecase. Is the performance gain worth it? What's the cost of each client.describe_datacenter(..) call, and probably more important what is the lost performance of writing to the furthest node that's within the same datacenter?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-13T16:15:18.976+0000","updated":"2011-06-13T16:17:38.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13048641","id":"13048641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Just make sure i understand you T Jake, you would rather something like this in CassandraServer.java?\r\n(I've renamed from the previous comment get_endpoints_in_same_datacenter(..) to sort_endpoints_by_proximity(..))\r\n{noformat}\r\n    public String[] sort_endpoints_by_proximity(String endpoint, String[] endpoints, boolean restrictToSameDC) \r\n        throws TException, InvalidRequestException\r\n    {\r\n        try\r\n        {\r\n            List<String> results = new ArrayList<String>();\r\n            InetAddress address = InetAddress.getByName(endpoint);\r\n            String datacenter = DatabaseDescriptor.getEndpointSnitch().getDatacenter(address);\r\n            List<InetAddress> addresses = new ArrayList<InetAddress>();\r\n            for(String ep : endpoints)\r\n            {\r\n                addresses.add(InetAddress.getByName(ep));\r\n            }\r\n            DatabaseDescriptor.getEndpointSnitch().sortByProximity(address, addresses);\r\n            for(InetAddress ep : addresses)\r\n            {\r\n                String dc = DatabaseDescriptor.getEndpointSnitch().getDatacenter(ep);\r\n                if(FailureDetector.instance.isAlive(ep) && (!restrictToSameDC || datacenter.equals(dc)))\r\n                {\r\n                    results.add(ep.getHostName());\r\n                }\r\n            }\r\n            return results.toArray(new String[results.size()]);\r\n        }\r\n        catch (UnknownHostException e)\r\n        {\r\n            throw new InvalidRequestException(e.getMessage());\r\n        }\r\n    }\r\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-13T16:40:04.268+0000","updated":"2011-06-13T18:03:48.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13048654","id":"13048654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"body":"bq. what is the lost performance of writing to the furthest node that's within the same datacenter?\r\n\r\nThe benefit is really the DynamicSnitch. if a node it slow due to compaction then this would avoid sending requests there... \r\n\r\nbq. public String[] sort_endpoints_by_proximity(String endpoint, String[] endpoints, boolean restrictToSameDC)\r\n\r\nI don't think it makes sense to send the client endpoint to this call since the endpoint might not be a cassandra node.  It's a reasonable assumption that the endpoint it's talking to is local enough to the client to use that.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"created":"2011-06-13T16:59:28.003+0000","updated":"2011-06-13T16:59:28.003+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13048671","id":"13048671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"{quote}\r\nbq.   public String[] sort_endpoints_by_proximity(String endpoint, String[] endpoints, boolean restrictToSameDC)\r\nI don't think it makes sense to send the client endpoint to this call since the endpoint might not be a cassandra node. It's a reasonable assumption that the endpoint it's talking to is local enough to the client to use that.\r\n{quote}\r\nFor the test set i was running against, RF=2, each split's has two endpoints always in different datacenters.\r\n\r\nIf the \"local\" endpoint is down then getLocations() will then call client.sort_endpoints_by_proximity(..) and this will fail (being the same endpoint).\r\nIt then makes a client connection through the \"other\" endpoint. \\[see CFRR.describeDatacenter(..)].\r\nThis will presume the wrong datacenter and return itself as a valid endpoint. \r\nI need some way to know what the original datacenter is, even when it is down.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-13T17:52:38.898+0000","updated":"2011-06-13T17:54:17.394+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13048691","id":"13048691","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"body":"ok but why not change the response to map<string,list<string>>  where key is DC and value are proximity sorted endpoints?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"created":"2011-06-13T18:19:43.689+0000","updated":"2011-06-13T18:19:43.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13048727","id":"13048727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Won't the sorting still be wrong?\r\nFor the use-case above it will solve restricting to the correct datacenter, but the sorting will still be based on proximity to the wrong node?\r\n\r\nbq. I don't think it makes sense to send the client endpoint to this call since the endpoint might not be a cassandra node. \r\nIt might not be an alive cassandra node, but it should be a cassandra node. It comes from the split's list of endpoints. At least in this use-case, or are you referring to general usage for this new api?\r\nbq. It's a reasonable assumption that the endpoint it's talking to is local enough to the client to use that.\r\nI don't think so... The endpoint that it talks to is a completely random (just the next endpoint listed in the split's list). This is why i think that such sorting won't just be wrong but not even close. Does this make sense?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-13T19:19:25.613+0000","updated":"2011-06-14T11:22:36.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13049169","id":"13049169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"body":"I think the core issue is you can't assume the hadoop node is running on a cassandra node...\r\n\r\nIf it is then the logic is straight forward, if not then it's possible the connection could cross DC boundaries. One possibility is to use the ip octets like the RackInferringSnitch.  \r\n\r\nHow's this proposal then?  keep the sort_endpoints_by_proximity signature as is and pass the client endpoint along with the list of data endpoints and add the following logic:\r\n\r\n1) sort the endpoints using the endpoint_snitch.\r\n2) if client endpoint *is* a valid cassandra node get the nodes DC and prune nodes outside of this DC\r\n3) if client endpoint *is not* a valid cassandra node try to infer the DC from its ip and prune dataendpoint nodes in a different DC. If no cassandra nodes are in the DC list goto 3).\r\n4) all else fails return the sorted endpoint list\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"created":"2011-06-14T13:07:49.114+0000","updated":"2011-06-14T13:07:56.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13049724","id":"13049724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"bq. [snip] One possibility is to use the ip octets like the RackInferringSnitch. \r\n\r\nIn our usecase we have three nodes defined via PropertyFileSnitch:{noformat}152.90.241.22=DC1:RAC1 #node1\r\n152.90.241.23=DC2:RAC1 #node2\r\n152.90.241.24=DC1:RAC1 #node3{noformat}\r\nThe only way to infer here is even addresses belong to one dc, odd to the other. This is not how RackInferringSnithc works.\r\n\r\nWhen we make the connection through the \"other\" (node2) endpoint taking the rack inferring approach \"152.90.\" will say it's in DC2. (again) this is the wrong DC and will return itself as a valid endpoint....\r\n\r\nStep (3) seems to me to be too specific to be included here.\r\nIf i go only with steps (1),(2),and (4) we get this code:{noformat}    public String[] sort_endpoints_by_proximity(String endpoint, String[] endpoints, boolean restrictToSameDC) \r\n            throws TException, InvalidRequestException\r\n    {\r\n        try\r\n        {\r\n            List<String> results = new ArrayList<String>();\r\n            InetAddress address = InetAddress.getByName(endpoint);\r\n            boolean endpointValid = null != Gossiper.instance.getEndpointStateForEndpoint(address);\r\n            String datacenter = DatabaseDescriptor\r\n                    .getEndpointSnitch().getDatacenter(endpointValid ? address : FBUtilities.getLocalAddress());\r\n            List<InetAddress> addresses = new ArrayList<InetAddress>();\r\n            for(String ep : endpoints)\r\n            {\r\n                addresses.add(InetAddress.getByName(endpoint));\r\n            }\r\n            DatabaseDescriptor.getEndpointSnitch().sortByProximity(address, addresses);\r\n            for(InetAddress ep : addresses)\r\n            {\r\n                String dc = DatabaseDescriptor.getEndpointSnitch().getDatacenter(ep);\r\n                if(FailureDetector.instance.isAlive(ep) && (!restrictToSameDC || datacenter.equals(dc)))\r\n                {\r\n                    results.add(ep.getHostName());\r\n                }\r\n            }\r\n            return results.toArray(new String[results.size()]);\r\n        }\r\n        catch (UnknownHostException e)\r\n        {\r\n            throw new InvalidRequestException(e.getMessage());\r\n        }\r\n    }{noformat}\r\n\r\nI'm happy with this (except that {{Gossiper.instance.getEndpointStateForEndpoint(address)}} is only my guess on how to tell if an endpoint is valid as such).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-15T11:23:15.494+0000","updated":"2011-06-18T08:33:14.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13053233","id":"13053233","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Problem with the suggested approach is that sortByProximity(..) *only* works when address is the local address. See assert statement DynamicEndpointSnitch:134\r\n\r\nI could hack this and rewrite the line to\r\n{noformat}IEndpointSnitch snitch = DatabaseDescriptor.getEndpointSnitch();\r\nsnitch = snitch instanceof DynamicEndpointSnitch ? ((DynamicEndpointSnitch)snitch).subsnitch : snitch;\r\nsnitch.sortByProximity(address, addresses);{noformat}\r\nBut this of course means that we always bypass DynamicEndpointSnitch's \"scores\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-22T13:04:06.477+0000","updated":"2011-06-22T13:05:02.308+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13053258","id":"13053258","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Up to date patch.\r\nFollows T Jake's points (1),(2), and (4).\r\nAnd bypasses DynamicEndpointSnitch when sorting by proximity.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-22T13:46:37.763+0000","updated":"2011-06-22T13:46:37.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054510","id":"13054510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"body":"committed with a change to use the dynamic snitch id the passed endpoint is valid.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"created":"2011-06-24T15:43:18.670+0000","updated":"2011-06-24T15:43:18.670+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054536","id":"13054536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra-0.8 #191 (See [https://builds.apache.org/job/Cassandra-0.8/191/])\r\n    Change ColumnFamilyRecordReader to read split from replicas if primary is down\r\n\r\nPatch by Mck SembWever; reviewed by tjake for CASSANDRA-2388\r\n\r\njake : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1139358\r\nFiles : \r\n* /cassandra/branches/cassandra-0.8/interface/thrift/gen-java/org/apache/cassandra/thrift/Cassandra.java\r\n* /cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/hadoop/ConfigHelper.java\r\n* /cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/hadoop/ColumnFamilyInputFormat.java\r\n* /cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/hadoop/ColumnFamilyRecordReader.java\r\n* /cassandra/branches/cassandra-0.8/interface/cassandra.thrift\r\n* /cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/thrift/CassandraServer.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-06-24T16:43:50.841+0000","updated":"2011-06-24T16:43:50.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054780","id":"13054780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"body":"This patch applies to the current 0.7-branch with minimal problems - just some imports on CassandraServer that it couldn't resolve properly.  Can this be committed against 0.7-branch for inclusion in 0.7.7?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"created":"2011-06-25T00:50:01.457+0000","updated":"2011-06-25T00:50:18.465+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054789","id":"13054789","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"body":"I've done basic testing with the word count and pig examples to make sure that the basic hadoop integration isn't negatively affected by this.  I'll also try it against our dev cluster before and after the patch - killing one node to see if it fails over to another replica - to make sure it does what it should that way.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"created":"2011-06-25T01:05:34.143+0000","updated":"2011-06-25T01:05:34.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054791","id":"13054791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"body":"Reopening for testing against 0.7.6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"created":"2011-06-25T01:15:43.006+0000","updated":"2011-06-25T01:15:43.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054803","id":"13054803","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Took a look at this belatedly.  I don't understand the contortions at all.  It looks like there's a ton of effort put in to avoiding making sortByProximity work w/ non-local nodes.  Why not just make that work instead?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-25T02:44:39.328+0000","updated":"2011-06-25T02:44:39.328+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054805","id":"13054805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"also: running hadoop on a non-cassandra node is dumb.  i don't see a point in supporting that really.  (yes, my fault it was written that way to begin with, mea culpa.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-25T02:48:46.487+0000","updated":"2011-06-25T02:48:46.487+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054806","id":"13054806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"body":"Jonathan - is it possible to attach an updated patch based on your changes to 0.8 branch?  Not sure if that would be simple to extract.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"created":"2011-06-25T02:58:15.155+0000","updated":"2011-06-25T02:58:15.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054808","id":"13054808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"with svn: svn diff -r 1139323:1139483 and hack out the OutboundTcpConnection change in the middle manually from the output.\r\n\r\nwith git: create a branch, rip out the offending OTC change and squash the other two","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-25T03:07:16.985+0000","updated":"2011-06-25T03:07:16.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054809","id":"13054809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I think there's deep surgery to be done here still though.  Backporting is probably premature.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-25T03:07:59.703+0000","updated":"2011-06-25T03:07:59.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13054810","id":"13054810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. It looks like there's a ton of effort put in to avoiding making sortByProximity work w/ non-local nodes\r\n\r\nWait, why do we even care?  \"local node\" IS the right host to sort against -- we want the split that is closest to the node running the job, this is not the same as some other C* node we contact.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-25T03:12:32.885+0000","updated":"2011-06-25T03:12:32.885+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13056524","id":"13056524","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"bq. It looks like there's a ton of effort put in to avoiding making sortByProximity work w/ non-local nodes\r\nBecause it's only when that local node is down that we actually need to sort...\r\nWhen/if DynamicEndpointSnitch's limitation is fixed (and it can sort by non-local nodes) then CassandraServer.java need not bypass it. But this won't simplify the code in CFRR. Now that CFIF supports multiple initialAddresses the method CFRR.sortEndpointsByProximity(..) can be rewritten (ie any connection to any initialAddress is all we need, no need to mess around with trying to connect through replica's to find information about replicas...)\r\nbq. Wait, why do we even care? \"local node\" IS the right host to sort against\r\nDepends on this is CFRR's \"local node\" or CassandraServer's \"local node\"... \r\nCFRR's local node is the right and only node worth sorting against, it being the \"task tracker node\". \r\nBut when c* on the \"task tracker node\" is down, then we randomly connect to another c* node so to find out of the replica we know about which are 1) up, 2) closest, and 3) in the same dc. Then it is a random c* node that becomes the \"local node\" and the call needs to be {{snitch.sortByProximity(initialAddress, addresses)}}.\r\nBut yes... the CFRR code is contorted. In many ways i prefer the simplicity of the first patch (both in api and in implementation) despite it not being \"as correct\". i thought of this \"fallback to replica\" as a last resort to keep the m/r job running, rather than an actively used feature where DynamicEndpointSnitch's scores will maximise performance. But then i'm only thinking in terms of a small c* cluster and i certainly am naive about what performance gains these scores can give...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-28T14:13:20.615+0000","updated":"2011-06-28T14:19:51.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13056546","id":"13056546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. CFRR's local node is the right and only node worth sorting against, it being the \"task tracker node\". \r\n\r\nRight.\r\n\r\nbq. Then it is a random c* node that becomes the \"local node\"\r\n\r\nWe still want to sort by proxmity-to-TT, because CFRR connects directly to the split owner to do the reads.  initialAddress isn't involved post-split-discovery.\r\n\r\nAgain, all the complexity goes away if we just embed the snitch into CFIF/TT.\r\n\r\nOne wrinkle: ec2snitch requires gossip, so TT would need a separate local ip to participate in the gossip ring.  We could make that optional (and fall back to old \"recognize local data, otherwise you get a random replica\" behavior otherwise).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-28T14:51:07.348+0000","updated":"2011-06-28T14:51:07.348+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13056556","id":"13056556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Taking a step back: aren't we optimizing for (1) a corner case with (2) the wrong solution?\r\n\r\nHere's what I mean:\r\n\r\n1) CFRR already prioritizes the local replica.  So if you have >= one TT for each replica, this only helps if the local C* node dies, BUT the TT does not.  This doesn't happen often.\r\n\r\n2) If we ARE in that situation, the \"right\" solution would be to send the job to a TT whose local replica IS live, not to read the data from a nonlocal replica.  How can we signal that?  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-28T15:01:23.257+0000","updated":"2011-06-28T15:01:23.257+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13056557","id":"13056557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"CASSANDRA-2388-addition1.patch: Simplify CFRR now that multiple initialAddresses are supported.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-28T15:02:16.670+0000","updated":"2011-06-29T05:41:05.819+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13056787","id":"13056787","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"bq. If we ARE in that situation, the \"right\" solution would be to send the job to a TT whose local replica IS live, not to read the data from a nonlocal replica. How can we signal that?\r\n\r\nISTM the right thing to do in that situation is just fail and let the JT reschedule somewhere else.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2011-06-28T21:11:28.623+0000","updated":"2011-06-28T21:11:28.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057002","id":"13057002","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":" - This does happen already (i've seen it while testing initial patches that were no good).\r\nProblem is that the TT is blacklisted, reducing hadoop's throughput for all jobs running.\r\nI bet too that a fallback to a replica is faster than a fallback to another TT.\r\n\r\n - There is no guarantee that any given TT will have its split accessible via a local c* node - this is only a preference in CFRR. A failed task may just as likely go to a random c* node. At least now we can actually properly limit to the one DC and sort by proximity. \r\n\r\n - One thing we're not doing here is applying this same DC limit and sort by proximity in the case when there isn't a localhost preference. See CFRR.initialize(..)\r\nIt would make sense to rewrite CFRR.getLocations(..) to\r\n{noformat}    private Iterator<String> getLocations(final Configuration conf) throws IOException\r\n    {\r\n        return new SplitEndpointIterator(conf);\r\n    }{noformat} and then to move the finding-a-preference-to-localhost code into SplitEndpointIterator...\r\n\r\n - A bug i can see in the patch that did get accepted already is in CassandraServer.java:763 when endpointValid is false and restrictToSameDC is true we end up restricting to a random DC. I could fix this so restrictToSameDC is disabled in such situations but this actually invalidates the previous point: we can't restrict to DC anymore and we can only sortByProximity to a random node... I think this supports Jonathan's point that it's overall a poor approach. I'm more and more in preference of my original approach using just client.getDatacenter(..) and not worrying about proximity within the datacenter.\r\n\r\n - Another bug is that, contray to my patch, the code committed\r\nbq. committed with a change to use the dynamic snitch id the passed endpoint is valid.\r\n can call {{DynamicEndpointSnitch.sortByProximity(..)}} with an address that is not localhost and this breaks the assertion in the method. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-29T04:58:43.694+0000","updated":"2011-06-29T07:49:19.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057392","id":"13057392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"{quote}\r\nThis does happen already (i've seen it while testing initial patches that were no good).\r\nProblem is that the TT is blacklisted, reducing hadoop's throughput for all jobs running.\r\n{quote}\r\n\r\nIf the cassandra node where the TT resides isn't working, then throughput is reduced regardless.\r\n\r\n\r\nbq. I bet too that a fallback to a replica is faster than a fallback to another TT.\r\n\r\nI doubt that for any significant job.  Locality is important.  Move the job to the data, not the data to the job.\r\n\r\n{quote}\r\nThere is no guarantee that any given TT will have its split accessible via a local c* node - this is only a preference in CFRR. A failed task may just as likely go to a random c* node. At least now we can actually properly limit to the one DC and sort by proximity.\r\n{quote}\r\n\r\nThis sounds like the thing we need to fix, then.  Ensuring that the TT assigned to the map has a local replica.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2011-06-29T18:40:40.810+0000","updated":"2011-06-29T18:41:40.386+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057413","id":"13057413","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. If the cassandra node where the TT resides isn't working, then throughput is reduced regardless.\r\n\r\nRight: we _want_ it to be blacklisted in that scenario.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-29T19:25:02.737+0000","updated":"2011-06-29T19:25:02.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057427","id":"13057427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. This sounds like the thing we need to fix, then. Ensuring that the TT assigned to the map has a local replica.\r\n\r\nreverted 1139358, 1139483 to make a fresh start for this.\r\n\r\nhow do we \"ensure\" this?  isn't that the JT's job, to send jobs to the splits we gave it from CFIF?  (which does make sure that only nodes with the data, are included in the split source list.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-29T19:45:21.179+0000","updated":"2011-06-29T19:45:21.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057429","id":"13057429","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"{quote}If the cassandra node where the TT resides isn't working, then throughput is reduced regardless.\r\nbq. Right: we want it to be blacklisted in that scenario.{quote}\r\nThis is making the presumption that the hadoop cluster is only used with CFIF.\r\nThe TT could still be useful for other jobs submitted.\r\nFurthermore a blacklisted TT does't automatically come back - it needs to be manually restarted. Isn't this creating more headache for operations?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-29T19:49:28.321+0000","updated":"2011-06-29T19:49:28.321+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057437","id":"13057437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"body":"I dont think we should require the TT to be running locally. The whole idea is to support access to Cassandra data from hadoop even if it's just an import. \r\n\r\nThis patch does spend a lot of time dealing with non local data for that reason. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"created":"2011-06-29T19:59:09.009+0000","updated":"2011-06-29T19:59:09.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057461","id":"13057461","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"{quote}\r\nThis is making the presumption that the hadoop cluster is only used with CFIF.\r\nThe TT could still be useful for other jobs submitted.\r\n{quote}\r\n\r\nI'm fine with that assumption.  If you want to run other jobs, use a different cluster.  Cassandra's JVM is eating wasteful memory at that point.\r\n\r\n{quote}\r\nFurthermore a blacklisted TT does't automatically come back - it needs to be manually restarted. Isn't this creating more headache for operations?\r\n{quote}\r\n\r\nI don't think this is actually the case, see HADOOP-4305\r\n\r\n\r\n{quote}\r\nI dont think we should require the TT to be running locally. The whole idea is to support access to Cassandra data from hadoop even if it's just an import.\r\n\r\nThis patch does spend a lot of time dealing with non local data for that reason.\r\n{quote}\r\n\r\nI'm fine with dropping support for non-colocated TTs, or at least saying there's no DC-specific support.  Because frankly, that is a very suboptimal thing to do, transfer the data across the network all the time, and flies in the face of Hadoop's core principles.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2011-06-29T20:47:10.645+0000","updated":"2011-06-29T20:47:10.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057467","id":"13057467","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. a blacklisted TT does't automatically come back\r\n\r\ntlipcon says it comes back after 24h, fwiw.  In any case it's still the case that we DO want to blacklist it while it's down.  (Brisk could perhaps add a \"clear my tasktracker on restart\" operation as a further enhancement.)\r\n\r\nbq. I'm fine with dropping support for non-colocated TTs\r\n\r\n+1, it was a bad idea and I'm sorry I wrote it. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-29T21:00:55.453+0000","updated":"2011-06-29T21:00:55.453+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057470","id":"13057470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"bq. tlipcon says it comes back after 24h\r\njust to be clear about my concerns. \r\nthis means a dead c* node will bring down a TT. In a hadoop cluster with 3 nodes this means for 24hrs you're lost 33% throughput. (If less than 10% of hadoop jobs used CFIF i could well imagine some pissed users). (What if you have a temporarily problem with flapping c* nodes and you end up with a handful of blacklisted TTs? etc etc etc).\r\n\r\nAll this when using a replica, any replica, could have kept things going smoothly, the only slowdown being some of the data into CFIF had to go over the network instead...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-29T21:16:35.867+0000","updated":"2011-06-29T21:18:27.202+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057568","id":"13057568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. this means a dead c* node will bring down a TT\r\n\r\nAgain: _this is what you want to happen_.  As long as the C* process on the same node is down, you want the TT to be blacklisted and the jobs to go elsewhere.\r\n\r\nbq. In a hadoop cluster with 3 nodes this means for 24hrs you're lost 33% throughput\r\n\r\nRight, but the real cause is because the C* process is dead, not b/c the TT is blacklisted.  Making the TT read from other nodes will only hurt your network, not fix the throughput problem, b/c i/o is the bottleneck.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-30T00:32:40.402+0000","updated":"2011-06-30T00:32:40.402+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057659","id":"13057659","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Then i would hope for two separate InputFormats. One optimised for local node connection, where cassandra is deemed the more important system over hadoop, and another where data can be read in from anywhere. I think the latter should be supported in some manner  since users may not always have the possibility to install hadoop and cassandra on the same servers, or they might not think it to be so critical part (eg if CFIF is reading using a IndexClause the input data set might be quite small and the remaining code in the m/r be the bulk of the processing...)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-30T07:50:51.761+0000","updated":"2011-06-30T07:50:51.761+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13057810","id":"13057810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. another where data can be read in from anywhere\r\n\r\nThis is totally antithetical to how hadoop is designed to work.  I don't think it's worth supporting in-tree.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-06-30T13:17:37.805+0000","updated":"2011-06-30T13:17:37.805+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13058095","id":"13058095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Is CASSANDRA-2388-local-nodes-only-rough-sketch the direction we want then?\r\n\r\nThis is very initial code, i can't get {{new JobClient(JobTracker.getAddress(conf), conf).getClusterStatus().getActiveTrackerNames()}} to work, need a little help here.\r\n(Also CFRR.getLocations() can be drastically reduced).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-06-30T21:43:26.156+0000","updated":"2011-06-30T21:43:26.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13058757","id":"13058757","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1 to CFRR changes\r\n\r\nwasn't immediately clear to me what CFIF changes are doing, can you elaborate?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-07-01T20:05:13.278+0000","updated":"2011-07-01T20:05:13.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13059134","id":"13059134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"The idea is to setup splits to have only endpoints that are valid trackers. But now i see this is just a brainfart :-) Ofc the jobTracker will apply this match for us. And that CFIF was always 'restricted' to running on endpoints. Although the documentation on inputSplit.getLocations() is a little thin as to whether this restricts which trackers it should run on or whether is just a preference... I guess it doesn't matter, as you point out Jonathan all that's required here is the one line changed in CFRR.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-07-02T22:07:26.952+0000","updated":"2011-07-02T22:08:08.755+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13059136","id":"13059136","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"the new \"one-liner\" CASSANDRA-2388 attached. i'll \"submit patch\" once i've tested it some...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-07-02T22:16:38.381+0000","updated":"2011-07-02T22:16:38.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13059141","id":"13059141","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Sounds good, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-07-02T22:53:36.840+0000","updated":"2011-07-02T22:53:36.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13059334","id":"13059334","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"{quote}2) If we ARE in that situation, the \"right\" solution would be to send the job to a TT whose local replica IS live, not to read the data from a nonlocal replica. How can we signal that?{quote}To /really/ solve this issue can we do the following? \r\nIn CFIF.getRangeMap() take out of each range any endpoints that are not alive. A client connection already exists in this method. This filtering out of dead endpoints wouldn't be difficult, and would move tasks *to* the data making use of replica. This approach does need a new method in cassandra.thrift, eg {{list<string> describe_alive_nodes()}}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-07-04T06:39:00.633+0000","updated":"2011-07-04T06:39:00.633+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13085255","id":"13085255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Does that really fix things though?  Because you could have a data node be reachable from the coordinator answering describe_alive_nodes, but unreachable from the client.  So the client still needs to be able to skip unreachable endpoints itself, so describe_alive seems like gratuitous complexity.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-08-15T18:47:28.517+0000","updated":"2011-08-15T18:47:28.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13087915","id":"13087915","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=patrik.modesto","name":"patrik.modesto","emailAddress":"patrik dot modesto at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrik Modesto","active":true},"body":"I'd like to point out the situation in which no node for a given range of keys is available. It can happen for example with keyspace set to RF=1 and a node goes down. I created a patch that gives a user a chance to ignore missing range/node and continue runnig the MapReduce job. The patch is here: http://pastebin.com/hhrr8m9P\r\n\r\nJonathan already replied to the ML with \"ignoring unavailable ranges is a misfeature, imo\".\r\n\r\nIn our case it's very usefull, although there may be another/smarter solution. We have a keyspace with RF=1 and the nature of our data allows us to ignore temporarily missing node. The current ColumnFamilyInputFormat fails with RuntimeException and AFAIK there is no way around.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=patrik.modesto","name":"patrik.modesto","emailAddress":"patrik dot modesto at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Patrik Modesto","active":true},"created":"2011-08-19T19:39:51.171+0000","updated":"2011-08-19T19:39:51.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13087965","id":"13087965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"bq. Does that really fix things though? Because you could have a data node be reachable from the coordinator answering describe_alive_nodes, but unreachable from the client. So the client still needs to be able to skip unreachable endpoints itself, so describe_alive seems like gratuitous complexity.\r\n\r\nI agree, since the view is from the coordinator, describe_alive_nodes isn't very helpful, and also has to wait on the failure detector to mark the node down anyway.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2011-08-19T20:59:36.186+0000","updated":"2011-08-19T20:59:36.186+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13088039","id":"13088039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. I agree, since the view is from the coordinator, describe_alive_nodes isn't very helpful\r\n\r\nCommitted Mck's most recent patch.\r\n\r\nbq. We have a keyspace with RF=1 and the nature of our data allows us to ignore temporarily missing node\r\n\r\nThe \"right\" fix is to increase RF.  Ignoring missing data is not a scenario we want to support.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-08-19T22:44:52.048+0000","updated":"2011-08-19T22:44:52.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13088566","id":"13088566","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra-0.7 #539 (See [https://builds.apache.org/job/Cassandra-0.7/539/])\r\n    fail jobs when Cassandra node has failed but TaskTracker has not\r\npatch by Mck SembWever; reviewed by jbellis and brandonwilliams for CASSANDRA-2388\r\n\r\njbellis : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1159807\r\nFiles : \r\n* /cassandra/branches/cassandra-0.7/CHANGES.txt\r\n* /cassandra/branches/cassandra-0.7/src/java/org/apache/cassandra/hadoop/ColumnFamilyRecordReader.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-08-22T08:27:05.141+0000","updated":"2011-08-22T08:27:05.141+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13094097","id":"13094097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"This approach isn't really working for me and was committed too quickly i believe.\r\n\r\nbq. Although the documentation on inputSplit.getLocations() is a little thin as to whether this restricts which trackers it should run on or whether is just a preference\r\n\r\nTasks are still being evenly distributed around the ring regardless of what the ColumnFamilySplit.locations is.\r\n\r\nThe chance of a task actually working is RF/N. Therefore the chances of a blacklisted node are high. Worse is that the whole ring can quickly become blacklisted.\r\n\r\nhttp://abel-perez.com/hadoop-task-assignment has an interesting section in it explaining how the task assignment is supposed to work (and that data locality is preferred but not a requirement). Could ColumnFamilySplit.locations be in the wrong format? (eg they should ip not hostname?).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-08-30T20:55:15.529+0000","updated":"2011-08-30T21:22:38.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13094658","id":"13094658","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"see last comment. (say if this should be a separate bug...)\r\n\r\nMaybe hadoop's task allocation isn't working properly because i've an unbalanced ring (i'm working in parallel to fix that).\r\nIf this is the case i think it's an unfortunate limitation (the ring must be balanced to get any decent hadoop performance).\r\nIt's also probably likely when using {{ConfigHelper.setInputRange(..)}} that the number of nodes involved is small (approaching RF).\r\nWith the default hadoop scheduler your hadoop cluster is occupied while just a few taskTrackers are busy. Of course switching to FairScheduler will help some here.\r\n\r\nI'll take a look into hadoop's task allocation code as well...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-08-31T16:23:23.789+0000","updated":"2011-09-01T06:39:45.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13100093","id":"13100093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"In the meantime could we make this behavior configurable.\r\neg replace CFRR:176 with something like\r\n{noformat}\r\n    if(ConfigHelper.isDataLocalityDisabled())\r\n    {\r\n        return split.getLocations()[0];\r\n    }\r\n    else\r\n    {\r\n        throw new UnsupportedOperationException(\"no local connection available\");\r\n    }{noformat}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-09-08T06:01:39.491+0000","updated":"2011-09-08T06:01:39.491+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13100281","id":"13100281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Should we just revert the change for now?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-09-08T12:55:51.306+0000","updated":"2011-09-08T12:55:51.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13100717","id":"13100717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Well that would work for me, was only thinking you want to push a \"default behavior\" (especially for those using a RP). \r\nBut I think a better understanding (at least from me) of hadoop's task scheduling is required before enforcing data locality, as as-is it certainly doesn't work for all.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-09-08T21:36:39.552+0000","updated":"2011-09-08T21:37:19.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13104179","id":"13104179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"body":"I just want to confirm what this ticket is about.\r\n\r\nThe JT has a list of endpoints for a given split.\r\nWhen a task runs it may or may not be on one of those nodes \r\nIf other tasks are running on all those replicas the JT may put them on a remote node.\r\n\r\nSo we need to decide which endpoint to connect to given the chance that nodes are down.\r\n\r\n1. Check if the node running CFRR is one of the replicas (we have this) this means JT has assigned a data-local task (good)\r\n2. If none of these nodes are local then pick another.\r\n3. If connection fails try the one other nodes.\r\n4. Try to avoid endpoints in a different DC.\r\n\r\nThe biggest problem is 4.  Maybe the way todo this is change getSplits logic to never return replicas in another DC.  I think this would require adding DC info to the describe_ring call.  Then we only need to worry about 1-3.\r\n\r\n\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjake","name":"tjake","emailAddress":"jakers at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tjake&avatarId=12744","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tjake&avatarId=12744","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tjake&avatarId=12744","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tjake&avatarId=12744"},"displayName":"T Jake Luciani","active":true},"created":"2011-09-14T02:25:54.953+0000","updated":"2011-09-14T02:25:54.953+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13104537","id":"13104537","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra-0.7 #552 (See [https://builds.apache.org/job/Cassandra-0.7/552/])\r\n    revert CASSANDRA-2388 (again)\r\n\r\njbellis : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1170333\r\nFiles : \r\n* /cassandra/branches/cassandra-0.7/CHANGES.txt\r\n* /cassandra/branches/cassandra-0.7/src/java/org/apache/cassandra/hadoop/ColumnFamilyRecordReader.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-09-14T14:49:04.771+0000","updated":"2011-09-14T14:49:04.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13225620","id":"13225620","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Marking as minor since the job should get re-submitted, and it's very difficult to reproduce when the tasktrackers are colocated with cassandra nodes (the recommended configuration).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2012-03-08T22:38:35.989+0000","updated":"2012-03-08T22:38:35.989+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13487922","id":"13487922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lannyripple","name":"lannyripple","emailAddress":"lanny at spotright dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lanny Ripple","active":true},"body":"Would very much like a fix to this.  We have a 40 node ring running 2x hadoop clusters on 20 nodes each.  One cluster is on systems that are more flaky than the other (bad batch of memory).  When building a split on the first cluster if a ring node is down in the area of the second cluster we get timeouts with no way to blacklist the offending node even though we have replicas local to the first cluster.\r\n\r\nThe ring is partitioned into DC1:2, DC2:2 with a hadoop cluster over each DC.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lannyripple","name":"lannyripple","emailAddress":"lanny at spotright dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lanny Ripple","active":true},"created":"2012-10-31T16:33:01.666+0000","updated":"2012-10-31T16:34:18.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13501857","id":"13501857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Jake's plan above seems like a reasonable approach, but let me back up a step.  I'm just not convinced that the problem we're trying to solve is a real one.  Why do we want to suck a split's worth of data off-node?  If it's because you don't have TackTrackers running on your Cassandra nodes, well, go fix that.\r\n\r\nIf it's because Hadoop has created too many tasks and all the local replicas have their task queue full, won't assigning it to a non-local TT just cause more contention, than waiting for a local slot to free up?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2012-11-21T11:06:57.724+0000","updated":"2012-11-21T11:06:57.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13502016","id":"13502016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scottfines","name":"scottfines","emailAddress":"scottfines at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Fines","active":true},"body":"I have two distinct use-cases where running TaskTrackers alongside Cassandra nodes does not accomplish our goals:\r\n\r\n1. Joining data. We have a large data set in cassandra, true, but we have a *much* larger data set held in Hadoop itself (around 4 orders of magnitude larger in hadoop than in cassandra). We need to join the two datasets together, and use the output from that join to feed multiple systems, none of which are cassandra. Since the data in Hadoop is so much larger than that in Cassandra, we have to bring the Cassandra data to hadoop, not the other way around. Because of security concerns, we can't spread our hadoop data onto our cassandra nodes (even if that didn't screw with our capacity planning), so we have no other choice but to move the Cassandra data (in small chunks) onto Hadoop. Why not use HBase, you say? We needed Cassandra for its write performance for other problems than this one. \r\n\r\n1. Offline, incremental backups. We have a large volume of time-series data held in Cassandra, and taking nightly snapshots and moving them to our archival center is prohibitively slow--it turns out that moving RF copies of our entire dataset over a leased line every night is a pretty bad idea. Instead, I use MapReduce to take an incremental backup of a much smaller subset of the data, then move that. That way, we not only are not moving the entire data set, but we are also using Cassandra's consistency mechanisms to resolve all the replicas. The only efficient way I've found to do this is via MapReduce (we use the Random Partitioner), and since it's an offline backup, we need to move it over the network anyway--may as well use the optimized network connecting Hadoop and Cassandra instead of the tiny pipe connecting cassandra to our archival center. \r\n\r\nBoth of these reasons dictate that we *not* run a TT alongside our Cassandra nodes, no matter what the *recommended* approach is. In this case, we need a strong, fault-tolerant CFIF to serve our purposes.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scottfines","name":"scottfines","emailAddress":"scottfines at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Scott Fines","active":true},"created":"2012-11-21T14:42:53.248+0000","updated":"2012-11-21T14:42:53.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13661436","id":"13661436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Jonathan,\r\n I can't say i'm in favour of enforcing data locality.\r\nBecause  data locality in hadoop doesn't work this way‚Ä¶ when a tasktracker through the next heartbeat announces that it has a task slot free the jobtracker will do its best to assign a task with data locality to it but failing this will assign it a random task. the number of these random tasks can be quite high, just like i mentioned above\r\n{quote} Tasks are still being evenly distributed around the ring regardless of what the ColumnFamilySplit.locations is. {quote}\r\n\r\nThis can be almost solved by upgrading to hadoop-0.21+, using the fair scheduler and setting the property {code}<property>\r\n        <name>mapred.fairscheduler.locality.delay</name>\r\n        <value>360000000</value>\r\n<property>{code}.\r\n\r\nAt the end of the day while hadoop encourages data locality it does not enforce it.\r\nThe ideal approach would be to sort all locations by proximity.\r\nThe feasible approach hopefully is still [~tjake]'s above. In addition i'd be in favour of a setting in the job's configuration as to whether a location from another datacenter can be used.\r\n\r\nreferences:\r\n - http://www.infoq.com/articles/HadoopInputFormat\r\n - http://www.mentby.com/matei-zaharia/running-only-node-local-jobs.html\r\n - https://groups.google.com/a/cloudera.org/forum/?fromgroups#!topic/cdh-user/3ggnE5hV0PY\r\n - http://www.cs.berkeley.edu/~matei/papers/2010/eurosys_delay_scheduling.pdf","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2013-05-18T21:50:22.969+0000","updated":"2013-05-18T21:50:22.969+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13667820","id":"13667820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. The feasible approach hopefully is still T Jake Luciani's above\r\n\r\nOkay.  Referring back to Jake's comments,\r\n\r\nbq. The biggest problem is [avoiding endpoints in a different DC]. Maybe the way todo this is change getSplits logic to never return replicas in another DC. I think this would require adding DC info to the describe_ring call\r\n\r\nI note that we expose node snitch location in system.peers.  So at worst we could \"join\" against that manually.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2013-05-27T16:02:01.381+0000","updated":"2013-05-27T16:02:01.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/13667902","id":"13667902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"{quote}The biggest problem is [avoiding endpoints in a different DC]. Maybe the way todo this is change getSplits logic to never return replicas in another DC. I think this would require adding DC info to the describe_ring call{quote}\r\n\r\nTasktrackers may have access to a set of datacenters, so this DC info needs contain a list of DCs.\r\n\r\nFor example, our setup separates datacenters by physical datacenter and hadoop-usage, like:{noformat}DC1 \"Production + Hadoop\"\r\n  c*01 c*03\r\nDC2 \"Production + Hadoop\"\r\n  c*02 c*04\r\nDC3 \"Production\"\r\n  c*05\r\nDC4 \"Production\"\r\n  c*06{noformat}\r\n\r\nSo here we'd pass to getSplits() a DC info like \"DC1,DC2\".\r\nBut the problem remain, given a task executing on c*01 that fails to connect to localhost, although we can now prevent a connection to DC3 or DC4, we can't favour a connection to any other split in DC1 over anything in DC2. Is this solvable? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2013-05-27T18:41:31.744+0000","updated":"2013-05-27T18:41:31.744+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14025213","id":"14025213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"body":"Attached [2.0-CASSANDRA-2388.patch|https://issues.apache.org/jira/secure/attachment/12649379/2.0-CASSANDRA-2388.patch] (against 2.0), where CASSANDRA-6302 is ported to ColumnFamilyRecordReader, so the next replicas are tried when the first one fails.\r\n\r\nReading from a non-local-DC replica is not a problem anymore due to the introduction of describe_local_ring (CASSANDRA-6268), that limits the input splits to the local DC.\r\n\r\nI would like to acknowledge my colleague Danilo Penna Queiroz who paired with me on this patch. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2014-06-09T14:19:48.838+0000","updated":"2014-06-09T14:19:48.838+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14025228","id":"14025228","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"[~pkolaczk] to review","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2014-06-09T14:41:04.762+0000","updated":"2014-06-09T14:41:04.762+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14040248","id":"14040248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"body":"[~pkolaczk] any update on this? cheers! :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2014-06-22T21:05:47.337+0000","updated":"2014-06-22T21:05:47.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14040489","id":"14040489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","emailAddress":"pkolaczk at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Ko≈Çaczkowski","active":true},"body":"[~pauloricardomg] I can't promise, but I try to do that at the end of this week. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","emailAddress":"pkolaczk at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Ko≈Çaczkowski","active":true},"created":"2014-06-23T07:44:09.867+0000","updated":"2014-06-23T07:44:09.867+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14043946","id":"14043946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"body":"Attaching patch based on 1.2.16 and fixed patch (v2) for 2.0.\r\n\r\nMaybe the 1.2 patch can still make it to 1.2.17...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2014-06-25T19:22:36.783+0000","updated":"2014-06-25T19:22:36.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14089646","id":"14089646","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"body":"[~pkolaczk] any update on this? this review has been roaming for quite some time now...\r\nsorry for bothering but would be nice to see this integrated. cheers!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2014-08-07T19:19:57.524+0000","updated":"2014-08-07T19:19:57.524+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14160882","id":"14160882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"body":"http://mail-archives.apache.org/mod_mbox/cassandra-dev/201410.mbox/%3CCALdd-zjmvp7JOtguZ_k951RQHDtFt1cthX=RnHQ332C=gAZbjw@mail.gmail.com%3E","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2014-10-06T20:27:28.323+0000","updated":"2014-10-06T20:27:28.323+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14166644","id":"14166644","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":" [~pkolaczk] + [~pauloricardomg],  AFAIK everything thrift related is frozen, so i presume the patch isn't going to be applied to master.\r\nOtherwise it's +1 on the patch from me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2014-10-10T11:16:23.350+0000","updated":"2014-10-10T11:16:23.350+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14229812","id":"14229812","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","emailAddress":"pkolaczk at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Ko≈Çaczkowski","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pkolaczk","name":"pkolaczk","emailAddress":"pkolaczk at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pkolaczk&avatarId=19617","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pkolaczk&avatarId=19617","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pkolaczk&avatarId=19617","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pkolaczk&avatarId=19617"},"displayName":"Piotr Ko≈Çaczkowski","active":true},"created":"2014-12-01T14:02:24.337+0000","updated":"2014-12-01T14:02:24.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14709548","id":"14709548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Paulo, can you rebase to 2.1?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2015-08-24T16:18:46.847+0000","updated":"2015-08-24T16:18:46.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12502417/comment/14711259","id":"14711259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"body":"Rebased 2.1 patch available [here|https://github.com/pauloricardomg/cassandra/tree/2388-2.1].\r\n\r\n2.1 tests:\r\n* [testall|http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2388-2.1-testall/lastCompletedBuild/testReport/]\r\n* [dtest|http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2388-2.1-dtest/lastCompletedBuild/testReport/]\r\n\r\n2.2 tests (don't know if {{ColumnFamilyInputFormat}} and {{ColumnFamilyRecordReader}} should be deprecated by then, but the classes are still present there):\r\n* [testall|http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2388-2.2-testall/lastCompletedBuild/testReport/]\r\n* [dtest|http://cassci.datastax.com/view/Dev/view/paulomotta/job/pauloricardomg-2388-2.2-dtest/lastCompletedBuild/testReport/]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pauloricardomg","name":"pauloricardomg","emailAddress":"pauloricardomg at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paulo Motta","active":true},"created":"2015-08-25T13:30:59.007+0000","updated":"2015-08-25T13:30:59.007+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-2388/votes","votes":6,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07hqv:"}}