{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12631681","self":"https://issues.apache.org/jira/rest/api/latest/issue/12631681","key":"SOLR-4426","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323893","id":"12323893","description":"Major release after 4.1","name":"4.2","archived":false,"released":true,"releaseDate":"2013-03-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321664","id":"12321664","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-02-11 14:30:12.351","customfield_12312323":null,"customfield_12310420":"312177","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_50008180_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-02-11T14:33:07.989+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-4426/watchers","watchCount":1,"isWatching":false},"created":"2013-02-11T00:39:39.851+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321141","id":"12321141","description":"Major release after 4.0","name":"4.1","archived":false,"released":true,"releaseDate":"2013-01-22"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:34:06.532+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312520","id":"12312520","name":"Schema and Analysis","description":"Issues and features related to the IndexSchema, FieldTypes, and Analysis (TokenizerFactory, TokenFilterFactory, etc.)"}],"timeoriginalestimate":null,"description":"SolrCore correctly defaults to a NRTCachingDirectoryFactory if no <cirectoryFactory> is explicitly specified in solrconfig.xml, but the maxCachedMB and maxMergeSizeMB parameters are not initialized with the same default values as when an explicit directory factory is specified with no argument values given.\r\n\r\nRepro:\r\n\r\nRemove the explicit directory factory from the Solr 4.1 example solrconfig.xml:\r\n\r\n{code}\r\n  <directoryFactory name=\"DirectoryFactory\" \r\n                    class=\"${solr.directoryFactory:solr.NRTCachingDirectoryFactory}\"/> \r\n{code}\r\n\r\nStart Solr.\r\n\r\nIn the console output you will see:\r\n\r\n{code}\r\nFeb 10, 2013 7:28:55 PM org.apache.solr.core.SolrDeletionPolicy onCommit\r\nINFO: SolrDeletionPolicy.onCommit: commits:num=1\r\n        commit{dir=NRTCachingDirectory(org.apache.lucene.store.SimpleFSDirectory@C:\\cygwin\\home\\projects\\solr-4.1.0\\solr-4.1.0\\example-solrconfig\\solr\\collection1\\data\\index lockFactory=org.apache.lucene.store.NativeFSLockFactory@a93430; maxCacheMB=0.0 maxMergeSizeMB=0.0),segFN=segments_1,generation=1,filenames=[segments_1]\r\nF{code}\r\n\r\nNote the \"maxCacheMB=0.0\" and \"maxMergeSizeMB=0.0\". These should be defaulting to values of 48.0 and  4.0, respectively.\r\n\r\nIn SolrCore.java we have:\r\n\r\n{code}\r\n   private void initDirectoryFactory() {\r\n    DirectoryFactory dirFactory;\r\n    PluginInfo info = solrConfig.getPluginInfo(DirectoryFactory.class.getName());\r\n    if (info != null) {\r\n      log.info(info.className);\r\n      dirFactory = getResourceLoader().newInstance(info.className, DirectoryFactory.class);\r\n      dirFactory.init(info.initArgs);\r\n    } else {\r\n      log.info(\"solr.NRTCachingDirectoryFactory\");\r\n      dirFactory = new NRTCachingDirectoryFactory();\r\n    }\r\n    // And set it\r\n    directoryFactory = dirFactory;\r\n  }\r\n{code}\r\n\r\nThe difference between an explicit directory factory with no arguments and the implicit directory factory default is that the \"init\" method is not called for the latter. It is only in the init method that the default values are set.\r\n\r\nI suggest changing NRTCachingDirectoryFactory.java from:\r\n\r\n{code}\r\npublic class NRTCachingDirectoryFactory extends StandardDirectoryFactory {\r\n  private double maxMergeSizeMB;\r\n  private double maxCachedMB;\r\n\r\n  @Override\r\n  public void init(NamedList args) {\r\n    super.init(args);\r\n    SolrParams params = SolrParams.toSolrParams(args);\r\n    maxMergeSizeMB = params.getDouble(\"maxMergeSizeMB\", 4);\r\n    if (maxMergeSizeMB <= 0){\r\n      throw new IllegalArgumentException(\"maxMergeSizeMB must be greater than 0\");\r\n    }\r\n    maxCachedMB = params.getDouble(\"maxCachedMB\", 48);\r\n    if (maxCachedMB <= 0){\r\n      throw new IllegalArgumentException(\"maxCachedMB must be greater than 0\");\r\n    }\r\n  }\r\n{code}\r\n\r\nto:\r\n\r\n{code}\r\npublic class NRTCachingDirectoryFactory extends StandardDirectoryFactory {\r\n  public static final int DEFAULT_MAX_MERGE_SIZE_MB = 4;\r\n  private double maxMergeSizeMB = DEFAULT_MAX_MERGE_SIZE_MB;\r\n  public static final int DEFAULT_MAX_CACHED_MB = 48;\r\n  private double maxCachedMB = DEFAULT_MAX_CACHED_MB;\r\n\r\n  @Override\r\n  public void init(NamedList args) {\r\n    super.init(args);\r\n    SolrParams params = SolrParams.toSolrParams(args);\r\n    maxMergeSizeMB = params.getDouble(\"maxMergeSizeMB\", DEFAULT_MAX_MERGE_SIZE_MB);\r\n    if (maxMergeSizeMB <= 0){\r\n      throw new IllegalArgumentException(\"maxMergeSizeMB must be greater than 0\");\r\n    }\r\n    maxCachedMB = params.getDouble(\"maxCachedMB\", DEFAULT_MAX_CACHED_MB);\r\n    if (maxCachedMB <= 0){\r\n      throw new IllegalArgumentException(\"maxCachedMB must be greater than 0\");\r\n    }\r\n  }\r\n{code}\r\n\r\nNote: This issue is not present in Solr 4.0 since the two parameters were hardwired in the NRTCachingDirectoryFactory.create method.\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"312523","summary":"NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if <directoryFactory> is not present in solrconfig.xml","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkrupan","name":"jkrupan","emailAddress":"jack dot krupansky at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkrupan&avatarId=22774","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkrupan&avatarId=22774","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkrupan&avatarId=22774","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkrupan&avatarId=22774"},"displayName":"Jack Krupansky","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkrupan","name":"jkrupan","emailAddress":"jack dot krupansky at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkrupan&avatarId=22774","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkrupan&avatarId=22774","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkrupan&avatarId=22774","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkrupan&avatarId=22774"},"displayName":"Jack Krupansky","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":3,"total":3,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631681/comment/13575807","id":"13575807","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[trunk commit] Shalin Shekhar Mangar\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1444782\r\n\r\nSOLR-4426: NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if <directoryFactory> is not present in solrconfig.xml\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-02-11T14:30:12.351+0000","updated":"2013-02-11T14:30:12.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631681/comment/13575814","id":"13575814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[branch_4x commit] Shalin Shekhar Mangar\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1444786\r\n\r\nSOLR-4426: NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if <directoryFactory> is not present in solrconfig.xml\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-02-11T14:40:11.594+0000","updated":"2013-02-11T14:40:11.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631681/comment/13654122","id":"13654122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Closed after release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-05-10T10:34:06.529+0000","updated":"2013-05-10T10:34:06.529+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-4426/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1hvg7:"}}