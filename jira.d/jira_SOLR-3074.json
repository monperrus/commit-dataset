{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12540328","self":"https://issues.apache.org/jira/rest/api/latest/issue/12540328","key":"SOLR-3074","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319065","id":"12319065","description":"Major release after 3.5","name":"3.6","archived":false,"released":true,"releaseDate":"2012-04-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314992","id":"12314992","description":"Alpha release of 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-02-02 00:47:42.543","customfield_12312323":null,"customfield_12310420":"225741","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4531762299_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-03-22T19:33:48.934+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-3074/watchers","watchCount":2,"isWatching":false},"created":"2012-01-30T08:44:26.971+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317876","id":"12317876","description":"Major release after 3.4","name":"3.5","archived":false,"released":true,"releaseDate":"2011-11-27"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iorixxx","name":"iorixxx","emailAddress":"iorixxx at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=iorixxx&avatarId=18545","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=iorixxx&avatarId=18545","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=iorixxx&avatarId=18545","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=iorixxx&avatarId=18545"},"displayName":"Ahmet Arslan","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:40:06.607+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310674","id":"12310674","name":"search","description":"Query the search collection"}],"timeoriginalestimate":null,"description":"testDocListConversion() is not testing what it's suppossed to test. Because added test documents are not committed.\r\n\r\nhttp://search-lucene.com/m/uwh9l2SHH4e","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"18162","summary":"SolrPluginUtils.docListToSolrDocumentList is broken, existing test is also broken","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iorixxx","name":"iorixxx","emailAddress":"iorixxx at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=iorixxx&avatarId=18545","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=iorixxx&avatarId=18545","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=iorixxx&avatarId=18545","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=iorixxx&avatarId=18545"},"displayName":"Ahmet Arslan","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iorixxx","name":"iorixxx","emailAddress":"iorixxx at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=iorixxx&avatarId=18545","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=iorixxx&avatarId=18545","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=iorixxx&avatarId=18545","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=iorixxx&avatarId=18545"},"displayName":"Ahmet Arslan","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12540328/comment/13198402","id":"13198402","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Ahmet: thanks for raising this issue, and for your patch.\r\n\r\nyou didn't mention it in jira, but in your linked email you suggested that the method being tested (docListToSolrDocumentList) isn't actually doing what it's suppose to...\r\n\r\n{quote}\r\nRegardless of Set<String> fields parameter, SolrPluginUtils#docListToSolrDocumentList method loads all of the stored fields. Shouldn't it just load the fields given in the set? Should I file a jira ticket?\r\n{quote}\r\n\r\nDigging deeper, i found two problems...\r\n* docListToSolrDocumentList is delegating the field list to SolrIndexSearcher.doc, which means those fields are read immediately, but the rest of the fields will be lazy loaded\r\n* docListToSolrDocumentList is calling DocumentBuilder.loadStoredFields which loads all of the fields -- regardless of which field list was passed to docListToSolrDocumentList\r\n* docListToSolrDocumentList has some really bizare code in it, preventing stored fields from being returned if they are the result of a copyField.\r\n\r\nSince there are no other usages of DocumentBuilder.loadStoredFields in Solr, it's not clear to me what the intended point of it's crazy logic was\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2012-02-02T00:47:42.543+0000","updated":"2012-02-02T00:47:42.543+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12540328/comment/13198407","id":"13198407","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"additions to Ahmet's patch showing the additional problems found.\r\n\r\ngiven that neither of these two methods are used anywhere in Solr, and they are so clearly broken i suggest we deprecate them in 3.6 as \"completely broken\" and remove in trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2012-02-02T00:50:05.262+0000","updated":"2012-02-02T00:50:05.262+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12540328/comment/13234039","id":"13234039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"barring objections i'm going to...\r\n\r\n* remove these methods in trunk\r\n* mark then \"@deprecated apparently  this method has behaved as documented for a very long time, and is unneeded in Solr, so it is deprecated and will be removed in Solr 4\" in 3x\r\n\r\n...tomorrow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2012-03-21T02:23:42.639+0000","updated":"2012-03-21T02:23:42.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12540328/comment/13234814","id":"13234814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"bq. remove these methods in trunk\r\n\r\n+1\r\n\r\n\r\nI *think* this was used long ago before the javabin format took over serializing DocList ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2012-03-21T18:29:30.653+0000","updated":"2012-03-21T18:29:30.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12540328/comment/13235264","id":"13235264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Oy...\r\n\r\nso i started down the road of removing all this from trunk, and then realized i somehow overlooked the fact that clustering is using docListToSolrDocumentList\r\n\r\nso then i started trying to fix clustering to have the logic it needed, and then realized that the code i wound up with actually implemented the documented contract of docListToSolrDocumentList in a way that made the new tests in this issue pass.\r\n\r\nSo this new patch:\r\n* fixes docListToSolrDocumentList\r\n* fixes the test for docListToSolrDocumentList\r\n* removes DocumentBuilder.loadStoredFields\r\n\r\nmy _new_ plan is to commit as is to trunk, and backport all but the DocumentBuilder.java changes to 3x (i'll just deprecate loadStoredFields in 3x)\r\n\r\ncomments?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2012-03-22T00:50:34.982+0000","updated":"2012-03-22T00:50:34.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12540328/comment/13235932","id":"13235932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"r1303977 - trunk fix of SolrPluginUtils & test, removal of loadStoredFields method\r\n\r\nr1304001 - backport to 3x, but leave loadStoredFields in place with a scary freaking deprecation warning.\r\n\r\nAhmet: thanks for your report and especially for your test case","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2012-03-22T19:33:49.172+0000","updated":"2012-03-22T19:33:49.172+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-3074/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03guf:"}}