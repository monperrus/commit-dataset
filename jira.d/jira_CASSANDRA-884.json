{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12458977","self":"https://issues.apache.org/jira/rest/api/latest/issue/12458977","key":"CASSANDRA-884","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314361","id":"12314361","description":"","name":"0.6","archived":false,"released":true,"releaseDate":"2010-04-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-03-16 20:57:48.784","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"1_*:*_1_*:*_502469569_*|*_5_*:*_2_*:*_94206559_*|*_4_*:*_1_*:*_7234398","customfield_12310420":"19902","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-03-19T20:36:09.940+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-884/watchers","watchCount":2,"isWatching":false},"created":"2010-03-12T20:50:59.414+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-05-31T23:29:19.100+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"I've noticed that both 0.5.1 and 0.6b2 return multiple identical copies of the data stored in my keyspace whenever I make a call to get_range_slice or get_range_slices using\r\nConsistencyLevel.QUORUM and ReplicationFactor is greater than one.\r\n\r\nSo with ReplicationFactor set to 2 for my application's KeySpace I get double the number of KeySlices that I expect to get. When using ConsistencyLevel.ONE I get only one KeySlice for each row.\r\n\r\nI've seen this happen with Cassandra 0.5.1 and with 0.6 beta 2. The behavior on 0.6 beta 2 is exhibited with both get_range_slice and get_range_slices.\r\n\r\nThe attached Java program demonstrates the issue for 0.6 beta 2. The program writes a series of single-column rows into the Standard1 table, and then uses get_range_slice to receive a list of all row. The returned number of rows is consistently twice the number of rows written to the database. I wipe out the database completely before running the test.\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12438957","id":"12438957","filename":"0001-RangeSliceResponseResolver.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"created":"2010-03-16T20:28:53.478+0000","size":869,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12438957/0001-RangeSliceResponseResolver.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12438962","id":"12438962","filename":"884-v2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-03-16T20:57:48.772+0000","size":1484,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12438962/884-v2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12438639","id":"12438639","filename":"TestApp2.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"created":"2010-03-12T20:53:46.812+0000","size":3358,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12438639/TestApp2.java"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"91701","summary":"get_range_slice returns multiple copies of each row for ConsistencyLevel > ONE","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":"4-cluster Gentoo Linux 2.6.18 with a ReplicationFactor of 2","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":13,"total":13,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12844674","id":"12844674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"body":"The attached Java program demonstrates that multiple copies of rows are returned by get_range_slice. At least it does here :-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"created":"2010-03-12T20:53:46.820+0000","updated":"2010-03-12T20:53:46.820+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12846106","id":"12846106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"body":"I think I have identified the source of my problem. I'm still new to the Cassandra source code so I could have this completely wrong. The patch is for the 0.6 version of org.apache.cassandra.service.RangeSliceResponseResolver.\r\n\r\nRemoving redundant copies of returned rows appears to happen in the RangeSliceResponseResolver class. This class uses an anonymous innner class that extends ReducingIterator to weed out the duplicates.\r\n\r\nReducingIterator provides a computeNext() method that compares successive items to see if they are duplicates. It does this by comparing the current and previous ('last') items to its isEqual() method.\r\n\r\nRangeSliceResponseResolver does not override that isEqual method. That causes Pair<Row, InetAddress> objects to be compared with each other.  The ReducingIterator.isEqual method always returns false, because (1)  Row doesn't specify an equals() method and (2) even if it did, the InetAddresses of rows retrieved from different Cassandra instances would still be different. This causes each row to be seen as unique.\r\n\r\nThe attached patch repairs this by providing the ReducingIterator derivative in RangeSliceResponseResolver with an isEqual() method that compares the key and cf members of the Row objects. It ignores the InetAddress component of the Pair.\r\n\r\nAlternatively I could have added an equals() method to Row which would have simplified the isEqual() method in RangeSliceResponseResolver.java a bit.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"created":"2010-03-16T20:28:53.510+0000","updated":"2010-03-16T20:28:53.510+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12846120","id":"12846120","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Your analysis is spot on, good work there.\r\n\r\nI think though that equals should just look at the key: we want to collect (in the \"reduced\" list) all versions of the rows associated with that key, so we can repair any differences.  If we only collect identical versions together then the repair is a no-op.\r\n\r\nAttached is a diff that makes this change and adds a missing versionSources.clear() call.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-03-16T20:57:48.784+0000","updated":"2010-03-16T20:57:48.784+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12846121","id":"12846121","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Can you test v2?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-03-16T20:58:03.257+0000","updated":"2010-03-16T20:58:03.257+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12846969","id":"12846969","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"body":"Your v2 patch works for me. The attached TestApp2 now gives back the expected result. Also, all JUnit test cases for my Cassandra-using application now pass. Thanks!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"created":"2010-03-18T16:05:59.278+0000","updated":"2010-03-18T16:05:59.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12846978","id":"12846978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-03-18T16:25:28.963+0000","updated":"2010-03-18T16:25:28.963+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12847505","id":"12847505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"body":"We've started using the wrapper API I've written for Cassandra for light development here and quite unexpectedly I've started getting NullPointerExceptions whenever a get_range_slices request is performed against a particular CF. The CF in question has a replication factor of 2. get_range_slices still works fine against the Standard1 CF that's exercised by the TestApp2 file included in this ticket. In my storage-conf.xml Standard1 is set up with a replication factor of 3.\r\n\r\nHere is the stack trace I'm seeing over and over again, on each of my 4 servers:\r\n\r\nERROR [pool-1-thread-64] 2010-03-19 12:23:30,119 Cassandra.java (line 1440) Internal error processing get_range_slices\r\njava.lang.NullPointerException\r\n        at org.apache.cassandra.service.RangeSliceResponseResolver$2.isEqual(RangeSliceResponseResolver.java:81)\r\n        at org.apache.cassandra.service.RangeSliceResponseResolver$2.isEqual(RangeSliceResponseResolver.java:74)\r\n        at org.apache.cassandra.utils.ReducingIterator.computeNext(ReducingIterator.java:69)\r\n        at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:135)\r\n        at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:130)\r\n        at org.apache.cassandra.service.RangeSliceResponseResolver.resolve(RangeSliceResponseResolver.java:101)\r\n        at org.apache.cassandra.service.RangeSliceResponseResolver.resolve(RangeSliceResponseResolver.java:41)\r\n        at org.apache.cassandra.service.QuorumResponseHandler.get(QuorumResponseHandler.java:86)\r\n        at org.apache.cassandra.service.StorageProxy.getRangeSlice(StorageProxy.java:592)\r\n        at org.apache.cassandra.thrift.CassandraServer.getRangeSlicesInternal(CassandraServer.java:587)\r\n        at org.apache.cassandra.thrift.CassandraServer.get_range_slices(CassandraServer.java:559)\r\n        at org.apache.cassandra.thrift.Cassandra$Processor$get_range_slices.process(Cassandra.java:1432)\r\n        at org.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:1115)\r\n        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:253)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n        at java.lang.Thread.run(Thread.java:619)\r\n\r\nAdditional notes:\r\nI'm using revision 924837 of the Cassandra 0.6 branch which includes the patch above. For some reason the line numbers in RangeSliceResponseResolver seem to be off by one in the stack trace, but I'm positive that it's the patched version being used with the isEqual() method that tests only the keys.\r\n\r\nI guess this might be fixed by adding a few null checks to that isEqual() method, but perhaps that would just be hiding a problem somewhere else in the code.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"created":"2010-03-19T18:35:35.473+0000","updated":"2010-03-19T18:35:35.473+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12847513","id":"12847513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Can you add this to isEqual to see which part is null?  You're right, that \"shouldn't happen,\" let's not just band-aid w/ null checks.\r\n\r\n                assert o1 != null && o2 != null : \"null pair\";\r\n                assert o1.left != null && o2.left != null : \"null row\";\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-03-19T18:56:37.784+0000","updated":"2010-03-19T18:56:37.784+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12847556","id":"12847556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"body":"During my last build an apache-casssandra-0.6-b2.jar somehow made its way into the lib directories, overriding the newer 0.6-b3.jar that I should have been using. I removed the older apache-casssandra-0.6-b2.jar file that contained my older patch, restarted my instances and the problem disappeared. So it looks likely that this was operator error on my part. \r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=omerhj","name":"omerhj","emailAddress":"omerhj at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Omer van der Horst Jansen","active":true},"created":"2010-03-19T20:26:33.310+0000","updated":"2010-03-19T20:26:33.310+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12847563","id":"12847563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"k, marking closed again","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-03-19T20:36:09.937+0000","updated":"2010-03-19T20:36:09.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12873785","id":"12873785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajslater","name":"ajslater","emailAddress":"aj at slater dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AJ Slater","active":true},"body":"Please re-open or duplicate.\r\n\r\nTesting with 0.6-trunk today:\r\n\r\nReading with CL > ONE returns multiple copies of the same column per key consistent with the replicas queried before return. i.e,  for RC=3, a QUORUM read yields 2 copies and an ALL read returns 3.\r\nThis is with pycassa get_range() which is using get_range_slice()\r\n\r\nI see the same behavior with 0.6.1 and 0.6.2 debs\r\n\r\nIf my experience is not unique, anyone using get_range_slice is now deluged with duplicate data.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajslater","name":"ajslater","emailAddress":"aj at slater dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AJ Slater","active":true},"created":"2010-05-31T21:07:49.556+0000","updated":"2010-05-31T21:07:49.556+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12873805","id":"12873805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"AJ, can you create a new issue with some sample code to reproduce what you are seeing?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-05-31T22:16:55.057+0000","updated":"2010-05-31T22:16:55.057+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12458977/comment/12873824","id":"12873824","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajslater","name":"ajslater","emailAddress":"aj at slater dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AJ Slater","active":true},"body":"CASSANDRA-1145 Opened","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ajslater","name":"ajslater","emailAddress":"aj at slater dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"AJ Slater","active":true},"created":"2010-05-31T23:29:19.058+0000","updated":"2010-05-31T23:29:19.058+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-884/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g1o7:"}}