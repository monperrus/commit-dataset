{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12389381","self":"https://issues.apache.org/jira/rest/api/latest/issue/12389381","key":"DERBY-3454","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-02-25 19:56:34.966","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23647","customfield_12310222":"1_*:*_1_*:*_3793796082_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-04-07T09:06:38.314+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3454/watchers","watchCount":0,"isWatching":false},"created":"2008-02-23T11:16:42.232+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12319497","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12319497","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12386188","key":"DERBY-3318","self":"https://issues.apache.org/jira/rest/api/2/issue/12386188","fields":{"summary":"Missing clean-up after failed startMaster","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:51:32.051+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312050","id":"12312050","name":"Replication"}],"timeoriginalestimate":null,"description":"The 'java.lang.NullPointerException' exception is thrown when a database is started in a master mode and is trying to establish a connection to an slave database socket, which is not available.\n\nThe exception is by the MasterController#startMaster(). First, it tries to setup connection with a slave database using a transmitter:\n    MasterController#setupConnection\n       -> transmitter = new ReplicationMessageTransmit(); \n            transmitter.initConnection()\n              -> new InetSocketAddress() -> createSocket() -> connect()\n\nThe connect() method throws a ConnectException, and so fails to create a socketConn instance. The exception is then wrapped several times an propagated back to the MasterController#startMaster() method. It's caught there and then a MasterController#teardownNetwork() method is called, which tries to send a STOP message using the aforementioned transmitter, which hasn't been able to init a connection. \n\nA transmitter simply tries to call socketConn.writeMessage(message), which throws NPE because socketConn is null.\n\nThanks!","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37327","summary":"'java.lang.NullPointerException' is thrown when starting a master db before a slave one","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=serge.tsv","name":"serge.tsv","emailAddress":"serge dot tsv at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Serge Tsv","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=serge.tsv","name":"serge.tsv","emailAddress":"serge dot tsv at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Serge Tsv","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":10,"total":10,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12571721","id":"12571721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=serge.tsv","name":"serge.tsv","emailAddress":"serge dot tsv at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Serge Tsv","active":true},"body":"This problem could be reproduced by simply creating a connection with a startMaster=true to an unestablished socket.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=serge.tsv","name":"serge.tsv","emailAddress":"serge dot tsv at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Serge Tsv","active":true},"created":"2008-02-23T11:18:25.725+0000","updated":"2008-02-23T11:18:25.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12572196","id":"12572196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"tearDown is called in the startMaster method. The start failure and consequently the tearDown \r\nis caused by the failure to establish a socket connection. Hence in the tearDown method \r\ntrying to send a STOP message through a socket that does not exist results in a \r\nNullPointerException.\r\n\r\nAll the public methods of ReplicationMessageTransmit and ReplicationMessageReceive should\r\nensure that the socket connection exists (is not null) before performing the respective\r\noperations. If the socket connection does not exist readMessage returns null and the sendMessage\r\nmethod returns quietly.\r\n\r\nMethods in ReplicationMessageTransmit\r\n-------------------------------------\r\n\r\n* tearDown()\r\n* sendMessage()\r\n* readMessage()\r\n\r\nMethods in ReplicationMessageReceive\r\n------------------------------------\r\n\r\n* sendMessage()\r\n* readMessage()\r\n\r\n\r\nThe other methods in these classes must use the sendMessage and the readMessage methods and not\r\ncall socketConn.writeMessage, socketConn.readMessage on their own. This would ensure that\r\n\"socket connection connection exist\" checks are restricted to the read and the write methods only.\r\n\r\nNote: The case of active=false on the master and the transmitter being called to send a message\r\n      is a unique case. This happens only when the tearDown is called because of a network(socket)\r\n      connection failure. Hence here it is safe to exit quietly from a send or read attempt on a\r\n      non-existent socket.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-02-25T19:56:34.966+0000","updated":"2008-02-25T19:56:34.966+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12573642","id":"12573642","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Pls find attached a patch. Below is a file by file explanation of the\r\npatch attached.\r\n\r\nM      java/engine/org/apache/derby/impl/services/replication/net/ReplicationMessageTransmit.java\r\n\r\n* Introduced not null checks for sockConn in tearDown\r\n* Introduced a method that throws an exception if sockConn is null and used it\r\n  in the methods that send and receive messages.\r\n\r\nM      java/engine/org/apache/derby/impl/services/replication/net/ReplicationMessageReceive.java\r\n\r\n* The changes to this file are identical to changes done on ReplicationMessageTransmit\r\n  except that I change some places where sockConn is called directly to send messages\r\n  to use the sendMessage method instead.\r\n\r\nM      java/engine/org/apache/derby/loc/messages.xml\r\nM      java/shared/org/apache/derby/shared/common/reference/MessageId.java\r\n\r\n* Introduced one Message for the IOException that is thrown upon SocketConnection object being\r\nnull\r\n\r\nI ran the repro. Pls find the repro output below.\r\n\r\nij> connect 'jdbc:derby://localhost:1527/replicationdb';\r\nij> connect 'jdbc:derby://localhost:1527/replicationdb;startMaster=true;slaveHost=localhost;slavePort=8002';\r\nERROR XRE04: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE04, SQLERRMC: replicationdblocalhost8002XRE04\r\nij> connect 'jdbc:derby://localhost:1527/replicationdb;startMaster=true;slaveHost=localhost;slavePort=8003';\r\nERROR XRE04: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE04, SQLERRMC: replicationdblocalhost8002XRE04\r\nij> connect 'jdbc:derby://localhost:1527/replicationdb;startMaster=true;slaveHost=localhost;slavePort=8001';\r\nERROR XRE04: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE04, SQLERRMC: replicationdblocalhost8002XRE04\r\nij>\r\n\r\nYou don't see the null pointer exceptions any more.\r\n\r\n8001 is the correct port. The connection with the correct port also fails because of Derby-3358.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-02-29T09:08:07.880+0000","updated":"2008-02-29T09:08:07.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12574091","id":"12574091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=serge.tsv","name":"serge.tsv","emailAddress":"serge dot tsv at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Serge Tsv","active":true},"body":"Hello!\r\n\r\nHave applied the patch to the trunk, and I see the same XRE04 error instread of NPE now. :-) \r\nI assume that it verifies that the tearDown method is implemented properly now.\r\n\r\nI have a one small suggestion though. Could it be considered to throw a runtime exception \r\n(like an IllegalStateException) other then  an IOException in the case when we try to use a \r\nconnection which hasn't been established (except for a tearDown method)? I think the \r\nreceiver/transmitter shouldn't be accessed at all after an exception is thrown during an \r\ninitialization, which is a case when socket couldn't be established. \r\n\r\nThe XRE04 error will still be reported in this case. And if the runtime exception is used, \r\nthen an introduction of a new error message won't be required I guess.\r\n\r\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=serge.tsv","name":"serge.tsv","emailAddress":"serge dot tsv at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Serge Tsv","active":true},"created":"2008-03-01T11:00:14.605+0000","updated":"2008-03-01T11:00:14.605+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12574095","id":"12574095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Thank you for trying out the patch Serge :)\r\n\r\n>Could it be considered to throw a runtime exception\r\n>(like an IllegalStateException) other then an IOException \r\n>in the case when we try to use a connection which hasn't \r\n>been established (except for a tearDown method)?\r\n\r\nI do not think it is advisable to throw unchecked exceptions\r\nunless in cases where an alternate checked exception is not\r\npossible\r\n\r\n>I think the receiver/transmitter shouldn't be accessed at all \r\n>after an exception is thrown during an initialization, which is \r\n>a case when socket couldn't be established.\r\n\r\nA receiver or an transmitter is an abstraction above the underlying\r\nconnection. Why do you think accessing the transmitter or receiver is\r\nwrong?\r\n\r\nI do agree that attempting a send from the transmitter seems illogical\r\nwhen the connection does not exist, but then the transmitter is an\r\nabstraction above the connection and is insulated from the conenction\r\ndetails. Only when it tries to access the underlying connection does\r\nit know that the connection is no longer valid and gets an exception.\r\n\r\n>The XRE04 error will still be reported in this case. And if the \r\n>runtime exception is used, then an introduction of a new error \r\n>message won't be required I guess. \r\n\r\nIf this had been true the NPE (which is also a RuntimeException)\r\nwould have resulted in a XRE04 :). I do not think we will get a\r\nXRE04 if a RuntimeException is thrown.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-01T11:52:38.967+0000","updated":"2008-03-01T11:52:38.967+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12574414","id":"12574414","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Thanks for the patch, Narayanan.  Looks good.  Committed as revision 633026.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-03T10:25:10.216+0000","updated":"2008-03-03T10:25:10.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12574416","id":"12574416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Forgot to comment that I feel the message text for R012 could be improved.\r\nI suggest: \"No replication connection for database <dbname>.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-03T10:28:25.606+0000","updated":"2008-03-03T10:28:25.606+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12574612","id":"12574612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=serge.tsv","name":"serge.tsv","emailAddress":"serge dot tsv at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Serge Tsv","active":true},"body":"V.Narayanan, thanks for your comments!\r\n\r\nI see the following generic use case for receiver/transmitter classes:\r\n\r\n1. A receiver/transmitter instance is created.\r\n2. An initConnection method is called on the created instance\r\n3. sendMessage/readMessage calls are executed on the initialized \r\n     receiver/transmitter instance\r\n\r\nFor the flow above:\r\n   * If (3) is executed before (2), then I guess this would be a programmatic error \r\n     and a RE should be called (like IllegalStateException)\r\n   * If (2) fails, I do also consider executing (3) after that as a programmatic error, \r\n      because in this case a transmitter/receiver hasn't been properly initialized. \r\n      And there's an attempt to use a transmitter/receiver which has turned up to\r\n      be in an illegal state.\r\n\r\nYou're right that the transmitter/receiver is an abstraction above the connection.\r\nBut I'm just trying to say that it might be wrong (from a programmatic point of view)\r\nto try to use them in an illegal state. And might be better to properly process a (2)\r\nfailure and make it so sendMessage/readMessage methods won't be called \r\nafterwards, instead of relying on an IOException been reported to a user.\r\n\r\n> If this had been true the NPE (which is also a RuntimeException)\r\nwould have resulted in a XRE04 :).\r\n\r\nI think that XRE04 is thrown by an initConnection method. The NPE was caused \r\nby a tearDown method, and now it's been fixed, and there're no further calls to\r\nsendMessage/readMessage in case of XRE04.\r\n\r\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=serge.tsv","name":"serge.tsv","emailAddress":"serge dot tsv at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Serge Tsv","active":true},"created":"2008-03-03T17:06:17.625+0000","updated":"2008-03-03T17:06:17.625+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12574826","id":"12574826","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Thank you for the comments Serge :)\r\n\r\n>For the flow above:\r\n>   * If (3) is executed before (2), then I guess this would be a programmatic error \r\n>     and a RE should be called (like IllegalStateException)\r\n\r\nI would try to correct the case when (3) is called before (2) (fix the programming error)\r\nthan throw an IllegalStateException\r\n\r\n\r\n>   * If (2) fails, I do also consider executing (3) after that as a programmatic error, \r\n>      because in this case a transmitter/receiver hasn't been properly initialized. \r\n>      And there's an attempt to use a transmitter/receiver which has turned up to\r\n>      be in an illegal state.\r\n\r\n>You're right that the transmitter/receiver is an abstraction above the connection.\r\n>But I'm just trying to say that it might be wrong (from a programmatic point of view)\r\n>to try to use them in an illegal state. And might be better to properly process a (2)\r\n>failure and make it so sendMessage/readMessage methods won't be called \r\n>afterwards, instead of relying on an IOException been reported to a user.\r\n\r\n* If there is a programmatic error causing an Unchecked Exception to be thrown (like an NPE)\r\n  I would not correct it by throwing another Unchecked Exception (IllegalStateException)\r\n\r\n* If there is a programmatic error that causes an Unchecked Exception to be thrown,like, (3)\r\n  before (2) I would correct the programmatic error than throw an unchecked exception\r\n\r\n* I do not agree that Properly processing a (2) failure = throwing an unchecked exception.\r\n\r\n* I am properly processing (2) when I try to ensure that the underlying connection is valid\r\n  before attempting a send or a receive.\r\n\r\n* Now that all transmitter methods verify that the underlying connection is not invalid using\r\n  the checkSocketConnection() method the there would be no danger of attempting (3) with a\r\n  invalid connection.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-04T03:22:02.457+0000","updated":"2008-03-04T03:22:02.457+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389381/comment/12586283","id":"12586283","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"All relevant patches have been submitted and committed.\r\nResolving issue!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-04-07T09:06:38.264+0000","updated":"2008-04-07T09:06:38.264+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3454/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06r47:"}}