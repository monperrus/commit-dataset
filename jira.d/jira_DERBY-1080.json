{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12329863","self":"https://issues.apache.org/jira/rest/api/latest/issue/12329863","key":"DERBY-1080","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-03-08 21:47:40.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22294","customfield_12310222":"1_*:*_1_*:*_3107346000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_7841938000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-04-12T07:25:50.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1080/watchers","watchCount":0,"isWatching":false},"created":"2006-03-07T08:16:44.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"11.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10920","id":"10920","description":"initial source drop","name":"10.0.2.0","archived":false,"released":true,"releaseDate":"2004-08-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/10991","id":"10991","description":"snapshot","name":"10.0.2.1","archived":false,"released":true,"releaseDate":"2004-12-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12312068","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12312068","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"12328892","key":"DERBY-962","self":"https://issues.apache.org/jira/rest/api/2/issue/12328892","fields":{"summary":"Upgrade default security mechanism in client to use encrypted userid password if client can support it.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-07-12T01:44:48.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"}],"timeoriginalestimate":null,"description":"if connection is reset,  the security mechanism related information for EUSRIDPWD is not reset correctly and this leads to a protocol error. \n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40551","summary":"Connection reset when using security mechanism=EUSRIDPWD results in protocol error.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":19,"total":19,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12369282","id":"12369282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"This patch Derby1080.diff.txt provides a fix to ensure that on a connection reset, we dont throw too many codepoint error when reading SECTKN on a parseSECCHK when EUSRIDPWD security mechanism  is used.\r\n\r\nOverview:\r\nDRDA spec, mentions this in section about connection pooling:\r\n\"Allows an application requester to reuse an existing network connection for a different\r\napplication once an application disconnects from the connection either by terminating or by\r\nreleasing the connection.\r\nAn application requester or application server at AGENT manager level 7 indicates the\r\nsupport of flowing the EXCSAT, ACCSEC, SECCHK, and ACCRDB commands after a\r\nsuccessful commit or rollback to initialize a connection on behalf of a new application.\"\r\n\r\nThe DDM manual (pg54) for the ACCSEC command states that \r\n\"The source server can send repeated ACCSEC commands when it wants to reuse a connection\r\nfor another application or transaction. The ACCSEC must be preceded by an EXCSAT, and\r\nfollowed by a SECCHK and ACCRDB.\"\r\n\r\nIn the NetworkServer code:  we have comments in parseEXCSAT() which mentions about connection resets \r\nwhere a EXCSAT is followed by an ACCSEC  (see DRDAConnThread.line 1222-1235)\r\n\r\nCouple things to note:\r\n1)On a parseACCSEC, on a RDBNAM , we can re-use the database object. Database stored information for \r\n the decryptedUserId and decryptedPassword which is used only for EUSRIDPWD security mechanism case. \r\n\r\n2)ACCSEC is followed by SECCHK. On parseSECCHK, for the SECTKN codepoint we check if \r\ndatabase.decryptedUserId and decryptedPassword is null and if so only then read the sectkn's that \r\nare sent by client.  (see method parseSECCHK/case CodePoint.SECTKN)\r\n\r\n3)On a re-use of a connection, since reset of the 2 variables in database does not happen, on a \r\nSECCHK flow, we incorrectly throw an error that too many codepoints sent. The error can only be seen when \r\nEUSRIDPWD security mechanism is used since only this requires the flow of SECTKN for encrypted Userid and password\r\nthat is sent from the client.  \r\n\r\nFix: \r\nThis patch fixes the case for EUSRIDPWD where this problem happens. For other security mechanisms the fields decryptedUserId and decryptedPassword is not used. Reset decryptedUserId and decryptedPasword on a parseACCSEC/RDBNAM to null.\r\n\r\nsvn stat:\r\nM      java\\drda\\org\\apache\\derby\\impl\\drda\\DRDAConnThread.java\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\derbynet\\testSecMec.java\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\testSecMec.out\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\ver2.6\\testSecMec.out\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\ibm14\\ver2.6\\testSecMec.out\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\ibm14\\testSecMec.out\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNetClient\\testSecMec.out\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNetClient\\ibm14\\testSecMec.out\r\n\r\nI have a feeling we need to investigate more into this connection pooling (connection reset) as well \r\nas transaction pooling. Maybe someone with more knowledge can comment on how transaction pooling \r\nhappens in network server. \r\n\r\nI ran derbyall on ibm142/linux ok with known failures(stress.multi and surtest).\r\nI ran derbynet/testSecMec.java for both JCC and client driver on ibm131/ibm141/ibm142/ibm15 as well as sun jvms 131/142/15.\r\n\r\nCan someone please review this change. Thanks. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-08T02:30:37.000+0000","updated":"2006-03-08T02:30:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12369447","id":"12369447","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks for the patch Sunitha. I applied it and ran derbynetmats and derbynetclientmats and all passed.\r\nYour change looks like it would resolve the problem but I think it would be better to put a reset() method in Database.java rather than resetting the variables  directly in DRDAConnThread. \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-03-08T21:47:40.000+0000","updated":"2006-03-08T21:47:40.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12369926","id":"12369926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"I am attaching a patch for Bryan's comments in\r\nhttp://www.nabble.com/Re%3A-jira-Updated%3A-%28DERBY-1080%29-Connection-reset-when-using-security-mechanism%3DEUSRIDPWD-results-in-protocol-error.-p3293695.html\r\n\r\nThanks Bryan and Kathey for looking at this patch.  \r\n\r\nThis patch (Derby1080.2.diff.txt) makes the following change compared to previous Derby1080.diff.txt.\r\n\r\n1) Reset of database.decryptedUserId and decryptedPassword is moved from DRDAConnThread to Database.reset(). Note: that these 2 variables were not correctly reset for connection-reuse which was causing the problem mentioned in this jira. This patch adds reset() method in Database and resets the above 2 variable and also resets the variables related to security mechanism only.\r\n\r\nI talked to Kathey on IRC about this:\r\n-- the above change fixes this particular problem in this issue.\r\n-- But more investigation is required for database reset when connection pooling and transaction pooling is done. \r\n-- File a jira so the reset cleanup can be done after investigation. \r\nDoes this sound reasonable ?\r\n\r\n2) I have reorganized the regression test and added lots of comments. I hope they are helpful in understanding the expected results. \r\n\r\n3) Bryan asked\"Lastly, would your test have been any different if you had used\r\nConnectionPoolDataSource.getPooledConnection(String user, String password)\r\nrather than ConnectionPoolDataSource.getPooledConnection()? \"\r\n\r\nThe result would be the same.  For eusridpwd case, the client sends the encrypted userid and password sectkns as part of SECCHK. The protocol error was happening because we only read the 2 sectkns if the database.decryptedUserId , database.decryptedPassword is null,  otherwise we think we have already read this. Thus on a connection reset,if the decryptedUserId and decryptedPassword are not reset, server assumes we have seen more SECTKN's and thus we throw error too many codepoints.\r\n\r\nPer the code: The userid/password passed in getPooledConnection will be the user and password that is used. If userid and password is not  set in getPooledConnection, then the information is retrieved from the ConnectionPoolDataSource. \r\n\r\nsvn stat:\r\n\r\ncode change\r\nM      java\\drda\\org\\apache\\derby\\impl\\drda\\Database.java\r\nM      java\\drda\\org\\apache\\derby\\impl\\drda\\DRDAConnThread.java\r\n\r\ntest change\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\derbynet\\testSecMec.java\r\n\r\nmaster file for JCC2.4 driver and for IBM131, Sun JVM131,141,142,15.\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\testSecMec.out\r\n\r\nmaster file for JCC2.6 driver and for IBM131, Sun JVM(versions 131,141,142,15)\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\ver2.6\\testSecMec.out\r\n\r\nmaster file for JCC2.6 driver and for IBM (versions 141,142,15). Note these jvms support the EUSRIDPWD security mechanism.\r\nM     java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\ibm14\\ver2.6\\testSecMec.out\r\n\r\nmaster file for JCC2.4 driver and for IBM(versions 141,142,15). Note these jvms support the EUSRIDPWD security mechanism.\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\ibm14\\testSecMec.out\r\n\r\nmaster file for client driver and for IBM131, Sun JVM (versions 131,141,142,15)\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNetClient\\testSecMec.out\r\n\r\nmaster file for client driver and for IBM jvm (versions 141,142,15)\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNetClient\\ibm14\\testSecMec.out\r\n\r\nTest ran ok with derbynetclientmats and derbynet with ibm142 on linux with known failures in surtest and stress.multi. \r\ntestSecMec.java was run with derby client, JCC2.4,JCC2.6 with ibm131,ibm141,ibm142,ibm15,sun - jdk131,141,142,15 ok.\r\n\r\nPlease review this change.  Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-11T05:41:28.000+0000","updated":"2006-03-11T05:41:28.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12369952","id":"12369952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"This issue requires DERBY-1080 to be fixed. Also both these issues affect one same file so patch for 962 wont cleanly apply for the file (testSecMec.java).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-11T09:56:46.000+0000","updated":"2006-03-11T09:56:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370212","id":"12370212","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"If there are no issues, I'd appreciate if someone can commit this patch (derby1080.2.diff.txt).   Thanks. \r\nHere is the short description for checkin comment. \r\n--------------------------------------------------\r\nDERBY-1080:  Connection reset when using security mechanism=EUSRIDPWD results in protocol error.\r\n\r\nFor eusridpwd case, the client sends the encrypted userid and password sectkns as part of SECCHK. The protocol error was happening because we only read the 2 sectkns if the database.decryptedUserId , database.decryptedPassword is null, otherwise we think we have already read this. Thus on a connection reset,if the decryptedUserId and decryptedPassword are not reset, server assumes we have seen more SECTKN's and thus we throw error too many codepoints. \r\n\r\nPatch adds\r\n-- code to reset the security mechanism related variables on a connection re-use.\r\n-- regression test to testSecMec.java\r\n----------------------------------------------------","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-14T01:22:44.000+0000","updated":"2006-03-14T01:22:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370217","id":"12370217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I intend to submit this patch today. If any reviewers are still looking at it, please let me know.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-14T02:34:25.000+0000","updated":"2006-03-14T02:34:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370260","id":"12370260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Sunitha, I had a strange failure in testSecMec in the DerbyNet framework.\r\n\r\nThis is on Linux, using Sun JDK 1.4, when I ran all of derbyall.\r\n\r\nI have attached the testSecMec.tmp file. Basically, the output just ceased at line 28, with no other error messages that I can find.\r\n\r\nI re-ran the test 5 or 6 times as a single test (-Dframework=DerbyNet derbynet/testSecMec.java) and I reran the derbynetmats suite with the DerbyNet framework.\r\n\r\nDuring the various re-runs, the test failed again the same way exactly once.\r\n\r\nSo, there seems to be some sort of a very intermittent failure, but I cannot reproduce it.\r\n\r\nDoes this make sense to you? Can you look at the attached testSecMec.tmp and tell me whether you have a theory for why I might have seen this very intermittent failure? Is there something that might be causing the test program to quit without flushing its output buffer?\r\n\r\nthanks,\r\n\r\nbryan\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-14T06:26:40.000+0000","updated":"2006-03-14T06:26:40.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370265","id":"12370265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"Thanks Bryan.\r\n\r\nNo. I havent come across this test failing on my machines but I didnt run with jdk141 on linux. I had tested with sun 1.4.1 on windows (just this test). and on linux (ibm142).  \r\n\r\nIn  derby-273, the dataSourcePermissions_net failed intermittently and that change affected testSecMec.java also and changed some streams.\r\n\r\nI'd have to put some debug statements in the test to see up to what point it is running, but from the tmp, it seems like it doesnt get past the second testrun in the main for-loop.   I'll run it repeatedly on my machine and see if I can reproduce this failure.\r\n\r\nThanks,\r\nSunitha. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-14T06:45:37.000+0000","updated":"2006-03-14T06:45:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370273","id":"12370273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=forsini","name":"forsini","emailAddress":"francois dot orsini at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Francois Orsini","active":true},"body":"The changes look good to me and thanks for adding a connection reset test.\r\n\r\nMy only minor comment would be to document a bit more in DRDAConnThread.java how we detect it is a connection re-use in parseACCSEC(). I know you have put lots of info in that JIRA but a bit more comment in that part of the code would be good.\r\n\r\nRegards.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=forsini","name":"forsini","emailAddress":"francois dot orsini at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Francois Orsini","active":true},"created":"2006-03-14T08:05:44.000+0000","updated":"2006-03-14T08:05:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370285","id":"12370285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"I am attaching a DebugTest.diff.txt which adds some println statements to testSecMec to see if the intermittent problem with the test is an issue with the closing of System.out and System.err streams.  I built the insane version of derbyTesting.jar with this change in test.  Bryan-  if possible, can you run this test with this change or using this derbyTesting.jar and see if it reproduces.  Thanks much. \r\n\r\nMain logic for switching of  System.out and System.err streams was added as part of derby273 and then got merged with changes for derby 928. I'll study that more and see if I can find something.  \r\n\r\nI ran the test separately with jdk141/win2k several times and the test passed ok.   I tried to run it about 15 times on a linux machine (2.6 kernel, redhat) with sun 1.4.1 and the test passes. \r\n\r\njava version \"1.4.1_07\"\r\nJava(TM) 2 Runtime Environment, Standard Edition (build 1.4.1_07-b02)\r\nJava HotSpot(TM) Client VM (build 1.4.1_07-b02, mixed mode)\r\n\r\nOS name:         Linux\r\nOS architecture: i386\r\nOS version:      2.6.9-22.0.1.ELsmp\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-14T10:10:42.000+0000","updated":"2006-03-14T10:10:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370289","id":"12370289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The bug reproduces with the print statements in place, which I think is good, so we can continue to diagnose it.\r\n\r\nI've attached the new '.tmp' file with the output of a failed test with the print statements in place, and also, this time, I am attaching the 'shutdown.std.log' file. In the past, this file has been 0 bytes after the run, but this time it has 4 of the print statements in it.\r\n\r\nPlease let me know what additional information I can provide.\r\n\r\nthanks,\r\n\r\nbryan\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-14T10:38:11.000+0000","updated":"2006-03-14T10:38:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370374","id":"12370374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"Thanks very much Bryan for the tmp and the log files.  \r\n\r\nThe testSecMec test starts /stops the server and does so 4 times.  I will call one cycle of {start server, runtest, stop server }as one testrun. \r\n\r\nfrom the printlns here is what I can see:\r\n-- testrun0 - start server, runtest, switches System.out and System.err to the testSecMec.DerbyNet.shutdown.std.log and the testSecMec.DerbyNet.shutdown.err.log  \r\nand shutsdown server and switches System.out and System.err streams back. \r\n\r\n-- testrun1 - start server, runtest and switches out and err streams and then after the call to shudown the server, the test seems to exit.\r\n\r\nSomething in networkserver.shutdown() is causing the System.out stream to close and the test exits.\r\n\r\nI think the harness waits for the process streams to close and System.out.close() thus triggers the test to exit. To confirm this, I put a System.out.close() in the test program and the test exits.\r\n\r\n===============\r\n\r\nThe 4 printlns in the shutdown.std.log makes sense.  It is printing the statements to this log after the switching of streams happens.  In the second testrun, the stream is switched and then prints the statement \"calling network server shutdown\" , but after that it exits. It doesnt print the next println which is Flush consoleLogStream. \r\n\r\nCalling network server shutdown. testrun[0]\r\nFlush consoleLogStream. testrun[0]\r\nSwitch back consoleLogStream. testrun[0]\r\nCalling network server shutdown. testrun[1]====> after this println the next call is networkserver.shutdown()\r\n\r\n===============\r\n\r\nNot sure what is causing the streams to close in shutdown of the server.   The reason this stream switching logic was added seems to be that intentional exceptions on shutdown of server was written to the standard output streams causing diffs. Hence as part of DERBY-273, before calling shutdown, the system.out and System.err are switched to testSecMec.DerbyNet.shutdown.std.log and testSecMec.DerbyNet.shutdown.err.log files and after shutdown they are switched back so the test output can continue to go to System.out.\r\n\r\nI tried to look briefly if there were any java bugs related to streams but didnt find any that seemed related.\r\n\r\n==============\r\nIf this intermittent test failure is due to switching of streams, I'd expect that maybe it will happen without the 1080 fix too, no? \r\n\r\nCan you mention what environment you are seeing this failure.\r\n \r\nI ran this test couple more times in the night yday but couldnt reproduce it either with sane/insane jars on my linux test machine. \r\n\r\nI will post if I learn more.  Thanks. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-15T01:28:40.000+0000","updated":"2006-03-15T01:28:40.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370376","id":"12370376","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"Just want to check if there is anything interesting in derby.log. Could  you attach the derby.log from the testrun.    Thanks. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-15T01:32:29.000+0000","updated":"2006-03-15T01:32:29.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370378","id":"12370378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Sunitha, thanks for the updates.\r\n\r\nI agree with your analysis and the conclusions you have reached so far. Good work. I think we're getting closer.\r\n\r\nI've attached the derby.log from the run, and I've also attached my sysinfo, to give you more details about my environment.\r\n\r\nI will try to see if the problem reproduces without your 1080 fix.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-15T01:41:42.000+0000","updated":"2006-03-15T01:41:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370380","id":"12370380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"Thanks. \r\n\r\nThe premature_shutdown_derby.log was interesting in that the shutdown message doesnt even get to the derby.log.\r\nIn my successful runs, I see 4 shutdown messages in derby.log which is correct and as expected.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-15T02:03:36.000+0000","updated":"2006-03-15T02:03:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370382","id":"12370382","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Sunitha, can you help me understand the purpose of the Thread.sleep(5000) line in testSecMec.java? If I change that line from (5000) to (100), the problem becomes *much* more reproducible.\r\n\r\nIs there a possibility that, on my machine, some action is sometimes taking longer than 5 seconds to perform, and so the problem is related to that sleep() call returning \"too soon\"?\r\n\r\nIn your environment, what happens if you change the Thread.sleep() call?\r\n\r\nthanks,\r\n\r\nbryan\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-15T02:18:25.000+0000","updated":"2006-03-15T02:18:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370395","id":"12370395","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"I tested both with Thread.sleep(100) and removing the call altogether and the test still passes OK in my environment. I am going to try to see if I can get access to machine with 2.4 kernel similar to what you are using.\r\n\r\n I am not sure why the Thread.sleep(5000) line is in this test. I'll try to look at it. This line is also in the dataSourcePermissions_net.java test.    Does anyone know ?  \r\n\r\nThere is this code:\r\n\t\t        // how do we do this with the new api?\r\n\t\t        //networkServer.join();\r\n                                                  Thread.sleep(5000);\r\n---------------------------------------------------------------------\r\nThanks.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-15T02:51:42.000+0000","updated":"2006-03-15T02:51:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370398","id":"12370398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Patch derby1080.2.diff.txt committed as Revision 385857:\r\nhttp://svn.apache.org/viewcvs?rev=385857&view=rev\r\n\r\nWe will address the intermittent test failure as a separate issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-15T03:14:27.000+0000","updated":"2006-03-15T03:14:27.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329863/comment/12370419","id":"12370419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"Thanks Bryan for committing this patch.     I have opened a new issue (DERBY-1114) for the intermittent test failure. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-15T05:17:00.000+0000","updated":"2006-03-15T05:17:00.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1080/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07b0n:"}}