{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12437416","self":"https://issues.apache.org/jira/rest/api/latest/issue/12437416","key":"ARIES-17","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314792","id":"12314792","description":"","name":"0.1","archived":true,"released":true,"releaseDate":"2010-05-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-10-08 07:33:11.419","customfield_12312323":null,"customfield_12310420":"93634","customfield_12312320":null,"customfield_12310222":"3_*:*_1_*:*_6252569471_*|*_1_*:*_1_*:*_3177879550_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-01-23T20:40:18.785+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-17/watchers","watchCount":0,"isWatching":false},"created":"2009-10-06T17:06:09.764+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=not","name":"not","emailAddress":"not at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=not&avatarId=10384","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=not&avatarId=10384","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=not&avatarId=10384","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=not&avatarId=10384"},"displayName":"Alasdair Nottingham","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-02-24T16:43:54.401+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313070","id":"12313070","name":"JNDI"}],"timeoriginalestimate":null,"description":"1) ServiceHelper is using getAllServiceReferences() to get a list of services on the client's bundle context. That can return services which might be incompatible with the bundle classloader.  I think the getServiceReferences() should be used instead.\r\n\r\n2) The context.lookup(\"osgi:services/<interface>\") should return a best ranking service registered with that interface. However, the ServiceHelper.getService() function seems to return a first service that it finds.\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"168210","summary":"ServiceHelper registry lookup problems","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12437416/comment/12763391","id":"12763391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nottinga","name":"nottinga","emailAddress":"alasdair dot nottingham at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alasdair Nottingham","active":true},"body":"On 2) the context.lookup(\"osgi:services/<interfaces>\") does return the best ranked service. The OSGi framework returns the ServiceReference in the correct order according to service id and service ranking, so in the ServiceHelper all we need to do is return the first service we found.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nottinga","name":"nottinga","emailAddress":"alasdair dot nottingham at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alasdair Nottingham","active":true},"created":"2009-10-08T07:33:11.419+0000","updated":"2009-10-08T07:33:11.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12437416/comment/12763530","id":"12763530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"body":"As according to JavaDoc, BundleContext.getServiceReference(String) returns a best ranked service reference but BundleContext.getServiceReferences(String, String) just returns a list of service references, that is, JavaDoc does not say anything about the service reference array being ordered in any way. \r\nServiceHelper.getService() uses BundleContext.getAllServiceReferences(String, String) (and probably should be using getServiceReferences()) and just returns the first service in the array. If ServiceHelper.getService() somehow used BundleContext.getServiceReference(String) a best ranked service would have been returned but since it is using BundleContext.getAllServiceReferences(String, String) it must sort the service reference array first.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"created":"2009-10-08T15:41:51.970+0000","updated":"2009-10-08T15:41:51.970+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12437416/comment/12763539","id":"12763539","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=not","name":"not","emailAddress":"not at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=not&avatarId=10384","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=not&avatarId=10384","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=not&avatarId=10384","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=not&avatarId=10384"},"displayName":"Alasdair Nottingham","active":true},"body":"While I would agree that the javadoc is not brilliant in this regard the Javadoc for BundleContext.getServiceReference(String) says the following:\r\n\r\nThis method is the same as calling getServiceReferences(String, String) with a null filter expression. It is provided as a convenience for when the caller is interested in any service that implements the specified class.\r\n\r\nThis does indicate that getServiceReferences does order the result correctly, but it doesn't indicate whether the highest ranking is at the beginning or the end. Having spoken to one of the equinox leads he says that equinox sorts with the first entry being the highest ranking, which means that what we are doing in JNDI is correct.\r\n\r\nI haven't looked into the getAllServiceReferences bit yet, but I know we use getAllServiceReferences in one place deliberately, and I haven't had a chance to check for all the instances we may do.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=not","name":"not","emailAddress":"not at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=not&avatarId=10384","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=not&avatarId=10384","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=not&avatarId=10384","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=not&avatarId=10384"},"displayName":"Alasdair Nottingham","active":true},"created":"2009-10-08T15:58:04.121+0000","updated":"2009-10-08T15:58:04.121+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12437416/comment/12763548","id":"12763548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=not","name":"not","emailAddress":"not at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=not&avatarId=10384","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=not&avatarId=10384","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=not&avatarId=10384","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=not&avatarId=10384"},"displayName":"Alasdair Nottingham","active":true},"body":"OK, so having checked with the OSGi alliance it seems that both equinox and I were reading too much into the getServiceReference javadoc, so we need to sort the ServiceReferences before using them. We can do this simply with a call to java.util.Arrays.sort() passing in the ServiceReference[] as ServiceReference is Comparable. Why OSGi couldn't return the array sorted in the spec is beyond me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=not","name":"not","emailAddress":"not at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=not&avatarId=10384","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=not&avatarId=10384","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=not&avatarId=10384","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=not&avatarId=10384"},"displayName":"Alasdair Nottingham","active":true},"created":"2009-10-08T16:31:53.436+0000","updated":"2009-10-08T16:31:53.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12437416/comment/12764024","id":"12764024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=not","name":"not","emailAddress":"not at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=not&avatarId=10384","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=not&avatarId=10384","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=not&avatarId=10384","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=not&avatarId=10384"},"displayName":"Alasdair Nottingham","active":true},"body":"On 1) You are correct that we should be using getServiceReferences rather than getAllServiceReferences. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=not","name":"not","emailAddress":"not at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=not&avatarId=10384","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=not&avatarId=10384","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=not&avatarId=10384","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=not&avatarId=10384"},"displayName":"Alasdair Nottingham","active":true},"created":"2009-10-09T13:59:05.009+0000","updated":"2009-10-09T13:59:05.009+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-17/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0t5k7:"}}