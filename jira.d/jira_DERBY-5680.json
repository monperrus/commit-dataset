{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12548851","self":"https://issues.apache.org/jira/rest/api/latest/issue/12548851","key":"DERBY-5680","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323475","id":"12323475","description":"Head of 10.8 branch starting 2014-01-13","name":"10.8.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2012-04-02 14:00:41.614","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"233948","customfield_12310222":"3_*:*_1_*:*_420680396_*|*_1_*:*_1_*:*_4222860098_*|*_5_*:*_2_*:*_34666734741_*|*_4_*:*_1_*:*_5611899","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-06-28T18:25:41.790+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5680/watchers","watchCount":7,"isWatching":false},"created":"2012-03-30T17:20:54.678+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12371269","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12371269","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12655383","key":"DERBY-6283","self":"https://issues.apache.org/jira/rest/api/2/issue/12655383","fields":{"summary":"indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12349990","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12349990","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12548973","key":"DERBY-5681","self":"https://issues.apache.org/jira/rest/api/2/issue/12548973","fields":{"summary":"When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-09-03T08:31:22.727+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"I think there is something wrong with the indexStats.     \r\n\r\nThe problem happens on many tables in the database.   \r\nNone of these tables are changing however, no inserts or deletes or updates.  They are being queried, however.  \r\n\r\nHere is one such table.\r\n\r\nHere is the statistics for this table:\r\n\r\nTable (Index)     2              3\r\nACCOUNTTABLE_CONFIG_BUNDLE (SQL081029110443810)          numunique= 38390 numrows= 38390     2012-03-30 13:00:26.84\r\nACCOUNTTABLE_CONFIG_BUNDLE (SQL100922215819290)          numunique= 38390 numrows= 38390     2012-03-30 13:00:26.917\r\n\r\nThere are in fact 38390 rows in the table.\r\n\r\nHere is some of the indexStat trace:\r\n\r\nFri Mar 30 12:47:12 EDT 2012 Thread[DRDAConnThread_43,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": update scheduled, reason=[t-est=38390, i-est=2355 => cmp=2.7912562815443245] (queueSize=12)\r\nFri Mar 30 12:47:48 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": wrote stats for index SQL081029110443810 (fc33890d-011d-491f-3d8c-0000376d74d3): rows=38390, card=[38390]\r\nFri Mar 30 12:47:48 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": wrote stats for index SQL100922215819290 (75608675-012b-3c38-b55c-000043ea6398): rows=38390, card=[38390]\r\nFri Mar 30 12:47:48 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": scan durations (c30625=91ms,c30625=98ms)\r\nFri Mar 30 12:47:48 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": generation complete (210 ms)\r\n\r\nFri Mar 30 12:47:49 EDT 2012 Thread[DRDAConnThread_44,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": update scheduled, reason=[t-est=38390, i-est=2355 => cmp=2.7912562815443245] (queueSize=19)\r\nFri Mar 30 12:48:25 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": wrote stats for index SQL081029110443810 (fc33890d-011d-491f-3d8c-0000376d74d3): rows=38390, card=[38390]\r\nFri Mar 30 12:48:25 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": wrote stats for index SQL100922215819290 (75608675-012b-3c38-b55c-000043ea6398): rows=38390, card=[38390]\r\nFri Mar 30 12:48:25 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": scan durations (c30625=93ms,c30625=95ms)\r\nFri Mar 30 12:48:25 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": generation complete (211 ms)\r\nFri Mar 30 12:48:25 EDT 2012 Thread[DRDAConnThread_50,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": update scheduled, reason=[t-est=38390, i-est=2355 => cmp=2.7912562815443245] (queueSize=18)\r\n\r\nFri Mar 30 12:48:57 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": wrote stats for index SQL081029110443810 (fc33890d-011d-491f-3d8c-0000376d74d3): rows=38390, card=[38390]\r\nFri Mar 30 12:48:57 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": wrote stats for index SQL100922215819290 (75608675-012b-3c38-b55c-000043ea6398): rows=38390, card=[38390]\r\nFri Mar 30 12:48:57 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": generation complete (243 ms)\r\n\r\nFri Mar 30 12:49:27 EDT 2012 Thread[DRDAConnThread_56,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": update scheduled, reason=[t-est=38390, i-est=2355 => cmp=2.7912562815443245] (queueSize=20)\r\nFri Mar 30 12:49:36 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": wrote stats for index SQL081029110443810 (fc33890d-011d-491f-3d8c-0000376d74d3): rows=38390, card=[38390]\r\nFri Mar 30 12:49:37 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": wrote stats for index SQL100922215819290 (75608675-012b-3c38-b55c-000043ea6398): rows=38390, card=[38390]\r\nFri Mar 30 12:49:37 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": scan durations (c30625=111ms,c30625=108ms)\r\nFri Mar 30 12:49:37 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": generation complete (238 ms)\r\n\r\nFri Mar 30 12:49:37 EDT 2012 Thread[DRDAConnThread_49,5,main] {istat} \"PKG_9145E_V1\".\"ACCOUNTTABLE_CONFIG_BUNDLE\": update scheduled, reason=[t-est=38390, i-est=2355 => cmp=2.7912562815443245] (queueSize=18)\r\n\r\n\r\nAs can be seen, the \"i-est\" appears to be wrong and is used over and over even though the statistics for the indexes have been updated.\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10362","value":"Performance","id":"10362"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10421","value":"Seen in production","id":"10421"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35704","summary":"indexStat daemon processing tables over and over even when there are no changes in the tables","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":41,"total":41,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13244198","id":"13244198","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching patch 1a, which makes the istat daemon drop any orphaned statistics if it find any when processing the index cardinality statistics for a given base table.\r\nMaybe the logging needs to be improved?\r\n(i.e. log to derby.log even if istat logging is off, also need to deal with a log entry when running system procedure explicitly).\r\n\r\nPatch ready for initial review.\r\nNot sure how to test this once DERBY-5681 has been fixed.\r\nTested manually using the repro provided by Brett under the mentioned issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-04-02T14:00:41.614+0000","updated":"2012-04-02T14:00:41.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13244230","id":"13244230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"body":"Applied the patch to Derby 10.8.2.2 source manually and am getting:\r\n\r\n\r\nLoaded com.canoga.derby.fcn.NpaSamResultsTableFunction from database jar \"PCS_V1\".\"PCSDERBY\"\r\nMon Apr 02 10:52:46 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"CORE_V1\".\"MANAGED_HARDWARE\": wrote stats for index SQL100922220307480 (36370979-012b-3c38-b55c-000043ea6398): rows=28639, card=[28639]\r\nMon Apr 02 10:52:46 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"CORE_V1\".\"MANAGED_HARDWARE\": wrote stats for index SQL100922220413140 (07558c64-012b-3c38-b55c-000043ea6398): rows=28639, card=[28639]\r\nMon Apr 02 10:52:46 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"CORE_V1\".\"MANAGED_HARDWARE\": wrote stats for index MANAGED_HARDWARE_IX_1 (b0c8433f-0133-8aa5-52b7-000043ea6398): rows=28639, card=[2]\r\nMon Apr 02 10:52:46 EDT 2012 Thread[index-stat-thread,5,main] {istat} \"CORE_V1\".\"MANAGED_HARDWARE\": scan durations (c25409=135ms,c25409=80ms,c46241=107ms,c59265=176ms)\r\nMon Apr 02 10:52:46 EDT 2012 Thread[index-stat-thread,5,main] {istat} runtime exception during normal operation\r\norg.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED\r\n\tat org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:98)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.vetIndexCardinalityStats(IndexStatisticsDaemonImpl.java:1223)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.updateIndexStatsMinion(IndexStatisticsDaemonImpl.java:531)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.generateStatistics(IndexStatisticsDaemonImpl.java:325)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.processingLoop(IndexStatisticsDaemonImpl.java:801)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.run(IndexStatisticsDaemonImpl.java:717)\r\n\tat java.lang.Thread.run(Thread.java:662)\r\n(Skipping thread dump because of insufficient permissions:\r\njava.security.AccessControlException: access denied (java.lang.RuntimePermission getStackTrace))\r\n\r\n\r\nException in thread \"index-stat-thread\" org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED\r\n\tat org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:98)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.vetIndexCardinalityStats(IndexStatisticsDaemonImpl.java:1223)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.updateIndexStatsMinion(IndexStatisticsDaemonImpl.java:531)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.generateStatistics(IndexStatisticsDaemonImpl.java:325)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.processingLoop(IndexStatisticsDaemonImpl.java:801)\r\n\tat org.apache.derby.impl.services.daemon.IndexStatisticsDaemonImpl.run(IndexStatisticsDaemonImpl.java:717)\r\n\tat java.lang.Thread.run(Thread.java:662)\r\n(Skipping thread dump because of insufficient permissions:\r\njava.security.AccessControlException: access denied (java.lang.RuntimePermission getStackTrace))\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"created":"2012-04-02T14:50:41.618+0000","updated":"2012-04-02T14:50:41.618+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13244235","id":"13244235","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"body":"I commented out the ASSERT and tried it again.  It appears to be working correctly.  I can see the orphan statistics being dropped.  I shutdown the database and restarted and there are no more orphans being detected the second time around.\r\n\r\nMay the asserted condition is not valid?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"created":"2012-04-02T15:01:56.286+0000","updated":"2012-04-02T15:01:56.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13244355","id":"13244355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"one way to test this without having to hack anything into the catalog is to turn it into an upgrade test and create the bad rows using a past release with the bug in it.  Even if we backport the eventual fix, those old versions will always generate the bad row.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-02T17:29:57.075+0000","updated":"2012-04-02T17:29:57.075+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13244421","id":"13244421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I reviewed the change, could use a few more comments for those of us not familar with data design of the statistics catalog, but I would\r\nhave expected it fix the problem.  Not sure what the issue with the assert is, there is a comment about when we turn on write mode, but\r\nnot sure when it is expected to get turned off - maybe at commit?\r\n\r\nI was hoping the change could be less invasive by just dropping all statistics even bad ones upfront with no checking, ie. not have to reget all the valid rows and recheck them always.  But I see the current\r\ncode logic wants to drop statistics one at a time, and that were problems trying to invalidate all at once which might be similar to problems with dropping all rows at once.\r\n\r\nIt is not part of this change, but is there a possible problem with when invalidateStatements is called?   Unless you need it for some\r\nlocking reason it would seem better to invalidate after you do the update than in the middle.\r\nCan queries sneak in between when a statistic is dropped and when you insert the new updated statistic?  If so it would be another reason\r\nnot to drop them all up front as it would increase the window.  brett was reporting some wierdness with working queries getting recompiled\r\nto bad plans.  I think we can think of his system as always having concurrent processors availble to run statements constantly, so they\r\ncan almost instantaneously start recompiling once you invalidate their plan.  Now if they can get in after the invalidate, after the drop but before\r\nthe insert then they probably have worse stats (ie. no stats), vs the old stats.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-02T18:36:03.036+0000","updated":"2012-04-02T18:36:03.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13245700","id":"13245700","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"body":"I have run a patched version of 10.8.2.2 (without the assert) overnight on a copy of the production database where the problem was occurring.  It has worked fine, cleaned up the orphan statistics rows, and now only does the job it should.  Just some feedback from testing.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"created":"2012-04-03T20:32:46.470+0000","updated":"2012-04-03T20:32:46.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13246716","id":"13246716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Thanks a lot for testing the patch, Brett.\r\n\r\nI'm testing some other improvements under DERBY-5684, but it will take a while before any of it is production ready :) There's a patch there, but I'm not sure how well it will do out in the wild...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-04-04T20:46:10.369+0000","updated":"2012-04-04T20:46:10.369+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13258752","id":"13258752","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Apologies up front if this has already been discussed. \r\n\r\nBut I was wondering if all the stats could be dropped up front during hard upgrade time(this will take care of orphaned stats. If there is no way of clearing everything in the statistics table, then we could drop stats one table at a time at the time of hard upgrade). \r\n\r\nStatistic creation deamon will have to collect stats again since we have dropped all the stats at upgrade time but since stat gathering happens in background, it probably won't be very noticeable. \r\n\r\nWe know of one case DERBY-5681 where a drop constraint can leave orphaned stats row. There is already a patch on that issue which will make sure that we do not have such stats row left behind. If that is the only case where orphaned stats get left behind, then we shouldn't run into orphaned stats again on an upgraded database.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-04-21T02:57:18.062+0000","updated":"2012-04-21T02:57:18.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13258842","id":"13258842","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"body":"I don't like arbitrarily dropping the stats at hard upgrade time.   Statistics are needed when tables have a large number of rows and it does take time and resources to recreate them.  So while in the general case of testing with a few thousand rows, this may be acceptable, in my particular case with tables with many millions of rows being actively inserted and queried upon, I don't think this is best.\r\n\r\nCleaning up orphaned statistics tables that are not being used but triggering the indexStat daemon is acceptable but blindly dropping all statistics is not I don't believe.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bbergquist","name":"bbergquist","emailAddress":"brett at thebergquistfamily dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Bergquist","active":true},"created":"2012-04-21T12:13:38.508+0000","updated":"2012-04-21T12:13:38.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13278871","id":"13278871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching patch 1b, which adds functionality to the update statistics code to drop disposable statistics entries.\r\n\r\nFor now disposable statistics consist only of orphaned rows, but when DERBY-3790 goes in there will also be entries for single-column primary keys. For the check and dropping to take place, either the istat daemon must kick in or the SYSCS_UPDATE_STATISTICS system procedure must be run with null as the argument for which index to update (i.e. tell it to update statistics for all indexes). This restriction allows for simpler login when identifying disposable stats: drop all statistics entries we won't update.\r\n\r\nDescription of the changes:\r\n * impl/sql/execute/AlterTableConstantAction\r\n   Enable identification of disposable stats when no index is specified when invoking SYSCS_UPDATE_STATISTICS.\r\n * impl/services/daemon/IndexStatisticsDaemonImpl\r\n   Added a property to allow users to force the old behavior.\r\n   Added logic to not identify disposable statistics on old databases (soft upgrade).\r\n   Made the same change as in AlterTableConstantAction (pass null).\r\n   Added the method logAlways.\r\n * iapi/reference/Property\r\n   Added property \"derby.storage.indexStats.debug.forceOldBehavior\".\r\n * functionTests/tests/lang/UpdateStatisticsTest\r\n   Added testDisposableStatsEagerness, which verifies that the new code doesn't remove entries it should leave alone.\r\n   There will be more tests as part of DERBY-3790 (upgrade test + testing the forceOldBehavior property).\r\n\r\nTo sum up, all existing tests should continue to work with this patch. This is not the case with what's going in for DERBY-3790, as that patch will reduce the number of statistics entries for tables with single-column primary keys.\r\n\r\nPatch ready for review.\r\nI plan to commit pretty soon, so if anyone has planned to review the code it would be nice if it happened sooner than later :)\r\n\r\nThanks to Dag who has already reviewed the prototype code under DERBY-5684. Since I decided to drop what I was working on for foreign indexes, which I now believe wasn't doing the correct thing, I also decided to drop the class IndexStatisticsAnalyzer. I found it to be a bit heavy-weight already, but with the second optimization pulled out it was simply just too much (over-engineered).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-05-18T15:34:41.996+0000","updated":"2012-05-18T15:34:41.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13279375","id":"13279375","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks, Kristian. Went through the code and it looks right to me. One question:\r\n\r\nupdateIndexStatsMinion:\r\n\r\n- Are these lined needed (I know they are not wrong, but possibly redundant)?\r\n\r\n                    if (conglomerateNumber[ci] == -1) {\r\n                        continue;\r\n                    }\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-05-19T00:49:49.179+0000","updated":"2012-05-19T00:49:49.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13279607","id":"13279607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Thanks, Dag.\r\n\r\nYou're right about the check being redundant, because objectUUID[i] will be null. I'll correct this after the patch for DERBY-3790 is in, as it will include a better test for this code (I'll first force old behavior to generate stats for single-column primary keys and then run with the new behavior to confirm that they're dropped). There will also be an upgrade test making sure the orphaned row caused by DERBY-5681 is dropped.\r\n\r\nI committed patch 1b to trunk with revision 1340549.\r\nI will not mark this issue as resolved before the patch for DERBY-3790, which includes more tests, is committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-05-19T19:32:43.593+0000","updated":"2012-05-19T19:32:43.593+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13280156","id":"13280156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Should we call the property \"keepDisposableStats\" or something more descriptive instead of \"forceOldBehavior\"? Just so that we don't have to call the next property \"forceNotQuiteSoOldBehavior\"... ;)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-05-21T13:58:23.408+0000","updated":"2012-05-21T13:58:23.408+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13280193","id":"13280193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"We can do that, I'll append it to the todo-list :)\r\nNote that I do not plan to document this property. Regardless of whether the feature demonstrates it usefulness or not (which is a more relevant question for DERBY-3790), the property will be removed in a future release. In the former case it will simply be removed, in the latter case it will be removed together with the feature itself.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-05-21T14:50:51.208+0000","updated":"2012-05-21T14:50:51.208+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13281212","id":"13281212","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching patch 2a, which removes the redundant check Dag spotted. The tests passed without the check.\r\n\r\nCommitted patch 2a to trunk with revision 1341622.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-05-22T21:03:26.304+0000","updated":"2012-05-22T21:03:26.304+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13281219","id":"13281219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching patch 3a, which renames the debug property to give it a more descriptive name as suggested by Knut Anders.\r\n\r\nCommitted to trunk with revision 1341629.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-05-22T21:15:04.869+0000","updated":"2012-05-22T21:15:04.869+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13281524","id":"13281524","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Resolving issue, the outstanding tests have been committed under DERBY-3790.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-05-23T11:13:15.129+0000","updated":"2012-05-23T11:13:15.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13692125","id":"13692125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"Is this fix ok to backport to 10.8?  I think DERBY-3790 should not be backported as it is a feature, so most of need for this issue is not in 10.8.  But\r\nI think there are some cases in 10.8 that are fixed by this, correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2013-06-24T16:38:42.179+0000","updated":"2013-06-24T16:38:42.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13693301","id":"13693301","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"much of the discussion about this issue happened on the list before the bug was created.  Here is a link to the\r\nbeginning of the discussion (would of liked to post a link to the whole thread but could not figure out how to do that), i believe\r\nthe net is that one part of the istat daemon code finds the orphan stat row and recognizes that the number of rows is bad, but the actual\r\nupdate code just updates the good rows - thus the output looks like it is updating all rows to same values.  I might be good to enhance the\r\nistat debugging code to print out before info for all stats so it is obvious we are running into the bug.:\r\nhttp://mail-archives.apache.org/mod_mbox/db-derby-dev/201203.mbox/%3C97EB699F861AD841B5908C7CA9C9565602065E174BD4%40VSERVER1.canoga.com%3E","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2013-06-25T19:28:59.903+0000","updated":"2013-06-25T19:28:59.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695135","id":"13695135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I have been able to backport(with some issues as explained below) the 3 commits that went in for DERBY-5680 to 10.8. The 3 commits were 1340549, 1341622, 1341629. The first two commits were easy to backport using svn merge command but the third commit 1341629 ran into conflicts. For that backport, I hand made the changes since there were not too many changes.\r\n\r\nThe changes for this jira has added a new property derby.storage.indexStats.debug.keepDisposableStats. I think the intention is that if the property is set to true, we do not delete the orphaned/disposable stats. If the property is set to false, the orphaned/disposable stats will get dropped by the index stats daemon. Also, if my understanding is correct, then we can end up with orphaned/disposable stats for \r\n1)DERBY-5681(When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed). This has been backported all the way to 10.3\r\n2)DERBY-3790(Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.) This fix is in 10.9 and higher\r\n\r\nA junit test was added for this new property but it went in as part of DERBY-3790. The name of the junit test is\r\nstore.KeepDisposableStatsPropertyTest. I tried copying that test from trunk to 10.8 but without the fix for DEBRY-3790 and with the absence of drop statistics procedure, the test really does not make much sense for 10.8 codeline. The test uses drop statistics procedure and it is mainly testing DERBY-3790 to make sure that the orphaned stats are being deleted or left behind based on whether the property is set to true or false. But since we do not have drop statistics procedure and we do not have DERBY-3790 fixed in 10.8, we can't really meaningfully run the KeepDisposableStatsPropertyTest in 10.8. In any case, I have changed the test so that atleast it will not fail in 10.8 but it is not able to truly test the property. May be we can test this property through upgrade suite where we will create orphaned stats because of DERBY-5681 on older releases and we will find that when the property is set to true, even after upgrade, we will have orphaned stats but when property is set to false, after upgrade, orphaned stats are deleted. Just a thought.\r\n\r\nI have attached the patch for 10.8 backport and KeepDisposableStatsPropertyTest (although it doesn't really test the property in it's true sense because of the absence of DERBY-3790 fix, but may be we can use DERBY-5681 to create test cases in upgrade suite).\r\n\r\nI am running the junit suite and derbyall with the patch. Will post the results of it when it is done. \r\n\r\nI haven't spent too  much time understanding the impact of the backport on 10.8 codeline, ie can it break something else? My gut feeling based on the time I have spent so far is that it should work ok in 10.8. I will look more into it. I will appreciate if others can also take a look and share their thoughts about 10.8 backport.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-06-27T22:48:23.681+0000","updated":"2013-06-27T22:48:23.681+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695158","id":"13695158","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks Mamta for backporting this.\r\n\r\nI think that if we are backporting to 10.8 we should also drop the disposable indexes for pre 10.8 databases, so that databases that have not been hard upgraded will get the fix.\r\n\r\nI have a database with the problem that is still in an earlier format and soft upgraded to 10.8 that needs to have the disposable indexes dropped. I think, because the database is in a prior version format, the fix does not kick in.\r\n\r\nIt makes sense for 10.9 to have the version check for the newly disposable DERBY-3790 disposables, but I thiink the just wrong ones resulting from DERBY-5681 or something similar should always go. I think for the 10.8 fix it will be enough to just remove the check, but perhaps  10.9 and 10.10 will have to be changed to differentiate or maybe it is ok even for those to drop all the disposables too?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-06-27T23:29:00.469+0000","updated":"2013-06-27T23:29:00.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695170","id":"13695170","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"With hard upgrade, the disposables get dropped properly and index statistics does not kick in.   Now that I think about it, since soft upgrade is also a problem for 10.9 and later versions, maybe we should commit your change as a clean backport of this fix and then open a new issue for soft upgrade dropping disposables that are remnants of DERBY-5681, etc.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-06-27T23:58:27.394+0000","updated":"2013-06-27T23:58:27.394+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695241","id":"13695241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Thanks for reviewing the patch, Kathey. I will wait until tomorrow in case if there are any more feedbacks.\r\n\r\nLike you suggested, we can take the soft upgrade case as a separate issue but I was wondering if anyone might know why we did we decide to not cleanup orphaned state rows in case of soft upgrade mode in the original changes for this jira? I see comments in the code and in the commit comment that we do not want to cleanup in soft upgrade mode but I couldn't quite comprehend why. Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-06-28T03:31:45.421+0000","updated":"2013-06-28T03:31:45.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695517","id":"13695517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I agree with kathey, let's just backport this to 10.8 and open a new issue to correctly handle the looping problem for soft upgrade in all versions.  Otherwise we might end up with 10.8 fixing\r\nthe problem for soft upgrade but not 10.9, 10.10 and trunk. \r\n\r\n Hopefully we can figure out a way to handle\r\nthe buggy orphaned stat differently than the expected \"disposable\" stats and deal with them differently.  If you hit this problem then the problem is very serious, as it can eat all the cpu on\r\nat least one processor, which may be the whole machine, it also may be hard to diagnose as those with multiple processors may just notice that \"derby is slow and slowing the rest of the \r\nmachine\".\r\n\r\nCan anyone think of a reason that the truly orphaned stat (an existing stat for no existing index) would be useful for any previous version of the software?  I think worst case if someone had to \r\ndowngrade after we deleted the orphaned stat and it was somehow needed then re-creating indexes would fix that issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2013-06-28T15:43:17.420+0000","updated":"2013-06-28T15:43:17.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695556","id":"13695556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"reopening it for backport to 10.8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-06-28T16:52:09.909+0000","updated":"2013-06-28T16:52:09.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695558","id":"13695558","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"junit suite ran fine with the patch. still waiting for derbyall to finish","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-06-28T16:52:36.162+0000","updated":"2013-06-28T16:52:36.162+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695577","id":"13695577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I have added DERBY-6283 to track discussion and fix for the soft upgrade case of this bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2013-06-28T17:18:54.588+0000","updated":"2013-06-28T17:18:54.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695621","id":"13695621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"derbyall ran fine too. I will go ahead and commit the patch to backport the changes to 10.8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-06-28T18:10:44.320+0000","updated":"2013-06-28T18:10:44.320+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695629","id":"13695629","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1497868 from [~mamtas]\r\n[ https://svn.apache.org/r1497868 ]\r\n\r\nDERBY-5680( indexStat daemon processing tables over and over even when there are no changes in the tables )\r\n\r\nBackporting the 3 commits that went in for DERBY-5680 to 10.8. The 3 commits were 1340549, 1341622, 1341629. The first two commits were easy to backport using svn merge command but the third commit 1341629 ran into conflicts. For that backport, hand made the changes since there were not too many changes.\r\n\r\nThe changes for this jira has added a new property derby.storage.indexStats.debug.keepDisposableStats. The intention of the property is that if the property is set to true, we do not delete the orphaned/disposable stats. If the property is set to false, the orphaned/disposable stats will get dropped by the index stats daemon. Currently known reasons for orphaned/disposable stats are\r\n1)DERBY-5681(When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed). Fix for this has been backported all the way to 10.3\r\n2)DERBY-3790(Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.) Fix for this is in 10.9 and higher\r\n\r\nA junit test was added for this new property but it went in as part of DERBY-3790. The name of the junit test is store.KeepDisposableStatsPropertyTest. Had to make changes to this test to backport it to 10.8 but without the fix for DEBRY-3790 and with the absence of drop statistics procedure, the test really does not make much sense for 10.8 codeline. The test uses drop statistics procedure and it is mainly testing DERBY-3790 to make sure that the orphaned stats are being deleted or left behind based on whether the property is set to true or false. But since we do not have drop statistics procedure and we do not have DERBY-3790 fixed in 10.8, we can't really meaningfully run the KeepDisposableStatsPropertyTest in 10.8. In any case, I have changed the test so that atleast it will not fail in 10.8 but it is not able to truly test the property. May be we can test this property through upgrade suite where we will create orphaned stats because of DERBY-5681 on older releases and we will find that when the property is set to true, even after upgrade, we will have orphaned stats but when property is set to false, after upgrade, orphaned stats are deleted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-06-28T18:23:25.467+0000","updated":"2013-06-28T18:23:25.467+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695630","id":"13695630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1497868 from [~mamtas]\r\n[ https://svn.apache.org/r1497868 ]\r\n\r\nDERBY-5680( indexStat daemon processing tables over and over even when there are no changes in the tables )\r\n\r\nBackporting the 3 commits that went in for DERBY-5680 to 10.8. The 3 commits were 1340549, 1341622, 1341629. The first two commits were easy to backport using svn merge command but the third commit 1341629 ran into conflicts. For that backport, hand made the changes since there were not too many changes.\r\n\r\nThe changes for this jira has added a new property derby.storage.indexStats.debug.keepDisposableStats. The intention of the property is that if the property is set to true, we do not delete the orphaned/disposable stats. If the property is set to false, the orphaned/disposable stats will get dropped by the index stats daemon. Currently known reasons for orphaned/disposable stats are\r\n1)DERBY-5681(When a foreign key constraint on a table is dropped, the associated statistics row for the conglomerate is not removed). Fix for this has been backported all the way to 10.3\r\n2)DERBY-3790(Investigate if request for update statistics can be skipped for certain kind of indexes, one instance may be unique indexes based on one column.) Fix for this is in 10.9 and higher\r\n\r\nA junit test was added for this new property but it went in as part of DERBY-3790. The name of the junit test is store.KeepDisposableStatsPropertyTest. Had to make changes to this test to backport it to 10.8 but without the fix for DEBRY-3790 and with the absence of drop statistics procedure, the test really does not make much sense for 10.8 codeline. The test uses drop statistics procedure and it is mainly testing DERBY-3790 to make sure that the orphaned stats are being deleted or left behind based on whether the property is set to true or false. But since we do not have drop statistics procedure and we do not have DERBY-3790 fixed in 10.8, we can't really meaningfully run the KeepDisposableStatsPropertyTest in 10.8. In any case, I have changed the test so that atleast it will not fail in 10.8 but it is not able to truly test the property. May be we can test this property through upgrade suite where we will create orphaned stats because of DERBY-5681 on older releases and we will find that when the property is set to true, even after upgrade, we will have orphaned stats but when property is set to false, after upgrade, orphaned stats are deleted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-06-28T18:23:26.435+0000","updated":"2013-06-28T18:23:26.435+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13695640","id":"13695640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Committed the backport to 10.8 with revision 1497868","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-06-28T18:24:58.234+0000","updated":"2013-06-28T18:24:58.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13696399","id":"13696399","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1498173 from [~mamtas]\r\n[ https://svn.apache.org/r1498173 ]\r\n\r\nDERBY-5680(indexStat daemon processing tables over and over even when there are no changes in the tables)\r\n\r\nKeepDisposableStatsPropertyTest test is meant for DERBY-3790 which is not in in 10.8 codeline and hence should not be run in 10.8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-06-30T19:41:59.550+0000","updated":"2013-06-30T19:41:59.550+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13706077","id":"13706077","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1502319 from mikem@apache.org\r\n[ https://svn.apache.org/r1502319 ]\r\n\r\nDERBY-6283 indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.\r\n\r\nChanged system to always drop orphaned stats during update statistics call.  \r\n\r\nWithout this change soft upgraded systems running on 10.8 or higher derby \r\nsoftware, that had an orphaned statistic would spin forever in the index \r\nstat daemon due to the same problem fixed by DERBY-5680 for hard \r\nupgraded databases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-11T18:26:05.855+0000","updated":"2013-07-11T18:26:05.855+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13707438","id":"13707438","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1502706 from mikem@apache.org\r\n[ https://svn.apache.org/r1502706 ]\r\n\r\nDERBY-6283 indexStat daemon processing tables over and over even when there are no changes in the tables in soft upgraded database.\r\n\r\nbackported change #1502319 from trunk to 10.10, some manual merging was \r\nrequired.\r\n\r\nChanged system to always drop orphaned stats during update statistics call.\r\n\r\nWithout this change soft upgraded systems running on 10.8 or higher derby\r\nsoftware, that had an orphaned statistic would spin forever in the index\r\nstat daemon due to the same problem fixed by DERBY-5680 for hard\r\nupgraded databases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-12T21:59:44.741+0000","updated":"2013-07-12T21:59:44.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13708329","id":"13708329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I don't know if it's related, but UpdateStatisticsTest has failed twice on the 10.8 branch after the fix was backported:\r\n\r\nhttp://download.java.net/javadesktop/derby/javadb-5579017-report/javadb-task-3685070.html\r\n\r\n    junit.framework.AssertionFailedError: Index statistics for <ALL TABLES>\r\n1: {tableId=25347265-013f-8c71-7445-fffff6662cff, tableName=DISPOSABLE_STATS_EAGERNESS_FK, indexName=SQL130628223832620, lcols=1, rows=1000, unique/card=1000, created=2013-06-28 22:38:32.672}\r\n2: {tableId=f0cfb26b-013f-8c71-7445-fffff6662cff, tableName=DISPOSABLE_STATS_EAGERNESS, indexName=NU_DISPOSABLE_STATS_EAGERNESS, lcols=1, rows=1000, unique/card=35, created=2013-06-28 22:38:32.688}\r\n3: {tableId=f0cfb26b-013f-8c71-7445-fffff6662cff, tableName=DISPOSABLE_STATS_EAGERNESS, indexName=SQL130628223832640, lcols=1, rows=1000, unique/card=1000, created=2013-06-28 22:38:32.672}\r\n4: {tableId=f0cfb26b-013f-8c71-7445-fffff6662cff, tableName=DISPOSABLE_STATS_EAGERNESS, indexName=SQL130628223832621, lcols=1, rows=1000, unique/card=1000, created=2013-06-28 22:38:32.672}\r\n5: {tableId=f0cfb26b-013f-8c71-7445-fffff6662cff, tableName=DISPOSABLE_STATS_EAGERNESS, indexName=SQL130628223832621, lcols=2, rows=1000, unique/card=1000, created=2013-06-28 22:38:32.672}\r\n expected:<0> but was:<5>\r\n\tat org.apache.derbyTesting.junit.IndexStatsUtil.assertStats(IndexStatsUtil.java:132)\r\n\tat org.apache.derbyTesting.junit.IndexStatsUtil.assertNoStats(IndexStatsUtil.java:109)\r\n\tat org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testUpdateStatistics(UpdateStatisticsTest.java:93)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\r\nhttp://download.java.net/javadesktop/derby/javadb-5579314-report/javadb-task-3689573.html\r\n\r\n    junit.framework.AssertionFailedError\r\n\tat org.apache.derbyTesting.functionTests.tests.lang.UpdateStatisticsTest.testDisposableStatsEagerness(UpdateStatisticsTest.java:481)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-07-15T09:04:38.024+0000","updated":"2013-07-15T09:04:38.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13708664","id":"13708664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Hi Knut, I looked at the diff for UpdateStatisticsTest.testUpdateStatistics at http://download.java.net/javadesktop/derby/javadb-5579017-report/javadb-task-3685070.html and see that the test failed with svn revision 1497868. The reason for failure was DERBY-5774: Failures in UpdateStatisticsTest (order-dependent test cases) which got fixed into 10.8 with revision 1498052. After that checkin in 10.8, the test has not failed again yet.\r\n\r\nAs for UpdateStatisticsTest.testDisposableStatsEagerness, I need to study the failure more. I do not know if it is related to fix for this jira in 10.8 but let me understand the test more to see what does the failure mean. Thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-07-15T17:21:04.260+0000","updated":"2013-07-15T17:21:04.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13709351","id":"13709351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"UpdateStatisticsTest.testDisposableStatsEagerness may be because of DERBY-5797(AssertionFailedError in functionTests.tests.lang.UpdateStatisticsTest.testDisposableStatsEagerness). Fix for DERBY-5797 is in 10.10 and 10.9 but not in 10.8, I will work on backporting it to 10.8.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-07-16T01:50:52.295+0000","updated":"2013-07-16T01:50:52.295+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13710359","id":"13710359","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Fix for DERBY-5797 has been backported to 10.8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-07-16T22:08:25.658+0000","updated":"2013-07-16T22:08:25.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13714077","id":"13714077","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1505021 from mikem@apache.org in branch 'code/branches/10'\r\n[ https://svn.apache.org/r1505021 ]\r\n\r\nDERBY-6283 indexStat daemon processing tables over and over even when there are\r\nno changes in the tables in soft upgraded database.\r\n\r\nbackported change #1502319 from trunk to 10.8, some manual merging was\r\nrequired.\r\n\r\nChanged system to always drop orphaned stats during update statistics call.\r\n\r\nWithout this change soft upgraded systems running on 10.8 or higher derby\r\nsoftware, that had an orphaned statistic would spin forever in the index\r\nstat daemon due to the same problem fixed by DERBY-5680 for hard\r\nupgraded databases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-19T21:09:03.091+0000","updated":"2013-07-19T21:09:03.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/13714167","id":"13714167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1505054 from mikem@apache.org in branch 'code/branches/10'\r\n[ https://svn.apache.org/r1505054 ]\r\n\r\nDERBY-6283 indexStat daemon processing tables over and over even when there are\r\nno changes in the tables in soft upgraded database.\r\n\r\nbackported change #1502319 from trunk to 10.8, some manual merging was\r\nrequired.\r\n\r\nChanged system to always drop orphaned stats during update statistics call.\r\n\r\nWithout this change soft upgraded systems running on 10.8 or higher derby\r\nsoftware, that had an orphaned statistic would spin forever in the index\r\nstat daemon due to the same problem fixed by DERBY-5680 for hard\r\nupgraded databases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-19T22:25:45.710+0000","updated":"2013-07-19T22:25:45.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12548851/comment/14119543","id":"14119543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-09-03T08:31:22.702+0000","updated":"2014-09-03T08:31:22.702+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5680/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06h3j:"}}