{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12500641","self":"https://issues.apache.org/jira/rest/api/latest/issue/12500641","key":"DERBY-5096","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315436","id":"12315436","description":"Head of 10.5 branch - version bump for DERBY-4835","name":"10.5.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315434","id":"12315434","description":"Head of 10.6 branch as of 2014-01-13","name":"10.6.2.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315902","id":"12315902","description":"Head of 10.7 branch as of 2010-11-29","name":"10.7.1.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323456","id":"12323456","description":"Third release on the 10.8 branch","name":"10.8.3.0","archived":false,"released":true,"releaseDate":"2012-11-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-03-09 23:40:30.638","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24642","customfield_12310222":"1_*:*_1_*:*_2618987035_*|*_5_*:*_2_*:*_19338153109_*|*_4_*:*_1_*:*_3019220087","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-12-21T16:59:17.172+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5096/watchers","watchCount":1,"isWatching":false},"created":"2011-03-07T15:06:37.101+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12337980","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12337980","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12422162","key":"DERBY-4149","self":"https://issues.apache.org/jira/rest/api/2/issue/12422162","fields":{"summary":"test failure in jdbcapi.InternationalConnectSimpleDSTest fixture  testSimpleDSConnect on IBM iseries - Database '?' not found.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-11-15T08:15:15.244+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"}],"timeoriginalestimate":null,"description":"A process starts derby as network server (new NetworkServerControl, start) and waits for derby to respond (retry ping until success). After the server has started, the same process makes a connection with DriverManager.getConnection().\r\n\r\nThe first time this process runs, this will always fail with  \"SQLNonTransientConnectionException: The connection was refused because the database Flows;create=true was not found.\" However, at the same time, \"derby.log\" and \"Flows\" directory are created in the derby home. The \"Flows\" directory contains \"log\", \"seg0\", \"tmp\", \"db.lck\", \"service.properties\", etc ...\r\n\r\nThe second time the process is started, the connection will succeed and the \"Flows\" database can be used successfully. From now on, every start will be successful. After cleaning the derby home directory, you get the exception again after the first start.\r\n\r\nThe attachment contains a Java program (DerbyGetConnection.java) that reproduces this problem consistently on our OS/400 V7R1M0 with IBM J9 VM. Probably this may happen on other systems too (Win7), but we were unable to reproduce it there (on my machine with Win7, this same program ran successful every run; might be a threading or I/O issue that occurs easily on slower hardware?).\r\nThe attachment contains also derby tracing (\"derby.drda.traceAll\") and logging/tracing of the DriverManager.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10421","value":"Seen in production","id":"10421"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36144","summary":"DisconnectException: \"Connection was refused because the database DB was not found\" when creating db for first time","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevenhendrickx","name":"stevenhendrickx","emailAddress":"steven dot hendrickx at inventivegroup dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Hendrickx","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10102","value":"Patch Available","id":"10102"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevenhendrickx","name":"stevenhendrickx","emailAddress":"steven dot hendrickx at inventivegroup dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Hendrickx","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"System: OS/400 V7R1M0 on PowerPC; JVM: IBM J9 VM 2.4 (consistently reproducible). \r\nBut also: Windows 2008 R2 on VMWare and Windows 7 64 bit with Sun VM (1.6) too (but not as consistently reproducible)","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":16,"total":16,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13003380","id":"13003380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevenhendrickx","name":"stevenhendrickx","emailAddress":"steven dot hendrickx at inventivegroup dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Hendrickx","active":true},"body":"ZIP containing\r\n- DerbyGetConnection.java to reproduce problem\r\n- Derby tracing\r\n- JDBC/DriverManager trace","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevenhendrickx","name":"stevenhendrickx","emailAddress":"steven dot hendrickx at inventivegroup dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Hendrickx","active":true},"created":"2011-03-07T15:07:54.298+0000","updated":"2011-03-07T15:07:54.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13003383","id":"13003383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevenhendrickx","name":"stevenhendrickx","emailAddress":"steven dot hendrickx at inventivegroup dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Hendrickx","active":true},"body":"Mind, since this is a SQLNonTransientConnectionException, we cannot retry to create the connection.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevenhendrickx","name":"stevenhendrickx","emailAddress":"steven dot hendrickx at inventivegroup dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Hendrickx","active":true},"created":"2011-03-07T15:09:57.243+0000","updated":"2011-03-07T15:09:57.243+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13004877","id":"13004877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hi Steven,\r\n\r\nOn iseries I believe there is a java bug with getCanonicalPath() that can cause  this problem. If you run the attached program TestLowerCaseTraversal.java on iseries,  I think you will see that getCanonical path is not properly resolving the case in the parent directories \r\n\r\n$ java TestLowerCaseTraversal \r\nmkdirs to create dir with mixedcase string: test/NDee = true\r\nOriginal string: test/ndee/subdir\r\ncannonical path before mkdirs(), should be mixed case as that's what's on the machine: /home/MYRNA/tst/test/b11740/try4/test/ndee/subdir  <<== Should be NDee!\r\ncreated the subdir? true\r\ncannonical path after  mkdirs(): /home/MYRNA/tst/test/b11740/try4/test/NDee/subdir\r\n\r\nOn Windows XP, I see the case properly resolved:\r\n\r\nmkdirs to create dir with mixedcase string: test/NDee = true\r\nOriginal string: test/ndee/subdir\r\ncannonical path before mkdirs(), should be mixed case as that's what's on the ma\r\nchine: C:\\cygwin\\home\\kmarsden\\repro\\11740\\test\\NDee\\subdir\r\ncreated the subdir? true\r\ncannonical path after  mkdirs(): C:\\cygwin\\home\\kmarsden\\repro\\11740\\test\\NDee\\s\r\nubdir\r\n\r\nThe workaround on iseries is to use the matching case for  the  path of the database. \r\n\r\nAnother situation where there is a problem with getCanonicalPath() on iseries that can cause this symptom is if there are multi-byte characters in the database name. (See DERBY-4149). I don't know a good work around for that one.\r\n\r\nI cannot speak to the vmware issues, but wonder if there is a casing or getCanonicalPath issue there too.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-03-09T23:40:30.638+0000","updated":"2011-03-09T23:40:30.638+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13004879","id":"13004879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"linking to DERBY-4149 as both are database not found that can be due to getCanonicalPath() problems.\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-03-09T23:47:35.151+0000","updated":"2011-03-09T23:47:35.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13005568","id":"13005568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevenhendrickx","name":"stevenhendrickx","emailAddress":"steven dot hendrickx at inventivegroup dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Hendrickx","active":true},"body":"Kathey, you are correct: Basically our code does something like: \r\n\r\nnew File(System.getProperty(\"user.home\"), \"productsubdir\"); \r\n\r\nOn the OS/400 system, System.getProperty(\"user.home\")  returned \"/home/SHENDRIC\" for me, while this should be \"/home/shendric\" (ls in qsh or qp2term). This seems the root of all evil. When the code is changed to:\r\n\r\nnew File(new File(System.getProperty(\"user.home\")).getCanonicalFile, \"productsubdir\");\r\n\r\nthe exception no longer occurs. Although this change seems to solve our problem, is there any plan to update Derby to anticipate this problem from within Derby itself?\r\n\r\nAnyway, thanks for the fast feed back and the great help.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stevenhendrickx","name":"stevenhendrickx","emailAddress":"steven dot hendrickx at inventivegroup dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Hendrickx","active":true},"created":"2011-03-11T09:47:19.387+0000","updated":"2011-03-11T09:47:19.387+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13005719","id":"13005719","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"It would be great to  see a fix in the JVM's  with the problem , so I think it would be  worthwhile to report  that you have hit the  problem to the various JVM support organizations if you have support.  \r\n\r\n   I haven't looked into a possible workaround in Derby, but since it seems to affect not only OS/400 but also other platforms running on VMWare, it seems like it would be worthwhile to look into working around the problem in DERBY if possible.  If you would like to work on that, I am sure members of the community can point you to the code area in question.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-03-11T17:02:43.163+0000","updated":"2011-03-11T21:52:24.207+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13016589","id":"13016589","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I'm marking this as invalid as it's not really a problem in derby, the problem is in the jvm on iseries.\r\nIf someone wants to implement a workaround within the derby code, they can reopen at that time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-04-06T22:36:24.130+0000","updated":"2011-04-06T22:36:24.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13093922","id":"13093922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"\r\nLooking again at this issue, I think it is actually a usage issue, external to Derby and to getCanonicalPath.\r\nHere the user is using the System Property  \"user.home\")  which has CAPS \r\n/home/SHENDRIC where the actual directory does not.\r\n\r\nWhen the user called getCanonicalPath() on user home, e.g.\r\n\r\n, new File(new File(System.getProperty(\"user.home\")).getCanonicalFile, \"productsubdir\"); \r\n\r\ngetCanonicalPath actually corrected the casing properly.  I wonder if passed the whole string, if getCanonicalPath would resolve the whole thing properly.\r\n\r\nAlso I would like to look at the actual exception and see what call is actually failing with the uppercase path and whether that should fail on iseries which generally ignores case.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-08-30T17:28:23.589+0000","updated":"2011-08-30T17:28:23.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13151395","id":"13151395","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am going to see if we can find an  internal workaround for this issue in Derby as it can be confusing to users.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-11-16T18:18:57.160+0000","updated":"2011-11-16T18:18:57.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13154717","id":"13154717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I can get past the database creation issue if I change StroageFactoryService.createServiceRoot() to get the canonical path with:\r\n                                   \r\nreturn serviceDirectory.getCanonicalPath();\r\nrather than\r\nreturn storageFactory.getCanonicalName();\r\n\r\nThe real problem is that DirStorageFactory.java holds a canonicalName value which is cached from the very first call to getCanonicalPath() in its doInit() method which occurs before the directory is created,  so has the wrong casing on iSeries.   I think probably the best comprehensive solution would be to only cache that value once we have a call to getCanonicalName when the directory exists.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-11-21T23:13:22.174+0000","updated":"2011-11-21T23:13:22.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13156274","id":"13156274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Here is a patch for this issue.  It adjusts the canonicalName after mkdirs() if it does not match getCanonicalPath().\r\n\r\nI had considered have a fix in DirStorageFactory which would upon getting the canonicalPath search back and ensure the correct casing for the directories that existed, but opted for the other approach as it should not exist in situations where there is not a casing issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-11-23T20:56:33.669+0000","updated":"2011-11-23T20:56:33.669+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13159254","id":"13159254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"+                                String serviceDirCanonicalPath = serviceDirectory.getCanonicalPath();\r\n+                                if (storageFactory.getCanonicalName() != serviceDirCanonicalPath) {\r\n+                                    storageFactory.setCanonicalName(serviceDirCanonicalPath);\r\n+                                }\r\n\r\nI suppose we should have used the equals() method to compare the strings here. Or maybe just set the canonical name unconditionally (advantages: less code, and the new code path will also be tested on non-iSeries machines).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-29T13:27:26.722+0000","updated":"2011-11-29T13:27:26.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13160264","id":"13160264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thank you Knut. That is a good idea to make it unconditional as I recall one user reporting they also saw this intermittently on Windows vmware.  This way the code path will be fully tested.\r\n\r\nattaching derby-5096_uncondset_diff.txt to do that.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-11-30T19:26:23.210+0000","updated":"2011-11-30T19:26:23.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13164468","id":"13164468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":" This is now checked into the 10.8 branch,10.7, and 10.5 as well..  Not closing as still need verification of the fix and to check into 10.6 and maybe go back even further.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-07T16:02:15.695+0000","updated":"2011-12-07T16:02:15.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13174210","id":"13174210","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"ported fix back to all branches through 10.5. The 10.6 fix doesn't show up on subversion commits, but was checked in with revision 1212214","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-21T16:59:17.251+0000","updated":"2011-12-21T16:59:17.251+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500641/comment/13823436","id":"13823436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update: close all resolved issues that haven't had any activity the last year]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-15T08:15:15.241+0000","updated":"2013-11-15T08:15:15.241+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5096/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06jtb:"}}