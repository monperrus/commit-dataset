{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12687080","self":"https://issues.apache.org/jira/rest/api/latest/issue/12687080","key":"SOLR-5601","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325573","id":"12325573","description":"Major release after 4.6","name":"4.7","archived":false,"released":true,"releaseDate":"2014-02-26"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321664","id":"12321664","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-01-03 03:57:41.934","customfield_12312323":null,"customfield_12310420":"366075","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_317215928_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-01-06T16:02:52.844+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5601/watchers","watchCount":3,"isWatching":false},"created":"2014-01-02T23:55:56.964+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325573","id":"12325573","description":"Major release after 4.6","name":"4.7","archived":false,"released":true,"releaseDate":"2014-02-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-03-16T13:04:13.705+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313841","id":"12313841","name":"SolrCloud"}],"timeoriginalestimate":null,"description":"Encountered a weird _semi-reproducible_ failure from MigrateRouteKeyTest.... \r\n\r\n{code}\r\nant test  -Dtestcase=MigrateRouteKeyTest -Dtests.method=testDistribSearch -Dtests.seed=26F9FF92782251B6 -Dtests.slow=true -Dtests.locale=sr_CS -Dtests.timezone=Europe/Zaporozhye -Dtests.file.encoding=UTF-8\r\n{code}\r\n\r\nAttempting to reproduce with that line caused failures the first 2 times i tried, and then succeeded every time after that.\r\n\r\nDetails of failure to follow in comment.\r\n\r\n(NOTE: this may be related to some recent jenkins failures due to thread leaks from this test)\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"366386","summary":"NPE in OverseerCollectionProcessor.migrateKey - inconsistent failure from MigrateRouteKeyTest","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687080/comment/13860972","id":"13860972","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"The initial start of trouble seened to me an NPE in OverseerCollectionProcessor.migrateKey...\r\n\r\n{noformat}\r\n   [junit4]   2> 324502 T1186 oasc.ZkController.checkRecovery I am the leader, no recovery necessary\r\n   [junit4]   2> 324502 T1186 oasc.ZkController.publish publishing core=split_shard2_temp_shard1_shard1_replica1 state=active\r\n   [junit4]   2> 324514 T1228 C220 P42114 oasup.LogUpdateProcessor.finish [collection1] webapp=/tr_/xq path=/update params={distrib.from=http://127.0.0.1:47570/tr_/xq/collection1/&version=2&wt=javabin&update.distrib=FROMLEADER} {add=[m/1!116 (1456162963872284672)]} 0 0\r\n   [junit4]   2> 324515 T1189 C221 P47570 oasup.LogUpdateProcessor.finish [collection1] webapp=/tr_/xq path=/update params={version=2&wt=javabin} {add=[m/1!116 (1456162963872284672)]} 0 3\r\n   [junit4]   2> 324526 T1186 oascc.ZkStateReader.updateClusterState Updating cloud state from ZooKeeper... \r\n   [junit4]   2> 324527 T1186 oasc.SolrXMLCoresLocator.doPersist Persisted core descriptions to /home/hossman/lucene/dev/solr/build/solr-core/test/J2/../../../../../../../../../home/hossman/lucene/dev/solr/build/solr-core/test/J2/./org.apache.solr.cloud.MigrateRouteKeyTest-jetty1-1388705195623/solr.xml\r\n   [junit4]   2> 324527 T1186 oass.SolrDispatchFilter.handleAdminRequest [admin] webapp=null path=/admin/cores params={numShards=1&collection.configName=conf1&version=2&wt=javabin&name=split_shard2_temp_shard1_shard1_replica1&shard=shard1&collection=split_shard2_temp_shard1&qt=/admin/cores&action=CREATE} status=0 QTime=1656 \r\n   [junit4]   2> 324528 T1174 oasc.OverseerCollectionProcessor.createCollection Finished create command on all shards for collection: split_shard2_temp_shard1\r\n   [junit4]   2> 324528 T1174 oasc.OverseerCollectionProcessor.migrateKey Asking source leader to wait for: split_shard2_temp_shard1_shard1_replica1 to be alive on: 127.0.0.1:47570_tr_%2Fxq\r\n   [junit4]   2> 324528 T1174 oasc.SolrException.log ERROR Collection migrate of migrate failed:java.lang.NullPointerException\r\n   [junit4]   2> \t\tat org.apache.solr.cloud.OverseerCollectionProcessor.migrateKey(OverseerCollectionProcessor.java:1208)\r\n   [junit4]   2> \t\tat org.apache.solr.cloud.OverseerCollectionProcessor.migrate(OverseerCollectionProcessor.java:1102)\r\n   [junit4]   2> \t\tat org.apache.solr.cloud.OverseerCollectionProcessor.processMessage(OverseerCollectionProcessor.java:252)\r\n   [junit4]   2> \t\tat org.apache.solr.cloud.OverseerCollectionProcessor.run(OverseerCollectionProcessor.java:176)\r\n   [junit4]   2> \t\tat java.lang.Thread.run(Thread.java:724)\r\n   [junit4]   2> \t\r\n   [junit4]   2> 324551 T1217 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/collection-queue-work/qnr-0000000002 state: SyncConnected type NodeDataChanged\r\n   [junit4]   2> 324552 T1172 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/queue state: SyncConnected type NodeChildrenChanged\r\n   [junit4]   2> 324552 T1172 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/queue state: SyncConnected type NodeChildrenChanged\r\n   [junit4]   2> 324559 T1172 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/collection-queue-work state: SyncConnected type NodeChildrenChanged\r\n   [junit4]   2> 324559 T1174 oasc.OverseerCollectionProcessor.run Overseer Collection Processor: Message id:/overseer/collection-queue-work/qn-0000000002 complete, response:{success={null={responseHeader={status=0,QTime=0},core=migrate_multipleshardtest_targetCollection_shard1_replica1,status=BUFFERING},null={responseHeader={status=0,QTime=1656},core=split_shard2_temp_shard1_shard1_replica1}},Operation migrate caused exception:=java.lang.NullPointerException,exception={msg=null,rspCode=-1}}\r\n   [junit4]   2> 324568 T1173 oascc.ZkStateReader.updateClusterState Updating cloud state from ZooKeeper... \r\n   [junit4]   2> 324569 T1173 oasc.Overseer$ClusterStateUpdater.updateState Update state numShards=1 message={\r\n   [junit4]   2> \t  \"operation\":\"state\",\r\n   [junit4]   2> \t  \"state\":\"active\",\r\n   [junit4]   2> \t  \"base_url\":\"http://127.0.0.1:47570/tr_/xq\",\r\n   [junit4]   2> \t  \"core\":\"split_shard2_temp_shard1_shard1_replica1\",\r\n   [junit4]   2> \t  \"roles\":null,\r\n   [junit4]   2> \t  \"node_name\":\"127.0.0.1:47570_tr_%2Fxq\",\r\n   [junit4]   2> \t  \"shard\":\"shard1\",\r\n   [junit4]   2> \t  \"shard_range\":null,\r\n   [junit4]   2> \t  \"shard_state\":\"active\",\r\n   [junit4]   2> \t  \"shard_parent\":null,\r\n   [junit4]   2> \t  \"collection\":\"split_shard2_temp_shard1\",\r\n   [junit4]   2> \t  \"numShards\":\"1\",\r\n   [junit4]   2> \t  \"core_node_name\":\"core_node1\"}\r\n   [junit4]   2> 324570 T1209 oass.SolrDispatchFilter.handleAdminRequest [admin] webapp=null path=/admin/collections params={split.key=a/1!&version=2&wt=javabin&forward.timeout=45&collection=collection1&target.collection=migrate_multipleshardtest_targetCollection&action=MIGRATE} status=500 QTime=2211 \r\n   [junit4]   2> 324571 T1209 oasc.SolrException.log ERROR null:org.apache.solr.common.SolrException\r\n   [junit4]   2> \t\tat org.apache.solr.handler.admin.CollectionsHandler.handleResponse(CollectionsHandler.java:204)\r\n   [junit4]   2> \t\tat org.apache.solr.handler.admin.CollectionsHandler.handleMigrate(CollectionsHandler.java:450)\r\n   [junit4]   2> \t\tat org.apache.solr.handler.admin.CollectionsHandler.handleRequestBody(CollectionsHandler.java:174)\r\n   [junit4]   2> \t\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\r\n   [junit4]   2> \t\tat org.apache.solr.servlet.SolrDispatchFilter.handleAdminRequest(SolrDispatchFilter.java:705)\r\n   [junit4]   2> \t\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:260)\r\n   [junit4]   2> \t\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:200)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\r\n   [junit4]   2> \t\tat org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:136)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:229)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.handler.GzipHandler.handle(GzipHandler.java:301)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1077)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.Server.handle(Server.java:368)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:489)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:942)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:1004)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\r\n   [junit4]   2> \t\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\r\n   [junit4]   2> \t\tat java.lang.Thread.run(Thread.java:724)\r\n   [junit4]   2> \t\r\n   [junit4]   2> 324572 T1249 C222 P46266 oasup.LogUpdateProcessor.finish [collection1] webapp=/tr_/xq path=/update params={distrib.from=http://127.0.0.1:52363/tr_/xq/collection1/&version=2&wt=javabin&update.distrib=FROMLEADER} {add=[n/1!117 (1456162963931004928)]} 0 0\r\n   [junit4]   2> 324573 T1207 C223 P52363 oasup.LogUpdateProcessor.finish [collection1] webapp=/tr_/xq path=/update params={version=2&wt=javabin} {add=[n/1!117 (1456162963931004928)]} 0 5\r\n   [junit4]   2> 324585 T1146 oasc.ChaosMonkey.monkeyLog monkey: stop shard! 36682\r\n   [junit4]   2> 324585 T1146 oasc.CoreContainer.shutdown Shutting down CoreContainer instance=2033417453\r\n   [junit4]   2> 324586 T1146 oasc.ZkController.publish publishing core=collection1 state=down\r\n   [junit4]   2> 324586 T1146 oasc.ZkController.publish numShards not found on descriptor - reading it from system property\r\n   [junit4]   2> 324617 T1172 oasc.DistributedQueue$LatchChildWatcher.process LatchChildWatcher fired on path: /overseer/queue state: SyncConnected type NodeChildrenChanged\r\n{noformat}\r\n\r\n...which then cascaded into an \"IllegalStateException: Connection pool shut down\"...\r\n\r\n{noformat}\r\n   [junit4]   2> 324711 T1281 oascc.ZkStateReader.createClusterStateWatchersAndUpdate Updating cluster state from ZooKeeper... \r\n   [junit4]   2> 324718 T1197 oascc.SolrZkClient.makePath makePath: /overseer_elect/leader\r\n   [junit4]   2> 324722 T1146 oejsh.ContextHandler.doStop stopped o.e.j.s.ServletContextHandler{/tr_/xq,null}\r\n   [junit4]   2> 324726 T1197 oasc.Overseer.start Overseer (id=91010183481589766-127.0.0.1:47570_tr_%2Fxq-n_0000000001) starting\r\n   [junit4]   2> 324727 T1281 oasc.MigrateRouteKeyTest$Indexer.run ERROR Exception while adding document id: id=o/1!118 org.apache.solr.client.solrj.SolrServerException: org.apache.solr.client.solrj.SolrServerException: java.lang.IllegalStateException: Connection pool shut down\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.impl.CloudSolrServer.directUpdate(CloudSolrServer.java:361)\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.impl.CloudSolrServer.request(CloudSolrServer.java:510)\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.request.AbstractUpdateRequest.process(AbstractUpdateRequest.java:117)\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:116)\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:102)\r\n   [junit4]   2> \tat org.apache.solr.cloud.MigrateRouteKeyTest$Indexer.run(MigrateRouteKeyTest.java:252)\r\n   [junit4]   2> Caused by: org.apache.solr.client.solrj.SolrServerException: java.lang.IllegalStateException: Connection pool shut down\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:310)\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.impl.CloudSolrServer.directUpdate(CloudSolrServer.java:358)\r\n   [junit4]   2> \t... 5 more\r\n   [junit4]   2> Caused by: java.lang.IllegalStateException: Connection pool shut down\r\n   [junit4]   2> \tat org.apache.http.pool.AbstractConnPool.lease(AbstractConnPool.java:167)\r\n   [junit4]   2> \tat org.apache.http.pool.AbstractConnPool.lease(AbstractConnPool.java:199)\r\n   [junit4]   2> \tat org.apache.http.impl.conn.PoolingClientConnectionManager.requestConnection(PoolingClientConnectionManager.java:188)\r\n   [junit4]   2> \tat org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:448)\r\n   [junit4]   2> \tat org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:906)\r\n   [junit4]   2> \tat org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:805)\r\n   [junit4]   2> \tat org.apache.http.impl.client.AbstractHttpClient.execute(AbstractHttpClient.java:784)\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:395)\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199)\r\n   [junit4]   2> \tat org.apache.solr.client.solrj.impl.LBHttpSolrServer.request(LBHttpSolrServer.java:283)\r\n   [junit4]   2> \t... 6 more\r\n   [junit4]   2> \r\n{noformat}\r\n\r\n\r\n...lots more \"IllegalStateException: Connection pool shut down\" for various doc add attempts, ultimatly leading to...\r\n\r\n\r\n\r\n{noformat}\r\n   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=MigrateRouteKeyTest -Dtests.method=testDistribSearch -Dtests.seed=26F9FF92782251B6 -Dtests.slow=true -Dtests.locale=sr_CS -Dtests.timezone=Europe/Zaporozhye -Dtests.file.encoding=UTF-8\r\n   [junit4] ERROR   28.8s J2 | MigrateRouteKeyTest.testDistribSearch <<<\r\n   [junit4]    > Throwable #1: org.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: Server Error\r\n   [junit4]    > request: http://127.0.0.1:52363/tr_/xq/admin/collections?action=MIGRATE&collection=collection1&target.collection=migrate_multipleshardtest_targetCollection&split.key=a/1!&forward.timeout=45&wt=javabin&version=2\r\n   [junit4]    > \tat __randomizedtesting.SeedInfo.seed([26F9FF92782251B6:A71F718A0F7D318A]:0)\r\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:495)\r\n   [junit4]    > \tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:199)\r\n   [junit4]    > \tat org.apache.solr.cloud.MigrateRouteKeyTest.invoke(MigrateRouteKeyTest.java:139)\r\n   [junit4]    > \tat org.apache.solr.cloud.MigrateRouteKeyTest.invokeMigrateApi(MigrateRouteKeyTest.java:125)\r\n   [junit4]    > \tat org.apache.solr.cloud.MigrateRouteKeyTest.multipleShardMigrateTest(MigrateRouteKeyTest.java:198)\r\n   [junit4]    > \tat org.apache.solr.cloud.MigrateRouteKeyTest.doTest(MigrateRouteKeyTest.java:93)\r\n   [junit4]    > \tat org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:867)\r\n   [junit4]    > \tat java.lang.Thread.run(Thread.java:724)\r\n{noformat}\r\n\r\n\r\n...and then...\r\n\r\n{noformat}\r\n   [junit4]   2> 50947 T1145 ccr.ThreadLeakControl.checkThreadLeaks SEVERE 4 threads leaked from SUITE scope at org.apache.solr.cloud.MigrateRouteKeyTest: \r\n   [junit4]   2> \t   1) Thread[id=1298, name=Timer-98, state=TIMED_WAITING, group=TGRP-MigrateRouteKeyTest]\r\n   [junit4]   2> \t        at java.lang.Object.wait(Native Method)\r\n   [junit4]   2> \t        at java.util.TimerThread.mainLoop(Timer.java:552)\r\n   [junit4]   2> \t        at java.util.TimerThread.run(Timer.java:505)\r\n   [junit4]   2> \t   2) Thread[id=1299, name=Thread-532-SendThread(localhost:46743), state=TIMED_WAITING, group=TGRP-MigrateRouteKeyTest]\r\n   [junit4]   2> \t        at java.lang.Thread.sleep(Native Method)\r\n   [junit4]   2> \t        at org.apache.zookeeper.client.StaticHostProvider.next(StaticHostProvider.java:86)\r\n   [junit4]   2> \t        at org.apache.zookeeper.ClientCnxn$SendThread.startConnect(ClientCnxn.java:937)\r\n   [junit4]   2> \t        at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:993)\r\n   [junit4]   2> \t   3) Thread[id=1300, name=Thread-532-EventThread, state=WAITING, group=TGRP-MigrateRouteKeyTest]\r\n   [junit4]   2> \t        at sun.misc.Unsafe.park(Native Method)\r\n   [junit4]   2> \t        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\r\n   [junit4]   2> \t        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)\r\n   [junit4]   2> \t        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)\r\n   [junit4]   2> \t        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:491)\r\n   [junit4]   2> \t   4) Thread[id=1281, name=Thread-532, state=TIMED_WAITING, group=TGRP-MigrateRouteKeyTest]\r\n   [junit4]   2> \t        at java.lang.Object.wait(Native Method)\r\n   [junit4]   2> \t        at org.apache.solr.common.cloud.ConnectionManager.waitForConnected(ConnectionManager.java:204)\r\n   [junit4]   2> \t        at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:139)\r\n   [junit4]   2> \t        at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:98)\r\n   [junit4]   2> \t        at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:88)\r\n   [junit4]   2> \t        at org.apache.solr.common.cloud.ZkStateReader.<init>(ZkStateReader.java:183)\r\n   [junit4]   2> \t        at org.apache.solr.client.solrj.impl.CloudSolrServer.connect(CloudSolrServer.java:240)\r\n   [junit4]   2> \t        at org.apache.solr.client.solrj.impl.CloudSolrServer.request(CloudSolrServer.java:501)\r\n   [junit4]   2> \t        at org.apache.solr.client.solrj.request.AbstractUpdateRequest.process(AbstractUpdateRequest.java:117)\r\n   [junit4]   2> \t        at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:116)\r\n   [junit4]   2> \t        at org.apache.solr.client.solrj.SolrServer.add(SolrServer.java:102)\r\n   [junit4]   2> \t        at org.apache.solr.cloud.MigrateRouteKeyTest$Indexer.run(MigrateRouteKeyTest.java:252)\r\n{noformat}\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2014-01-02T23:56:23.474+0000","updated":"2014-01-02T23:56:23.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687080/comment/13861176","id":"13861176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anshumg","name":"anshumg","emailAddress":"anshum at anshumgupta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=anshumg&avatarId=19239","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=anshumg&avatarId=19239","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=anshumg&avatarId=19239","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=anshumg&avatarId=19239"},"displayName":"Anshum Gupta","active":true},"body":"I tried running the test 50 times over but didn't yet run into it.\r\n\r\nLooks like it had issues at one of the 2 spots considering that it never seemed to have asked the source leader to split the index:\r\n# While constructing the WaitForState call i.e. waiting for the replicas to be seen as active on temp source leader (More likely as I couldn't spot any logs from there)\r\n# During the above mentioned WaitForState call.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anshumg","name":"anshumg","emailAddress":"anshum at anshumgupta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=anshumg&avatarId=19239","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=anshumg&avatarId=19239","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=anshumg&avatarId=19239","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=anshumg&avatarId=19239"},"displayName":"Anshum Gupta","active":true},"created":"2014-01-03T03:57:41.934+0000","updated":"2014-01-03T03:57:41.934+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687080/comment/13861494","id":"13861494","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"body":"This should fix it. It was possible that the temp collection had been created (since we wait for it) but the leader hadn't been elected yet causing the NPE. We should use zkStateReader.getLeaderRetry for this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"created":"2014-01-03T13:21:08.002+0000","updated":"2014-01-03T13:21:08.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687080/comment/13861508","id":"13861508","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1555083 from shalin@apache.org in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1555083 ]\r\n\r\nSOLR-5601: Use zkStateReader.getLeaderRetry to find the leader of a newly created temp collection","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-01-03T13:39:28.418+0000","updated":"2014-01-03T13:39:28.418+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687080/comment/13861519","id":"13861519","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1555084 from shalin@apache.org in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1555084 ]\r\n\r\nSOLR-5601: Use zkStateReader.getLeaderRetry to find the leader of a newly created temp collection","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-01-03T13:41:35.869+0000","updated":"2014-01-03T13:41:35.869+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12687080/comment/13863062","id":"13863062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"body":"I haven't seen this issue again on jenkins and couldn't reproduce this after the fix on my ec2 test box.\r\n\r\nThanks Hoss and Anshum!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"created":"2014-01-06T16:02:52.886+0000","updated":"2014-01-06T16:02:52.886+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5601/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1r3ov:"}}