{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12378633","self":"https://issues.apache.org/jira/rest/api/latest/issue/12378633","key":"DERBY-3083","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12310220":"2007-09-19 23:16:01.346","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23419","customfield_12310222":null,"customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3083/watchers","watchCount":2,"isWatching":false},"created":"2007-09-19T09:03:05.301+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_triage10_11"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12317842","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12317842","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12380002","key":"DERBY-3120","self":"https://issues.apache.org/jira/rest/api/2/issue/12380002","fields":{"summary":"Including derby 10.3.1.4 in Maven projects results in error at runtime: \"Cannot find derbynet.jar on the classpath\"","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12318494","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12318494","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12384334","key":"DERBY-3269","self":"https://issues.apache.org/jira/rest/api/2/issue/12384334","fields":{"summary":"Investigate issues with renaming jars for maven deployment","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-03T15:26:42.892+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11414","id":"11414","name":"Tools"}],"timeoriginalestimate":null,"description":"The network server will not start if the derbynet jar is added under a different name than \"derbynet.jar\" to the classpath. This makes it impossible to use it in maven projects where the jar is renamed to \"derbynet-10.3.1.4.jar\".\r\n\r\nThis did work with 10.2.2.0","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36804","summary":"Network server demands a file called \"derbynet.jar\" in classpath","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":42,"total":42,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12528951","id":"12528951","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I have not confirmed but think this may be related to DERBY-2196 to install a security manager by default. I notice it does not display when I start with -noSecurityManager. A possible workaround may be to install your own security manager instead of using the default one.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-19T23:16:01.346+0000","updated":"2007-09-19T23:16:01.346+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12529028","id":"12529028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Thanks for the workaround. -noSecurityManager works for me, too.\r\n\r\nIn that case, the security manager should be fixed not to rely on a fix jar name :-) What happens when I patch the JAR or feed Java a completely different JAR as \"derbynet.jar\"?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2007-09-20T08:59:08.294+0000","updated":"2007-09-20T08:59:08.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12529492","id":"12529492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Aaron said:\r\n>In that case, the security manager should be fixed not to rely on a fix jar name :-) What happens when I >patch the JAR or feed Java a completely different JAR as \"derbynet.jar\"?\r\n\r\nI agree. perhaps Rick has some ideas on how to achieve this since he implemented the functionality  For the sake of backward compatibility I think at least the start should not fail and perhaps just print a warning to derby.log that the security manager was not installed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-21T16:53:24.570+0000","updated":"2007-09-21T16:53:24.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12533552","id":"12533552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"The derby jars contain metadata (including [but not limited to] a security policy) that assumes the names of the jars and that they reside in the same folder.\r\n\r\nDoes any documentation indicates that it's ok to change the jar names and have everything continue to work as before?\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-10-09T23:59:21.909+0000","updated":"2007-10-09T23:59:21.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12533642","id":"12533642","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Does any documentation indicate that it's *not* ok to change the JAR name? :-) This is Java after all and I'm used that I can use what I can put on the classpath. Moreover, when you use Maven, then the JAR names must include the version number. So this change makes it impossible to use Derby with Maven.\r\n\r\nI'm using Derby extensively to replace a real DB2 for my test cases and I couldn't care less about a security policy. It's nice to have one shipped with the product but I fail to see the advantage to make it the *default*.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2007-10-10T07:48:54.348+0000","updated":"2007-10-10T07:48:54.348+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12533728","id":"12533728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I imagine that we could parameterize the names of the jars in the default policy and then teach server startup to make some smart guesses about which jars are germane, based on whether they contain certain distinguished classes.\r\n\r\nTechnically, there's nothing to prevent users from breaking open all of Derby's jar files and recombining them into a single giant jar. I think that if a user does that, then the user is responsible for adjusting the security policy.\r\n\r\nIf Maven is going to rename jar files, then I think Maven needs to regenerate the security policy. This is just how Java security works: permissions are granted to named code domains and those domains are identified by jar file names.\r\n\r\nAaron is right that we haven't stated explicitly what kinds of tampering void your warranty. Perhaps we should add a big warning in our user guides.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-10-10T12:47:48.377+0000","updated":"2007-10-10T12:47:48.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12533750","id":"12533750","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"On derby-dev, Bryan suggests another solution:\r\n\r\nAlternatively, perhaps we could have a glance at the classpath\r\nduring startup, perhaps by sharing the code that sysinfo uses,\r\nand only install the default policy if the user appears to\r\nbe using the default set of jars.\r\n\r\nThat is, if we don't see derby.jar, derbynet.jar on the\r\nclasspath when starting up Network Server, then we assume that\r\nthe user has taken control of the *entire* configuration process,\r\nincluding the configuration of the security policy, and so we\r\ndon't attempt to install a default security policy in that case. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-10-10T14:48:33.149+0000","updated":"2007-10-10T14:48:33.149+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12533799","id":"12533799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Aaron> Does any documentation indicate that it's *not* ok to change the JAR name? :-)\r\n\r\nWell the documentation describes what the code does, if someone changes something you can't necessarily assume that the code will work the same way :-)\r\n\r\nIt's much like if someone decided to put all the locale messages into a single locale jar and removed the others, Derby using the documented code path will then not pick up any localized messages because the change is incomplete.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-10-10T16:59:13.942+0000","updated":"2007-10-10T16:59:13.942+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12540568","id":"12540568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I think I like Bryan's approach best. If we don't see derby.jar and derbynet.jar on the classpath, then we won't install a security manager. Unless someone objects strongly, I will code this fix. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-06T21:01:16.503+0000","updated":"2007-11-06T21:01:16.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12540588","id":"12540588","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Rather than checking the classpath (which is non-standard) and needs to be more detailed(*) than derby.jar and derbynet.jar on the classpath, why not  simply see the name of the jar the network server code is coming from. The code must already get the url to set up the properties for the server policy.\r\n\r\n\r\n(*) Classpath could just be derbynet.jar, could be started using -jar command with derbyrun.jar or derbynet.jar, ...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-06T21:49:28.763+0000","updated":"2007-11-06T21:49:28.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12540712","id":"12540712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Rick: This again breaks the idea of \"least surprise\". The network server should not try to install a security manager at all until told so. The first breaking of that rule is what caused the problems in the first place.\r\n\r\nI suggest that you remove the code which tries to install the SM by default and add new code which is enabled by an option (property or command line). That option should either be \"yes/no\" if you can figure out the name of the JAR or it should specify the name of the JAR which contains the preferred SM. If the option is given and no SM can be installed, an exception should be thrown, aborting the program.\r\n\r\nThis would give control to the user instead of involving further black magic which will only lead to a long series of bugs and patches, all because of breaking \"least surprise\" again and again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2007-11-07T10:10:01.978+0000","updated":"2007-11-07T10:10:01.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12540807","id":"12540807","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Note the purpose of the default security manager is to avoid the surprise of booting a network server providing complete access to your machine by all. Thus the least surprise should be a secure system.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-07T17:20:28.651+0000","updated":"2007-11-07T17:20:28.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12540856","id":"12540856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Well, I've used tons of Java software (probably everything kind except for applets) and Derby was the first one to have a Security Manager, so in my case running into one violated the rule \"least surprises\". OTOH, I know perfectly well that a misconfigured network server compromises the security of my computer (they all do, that's common knowledge even if most people actively ignore this simple fact). Therefore, a network server which is secure also violates the rule.\r\n\r\nSo it is an attempt to make the world better on your part but it certainly breaks the \"least surprise\" rule unless you can make it work even when I do strange things like renaming the JAR, repackaging everything in an ueberjar and the like. If you really, absolutely need to have your SM, make it fail gracefully (if DerbyNet can't install it, print a warning and go on) or ask the user to enable it with an option if they need/want it.\r\n\r\nOtherwise, you will annoy 90% of the users of your code:\r\n\r\n10% know more about security than you do and they do it differently; trying to teach them won't work\r\n80% don't know and don't care and they hate you for making their lives \"unnecessary\" complex (a.k.a \"what do I need that stupid virus scanner for? Open that proxy already! OWN3Z.COM wants to install TakeOver.EXE? OK!\")\r\nWhich leaves 10% who don't know and care enough to learn how to secure their system\r\n\r\n;-)\r\n\r\nI'm in the first 10%, by the way: For my JUnit tests, I just need an option to bind the server to 127.0.0.1 and no SM.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2007-11-07T19:34:54.839+0000","updated":"2007-11-07T19:34:54.839+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12540871","id":"12540871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"To be clear the security manager is trying to secure the out of the box configuration, not a misconfigured server.\r\n\r\nIs it typically for a database server in its out of the box configuration to allow any remote user to take over a machine?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-07T20:05:49.306+0000","updated":"2007-11-07T20:05:49.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543628","id":"12543628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Right now the default policy file grants permissions to the following codebases:\r\n\r\n${derby.install.url}derby.jar\r\n${derby.install.url}derbynet.jar\r\n${derby.install.url}derbytools.jar\r\n${derby.install.url}derbyclient.jar\r\n${derby.install.url}derbytesting.jar\r\n\r\nAt boot time, the server sets the value of the derby.install.url property before installing a SecurityManager. We could refine our codebase declarations to something like this:\r\n\r\n${derby.install.derby.jar.url}\r\n${derby.install.derbynet.url}\r\n${derby.install.derbytools.url}\r\n${derby.install.derbyclient.url}\r\n${derby.install.derbytesting.url}\r\n\r\nThen the server could set the values of these properties using a heuristic like this:\r\n\r\n${derby.install.derby.jar.url}  - the jar where EmbeddedDriver lives\r\n${derby.install.derbynet.url} - the jar where NetworkServerControl lives\r\n${derby.install.derbytools.url} - the jar where ij lives\r\n${derby.install.derbyclient.url} - the jar where ClientDriver lives\r\n${derby.install.derbytesting.url} - the jar where BaseTestCase lives\r\n\r\nFor extra credit, we could use this strategy to clean up the multiple permission grants needed to handle sysinfo. That is, the policy file could grant those permissions to one code base:\r\n\r\n${derby.install.sysinfo.jar.url}  - the first jar where sysinfo lives\r\n\r\nDoes this sound like an acceptable solution?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-19T18:10:27.377+0000","updated":"2007-11-19T18:10:27.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543631","id":"12543631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I hope the default policy for the network server is not granting permissions to derbytools, derbyclient or derbytesting. The original spec had carefully limited permissions intended to support running the network server.\r\n\r\nThe use of properties for the jar files names in the policy files increases a security hole, now if any code can intercept the property setting then it allows that code to grant the permissions intended for Derby to any jar on the file system. By limiting the name to derbynet.jar (etc.) that hole is reduced. To support maven maybe the name could be ${derby.install.url}derbynet${version}.jar","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-19T18:31:20.251+0000","updated":"2007-11-19T18:31:20.251+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543645","id":"12543645","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for the quick feedback, Dan.\r\n\r\nThe server policy file grants permissions to derbytools, derbyclient, and derbyTesting in order to fix DERBY-3086. The problem is that we don't control the order in which jar files are wired into the classpath. Unfortunately, sysinfo lives in all of those jar files and the permissions it needs must be granted to the first of those jar files which appears on the classpath.\r\n\r\nI don't understand how the property setting could be intercepted. That would involve injecting malicious code into NetworkServerControl.installSecurityManager() just after the properties are forcibly set and just before the SecurityManager is installed. These are properties which are private to Derby and which we don't allow the user to override. Could you explain more about how the property setting could be intercepted?\r\n\r\nThe security hole I see is if the customer repackages the jar files, perhaps folding them into a master jar file which contains application code. In that case the proposed scheme would end up granting all of Derby's permissions to application code. For the record, the same subversion can occur with the scheme we have today: The customer just needs to put application code into derby.jar.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-19T19:26:22.076+0000","updated":"2007-11-19T19:26:22.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543686","id":"12543686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"> I don't understand how the property setting could be intercepted. That would involve injecting malicious code into NetworkServerControl.installSecurityManager() \r\n> just after the properties are forcibly set and just before the SecurityManager is installed.\r\n\r\nCorrect.\r\n\r\n> These are properties which are private to Derby and which we don't allow the user to override.\r\n\r\nHow are system properties private to Derby and what stops a user overriding them?\r\n\r\n> Could you explain more about how the property setting could be intercepted?\r\n\r\nThere is a window as you describe where other code could manipulate the property values. Currently any code that does manage to execute during that window has a limited range of changes it can make with respect to the default policy file. Today it can get the permissions granted to the derby files to be granted to other files with identical names. Making the complete jar name in the policy file a property expands the scope of malicious activity, now the code could give permissions to any jar.\r\n\r\nAs for how, well I think you are looking at the approach of proving such an interception can not happen, I don't know how to do that.\r\n\r\nI'm looking at the approach of there is a window for such intrusion, so it's bound to be exploitable by someone (e.g. JMX?), so given it can happen what can be done to minimize or even remove any malicious attacks.\r\n\r\nTrying to prove something can't happen seems much harder to me than minimizing the effects of when it does happen.\r\n\r\nFixing DERBY-2362 would help in this area, ensuring the the security manager installed is the one the network server code configured.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-19T20:58:17.734+0000","updated":"2007-11-19T20:58:17.734+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543706","id":"12543706","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for the clarification, Dan. By \"private to Derby\" I mean that the properties cannot be overridden by any scheme that I'm aware of. For instance, someone could try to override the properties on the boot command line--but these overrides would be ignored because Derby would forcibly set the properties to values it calculated.\r\n\r\nFixing DERBY-2362 could reduce the vulnerability. However, I don't understand how to fix DERBY-2362. The solutions which come to my mind seem to have the same small windows of vulnerability which we're discussing here. If we could figure out how those windows could in fact be exploited then we might be able to talk about a solution.\r\n\r\nAs you note, if there is a way to exploit this window, then it can be used to subvert the value of \"derby.install.url\" today. The incremental exposure seems very small to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-19T22:12:34.664+0000","updated":"2007-11-19T22:12:34.664+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543730","id":"12543730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"> By \"private to Derby\" I mean that the properties cannot be overridden by any scheme that I'm aware of. \r\n\r\nBut any code that could execute in the window described previously could change those properties, thus they are not private to derby since they are system properties.\r\n\r\n> Fixing DERBY-2362 could reduce the vulnerability. However, I don't understand how to fix DERBY-2362. The solutions which come to my mind seem to have the same small windows of vulnerability \r\n\r\nThe fix is described in the description to DERBY-2362, I don't see any windows of vulnerability, could you explain what you are thinking?\r\n\r\n> As you note, if there is a way to exploit this window, then it can be used to subvert the value of \"derby.install.url\" today. The incremental exposure seems very small to me.\r\n\r\nTo my thinking increasing a security hole in any way is not a good direction to go in.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-19T23:20:43.535+0000","updated":"2007-11-19T23:20:43.535+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543832","id":"12543832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"> To my thinking increasing a security hole in any way is not a good direction to go in.\r\n\r\nThat would mean it is okay for users, who have to rename the JARs, to have no security at all.\r\n\r\nYour whole argument goes like this: Someone hacks the VM, intercepts the bytecode executor or the JIT, injects malicious code in the right place (after the system properties from the command line have been overwritten by NetworkServerControl.installSecurityManager() and before they are used to install the security policy) and thus takes over the network manager. A possible scenario, I admit. Anyone here who believes this will ever happen?\r\n\r\nIf I gain access to the VM, it would be much more simple to use the debug API to replace the class implementing the SecurityManager or to patch the JARs and restart the service.\r\n\r\nSo ... yes, Ricks approach widens the security window but I fail to see it creating a wider attack vector than what we already have. If you have access to the VM, then you can whack this security scheme to death but my understanding of the whole secuity manager in the Derby context is to make sure it is not possible to inject malicious code from the network side. At the time when the SM is installed, Derby doesn't accept connections, so there is no attack vector at this time.\r\n\r\nAfter that, the SM is installed and malicious code from outside is confined within the limits of the SM.\r\n\r\nIf someone has access to the machine, no SM in the world can prevent them to play with the JARs, the classpath or the VM. That is host security and completely outside the scope of Derby.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2007-11-20T09:52:37.629+0000","updated":"2007-11-20T09:52:37.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543900","id":"12543900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":">The fix is described in the description to DERBY-2362, I don't see any windows of vulnerability, could you explain what you are thinking? \r\n\r\nWe seem to be talking about an attacker who has the ability to change system properties at any point in Derby's processing. Here is the scenario which came to my mind:\r\n\r\n1) Derby sets system properties just before installing a security manager.\r\n\r\n2) Blackhat changes the properties.\r\n\r\n3) Derby installs the security manager.\r\n\r\n4) Blackhat prompts a call to the security manager, which faults in the policy file and substitutes in the current values of the system properties.\r\n\r\n5) Blackhat then changes the properties back to the values which Derby set.\r\n\r\n6) Derby then runs the checks described in DERBY-2362 but sees nothing amiss.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-20T14:19:25.445+0000","updated":"2007-11-20T14:19:25.445+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543930","id":"12543930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"> We seem to be talking about an attacker who has the ability to change system properties at any point in Derby's processing.\r\n\r\nTo be precise, not at any point, but while a security manager with Derby's default policy is not installed. Obviously Derby is installing a security manager because none exists, hence any code can set any system property.\r\n\r\nInteresting case, that does require that step 2) changed the policy file to be used by the security manager, otherwise step 5) is not possible.\r\nI'll have to investigate if it would be possible for Blackhat to do that without it being detected by Derby's checks (as-in DERBY-2362).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-20T16:11:53.980+0000","updated":"2007-11-20T16:11:53.980+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12543999","id":"12543999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-3083-01-requireDerbynet-aa.diff. This implements Dan's modification to Bryan's solution. Would appreciate feedback.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-20T18:41:27.857+0000","updated":"2007-11-20T18:41:27.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12544014","id":"12544014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":">> To my thinking increasing a security hole in any way is not a good direction to go in.\r\n> That would mean it is okay for users, who have to rename the JARs, to have no security at all. \r\n\r\nSorry, I don't follow your logic here.\r\n\r\n> Your whole argument goes like this: Someone hacks the VM, [snip ...]\r\n\r\nNo, my argument is that there is a vulnerability, thus it is subject to be being exploited. I'm making no arguments as to how it could be exploited, an exploitation might require any number of other vulnerabilities in Derby, other software or anything else. Just look at the viruses and worms that exist today, the crackers see a useful vulnerability in one piece of code and then look for ways to exploit it.\r\n\r\n> injects malicious code in the right place (after the system properties from the command line have been overwritten by NetworkServerControl.installSecurityManager() and before they are used to install the security policy)\r\n\r\nNote that code only needs to be run during the window of vulnerability, it does not need to be injected into the byte code stream. Another thread running code at the right time will do, especially on dual core machines. Even if this only works 0.1% of the time, the potential number of derby servers available might make it worthwhile.\r\n[*]\r\n\r\nIf Derby wants to provide a secure database server then all such vulnerabilities need to removed, or at the least minimized, not increased. I see it as much like a multi-threading bug, it may look like a small window from the code but some multi-threaded application will hit that bug.\r\n\r\n\r\n[* \"... 368,000 Microsoft SQL Server and 124,000 Oracle databases are vulnerable to various levels of attack. [on the internet]]\r\n[ http://www.regdeveloper.co.uk/2007/11/15/unprotected_databases_survey/  ]\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-20T19:20:40.414+0000","updated":"2007-11-20T19:20:40.414+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12544019","id":"12544019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"In the patch isn't the string manipulation in packagingLooksGood just implementing String.endsWith()?\r\n\r\nIt would be good for the comments to packagingLooksGood() explicitly state what the expected packaging is.\r\n\r\nAny reason why for Maven'ized jars we can't support the jar file name matching the version number:\r\n\r\nSomething like\r\n\r\n${derby.install.url}derbynet${derby.version}.jar\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-20T19:30:10.881+0000","updated":"2007-11-20T19:30:10.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12544074","id":"12544074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for the quick feedback, Dan. Attaching derby-3086-01-requireDerbynet-ab.diff. You are right that endsWith() accomplishes what I want much more clearly. I have also expanded the comment on packagingLooksGood().\r\n\r\nI am not tackling the Maven versioning scheme here. Someone else is welcome to take that on. I am tackling what I see to be the regression introduced by DERBY-2196:\r\n\r\n1) The server crashes immediately if it can't find a jar file named derbynet.jar.\r\n\r\nWith this patch, the server will boot against the Mavenized jars--but it won't install a security manager.\r\n\r\nI think there is a follow-on enhancement which someone else is welcome to log and tackle:\r\n\r\n2) Make the server install a SecurityManager if the derby jars have names which conform to some other naming convention.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-20T21:24:38.577+0000","updated":"2007-11-20T21:24:38.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12544392","id":"12544392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"> No, my argument is that there is a vulnerability, thus it is subject to be being exploited.\r\n\r\nOkay, let me see if we're on the same track here: A Security Manager will do this: It will enforce allowed operations on specific JARs on the classpath. The JARs are not signed and not protected in any way other than their name and path.\r\n\r\nSo Daniel's arguments boils down to this: \"I enhance security by enforcing the JAR to have a certain name/path\". I do not believe this is true. As long as I can add malicious code to the JAR without the SM noticing, enforcing the name will not give additional protection. Therefore, enforcing a specific name will only add a false sense of security which isn't really there. This is even more dangerous than having an unknown vulnerability since people will believe they are safe when they are not.\r\n\r\nTo be as safe as we can possibly be, I suggest that you use Class.getResource() on specific classes which should be on the classpath and strip the package and class from the resulting URL. This will be as safe as the static JAR names (as to my argument above) and it will work for both the case that the JARs have been renamed and that they have been collected in an ueberjar.\r\n\r\nFor the same reasons, storing these URLs in the system properties (or any global variable) is okay too, because this cannot be exploited from a remote attacker and the SM doesn't give any protection against a local attacker anyway. As long as users use the supplied code, they will be perfectly safe as long as no one can modify the classpath when the server is started. If they embed the code in a larger app, they have to think about security themselves; we aren't able to forsee what they might do and therefore, we can't make their code secure for them at this time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2007-11-21T09:37:50.270+0000","updated":"2007-11-21T09:37:50.270+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12544508","id":"12544508","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Committed derby-3083-01-requireDerbynet-ab.diff at subversion revision 597125. I believe that this fixes the regression introduced by DERBY-2196. However, the discussion of this issue is continuing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-21T16:04:53.008+0000","updated":"2007-11-21T16:04:53.008+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12544514","id":"12544514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Ported 597125 from trunk to 10.3 branch at subversion revision 597131.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-21T16:14:32.334+0000","updated":"2007-11-21T16:14:32.334+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12544526","id":"12544526","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"> So Daniel's arguments boils down to this: \"I enhance security by enforcing the JAR to have a certain name/path\".\r\nThat is my argument yes.\r\n\r\n> As long as I can add malicious code to the JAR without the SM noticing, enforcing the name will not give additional protection.\r\nAgreed, it gives no additional protection for that specific situation, I have not claimed it would do. Remember I'm making no assumptions about how a vulnerability is exploited, only that it is there to be exploited. Thus I'm not making assumptions the attacker has access to the a local machine or ability to modify the jars etc.\r\n\r\nThe policy file that allows an arbitrary name for the code source has the potential for it to be applied to any jar on the file system, a policy file with a specific name portion (such as derby.jar) can only be applied to a limited number of jars on the file system. The policy file in question has some very useful permissions, such as ALL FILES.\r\n\r\n> Therefore, enforcing a specific name will only add a false sense of security which isn't really there. \r\nI've only ever claimed that the specific names reduces a vulnerability.\r\n\r\n> storing these URLs in the system properties (or any global variable) is okay too, because this cannot be exploited from a remote attacker\r\nThat's an assumption that's hard to prove and one I would not be willing to make when looking at security. Remember the vulnerability exists before the security manager is installed, thus setting system properties is open for any code running in the jvm. Could some JMX agent or debugging agent be active that would allow properties to be set from a remote user (or local user using tcp/ip)?.\r\n\r\n> SM doesn't give any protection against a local attacker anyway\r\nOne does have to be concerned about local attackers, while a local attacker may have access to the machine (be logged on, able to run processes on the machine), they may not have access to your files, thus there may be incentive for them to exploit vulnerabilities to read/modify your data.\r\n\r\n> This will be as safe as the static JAR names (as to my argument above) and it will work for both the case that the JARs have been renamed and that they have been collected in an ueberjar. \r\n> If they embed the code in a larger app, they have to think about security themselves; we aren't able to forsee what they might do and therefore, we can't make their code secure for them at this time.\r\n\r\nThese two statements contradict each other, the first says Derby should install a security manager using whatever jar file the code is in, hence giving the impression Derby is making the system secure for them. The second says (correctly) we can't make their code secure for them in this situation.\r\n\r\nI'm not sure what Aaron & Rick are really arguing, it's either there is no vulnerability or there is a vulnerability but there's no/little chance of it being exploited.\r\nI think that any security breach is usually made up of a number of  vulnerabilities, not a single point of failure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-21T17:00:22.950+0000","updated":"2007-11-21T17:00:22.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12544794","id":"12544794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":">> storing these URLs in the system properties (or any global variable) is okay too, because this cannot be exploited from a remote attacker\r\n>That's an assumption that's hard to prove\r\n\r\nThis is very easy to prove: At the time this happens, the Network Server code has not yet created a socket, so a remote attacker can't connect -> q.e.d.\r\n\r\n> These two statements contradict each other,...\r\n\r\nI'm talking about two completely different things here: One talks about taking the code from the Derby project unmodified and the other talks about a developer building their own Derby server.\r\n\r\nMy argument is that there is no additional vulnerability if you allow any JAR name, it just makes an existing vulnerability more visible (so people who are concerned will know about it and can plan against it). This existing vulnerability can't be closed by enforcing a specific JAR name, so it doesn't matter what the name is and where it comes from.\r\n\r\nSo far, you have failed to come up with a convincing argument why my argument is wrong. If you insist that there might be additional vulnerabilities, list them one by one. Talking \"grand\" when we try to find a way to patch a bug is not helping. At the end of the day, the software must work and it must be as secure as we can make it; no more and no less.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2007-11-22T12:49:57.292+0000","updated":"2007-11-22T12:49:57.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12546305","id":"12546305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":">>> storing these URLs in the system properties (or any global variable) is okay too, because this cannot be exploited from a remote attacker\r\n>>That's an assumption that's hard to prove\r\n\r\n> This is very easy to prove: At the time this happens, the Network Server code has not yet created a socket, so a remote attacker can't connect -> q.e.d. \r\n\r\nI don't think it's that easy. What other code could be running, could the JVM have JMX active allowing other code, could some debugging api be active, is the network server running in another framework such as tomcat?\r\n\r\n> My argument is that there is no additional vulnerability if you allow any JAR name, it just makes an existing vulnerability more visible [snip]. This existing vulnerability can't be closed by enforcing a specific JAR name,\r\n\r\nI agree, but as you say allowing any jar name \"makes an existing vulnerability more visible\", thus increasing the potential for the vulnerability to be exploited. I don't think that's a good direction for a security conscious product to go in.\r\n\r\n>> These two statements contradict each other,...\r\n> I'm talking about two completely different things here: One talks about taking the code from the Derby project unmodified and the other talks about a developer building their own Derby server. \r\n\r\nBut to the Derby network code those two situations look the same, it's derby code running in a jar, thus it seems in the unmodified or uberjar cases you want Derby to install a security manager,  but in the modified code case you don't?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-11-28T17:16:57.382+0000","updated":"2007-11-28T17:16:57.382+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12546343","id":"12546343","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Reverted derby-3083-01-requireDatatypes-ab.diff at subversion revision 599085 in the 10.3 branch and at revision 599086 in the trunk. There is still uncertainty about whether this is a reasonable approach to the problem. I do not think that we will reach consensus on this issue before we need to generate the next 10.3 release candidate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-28T18:39:16.405+0000","updated":"2007-11-28T18:39:16.405+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12546770","id":"12546770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Is there any reason why we don't implement our own SecurityManager with hard-coded default permissions? Then we could just pass in the jar names to its constructor instead of relying on the system properties.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-11-29T15:44:31.984+0000","updated":"2007-11-29T15:44:31.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12546781","id":"12546781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for that suggestion, Knut. I have been thinking along similar lines. We could extend SecurityManager with our own implementation. Alternatively, we could extend Policy with our own policy object and continue to use the default SecurityManager. At first blush, the latter looks less complicated to me. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-29T16:10:47.626+0000","updated":"2007-11-29T16:10:47.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12547044","id":"12547044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Rick, I agree that extending Policy sounds less complicated. If we do that, it would be OK to grant permissions to the jar files containing Derby code regardless of their name, wouldn't it? The only concern I can think of is that someone could fake the return value from getProtectionDomain(), but if someone has managed to get control over your JDK libraries, it's game over anyway.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-11-30T08:35:24.975+0000","updated":"2007-11-30T08:35:24.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12547151","id":"12547151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Knut. I agree that if someone has subverted getProtectionDomain(), then the fox is already in the hen house. I think this could be our sequence of operations:\r\n\r\n1) Determine the protection domains (e.g. jar files) which will receive privileges.\r\n\r\n2) Construct a DerbyPolicy from those protection domains.\r\n\r\n3) Install the default SecurityManager with a dummy policy which lets us change policies immediately afterwards\r\n\r\n4) Install the DerbyPolicy (Policy.setPolicy( derbyPolicy ) )\r\n\r\nIf there is a window of vulnerability, then I sense that it would lie between steps (3) and (4). However, I don't see a vulnerability right now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-30T14:20:06.445+0000","updated":"2007-11-30T14:20:06.445+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12547167","id":"12547167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Rick. I didn't quite get what you meant by \"dummy policy\" in (3). Is that a policy file with \"setPolicy granted to all\"? Then we need a system property, don't we? Could we achieve the same effect by performing (3) and (4) in reversed order?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-11-30T15:00:27.995+0000","updated":"2007-11-30T15:00:27.995+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12547172","id":"12547172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Knut. I don't know if you can reverse the order of (3) and (4). That might work. If it does, I agree that it's a better plan.\r\n\r\nIf we have to perform (3) first, then yes I think we need a system property to bootstrap the SecurityManager and point it at the dummy policy. I think that setPolicy would only have to be granted to the protection domain which contains the server.\r\n\r\nBut I think the first experiment would be to reverse the order of (3) and (4) as you suggest.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-11-30T15:17:34.891+0000","updated":"2007-11-30T15:17:34.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12564110","id":"12564110","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I'm removing patch available flag; it appears from the discussions the patch wasn't fully approved. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2008-01-30T18:05:49.741+0000","updated":"2008-01-30T18:05:49.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378633/comment/12727619","id":"12727619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Triaged for 10.5.2. Set Normal urgnecy. Since you can't start network server with the jar file names as we post them to maven and since this is a regression, we might consider making this urgent for the next release.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-07-06T16:53:50.829+0000","updated":"2009-07-06T16:53:50.829+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3083/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06nvz:"}}