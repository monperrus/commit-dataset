{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12403461","self":"https://issues.apache.org/jira/rest/api/latest/issue/12403461","key":"SOLR-745","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312486","id":"12312486","description":"","name":"1.3","archived":false,"released":true,"releaseDate":"2008-09-16"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-09-01 09:08:40.961","customfield_12312323":null,"customfield_12310420":"6873","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_136197802_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-09-02T15:15:48.802+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-745/watchers","watchCount":0,"isWatching":false},"created":"2008-09-01T01:25:51.296+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312486","id":"12312486","description":"","name":"1.3","archived":false,"released":true,"releaseDate":"2008-09-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:39:15.033+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"using 1.3-rc1...\n# Start up the multicore example...{noformat}\ncd example\njava -Dsolr.solr.home=multicore -jar start.jar\n{noformat}\n# Hit the status URL repeatedly: http://localhost:8983/solr/admin/cores?action=STATUS\n# Note: no problems in the log\n# unload core0: http://localhost:8983/solr/admin/cores?action=UNLOAD&core=core0\n# shift-reload on the status URL: http://localhost:8983/solr/admin/cores?action=STATUS\n# Note the following exception each time...{noformat}\nSEVERE: java.util.concurrent.RejectedExecutionException\n        at java.util.concurrent.ThreadPoolExecutor$AbortPolicy.rejectedExecution(ThreadPoolExecutor.java:1477)\n        at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:384)\n        at java.util.concurrent.ThreadPoolExecutor.execute(ThreadPoolExecutor.java:856)\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:45)\n        at java.util.concurrent.Executors$DelegatedExecutorService.submit(Executors.java:606)\n        at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:1062)\n        at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:821)\n        at org.apache.solr.request.SolrQueryRequestBase.getSearcher(SolrQueryRequestBase.java:208)\n        at org.apache.solr.servlet.cache.HttpCacheHeaderUtil.calcLastModified(HttpCacheHeaderUtil.java:146)\n        at org.apache.solr.servlet.cache.HttpCacheHeaderUtil.doCacheHeaderValidation(HttpCacheHeaderUtil.java:220)\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:224)\n        at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1089)\n        at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:365)\n        at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\n        at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)\n        at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712)\n        at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)\n        at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:211)\n        at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)\n        at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)\n        at org.mortbay.jetty.Server.handle(Server.java:285)\n        at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:502)\n        at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:821)\n        at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:513)\n        at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:208)\n        at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:378)\n        at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:226)\n        at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)\n{noformat}\n# Note that the exception doesn't just happen the first time you reload the status URL, but everytime.\n\n\nMarking \"Fix in 1.3\" until someone smarter then me about CoreAdminHandler says it's no big deal.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"20446","summary":"CoreAdminHandler in bad state after UNLOADing core","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403461/comment/12627364","id":"12627364","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"On the surface, part of the problem is that CoreAdminHandler should probably be calling SolrQueryResponse.setHttpCaching(false) ... but since it isn't, HttpCacheHeaderUtil is attempting to get a searcher to determine some headers -- this should be done relative the \"adminCore\" picked by CoreContainer (at least as far as i can and something seems to get wonky about coreAdmin when a core is UNLOADed.\r\n\r\nIn this specific example, it's just affecting the cache headers, but this seems like it could be simptomatic of a larger more generic problem relating to the \"adminCore\" ... and i'm not sure how bad that is.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2008-09-01T01:27:10.838+0000","updated":"2008-09-01T01:27:10.838+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403461/comment/12627419","id":"12627419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Part of it might be in 'CoreContainer.getAdminHandler()' which should check that the (previous) admin core is not closed before attempting to (re)use it.\r\nAdding a check for isClosed() seems necessary.\r\nSomething like:\r\n{code}\r\n  public SolrCore getAdminCore() {\r\n    synchronized (cores) {\r\n      SolrCore core = adminCore != null ? adminCore.get() : null;\r\n      if (core != null && !core.isClosed()) {\r\n        core.open();\r\n      } else {\r\n....\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-09-01T09:08:40.961+0000","updated":"2008-09-01T10:02:37.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403461/comment/12627502","id":"12627502","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"The uploaded patch fixes it (Linux/Ubuntu 8.04/Java 1.6)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-09-01T16:34:50.673+0000","updated":"2008-09-01T22:21:42.858+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403461/comment/12627577","id":"12627577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Maybe i'm missing something but haven't i seen some docs saying that SolrCores are now ref counted?  \r\n\r\nif CoreContainer is setting the adminCore properly, then shouldn't it be impossible for anyone else to completely close it?\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2008-09-02T05:07:51.710+0000","updated":"2008-09-02T05:07:51.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403461/comment/12627610","id":"12627610","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"You are correct, refcounting on cores was introduced in SOLR-647. Before this, it was possible to close a core whilst it was serving requests.\r\n\r\nThe admin core is \"any\" core that is used so admin requests can be served (request handling assumes a core exists); it is kept around  through a weak reference to avoid looking for a new one each time an admin request is handled and is only maintained \"opened\" during execution of the request (like any other request wrt refcounting for that matter; incref - aka open - when we acquire the core, execute the query, decref - aka close - as release). \r\n\r\nThe side effect is that the reference can point to a core that is closed but not yet GC-ed thus the bug & the fix.\r\n\r\nAs a side note, the java.util.concurrent.RejectedExecutionException is the typical symptom when trying to execute a query on a closed core.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-09-02T09:03:31.874+0000","updated":"2008-09-02T09:04:01.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12403461/comment/12627708","id":"12627708","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Thanks, I just committed the patch.\r\n\r\nIt seems like the admin core thing is a weakness of the current design... a core must remain open at all times in order to serve more core requests - definitely not ideal.  I'm not sure I see an easy fix right now though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-09-02T15:15:48.784+0000","updated":"2008-09-02T15:15:48.784+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-745/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03uxz:"}}