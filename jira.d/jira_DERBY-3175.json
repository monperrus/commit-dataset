{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12381898","self":"https://issues.apache.org/jira/rest/api/latest/issue/12381898","key":"DERBY-3175","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-11-06 23:40:09.881","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23477","customfield_12310222":"1_*:*_1_*:*_816058806_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_4197654876","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-11-15T19:47:18.467+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3175/watchers","watchCount":1,"isWatching":false},"created":"2007-11-06T09:06:19.661+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12318096","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12318096","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12381920","key":"DERBY-3177","self":"https://issues.apache.org/jira/rest/api/2/issue/12381920","fields":{"summary":"Dropping columns casues auto_increment field to be lost","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-01-03T09:48:13.337+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"ij version 10.3\nij> connect 'jdbc:derby:bugdb;create=true';\nij> create table t (\n       x varchar(12),\n       y varchar(12),\n       id int primary key generated by default as identity\n);\n0 rows inserted/updated/deleted\nij> alter table t drop column y;\n0 rows inserted/updated/deleted\nij> insert into t(x) values 'a';\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\njava.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main.go(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source)\n        at org.apache.derby.tools.ij.main(Unknown Source)\n        at org.apache.derby.iapi.tools.run.main(Unknown Source)\nCaused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\n        ... 18 more\nCaused by: java.lang.NullPointerException\n        at org.apache.derby.impl.sql.compile.ResultColumn.columnTypeAndLengthMatch(Unknown Source)\n        at org.apache.derby.impl.sql.compile.ResultColumnList.columnTypesAndLengthsMatch(Unknown Source)\n        at org.apache.derby.impl.sql.compile.InsertNode.bindStatement(Unknown Source)\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\n        at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)\n        ... 11 more","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39621","summary":"NullPointerException on INSERT after ALTER TABLE ... DROP COLUMN","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":30,"total":30,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12540383","id":"12540383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Uploading repro script.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-11-06T09:08:00.097+0000","updated":"2007-11-06T09:08:00.097+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12540627","id":"12540627","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"In the trunk, with a Sane build, I see the following instead of the NPE:\r\n\r\nij> insert into t(x) values 'a';\r\nERROR XJ001: Java exception: 'ASSERT FAILED If column is not autoinc and have defaultInfo, isDefaultValueAutoinc can not be true: org.apache.derby.shared.common.sanity.AssertFailure'.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-06T23:40:09.881+0000","updated":"2007-11-06T23:40:09.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12540628","id":"12540628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The *order* of the column definitions in the CREATE TABLE statement is relevant. If I reverse the order of the 'y' and 'id' columns so that the CREATE TABLE statement reads:\r\n\r\ncreate table t (\r\n       x varchar(12),\r\n       id int primary key generated by default as identity,\r\n       y varchar(12)\r\n); \r\n\r\nthen the bug does not reproduce.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-06T23:47:14.783+0000","updated":"2007-11-06T23:47:14.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12540655","id":"12540655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The core of the problem happens when AlterTableConstantAction.dropColumnFromTable \r\ncalls SYSCOLUMNSRowFactory.makeRow (via DataDictionaryImpl.addDescriptorArray).\r\n\r\nThe relevant dropColumnFromTable code is here:\r\n\r\n\t\t// drop the column from syscolumns \r\n\t\tdd.dropColumnDescriptor(td.getUUID(), columnInfo[ix].name, tc);\r\n\t\tColumnDescriptor[] cdlArray = \r\n            new ColumnDescriptor[size - columnDescriptor.getPosition()];\r\n\r\n\t\tfor (int i = columnDescriptor.getPosition(), j = 0; i < size; i++, j++)\r\n\t\t{\r\n\t\t\tColumnDescriptor cd = (ColumnDescriptor) tab_cdl.elementAt(i);\r\n\t\t\tdd.dropColumnDescriptor(td.getUUID(), cd.getColumnName(), tc);\r\n\t\t\tcd.setPosition(i);\r\n\t\t\tcdlArray[j] = cd;\r\n\t\t}\r\n\t\tdd.addDescriptorArray(cdlArray, td,\r\n\t\t\t\t\t\t\t  DataDictionary.SYSCOLUMNS_CATALOG_NUM, false, tc);\r\n\r\nThis code does the following:\r\n1) For the column we're dropping, deletes the corresponding row from SYSCOLUMNS\r\n2) For each column *after* the column we're dropping, deletes that column's\r\nrow from SYSCOLUMNS, and accumulates that ColumnDescriptor object into the\r\ncdlArray, updating the ColumnDescriptor to have the new position of that column in the table\r\n3) calls addDescriptorArray to add the new SYSCOLUMNS rows for the columns with\r\nthe modified positions.\r\n\r\nDataDictionaryImpl.addDescriptorArray then makes a new row for each ColumnDescriptor\r\nwith this code:\r\n\r\n\t\tfor (int index = 0; index < td.length; index++)\r\n\t\t{\r\n\t\t\tExecRow row = crf.makeRow(td[index], parent);\r\n\t\t\trl[index] = row;\r\n\t\t}\r\n\r\nAnd the crf.makeRow() call arrives at SYSCOLUMNSRowFactory.makeRow.\r\n\r\n*HOWEVER*, SYSCOLUMNSRowFactory.makeRow expects that the ColumnDescriptor\r\nwill specify how to set the autoincInc, autoincStart, and autoincValue columns in SYSCOLUMNS\r\nvia the awkwardly-named getAutoinc_create_or_modify_Start_Increment() value:\r\n\r\n\t\tif (autoinc_create_or_modify_Start_Increment == ColumnDefinitionNode.CREATE_AUTOINCREMENT ||\r\n\t\t\t\tautoinc_create_or_modify_Start_Increment == ColumnDefinitionNode.MODIFY_AUTOINCREMENT_INC_VALUE)\r\n\t\t{//user is adding an autoinc column or is changing the increment value of autoinc column\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTVALUE, \r\n\t\t\t\t\t\t  new SQLLongint(autoincStart));\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTSTART, \r\n\t\t\t\t\t\t  new SQLLongint(autoincStart));\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTINC, \r\n\t\t\t\t\t\t  new SQLLongint(autoincInc));\r\n\t\t} else if (autoinc_create_or_modify_Start_Increment == ColumnDefinitionNode.MODIFY_AUTOINCREMENT_RESTART_VALUE)\r\n\t\t{//user asked for restart with a new value, so don't change increment by and original start\r\n\t\t\t//with values in the SYSCOLUMNS table. Just record the RESTART WITH value as the\r\n\t\t\t//next value to be generated in the SYSCOLUMNS table\r\n\t\t\tColumnDescriptor  column = (ColumnDescriptor)td;\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTVALUE, new SQLLongint(autoincStart));\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTSTART, new SQLLongint(autoincStart));\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTINC, new SQLLongint(\r\n\t\t\t\t\tcolumn.getTableDescriptor().getColumnDescriptor(colName).getAutoincInc()));\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTVALUE, \r\n\t\t\t\t\t\t  new SQLLongint());\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTSTART, \r\n\t\t\t\t\t\t  new SQLLongint());\r\n\t\t\trow.setColumn(SYSCOLUMNS_AUTOINCREMENTINC,\r\n\t\t\t\t\t\t  new SQLLongint());\r\n\t\t}\r\n\r\nBut when we are re-adding the column descriptors in AlterTableConstantAction.dropColumnFromTable,\r\nthis autoinc_create_or_modify_Start_Increment value is not set, and so the makeRow() code\r\nfalls into the \"else\" block above, and resets the autoincement fields to 0, thus\r\ncorrupting the SYSCOLUMNS row.\r\n\r\nI suspect the fix is as simple as forcing a value of ColumnDefinitionNode.CREATE_AUTOINCREMENT\r\nwhen re-adding the ColumnDescriptors; I'll try this fix in a little while and report back on the results.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-07T02:53:11.679+0000","updated":"2007-11-07T02:53:11.679+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12540673","id":"12540673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is d3175_codeChangeOnly.diff, which is not for commit. This change appears to fix the bug. I intend to work up a more complete patch proposal, incorporating Knut's test case as a regression test. I also intend to see whether this code change affects the repro script given in DERBY-3177 and if so I'll link the two issues and include that reproduction script in the regression test as well.\r\n\r\nIn the meantime, feedback and suggestions about the analysis or the code change are most welcome.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-07T05:41:27.248+0000","updated":"2007-11-07T05:41:27.248+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12540816","id":"12540816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is \"fixWithTest.diff\", which incorporates Knut's example from\r\nthe bug description into the altertable.sql regression test.\r\n\r\nI've run the altertable.sql regression test, but haven't run the full test suites.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-07T17:57:02.108+0000","updated":"2007-11-07T17:57:02.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12540959","id":"12540959","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is \"fixWith3177Case.diff\", a patch proposal.\r\n\r\nI believe that this patch proposal is ready for review, and I\r\nbelieve that it will resolve both DERBY-3175 and DERBY-3177.\r\n\r\nPlease have a look at the patch and let us know your comments.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-08T04:30:57.160+0000","updated":"2007-11-08T04:30:57.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12540963","id":"12540963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Except for a strange failure in lang/triggerGeneral, all the regression results were\r\nclean. I believe that the triggerGeneral error is unrelated, and is due to some sort\r\nof configuration error in my environment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-08T04:39:44.130+0000","updated":"2007-11-08T04:39:44.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541214","id":"12541214","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I propose to submit fixWith3177Case.diff to the trunk fairly soon.  I'm also\r\ninterested in merging the fix back to the 10.3 branch, if the trunk change goes well.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-09T02:39:43.356+0000","updated":"2007-11-09T02:39:43.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541218","id":"12541218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chubbard","name":"chubbard","emailAddress":"charlie dot hubbard at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chubbard&avatarId=11830","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chubbard&avatarId=11830","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chubbard&avatarId=11830","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chubbard&avatarId=11830"},"displayName":"Charlie Hubbard","active":true},"body":"I'm actually encountering this issue as well as 1377, but it's intermittent.  I haven't dropped a column that occurs before an primary key column, but it fails periodically after inserting lots of data.  It doesn't fail every time.  It usually recovers.  Just thought I'd mention it.\r\n\r\nSo does this mean we can expect a new version for 10.3 to fix this issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chubbard","name":"chubbard","emailAddress":"charlie dot hubbard at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chubbard&avatarId=11830","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chubbard&avatarId=11830","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chubbard&avatarId=11830","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chubbard&avatarId=11830"},"displayName":"Charlie Hubbard","active":true},"created":"2007-11-09T03:21:36.181+0000","updated":"2007-11-09T03:21:36.181+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541221","id":"12541221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Charlie, thanks for the update! Is there any way for you to verify whether the patch\r\nattached to this issue affects your symptoms? Can you build a modified version of 10.3\r\nwith this change and try it out in your test environment? That would be very helpful.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-09T03:49:42.348+0000","updated":"2007-11-09T03:49:42.348+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541258","id":"12541258","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Bryan,\r\nI downloaded the patch and it indeed fixes the problem I reported. However, it seems to reset the counter which keeps track of the next identity value to be generated. Please see the modified repro script below:\r\n\r\nij> create table d3175 (x varchar(12), y varchar(12),\r\nid int primary key generated by default as identity);\r\n0 rows inserted/updated/deleted\r\nij> insert into d3175(x) values 'a';\r\n1 row inserted/updated/deleted\r\nij> alter table d3175 drop column y;\r\n0 rows inserted/updated/deleted\r\nij> insert into d3175(x) values 'b';\r\nERROR 23505: The statement was aborted because it would have caused a duplicate key value in a unique or primary key constraint or unique index identified by 'SQL071109094158840' defined on 'D3175'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-11-09T08:58:03.176+0000","updated":"2007-11-09T08:58:03.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541264","id":"12541264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"> So does this mean we can expect a new version for 10.3 to fix this issue?\r\n\r\nThere's already a 10.3 maintenance release scheduled. Hopefully, we'll get a fix into that release. Please see http://wiki.apache.org/db-derby/DerbyTenThreeTwoRelease for details about the release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-11-09T09:06:14.041+0000","updated":"2007-11-09T09:06:14.041+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541318","id":"12541318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chubbard","name":"chubbard","emailAddress":"charlie dot hubbard at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chubbard&avatarId=11830","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chubbard&avatarId=11830","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chubbard&avatarId=11830","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chubbard&avatarId=11830"},"displayName":"Charlie Hubbard","active":true},"body":"Sure I can try it out sometime this weekend.  I've never built derby before how would I get the source to build it with?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chubbard","name":"chubbard","emailAddress":"charlie dot hubbard at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chubbard&avatarId=11830","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chubbard&avatarId=11830","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chubbard&avatarId=11830","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chubbard&avatarId=11830"},"displayName":"Charlie Hubbard","active":true},"created":"2007-11-09T13:48:14.710+0000","updated":"2007-11-09T13:48:14.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541335","id":"12541335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Knut, good catch on the start value; I'll have a look at that right away.\r\n\r\nCharlie, you can learn about building Derby from source here:\r\nhttp://db.apache.org/derby/dev/derby_source.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-09T14:39:03.047+0000","updated":"2007-11-09T14:39:03.047+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541384","id":"12541384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Resetting the next-value counter is occurring in the makeRow() code that I quoted in my earlier comment. Pay particular attention to these lines:\r\n\r\n                        row.setColumn(SYSCOLUMNS_AUTOINCREMENTVALUE,\r\n                                                  new SQLLongint(autoincStart));\r\n                        row.setColumn(SYSCOLUMNS_AUTOINCREMENTSTART,\r\n                                                  new SQLLongint(autoincStart));\r\n\r\nNote that 'autoincStart' is used for *both* the 'start' column of SYSCOLUMNS and the 'value' column.\r\n\r\nAlso, note that when we build a ColumnDescriptor from a SYSCOLUMNS row, in buildDescriptor(),\r\nwe intentionally omit the AUTOINCREMENTVALUE from the ColumnDescriptor object:\r\n\r\n/* 7th column is AUTOINCREMENTVALUE, not cached in descriptor (long) */\r\n\r\nSo we don't even have the previous counter value available at the time that we make the new row.\r\n\r\nMore study is needed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-09T17:40:53.258+0000","updated":"2007-11-09T17:40:53.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541435","id":"12541435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Here are 3 possible ways to ensure that the autoincrementValue is preserved during the drop column:\r\n\r\n1) Add autoincrementValue to ColumnDescriptor. Change SYSCOLUMNS.buildDescriptor to\r\nretrieve the autoincrementValue from the SYSCOLUMNS row. Change SYSCOLUMNS.makeRow\r\nto set the autoincrementValue in SYSCOLUMNS from the ColumnDescriptor's value. Change\r\nany other places that create a ColumnDescriptor to initialize the autoincrementValue to match\r\nautoincrementStart.\r\n\r\n2) Change SYSCOLUMNS.makeRow to take a new 3rd argument: autoincrementValue. Change\r\nAlterTableCOnstantAction's drop column logic so that it fetches the old value of the\r\nautoincrementValue from the SYSCOLUMNS row before it deletes it, then passes that old value\r\nto the makeRow call when adding back the column descriptor. I don't really like this solution,\r\nbut I thought of it so I'm recording it here.\r\n\r\n3) Change AlterTableConstantAction's  drop column logic so that it doesn't drop-and-re-add\r\nall the subsequent column descriptors in order to change their positions, but instead issues\r\nan UPDATE operation on those column descriptors to decrement their column number field.\r\n\r\nTechnique #1 seems pretty straightforward, it's just a bunch of code grunging. It does make the\r\nColumnDescriptor object instance slightly larger in memory.\r\n\r\nTechnique #3 seems appealing, because if all we want to change about a particular\r\nSYSCOLUMNS row is the column number, why should we have to delete and re-add the\r\nSYSCOLUMNS row in order to make that change? It doesn't appear that the column number\r\nfield in SYSCOLUMNS is indexed, so I don't think there should be any index complexity.\r\n\r\nIf I can find some example code for one of the other system catalogs which issues an UPDATE\r\nrather than a DROP and an INSERT, I'll try to implement technique #3 modelled on that.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-09T20:40:58.973+0000","updated":"2007-11-09T20:40:58.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541446","id":"12541446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I don't understand this little snippet from SYSCOLUMNSRowFactory.java:\r\n\r\n        /* 8th column is AUTOINCREMENTSTART (long) */\r\n        autoincStart = row.getColumn(SYSCOLUMNS_AUTOINCREMENTSTART).getLong();\r\n\r\n        /* 9th column is AUTOINCREMENTINC (long) */\r\n        autoincInc = row.getColumn(SYSCOLUMNS_AUTOINCREMENTINC).getLong();\r\n\r\n        DataValueDescriptor col = row.getColumn(SYSCOLUMNS_AUTOINCREMENTSTART);\r\n        autoincStart = col.getLong();\r\n\r\n        col = row.getColumn(SYSCOLUMNS_AUTOINCREMENTINC);\r\n        autoincInc = col.getLong();\r\n\r\nIsn't this doing the same thing twice? Aren't the second group of statements redundant with the first?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-09T21:22:59.942+0000","updated":"2007-11-09T21:22:59.942+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541461","id":"12541461","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is preserveAutoincValue.diff, which addresses the new variant \r\nproblem that Knut found. This patch uses technique #1 from my previous \r\ncomment; that is, it adds an autoincValue field to the ColumnDescriptor\r\nobject, reads that value in from the SYSCOLUMNS row in buildDescriptor,\r\nand sets that value into the SYSCOLUMNS row in makeRow.\r\n\r\nThe test case is also modified as Knut suggested to verify that the\r\nautoincrement value is properly preserved by the drop column command.\r\n\r\nI've run lang/altertable.sql successfully with the new patch. I'll run the\r\nfull regression suite overnight and report back with any other problems.\r\n\r\nPlease have a look at preserveAutoincValue.diff if you have a chance.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-09T22:28:57.304+0000","updated":"2007-11-09T22:28:57.304+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541548","id":"12541548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Complete regression suite was clean for preserveAutoincValue.diff\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-10T15:30:46.971+0000","updated":"2007-11-10T15:30:46.971+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541590","id":"12541590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chubbard","name":"chubbard","emailAddress":"charlie dot hubbard at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chubbard&avatarId=11830","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chubbard&avatarId=11830","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chubbard&avatarId=11830","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chubbard&avatarId=11830"},"displayName":"Charlie Hubbard","active":true},"body":"I pulled down the source from the 10.3 branch.  Built the code, packaged the jars, and ran the bug.sql script in the ij tool.  Here is what I saw:\r\n\r\nD:\\dev\\db-derby-10.3-src>java -cp jars/sane/derby.jar;jars/sane/derbytools.jar org.apache.derby.tools.ij d:\\temp\\bug.sql\r\nij version 10.3\r\nij> connect 'jdbc:derby:bugdb;create=true';\r\nij> create table t (\r\n       x varchar(12),\r\n       y varchar(12),\r\n       id int primary key generated by default as identity\r\n);\r\n0 rows inserted/updated/deleted\r\nij> alter table t drop column y;\r\n0 rows inserted/updated/deleted\r\nij> insert into t(x) values 'a';\r\nERROR XJ001: Java exception: 'ASSERT FAILED If column is not autoinc and have defaultInfo, isDefaultValueAutoinc can not be true: org.apache.derby.shared.common.sanity.AssertFailure'.\r\nij>\r\nD:\\dev\\db-derby-10.3-src>\r\n\r\nDid I do something wrong?  Are the patches attached to this bug committed in the 10.3 branch?  Or do I have to apply these patches manually before I build the project in order to get the fixes?\r\n\r\nCharlie","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chubbard","name":"chubbard","emailAddress":"charlie dot hubbard at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chubbard&avatarId=11830","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chubbard&avatarId=11830","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chubbard&avatarId=11830","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chubbard&avatarId=11830"},"displayName":"Charlie Hubbard","active":true},"created":"2007-11-10T21:57:27.229+0000","updated":"2007-11-10T21:57:27.229+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541594","id":"12541594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Excellent! That is exactly the symptom that I see with the trunk, so I believe\r\nthat you have set up your environment successfully.\r\n\r\nNone of the patches have been committed yet, so yes, you have to apply the\r\npatch of interest manually before you build the code. Please try 'preserveAutoincValue.diff',\r\nas it is the most recent and most complete patch proposal.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-10T22:40:25.941+0000","updated":"2007-11-10T22:40:25.941+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541670","id":"12541670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chubbard","name":"chubbard","emailAddress":"charlie dot hubbard at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chubbard&avatarId=11830","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chubbard&avatarId=11830","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chubbard&avatarId=11830","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chubbard&avatarId=11830"},"displayName":"Charlie Hubbard","active":true},"body":"I finally built derby with the patches.  I tested the bug.sql on it before patching it and received the assertion problem I posted earlier.  I then patched the source code and retested with bug.sql and it completed successfully.  I copied the files over and tried it out on my environment, and unfortunately, I still experienced the issue.  I don't know if this is the same exception as before, but it looks like it:\r\n\r\nAny ideas?\r\n\r\n2007-11-11 18:35:08,224 [Mail loader] WARN  org.hibernate.util.JDBCExceptionReporter  - SQL Error: 0, SQLState: XJ001\r\n2007-11-11 18:35:08,224 [Mail loader] ERROR org.hibernate.util.JDBCExceptionReporter  - Java exception: ': java.lang.NullPointerException'.\r\n2007-11-11 18:35:08,240 [Mail loader] ERROR com.emailarchive.demon.MailIndexer  - could not execute query\r\norg.hibernate.exception.GenericJDBCException: could not execute query\r\n\tat org.hibernate.exception.SQLStateConverter.handledNonSpecificException(SQLStateConverter.java:103)\r\n\tat org.hibernate.exception.SQLStateConverter.convert(SQLStateConverter.java:91)\r\n\tat org.hibernate.exception.JDBCExceptionHelper.convert(JDBCExceptionHelper.java:43)\r\n\tat org.hibernate.loader.Loader.doList(Loader.java:2223)\r\n\tat org.hibernate.loader.Loader.listIgnoreQueryCache(Loader.java:2104)\r\n\tat org.hibernate.loader.Loader.list(Loader.java:2099)\r\n\tat org.hibernate.loader.hql.QueryLoader.list(QueryLoader.java:378)\r\n\tat org.hibernate.hql.ast.QueryTranslatorImpl.list(QueryTranslatorImpl.java:338)\r\n\tat org.hibernate.engine.query.HQLQueryPlan.performList(HQLQueryPlan.java:172)\r\n\tat org.hibernate.impl.SessionImpl.list(SessionImpl.java:1121)\r\n\tat org.hibernate.impl.QueryImpl.list(QueryImpl.java:79)\r\n\tat org.hibernate.impl.AbstractQueryImpl.uniqueResult(AbstractQueryImpl.java:811)\r\n\tat com.emailarchive.web.model.EmailAddressDao.createIfNotExists(EmailAddressDao.java:21)\r\n\tat com.emailarchive.web.model.MessageDao.createEmailIfNotExists(MessageDao.java:124)\r\n\tat com.emailarchive.web.model.MessageDao.create(MessageDao.java:111)\r\n\tat com.emailarchive.demon.MailIndexer.process(MailIndexer.java:49)\r\n\tat com.emailarchive.demon.MailDemonLoader.saveMessages(MailDemonLoader.java:89)\r\n\tat com.emailarchive.demon.MailDemonLoader.archiveMessages(MailDemonLoader.java:57)\r\n\tat com.emailarchive.demon.MailDemonLoader.run(MailDemonLoader.java:41)\r\n\tat java.util.TimerThread.mainLoop(Timer.java:512)\r\n\tat java.util.TimerThread.run(Timer.java:462)\r\nCaused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88)\r\n\tat org.apache.derby.impl.jdbc.Util.javaException(Util.java:245)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1573)\r\n\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1293)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeQuery(EmbedPreparedStatement.java:275)\r\n\tat org.hibernate.jdbc.AbstractBatcher.getResultSet(AbstractBatcher.java:186)\r\n\tat org.hibernate.loader.Loader.getResultSet(Loader.java:1787)\r\n\tat org.hibernate.loader.Loader.doQuery(Loader.java:674)\r\n\tat org.hibernate.loader.Loader.doQueryAndInitializeNonLazyCollections(Loader.java:236)\r\n\tat org.hibernate.loader.Loader.doList(Loader.java:2220)\r\n\t... 17 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.finishAndRTS(BasicNoPutResultSetImpl.java:634)\r\n\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.finish(BasicNoPutResultSetImpl.java:607)\r\n\tat org.apache.derby.impl.sql.execute.BaseActivation.close(BaseActivation.java:351)\r\n\tat org.apache.derby.impl.sql.GenericActivationHolder.execute(GenericActivationHolder.java:304)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:368)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203)\r\n\t... 24 more\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chubbard","name":"chubbard","emailAddress":"charlie dot hubbard at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chubbard&avatarId=11830","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chubbard&avatarId=11830","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chubbard&avatarId=11830","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chubbard&avatarId=11830"},"displayName":"Charlie Hubbard","active":true},"created":"2007-11-11T23:41:58.365+0000","updated":"2007-11-11T23:41:58.365+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541706","id":"12541706","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Charlie, the exception you're seeing now looks more like DERBY-3197. It would be great if you could run with derby.language.logStatementText=true and post the contents of derby.log on that issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-11-12T08:21:45.475+0000","updated":"2007-11-12T08:21:45.475+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541717","id":"12541717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Bryan, preserveAutoincValue.diff looks good. +1 to commit. (nit: the if statement in AlterTableConstantAction would perhaps have been clearer if it used braces, since it spans multiple lines)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-11-12T09:25:17.739+0000","updated":"2007-11-12T09:25:17.739+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12541951","id":"12541951","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Knut! Attachment 'preserveFixWithComments.diff' includes\r\nthe braces to improve readability in AlterTableConstantAction, and\r\nalso adds comments to a number of the code changes.\r\n\r\nI intend to commit this fix to the trunk.\r\n\r\nThanks all for the reviews and testing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-12T21:23:08.199+0000","updated":"2007-11-12T21:23:08.199+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12542289","id":"12542289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Committed preserveFixWithComments.diff to the trunk as revision 594727.\r\n\r\nAfter we get a bit of experience with this change in the trunk, I'll investigate merging it back to 10.3.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-14T00:14:30.684+0000","updated":"2007-11-14T00:14:30.684+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12542517","id":"12542517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"There was a minor conflict on SYSCOLUMNSRowFactory.java\r\nwhen merging to the 10.3 line. Attached is merge10_3.diff\r\nshowing the intended patch to the 10.3 line after the conflict is resolved.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-14T17:31:17.425+0000","updated":"2007-11-14T17:31:17.425+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12542634","id":"12542634","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"derbyall and junit suites.All runs on the 10.3 branch with the patch were clean.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-14T23:56:19.694+0000","updated":"2007-11-14T23:56:19.694+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12381898/comment/12542863","id":"12542863","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"No issues appear to have arisen with this change on the trunk in the last 48 hours,\r\nand my merge and build/test results with 10.3 were very clean, so I've committed\r\nthe merged patch to the 10.3 branch as subversion revision 595408.\r\n\r\nI'm a bit concerned about DERBY-3177. I thought the two issues were the same,\r\nbut Charlie reported that the DERBY-3175 changes didn't improve his results\r\nwith DERBY-3177. Perhaps I was premature to link the issues as duplicates.\r\n\r\nI believe this issue is resolved, though. Thanks again to everyone for the help!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-11-15T19:47:18.383+0000","updated":"2007-11-15T19:47:18.383+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3175/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0759z:"}}