{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12496539","self":"https://issues.apache.org/jira/rest/api/latest/issue/12496539","key":"ARIES-556","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315310","id":"12315310","description":"","name":"0.3","archived":true,"released":true,"releaseDate":"2011-02-08"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-01-25 11:20:04.792","customfield_12312323":null,"customfield_12310420":"94163","customfield_12312320":null,"customfield_12310222":"3_*:*_1_*:*_1146071849_*|*_1_*:*_1_*:*_73596766_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-02-07T16:27:03.765+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-556/watchers","watchCount":0,"isWatching":false},"created":"2011-01-24T13:39:15.217+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314941","id":"12314941","description":"","name":"0.2","archived":true,"released":true,"releaseDate":"2010-09-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-02-07T16:27:03.816+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313176","id":"12313176","name":"JPA","description":"RFC 143 JPA Integration"}],"timeoriginalestimate":null,"description":"Aries fails to read persistence.xml files larger than 8192 bytes. We recognized this bug while we were adding new Entity classes to persistence.xml when we removed enough data so that we were below or equal to 8192 bytes everything went fine.\r\n\r\nThis is probably caused by wrong implementation within org.apache.aries.jpa.container.parsing.impl.PersistenceDescriptorParserImpl parse method.\r\n\r\nIf one tries to read persistence.xml files larger than 8192 the following exception is thrown:\r\n\r\n13:52:01.492 ERROR [Start Level Event Dispatcher][org.apache.aries.jpa.container:331] There was an error while parsing the persistence descriptor META-INF/openjpa_persistence_product.xml in bundle com.navteq.phoenix.jpa_1.0.0. No persistence units will be managed for this bundle\r\norg.apache.aries.jpa.container.parsing.PersistenceDescriptorParserException: There was an error parsing META-INF/openjpa_persistence_product.xml in bundle com.navteq.phoenix.jpa_1.0.0\r\n        at org.apache.aries.jpa.container.parsing.impl.PersistenceDescriptorParserImpl.parse(PersistenceDescriptorParserImpl.java:98) ~[org.apache.aries.jpa.container-0.2-incubating.jar:0.2-incubating]\r\n        at org.apache.aries.jpa.container.impl.PersistenceBundleManager.parseBundle(PersistenceBundleManager.java:329) [org.apache.aries.jpa.container-0.2-incubating.jar:0.2-incubating]\r\n        at org.apache.aries.jpa.container.impl.PersistenceBundleManager.setupManager(PersistenceBundleManager.java:350) [org.apache.aries.jpa.container-0.2-incubating.jar:0.2-incubating]\r\n        at org.apache.aries.jpa.container.impl.PersistenceBundleManager.addingBundle(PersistenceBundleManager.java:148) [org.apache.aries.jpa.container-0.2-incubating.jar:0.2-incubating]\r\n        at org.apache.aries.util.tracker.InternalRecursiveBundleTracker.addingBundle(InternalRecursiveBundleTracker.java:70) [org.apache.aries.util-0.2-incubating.jar:0.2-incubating]\r\n        at org.osgi.util.tracker.BundleTracker$Tracked.customizerAdding(BundleTracker.java:440) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.osgi.util.tracker.AbstractTracked.trackAdding(AbstractTracked.java:261) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.osgi.util.tracker.AbstractTracked.trackInitial(AbstractTracked.java:184) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.osgi.util.tracker.BundleTracker.open(BundleTracker.java:159) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.apache.aries.util.tracker.RecursiveBundleTracker.open(RecursiveBundleTracker.java:77) [org.apache.aries.util-0.2-incubating.jar:0.2-incubating]\r\n        at org.apache.aries.jpa.container.impl.PersistenceBundleManager.open(PersistenceBundleManager.java:132) [org.apache.aries.jpa.container-0.2-incubating.jar:0.2-incubating]\r\n        at org.apache.aries.jpa.container.impl.PersistenceBundleManager.start(PersistenceBundleManager.java:619) [org.apache.aries.jpa.container-0.2-incubating.jar:0.2-incubating]\r\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl$1.run(BundleContextImpl.java:783) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at java.security.AccessController.doPrivileged(Native Method) [na:1.6.0_22]\r\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:774) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:755) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:370) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.AbstractBundle.resume(AbstractBundle.java:374) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.Framework.resumeBundle(Framework.java:1067) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles(StartLevelManager.java:561) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.resumeBundles(StartLevelManager.java:546) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.incFWSL(StartLevelManager.java:459) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.doSetStartLevel(StartLevelManager.java:243) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.internal.core.StartLevelManager.dispatchEvent(StartLevelManager.java:440) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(EventManager.java:227) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\n        at org.eclipse.osgi.framework.eventmgr.EventManager$EventThread.run(EventManager.java:337) [org.eclipse.osgi_3.6.0.v20100517.jar:na]\r\nCaused by: java.io.IOException: Resetting to invalid mark\r\n        at java.io.BufferedInputStream.reset(BufferedInputStream.java:416) ~[na:1.6.0_22]\r\n        at org.apache.aries.jpa.container.parsing.impl.PersistenceDescriptorParserImpl.parse(PersistenceDescriptorParserImpl.java:90) ~[org.apache.aries.jpa.container-0.2-incubating.jar:0.2-incubating]\r\n        ... 25 common frames omitted\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"62728","summary":"Aries fails to read persistence.xml files larger than 8192 bytes","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dschmitz","name":"dschmitz","emailAddress":"David dot Schmitz at navteq dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Schmitz","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dschmitz","name":"dschmitz","emailAddress":"David dot Schmitz at navteq dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Schmitz","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496539/comment/12986340","id":"12986340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"body":"This bug is marked as critical - is it enough to get it into trunk codebase for nightly snapshots, or the 0.3 release stream, or a 0.2.1 release?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"created":"2011-01-25T11:20:04.792+0000","updated":"2011-01-25T11:20:04.792+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496539/comment/12986360","id":"12986360","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"body":"I have only been able to reproduce this bug for files that have more than 8k of comment before the <persistence... entry. Large files with small headers appear to be unaffected - though this may be SAX implementation dependent.\r\n\r\nI am putting together a fix for the codebase, but shortening the header should be a simple workaround.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"created":"2011-01-25T12:15:29.666+0000","updated":"2011-01-25T12:15:29.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496539/comment/12986636","id":"12986636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dschmitz","name":"dschmitz","emailAddress":"David dot Schmitz at navteq dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Schmitz","active":true},"body":"Hi Timothy, \r\n\r\nwe are pulling in Aries stuff via Maven as long as the build is sufficiently stable we don't care whether it is a 0.3... (currently we are on 0.2-incubation). \r\n\r\nBy the way just a suggestion why don't you take the persistence.xsd from Oracle and generate JAXB classes. With JAXB you can read the whole stuff without having to write your own parser logic.\r\n\r\nschema can be found here:\r\nhttp://java.sun.com/xml/ns/persistence/persistence_2_0.xsd","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dschmitz","name":"dschmitz","emailAddress":"David dot Schmitz at navteq dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Schmitz","active":true},"created":"2011-01-25T19:33:09.069+0000","updated":"2011-01-25T19:33:29.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496539/comment/12986989","id":"12986989","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"body":"Hi David,\r\n\r\nI'll make sure that this fix makes it into the 0.3 release.\r\n\r\nAs for why we don't use JAXB, there are a couple of reasons, firstly, we would still need to work out which version of the JPA schema the xml file uses so that we can schema validate. Secondly, there is actually a \"bug\" in the JPA 1.0 schema which means that the example xml snippets in the spec don't work properly. By using SAX we can fix this bug to get the intended behaviour, which isn't really possible in JAXB without rewriting the generated classes. \r\n\r\nThese issues, combined with the fact that by using SAX we can have a single parser for both spec versions, means that SAX seemed like the better choice.\r\n\r\nIn this case the bug was actually caused by a performance optimisation - we used a BufferedInputStream to reset the InputStream back to its start after our first pass parse (for finding the xml version). This first parse only needs to read the <persistence... element>, which for most SAX parsers means that you only read the first few hundred bytes - unfortunately this doesn't apply for all SAX parsers. We now have a fully rewindable InputStream, so there shouldn't be any more issues.\r\n\r\nTim","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"created":"2011-01-26T12:50:45.262+0000","updated":"2011-01-26T12:50:45.262+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496539/comment/12990110","id":"12990110","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"body":"This fix is now available in the 0.3 release","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"created":"2011-02-03T14:37:49.908+0000","updated":"2011-02-03T14:37:49.908+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496539/comment/12991443","id":"12991443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hughesj","name":"hughesj","emailAddress":"hughesj at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hughesj&avatarId=24607","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hughesj&avatarId=24607","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hughesj&avatarId=24607","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hughesj&avatarId=24607"},"displayName":"Jeremy Hughes","active":true},"body":"This has been fixed in 0.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hughesj","name":"hughesj","emailAddress":"hughesj at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hughesj&avatarId=24607","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hughesj&avatarId=24607","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hughesj&avatarId=24607","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hughesj&avatarId=24607"},"displayName":"Jeremy Hughes","active":true},"created":"2011-02-07T16:27:03.783+0000","updated":"2011-02-07T16:27:03.783+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-556/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0b3sv:"}}