{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"30260","self":"https://issues.apache.org/jira/rest/api/latest/issue/30260","key":"DERBY-149","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-09-21 09:59:26.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21799","customfield_12310222":"3_*:*_1_*:*_1750542000_*|*_1_*:*_1_*:*_18489814000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_7326531000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2005-10-11T12:56:53.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-149/watchers","watchCount":0,"isWatching":false},"created":"2005-02-19T06:37:37.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-01-04T08:05:44.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"}],"timeoriginalestimate":null,"description":"When running against Derby Network Server with the JCC driver, attempts to bind an invalid date/time string to a date/time/timestamp parameter lead to a hang in either the JCC client or in the Network Server (not sure which).\n\nThe problem does NOT occur if the same thing is run against a DB2 server, which suggests the bug is in Network Server, not in the JCC driver.  That said, though, the problem also does NOT happen if one uses an ODBC client to connect to Network Server, instead of a JDBC client--so perhaps it's a problem with JCC, after all...hard to say one way or the other...\n\nHere's a simple program to reproduce the problem:\n\nimport java.sql.*;\n\npublic class go {\n\n\tpublic static void main (String[] args) throws Exception {\n\n\t\tClass.forName(\"com.ibm.db2.jcc.DB2Driver\");\n\t\tConnection c = DriverManager.getConnection(\n\t\t\t\"jdbc:derby:net://localhost:1527/ugh;create=true\", \"bah\", \"humbug\");\n\n\t\tStatement s = c.createStatement();\n\t\ttry {\n\t\t\ts.execute(\"drop table dt\");\n\t\t} catch (SQLException se) {}\n\n\t\ts.execute(\"create table dt (d date)\");\n\t\tPreparedStatement pSt = c.prepareStatement(\"insert into dt values (?)\");\n\n\t\ttry {\n\t\t\tpSt.setString(1, \"oops\"); // invalid date value.\n\t\t\tpSt.execute();\n\t\t} catch (SQLException se) {\n\t\t\tSystem.out.println(\"Got \" + se.getSQLState() + \": \" + se.getMessage());\n\t\t}\n\t}\n\n}\n\nOf course, in order for the program to run, one must start the Network Server on port 1527 first.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40857","summary":"Server hang when invalid string is bound to datetime columns.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Derby running with Network Server via JDBC universal driver.","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/30260/comment/59411","id":"59411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"The description originally said that the hang was in the \"client program.\"  I'm changing it to say that the hang is either in the JCC client or else in the Network Server, since that seems like a more accurate statement.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2005-02-19T07:03:00.000+0000","updated":"2005-02-19T07:03:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30260/comment/12330055","id":"12330055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Looking at this problem, I see that other types of errors, such as insert of a null value into a not null column seem to work ok. Looking at two types of errors in the trace,  I see the following.\r\n\r\nSUCCESSFUL ERROR PROCESSING (invalid insert of null value. handled ok)\r\n[derby]        SEND BUFFER: EXCSQLSTT             \r\n[derby]        SEND BUFFER: SQLDTA       \r\n[derby]        SEND BUFFER: RDBCMM      \r\n[derby]        RECEIVE BUFFER: SQLCARD (With error 23502)\r\n[derby]        RECEIVE BUFFER: ENDUOWRM  \r\n[derby]        RECEIVE BUFFER: SQLCARD   (null SQLCARD)\r\n\r\n\r\nPROBLEM  ERROR PROCESSING (invalid conversion)\r\n\r\n[derby]        SEND BUFFER: EXCSQLSTT  \r\n[derby]        SEND BUFFER: SQLDTA   \r\n[derby]        SEND BUFFER: RDBCMM  \r\n[derby]        RECEIVE BUFFER: SQLCARD (Exception 22007)\r\n\r\nIn the  problem  case, the server never sends the ENDUOWRM and SQLCARD that it should. The client blocks waiting for a response to its chained RDBCMM which the server never sent.\r\n\r\nIn the server, in parseSQLDTA on exception, we call skipRemainder(false) to skip the rest of the DSS. The false parameter  means it will skip DSS's even if they have a different correlation id, which means in this case it gets a little too skippy and skips the RDBCMM Command.\r\n\r\nChanging the line to skipRemainder(true) fixes the problem and makes sense to me because the DRDA manual seems to indicate that you should only get a new correlation identifier for a new command (page 76).   \r\n\r\nMy specific question (at last)  is this:\r\n\r\nAre there any situations where we might need to skip a DSS with a different correlation ID  when parsing the parameters in parseSQLDTA?  \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-09-21T09:59:26.000+0000","updated":"2005-09-21T09:59:26.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30260/comment/12330242","id":"12330242","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"I looked at the rest of the DRDAConnThread file and the only other places where \"skipRemainder(false)\" is called are 1) during connection authentication and 2) in cases where the client explicitly specified that severe errors should break the chain (in which case we call \"errorInChain\" and that method calls \"skipRemainder(false)\").  I can understand it's use in both of these cases--but like you say, Kathey, I don't really understand why we would be passing \"false\" to skipRemainder for the parseSQLDTA method.  \r\n\r\nI skimmed through what I thought were the relevant sections of the DRDA/DDM manuals and I saw nothing in them to indicate that we should be skipping DSSes with different correlation id's  when parsing the parameters for SQLDTA causes an error.  So if changing the \"skipRemainder\" call to pass \"true\" fixes the problem and all of our other tests pass, it seems like it's an acceptable fix to me...\r\n\r\n(For what that's worth.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2005-09-23T09:13:31.000+0000","updated":"2005-09-23T09:13:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30260/comment/12330500","id":"12330500","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"checked in fix to  the trunk.  Thanks Arm for looking at it so carefully.\r\n\r\nDate: Mon Sep 26 12:39:26 2005\r\nNew Revision: 291721\r\n\r\nURL: http://svn.apache.org/viewcvs?rev=291721&view=rev\r\nLog:\r\nDERBY-149\r\nFix Server hang when invalid string is bound to datetime columns.\r\nChanges network server to skip only the current DSS and not all chained DSS's \r\nwhen parsing parameter data in SQLDTA.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-09-27T04:42:22.000+0000","updated":"2005-09-27T04:42:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30260/comment/12331767","id":"12331767","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Checked this issue into 10.1\r\n\r\nDate: Mon Oct 10 20:46:53 2005\r\nNew Revision: 312801\r\n\r\nURL: http://svn.apache.org/viewcvs?rev=312801&view=rev\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-10-11T12:56:53.000+0000","updated":"2005-10-11T12:56:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30260/comment/12361684","id":"12361684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Verified the fix on 10.1.2.1 and trunk, and closed the issue.\r\nAlso tested that the test program indeed did hang on 10.0.2.1 and 10.1.1.0.\r\n\r\nOutput from test program on 10.1.2.1:\r\n]$ java -classpath ./db2jcc.jar:./db2jcc_license_c.jar:../db-derby-10.1.2.1-lib/lib/derbyclient.jar:./ go\r\nGot 22007: DB2 SQL error: SQLCODE: -1, SQLSTATE: 22007, SQLERRMC: 22007.S.181","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2006-01-04T08:05:44.000+0000","updated":"2006-01-04T08:05:44.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-149/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07cwn:"}}