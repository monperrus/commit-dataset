{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12521162","self":"https://issues.apache.org/jira/rest/api/latest/issue/12521162","key":"CASSANDRA-3122","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317588","id":"12317588","description":"","name":"0.8.5","archived":false,"released":true,"releaseDate":"2011-09-08"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-09-02 15:06:18.599","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"1_*:*_1_*:*_31544945_*|*_5_*:*_1_*:*_0","customfield_12310420":"4078","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-09-02T18:01:28.507+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-3122/watchers","watchCount":0,"isWatching":false},"created":"2011-09-02T09:15:43.587+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-09-05T10:24:42.038+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"In SSTableSimpleUnsortedWriter, when dealing with rows having a lot of columns, if we call newRow several times (to flush data as soon as possible), the time taken by the newRow() call is increasing non linearly. This is because when newRow is called, we merge the size increasing existing CF with the new one.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12492758","id":"12492758","filename":"3122.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-09-02T15:06:18.576+0000","size":8388,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12492758/3122.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12492727","id":"12492727","filename":"SSTableSimpleUnsortedWriter.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"created":"2011-09-02T09:19:22.071+0000","size":1124,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12492727/SSTableSimpleUnsortedWriter.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12492732","id":"12492732","filename":"SSTableSimpleUnsortedWriter-v2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"created":"2011-09-02T11:13:40.056+0000","size":1198,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12492732/SSTableSimpleUnsortedWriter-v2.patch"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"94031","summary":"SSTableSimpleUnsortedWriter take long time when inserting big rows","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":12,"total":12,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13095880","id":"13095880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"body":"Small patch that merge the smallest CF with the other one instead of always the existing one with the new one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"created":"2011-09-02T09:19:22.106+0000","updated":"2011-09-02T09:19:22.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13095911","id":"13095911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"body":"Version 2 using getEstimatedColumnCount","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"created":"2011-09-02T11:13:40.117+0000","updated":"2011-09-02T11:13:40.117+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13096033","id":"13096033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"As said on the mailing list, though that solution does improve performance, I think we can do better, by simply having the insertions go into the previous column family  when we \"reopen a row\" instead of creating a new column family each time and copying everything to the previous one afterwards. \r\n\r\nAttaching patch (3122.patch) that does just this. Note that this patch also fix a bug by which the last row wasn't written and add a unit test for the UnsortedWriter.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-09-02T15:06:18.599+0000","updated":"2011-09-02T15:06:18.599+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13096036","id":"13096036","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"body":"That's even better that way. Thanks !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"created":"2011-09-02T15:11:48.355+0000","updated":"2011-09-02T15:11:48.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13096053","id":"13096053","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I don't understand how the changes to writeRow work without doing anything to cF b/s asking for its serializedSize.\r\n\r\nnit: unused imports in SimpleUnsorted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-09-02T15:40:41.855+0000","updated":"2011-09-02T15:40:41.855+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13096080","id":"13096080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"bq. I don't understand how the changes to writeRow work without doing anything to cF b/s asking for its serializedSize\r\n\r\nIn (the new method) getColumnFamily, when we reuse a previous column family to add new columns to it, we start by removing it's size from the estimate, so that when writeRow is called on the updated cf, by adding the whole size we should still have a good estimate (actually a better one that before because we don't count the row key multiple times anymore).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-09-02T16:06:09.914+0000","updated":"2011-09-02T16:06:09.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13096148","id":"13096148","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1\r\n\r\nI also note that newSuperColumn in abstract writer is unused.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-09-02T17:23:19.770+0000","updated":"2011-09-02T17:23:19.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13096168","id":"13096168","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"Committed, thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-09-02T18:01:28.516+0000","updated":"2011-09-02T18:01:28.516+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13096180","id":"13096180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra-0.8 #312 (See [https://builds.apache.org/job/Cassandra-0.8/312/])\r\n    Improve SSTableSimpleUnsortedWriter speed with large rows\r\npatch by slebresne; reviewed by jebllis for CASSANDRA-3122\r\n\r\nslebresne : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1164657\r\nFiles : \r\n* /cassandra/branches/cassandra-0.8/CHANGES.txt\r\n* /cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/io/sstable/AbstractSSTableSimpleWriter.java\r\n* /cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/io/sstable/SSTableSimpleUnsortedWriter.java\r\n* /cassandra/branches/cassandra-0.8/src/java/org/apache/cassandra/io/sstable/SSTableSimpleWriter.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-09-02T18:15:33.610+0000","updated":"2011-09-02T18:15:33.610+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13096867","id":"13096867","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"body":"Digging further in SSTableSimpleUnsortedWriter, I found out another point : \r\n\r\nevery time newRow is called, serializedSize iterate through all the columns to compute the size.\r\n\r\nIn my use case, I have line whith hourly values (data:h0|h1|h2|...|h23), and for every line I will use the date of the day concatenated with the hour as key (\"dateoftheday|hour\"), and the value composed (using composite) with the data as column name ([value,data]=null). More clearly, my data look like :\r\nabc:1|2|1|2|1|2|1|2|1|2|1|2|1|2|1|2|1|2|1|2|1|2|1|2\r\nbcd:3|4|3|4|3|4|3|4|3|4|3|4|3|4|3|4|3|4|3|4|3|4|3|4\r\n\r\nand the for every line I call \r\n\r\nwriter.newRow(\"20110804|0\"), writer.addColum(Composite(1, \"abc\"), empty_array), \r\nwriter.newRow(\"20110804|1\"), writer.addColum(Composite(2, \"abc\"), empty_array), \r\nwriter.newRow(\"20110804|3\"), writer.addColum(Composite(1, \"abc\"), empty_array), \r\nwriter.newRow(\"20110804|4\"), writer.addColum(Composite(2, \"abc\"), empty_array), \r\n...\r\n\r\nSo writer.newRow() is called 24 times for every lines.\r\n\r\nSo one solution could be to have a local class \"CachedSizeColumFamily\" extending ColumFamily that will increase the serialized size at every addColumn, and return it directly when serializedSize() is called.\r\n\r\nIn the same topic, even if ConcurrentSkipListMap claims to have good performances (which is the case in multi threading environments), I had really better results using a TreeMap in ColumnFamily (and then avoid the putIfAbscent call on the ConcurrentSkipListMap). In bulk loading, SSTableSimpleUnsortedWriter is single threaded anyway, there is no needs of having a complex but yes slower data structure like ConcurrentSkipListMap. An improvement in bulk loading would be to use a \"single threaded\" ColumFamily for bulk loading. This could be part of another Jira.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bperroud","name":"bperroud","emailAddress":"benoit at noisette dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=bperroud&avatarId=12753","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bperroud&avatarId=12753","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bperroud&avatarId=12753","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bperroud&avatarId=12753"},"displayName":"Benoit Perroud","active":true},"created":"2011-09-04T12:52:44.082+0000","updated":"2011-09-04T12:52:44.082+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13097066","id":"13097066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"bq. every time newRow is called, serializedSize iterate through all the columns to compute the size\r\n\r\nYes and I agree this ain't the more efficient thing ever, though I would kind of be surprised this would be a bottleneck. Anyway, I don't oppose improving this, but we should create a new ticket for that.\r\n\r\nbq. An improvement in bulk loading would be to use a \"single threaded\" ColumFamily for bulk loading.\r\n\r\nYes, but we'll do it in 1.0 only because we have CASSANDRA-2843 there that basically make this trivial, while this is uglier to do without it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-09-05T09:04:53.020+0000","updated":"2011-09-05T09:04:53.020+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12521162/comment/13097112","id":"13097112","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra-0.8 #313 (See [https://builds.apache.org/job/Cassandra-0.8/313/])\r\n    Add missing file and fix type from CASSANDRA-3122 commit\r\n\r\nslebresne : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1165218\r\nFiles : \r\n* /cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/io/sstable/SSTableSimpleWriterTest.java\r\n* /cassandra/branches/cassandra-0.8/test/unit/org/apache/cassandra/io/sstable/SSTableWriterTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-09-05T10:24:42.038+0000","updated":"2011-09-05T10:24:42.038+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-3122/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0gg1z:"}}