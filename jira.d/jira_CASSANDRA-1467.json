{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12473291","self":"https://issues.apache.org/jira/rest/api/latest/issue/12473291","key":"CASSANDRA-1467","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315264","id":"12315264","description":"","name":"0.6.6","archived":false,"released":true,"releaseDate":"2010-10-14"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315251","id":"12315251","description":"","name":"0.7 beta 2","archived":false,"released":true,"releaseDate":"2010-10-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-09-03 23:58:46.485","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"10002_*:*_1_*:*_337196765_*|*_1_*:*_1_*:*_500854814_*|*_5_*:*_1_*:*_0","customfield_12310420":"20157","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-09-13T16:11:49.103+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1467/watchers","watchCount":0,"isWatching":false},"created":"2010-09-03T23:24:17.524+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-09-13T16:11:49.025+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"What happens here the following:\r\n* given a healthy running cluster of 2 nodes (it used to be 3 but I manually killed one down)\r\n* with a Keyspace having a ReplicationFactor of 2\r\n* (this cluster is operational, loaded with data and working well)\r\n\r\n as soon as I want to bring up a new 3rd node:\r\n* the node is detected by the current cluster\r\n* but as soon as it tries to initiate bootstrap sequence it dies with:  replication factor (2) exceeds number of endpoints (1)\r\n\r\nI believe this is similar to #1343, but not quite the same, since the keyspace and everything is already created, and I'm not attempting any modification. This is purely bringing a new node up.\r\n\r\nOne extra tidbit of information, in case it's important...maybe it is not: \r\nI have only set 1 seed node configured (this is a test setup). And when the new node starts coming up (before the crash) its nodetool ring only reports the seed one.\r\n\r\nFrom the new node coming up (before it crashes):\r\nroot@node1-3:~# nodetool -h localhost -p 8080 ring\r\nAddress         Status State   Load            Token                                       \r\n10.250.106.111  Up     Normal  116.3 GB        0          < = this the only configured seed node\r\n\r\nFrom one of the other running nodes (this is the real status of the cluster):\r\nroot@node1-2:~# nodetool -h localhost -p 8080 ring\r\nAddress         Status State   Load            Token                                       \r\n                                       113416112894748789872342756657008344878    \r\n10.250.106.111  Up     Normal  116.3 GB        0                                           \r\n10.215.195.81   Up     Normal  116.31 GB       56713727820156410577229101238628035242      \r\n10.246.65.221   Up     Joining 7.63 KB         113416112894748789872342756657008344878     \r\n\r\n\r\nHere's the full boot trace of the node is trying to join:\r\nJava HotSpot(TM) Client VM warning: Can't detect initial thread stack location - find_vma failed\r\nCreate RMI registry on port 8081\r\nGet the platform's MBean server\r\nInitialize the environment map\r\nCreate an RMI connector server\r\nStart the RMI connector server on port 8081\r\n INFO 22:32:50,448 Loading settings from /etc/cassandra/cassandra.yaml\r\nDEBUG 22:32:50,537 Syncing log with a period of 10000\r\n INFO 22:32:50,538 DiskAccessMode 'auto' determined to be standard, indexAccessMode is standard\r\nDEBUG 22:32:50,548 setting auto_bootstrap to true\r\nDEBUG 22:32:50,702 Starting CFS Statistics\r\nDEBUG 22:32:50,710 key cache capacity for Statistics is 1\r\nDEBUG 22:32:50,711 Starting CFS Schema\r\nDEBUG 22:32:50,712 key cache capacity for Schema is 1\r\nDEBUG 22:32:50,712 Starting CFS Migrations\r\nDEBUG 22:32:50,713 key cache capacity for Migrations is 1\r\nDEBUG 22:32:50,713 Starting CFS LocationInfo\r\nDEBUG 22:32:50,713 key cache capacity for LocationInfo is 1\r\nDEBUG 22:32:50,714 Starting CFS HintsColumnFamily\r\nDEBUG 22:32:50,714 key cache capacity for HintsColumnFamily is 1\r\n INFO 22:32:50,736 Couldn't detect any schema definitions in local storage.\r\n INFO 22:32:50,737 Found table data in data directories. Consider using JMX to call org.apache.cassandra.service.StorageService.loadSchemaFromYaml().\r\nDEBUG 22:32:50,738 opening keyspace system\r\n INFO 22:32:50,757 Cassandra version: \r\n INFO 22:32:50,757 Thrift API version: 10.0.0\r\n INFO 22:32:50,758 Saved Token not found. Using 113416112894748789872342756657008344878\r\n INFO 22:32:50,758 Saved ClusterName not found. Using SOMETHING \r\n INFO 22:32:50,763 Creating new commitlog segment /mnt/cassandra/commitlog/CommitLog-1283553170763.log\r\nDEBUG 22:32:50,767 Estimating compactions for LocationInfo\r\nDEBUG 22:32:50,768 Estimating compactions for HintsColumnFamily\r\nDEBUG 22:32:50,768 Estimating compactions for Migrations\r\nDEBUG 22:32:50,768 Estimating compactions for Schema\r\nDEBUG 22:32:50,768 Estimating compactions for Statistics\r\nDEBUG 22:32:50,769 Checking to see if compaction of LocationInfo would be useful\r\nDEBUG 22:32:50,769 Checking to see if compaction of HintsColumnFamily would be useful\r\nDEBUG 22:32:50,769 Checking to see if compaction of Migrations would be useful\r\nDEBUG 22:32:50,769 Checking to see if compaction of Schema would be useful\r\nDEBUG 22:32:50,769 Checking to see if compaction of Statistics would be useful\r\n INFO 22:32:50,779 switching in a fresh Memtable for LocationInfo at CommitLogContext(file='/mnt/cassandra/commitlog/CommitLog-1283553170763.log', position=276)\r\n INFO 22:32:50,782 Enqueuing flush of Memtable-LocationInfo@18721294(192 bytes, 4 operations)\r\n INFO 22:32:50,783 Writing Memtable-LocationInfo@18721294(192 bytes, 4 operations)\r\n INFO 22:32:50,897 Completed flushing /mnt/ebs/data/system/LocationInfo-e-1-Data.db\r\nDEBUG 22:32:50,898 Checking to see if compaction of LocationInfo would be useful\r\nDEBUG 22:32:50,898 Discarding 0\r\nDEBUG 22:32:50,899 discard completed log segments for CommitLogContext(file='/mnt/cassandra/commitlog/CommitLog-1283553170763.log', position=276), column family 0.\r\nDEBUG 22:32:50,899 Marking replay position 276 on commit log CommitLogSegment(/mnt/cassandra/commitlog/CommitLog-1283553170763.log)\r\n INFO 22:32:50,908 Starting up server gossip\r\n INFO 22:32:50,928 Joining: getting load information\r\n INFO 22:32:50,928 Sleeping 90000 ms to wait for load information...\r\nDEBUG 22:32:50,940 attempting to connect to node1-1.domain.com/10.250.106.111\r\nDEBUG 22:32:51,044 attempting to connect to node1-1.domain.com/10.250.106.111\r\nDEBUG 22:32:51,045 attempting to connect to /10.215.195.81\r\n INFO 22:32:51,051 Node /10.215.195.81 is now part of the cluster\r\nDEBUG 22:32:51,051 Resetting pool for /10.215.195.81\r\nDEBUG 22:32:51,052 Token 113416112894748789872342756657008344877 removed manually (endpoint was unknown)\r\n INFO 22:32:51,052 Node /10.250.106.111 is now part of the cluster\r\nDEBUG 22:32:51,053 Resetting pool for /10.250.106.111\r\nDEBUG 22:32:51,053 Node /10.250.106.111 state normal, token 0\r\nDEBUG 22:32:51,053 clearing cached endpoints\r\nDEBUG 22:32:51,171 Applying AddKeyspace from /10.250.106.111\r\nDEBUG 22:32:51,188 Applying migration 77e97d6c-b625-11df-8596-318df8b646e8\r\n INFO 22:32:51,189 switching in a fresh Memtable for Migrations at CommitLogContext(file='/mnt/cassandra/commitlog/CommitLog-1283553170763.log', position=7417)\r\n INFO 22:32:51,189 Enqueuing flush of Memtable-Migrations@18093512(4938 bytes, 1 operations)\r\n INFO 22:32:51,189 Writing Memtable-Migrations@18093512(4938 bytes, 1 operations)\r\n INFO 22:32:51,194 switching in a fresh Memtable for Schema at CommitLogContext(file='/mnt/cassandra/commitlog/CommitLog-1283553170763.log', position=7417)\r\n INFO 22:32:51,194 Enqueuing flush of Memtable-Schema@27402470(1784 bytes, 3 operations)\r\n INFO 22:32:51,274 Completed flushing /mnt/ebs/data/system/Migrations-e-1-Data.db\r\nDEBUG 22:32:51,274 Checking to see if compaction of Migrations would be useful\r\nDEBUG 22:32:51,275 Discarding 2\r\nDEBUG 22:32:51,275 discard completed log segments for CommitLogContext(file='/mnt/cassandra/commitlog/CommitLog-1283553170763.log', position=7417), column family 2\r\n.\r\nDEBUG 22:32:51,275 Marking replay position 7417 on commit log CommitLogSegment(/mnt/cassandra/commitlog/CommitLog-1283553170763.log)\r\n INFO 22:32:51,275 Writing Memtable-Schema@27402470(1784 bytes, 3 operations)\r\n INFO 22:32:51,388 Completed flushing /mnt/ebs/data/system/Schema-e-1-Data.db\r\nDEBUG 22:32:51,389 Checking to see if compaction of Schema would be useful\r\nDEBUG 22:32:51,389 Discarding 3\r\nDEBUG 22:32:51,389 discard completed log segments for CommitLogContext(file='/mnt/cassandra/commitlog/CommitLog-1283553170763.log', position=7417), column family 3\r\n.\r\nDEBUG 22:32:51,389 Marking replay position 7417 on commit log CommitLogSegment(/mnt/cassandra/commitlog/CommitLog-1283553170763.log)\r\nDEBUG 22:32:51,406 Starting CFS MyColumnFamily\r\nDEBUG 22:32:51,406 key cache capacity for MyColumnFamily is 200000\r\n INFO 22:32:51,407 Creating new commitlog segment /mnt/cassandra/commitlog/CommitLog-1283553171407.log\r\nDEBUG 22:32:51,604 attempting to connect to node1-1.domain.com/10.250.106.111\r\n INFO 22:32:51,622 InetAddress /10.215.195.81 is now UP\r\n INFO 22:32:51,623 InetAddress /10.250.106.111 is now UP\r\n INFO 22:32:51,623 Started hinted handoff for endpoint /10.215.195.81\r\n INFO 22:32:51,631 Finished hinted handoff of 0 rows to endpoint /10.215.195.81\r\n INFO 22:32:51,632 Started hinted handoff for endpoint /10.250.106.111\r\n INFO 22:32:51,632 Finished hinted handoff of 0 rows to endpoint /10.250.106.111\r\nDEBUG 22:32:51,918 GC for ParNew: 14 ms, 20561696 reclaimed leaving 149257720 used; max is 902627328\r\nDEBUG 22:32:51,919 GC for ConcurrentMarkSweep: 73 ms, 4178480 reclaimed leaving 8520856 used; max is 902627328\r\nDEBUG 22:32:52,924 Disseminating load info ...\r\nDEBUG 22:32:53,929 attempting to connect to /10.215.195.81\r\nDEBUG 22:32:54,925 GC for ConcurrentMarkSweep: 73 ms, 212034048 reclaimed leaving 15214608 used; max is 902627328\r\nDEBUG 22:33:52,931 Disseminating load info ...\r\nDEBUG 22:34:20,929 ... got load info\r\n INFO 22:34:20,929 Joining: getting bootstrap token\r\nDEBUG 22:34:20,931 token manually specified as 113416112894748789872342756657008344878\r\n INFO 22:34:20,932 Joining: sleeping 30000 ms for pending range setup\r\n INFO 22:34:50,935 Bootstrapping\r\nDEBUG 22:34:50,935 Beginning bootstrap process\r\njava.lang.reflect.InvocationTargetException\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.apache.commons.daemon.support.DaemonLoader.load(DaemonLoader.java:160)\r\nCaused by: java.lang.IllegalStateException: replication factor (2) exceeds number of endpoints (1)\r\n        at org.apache.cassandra.locator.RackUnawareStrategy.calculateNaturalEndpoints(RackUnawareStrategy.java:57)\r\n        at org.apache.cassandra.locator.AbstractReplicationStrategy.getRangeAddresses(AbstractReplicationStrategy.java:195)\r\n        at org.apache.cassandra.dht.BootStrapper.getRangesWithSources(BootStrapper.java:155)\r\n        at org.apache.cassandra.dht.BootStrapper.startBootstrap(BootStrapper.java:73)\r\n        at org.apache.cassandra.service.StorageService.startBootstrap(StorageService.java:467)\r\n        at org.apache.cassandra.service.StorageService.initServer(StorageService.java:408)\r\n        at org.apache.cassandra.thrift.CassandraDaemon.setup(CassandraDaemon.java:134)\r\n        at org.apache.cassandra.service.AbstractCassandraDaemon.init(AbstractCassandraDaemon.java:57)\r\n        ... 5 more\r\nCannot load daemon\r\nService exit with a return value of 3\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454241","id":"12454241","filename":"1467-0.6.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-09T21:09:38.264+0000","size":17797,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454241/1467-0.6.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454238","id":"12454238","filename":"ASF.LICENSE.NOT.GRANTED--v1-0001-expose-endpoint-states-to-jmx.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-09T21:07:06.161+0000","size":1930,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454238/ASF.LICENSE.NOT.GRANTED--v1-0001-expose-endpoint-states-to-jmx.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454239","id":"12454239","filename":"ASF.LICENSE.NOT.GRANTED--v1-0002-remove-unused-code-from-SLB.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-09T21:07:06.183+0000","size":981,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454239/ASF.LICENSE.NOT.GRANTED--v1-0002-remove-unused-code-from-SLB.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454240","id":"12454240","filename":"ASF.LICENSE.NOT.GRANTED--v1-0003-broadcast-removetoken-using-MOVE-NORMAL-to-preserve-th.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-09T21:07:06.203+0000","size":18789,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454240/ASF.LICENSE.NOT.GRANTED--v1-0003-broadcast-removetoken-using-MOVE-NORMAL-to-preserve-th.txt"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"92279","summary":"replication factor exceeds number of endpoints, when attempting to join a new node (but cluster has enough running nodes to fulfill RF)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=blanquer","name":"blanquer","emailAddress":"blanquer at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josep M. Blanquer","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=blanquer","name":"blanquer","emailAddress":"blanquer at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josep M. Blanquer","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":"I'm using 0.7 beta1. Built from: http://www.apache.org/dyn/closer.cgi?path=/cassandra/0.7.0/apache-cassandra-0.7.0-beta1-src.tar.gz  using dpkg-buildpackage from it.","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":8,"total":8,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473291/comment/12906181","id":"12906181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"Did the node you were trying to bootstrap already have schema defined?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-03T23:58:46.485+0000","updated":"2010-09-03T23:58:46.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473291/comment/12906187","id":"12906187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=blanquer","name":"blanquer","emailAddress":"blanquer at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josep M. Blanquer","active":true},"body":"No, it was a blank node. \r\nI've just wiped the data and commit log dirs clean, and restarted cassandra again with the same result.\r\n\r\nHere's the start of the system.log:\r\n INFO [main] 2010-09-04 00:19:19,744 DatabaseDescriptor.java (line 120) Loading settings from /etc/cassandra/cassandra.yaml\r\nDEBUG [main] 2010-09-04 00:19:19,923 DatabaseDescriptor.java (line 163) Syncing log with a period of 10000\r\n INFO [main] 2010-09-04 00:19:19,923 DatabaseDescriptor.java (line 171) DiskAccessMode 'auto' determined to be standard, indexAccessMode is standard\r\nDEBUG [main] 2010-09-04 00:19:19,933 DatabaseDescriptor.java (line 311) setting auto_bootstrap to true\r\nDEBUG [main] 2010-09-04 00:19:20,122 ColumnFamilyStore.java (line 149) Starting CFS Statistics\r\nDEBUG [main] 2010-09-04 00:19:20,188 SSTableTracker.java (line 110) key cache capacity for Statistics is 1\r\nDEBUG [main] 2010-09-04 00:19:20,189 ColumnFamilyStore.java (line 149) Starting CFS Schema\r\nDEBUG [main] 2010-09-04 00:19:20,190 SSTableTracker.java (line 110) key cache capacity for Schema is 1\r\nDEBUG [main] 2010-09-04 00:19:20,191 ColumnFamilyStore.java (line 149) Starting CFS Migrations\r\nDEBUG [main] 2010-09-04 00:19:20,191 SSTableTracker.java (line 110) key cache capacity for Migrations is 1\r\nDEBUG [main] 2010-09-04 00:19:20,191 ColumnFamilyStore.java (line 149) Starting CFS LocationInfo\r\nDEBUG [main] 2010-09-04 00:19:20,192 SSTableTracker.java (line 110) key cache capacity for LocationInfo is 1\r\nDEBUG [main] 2010-09-04 00:19:20,193 ColumnFamilyStore.java (line 149) Starting CFS HintsColumnFamily\r\nDEBUG [main] 2010-09-04 00:19:20,193 SSTableTracker.java (line 110) key cache capacity for HintsColumnFamily is 1\r\n INFO [main] 2010-09-04 00:19:20,223 DatabaseDescriptor.java (line 442) *Couldn't detect any schema definitions in local storage.*\r\n INFO [main] 2010-09-04 00:19:20,224 DatabaseDescriptor.java (line 468) Found table data in data directories. Consider using JMX to call org.apache.cassandra.service.StorageService.loadSchemaFromYaml().\r\nDEBUG [main] 2010-09-04 00:19:20,227 CassandraDaemon.java (line 115) opening keyspace system\r\n INFO [main] 2010-09-04 00:19:20,247 StorageService.java (line 342) Cassandra version:\r\n INFO [main] 2010-09-04 00:19:20,247 StorageService.java (line 343) Thrift API version: 10.0.0\r\n INFO [main] 2010-09-04 00:19:20,248 SystemTable.java (line 202) Saved Token not found. Using 113416112894748789872342756657008344878\r\n INFO [main] 2010-09-04 00:19:20,249 SystemTable.java (line 208) Saved ClusterName not found. ......\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=blanquer","name":"blanquer","emailAddress":"blanquer at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Josep M. Blanquer","active":true},"created":"2010-09-04T00:23:39.805+0000","updated":"2010-09-04T00:23:39.805+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473291/comment/12906979","id":"12906979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"It took some trying, but I can reproduce this now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-07T21:30:08.856+0000","updated":"2010-09-07T21:30:08.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473291/comment/12907671","id":"12907671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"Reproduced in 0.6 (mostly).  The bootstrap still happens because we don't enforce the RF restriction that we do now.  When the fourth node is brought up and bootstrapped, it sees the the ring minus the coordinator node from the removetoken operation.\r\n\r\nI've got a patch worked up for trunk.  I'll port it to 0.6 and attach shortly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-09T16:21:52.060+0000","updated":"2010-09-09T16:21:52.060+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473291/comment/12907718","id":"12907718","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"The first two patches are housekeeping.  Exposing the endpoint states via jmx was helpful for troubleshooting.\r\nThe third patch changes gossip so that the removetoken information is broadcast as part of a MOVE,NORMAL instead of MOVE,LEFT.  This means that we no longer have to distinguish between MOVE,LEFT,leaving and MOVE,LEFT,removetoken, so I removed that distinction.  \r\n\r\nValid MOVE operations are now these:\r\nMOVE,NORMAL,token[,<other command>,<other token>]\r\nMOVE,LEFT,token\r\nMOVE,BOOTSTRAPPING,token\r\nMOVE,LEAVING,token\r\n\r\nIf this patch goes into 0.6 as is, it alters gossip enough so that if a removetoken, decommission or loadbalance are in progress during the rolling upgrade, bad things might happen (the wrong handlers could be called).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-09T18:31:52.303+0000","updated":"2010-09-09T18:46:43.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473291/comment/12907786","id":"12907786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"comments MOVE state transitions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-09T21:09:38.335+0000","updated":"2010-09-09T21:09:38.335+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473291/comment/12908802","id":"12908802","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-13T14:25:00.132+0000","updated":"2010-09-13T14:25:00.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473291/comment/12908843","id":"12908843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"committed 0.6 and trunk (0.7)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-13T16:11:48.998+0000","updated":"2010-09-13T16:11:48.998+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1467/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g58n:"}}