{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12510630","self":"https://issues.apache.org/jira/rest/api/latest/issue/12510630","key":"DERBY-5283","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323475","id":"12323475","description":"Head of 10.8 branch starting 2014-01-13","name":"10.8.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-08-31 13:09:34.631","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24757","customfield_12310222":"1_*:*_1_*:*_11176042666_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-10-24T12:16:43.843+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5283/watchers","watchCount":3,"isWatching":false},"created":"2011-06-17T03:49:21.391+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12371971","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12371971","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12656863","key":"DERBY-6289","self":"https://issues.apache.org/jira/rest/api/2/issue/12656863","fields":{"summary":"Derby 10.8 backport issue (summer 2013)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-08-08T19:30:50.433+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11400","id":"11400","name":"Miscellaneous"}],"timeoriginalestimate":null,"description":"If Derby is terminated while SYSCS_DISABLE_LOG_ARCHIVE_MODE is being called service.properties can be left in a broken state.\r\n\r\nDepending on timing either of the two cases can happen:\r\nCase 1:\r\n\"ERROR XBM0S: Unable to rename file 'C:\\PATH_TO_DB\\service.properties' to 'C:\\PATH_TO_DB\\service.propertiesold' \" is thrown when next trying to call\r\nSYSCS_DISABLE_LOG_ARCHIVE_MODE(1). Both \"service.properties\" and \"service.propertiesold\" are present in the database directory. Removing \"service.propertiesold\" corrects the problem.\r\n\r\nCase 2:\r\n\"SQLException: Database 'C:\\PATH_TO_DB' not found\" is thrown when booting the database. The file service.properties does not exist in the database directory but service.propertiesold does exist. Renaming the file back to \"service.properties\" corrects the problem.\r\n\r\nAs mentioned above both cases have workarounds but they require manual intervention which is a problem for applications installed to a customer site. It would be great if a more reliable method to update the file could be found.\r\n\r\nThe following sample code will reproduce the issue fairly reliably by terminating the java process:\r\n\r\nimport java.sql.*;\r\nimport org.apache.derby.jdbc.*;\r\n\r\npublic class DerbyLogArchiveModeTest {\r\n    \r\n    public static void main(String[] args) {\r\n        final EmbeddedDataSource ds = new EmbeddedDataSource();\r\n        ds.setDatabaseName(\"derbyTest\");\r\n        ds.setCreateDatabase(\"create\");\r\n\r\n        try {\r\n            final Connection conn = ds.getConnection();\r\n\r\n            try {\r\n                final Statement stmt = conn.createStatement();\r\n\r\n                try {\r\n                    while (true) {\r\n                        stmt.execute(\"call SYSCS_UTIL.SYSCS_DISABLE_LOG_ARCHIVE_MODE(1)\");\r\n                    }\r\n                } finally {\r\n                    stmt.close();\r\n                }\r\n            } finally {\r\n                conn.close();\r\n            }\r\n        } catch (SQLException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10364","value":"Data corruption","id":"10364"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10421","value":"Seen in production","id":"10421"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36198","summary":"Crash / process termination during SYSCS_DISABLE_LOG_ARCHIVE_MODE can leave service.properties broken","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=b.mason%40adinstruments.com","name":"b.mason@adinstruments.com","emailAddress":"b dot mason at adinstruments dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Mason","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=b.mason%40adinstruments.com","name":"b.mason@adinstruments.com","emailAddress":"b dot mason at adinstruments dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Mason","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":">sysinfo\r\n------------------ Java Information ------------------\r\nJava Version:    1.6.0_26\r\nJava Vendor:     Sun Microsystems Inc.\r\nJava home:       C:\\Program Files (x86)\\Java\\jre6\r\nJava classpath:  .;C:\\Program Files (x86)\\Java\\jre6\\lib\\ext\\QTJava.zip;C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\\../lib/derby.jar;C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\\../lib/derbynet.jar;C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\\../lib/derbyclient.jar;C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\\../lib/derbytools.jar\r\nOS name:         Windows 7\r\nOS architecture: x86\r\nOS version:      6.1\r\nJava user name:  bmason\r\nJava user home:  C:\\Users\\BMASON\r\nJava user dir:   C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\bin\r\njava.specification.name: Java Platform API Specification\r\njava.specification.version: 1.6\r\njava.runtime.version: 1.6.0_26-b03\r\n--------- Derby Information --------\r\nJRE - JDBC: Java SE 6 - JDBC 4.0\r\n[C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\lib\\derby.jar] 10.6.1.0 - (938214)\r\n[C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\lib\\derbytools.jar] 10.6.1.0 - (938214)\r\n[C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\lib\\derbynet.jar] 10.6.1.0 - (938214)\r\n[C:\\Users\\BMASON\\Sandbox\\libs\\db-derby-10.6.1.0-bin\\lib\\derbyclient.jar] 10.6.1.0 - (938214)\r\n------------------------------------------------------\r\n----------------- Locale Information -----------------\r\nCurrent Locale :  [English/New Zealand [en_NZ]]\r\nFound support for locale: [cs]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [de_DE]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [es]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [fr]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [hu]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [it]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [ja_JP]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [ko_KR]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [pl]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [pt_BR]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [ru]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [zh_CN]\r\n         version: 10.6.1.0 - (938214)\r\nFound support for locale: [zh_TW]\r\n         version: 10.6.1.0 - (938214)\r\n------------------------------------------------------\r\n","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":16,"total":16,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13050888","id":"13050888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=b.mason%40adinstruments.com","name":"b.mason@adinstruments.com","emailAddress":"b dot mason at adinstruments dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Mason","active":true},"body":"We have worked around this issue in our application by removing the call to disable log archive mode since it was no longer needed. However we would be particularly interested in any other scenarios which would cause service.properties to be updated under \"normal\" usage.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=b.mason%40adinstruments.com","name":"b.mason@adinstruments.com","emailAddress":"b dot mason at adinstruments dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brett Mason","active":true},"created":"2011-06-17T03:53:43.927+0000","updated":"2011-06-17T03:53:43.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13094507","id":"13094507","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"I think we can improve the situation here, and I have written a prototype patch that fixes this.\r\nHowever, before moving on to the code, I have a few questions.\r\n\r\nIs it safe to assume that we can always undo the change to the properties file?\r\nUndo would be to continue using the old properties file, and redo would be to start using the new properties file.\r\nI understand that some, if not most, of the properties are only set at database creation time.\r\n\r\nThere are two types of error conditions:\r\n a) The VM is killed while updating the service properties.\r\n b) Updating the service properties is aborted due to a problem (most likely file privileges problem) - the VM stays up\r\n\r\nIn (a) recovery must happen on the next boot, whereas for (b) actions must be taken to correct the situation immediately. Both of these cases would involve a set of file operations; verifying, deleting, or renaming a file.\r\nAs a further improvement, I would suggest that we print an entry to derby.log when Derby automatically recovers from a problem with the service.properties file.\r\n\r\nWhen it comes to the content of the files on disk, are the following assumptions valid?\r\n 1) Writing to streams from Java may produce incomplete files.\r\n 2) Low level file operations invoked from Java, like delete and rename, will always result in valid files on disk.\r\n    Note that this does not imply that rename(old,new) is atomic, but, assuming new didn't already exist, new will be a complete copy of old if it exists after the crash.\r\n\r\nI started out with a rather complex solution for this (using checksums), but I think I'll take the time to simplify it - we can add to it if required.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-08-31T13:09:34.631+0000","updated":"2011-08-31T13:09:34.631+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13095204","id":"13095204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching patch 1a, an improvement to how the service.properties is dealt with:\r\n o add an EOF-marker when writing a new service.properties file\r\n o add code to recover from error conditions, in short (CUR = current/new service.properties, OLD = backed up service.properties):\r\n    a) if !CUR and OLD rename OLD to CUR\r\n    b) if CUR and OLD check CUR and rename/delete OLD as appropriate\r\n\r\nThis more code changes that I had hoped more - much of it due to error handling. I haven't added localization code for the various error messages.\r\n\r\nPatch ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-09-01T09:39:19.787+0000","updated":"2011-09-01T09:39:19.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13124117","id":"13124117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The suggested approach sounds good to me.\r\n\r\nOne possible simplification:\r\n\r\nInstead of materializing the entire service.properties file in prepareServicePropertiesContents() outside of the try block in saveServiceProperties(), we could move it into the existing try block:\r\n\r\n                        try\r\n                        {\r\n                            os = servicePropertiesFile.getOutputStream();\r\n                            properties.store( os, serviceName + MessageService.getTextMessage(MessageId.SERVICE_PROPERTIES_DONT_EDIT));\r\n                            storageFactory.sync( os, false);\r\n                            os.close();\r\n                            os = null;\r\n                        }\r\n\r\nand call something like os.write(SERVICE_PROPERTIES_END_TOKEN.getBytes(\"US-ASCII\")) between properties.store() and storageFactory.sync(). That would allow us to remove the error handling in prepareServicePropertiesContents() (well, actually, we could remove the entire method), since the same error handling seems to be performed by the try/catch in saveServiceProperties().\r\n\r\nWhat would be a good way to test this fix? Creating a database, shutting it down, and then modifying service.properties/service.propertiesold before booting it?\r\n\r\nIt might also be useful to link to the original exception in the cases where we re-throw SecurityException and IOException as StandardException (in handleSecPrivException() and resolveServicePropertiesFiles()).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-10-10T14:01:12.961+0000","updated":"2011-10-10T14:01:12.961+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13127319","id":"13127319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching patch 1b.\r\n\r\nThanks, Knut Anders.\r\nI have added a basic test, where I start with a pristine database, modify the two relevant files (i.e. copy or delete), and then boot the database and assert what happened to the two files.\r\nThe test doesn't verify what is written to derby.log.\r\n\r\nThere are many things that can be changed slightly, i.e. logging of messages and so on.\r\n\r\nPatch 1b ready for review.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-10-14T07:03:23.516+0000","updated":"2011-10-14T07:03:23.516+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13128710","id":"13128710","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Patch 1b looks good to me, and the tests look complete. One minor nit: I didn't immediately understand the abbreviation in the new helper method getSFPath(). Perhaps spell it out or rename it to getMostAccuratePath()?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-10-17T07:35:20.562+0000","updated":"2011-10-17T07:35:20.562+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13128728","id":"13128728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Thanks, Knut Anders.\r\n\r\nI'll rename that method.\r\nWhile writing it, I started thinking about whether we actually want to show the full path of the file we're having trouble with - for security reasons. For instance, with the network server it could reveal where the database lives and that may reveal where derby.system.home is. Not a big problem per se, but it would allow a potential attacker to target his/her discovery attacks (be it at the OS level or by exploiting weaknesses in Derby).\r\n\r\nWhat do people think?\r\nShould we aim at only printing full names to the log stream (i.e. derby.log by default), and hide or print them relative to the database directory [1] when throwing exceptions?\r\n\r\n\r\n[1] 'service.properties' instead of '/export/home/MyFancyApp/dbs/database1/service.properties', and 'seg0/c431.dat' instead of '/.../database1/seg0/c431.dat'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-10-17T08:43:48.528+0000","updated":"2011-10-17T08:43:48.528+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13134008","id":"13134008","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching patch 1c, which renames the getSFPath method and fixed a bug with the use of BufferedWriter.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-10-24T12:07:45.192+0000","updated":"2011-10-24T12:07:45.192+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13134014","id":"13134014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Committed patch 1c to trunk with revision 1188109.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-10-24T12:16:43.949+0000","updated":"2011-10-24T12:16:43.949+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13135284","id":"13135284","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching patch 2a, which updates lang.ErrorCodeTest with the two new error messages added by the fix for this issue.\r\n\r\nCommitted to trunk with revision 1188828.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-10-25T17:51:46.689+0000","updated":"2011-10-25T17:51:46.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13685288","id":"13685288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:35.010+0000","updated":"2013-06-17T09:19:35.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13707079","id":"13707079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Assign to myself temporarily for backport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-07-12T16:52:41.615+0000","updated":"2013-07-12T16:52:41.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13707156","id":"13707156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is a patch for 10.8 for this issue. It also includes the fix for DERBY-5816 which was a test failure caused by the original change.  The message files had to be manually merged.\r\n\r\nrevisions merged were: \r\nDERBY-5283  1188109 1188828\r\n\r\nDERBY-5816 1350361 1353764","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-07-12T17:54:32.811+0000","updated":"2013-07-12T17:54:32.811+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13711268","id":"13711268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1504199 from [~kmarsden] in branch 'code/branches/10'\r\n[ https://svn.apache.org/r1504199 ]\r\n\r\nDERBY-5283 Crash / process termination during SYSCS_DISABLE_LOG_ARCHIVE_MODE can leave service.properties broken \r\n\r\nMerge from trunk also includes the fix for DERBY-5816 which was a test failure caused by the original change. The message files had to be manually merged.\r\n\r\nrevisions merged were:\r\nDERBY-5283 1188109 1188828\r\n\r\nDERBY-5816 1350361 1353764","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-17T16:52:36.823+0000","updated":"2013-07-17T16:52:36.823+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13711270","id":"13711270","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1504199 from [~kmarsden] in branch 'code/branches/10'\r\n[ https://svn.apache.org/r1504199 ]\r\n\r\nDERBY-5283 Crash / process termination during SYSCS_DISABLE_LOG_ARCHIVE_MODE can leave service.properties broken \r\n\r\nMerge from trunk also includes the fix for DERBY-5816 which was a test failure caused by the original change. The message files had to be manually merged.\r\n\r\nrevisions merged were:\r\nDERBY-5283 1188109 1188828\r\n\r\nDERBY-5816 1350361 1353764","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-17T16:52:38.674+0000","updated":"2013-07-17T16:52:38.674+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12510630/comment/13733877","id":"13733877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1511979 from [~myrna] in branch 'code/branches/10.8'\r\n[ https://svn.apache.org/r1511979 ]\r\n\r\nDERBY-5283; Crash / process termination during SYSCS_DISABLE_LOG_ARCHIVE_MODE can leave service.properties broken\r\n  fixing a javadoc warning by merging the fix from trunk.\r\n  merge command:  svn merge -c 1188144 https://svn.apache.org/repos/asf/db/derby/code/trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-08-08T19:30:50.433+0000","updated":"2013-08-08T19:30:50.433+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5283/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06k5b:"}}