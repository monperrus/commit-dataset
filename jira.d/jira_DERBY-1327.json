{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12343095","self":"https://issues.apache.org/jira/rest/api/latest/issue/12343095","key":"DERBY-1327","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-06-08 22:47:18.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22440","customfield_12310222":"1_*:*_1_*:*_2469128000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_1483397000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-06-14T03:26:11.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1327/watchers","watchCount":0,"isWatching":false},"created":"2006-05-16T13:34:03.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-07-30T16:21:46.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"Using the following JRE with JIT on  an identity column may be created with a wrong and very large START WITH value.  When the problem occurs it affects not only the table being created, but also other tables that were created in previous transactions.\n\nFor example attempting to create 1000 tables with identity columns the 126th table creation changes the start with value in sys.syscolumns to 41628850257395713 for ALL 125 tables.  Attempts to insert into any of the tables cause\n\"SQL Exception: A truncation error was encountered trying to \nshrink ... to length 12.\" \n\n\nThis program will create up to 1000 tables until the problem \noccurs\nNote:\n- The problem does not occur with -Xnojit (JIT OFF)\n- The problem, when it occurs, changes not only the table being \ncreated but all previous tables created.  See output below. \nEvery thing was fine up until mytable126 and then all the \ntables got changed to start with 41628850257395713 \n- Problem occurs with autocommit on/off.\n- The problem occurs after the create table but before the \ncommit.\n- If the non-identity columns are removed the problem does not \nreproduce.\n\n\n\nimport java.sql.DatabaseMetaData;\nimport java.sql.ResultSet;\nimport java.sql.SQLException;\nimport java.sql.Statement;\nimport java.sql.DriverManager;\n\n\n\n\npublic class BadStartWith\n{\n\n    \n    public static void main (String args [])throws Exception \n    {\n    \ttestBadStartWith();\n    }\n    \n    /**\n     * After some number of table creations with JIT turned on, the START WITH value \n     * for the table being created and all the ones already created gets mysteriously\n     * changed with pwi32dev-20060412 (SR2)\n     * \n     * @throws Exception\n     */\n    public static void testBadStartWith() throws Exception\n    {\n\t\t\n\t\tClass.forName(\"org.apache.derby.jdbc.EmbeddedDriver\").newInstance();\n\t\tConnection conn = DriverManager.getConnection(\"jdbc:derby:wombat;create=true\");\n               conn.setAutoCommit(false);\n\t\tStatement stmt = null;\n\t\t\n\n\t\tDatabaseMetaData md = conn.getMetaData() ;\n\t\tSystem.out.println(md.getDatabaseProductVersion());\n               System.out.println(md.getDatabaseProductName());\n                System.out.println(md.getDriverName());\n\t\tdropAllAppTables(conn);\n\t\tSystem.out.println(\"Create tables until we get a wrong Start with value\");\n\t\tstmt = conn.createStatement();\n\n\t\t// numBadStartWith will be changed if any columns get a bad start with value.\n\t\tint numBadStartWith = 0; \n\n\t\ttry {\n\t\t\t// create 1000 tables.  Break out if we get a table that has a bad\n\t\t\t// start with value.\n\t\t\tfor (int i = 0; (i < 1000) && (numBadStartWith == 0); i++)\n\t\t\t{\n\t\t\t\tString tableName = \"APP.MYTABLE\" + i;\n\t\t\t    String createTableSQL = \"CREATE TABLE \" + tableName + \"  (ROLEID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 2, INCREMENT BY 1), INSTANCEID INTEGER, STATUS INTEGER, LOGICAL_STATE INTEGER, LSTATE_TSTAMP  TIMESTAMP, UPDT_TSTAMP TIMESTAMP, TSTAMP TIMESTAMP, CLALEVEL1_CLALEVEL2_CLALEVEL2ID VARCHAR(255),  CLALEVEL1_CLALEVEL2_CLALEVEL3_CLALEVEL3ID VARCHAR(255))\";\n\t\t\t\t\n\t\t\t\tstmt.executeUpdate(createTableSQL);\n\t\t\t\tSystem.out.println(createTableSQL);\n                System.out.println(\"Check before commit\");\n                numBadStartWith = checkBadStartWithCols(conn,2);\n                conn.commit();\n                System.out.println(\"Check after commit\");\n\t\t\t\tnumBadStartWith = checkBadStartWithCols(conn,2);\n\t\t\t\tif (numBadStartWith > 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} catch (SQLException se)\n\t\t{\n\t\t\tse.printStackTrace();\n\t\t}\n\t\tif (numBadStartWith == 0)\n\t\t\tSystem.out.println(\"PASS: All 1000 tables created without problems\");\n\t\tstmt.close();\n\t\tconn.rollback();\n        conn.close();\n\t}\n\n/**\n * Check that all tables in App do not have a an autoincrementstart value\n * greater tan maxautoincrementstart\n * @param conn\n * @param maxautoincrementstart  Maximum expected autoincrementstart value\n * @return number of columns with bad autoincrementstart value\n */\n\tprivate static int checkBadStartWithCols(Connection conn, int\n\t\t\t\t\t\t\t\t\t\t\t maxautoincrementstart) throws Exception\n\t{\n\t\tStatement stmt = conn.createStatement();\n\t\tResultSet rs =stmt.executeQuery(\"select count(autoincrementstart) from sys.syscolumns c, sys.systables t, sys.sysschemas s WHERE t.schemaid =  s.schemaid and s.schemaname = 'APP' and autoincrementstart > \" +  maxautoincrementstart);\n\n\t\trs.next();\n\t\tint numBadStartWith = rs.getInt(1);\n\t\tSystem.out.println(numBadStartWith + \" columns have bad START WITH VALUE\");\n\t\trs.close();\n\t\t\n\t\tif (numBadStartWith > 0)\n\t\t{\n\t\t\trs =stmt.executeQuery(\"select tablename, columnname, autoincrementstart from sys.syscolumns c, sys.systables t, sys.sysschemas s WHERE t.schemaid = s.schemaid and s.schemaname = 'APP' and autoincrementstart > 2 ORDER BY tablename\");\n\t\t\twhile (rs.next())\n\t\t\t{\n\t\t\t\tSystem.out.println(\"Unexpected start value: \" +\n\t\t\t\t\t\t\t\t   rs.getLong(3) + \n\t\t\t\t\t\t\t\t   \" on column \" + rs.getString(1) +\n\t\t\t\t\t\t\t\t   \"(\" + rs.getString(2) + \")\");\n\t\t\t\t\n\t\t\t\t\n\t\t\t}\n\t\t}\n       return numBadStartWith;\n\t}\n\n\t\n      /**\n        * Drop all tables in schema APP\n\t * @param conn\n\t * @throws SQLException\n\t */\n\tprivate  static void dropAllAppTables(Connection conn) throws SQLException\n\t{\n\t\tStatement stmt1 = conn.createStatement();\n\t\tStatement stmt2 = conn.createStatement();\n\t\tSystem.out.println(\"Drop all tables in APP schema\");\n\t\tResultSet rs = stmt1.executeQuery(\"SELECT tablename from sys.systables t, sys.sysschemas s where t.schemaid = s.schemaid and s.schemaname = 'APP'\");\n\n\t\twhile (rs.next())\n\t\t{\n\t\t\tString tableName = rs.getString(1);\n\t\t\t\n\t\t\ttry {\n\t\t\t\tstmt2.executeUpdate(\"DROP TABLE \" + tableName);\n\t\t\t}\n\t\t\tcatch (SQLException se)\n\t\t\t{\n\t\t\t\tSystem.out.println(\"Error dropping table:\" + tableName);\n\t\t\t\tse.printStackTrace();\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t}\n\n\t\n}\n\n\nRelevant output:\n$java BadStartWith\n10.2.0.0 alpha\nApache Derby\nApache Derby Embedded JDBC Driver\nDrop all tables in APP schema\nCreate tables until we get a wrong Start with value\nCREATE TABLE APP.MYTABLE0  (ROLEID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY\n (START WITH 2, INCREMENT BY 1), INSTANCEID INTEGER, STATUS INTEGER, LOGICAL_STA\nTE INTEGER, LSTATE_TSTAMP  TIMESTAMP, UPDT_TSTAMP TIMESTAMP, TSTAMP TIMESTAMP, C\nLALEVEL1_CLALEVEL2_CLALEVEL2ID VARCHAR(255),  CLALEVEL1_CLALEVEL2_CLALEVEL3_CLAL\nEVEL3ID VARCHAR(255))\nCheck before commit\n0 columns have bad START WITH VALUE\nCheck after commit\n0 columns have bad START WITH VALUE\n[snip MYTABLE1 ... MYTABLE124]\n\nCREATE TABLE APP.MYTABLE125  (ROLEID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 2, INCREMENT BY 1), INSTANCEID INTEGER, STATUS INTEGER, LOGICAL_STATE INTEGER, LSTATE_TSTAMP  TIMESTAMP,\nUPDT_TSTAMP TIMESTAMP, TSTAMP TIMESTAMP, CLALEVEL1_CLALEVEL2_CLALEVEL2ID VARCHAR(255),  CLALEVEL1_CLALEVEL2_CLALEVEL3_CLALEVEL3ID VARCHAR(255))\nCheck before commit\n0 columns have bad START WITH VALUE\nCheck after commit\n0 columns have bad START WITH VALUE\nCREATE TABLE APP.MYTABLE126  (ROLEID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 2, INCREMENT BY 1), INSTANCEID INTEGER, STATUS INTEGER, LOGICAL_STATE INTEGER, LSTATE_TSTAMP  TIMESTAMP,\nUPDT_TSTAMP TIMESTAMP, TSTAMP TIMESTAMP, CLALEVEL1_CLALEVEL2_CLALEVEL2ID VARCHAR(255),  CLALEVEL1_CLALEVEL2_CLALEVEL3_CLALEVEL3ID VARCHAR(255))\nCheck before commit\n127 columns have bad START WITH VALUE\nUnexpected start value: 41628850257395713 on column MYTABLE0(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE1(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE10(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE100(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE101(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE102(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE103(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE104(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE105(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE106(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE107(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE108(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE109(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE11(ROLEID)\nUnexpected start value: 41628850257395713 on column MYTABLE110(ROLEID)\n[snip the rest of the tables have unexpected START WITH value too]\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40469","summary":"Identity column can be  created with wrong and very large start with value with  \"J2RE 1.5.0 IBM Windows 32 build pwi32dev-20060412 (SR2)\" with JIT on","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":21,"total":21,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12411900","id":"12411900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am trying to narrrow down what java calls may be  causing this issue.\r\nBecause it only reproduces with JIT on I can't really debug with the debugger.\r\nHow is it that the creation of one table could affect the autoincrementstart value of all the tables  that have already been created and committed?\r\n\r\nI am not able to post this JRE unfortunately but  am hoping someone can provide some pointers on how one create table could have such a far ranging impact on tables already created.\r\n\r\nI tried putting some println's in org.apache.derby.impl.sql.execute.ColumnInfo but never see autoincstart being greater than 2.  Other references to this value seem unlikely to cause such widespread damage to other tables.  I'd appreciate any clues or thoughts on how to track this down.\r\n\r\nThanks\r\n\r\nKathey\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-05-16T14:00:51.000+0000","updated":"2006-05-16T14:00:51.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12412408","id":"12412408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I found  some good JIT diagnostic info  for this JVM at:\r\nhttp://download.boulder.ibm.com/ibmdl/pub/software/dw/jdk/diagnosis/diag50.pdf\r\n\r\nTo get jit to kick in immediately so it fails on the first create table and get a dump of the methods compiled  I:\r\n\r\njava -Xjit:count=0,disableInlining,optLevel=noOpt,verbose,vlog=BadStartWith.vlog BadStartWith\r\n\r\nI did a binary search to find the offending entry narrowed down to line 5531\r\njava -Xjit:count=0,disableInlining,optLevel=noOpt,limitFile=\\(BadStartWith.vlog,5531,5531\\) BadStartWith\r\n\r\nThis is the offending compilation:\r\n\r\n+ (no-opt) org/apache/derby/impl/sql/execute/CreateTableConstantAction.executeConstantAction(Lorg/apache/derby/iapi/sql/Activation;)V @ 0x229499B0-0x2294A9FA\r\n\r\nSo the workaround to exclude compilation of this method  is:\r\n\r\njava -Xjit:exclude={org/apache/derby/impl/sql/execute/CreateTableConstantAction.executeConstantAction\\(Lorg/apache/derby/iapi/sql/Activation\\;\\)V} BadStartWith\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-05-19T02:48:01.000+0000","updated":"2006-05-19T02:48:01.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12412448","id":"12412448","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"The problem seems to be in the compilation of this constructor call.\r\nThe parameter for autoincStart gets compiled incorrectly.\r\nThis is a long value and even hard coded as 0L it will have a bad value maybe an address, since the 0L value is much less than the variable.  I still have not been able to isolate completely from Derby.\r\n\r\nConstructor call  code in CreateTAbleConstantAction.executeConstantAction()\r\n\r\ncolumnDescriptor = new ColumnDescriptor(\r\ncolumnInfo[ix].name,\r\nindex++,\r\ncolumnInfo[ix].dataType,\r\ncolumnInfo[ix].defaultValue,\r\ncolumnInfo[ix].defaultInfo,\r\ntd,\r\ndefaultUUID,\r\n// below  is the problem parameter.\r\n// Occurs also with 0L hard coded.\r\n// The value when printed is ok.\r\ncolumnInfo[ix].autoincStart,\r\ncolumnInfo[ix].autoincInc,\r\ncolumnInfo[ix].autoincInc != 0,\r\ncolumnInfo[ix].autoinc_create_or_modify_Start_Increment\r\n);\r\n\r\nConstructor definition:\r\n\r\npublic ColumnDescriptor(String columnName, int columnPosition,\r\nDataTypeDescriptor columnType, DataValueDescriptor columnDefault,\r\nDefaultInfo columnDefaultInfo,\r\nTableDescriptor table,\r\nUUID defaultUUID, long autoincStart,\r\nlong autoincInc, boolean\r\nautoinc,\r\nlong userChangedWhat)\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-05-19T06:59:58.000+0000","updated":"2006-05-19T06:59:58.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12414892","id":"12414892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"The information that I got on this issue is that the problem is triggered when a method with a long parameter list (>10) is called, but before the JIT compiler has encountered the same number of temporary variables.\r\n\r\nA possible Derby Workaround would be to rework this  code so the constructor to have ten or less parameters \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-06-06T09:16:16.000+0000","updated":"2006-06-06T09:16:16.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415368","id":"12415368","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"The fix for this issue would be to reduce the number of parameters required by the constructor to <=10 in org.apache.derby.iapi.sql.dictionary.ColumnDescriptor class. While researching into this, I found that all the 3 constructors in the class have a parameter named autoinc and it is defined as a boolean. This parameter is always equal to (parameter named autoincInc != 0). In my patch (Derby1327WrongStartKeyPatch1CodelineTrunk.txt) which is attached to this JIRA, I have removed the autoinc parameter and inside the constructors, I use (parameter named autoincInc != 0) instead of relying on autoinc. This cleans up the constructor parameter passing for all the 3 constructors and also brings down the number of parameters to <=10. The test program from the JIRA entry runs fine with this change and I have created a new test JitTest.java based on that test program. Hopefully this test can be a place holder for any future JIT issues. I also ran the test suites and there were no new failures.\r\n\r\nIf the changes looks good, can a committer please commit it? As a cleanup, I also removed the import of org.apache.derby.iapi.sql.dictionary.ColumnDescriptor from some classes which didn't really use ColumnDescriptor.\r\n\r\nsvn stat\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\FromSubquery.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\CallStatementNode.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\UpdateNode.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\FromList.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\InsertNode.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\SubqueryList.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\ResultColumnList.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\WriteCursorConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\GenericResultSetFactory.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\DropSchemaConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\CreateTableConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\CreateViewConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\IndexConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\DropConstraintConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\SetConstraintsConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\InsertConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\DropViewConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\ConstraintConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\DropIndexConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\AlterTableConstantAction.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\catalog\\SYSCOLUMNSRowFactory.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\catalog\\DataDictionaryImpl.java\r\nM java\\engine\\org\\apache\\derby\\impl\\sql\\catalog\\SYSFILESRowFactory.java\r\nM java\\engine\\org\\apache\\derby\\iapi\\sql\\conn\\LanguageConnectionContext.java\r\nM java\\engine\\org\\apache\\derby\\iapi\\sql\\dictionary\\ColumnDescriptor.java\r\nA java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\lang\\JitTest.java\r\nA java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\JitTest.out\r\nM java\\testing\\org\\apache\\derbyTesting\\functionTests\\suites\\derbylang.runall\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-06-08T22:47:18.000+0000","updated":"2006-06-08T22:47:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415369","id":"12415369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"BTW, the patch, Derby1327WrongStartKeyPatch1CodelineTrunk.txt is for the main codeline. If it looks good and there are no comments on it, I can submit similar patch for 10.1 codeline as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-06-08T22:49:35.000+0000","updated":"2006-06-08T22:49:35.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415458","id":"12415458","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bandaram","name":"bandaram","emailAddress":"bandaram at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Satheesh Bandaram","active":true},"body":"I was reviewing this change and I noticed we are moving this:\r\n\r\n-\t\t/* NOTE: We use the autoincColumn variable in order to work around \r\n-\t\t * a 1.3.0 HotSpot bug.  (#4361550)\r\n-\t\t */\r\n-\t\tboolean autoincColumn = (autoincInc != 0); \r\n\r\nDoes anyone know if this \"HotSpot\" bug is still an issue and any issues caused by removing this code?\r\n\r\nNoticed this code has been there since 10.0... so likely came from before code contribution.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bandaram","name":"bandaram","emailAddress":"bandaram at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Satheesh Bandaram","active":true},"created":"2006-06-09T07:44:18.000+0000","updated":"2006-06-09T07:44:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415460","id":"12415460","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"While working on this, I tried looking up the number 4361550 on Sun's website and got only one hit(http://sunsolve.sun.com/search/document.do?assetkey=1-1-4361550-1), which I could not access because I don't have SunSolve technical support id.  \r\n\r\nThe code that I am removing was first added in Cloudscape in August 2000 for 1.3.0 HotSpot bug which we don't support any more(I think). So, I am hoping my code change will not have any regression.\r\n \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-06-09T07:59:36.000+0000","updated":"2006-06-09T07:59:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415463","id":"12415463","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hopefully it is safe to assume that any hot spot bug from 1.3.0, August  2000 has been rectified in the currently supported  JDK 1.3.1.\r\nI think running the new test  with Sun JDK 1.3.1 would  be good verification. Beyojnd that unless someone has access and wants to look this up I don't think we need to keep that code.\r\n\r\nKind of ironic that cleaning up a workaround to fix  one JIT bug, fixed another JIT bug.\r\n\r\nKathey\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-06-09T09:35:07.000+0000","updated":"2006-06-09T09:35:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415491","id":"12415491","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I ran the new test JitTest.java with Sun JDK 1.3.1 and it ran fine. I have also started derbyall run with Sun JDK 1.3.1 and so far no failures. This is all on main codeline.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-06-09T13:11:37.000+0000","updated":"2006-06-09T13:11:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415563","id":"12415563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Sun JDK 1.3.1 run on derbyall finished on my codeline with no new failures. So, if there are no further comments, can a committer please commit this patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-06-09T23:12:19.000+0000","updated":"2006-06-09T23:12:19.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415583","id":"12415583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"On the test JitTest.java I am concerned with the time that it takes.  It took 6 minutes.\r\n I think creating 200 tables would  be more than sufficient in this case and bring it down to 2. Ok if I make that small edit before checking in?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-06-10T00:38:49.000+0000","updated":"2006-06-10T00:38:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415584","id":"12415584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Sure, Kathey, go ahead and make that change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-06-10T00:50:18.000+0000","updated":"2006-06-10T00:50:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415607","id":"12415607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Committed this to trunk.  I reduced some superfluous before and after commit  checking  and reduced the  test output to speed things up so JitTest runs in under 1:30. \r\n\r\nDate: Fri Jun  9 12:23:47 2006\r\nNew Revision: 413129\r\n\r\nURL: http://svn.apache.org/viewvc?rev=413129&view=rev\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-06-10T03:03:40.000+0000","updated":"2006-06-10T03:03:40.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415696","id":"12415696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I am attaching the patch for 10.1 codeline after doing a merge from main and hand fixing some of the conflicts. (The derbyall test suite ran fine with jdk13)\r\nsvn merge -r 413128:413129 https://svn.apache.org/repos/asf/db/derby/code/trunk/\r\n\r\nOne thing to note though is that in 10.1 codeline, the number of parameters to ColumnDescriptor constructors are 10 and not >10. So, from the bug diagnosis as mentioned in this JIRA entry, the bug should not have manifested in 10.1 codeline (the main codeline does have ColumnDscriptor constructor with >10 parameters). \r\n\r\nSo, I am attaching the svn diff and svn stat for 10.1 codeline since it cleans up parameter passing to ColumnDescriptor but further investigation is required to see why the test program in JIRA fails on 10.1 codeline if it is supposed to fail only if the number of parameters are >10.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-06-11T01:15:38.000+0000","updated":"2006-06-11T01:15:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415703","id":"12415703","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks Mamta!\r\n\r\nI commtted this patch:\r\nDate: Sat Jun 10 12:10:35 2006\r\nNew Revision: 413354\r\nURL: http://svn.apache.org/viewvc?rev=413354&view=rev\r\n\r\nI manually merged the test which did not seem to merge properly.  Please check it.\r\n\r\nI re-verified that the issue reproduced on the reported version without the patch.\r\nThen I verified that it did not reproduce  with this patch, but it is indeed not clear why the issue manifested itself in 10.1 based on the JVM bug description which says you must have > 10 parameters.\r\n\r\nEven though the symptom is eleviated I think we should leave this issue unresolved until we have a better understanding of the JIT bug and  why it manifested itself in 10.1 in the first place and determine if this is a reliable resolution to the issue.\r\n\r\nI will  update this issue once the mystery is solved.  \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-06-11T02:17:25.000+0000","updated":"2006-06-11T02:17:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12415801","id":"12415801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Taking off Patch Available as this has been committed to trunk and 10.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-06-12T09:21:20.000+0000","updated":"2006-06-12T09:21:20.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12416072","id":"12416072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I confirmed with the released IBM JDK Service release 2 that this issue does reproduce without Mamta's change and was fixed afterward.   I am awaiting clarification on what is the minimum number of parameters to trigger the JVM bug but since this is a compile time issue I think that Mamta's fix is enough to resolve DERBY-1327 in both trunk and 10.1 as I do not think there are any runtime configurations that could cause different behaviour.  Below is a summary of this issue from a user perspective.\r\n\r\n\r\nPROBLEM\r\n\r\nAfter creating a table, with JIT engaged, identity column start with values for any column in the database gets changed to an incorrect value.\r\n\r\nSYMPTOM\r\n\r\nThe symptom is typically that an insert to the table will fail with the Exception:\r\nSQLSTATE 22001: \"A truncation error was encountered trying to shrink ... to length 12.\"\r\n\r\nCAUSE\r\nA JIT issue in IBM JDK 1.5 Service Release 2 can cause corruption of the start with value.  The affected version is:\r\njava version \"1.5.0\"\r\nJava(TM) 2 Runtime Environment, Standard Edition (build pwi32dev-20060511 (SR2))\r\nIBM J9 VM (build 2.3, J2RE 1.5.0 IBM J9 2.3 Windows XP x86-32 j9vmwi3223-20060504 (JIT enabled)\r\nJ9VM - 20060501_06428_lHdSMR\r\nJIT  - 20060428_1800_r8\r\nGC   - 20060501_AA)\r\nJCL  - 20060511a\r\n\r\nSOLUTION:\r\n\r\nA fix to resolve the Derby symptom is available in 10.1 builds after 10.1.2.5.413354 and will be included in the Derby 10.1.3.0 release.  \r\n\r\nOnce corruption has occurred there is no way in 10.1 to correct the START WITH value.   The only way to recover date is to recreate the database and use export/import to transfer the data.\r\n\r\nWORKAROUND:\r\nIf  users wish to wait  for the 10.1.3.0 official release,  The following JIT options can be specified for the JVM to prevent corruption in identity columns but this does allow recovery after the problem has occured.\r\n\r\n-Xjit:exclude={org/apache/derby/impl/sql/execute/CreateTableCon\r\nstantAction.executeConstantAction\\(Lorg/apache/derby/iapi/sql/Ac\r\ntivation\\;\\)V}\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-06-14T03:25:31.000+0000","updated":"2006-06-14T03:25:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12418739","id":"12418739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Verified fix","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-07-01T07:29:28.000+0000","updated":"2006-07-01T07:29:28.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12421888","id":"12421888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"The core JVM  issue can be tracked with  IBM APAR APAR number  IY86935. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-07-18T15:35:44.000+0000","updated":"2006-07-18T15:35:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12343095/comment/12424398","id":"12424398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"APAR link for tracking:\r\nhttp://www-1.ibm.com/support/docview.wss?uid=swg1IY86935","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-07-30T16:21:46.000+0000","updated":"2006-07-30T16:21:46.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1327/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07aif:"}}