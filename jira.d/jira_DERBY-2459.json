{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12365097","self":"https://issues.apache.org/jira/rest/api/latest/issue/12365097","key":"DERBY-2459","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-03-16 15:22:17.982","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23062","customfield_12310222":"1_*:*_1_*:*_7017927104_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-06-05T16:05:26.526+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2459/watchers","watchCount":1,"isWatching":false},"created":"2007-03-16T10:39:59.422+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12311972","id":"12311972","description":"","name":"10.1.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312027","id":"12312027","description":"","name":"10.2.2.0","archived":false,"released":true,"releaseDate":"2006-12-19"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312251","id":"12312251","description":"Head of 10.2 branch","name":"10.2.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12316137","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12316137","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12350104","key":"DERBY-1861","self":"https://issues.apache.org/jira/rest/api/2/issue/12350104","fields":{"summary":"Column ordering ASSERT when combining column references and expressions in same ORDER BY","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:49:58.033+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"When an order by clause involves a CASE-expression as seen below, a NullPointerException is thrown. The error only occurs when two select statements are combined in a union (or union all).\n\nselect t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\nfrom A1 t1\nleft outer join B1 t2 ON t2.id = t1.ref\n\nunion all\n\nselect t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\nfrom A2 t1\nleft outer join B2 t2 ON t2.id = t1.ref\n\norder by CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\n\n\n--Use the following statement to reproduce the problem:\n\ncreate table A1\n(\n   id char(1)\n  ,value int\n  ,ref char(1)\n);\n\ncreate table A2\n(\n   id char(1)\n  ,value int\n  ,ref char(1)\n);\n\ncreate table B1\n(\n   id char(1)\n  ,value int\n);\n\ncreate table B2\n(\n   id char(1)\n  ,value int\n);\n\n\ninsert into A1 (id, value, ref) values ('a', 12, 'e');\ninsert into A1 (id, value, ref) values ('b', 1, null);\ninsert into A2 (id, value, ref) values ('c', 3, 'g');\ninsert into A2 (id, value, ref) values ('d', 8, null);\n\ninsert into B1 (id, value) values ('e', 4);\ninsert into B1 (id, value) values ('f', 2);\ninsert into B2 (id, value) values ('g', 5);\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37470","summary":"Ordering on a CASE-expression casues a NullPointerException when using a UNION","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gramark","name":"gramark","emailAddress":"lars at stickybit dot se","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Gråmark","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gramark","name":"gramark","emailAddress":"lars at stickybit dot se","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lars Gråmark","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Java 1.5.0_06-b05 on Linux Ubuntu 5.10. Derby version 10.2.2","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":18,"total":18,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12481648","id":"12481648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"I confirmed this bug with ibm142 against the latest trunk with the following stack trace:\r\n\r\njava.lang.NullPointerException\r\n\tat org.apache.derby.impl.sql.compile.OrderByColumn.bindOrderByColumn(OrderByColumn.java:179)\r\n\tat org.apache.derby.impl.sql.compile.OrderByList.bindOrderByColumns(OrderByList.java:153)\r\n\tat org.apache.derby.impl.sql.compile.CursorNode.bindStatement(CursorNode.java:266)\r\n\tat org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:314)\r\n\tat org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88)\r\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:741)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:567)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:516)\r\n\tat org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:320)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:516)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:369)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:267)\r\n\tat org.apache.derby.impl.tools.ij.Main.go(Main.java:203)\r\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)\r\n\tat org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56)\r\n\tat org.apache.derby.tools.ij.main(ij.java:71)\r\n\r\nI also ran it against 10.1 and the same problem occurs there.  So I'm adding a couple of entries to the \"Affects version\" box.\r\n\r\nThank you for filing this issue, Lars.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-03-16T15:22:17.982+0000","updated":"2007-03-16T15:22:17.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12498378","id":"12498378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"In the problem description, the CASE expression in the ORDER BY clause\r\nis identical to the CASE expression in each of the SELECT statements in\r\nthe child table expressions of the UNION.\r\n\r\nThe problem also occurs even if the CASE expression in the ORDER BY clause\r\nis unique: for example, replacing the ORDER BY clause in the description by\r\n  order by CASE WHEN t2.value IS NOT NULL THEN t1.id ELSE t1.ref END\r\nstill results in the NPE.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-23T21:19:34.278+0000","updated":"2007-05-23T21:19:34.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12498379","id":"12498379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"This issue, like DERBY-1861, involves \"pull up\" processing, so I'm marking the two issues as related. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-23T21:20:25.564+0000","updated":"2007-05-23T21:20:25.564+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12498387","id":"12498387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Here's a brief narrative description of how things end up going wrong:\r\n\r\n1) We are in CursorNode.bindStatement.\r\n2) We perform \"pull up\" processing (see the DERBY-1861 writeup for background info)\r\nto pull up the ORDER BY column into the result set, since the ORDER BY clause\r\nneither specifies a simple column reference to a column already in the result set,\r\nnor specifies a result column by column number. So we add a new virtual column\r\nto the UnionNode's resultColumnList, causing it to have 3 columns.\r\n3) Then CursorNode.bindStatement calls resultSet.bindResultColumns, which\r\nends up calling SetOperatorNode.buildRCL. This method simply discards the\r\nresultColumnList from the UnionNode and replaces it by the resultColumnList of\r\nthe UnionNode's left child. This processing is intended to handle the situation\r\nin which we had a SELECT * as one of the UnionNode's children, and the * has\r\nnow been replaced by the table's actual column list.\r\n\r\nBut now the data structures are inconsistent: the OrderByColumn thinks that it\r\nwill be ResultColumn 3, but the UnionNode thinks that the ResultColumnList\r\nhas only 2 ResultColumns.\r\n\r\nA few steps later, CursorNode.bindStatement ends up calling OrderByColumn.\r\nbindOrderByColumn, and it stumbles over the inconsistent data structures,\r\ncomputes a NULL value for the resultColumn field of the OrderByColumn (since there\r\nis no 3rd column in the ResultColumnList anymore), and gets a NPE.\r\n\r\nI'll have to think a bit more about how to fix this, but I wanted to get the\r\nnarrative description down to preserve it.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-23T21:37:18.822+0000","updated":"2007-05-23T21:37:18.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12499195","id":"12499195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Three possible strategies to investigate, to start with:\r\n\r\n1) Defer pull-up processing to later in CursorNode.bindStatement,\r\nas was discussed (but not implemented) in DERBY-1861. As Army\r\nnoted in DERBY-1861, it's not obvious why pull-up processing was\r\npositioned so early in bind processing.\r\n2) Modify pull-up processing so that when it pulls a result column\r\ninto the RCL of a UnionNode, it also pulls that column into the\r\nUnionNode's children (possibly recursively?)\r\n3) Modify SetOperatorNode.buildRCL so that, rather than entirely\r\nreplacing the UnionNode's RCL with its left child's, it instead\r\nmerges the two RCL's, retaining the pulled-up columns but\r\nreplacing the other columns with those of the left child.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-25T18:24:14.615+0000","updated":"2007-05-25T18:24:14.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12499315","id":"12499315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Pursuing option #2 has advanced me to a point where I now get\r\nthrough all of bind and optimize processing, and crash in generate\r\nprocessing. I'm not sure if this is still a problem with the basic data\r\nstructures, or if it's just the case that OrderByList.generate has never\r\nbeen called with a CASE expression before. I suspect that I've still\r\ngot a problem with bind processing, because the ColumnReference\r\ninformation in the OrderByColumn seems to be wrong. I think the\r\nColRef in the ORDER BY's CASE statement didn't get bound to the\r\nunderlying result column properly. Here's a snip of the\r\nnew stack trace I'm looking at:\r\n\r\norg.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED sourceResultSetNumber expected to be >= 0 for T2.VALUE\r\n    at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162)\r\n    at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147)\r\n    at org.apache.derby.impl.sql.compile.ColumnReference.generateExpression(ColumnReference.java:951)\r\n    at org.apache.derby.impl.sql.compile.UnaryOperatorNode.generateExpression(UnaryOperatorNode.java:682)\r\n    at org.apache.derby.impl.sql.compile.NotNode.generateExpression(NotNode.java:116)\r\n    at org.apache.derby.impl.sql.compile.ConditionalNode.generateExpression(ConditionalNode.java:678)\r\n    at org.apache.derby.impl.sql.compile.ResultColumn.generateExpression(ResultColumn.java:891)\r\n    at org.apache.derby.impl.sql.compile.ResultColumnList.generateCore(ResultColumnList.java:1177)\r\n    at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1515)\r\n    at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302)\r\n    at org.apache.derby.impl.sql.compile.UnionNode.generate(UnionNode.java:589)\r\n    at org.apache.derby.impl.sql.compile.OrderByList.generate(OrderByList.java:402)\r\n    at org.apache.derby.impl.sql.compile.OrderByNode.generate(OrderByNode.java:155)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-26T14:45:33.709+0000","updated":"2007-05-26T14:45:33.709+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12499408","id":"12499408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I've been staring at the SELECT statement for a while and found that I'm\r\nwholly confused by what it's supposed to mean. Here it is again, from the\r\noriginal description:\r\n\r\n   select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n                from A1 t1 left outer join B1 t2 ON t2.id = t1.ref\r\nunion all\r\n   select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n               from A2 t1 left outer join B2 t2 ON t2.id = t1.ref\r\norder by CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END \r\n\r\nWhat is the ORDER BY supposed to apply to? I can see two possibilities:\r\n1) It's supposed to order 1 or both of the intermediate SELECT statements. But\r\n    that doesn't make any sense; the order of intermediate results is both\r\n    irrelevant and undefined.\r\n2) It's supposed to order the final results, those that come out of the UNION. But\r\n    this is confusing to me, because by the time we get to the UNION, there aren't\r\n    tables \"t1\" and \"t2\" anymore. Those tables have disappeared during the\r\n    underlying SELECT join processing and all that's left at the time of the UNION\r\n   processing is the collecting together of the rows from the child result sets.\r\n\r\nFor the case expressions in the underlying SELECT statements, it's quite clear\r\nwhat \"t2.value\" and \"t1.value\" are supposed to apply to, as there is a clear\r\ndefinition of \"t2\" and \"t1\" in those clauses. But in the UNION part of the statement,\r\nwhat do we mean by \"t2\" and \"t1\"?\r\n\r\nIs this statement supposed to be legal? If so, how does it work on other database\r\nsystems? Does anyone have access to another DBMS implementation to test\r\nhow this statement behaves there?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-27T15:42:34.772+0000","updated":"2007-05-27T15:42:34.772+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12499411","id":"12499411","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"In the original statement, \"ORDER BY 2\" seems clear and\r\nunambiguous. Furthermore, it works. That, at least, should\r\nprovide a workaround while we attempt to determine how the\r\nORDER BY CASE... form was intended to behave.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-27T16:23:21.775+0000","updated":"2007-05-27T16:23:21.775+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12499430","id":"12499430","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I don't know whether ORDER BY CASE ...\r\nwould be legal if the CASE expression mentioned only unqualified\r\ncolumn names which appeared in the left-most UNION child's result set.\r\n\r\nMy opinion at this point is that the only things that should be legal for an\r\nORDER BY clause on a UNION is either simple unqualified column\r\nreferences which refer to columns in the leftmost chlid's result set, or\r\ncolumn position numbers.\r\n\r\nI'll look into building a patch which implements those semantics.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-27T18:52:48.443+0000","updated":"2007-05-27T18:52:48.443+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12499618","id":"12499618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is rejectquery.diff, a patch proposal. This patch includes\r\na 2-line change to OrderByColumn to reject the query in the description.\r\nThe patch also includes a number of test cases which verify that the\r\nquery as stated fails as expected, some other similar queries are\r\nrejected, but also that ORDER BY 2 can be used to order the rows correctly.\r\n\r\nPlease let me know what you think of this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-28T18:43:01.220+0000","updated":"2007-05-28T18:43:01.220+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12499888","id":"12499888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"> Is this statement supposed to be legal? If so, how does it work on other database systems? Does anyone\r\n> have access to another DBMS implementation to test how this statement behaves there? \r\n\r\nI tried it out against DB2 v8 and it failed:\r\n\r\n  SQL0197N  A qualified column name is not allowed in the ORDER BY clause.\r\n  SQLSTATE=42877\r\n\r\nWhen I replaced the ORDER BY clause with \"ORDER BY 2\", it succeeded:\r\n\r\nID 2\r\n-- -----------\r\nb            1\r\na            4\r\nc            5\r\nd            8\r\n\r\n  4 record(s) selected.\r\n\r\n> My opinion at this point is that the only things that should be legal for an ORDER BY clause on\r\n> a UNION is either simple unqualified column references which refer to columns in the leftmost\r\n> chlid's result set, or column position numbers. \r\n\r\nSeems at a glance to agree with the above results, for what it's worth.  That said, I wonder if it might be better to change the patch so that instead of throwing \"LANG_ORDER_BY_COLUMN_NOT_FOUND\", we throw \"LANG_QUALIFIED_COLUMN_NAME_NOT_ALLOWED\"...Or would it be too difficult to catch that specific scenario?  One thing that confuses me about the new test cases in your patch is the following:\r\n\r\n+ij> -- should fail, because the union's results can't be referenced this way\r\n+select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n+from d2459_A1 t1 left outer join d2459_B1 t2 ON t2.id = t1.ref\r\n+union all\r\n+select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n+from d2459_A2 t1 left outer join d2459_B2 t2 ON t2.id = t1.ref\r\n+order by CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END;\r\n+ERROR 42X78: Column '3' is not in the result of the query expression.\r\n\r\nIt's not immediately clear to me where \"Column '3'\" is coming from here?  Is that a pulled-up column?  If so, is a user going to be confused by this particular error message?\r\n\r\nAlso, the following query does currently work and continues to work with your patch, which is good:\r\n\r\n  select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n  from A2 t1\r\n    left outer join B2 t2 ON t2.id = t1.ref\r\n  order by CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END \r\n\r\nDo you think it would be worth it to add this to the test cases in rejectquery.diff, just for sanity...?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-05-29T18:51:37.117+0000","updated":"2007-05-29T18:51:37.117+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12499892","id":"12499892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Army for the review and suggestions! I agree that the current error\r\nmessage is confusing, and I like your suggestion. I'll work on throwing a\r\nbetter error message, and add the other test case you suggested, and\r\nre-submit the patch anon.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-29T19:06:57.092+0000","updated":"2007-05-29T19:06:57.092+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12500021","id":"12500021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"rejectquery_v2.diff contains a new error message, hopefully\r\nmore helpful for this circumstance, and also adds an additional\r\ntest case to show that ORDER BY expressions are still valid\r\non simple SELECT statements, just not on SELECT UNIONs.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-30T04:39:30.754+0000","updated":"2007-05-30T04:39:30.754+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12500185","id":"12500185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thank you for the follow-up patch, Bryan.  Is there any reason you chose to use a new error message instead of the existing LANG_QUALIFIED_COLUMN_NAME_NOT_ALLOWED (42877) error?  Is this just for the sake of clarity?\r\n\r\nNote that one of the test cases already returns 42877:\r\n\r\n+ij> -- should fail, because qualified column references can't refer to UNIONs\r\n+select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n+from d2459_A1 t1 left outer join d2459_B1 t2 ON t2.id = t1.ref\r\n+union all\r\n+select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n+from d2459_A2 t1 left outer join d2459_B2 t2 ON t2.id = t1.ref\r\n+order by t1.id;\r\n+ERROR 42877: A qualified column name 'T1.ID' is not allowed in the ORDER BY clause.\r\n\r\nwhich seems like an appropriate error message for the 42878 case, as well?  Of course, we'll also get this error if no qualified names are present:\r\n\r\n  select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n  from A1 t1\r\n    left outer join B1 t2 ON t2.id = t1.ref\r\n\r\n  union all\r\n\r\n  select t1.id, CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END\r\n  from A2 t1\r\n    left outer join B2 t2 ON t2.id = t1.ref\r\n\r\n  order by CASE WHEN id IS NOT NULL THEN id ELSE 2 END \r\n\r\nso maybe 42877 isn't entirely appropriate either.  Hmm....\r\n\r\nI wonder if what we're trying to say here is that CASE statements as a whole are not allowed in an ORDER BY clause?  I.e. is there *any* form of CASE statement in an ORDER that would (and should) actually work?  Or should we be throwing a more generic message saying something along the lines of \"Invalid ORDER BY expression.\"\r\n\r\nOn a different note, I wonder if mentioning \"the target list of the first SELECT in the UNION\" is too implementation-specific.  This seems to correlate to the fact that Derby uses the RCL of the left child as the RCL of the UNION node.  But that's an implementation decision; from a user perspective I think we're just talking about the RCL of the UNION node itself.  As an example, take the following:\r\n\r\nij> select i from tx1 union select j from tx2 order by i;\r\nERROR 42X78: Column 'I' is not in the result of the query expression.\r\n\r\nIn this case \"i\" is in fact \"an unqualified name referring to the target list of the first SELECT in the UNION\"--but the query still throws an error.  The reason is that the second SELECT has a different name, which means the RCL of the UNION has a generated name \"1\".  So if the user wants to do an order by, s/he must specify the target column of the *UNION*'s RCL, which may or may not match the target list of the first SELECT in the UNION.\r\nSorry if all of this is being too picky; I'm just sort of dumping my thoughts here.  I hope I'm not discouraging or otherwise overwhelming you with this feedback.  When it comes down to it the error message that you have proposed is far better than an NPE, so if you just want to commit the patch as it is, I wouldn't complain...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-05-30T16:33:31.425+0000","updated":"2007-05-30T16:33:31.425+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12500272","id":"12500272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Army, thank you very much for continuing the discussion. I don't think this is\r\ntoo picky; I think there is a lot to learn here.\r\n\r\nI didn't use 42877 as the error message because it required a column \"name\" as\r\nan argument, and for\r\n  ORDER BY CASE WHEN t2.value IS NOT NULL THEN t2.value ELSE t1.value END \r\nI'm not sure what to use as the \"name\". At the point that the error is detected,\r\nall we have is an OrderByColumn instance with a pointer to a ConditionalNode\r\ninstance which represents the entire CASE expression, and there is nothing like\r\na column name anywhere close at hand.\r\n\r\nI believe that with the current implementation, CASE expressions as a whole are\r\nnot allowed in the ORDER BY clause of a *UNION* select. CASE expressions seem\r\nto work correctly for a non-UNION select. I believe that Derby's current behavior\r\nhere is too restrictive; I think that there are valid CASE expressions for a UNION\r\nselect that *ought* to work (such as the one you propose in your comment, which\r\nuses only unqualified column references to valid columns in the UNION's target\r\nlist),  but the current implementation is lacking. I'm not sure\r\nhow hard this would be to fix. For the time being, as you suggest, issuing a\r\ncomprehensible error message which reflects reality accurately seems far\r\npreferable to crashing with an NPE.\r\n\r\nI am somewhat surprised at the results that you found for\r\n   select i from tx1 union select j from tx2 order by i; \r\nI expected that would work, which is why I worded the message that way.\r\nBut I can see the logic of the \"column names are present in the UNION only\r\nif they match precisely in all UNION children\" behavior.\r\n\r\nYou've pointed out several excellent additional test cases for this area, so I think\r\nthe next step for me is to add more test cases to the patch, and to work on\r\nre-wording the error message to try to more accurately describe the current\r\nbehavior and its restrictions. Let me give that a go.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-05-31T02:05:20.170+0000","updated":"2007-05-31T02:05:20.170+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12500972","id":"12500972","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is rejectQuery_v3.diff:\r\n\r\n1) I updated the message to try to make it more clear that\r\nthe error involves an implementation restriction, not necessarily\r\na syntax error on the part of the user. \r\n\r\n2) I added a number of additional test cases, to try to explore\r\nmore areas of what is and isn't supported, including several\r\ntest cases suggested by Army in previous comments, and\r\nseveral more related ones that occurred to me as I was thinking.\r\n\r\nMy current feeling is that there is a definite implementation\r\nrestriction here: there are syntactically valid expressions that\r\nwhich Derby does not currently support, due to the way that\r\nthe result set of the UNION node is managed.\r\n\r\nBut I also feel that issuing a clear error message is preferable\r\nto failing with an NPE, so I think that this patch is an improvement\r\nover the current behavior.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-06-02T22:42:27.626+0000","updated":"2007-06-02T22:42:27.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12501255","id":"12501255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"The new error message looks good to me, and the extensive test cases are great.  Thank you for your patience with my feedback, Bryan.\r\n\r\n+1 to commit from me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-06-04T16:16:12.544+0000","updated":"2007-06-04T16:16:12.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365097/comment/12501603","id":"12501603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks again for the reviews, Army! I committed the patch to\r\nsubversion as revision 544532. \r\n\r\nI think this change could be moved to prior release branches\r\nin a straightforward fashion. However, I do not intend to do\r\nthat at this time.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-06-05T16:05:26.487+0000","updated":"2007-06-05T16:05:26.487+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2459/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06rzz:"}}