{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12462782","self":"https://issues.apache.org/jira/rest/api/latest/issue/12462782","key":"CASSANDRA-1014","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315199","id":"12315199","description":"","name":"0.7.1","archived":false,"released":true,"releaseDate":"2011-02-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12310220":"2010-04-22 16:37:54.118","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"10002_*:*_1_*:*_1188355541_*|*_1_*:*_2_*:*_19920230761_*|*_5_*:*_1_*:*_0","customfield_12310420":"19957","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-12-22T23:48:35.048+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1014/watchers","watchCount":19,"isWatching":false},"created":"2010-04-22T16:18:48.746+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12332424","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12332424","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12466573","key":"CASSANDRA-1177","self":"https://issues.apache.org/jira/rest/api/2/issue/12466573","fields":{"summary":"OutOfMemory on heavy inserts","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-12-22T23:48:35.035+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"There appears to be a GC issue due to memory pressure in the 0.6 branch.  You can see this by starting the server and performing many inserts.  Quickly the jvm will consume most of its heap, and pauses for stop-the-world GC will begin.  With verbose GC turned on, this can be observed as follows:\r\n\r\n[GC [ParNew (promotion failed): 79703K->79703K(84544K), 0.0622980 secs][CMS[CMS-concurrent-mark: 3.678/5.031 secs] [Times: user=10.35 sys=4.22, real=5.03 secs]\r\n (concurrent mode failure): 944529K->492222K(963392K), 2.8264480 secs] 990745K->492222K(1047936K), 2.8890500 secs] [Times: user=2.90 sys=0.04, real=2.90 secs]\r\n\r\nAfter enough inserts (around 75-100 million) the server will GC storm and then OOM.\r\n\r\njbellis and I narrowed this down to patch 0001 in CASSANDRA-724.  Switching LBQ with ABQ made no difference, however using batch mode instead of periodic for the commitlog does prevent the issue from occurring.  The attached screenshot shows the heap usage in jconsole first when the issue is exhibiting, a restart, and then the same amount of inserts when it does not.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12442749","id":"12442749","filename":"1014-2Gheap.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-04-24T16:42:09.098+0000","size":92279,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12442749/1014-2Gheap.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12442617","id":"12442617","filename":"1014-commitlog-v2.tar.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-22T20:01:16.048+0000","size":18572,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12442617/1014-commitlog-v2.tar.gz"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12442588","id":"12442588","filename":"1014-table.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-22T16:49:08.231+0000","size":956,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12442588/1014-table.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12442575","id":"12442575","filename":"724-0001.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-04-22T16:19:13.050+0000","size":66407,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12442575/724-0001.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12448014","id":"12448014","filename":"gc2.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xluke","name":"xluke","emailAddress":"xluke at live dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lu Ming","active":true},"created":"2010-06-25T04:36:11.008+0000","size":53427,"mimeType":"image/x-png","content":"https://issues.apache.org/jira/secure/attachment/12448014/gc2.png"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"91831","summary":"GC storming, possible memory leak","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":"debian lenny amd64 OpenJDK 64-Bit Server VM (build 1.6.0_0-b11, mixed mode)\r\n","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":29,"total":29,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12859875","id":"12859875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"patch to split CLES into PeriodicCLES and BatchCLES, and adds an add(LogRecordAdder) method that will handle blocking if necessary.\r\n\r\nBCLES works basically the way it does already, which does not have the garbage problem.\r\n\r\nPCLES attempts to let the garbage get collected earlier by not returning it up two levels to Table.  (It also generates slightly less garbage by using FutureTask directly instead of CheaterFutureTask.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-22T16:37:54.118+0000","updated":"2010-04-22T16:37:54.118+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12859885","id":"12859885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"svn is generating a patch that doesn't work, so splitting it up into the changes to Table as a diff, and the changes to commitlog/ package as a tar","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-22T16:49:08.291+0000","updated":"2010-04-22T16:49:08.291+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12860368","id":"12860368","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Brandon reports that \"I don't think patched cassandra is going to OOM on the 100M inserts, at 77M now and not GC storming, which definitely would happen w/o patches and compaction running like it is,\" however there is still significantly more GC activity in Periodic mode than Batch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-23T20:48:56.728+0000","updated":"2010-04-23T20:48:56.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12860375","id":"12860375","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Confirmed, 100M inserts works with this patch, though CMS still had tons of concurrent mode failures.  18 minutes of GC time on ParNew, 1 hour 26 minutes on CMS.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-04-23T21:13:47.343+0000","updated":"2010-04-23T21:13:47.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12860545","id":"12860545","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"I thought perhaps the heap just needed more breathing room, but here is a screenshot of jconsole on a 2G heap at around 300M inserts... same effect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-04-24T16:42:09.179+0000","updated":"2010-04-24T16:42:09.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12861826","id":"12861826","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"It seems to me that we're decreasing write durability in batch mode by not waiting for the CL to record the mutation.  Is that a good thing?  If so, Table.waitForCommitLog can be removed completely.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-04-28T15:29:19.372+0000","updated":"2010-04-28T15:29:19.372+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12861831","id":"12861831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"we've moved the wait into the add() call, rather than an if statement afterwards","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-28T15:40:55.558+0000","updated":"2010-04-28T15:40:55.558+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12861841","id":"12861841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-04-28T17:08:18.330+0000","updated":"2010-04-28T17:08:18.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12861842","id":"12861842","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"From IRC: \"gdusbabek: +1 on #1014.  (jira appears to be taking a nap).\"\r\n\r\nCommitted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-28T17:08:26.437+0000","updated":"2010-04-28T17:08:26.437+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12870759","id":"12870759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed the best GC options we have so far (thanks to Jacob Kessler) in r947743.  still needs some work so leaving ticket open.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-05-24T18:21:29.366+0000","updated":"2010-05-24T18:21:29.366+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12881213","id":"12881213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcurdt","name":"tcurdt","emailAddress":"tcurdt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Torsten Curdt","active":true},"body":"As discussed on IRC I've force a GC which indeed helped.\r\n\r\n[code]\r\n$>get -b java.lang:type=Memory HeapMemoryUsage\r\n#mbean = java.lang:type=Memory:\r\nHeapMemoryUsage = { \r\n  committed = 919076864;\r\n  init = 268435456;\r\n  max = 1072758784;\r\n  used = 383.973.136;\r\n };\r\n\r\n$>run -b java.lang:type=Memory gc   \r\n#calling operation gc of mbean java.lang:type=Memory\r\n\r\n$>get -b java.lang:type=Memory HeapMemoryUsage\r\n#mbean = java.lang:type=Memory:\r\nHeapMemoryUsage = { \r\n  committed = 919076864;\r\n  init = 268435456;\r\n  max = 1072758784;\r\n  used = 60.719.096;\r\n };\r\n[code]\r\n\r\nSo it looks like we were hitting this with 0.6.2 as well. IIUC this should be fixed in 0.6.3?\r\n\r\nWhat's interesting is that writing through the StorageProxy our cluster is behaving much better. Even without a fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcurdt","name":"tcurdt","emailAddress":"tcurdt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Torsten Curdt","active":true},"created":"2010-06-22T14:30:24.101+0000","updated":"2010-06-22T14:30:24.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12881243","id":"12881243","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Jacob Kessler explains:\r\n\r\nbq. Without the ExplicitGCInvokesConcurrent option, a manually-invoked GC (Anything that calls System.gc(), including the mbean) will invoke a full stop-the-world collection, which has a few different properties in terms of the garbage that it can safely collect than the CMS Cassandra usually uses, i.e. all of it, rather than not collecting things that weren't garbage at the beginning of the sweep.\r\n\r\nbq. Off-hand, though, I'd say that those graphs make it look very much like you have a memory leak. I'd wonder if you end up holding stuff for too long in the commitlog (I don't know what that is, but changing what you do with it seems to change you memory behavior =), possibly waiting for a lull in inserts to write it or something like that? I've definitely seen cases where the pause of a full GC causes things in the program to time out and become garbage, which then at least temporarily solves the problem.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-22T16:43:56.997+0000","updated":"2010-06-22T16:44:21.939+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12881246","id":"12881246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"I did some more thorough testing with batch vs periodic for the commitlog, and the issue still shows up with batch, it just takes longer to manifest due to the slower write speed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-06-22T16:53:08.877+0000","updated":"2010-06-22T16:53:08.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12882438","id":"12882438","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xluke","name":"xluke","emailAddress":"xluke at live dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lu Ming","active":true},"body":"GC Storm of my Cassandra Node\r\n\r\nOur service pause for several seconds every one or two minute's interval.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xluke","name":"xluke","emailAddress":"xluke at live dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lu Ming","active":true},"created":"2010-06-25T04:36:11.126+0000","updated":"2010-06-26T05:30:13.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12882740","id":"12882740","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"This is sounding more and more to me like a bug in CMS, since stop-the-world collections make it go away.  (We're not allocating *that* much during a sweep!)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-25T22:15:12.969+0000","updated":"2010-06-25T22:15:12.969+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12883763","id":"12883763","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Can you test\r\n\r\n-XX:+UseParallelGC -XX:+UseParallelOldGC\r\n\r\ninstead of\r\n\r\n         -XX:+UseConcMarkSweepGC \\\r\n         -XX:+CMSParallelRemarkEnabled \\\r\n\r\n?\r\n\r\npause time for the former is expected to suck but it should demonstrate whether we are running into a CMS bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-30T02:00:17.214+0000","updated":"2010-06-30T02:00:17.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12884357","id":"12884357","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Tried that, and also tried the experimental G1 collector.  Neither help.  I had a hunch maybe disabling mmap would help, but unfortunately that didn't pan out either.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-01T17:22:39.838+0000","updated":"2010-07-01T17:22:39.838+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12887517","id":"12887517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"body":"i had some issues like this until i added the following :\r\n\r\n        -XX:CMSInitiatingOccupancyFraction=88\r\n\r\nwhich causes the parallel GC to kick in sooner, if i understand correctly.  in my case, this is good enough so i do not have periodic freezes because of full on GC\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"created":"2010-07-12T20:49:32.323+0000","updated":"2010-07-12T20:49:32.323+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12887566","id":"12887566","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I thought the default CMSInitiatingOccupancyFraction is around 70, so that would make it *later*\r\n\r\nbut the real problem in this issue is that CMS seems to \"leak\" memory under a write workload, but STW collection does collect it","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-12T22:24:19.462+0000","updated":"2010-07-12T22:24:19.462+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12890347","id":"12890347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"To summarize the current status since there's a lot of noise in this ticket:\r\n\r\nWith a 1GB heap and constant inserts, the server will begin to GC storm around the 100M row mark, and eventually OOM.  Increasing the heap size doesn't help, it just takes longer to reproduce.  The old gen continues to slowly grow until it's full and can't keep up.  If you stop the inserts and force a STW GC, memory usage returns to normal.  If you analyze a heap dump in MAT, it's not very helpful, most of the heap will be used by 'other' and tracing the GC roots of those objects is fruitless.  Using other collectors doesn't improve the situation, ParOld and G1 both produce the same behavior.  The GC options committed earlier in this ticket helped, but did not solve the situation.   Using either batch or periodic mode doesn't matter, though batch takes longer to exhibit the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-20T17:46:48.219+0000","updated":"2010-07-20T17:46:48.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12890442","id":"12890442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcurdt","name":"tcurdt","emailAddress":"tcurdt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Torsten Curdt","active":true},"body":"Good summary. \r\n\r\nA few more things:\r\n- using the most recent (watch the patch levels!) java6 jvm is crucial and improved the situation (not solved it though)\r\n- inserting row mutation directly through the StorageProxy does NOT seem to cause this behavior. (we have seen much higher throughput and the GC behavior was OK)\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcurdt","name":"tcurdt","emailAddress":"tcurdt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Torsten Curdt","active":true},"created":"2010-07-20T21:01:52.467+0000","updated":"2010-07-20T21:01:52.467+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12890461","id":"12890461","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Torsten,\r\n\r\nHow many rows did you go through with StorageProxy?  I would expect to get further without thrift's garbage overhead, but given enough time, the issue would still occur.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-20T21:33:16.359+0000","updated":"2010-07-20T21:33:16.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12890471","id":"12890471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=danielkluesing_bk","name":"danielkluesing_bk","emailAddress":"dk at bluekai dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Kluesing","active":true},"body":"Just another observation: I have a big nightly import - several hundred million records that come in through the thrift interface - which caused this behavior. For this particular CF, I don't need the level of assurance the commit log provides, we ended up making the commit log configurable on a per-column family basis (with a EnableCommitLog attribute on the CF) . Inserts to that particular column family just skip the commit log. This eliminated the gc thrashing during those imports. Been doing the nightly import for well over a month, no issues.\r\n\r\nI just needed the import to work, and killing the commitlog for CFs that take heavy inserts made the problem go away. it works so I never dug any deeper. \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=danielkluesing_bk","name":"danielkluesing_bk","emailAddress":"dk at bluekai dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Kluesing","active":true},"created":"2010-07-20T21:47:55.727+0000","updated":"2010-07-20T21:47:55.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12890478","id":"12890478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcurdt","name":"tcurdt","emailAddress":"tcurdt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Torsten Curdt","active":true},"body":"Hey Brandon,\r\n\r\nmaybe it does happen after a much longer time. All I can say is that through thrift we hit the wall at around 100M inserts.\r\nThrough the StorageProxy we inserted around 500M much faster and without any issues at all.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tcurdt","name":"tcurdt","emailAddress":"tcurdt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Torsten Curdt","active":true},"created":"2010-07-20T21:59:16.154+0000","updated":"2010-07-20T21:59:16.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12901352","id":"12901352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aeggli","name":"aeggli","emailAddress":"aeggli at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lee Cheng Wei","active":true},"body":"Just reproduced this bug minutes ago, we've inserted 10,000,000 column into a single row for benchmarks, we spent a whole weekend for the inserts, and tried to slice query them out today, the server was fine in beginning queries, and the becoming worse after some large range slice queries like 10,000 columns in the same time.\r\n\r\nWe are using nightly build at 2010-08-12_13-11-16.\r\n\r\nIt looks fine in the weekend according to the system.log, things getting worse after the query.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aeggli","name":"aeggli","emailAddress":"aeggli at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lee Cheng Wei","active":true},"created":"2010-08-23T11:16:01.227+0000","updated":"2010-08-23T11:16:01.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12901402","id":"12901402","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"slicing 10k columns at once inherently uses a lot of memory and is probably not related to this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-08-23T13:54:02.704+0000","updated":"2010-08-23T13:54:02.704+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12901497","id":"12901497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scode","name":"scode","emailAddress":"peter dot schuller at infidyne dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Schuller","active":true},"body":"I have not read anything about this other than what is in this ticket, and the beginnings of this is old, so this may be moot, but a couple of things:\r\n\r\n* The first graph attached (1014-2Gheap.png) looks to me like the JVM is only doing young generation collections and is simply not ever doing a concurrent mark/sweep phase. That would be a VM bug (or broken VM options).\r\n\r\n* Is the 60 mb vs. 368 mb the difference between a CMS full collection and a stop-the-world full collection? I.e., it was 368 right after a full CMS sweep? It need not necessarily indicate a VM bug; consider that CMS's old gen is maintained in a non-compacting/copying fashion and that the CMS old gen is thus susceptible to fragmentation overhead. A full stop-the-world GC also applies, AFAIK, that it does a compacting GC. A factor of 6.1 seems like a lot though, but I don't know about how the CMS free space management works. If the 6.1 is explained by fragmentation, my initial guess would be that large allocations are the triggering factor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scode","name":"scode","emailAddress":"peter dot schuller at infidyne dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Schuller","active":true},"created":"2010-08-23T17:36:25.909+0000","updated":"2010-08-23T17:36:25.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12901528","id":"12901528","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scode","name":"scode","emailAddress":"peter dot schuller at infidyne dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Schuller","active":true},"body":"... and correcting myself I realized that it is unlikely that fragmentation overhead gets reported as \"used\", so my second point is probably bogus.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=scode","name":"scode","emailAddress":"peter dot schuller at infidyne dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Peter Schuller","active":true},"created":"2010-08-23T18:42:31.996+0000","updated":"2010-08-23T18:42:31.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12462782/comment/12974440","id":"12974440","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"There are several problems that can be conflated here:\r\n\r\n- the more writes you do, the larger your memory usage will be for bloom filters and index samples.  This is normal and part of the design\r\n- there have been JVM-level memory leaks.  upgrade to the most recent Sun JDK.\r\n- Cassandra outstrips the JVM's GC capacity.  We can tackle this by reducing the amount of garbage we generate, e.g. with CASSANDRA-1814 and CASSANDRA-1714","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-12-22T23:48:34.973+0000","updated":"2010-12-22T23:48:34.973+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1014/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g2h3:"}}