{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12325220","self":"https://issues.apache.org/jira/rest/api/latest/issue/12325220","key":"DERBY-668","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-11-23 21:48:04.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22083","customfield_12310222":"1_*:*_1_*:*_12079411000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_1037000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-03-22T02:39:37.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-668/watchers","watchCount":0,"isWatching":false},"created":"2005-11-02T07:16:06.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12312185","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12312185","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12327847","key":"DERBY-826","self":"https://issues.apache.org/jira/rest/api/2/issue/12327847","fields":{"summary":"sysinfo does not report the version of derby.jar if the class does not explictly contain it.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12311936","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12311936","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12329522","key":"DERBY-1063","self":"https://issues.apache.org/jira/rest/api/2/issue/12329522","fields":{"summary":"Add new jar file to execute tools/network server with java -jar","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12313052","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12313052","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12332983","key":"DERBY-1273","self":"https://issues.apache.org/jira/rest/api/2/issue/12332983","fields":{"summary":"Sysinfo should print a better  message when it gets Security Exceptions accessing classpath info when run under security manager","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-08-09T06:41:43.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11405","id":"11405","name":"Build tools"}],"timeoriginalestimate":null,"description":"There is a section in the SysInfo tool's output titled \"Derby Information\", which prints location and version information for the major Derby jars. Here is an example of that output:\n\n--------- Derby Information --------\nJRE - JDBC: J2SE 1.4.2 - JDBC 3.0\n[/home/bpendleton/src/derby-subversion/trunk/jars/insane/derby.jar] 10.2.0.0 alpha - (315052M)\n[/home/bpendleton/src/derby-subversion/trunk/jars/insane/derbytools.jar] 10.2.0.0 alpha - (315052M)\n[/home/bpendleton/src/derby-subversion/trunk/jars/insane/derbynet.jar] 10.2.0.0 alpha - (315052M)\n[/home/bpendleton/src/derby-subversion/trunk/jars/insane/derbyclient.jar] 10.2.0.0 alpha - (315052M)\n[/home/bpendleton/downloads/derby/db2jcc/lib/db2jcc.jar] 2.4 - (17)\n[/home/bpendleton/downloads/derby/db2jcc/lib/db2jcc_license_c.jar] 2.4 - (17)\n\nUnfortunately, this tool can be fooled if you arrange for one of these jar files to be loaded from a magic location like $JAVA_HOME/jre/lib/ext.\n\nFor example, I had (accidentally) placed an old version of db2jcc.jar into $JAVA_HOME/jre/lib/ext. When I ran SysInfo, it printed out: \n\n--------- Derby Information --------\nJRE - JDBC: J2SE 1.4.2 - JDBC 3.0\n[/home/bpendleton/src/derby-subversion/trunk/jars/insane/derby.jar] 10.2.0.0 alpha - (315052M)\n[/home/bpendleton/src/derby-subversion/trunk/jars/insane/derbytools.jar] 10.2.0.0 alpha - (315052M)\n[/home/bpendleton/src/derby-subversion/trunk/jars/insane/derbynet.jar] 10.2.0.0 alpha - (315052M)\n[/home/bpendleton/src/derby-subversion/trunk/jars/insane/derbyclient.jar] 10.2.0.0 alpha - (315052M)\n[/home/bpendleton/downloads/derby/db2jcc/lib/db2jcc.jar] 1.0 - (581)\n[/home/bpendleton/downloads/derby/db2jcc/lib/db2jcc_license_c.jar] 1.0 - (581)\n\nHowever, the \"1.0 (581)\" information actually came from $JAVA_HOME/jre/lib/ext/db2jcc.jar, NOT from\n/home/bpendleton/downloads/derby/db2jcc/lib/db2jcc.jar.\n\nIt would be nice if SysInfo could detect the difference between a jar file being loaded via the application class loader using $CLASSPATH, and a jar file being loaded via the system class loader using JDK library extensions.\n\nTo reproduce the problem, simply:\n1) Place an older version of db2jcc.jar into $JAVA_HOME/jre/lib/ext\n2) Place a newer version of db2jcc.jar into your $CLASSPATH\n3) Run SysInfo. You will see that it prints the name of the jarfile from $CLASSPATH, but the version info from the JDK copy.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40453","summary":"SysInfo does not print the right information when Derby is not loaded through the classpath.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":37,"total":37,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12356832","id":"12356832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think that JavaWorld tip 105 can be used here: http://www.javaworld.com/javaworld/javatips/jw-javatip105.html.\r\n\r\nIn particular, I think that the following code, if inserted at the right place, enables the sysinfo utility to do a better job of printing out *exactly* the location where the DB2 JDBC driver was loaded from:\r\n\r\n  this.getClass().getResource(\"/com/ibm/db2/jcc/DB2Driver.class\").getFile()\r\n\r\nWhen I compile and run this code in a standalone Java program, experimenting with various combinations of db2jcc.jar in the classpath versus db2jcc.jar in $JAVA_HOME/jre/lib/ext, the code appears to reliably figure out the actual location from which DB2Driver.class is found.\r\n\r\nSo I think it should be possible to use this code in derby/impl/tools/sysinfo/Main.java to print a better message about the location from which various classes are loaded.\r\n\r\nHowever, I'm getting a little lost trying to figure out sysinfo/Main.java and sysinfo/ZipInfoProperties.java. :(\r\n\r\nIt seems to me like the current SysInfo program basically takes the approach of parsing the CLASSPATH variable and printing out information about the things it finds there.\r\n\r\nThat algorithm works well, except that it is defeated by \"magic\" locations like $JAVA_HOME/jre/lib/ext.\r\n\r\nTherefore, it seems like SysInfo needs to be enhanced to use an additional algorithm like the one I propose above, which is to ask the classloader itself for a file-scheme URL to the actual location of the critical class files, and then to print that information out.\r\n\r\nAnyway, that's as far as I got today, and I wanted to record that investigation so I wouldn't lose it.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-11-05T08:43:25.000+0000","updated":"2005-11-05T08:43:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12356896","id":"12356896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Here is a fix. The fix uses two techniques to detect the case where the DB2Driver class did not come from the expected jar file in the classpath, but rather was loaded from some location (e.g., JAVA_HOME/jre/lib/ext):\r\n\r\n1) Using the JavaWorld Tip 105 technique, we ask the DB2Driver classfile itself for the location from which it was loaded, and we print that location, rather than just assuming that the class was loaded from the db2jcc.jar in the application class path.\r\n2) If the DB2Driver class has a different class loader than the sysinfo Main class's class loader, we print a warning.\r\n\r\nTo see the effects of this patch, you can run the following experiment:\r\na) First, run sysinfo with db2jcc.jar in your classpath as normal.\r\nb) Second, copy db2jcc.jar into JAVA_HOME/jre/lib/ext and re-run sysinfo with the same classpath. Note that it detects where DB2Driver was *really* loaded from, and displays that information.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-11-07T03:35:48.000+0000","updated":"2005-11-07T03:35:48.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358353","id":"12358353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"\r\nHi Brian. \r\n\r\nI'd like to clarify the scope of what you are trying to do with this patch.  Is it only to  correctly  report the location of db2jcc.jar if it is both in the classpath and loaded by a different classloader or should it cover \r\n1) other jars such as derby.jar derbyclient.jar etc..?\r\n2) The case where there is no jar in the classpath at all, but only loaded by a classloader?\r\n\r\nIt seems that if the jar is loaded by the classloader but is not in the classpath it would not report at all, but that perhaps is not the problem you are trying to solve.\r\n\r\n\r\nOn the patch I think the System.out can be removed.  Probably just the odd location reporting would be good enough.  \r\n\r\nI did not  quite understand  this condition\"\r\nif (loc != null && loc.startsWith(\"file:\") && loc.indexOf(\"!\") > 0)\r\nWhat does the occurance of ! mean?\r\n\r\nThanks for looking at this issue.  Having sysinfo properly report jar locations when  jars are not loaded from the classpath is really important.  \r\n\r\n\r\nKathey\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-11-23T21:48:04.000+0000","updated":"2005-11-23T21:48:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358394","id":"12358394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Kathey, thanks for the feedback.\r\n\r\nI think we can make sysinfo do a variety of things; I was treading cautiously because I'm unsure of the requirements.\r\n\r\nThe current implementation in the reportCloudscape() and getAllInfo() methods is basically a \"for each entry in the classpath, print some info about it\", and so I was trying to fit into that implementation without perturbing it very much. Therefore, as you noticed, my change only affects the case where db2jcc.jar is in the classpath but the DB2Driver class turns out to get loaded from some other location. The code that I altered is triggered by finding db2jcc.jar in the classpath.\r\n\r\nIt would be possible to write an alternate implementation, such as the following:\r\n - Construct a list of \"sentinel\" classes, and the jar files that we expect such classes to be loaded from\r\n - For each sentinel class, load it, then look to see from which jar it was loaded.\r\n - Print the information about the jar, and decorate that message in a special way if the class was not loaded from the expected jar.\r\n\r\nIt sort of seems like that is the intent of the useMe() and tryAllClasspaths() methods, which appear to be run only if you pass the \"-cp\" argument to sysinfo (http://db.apache.org/derby/docs/10.1/tools/ctoolssysinfo1002931.html), which I admit I had overlooked.\r\n\r\nI'll take a look at this part of sysinfo, and investigate how I could improve it, as well.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-11-24T02:53:25.000+0000","updated":"2005-11-24T02:53:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358397","id":"12358397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The business about if (loc != null && loc.startsWith(\"file:\") && loc.indexOf(\"!\") > 0)  is as follows:  when we call getResource(x.y.class).getFile(), the string that we get back looks something like:\r\n\r\n  file://path/to/the/jar!x.y.class\r\n\r\nso I'm just checking for a string of that format and sucking the file name out of it.\r\n\r\nI'll add a comment to make that more clear.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-11-24T02:58:05.000+0000","updated":"2005-11-24T02:58:05.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358427","id":"12358427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Kathey,\r\n\r\nI re-worked my patch based on your comments, and I think it is more useful now. I abstracted the code out into a subroutine so that it could be shared, added some comments, and, most importantly, used the code in the \"sysinfo -cp\" code path, where it actually makes a lot more sense and is more useful.\r\n\r\nThe net effect of this patch is:\r\n1) If you run \"sysinfo -cp\" (and any of its variants), sysinfo now reports the actual location where the class was loaded from, in addition to telling you whether or not it loaded the class successfully.\r\n2) If you run just \"sysinfo\", when it is processing the db2jcc.jar file in your classpath, it now reports the actual location where the DB2Driver class was loaded from, which may not be the db2jcc.jar file in your classpath (if you've placed db2jcc.jar somewhere else).\r\n\r\nPlease have a look at this new patch when you get a chance and tell me what you think.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-11-24T07:31:13.000+0000","updated":"2005-11-24T07:31:13.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358867","id":"12358867","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I was thinking I would go ahead and commit this patch since I know it has been sitting for a while, but I ran sysinfo quickly with the patch and even though I have both db2jcc.jar and db2jcc_license_c.jar  in my classpath, sysinfo shows me two db2jcc.jars and no db2jcc_license_c.jar\r\n\r\nWith the patch:\r\n--------- Derby Information --------\r\nJRE - JDBC: J2SE 1.4.2 - JDBC 3.0\r\n[D:\\p4\\marsden_patch\\classes] 10.2.0.0 alpha - (1)\r\n[/D:/p4/marsden_patch/drda/jcc/2.4/db2jcc.jar] 2.4 - (17)\r\n[/D:/p4/marsden_patch/drda/jcc/2.4/db2jcc.jar] 2.4 - (17)\r\n------------------------------------------------------\r\n\r\nWithout the patch:\r\n\r\n--------- Derby Information --------\r\nJRE - JDBC: J2SE 1.4.2 - JDBC 3.0\r\n[D:\\p4\\marsden_patch\\classes] 10.2.0.0 alpha - (1)\r\n[D:\\p4\\marsden_patch\\drda\\jcc\\2.4\\db2jcc.jar] 2.4 - (17)\r\n[D:\\p4\\marsden_patch\\drda\\jcc\\2.4\\db2jcc_license_c.jar] 2.4 - (17)\r\n------------------------------------------------------\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-11-30T12:36:35.000+0000","updated":"2005-11-30T12:36:35.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358869","id":"12358869","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"That's an interesting point. I think that the line in question was rather misleading, though:\r\n\r\n  [/D:/p4/marsden_patch/drda/jcc/2.4/db2jcc.jar] 2.4 - (17) \r\n\r\nThe \"2.4 - (17)\" in this line is printing the results of calling DB2Driver.getMajorVersion() (2),\r\nDB2Driver.getMinorVersion (4), and DB2Driver.getJCCBuildNumber() (17).\r\n\r\nBut, we're calling these methods on the DB2Driver which is in db2jcc.jar! That is, from\r\nwhat I can tell, sysinfo is claiming to report that db2jcc_license_c.jar is version 2.4,\r\nbuild 17, but it's not actually using any information from db2jcc_license_c.jar to derive\r\nthat information.\r\n\r\nI don't know that db2jcc_license_c.jar even has a concept of a version number.\r\nFrom what I can see, it has only a MANIFEST, and a single file, namely \r\ncom.ibm.db2.jcc.licenses.DB2J.\r\n\r\nIs there any documentation available on the DB2J class?\r\n\r\nIt would be easy to alter the proposed patch so that sysinfo reverts back to its\r\ncurrent behavior (that is: print the filename of the db2jcc_license_j jar file, and\r\nthe version information from the DB2Driver which is in the classpath); my question\r\nis: is that really a useful behavior, or is there something more useful that we\r\ncould print about the db2jcc_license_c.jar file specifically?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-11-30T12:58:53.000+0000","updated":"2005-11-30T12:58:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358873","id":"12358873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"There is no special version information for the license file or documentation for the DB2J class. It has never really changed from release to release so version information is not really relevant.    It is very important that it be listed in sysinfo because I would say its absence is the #1 reported reason JCC doesn't work.  It's mere existance seems to be the key.\r\n\r\nAs long as it prints the filename it is fine  for it to print the DB2Driver version or even no version at IMO\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-11-30T13:33:13.000+0000","updated":"2005-11-30T13:33:13.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358973","id":"12358973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Kathey, please consider this most recent patch. I've reverted the handling of db2jcc_license_c.jar back to the pre-patch behavior, to wit: if we find db2jcc_license_c.jar in the classpath, and if we are also able to load some version of the DB2Driver class or the DB2Version class, then we display the db2jcc_license_c.jar file that we found in the classpath, and we also display the version number information that we fetched from DB2Driver/DB2Version.\r\n\r\nHere's a bunch of the various tests I ran; in all the cases, I think that the output of the new SysInfo is correct, but I'd like you to confirm my results, please :)\r\n\r\n1, 2) java -cp derby.jar:derbytools.jar sysinfo [-cp]\r\n3, 4) java -cp derby.jar:derbytools.jar:db2jcc.jar sysinfo [-cp]\r\n5, 6) java -cp derby.jar:derbytools.jar:db2jcc.jar:db2_license_c.jar sysinfo [-cp]\r\n7, 8) java -cp derby.jar:derbytools.jar:db2_license_c.jar sysinfo [-cp]\r\n9, 10) (with db2jcc.jar in $JAVA_HOME/jre/lib/ext), java -cp derby.jar:derbytools.jar:db2_license_c.jar sysinfo [-cp]\r\n\r\nCases (7) and (8) are particularly interesting. Both the current sysinfo, and the one with my patch, print no information about db2jcc_license_c.jar if we cannot load any version of the DB2Driver or DB2Version classes. I think this is reasonable, but I'd like to hear your opinion on this.\r\n\r\nAn alternate implementation would be, as you suggested in your comment, to print a line for db2jcc_license_c.jar in this case, but don't print any version information. I guess I don't know how important this is. In your comment, you noted that the primary user mistake was to have db2jcc.jar, but not db2jcc_license_c.jar, rather than vice-versa, so I don't know if it's worth adding a bunch more code to try to do something useful about the case where we have db2jcc_license_c.jar in the classpath, but NOT db2jcc.jar. Please tell me what you think.\r\n\r\nthanks,\r\n\r\nbryan\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-12-01T07:18:04.000+0000","updated":"2005-12-01T07:18:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12358985","id":"12358985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Hi Bryan,\r\n\r\nI took a look at version 3 of your patch. It looks good, just a couple comments:\r\n\r\n- On Windows you get a leading slash before the drive spec (i.e. /C:/mydir/jars/...).  Might be worth fixing, but it is just a 'polish' issue.\r\n- In test case 9 above, db2jcc_license_c.jar shows up in the output, but db2jcc.jar does not. It does appear as found in testcase 10. This behavior is the same as the current sysinfo. It would be nice if this were fixed, but this could be treated as a separate issue.\r\n- My opinion is that it would be nice to have db2jcc_license_c.jar appear in the output if db2jcc.jar is not present. That can also be fixed as a separate issue, though.\r\n\r\nI also stumbled across some really bizarre behavior (already present - not introduced by your patch), if you put derby.jar or one of the other product jars into the extensions directory, while there are others on the classpath. To see what I mean, try putting just derbynet.jar in the extensions, or putting derby.jar into the extensions dir while you have another on your classpath.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2005-12-01T09:57:07.000+0000","updated":"2005-12-01T09:57:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12359011","id":"12359011","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Andrew, Thanks for reviewing my changes.\r\n\r\nYour point about the Windows file syntax is a really good one, and I think it's worth fixing. Unfortunately, the best thing I've been able to think of so far is the rather crude:\r\n\r\n  // On Windows, file: scheme URLs look like file:/c:/derby/..., so strip that leading slash, too:\r\n  if (loc.length() > 3 && loc.charAt(0) == '/' && Character.isLetter(loc.charAt(1)) && loc.charAt(2) == ':')\r\n      loc = loc.substring(1);\r\n\r\nCan you think of a cleaner way to code this?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-12-01T15:13:41.000+0000","updated":"2005-12-01T15:13:41.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12359096","id":"12359096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Hi Bryan, here's an alternative:\r\n\r\nif (System.getProperty(\"os.name\").startsWith(\"Windows\"))\r\n  loc = loc.substring(1);\r\n\r\nI'll leave it up to you. Your method is just as good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2005-12-02T08:10:35.000+0000","updated":"2005-12-02T08:10:35.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12359101","id":"12359101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Is this code used?\r\n\r\n\r\n+    // Given a loaded class, and the name by which we loaded that class, this\r\n+    // routine asks the class's class loader for information about where the\r\n+    // class was loaded from. Typically, this is a file, which might be\r\n+    // either a class file or a jar file. The routine figures that out, and\r\n+    // returns the name of the file. If it can't figure it out, it returns null\r\n+    private static String getFileWhichLoadedClass(Class c, String cName)\r\n+    {\r\n+        String className = \"/\" + cName.replace('.', '/') + \".class\";\r\n+        java.net.URL url = c.getResource(className);\r\n\r\nbecause I thought a class loader was not allowed to return the .class file as a resource for security reasons.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2005-12-02T09:05:46.000+0000","updated":"2005-12-02T09:05:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12359106","id":"12359106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Class.getResource() doesn't return the .class file itself, it returns the URL of the location from which the class in question has already been loaded. This is used to determine the actual location of the loaded class, whether it was loaded by the extensions mechanism or from the classpath.\r\n\r\nBecause we're just asking for the location of the file, I don't believe there are any security manager issues. If we tried to load the class from the URL, that might be a problem if we don't have sufficient permissions to access the class.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2005-12-02T09:31:27.000+0000","updated":"2005-12-02T09:31:27.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12359108","id":"12359108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"The comment for ClassLoader.getResource says:\r\n\r\na URL for reading the resource, or null if the resource could not be found or the caller doesn't have adequate privileges to get the resource.\r\n\r\nThus if you don't have permission to read the class you should get null back.\r\n\r\nNot sure how this affects this patch, I know in the class loader that loads from the database I implemented to return null for any request for a file ending in .class, I'd just assumed most class loaders did that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2005-12-02T09:40:08.000+0000","updated":"2005-12-02T09:40:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12359109","id":"12359109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Come to think of it, has any work been done to sysinfo to make it run properly with the security manager enabled? It definitely accesses System properties and such without the requisite doPrivileged() blocks.\r\n\r\nAnswered my own question:\r\n\r\njava -cp jars/insane/derby.jar -Djava.security.manager org.apache.derby.tools.sysinfo\r\n------------------ Java Information ------------------\r\nJava Version:    1.4.2_09\r\nJava Vendor:     Apple Computer, Inc.\r\nJava home:       Security Exception: java.security.AccessControlException: access denied (java.util.PropertyPermission java.home read)\r\nJava classpath:  Security Exception: java.security.AccessControlException: access denied (java.util.PropertyPermission java.class.path read)\r\nOS name:         Mac OS X\r\nOS architecture: ppc\r\nOS version:      10.4.3\r\nJava user name:  Security Exception: java.security.AccessControlException: access denied (java.util.PropertyPermission user.name read)\r\nJava user home:  Security Exception: java.security.AccessControlException: access denied (java.util.PropertyPermission user.home read)\r\nJava user dir:   Security Exception: java.security.AccessControlException: access denied (java.util.PropertyPermission user.dir read)\r\njava.specification.name: Java Platform API Specification\r\njava.specification.version: 1.4\r\n--------- Derby Information --------\r\nJRE - JDBC: J2SE 1.4.2 - JDBC 3.0\r\n[/org/apache/derby/info/DBMS.properties] 10.2.0.0 alpha - (233223M)\r\n------------------------------------------------------\r\n----------------- Locale Information -----------------\r\n------------------------------------------------------\r\n\r\nSo that would be a 'no'. :-)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2005-12-02T09:41:51.000+0000","updated":"2005-12-02T09:41:51.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12359113","id":"12359113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Hi Dan, I was looking at the 1.3.1 javadoc at the time, it's not very specific about the security ramifications of the methods in question. oh well.\r\n\r\nAnyway, if we didn't have permissions to access the class, we'd already be in trouble by the time this code was called, since we would have already attempted to load the class to pass it into the getFileWhichLoadedClass method.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2005-12-02T10:19:48.000+0000","updated":"2005-12-02T10:19:48.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12359179","id":"12359179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is an updated version of the patch incorporating Andrew's suggestion to clean up the display on Windows.\r\n\r\nI haven't done anything about the security manager issues raised by Dan because I don't understand them well enough to know what to do.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2005-12-03T06:19:05.000+0000","updated":"2005-12-03T06:19:05.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12365784","id":"12365784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Andrew McIntyre suggested that the getCodeSource() method included in the patch for DERBY-930 could be used to solve this issue, as well.\r\n\r\nI will pursue Andrew's suggestion, and will investigate using that code in sysinfo to improve its behavior.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-02-10T07:11:45.000+0000","updated":"2006-02-10T07:11:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12367397","id":"12367397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I changed the title of this issue to more accurately depict the seriousness of the problem.\r\nCurrently sysinfo will print the wrong information if Derby is loaded with a custom ClassLoader.\r\n\r\nSee this thread on the derby-user list\r\nhttp://www.nabble.com/How-can-I-get-sysinfo-for-a-custom-Derby-classloader--t1171044.html\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-02-23T05:05:37.000+0000","updated":"2006-02-23T05:05:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12367985","id":"12367985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am changing this to Critical as its impact is apparent even when users are just using classpath and derby automatically loads jars.  For example amidst much confusion about DERBY-1045 and versions, Knut said:\r\n\r\n>derbytools.jar will automatically put derbyclient.jar in the\r\n>classpath. Since you have derbytools.jar from trunk before\r\n>derbyclient.jar version 10.1 in your classpath, derbyclient.jar will\r\n>be shadowed. Sysinfo will however report that you are using the 10.1\r\n>version of derbyclient.jar, since it only sees the CLASSPATH variable.\r\n\r\nIt seems to me perhaps this particular autoload is not a good idea but I will post separately about that but  this bug seems to make sysinfo not very useful for finding out jar versions.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-02-28T01:57:53.000+0000","updated":"2006-02-28T01:57:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12368017","id":"12368017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Here's another version of the patch for review.\r\n\r\nThe primary difference between this version and the previous 30-Nov-2005 version is that I've switched to using the getProtectionDomain().getCodeSource() technique proposed by David vanCouvering. I picked up the code from a patch proposal to DERBY-930, I believe, and copied the 5 lines or so here for use by Sysinfo.\r\n\r\nHere's a few remarks:\r\n - I've tested this code on Linux and Windows, with various combinations of jars and classes in the classpath and in the JRE/lib/ext, with and without a Security Manager in place, using various combinations of sysinfo arguments. Unfortunately, there are a *lot* of permutations here, and I probably missed some. Still, for the cases I tested, it behaved well.\r\n - Running sysinfo -cp works pretty well with a Security Manager, but running sysinfo *without* the -cp argument fails pretty badly under a Security Manager, as Andrew commented earlier in this issue. I didn't try to fix those problems, though I added a print statement for one particularly egregious case in which a security exception while fetching the CLASSPATH value was quietly swallowed with no output. Now it will at least tell you why it failed to process your CLASSPATH.\r\n - To run sysinfo -cp with a Security manager, you need a trivial policy file. I used:\r\n                     grant {   permission java.lang.RuntimePermission \"getProtectionDomain\"; };\r\n   which obviously isn't ideal, but it was sufficient for testing.\r\n - I also did some testing of the case raised by Knut Anders, in which having derbyclient.jar in the manifest of derbytools.jar causes derbyclient.jar to be pulled from the same directory where derbytools.jar was loaded, even if you have some other derbyclient.jar in your classpath. In my testing, \"sysinfo -cp\" behaves correctly in this case, and reports the *real* derbyclient.jar that is in use, which is good. Unfortunately, the code which explicitly parses the classpath (sysinfo with no arguments) is still fooled by this case and gives a misleading response.\r\nFundamentally, as I said in my 23-Nov-2005 comment, I think that the algorithm used by Main.getAllInfo() is just an inferior algorithm. Textual parsing of the CLASSPATH entry is just too easily fooled by a variety of modern class loading situations.\r\n\r\nBut I think that the algorithm used by \"sysinfo -cp\" is fundamentally sound, and I think that this patch improves it to make sysinfo better than it was, even if it's not where we want it to be, yet.\r\n\r\nPlease have a renewed look at this patch, and tell me what you think.\r\n\r\nthanks,\r\n\r\nbryan\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-02-28T05:13:34.000+0000","updated":"2006-02-28T05:13:34.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12368045","id":"12368045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Hi Bryan,\r\n\r\nThis looks good to me. Dan would need to comment on the security ramifications of needing the getProtectionDomain permission.\r\n\r\nIf you have a chance, take a look at my patch for DERBY-1063, it includes a fix to the 'regular' sysinfo (no arguments) case, although it uses getResource() which Dan said might be a problem, although it only loads properties files, not class files. I think the combination of your patch and my patch may cover most of the cases as far as reporting the proper locations of files, or at least the ones we can get to through the default classloader and the classpath. (which would be the ones that mattered, i suppose if you're running sysinfo in the same environment as your classloading/classpath setup.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-02-28T08:20:51.000+0000","updated":"2006-02-28T08:20:51.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12368063","id":"12368063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Minor comments on the code\r\n\r\n -  would be good to make the comment for the new method getFileWhichLoadedClass a javadoc method (use /** ... */) show that it shows up in the generated javadoc and IDE's.\r\n\r\n- why check getProtectionDomain() for a null return when the javadoc does not indicate it can return null?\r\n  I personally don't like this coding style as it add code for no value, should we check all methods that return references\r\n   for null, even ones like String.trim()?  It can make the reader have to look to the javadoc to see in what situations the method\r\ncan return null, to understand the code, only to find out it can't.\r\n\r\nI'm trying to think through the ramifications of using getProtectionDomain() and hence possibly needing the associated permission in the policy file. One issue is that this permission might be needed for all derby jar files, since sysinfo is in all jars.\r\nIt probably comes down to what situations would we expect sysinfo to be executed with a security manager present,\r\nin those situations how likely is the policy file going to be configured to support sysinfo? Since sysinfo is really meant to\r\nbe a quick check of the classpath, not an integral part of an application.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-02-28T11:12:36.000+0000","updated":"2006-02-28T11:12:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12368072","id":"12368072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"On the \"windows specific\" code for formatting the output of the URL, would this be needed if instead you did something like\r\n\r\n+                URL result = cs.getLocation ();\r\n\r\n                   String loc;\r\n                   if (\"file\".equals(result.getProtocol))\r\n                             loc = result.getPath();\r\n                    else\r\n                             loc = result.toString():\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-02-28T13:38:23.000+0000","updated":"2006-02-28T13:38:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12368214","id":"12368214","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Regarding Dan's most recent comment, about the Windows-specific path formatting, the suggestion does not seem to work for me, unfortunately:\r\n\r\nC:\\bryan\\src\\java\\urlloc>type x.java\r\npublic class x\r\n{\r\n        public static void main(String []args)\r\n                throws Exception\r\n        {\r\n                java.net.URL result = (new x()).getClass().\r\n                        getProtectionDomain().getCodeSource().getLocation();\r\n                System.out.println(\"proto=\" + result.getProtocol());\r\n                System.out.println(\"path=\" + result.getPath());\r\n                System.out.println(\"toString=\" + result.toString());\r\n        }\r\n}\r\n\r\nC:\\bryan\\src\\java\\urlloc>java -cp . x\r\nproto=file\r\npath=/C:/bryan/src/java/urlloc/\r\ntoString=file:/C:/bryan/src/java/urlloc/\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-01T13:27:10.000+0000","updated":"2006-03-01T13:27:10.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12368219","id":"12368219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Sysinfo_Feb28_2006.diff is a revised version of the sysinfo patch proposal incorporating comments from reviewers. There are two changes as compared to yesterday's patch proposal:\r\n\r\n1) The method comments have been reformatted to better match javadoc conventions\r\n2) The unnecessary and confusing check of the getProtectionDomain return value has been removed.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-01T13:45:41.000+0000","updated":"2006-03-01T13:45:41.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12369401","id":"12369401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"A few small things:\r\n\r\n1 - the class path becoming null issue is probably caused by the reportCloudscape method nulling out the local field classpath on a SecurityException.\r\n\r\n2 - Instead of hardcoding the \"Unable to analyze class path\" message, could you please add a new message to sysinfomessages.properties and use LocalizedResource to get the localized value?\r\n\r\n3 - Whether or not allowing getProtectionDomain is an appropriate permission to add, perhaps the getProtectionDomain() call should be wrapped in a try/catch block for a SecurityException so that sysinfo can gracefully fail out of getFileWhichLoadedClass()? At least then in an environment where this is not allowed, we can report the problem with a meaningful error message instead of just falling over. A localized message may be needed here as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-03-08T14:35:55.000+0000","updated":"2006-03-08T14:35:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12370041","id":"12370041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Patch \"with_andrews_feedback.diff\" incorporates the suggestions from Andrew's review of March 8 (thanks Andrew):\r\n\r\n- The message when java.class.path cannot be read is fetched from a translatable property\r\n- The code now catches the security exception when getProtectionDomain is disallowed and displays a friendly message fetched from a translatable property.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-12T11:00:57.000+0000","updated":"2006-03-12T11:00:57.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12370766","id":"12370766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Hi Bryan, the latest patch for this looks good to me. I would say go ahead and commit when you have a chance. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-03-17T08:22:54.000+0000","updated":"2006-03-17T08:22:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12371258","id":"12371258","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"It turns out that there are several tests which run the 'sysinfo' code in situations in which a Java security manager is in place, and in these tests the code is not currently being granted the permissions necessary to display the new detailed information  which is added by this patch.\r\n\r\nThe tests are:\r\n - derbynet/sysinfo.java\r\n - derybnet/sysinfo_withproperties.java\r\n - demo/RunClassPathTester.java\r\n\r\nThe two sysinfo tests run the Network Server under a security manager, and then call the 'sysinfo' command in client/server mode to print the sysinfo output from that Network Server. But the Network Server is not granted the permission to read java.class.path, so that part of the sysinfo output is blank.\r\n\r\nThe RunClassPathTester.java test runs the standalone sysinfo tool under a security manager, passing it the '-cp' flag to print information about Database.class and SimpleApp.class. These classes are indeed in the class path, but the test is not granted the permission to get the ProtectionDomain and CodeSource for them.\r\n\r\nThe result, right now, is that the two Sysinfo tests now produce a new line of output stating that permission has not been granted to read the java.class.path property, and the RunClassPathTester test now produces a new line of output stating that permission has not been granted to get the ProtectionDomain.\r\n\r\nI think that output is correct, and so I am tempted to update the master output files to reflect this new correct output.\r\n\r\nAlternatively, I could modify derby_tests.policy to grant additional permissions to the Derby codebase(s).\r\n\r\nWhat is the better path to pursue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-22T01:00:23.000+0000","updated":"2006-03-22T01:00:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12371270","id":"12371270","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"I believe the goal is to run the tests with as few permissions as possible. Granting additional permissions for these tests might mask security bugs elsewhere in the code.\r\n\r\nSo, I agree, I think the thing to do is add master files that include the output of the caught SecurityExceptions.\r\n\r\nMyrna had mentioned enhancing the test harness to be able to provide specific permissions to individual tests. Once that work had been completed, we could add the necessary permissions to these tests only. I thought a JIRA had been field for that, but I wasn't able to find it at the moment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-03-22T01:54:20.000+0000","updated":"2006-03-22T01:54:20.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12371275","id":"12371275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks, Andrew. I agree with you.\r\n\r\nI've committed this change:\r\nhttp://svn.apache.org/viewcvs?rev=387599&view=rev\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-22T02:39:16.000+0000","updated":"2006-03-22T02:39:16.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12371281","id":"12371281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I added a brief release note to the CHANGES file mentioning the new behavior and the new security requirement.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-03-22T02:56:54.000+0000","updated":"2006-03-22T02:56:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12418037","id":"12418037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Here's a release note:\r\n\r\n      PROBLEM: Sysinfo classpath information was insufficiently detailed\r\n\r\n      SYMPTOM: Sometimes it was hard to tell where the Derby classes were actually being loaded from in the JVM\r\n\r\n      CAUSE: the algorithm that sysinfo used for analyzing and reporting on the application classpath was not robust.\r\n\r\n      SOLUTION: The sysinfo tool now prints additional information about the origin of the classes and jars that it examines. The origin of a class might be: an entry in the application classpath, an entry in a class loader location\r\nlist, a jar fetched due to being listed in the manifest entry of another jar, a standard extension in the JRE's extensions directory, a jar installed into the application server, or any of various other possibilities.\r\n\r\n      Note that when sysinfo runs under a Java security manager, it may need special permissions to access this additional information, including the permission to read the java.class.path property, and the permission to call getProtectionDomain on a class. If sysinfo is not granted these permissions, it will display an error message about the security problem in place of displaying the class origin information.\r\n\r\n    SECURITY NOTE: The new permissions are optional. If you do not provide them, you will see a message such as the following in your sysinfo output: Unable to analyze class path: access denied (java.util.PropertyPermission java.class.path read). Such a message does not indicate an error; it simply means that the sysinfo tool was unable to provide detailed classpath information because it did not have permission to read the classpath. In prior releases, under these circumstances, sysinfo would silently print nothing, now it prints an informational message about the reason that it couldn't provide any classpath information.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-06-27T21:54:11.000+0000","updated":"2006-06-27T21:54:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325220/comment/12426854","id":"12426854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Linking this issue to DERBY-1273.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-08-09T06:41:43.000+0000","updated":"2006-08-09T06:41:43.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-668/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07aev:"}}