{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12353542","self":"https://issues.apache.org/jira/rest/api/latest/issue/12353542","key":"LUCENE-689","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312682","id":"12312682","description":"Last release (barring major bugs) before migrating to 3.0 and JDK 1.5","name":"2.9","archived":false,"released":true,"releaseDate":"2009-09-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-10-20 07:08:49.0","customfield_12312323":null,"customfield_12310420":"13063","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_74954674309_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-03-04T14:19:41.309+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-689/watchers","watchCount":0,"isWatching":false},"created":"2006-10-19T01:35:07.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310854","id":"12310854","description":"","name":"2.1","archived":false,"released":true,"releaseDate":"2007-02-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=otis","name":"otis","emailAddress":"otis at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=otis&avatarId=15859","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=otis&avatarId=15859","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=otis&avatarId=15859","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=otis&avatarId=15859"},"displayName":"Otis Gospodnetic","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-09-25T16:23:05.390+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310235","id":"12310235","name":"core/search","description":"issues with search code"}],"timeoriginalestimate":null,"description":"Part of our code utilizes the equals method in SpanOrQuery and, in certain cases (details to follow, if necessary), a NullPointerException gets thrown as a result of the String \"field\" being null.  After applying the following patch, the problem disappeared:\n\nIndex: src/java/org/apache/lucene/search/spans/SpanOrQuery.java\n===================================================================\n--- src/java/org/apache/lucene/search/spans/SpanOrQuery.java    (revision 465065)\n+++ src/java/org/apache/lucene/search/spans/SpanOrQuery.java    (working copy)\n@@ -121,7 +121,8 @@\n     final SpanOrQuery that = (SpanOrQuery) o;\n\n     if (!clauses.equals(that.clauses)) return false;\n-    if (!field.equals(that.field)) return false;\n+    if (field != null && !field.equals(that.field)) return false;\n+    if (field == null && that.field != null) return false;\n\n     return getBoost() == that.getBoost();\n   }\n\n","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10120","value":"Patch Available","id":"10120"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"27359","summary":"NullPointerException thrown by equals method in SpanOrQuery","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=linuxologist","name":"linuxologist","emailAddress":"goddardm at saic dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Goddard","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=linuxologist","name":"linuxologist","emailAddress":"goddardm at saic dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Goddard","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Java 1.5.0_09, RHEL 3 Linux, Tomcat 5.0.28","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":8,"total":8,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353542/comment/12443726","id":"12443726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=otis","name":"otis","emailAddress":"otis at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=otis&avatarId=15859","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=otis&avatarId=15859","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=otis&avatarId=15859","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=otis&avatarId=15859"},"displayName":"Otis Gospodnetic","active":true},"body":"Hm, weird.  l peeked at SpanOrQuery.java and it looks like the private field instance var should be set in the ctor, using the field from the first clause, no?  How come your field is null in the first place?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=otis","name":"otis","emailAddress":"otis at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=otis&avatarId=15859","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=otis&avatarId=15859","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=otis&avatarId=15859","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=otis&avatarId=15859"},"displayName":"Otis Gospodnetic","active":true},"created":"2006-10-20T07:08:49.000+0000","updated":"2006-10-20T07:08:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353542/comment/12443776","id":"12443776","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=linuxologist","name":"linuxologist","emailAddress":"goddardm at saic dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Goddard","active":true},"body":"Otis, you have an excellent point.  At the time I encountered this error, I was in a hurry to get something shipped out.  I will solve for why that happened, however perhaps coding this more defensively would be ok, too.  So, if the patch suggested above isn't the proper way to deal with it, what about the suggestion that the \"field\" instance variable be required to be non-null when it is set, so the constructor throws a NullPointerException if it is null?  That seems like the correct behavior to me.  This patch could be used to provide that behavior:\r\n\r\nIndex: src/java/org/apache/lucene/search/spans/SpanOrQuery.java\r\n===================================================================\r\n--- src/java/org/apache/lucene/search/spans/SpanOrQuery.java    (revision 466047)\r\n+++ src/java/org/apache/lucene/search/spans/SpanOrQuery.java    (working copy)\r\n@@ -43,6 +43,9 @@\r\n       SpanQuery clause = clauses[i];\r\n       if (i == 0) {                               // check field\r\n         field = clause.getField();\r\n+        if (field == null) {\r\n+          throw new NullPointerException(\"Field name can not be null.\");\r\n+        }\r\n       } else if (!clause.getField().equals(field)) {\r\n         throw new IllegalArgumentException(\"Clauses must have same field.\");\r\n       }\r\n\r\nOn the other hand, if the field name is in fact an interned string, then the portion of the equals method dealing with it could simply compare references, via \"==\".  That sounds simpler all around.  But ensuring the field is non-null may be a good idea, anyhow.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=linuxologist","name":"linuxologist","emailAddress":"goddardm at saic dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Goddard","active":true},"created":"2006-10-20T10:19:14.000+0000","updated":"2006-10-20T10:19:14.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353542/comment/12443885","id":"12443885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=otis","name":"otis","emailAddress":"otis at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=otis&avatarId=15859","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=otis&avatarId=15859","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=otis&avatarId=15859","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=otis&avatarId=15859"},"displayName":"Otis Gospodnetic","active":true},"body":"I'd personally really want to see how come that field is null to begin with.  If possible, could you try to debug this a bit and see what kind of SpanQueries with null fields you are dealing with.\r\n\r\nEven if we check for field == null and throw an exception, you won't get very far, so in the end you'll need to figure out where this null is coming from and why.  This is not to say that throwing an exception in case of null is not a good thing.\r\n\r\nThanks.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=otis","name":"otis","emailAddress":"otis at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=otis&avatarId=15859","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=otis&avatarId=15859","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=otis&avatarId=15859","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=otis&avatarId=15859"},"displayName":"Otis Gospodnetic","active":true},"created":"2006-10-20T16:23:37.000+0000","updated":"2006-10-20T16:23:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353542/comment/12446089","id":"12446089","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rahearn","name":"rahearn","emailAddress":"ryan dot c dot ahearn at saic dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Ahearn","active":true},"body":"Otis, I've been working with Mike on this and can explain how field can become null.  When rewrite() is called on a SpanRegexQuery that doesn't have any enumerations in the index (as returned by getEnum() in RegexQuery, called from rewrite() in MultiTermQuery) the SpanOrQuery constructor is called with an array of length 0.  Thus the for loop in the SpanOrQuery ctor is never entered and field is never initialized.  Hope this helps explain the behavior.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rahearn","name":"rahearn","emailAddress":"ryan dot c dot ahearn at saic dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan Ahearn","active":true},"created":"2006-10-31T22:17:35.000+0000","updated":"2006-10-31T22:17:35.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353542/comment/12474330","id":"12474330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steven_parkes","name":"steven_parkes","emailAddress":"steven_parkes at esseff dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Parkes","active":true},"body":"Looks like SpanOrQuery should support an empty SpanQuery. The existing tests even call it, they just never call equals.\r\n\r\nAdded a check to avoid the NPE and a test that equals on empties works.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steven_parkes","name":"steven_parkes","emailAddress":"steven_parkes at esseff dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Parkes","active":true},"created":"2007-02-20T01:36:22.938+0000","updated":"2007-02-20T01:36:22.938+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353542/comment/12648049","id":"12648049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"This patch is very simple, still applies,  and the issue does need to be fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2008-11-16T23:53:27.474+0000","updated":"2008-11-16T23:53:27.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353542/comment/12648240","id":"12648240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steven_parkes","name":"steven_parkes","emailAddress":"steven_parkes at esseff dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Parkes","active":true},"body":"Thanks, Otis. Was just gonna remove myself as assignee.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steven_parkes","name":"steven_parkes","emailAddress":"steven_parkes at esseff dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steven Parkes","active":true},"created":"2008-11-17T18:41:39.354+0000","updated":"2008-11-17T18:41:39.354+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12353542/comment/12678739","id":"12678739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"thanks all","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2009-03-04T14:19:41.263+0000","updated":"2009-03-04T14:19:41.263+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-689/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i051m7:"}}