{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12328898","self":"https://issues.apache.org/jira/rest/api/latest/issue/12328898","key":"DERBY-965","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-02-26 04:34:07.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22223","customfield_12310222":"1_*:*_1_*:*_1542840000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_439696000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-03-03T20:16:15.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-965/watchers","watchCount":0,"isWatching":false},"created":"2006-02-13T23:42:15.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12311831","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12311831","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"32841","key":"DERBY-310","self":"https://issues.apache.org/jira/rest/api/2/issue/32841","fields":{"summary":"Document and/or change Derby client code to match behavior with Embedded driver where possible.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12313043","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12313043","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12332699","key":"DERBY-1252","self":"https://issues.apache.org/jira/rest/api/2/issue/12332699","fields":{"summary":"Old clients with new server return wrong database metadata values for some methods","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-08-08T14:20:44.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11690","id":"11690","name":"Network Client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"}],"timeoriginalestimate":null,"description":"The DatabaseMetaData method supportsResultSetConcurrency erroneously\nreturns false on the network client for all arguments combination, cf\nthe attached repro program. The embedded client returns correct\nresults, viz the output:\n\n\norg.apache.derby.jdbc.ClientDriver:\nSupportsResultSetConcurrency: TYPE_FORWARD_ONLY,CONCUR_READ_ONLY: false\nSupportsResultSetConcurrency: TYPE_FORWARD_ONLY,CONCUR_UPDATABLE: false\nSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE,CONCUR_READ_ONLY: false\nSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE,CONCUR_UPDATABLE: false\nSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE,CONCUR_READ_ONLY: false\nSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE,CONCUR_UPDATABLE: false\norg.apache.derby.jdbc.EmbeddedDriver:\nSupportsResultSetConcurrency: TYPE_FORWARD_ONLY,CONCUR_READ_ONLY: true\nSupportsResultSetConcurrency: TYPE_FORWARD_ONLY,CONCUR_UPDATABLE: true\nSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE,CONCUR_READ_ONLY: true\nSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE,CONCUR_UPDATABLE: false\nSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE,CONCUR_READ_ONLY: false\nSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE,CONCUR_UPDATABLE: false\n\nPresumably, this is wrong in released versions as well.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40455","summary":"DatabaseMetadata method supportsResultSetConcurrency returns wrong result on network client","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Solaris 10, x86, Sun JDK 1.4.2","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":15,"total":15,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12366197","id":"12366197","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Repro program (self contained).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-02-13T23:44:31.000+0000","updated":"2006-02-13T23:44:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12366215","id":"12366215","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The client gets metadata information form the server via a call to a\r\nstored procedure, SYSIBM.METADATA. In this case, column no 97 contains\r\nthe information (for upportsResultSetConcurrency). This information is\r\ninitialized in the dictionary from the file metadata_net.properties,\r\nwhich contains the following string value for column 97:\r\n\r\n        '1003,1008;1004,1008;1005,1007,1008'\r\n      \r\nwhich is an encoding of the allowable combinations of result set type\r\nand concurrency. \r\n\r\nThere seems to be two problems here:\r\n\r\n1. The following comment block in the client explains\r\n   its view of this encoding syntax:\r\n\r\n   // The stored procured will return a String containg a list of\r\n   // concurrency and list of resultSet types which support a perticular\r\n   // concurrency For eg. if the database supports concurrency\r\n   // CONCUR_READ_ONLY(1007) in ResultSet type TYPE_FORWARD_ONLY(1003),\r\n   // TYPE_SCROLL_INSENSITIVE(1004), TYPE_SCROLL_SENSITIVE(1005) and\r\n   // supports concurrency CONCUR_UPDATBLE(1008) in resultSet\r\n   // TYPE_SCROLL_SENSITIVE(1005) then stored procedure will return a\r\n   // string \"1007,1003,1004,1005;1008,1005\" see how concurrency and\r\n   // supported result set types are seperated by \";\"\r\n\r\n   Unfortunately, the actual data seems to be the other way around,\r\n   that is, for a given type, it lists the allowed concurrencies:\r\n\r\n      '1003,1008;1004,1008;1005,1007,1008'\r\n\r\n   which, when decoded becomes:\r\n\r\n       TYPE_FORWARD_ONLY,CONCUR_UPDATABLE;\\\r\n       TYPE_SCROLL_INSENSITIVE,CONCUR_UPDATABLE;\\\r\n       TYPE_SCROLL_SENSITIVE,CONCUR_READ_ONLY,CONCUR_UPDATABLE\r\n\r\n   In addition to being encoded differently, this is also wrong, in\r\n   that Derby does not support scroll sensitive at all, whereas we\r\n   *do* support CONCUR_READ_ONLY for the two other types (not given).\r\n\r\n   Since the client checks for concurrency type against the first\r\n   token of each substring, it will not get a match and always return\r\n   false.\r\n\r\n2. The client code (even if given the expected syntax) has a coding\r\n   bug:\r\n\r\n      java.util.StringTokenizer st = new java.util.StringTokenizer(returnedFromSP, \";\");\r\n      while (st.hasMoreTokens()) {\r\n          java.util.StringTokenizer stForType = new java.util.StringTokenizer(st.nextToken(), \",\");\r\n          if ((new Integer(stForType.nextToken())).intValue() == concurrency) {\r\n**            while (st.hasMoreTokens()) {\r\n**                if ((new Integer(st.nextToken())).intValue() == type) {\r\n                      return true;\r\n                  }\r\n              }\r\n              return false;\r\n          }\r\n      }\r\n      return false;\r\n\r\n   The inner loop uses the wrong tokenizer (st in stead of stForType)\r\n   and will fail.\r\n   \r\n\r\nSo, we need to decide which encoding syntax is the correct one,\r\ncorrect the server's data and also fix the client bug. Note that this\r\nraises an upgrade issue, in that the existing client would crash if\r\nthe server's data were corrected to the encoding syntax the client\r\nexpects (due to the coding bug).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-02-14T02:09:04.000+0000","updated":"2006-02-14T02:09:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12367515","id":"12367515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"* The patch, derby965-v1.{stat,diff}, corrects the server data to the correct values, \r\nretaining the encoding used on the server side. The new values\r\n(metadata_net.properties) now reflect the capabilities of the\r\nserver+network client driver::\r\n\r\n        '1003,1007,1008;1004,1007;1005'\r\ni.e. decoded:\r\n     \r\n        TYPE_FORWARD_ONLY,CONCUR_READ_ONLY,CONCUR_UPDATABLE;\r\n        TYPE_SCROLL_INSENSITIVE,CONCUR_READ_ONLY\r\n        TYPE_SCROLL_SENSITIVE\r\n\r\nDERBY-775 (client SUR) will be adding CONCUR_UPDATABLE to the second\r\nline later.\r\n\r\n* The client's parsing and decoding has been changed to comply with\r\nthis encoding style and now gives the correct result\r\n(changes in getMetaDataInfoInt_SupportsResultSetConcurrency).\r\n\r\n* This patch should not give upgrade problems, in that an older client\r\nagainst a new server will give the same (wrong) results as before when\r\ntrying to interpret type as concurrency. A new client against and old\r\nserver will work, but give wrong results, although wrong in a\r\ndifferent way from before. cf. the analysis of feb-13\r\nabove. Presumably, apps relying on this method would have failed\r\nalways, so the changed result should not be too serious.\r\n\r\n* Tests of this method has been added to metadata_test.java and\r\nembedded and derby network client canons have been\r\nupdated.\r\n\r\n* NOTE: Unfortunately, derbynetmats running the JCC client seems to\r\nhave the same problem (it returns false for all type, concurrency\r\ncombinations), so I had to make derbynetmats skip these new tests for\r\nthat driver.\r\n\r\n* derbyall has been run successfully on Sun's 1.4.2 VM (modulo errors\r\nseen in regression test).\r\n\r\n* For the other canons (non-1.4.2 VMs), I have inserted the expected\r\nresults, but not verified them.\r\n\r\n* I noticed the canon of phaseTester also contain metadata_test\r\noutput, but I did not update this test's canon, as I am not familiar\r\nwith how it should be updated. I'd appreciate advice on that.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-02-24T00:33:55.000+0000","updated":"2006-02-24T00:33:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12367775","id":"12367775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I read through your changes and they seem good to me.\r\n\r\nIt would be nice to have comments in metadata_net.properties explaining the encoding, and in DatabaseMetaData.java explaining what's going on with the string tokenizers and pointing to the metadata_net.properties since the two files are sort of linked at the hip.\r\n\r\nIt's a bummer about the mixed-version incompatibilities, but I couldn't think of any easy way to make them better.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-02-26T04:34:07.000+0000","updated":"2006-02-26T04:34:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12367798","id":"12367798","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I haven't been able to look at this closely to understand the issues, but  I have some questions\r\n\r\nYour earlier comment said:\r\nNote that this\r\nraises an upgrade issue, in that the existing client would crash if\r\nthe server's data were corrected to the encoding syntax the client\r\nexpects (due to the coding bug) but the patch comments made it sound  less severe.\r\n\r\nIs there a scenario with this patch where we will get a crash where we did not before?\r\n\r\nI  know there was a lot of discussion at one time about changes to metadata.properties and metadata_net.properties for upgrade, soft upgrade and downgrade.  I wonder if someone could point me to the final resolution or explain it if it is brief.  I had always been a fan of drop and recreate on any version change to allow for bug fixing and  prevent intractible upgrade situations.\r\n\r\nAlso I wanted to mention if you need client to behave differently with different versions you can add something to \r\nNetDatabaseMetaData.computeFeatureSet\r\n\r\nSimilarly on the server side AppRequester.java has a mechanism for client version specific behaviour.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-02-26T09:05:15.000+0000","updated":"2006-02-26T09:05:15.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12367962","id":"12367962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for looking at this Bryan.\r\n\r\nBryan wrote:\r\n\r\n> It would be nice to have comments in metadata_net.properties\r\n> explaining the encoding, and in DatabaseMetaData.java explaining\r\n> what's going on with the string tokenizers and pointing to the\r\n> metadata_net.properties since the two files are sort of linked at the\r\n> hip.\r\n\r\nI'll do that and upload a new patch. \r\n\r\n> It's a bummer about the mixed-version incompatibilities, but I\r\n> couldn't think of any easy way to make them better.\r\n\r\nBy changing the client's code the way I did (not changing the encoding\r\nin the server, only correcting it's value), we should be OK (cf my\r\ncomments above):\r\n\r\nOld clients - new server will still give false for all combinations,\r\nsince the value sets for CONCURRENCY and TYPE are disjoint, and the\r\nold client basically tries to match concurrency against type. So old\r\nclients will not crash. This should remove Kathey's concern, I hope :)\r\n\r\nA new client against and old server will work, but give wrong results,\r\nalthough wrong in a different way from before. It would now return\r\ntrue in some cases, where it previosuly always returned false. Those\r\n\"true\" value though, would mostly be wrong, cf. old server's values:\r\n\r\n       TYPE_FORWARD_ONLY,CONCUR_UPDATABLE;\\\r\n       TYPE_SCROLL_INSENSITIVE,CONCUR_UPDATABLE;\\\r\n       TYPE_SCROLL_SENSITIVE,CONCUR_READ_ONLY,CONCUR_UPDATABLE \r\n\r\nSo it would give wrong values, but the old behavior (Always false) was\r\nwrong too.. I think this is acceptable.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-02-27T23:56:31.000+0000","updated":"2006-02-27T23:56:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12367964","id":"12367964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Kathey wrote:\r\n\r\n> Your earlier comment said: Note that this raises an upgrade issue, in\r\n> that the existing client would crash if the server's data were\r\n> corrected to the encoding syntax the client expects (due to the coding\r\n> bug) but the patch comments made it sound less severe.\r\n\r\nYes, I believe I chose the change which made the upgrade issue less\r\nsevere: By retaining the server's encoding, old clients will not\r\ncrash, cf. my answer to Bryan.\r\n\r\n> Is there a scenario with this patch where we will get a crash where we\r\n> did not before?\r\n\r\nI do not think there is with this patch. I will test 10.1 against\r\ntrunk for both skewed version combination (client, server) to make\r\nsure.\r\n\r\n> Also I wanted to mention if you need client to behave differently with\r\n> different versions you can add something to\r\n> NetDatabaseMetaData.computeFeatureSet\r\n> \r\n> Similarly on the server side AppRequester.java has a mechanism for\r\n> client version specific behaviour.\r\n\r\nThanks, I'll look at those. I don't think they are needed in this\r\ncase, though.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-02-28T00:04:55.000+0000","updated":"2006-02-28T00:04:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12368073","id":"12368073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"A new patch which replaces v1.\r\n\r\nDescription:\r\n\r\n- skips added test lines for supportsResultSetConcurrency\r\n   in metadata_test.java for jcc client\r\n- contains added comments as suggested by Bryan \r\n\r\nTests:\r\n\r\nDerbyall runs correctly on Sun Solaris 10/x86, JVM 1.4.2.\r\n\r\nI also ran the repro with mixed client server versions [10.1.2.1 - (330608), trunk at \r\n10.2.0.0 alpha - (380154M)] and got the expected result:\r\n\r\nRunning with a new client against an old server the repro: No longer only false; values are wrong\r\nof course, but now correctly reflect (old) server's values.\r\n\r\nServer is ready to accept connections on port 1500.\r\nConnection number: 1.\r\nConnection number: 2.\r\norg.apache.derby.jdbc.ClientDriver:\r\nSupportsResultSetConcurrency: TYPE_FORWARD_ONLY,CONCUR_READ_ONLY: false\r\nSupportsResultSetConcurrency: TYPE_FORWARD_ONLY,CONCUR_UPDATABLE: true\r\nSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE,CONCUR_READ_ONLY: false\r\nSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE,CONCUR_UPDATABLE: true\r\nSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE,CONCUR_READ_ONLY: true\r\nSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE,CONCUR_UPDATABLE: true\r\n\r\nRunning with old client and new server: Client can't make sense of the encoding (as before) and \r\nreturns only false.\r\n\r\nApache Derby Network Server - 10.2.0.0 alpha started and ready to accept connections on port 1500 at 2006-02-28 04:11:13.961 GMT \r\n\r\norg.apache.derby.jdbc.ClientDriver:\r\nSupportsResultSetConcurrency: TYPE_FORWARD_ONLY,CONCUR_READ_ONLY: false\r\nSupportsResultSetConcurrency: TYPE_FORWARD_ONLY,CONCUR_UPDATABLE: false\r\nSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE,CONCUR_READ_ONLY: false\r\nSupportsResultSetConcurrency: TYPE_SCROLL_INSENSITIVE,CONCUR_UPDATABLE: false\r\nSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE,CONCUR_READ_ONLY: false\r\nSupportsResultSetConcurrency: TYPE_SCROLL_SENSITIVE,CONCUR_UPDATABLE: false\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-02-28T13:41:03.000+0000","updated":"2006-02-28T13:41:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12368307","id":"12368307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It seems like Dag has addressed the concerns of the reviewers. I'm\r\nplanning to commit this patch tomorrow, so please scream out if you\r\nstill have issues with it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2006-03-02T00:54:22.000+0000","updated":"2006-03-02T00:54:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12368416","id":"12368416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Note: I did not get any answer to my question on the phaseTester canon, \r\nas far as I can see. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-03-02T10:03:34.000+0000","updated":"2006-03-02T10:03:34.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12368461","id":"12368461","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed revision 382319.\r\n\r\nI didn't mark the issue as resolved because of the unanswered question\r\nabout the phaseTester canon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2006-03-02T17:40:02.000+0000","updated":"2006-03-02T17:40:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12368537","id":"12368537","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"body":"I just started to look at DERBY-514 for upgrade tests and was trying to see how the phaseTester test currently works. For the following question from Dag:\r\n\r\n\"I noticed the canon of phaseTester also contain metadata_test output, but I did not update this test's canon, as I am not familiar with how it should be updated. I'd appreciate advice on that.\"\r\n\r\nplease see if  this comment in DERBY-573 helps: http://issues.apache.org/jira/browse/DERBY-573#action_12360193\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"created":"2006-03-03T01:38:07.000+0000","updated":"2006-03-03T01:38:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12368631","id":"12368631","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"This patch (derby965b-v1) updates the master for phaseTester.java.\r\nThis test is not part of derbyall and the master must be manually\r\ncompared with the output of the phase tests, cf description in\r\nDERBY-573.\r\n\r\nphaseTester runs metadata_test.java as part of its work, so the master\r\nneeds to be updated whenever metadata_test.java changes (as this issue\r\ndoes).\r\n\r\nNote: Even with this patch, phaseTester when run as described,\r\nfailed. I noticed the following:\r\n\r\n- the shell script driving it is WIndows specific (\";\" as classpath\r\n  delimiter)\r\n\r\n- in the soft upgrade phase, the metadata test fails (table not\r\n  found), when performing a stored procedure: 'CALL\r\n  SYSIBM.SQLCOLPRIVILEGES' (in odbc_metadata#getMetadataRS).\r\n  \r\nThis patch lessens the diff between the master and the \"current\"\r\noutput, though, so i think it should be committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-03-03T10:44:22.000+0000","updated":"2006-03-03T10:44:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12368698","id":"12368698","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Verified that the phaseTester diff was reduced by the patch.\r\n\r\nCommitted revision 382759.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2006-03-03T20:16:15.000+0000","updated":"2006-03-03T20:16:15.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328898/comment/12369453","id":"12369453","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"verified on trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-03-08T22:24:31.000+0000","updated":"2006-03-08T22:24:31.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-965/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07afb:"}}