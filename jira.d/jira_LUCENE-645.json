{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12347225","self":"https://issues.apache.org/jira/rest/api/latest/issue/12347225","key":"LUCENE-645","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-08-04 00:17:38.0","customfield_12312323":null,"customfield_12310420":"13108","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_45405021915_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-01-10T21:03:35.915+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-645/watchers","watchCount":4,"isWatching":false},"created":"2006-08-03T08:33:14.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310334","id":"12310334","description":"last 1.x release, has new 2.x APIs","name":"1.9","archived":false,"released":true,"releaseDate":"2006-02-27"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-01-10T21:03:35.910+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310233","id":"12310233","name":"core/other","description":"issues related to any code under core. Usage of this document is discouraged. Please create (or ask for) a proper component."}],"timeoriginalestimate":null,"description":"The following code extract show the problem\n\n\n\t\tTermQuery query= new TermQuery( new Term( \"data\", \"help\" )); \n\t\tHighlighter hg = new Highlighter(new SimpleHTMLFormatter(), new QueryScorer( query ));\n\t\thg.setTextFragmenter( new NullFragmenter() );\n\t\t\n\t\tString match = null;\n\t\ttry {\n\t\t\tmatch = hg.getBestFragment( new StandardAnalyzer(), \"data\", \"help me [54-65]\" );\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\tSystem.out.println( match );\n\n\nThe sytsem outputs \n\n<B>help</B> me [54-65\n\n\nwould expect \n\n<B>help</B> me [54-65]\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12310120":null,"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"27403","summary":"Highligter fails to include non-token at end of string to be highlighted","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adpalmer","name":"adpalmer","emailAddress":"andrew dot palmer at vnuinc dot co dot uk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Palmer","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adpalmer","name":"adpalmer","emailAddress":"andrew dot palmer at vnuinc dot co dot uk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew Palmer","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Red Hat Linux, Java 1.5\nWindows Java 1.5","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347225/comment/12425643","id":"12425643","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehatcher","name":"ehatcher","emailAddress":"ehatcher at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ehatcher&avatarId=22298","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ehatcher&avatarId=22298","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ehatcher&avatarId=22298","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ehatcher&avatarId=22298"},"displayName":"Erik Hatcher","active":true},"body":"There is some commented out code in Highlighter.java:\r\n\r\n\t\t\tif (lastEndOffset < text.length())\r\n\t\t\t\tnewText.append(encoder.encodeText(text.substring(lastEndOffset)));\r\n\r\nuncommenting that code fixes this issue.\r\n\r\nI've added this test to HighlighterTest.java:\r\n\r\n  public void testOffByOne() throws IOException {\r\n    TermQuery query= new TermQuery( new Term( \"data\", \"help\" ));\r\n    Highlighter hg = new Highlighter(new SimpleHTMLFormatter(), new QueryScorer( query ));\r\n    hg.setTextFragmenter( new NullFragmenter() );\r\n\r\n    String match = null;\r\n    match = hg.getBestFragment( new StandardAnalyzer(), \"data\", \"help me [54-65]\");\r\n    assertEquals(\"<B>help</B> me [54-65]\", match);\r\n  }\r\n\r\nall tests pass even with that code uncommented.   I'll commit if there are no objections.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehatcher","name":"ehatcher","emailAddress":"ehatcher at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ehatcher&avatarId=22298","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ehatcher&avatarId=22298","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ehatcher&avatarId=22298","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ehatcher&avatarId=22298"},"displayName":"Erik Hatcher","active":true},"created":"2006-08-04T00:17:38.000+0000","updated":"2006-08-04T00:17:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347225/comment/12425647","id":"12425647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Note that \"svn blame\" indicates that commenting those lines out was the sole change mharwood made in r168452 which had this comment...\r\n\r\n> Fixed bug where docs larger than maxDocBytesToAnalyze\r\n> would cause last fragment to be sized as remainder of doc\r\n> (which could be huge)\r\n\r\nhttp://svn.apache.org/viewvc?view=rev&revision=168452\r\n\r\n...it's not clear to me if subsequent commits have fixed this problem in another way so that uncommenting those lines is safe again ... but the behavior described in r168452 certainly seems worse then the behavior descibed in this bug, so i would suggest not reverting that change untill the original problem can be verified with a test case. (there may already be one .. i don't know enough about highlighter to check)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2006-08-04T00:55:41.000+0000","updated":"2006-08-04T00:55:41.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347225/comment/12428521","id":"12428521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","emailAddress":"markharw00d at yahoo dot co dot uk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true},"body":"[Just got back from holiday and picking up some old messages]\r\n\r\nI've committed what I beleive to be a fix for this along with added Junit tests for this scenario + over-sized docs. Let me know if this meets everyone's needs and I'll close this issue.\r\n\r\nThis highlighter code may be rewritten shortly because I still need to take a look at Ronnie Kolehmainen's highlighter contribution in more depth. This offers notable speed ups for large docs.\r\n\r\nCheers,\r\nMark\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markh","name":"markh","emailAddress":"markharw00d at yahoo dot co dot uk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Harwood","active":true},"created":"2006-08-16T21:46:41.000+0000","updated":"2006-08-16T21:46:41.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347225/comment/12473588","id":"12473588","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"This fix works well for our case with JapaneseAnalyzer.\r\n\r\ninput text: \"AAA BBB CCC (DDD EEE)\"\r\n\r\noutput (w/ lucene-highlighter-2.0.0.jar)\r\nAAA <B>BBB</B> CCC (DDD EEE\r\n\r\noutput(w/ lucene-highlighter-2.1-dev.jar)\r\nAAA <B>BBB</B> CCC (DDD EEE)\r\n\r\nWe hope that the fix will be included at next release.\r\n\r\nRegards,\r\nKoji","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2007-02-16T01:58:38.630+0000","updated":"2007-02-16T01:58:38.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347225/comment/12509643","id":"12509643","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"This issue has been fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2007-07-02T19:13:31.155+0000","updated":"2007-07-02T19:13:31.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347225/comment/12557797","id":"12557797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"Last report is this is fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2008-01-10T21:03:35.901+0000","updated":"2008-01-10T21:03:35.901+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-645/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i051vz:"}}