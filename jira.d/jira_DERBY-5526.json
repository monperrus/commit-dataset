{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12534377","self":"https://issues.apache.org/jira/rest/api/latest/issue/12534377","key":"DERBY-5526","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323456","id":"12323456","description":"Third release on the 10.8 branch","name":"10.8.3.0","archived":false,"released":true,"releaseDate":"2012-11-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-12-09 02:04:40.213","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"220099","customfield_12310222":"1_*:*_1_*:*_100086200_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-12-09T21:55:07.373+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5526/watchers","watchCount":1,"isWatching":false},"created":"2011-12-08T18:07:01.237+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12346079","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12346079","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12459486","key":"DERBY-4589","self":"https://issues.apache.org/jira/rest/api/2/issue/12459486","fields":{"summary":"Corrupted database prevents startup and should be automatically repaired perhaps","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-11-15T08:15:16.177+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"I have very few details yet, but  user upgrading from 10.5 to 10.8.2  reports this error in one of their tests  creating a database.\r\n\r\nCaused by: java.sql.SQLException: Failed to create database 'clientdb', see the next exception for details.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\r\n\t... 71 more\r\nCaused by: java.sql.SQLException: The database directory 'C:\\cygwin\\home\\debugfat\\clientdb' exists. However, it does not contain the expected 'service.properties' file. Perhaps Derby was brought down in the middle of creating this database. You may want to delete this directory and try creating the database again.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\r\n\t... 68 more\r\nCaused by: ERROR XBM0A: The database directory 'C:\\cygwin\\home\\debugfat\\clientdb' exists. However, it does not contain the expected 'service.properties' file. Perhaps Derby was brought down in the middle of creating this database. You may want to delete this directory and try creating the database again.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.StorageFactoryService.vetService(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.StorageFactoryService.access$600(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.StorageFactoryService$9.run(Unknown Source)\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:254)\r\n\tat org.apache.derby.impl.services.monitor.StorageFactoryService.createServiceRoot(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.bootService(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.createPersistentService(Unknown Source)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.createPersistentService(Unknown Source)\r\n\t... 68 more\r\ncaused by: ERROR XBM0A: The database directory 'C:\\cygwin\\home\\debugfat\\clientdb' exists. However, it does not contain the expected 'service.properties' file. Perhaps Derby was brought down in the middle of creating this database. You may want to delete this directory and try creating the database again.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.StorageFactoryService.vetService(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.StorageFactoryService.access$600(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.StorageFactoryService$9.run(Unknown Source)\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:254)\r\n\tat org.apache.derby.impl.services.monitor.StorageFactoryService.createServiceRoot(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.bootService(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.createPersistentService(Unknown Source)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.createPersistentService(Unknown Source)\r\n\t... 68 more\r\n\r\nDERBY-4589 is where vetService was added, but I am not sure what has changed from 10.5.    I don't see any release note associated with DERBY-4589.  I will test an existing database scenario with 10.5 vs 10.8., vetService just checks that service.properties exists.\r\n\r\n\r\n       Verify that the service directory looks ok before objecting that the database\r\n       already exists.\r\n    */\r\n    private void    vetService( StorageFactory storageFactory, String serviceName ) throws StandardException\r\n    {\r\n        // check for existence of service.properties descriptor file\r\n        StorageFile    service_properties = storageFactory.newStorageFile( PersistentService.PROPERTIES_NAME );\r\n\r\n        if ( !service_properties.exists() )\r\n        {\r\n            throw StandardException.newException\r\n                ( SQLState.SERVICE_PROPERTIES_MISSING, serviceName, PersistentService.PROPERTIES_NAME );\r\n        }\r\n    }","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36104","summary":"on upgrade from 10.5 to 10.8.2 , getting  ERROR XBM0A: The database directory 'C:\\cygwin\\home\\debugfat\\clientdb' exists. However, it does not contain the expected 'service.properties' file.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10102","value":"Patch Available","id":"10102"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":11,"total":11,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13165398","id":"13165398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"The failure occurs in new code added in DERBY-4589, so linking to that issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-08T18:10:54.459+0000","updated":"2011-12-08T18:10:54.459+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13165584","id":"13165584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Trying to create a database on an empty directory with 10.5 vs 10.8 I see the message and SQL State have changed. With 10.5 it is:\r\nCaused by: ERROR XBM0J: Directory C:\\cygwin\\home\\kmarsden\\repro\\DERBY-5526\\wombat already exists.\r\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\r\n        at org.apache.derby.impl.services.monitor.StorageFactoryService$9.run(StorageFactoryService.java:670)\r\n        at java.security.AccessController.doPrivileged(AccessController.java:251)\r\n        at org.apache.derby.impl.services.monitor.StorageFactoryService.createServiceRoot(StorageFactoryService.j\r\n)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1798)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.createPersistentService(BaseMonitor.java:1060)\r\n        at org.apache.derby.iapi.services.monitor.Monitor.createPersistentService(Monitor.java:596)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.createDatabase(EmbedConnection.java:2446)\r\n        ... 7 more\r\nSQLState=XBM0JDirectory C:\\cygwin\\home\\kmarsden\\repro\\DERBY-5526\\wombat already exists.\r\njava.sql.SQLException: Directory C:\\cygwin\\home\\kmarsden\\repro\\DERBY-5526\\wombat already exists.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)\r\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:391\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2204)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.createDatabase(EmbedConnection.java:2452)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.java:396)\r\n        at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)\r\n        at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:238)\r\n        at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:322)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:273)\r\n\r\n\r\nWith 10.8 it is:\r\n\r\n\r\n\r\nCaused by: ERROR XBM0A: The database directory 'C:\\cygwin\\home\\kmarsden\\repro\\DERBY-5526\\wombat' exists. However, it doe\r\ns not contain the expected 'service.properties' file. Perhaps Derby was brought down in the middle of creating this data\r\nbase. You may want to delete this directory and try creating the database again.\r\n        at org.apache.derby.iapi.error.StandardException.newException(StandardException.java:303)\r\n        at org.apache.derby.impl.services.monitor.StorageFactoryService.vetService(StorageFactoryService.java:715)\r\n        at org.apache.derby.impl.services.monitor.StorageFactoryService.access$600(StorageFactoryService.java:64)\r\n        at org.apache.derby.impl.services.monitor.StorageFactoryService$9.run(StorageFactoryService.java:663)\r\n        at java.security.AccessController.doPrivileged(AccessController.java:251)\r\n        at org.apache.derby.impl.services.monitor.StorageFactoryService.createServiceRoot(StorageFactoryService.java:642\r\n)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1740)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.createPersistentService(BaseMonitor.java:1002)\r\n        at org.apache.derby.iapi.services.monitor.Monitor.createPersistentService(Monitor.java:596)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.createDatabase(EmbedConnection.java:2534)\r\n        ... 7 more\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-08T21:29:49.091+0000","updated":"2011-12-08T21:29:49.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13165598","id":"13165598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am curious about 2 things:\r\n1) Why did the error SQLState change?\r\n\r\n2) Is this error too specific regard with suggesting the user delete the directory? Perhaps this is a directory that just happens to exist with some other non-derby contents and the application just wants to warn that the directory exists so the user can put their database elsewhere.\r\n\r\nThanks\r\n\r\nKathey\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-08T21:47:27.134+0000","updated":"2011-12-08T21:47:27.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13165653","id":"13165653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Looking at the code where vetService() is called:\r\n\r\n else\r\n                                {\r\n                                    vetService( storageFactory, name );\r\n                                    throw StandardException.newException(SQLState.SERVICE_DIRECTORY_EXISTS_ERROR,\r\n                                                                         getDirectoryPath( name));\r\n                                }\r\n\r\n\r\n and the issue comments for DERBY-4589, I think the intention of the new error was to just produce a more sensible message for a half created database, but to keep the old error message for directories not related to Derby.  I am thinking it would make sense for vetService to check both that service.properties doesn't exist *and* seg0 does exists to determine if that is the state of affairs.  I will give that a try on the empty directory case.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-08T22:46:51.038+0000","updated":"2011-12-08T22:46:51.038+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13165728","id":"13165728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attaching a preliminary patch with my approach for this issue. Still need to add a test, run tests etc.\r\n\r\nThe patch will try to better check that the database directory is really an aborted database creation and not just a user directory with other data by checking for the existence of the seg0 directory before throwing the new error about service.properties being missing.\r\n\r\nI verified with the empty directory we go back to just printing the error that the directory exists and that with the user database attached to DERBY-4589 we throw the XBMOA services.properties missing error.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-09T01:19:19.748+0000","updated":"2011-12-09T01:19:19.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13165762","id":"13165762","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Looks like a good approach.\r\nHere is the order in which the database files are created (traced via limitAccessToOwner):\r\n\r\n$ java -Dderby.storage.useDefaultFilePermissions=false org.apache.derby.tools.ij\r\nij version 10.9\r\nij> connect 'jdbc:derby:foobat;create=true';\r\nlimitAccessToOwner: derby.log\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/tmp\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/db.lck\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/dbex.lck\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/db.lck\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/log\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/log/log.ctrl\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/log/logmirror.ctrl\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/log/log1.dat\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/seg0\r\n:\r\nlimitAccessToOwner: /export/home/dag/java/sb/sb1/foobat/service.properties\r\nij>\r\n\r\nSo, the last file created is service.properties. I guess seg0 is a good (early) candidate, although it is not the first one to more or less safely say this is a Derby database directory. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-12-09T02:04:40.213+0000","updated":"2011-12-09T02:04:40.213+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13166248","id":"13166248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"checking for seg0 also seems fine to me, as if it does not exist there is really no hope of recovering any derby data.  I would not check for \"log\" as it can be located on another disk and figuring that out requires access to the service.properties file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2011-12-09T15:37:35.831+0000","updated":"2011-12-09T15:37:35.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13166333","id":"13166333","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Here is the patch with the test added. There was already a test for the half created database, so added a fixture to test the regular case of just a user data directory.\r\n\r\nI think the seg0 check is best as tmp is too generic and as Mike says log can be offloaded elsewhere.\r\n\r\nI think the new message for service.properties could be improved to not so readily encourage deletion in the corrupt database case but did not change that with this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-09T17:25:47.639+0000","updated":"2011-12-09T17:25:47.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13166377","id":"13166377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks, Kathey. I agree about the choice of seg0.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-12-09T18:03:23.608+0000","updated":"2011-12-09T18:03:23.608+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13166603","id":"13166603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Resolving this issue. I checked in the fix to 10.9 and 10.8 branches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-12-09T21:55:07.409+0000","updated":"2011-12-09T21:55:07.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12534377/comment/13823442","id":"13823442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update: close all resolved issues that haven't had any activity the last year]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-15T08:15:16.174+0000","updated":"2013-11-15T08:15:16.174+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5526/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06jkf:"}}