{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12480760","self":"https://issues.apache.org/jira/rest/api/latest/issue/12480760","key":"DERBY-4913","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313401","id":"12313401","description":"Head of 10.4 branch","name":"10.4.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315436","id":"12315436","description":"Head of 10.5 branch - version bump for DERBY-4835","name":"10.5.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315434","id":"12315434","description":"Head of 10.6 branch as of 2014-01-13","name":"10.6.2.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315902","id":"12315902","description":"Head of 10.7 branch as of 2010-11-29","name":"10.7.1.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-11-30 03:46:30.578","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24528","customfield_12310222":"1_*:*_1_*:*_4139538816_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-01-10T22:24:33.691+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4913/watchers","watchCount":1,"isWatching":false},"created":"2010-11-24T00:32:14.875+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314117","id":"12314117","description":"Next release after 10.5.2.0 release candidate #1","name":"10.5.3.0","archived":false,"released":true,"releaseDate":"2009-08-21"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12336346","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12336346","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12371145","key":"DERBY-2775","self":"https://issues.apache.org/jira/rest/api/2/issue/12371145","fields":{"summary":"DataTypeDescriptor should be immutable so that multiple ValueNode referring to the same DTD do not have unexpected state changes.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-12-14T23:45:05.134+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"I have a report from a user upgrading to 10.5 from 10.3 that they got the following error during upgrade. I don't have much in the way of details yet, but thought I would post an issue since I've never seen this error before.  I do have the original 10.3 database and it seems to upgrade fine to 10.5 with ij.  \r\n\r\n\r\n    java.sql.SQLException: Failed to start database \r\n'/\r\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException\r\n(Unknown Source)\r\n       at \r\norg.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.impl.jdbc.Util.seeNextException(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.impl.jdbc.EmbedConnection.<init>(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.impl.jdbc.EmbedConnection30.<init>(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.impl.jdbc.EmbedConnection40.<init>(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.jdbc.Driver40.getNewEmbedConnection(Unknown \r\nSource)\r\n       at org.apache.derby.jdbc.InternalDriver.connect(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.jdbc.EmbeddedDataSource.getConnection(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.jdbc.EmbedPooledConnection.openRealConnection(U\r\nnknown Source)\r\n       at \r\norg.apache.derby.jdbc.EmbedPooledConnection.<init>(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.jdbc.EmbedPooledConnection40.<init>(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.jdbc.Driver40.getNewPooledConnection(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.jdbc.EmbeddedConnectionPoolDataSource.createPoo\r\nledConnection(Unknown Source)\r\n       at \r\norg.apache.derby.jdbc.EmbeddedConnectionPoolDataSource.getPooled\r\nConnection(Unknown Source)\r\n       at \r\n<snip>\r\n    Caused by: java.sql.SQLException: Failed to start database \r\n'<snip>759243AF2F8\r\n4F1DE' with class loader <snip>.ExtClassLoader@3e955f6, see the next \r\nexception for details.\r\n       at \r\norg.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(U\r\nnknown Source)\r\n       at \r\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTran\r\nsportAcrossDRDA(Unknown Source)\r\n       ... 41 more\r\n    Caused by: java.sql.SQLException: Exception during restore \r\nof a serializable or SQLData object of class \r\n       at \r\norg.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(U\r\nnknown Source)\r\n       at \r\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTran\r\nsportAcrossDRDA(Unknown Source)\r\n       at \r\norg.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException\r\n(Unknown Source)\r\n       at \r\norg.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown \r\nSource)\r\n       ... 38 more\r\n    Caused by: ERROR XSDA8: Exception during restore of a \r\nserializable or SQLData object of class \r\n       at \r\norg.apache.derby.iapi.error.StandardException.newException(Unkno\r\nwn Source)\r\n       at \r\norg.apache.derby.impl.store.raw.data.StoredPage.readRecordFromAr\r\nray(Unknown Source)\r\n       at \r\norg.apache.derby.impl.store.raw.data.StoredPage.restoreRecordFro\r\nmSlot(Unknown Source)\r\n       at \r\norg.apache.derby.impl.store.raw.data.BasePage.fetchFromSlot(Unkn\r\nown Source)\r\n       at \r\norg.apache.derby.impl.store.access.conglomerate.GenericScanContr\r\noller.fetchRows(Unknown Source)\r\n       at \r\norg.apache.derby.impl.store.access.heap.HeapScan.fetchNext(Unkno\r\nwn Source)\r\n       at \r\norg.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescript\r\norViaHeap(Unknown Source)\r\n       at \r\norg.apache.derby.impl.sql.catalog.DataDictionaryImpl.getAllSPSDe\r\nscriptors(Unknown Source)\r\n       at \r\norg.apache.derby.impl.sql.catalog.DataDictionaryImpl.dropJDBCMet\r\nadataSPSes(Unknown Source)\r\n       at \r\norg.apache.derby.impl.sql.catalog.DataDictionaryImpl.updateMetad\r\nataSPSes(Unknown Source)\r\n       at \r\norg.apache.derby.impl.sql.catalog.DD_Version.doFullUpgrade(Unkno\r\nwn Source)\r\n       at \r\norg.apache.derby.impl.sql.catalog.DD_Version.upgradeIfNeeded(Unk\r\nnown Source)\r\n       at \r\norg.apache.derby.impl.sql.catalog.DataDictionaryImpl.loadDiction\r\naryTables(Unknown Source)\r\n       at \r\norg.apache.derby.impl.sql.catalog.DataDictionaryImpl.boot(Unknow\r\nn Source)\r\n       at \r\norg.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.impl.services.monitor.TopService.bootModule(Unk\r\nnown Source)\r\n       at \r\norg.apache.derby.impl.services.monitor.BaseMonitor.startModule(U\r\nnknown Source)\r\n       at \r\norg.apache.derby.iapi.services.monitor.Monitor.bootServiceModule\r\n(Unknown Source)\r\n       at org.apache.derby.impl.db.BasicDatabase.boot(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown \r\nSource)\r\n       at \r\norg.apache.derby.impl.services.monitor.TopService.bootModule(Unk\r\nnown Source)\r\n       at \r\norg.apache.derby.impl.services.monitor.BaseMonitor.bootService(U\r\nnknown Source)\r\n       at \r\norg.apache.derby.impl.services.monitor.BaseMonitor.startProvider\r\nService(Unknown Source)\r\n       at \r\norg.apache.derby.impl.services.monitor.BaseMonitor.findProviderA\r\nndStartService(Unknown Source)\r\n       at \r\norg.apache.derby.impl.services.monitor.BaseMonitor.startPersiste\r\nntService(Unknown Source)\r\n       at \r\norg.apache.derby.iapi.services.monitor.Monitor.startPersistentSe\r\nrvice(Unknown Source)\r\n       ... 38 more\r\n    Caused by: java.io.StreamCorruptedException: \r\njava.lang.ClassCastException: \r\norg.apache.derby.catalog.types.OldRoutineType incompatible with \r\norg.apache.derby.iapi.types.DataTypeDescriptor\r\n       at \r\norg.apache.derby.iapi.services.io.FormatIdInputStream.readObject\r\n(Unknown Source)\r\n       at \r\norg.apache.derby.impl.sql.GenericResultDescription.readExternal(\r\nUnknown Source)\r\n       at \r\norg.apache.derby.iapi.services.io.FormatIdInputStream.readObject\r\n(Unknown Source)\r\n       at \r\norg.apache.derby.impl.sql.GenericStorablePreparedStatement.readE\r\nxternal(Unknown Source)\r\n       at \r\norg.apache.derby.iapi.services.io.FormatIdInputStream.readObject\r\n(Unknown Source)\r\n       at \r\norg.apache.derby.iapi.types.UserType.readExternal(Unknown \r\nSource)\r\n       ... 63 more\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10365","value":"Crash","id":"10365"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36566","summary":"10.3 to 10.5 upgrade fails with ava.io.StreamCorruptedException: java.lang.ClassCastException: org.apache.derby.catalog.types.OldRoutineType incompatible with org.apache.derby.iapi.types.DataTypeDescriptor","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10102","value":"Patch Available","id":"10102"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10427","value":"Workaround attached","id":"10427"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":17,"total":17,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12964959","id":"12964959","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"A few more notes.  Attempting the upgrade with an isolated URLClassLoader  did not pop the issue, see attached  ClassLoaderUpgrade.java for that attempt, nor did it reproduce for someone trying to use the same environment/software here in the US. (User seeing the problem is in Europe.)  The Derby version being used is 10.5.3.1 - (957402).  \r\n\r\nI have a copy of the the database after the problem occurs and it seems to be in a half upgraded state.  The database won't boot with 10.3 with the message\r\nERROR XSLAN: Database at C:<snip dbname>  has an incompatib\r\nle format with the current version of the software.  The database was created by  or upgraded by version 10.5,\r\n\r\nIf I connect with 10.5 does not have the new update statistics procedure in SYS.SYSALIASES.\r\n\r\nHappily if I reconnect with 10.5 with upgrade=true, the update statistics procedure is created.\r\n\r\n\r\nI don't actually see where the  cast might occur  in FormatIdInputStream.readObject , but do see this code and comment:\r\n\r\n    catch (ClassCastException cce)\r\n        {\r\n\t\t\t// We catch this here as it is usuall a user error.\r\n\t\t\t// they have readExternal (or SQLData) that doesn't match\r\n\t\t\t// the writeExternal. and thus the object read is of\r\n\t\t\t// the incorrect type, e.g. Integer i = (Integer) in.readObject();\r\n\t\t\tthrow new StreamCorruptedException(cce.toString());\r\n\t\t}\r\n\r\nPerhaps the cce.toString() does not give the full nested exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-11-29T21:51:52.824+0000","updated":"2010-11-29T21:55:02.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12964964","id":"12964964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"ClassLoaderUpgrade.java is a program  I used to see if this problem would reproduce with upgrade with a URLClassLoader.  It did not. dbname and DERBY_LIB_DIR need to be changed for user environment.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-11-29T22:04:09.666+0000","updated":"2010-11-29T22:04:09.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12965017","id":"12965017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Patch to use initCause on the new StreamCorruptionException to include the ClassCastException stack trace. I will run suites.All, but don't think it actually exercises this code, so a visual check would be good.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-11-30T00:10:14.568+0000","updated":"2010-11-30T00:10:14.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12965084","id":"12965084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"+1 for use initCause on the new StreamCorruptionException to include the ClassCastException stack trace after visual check and compile on my client space.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2010-11-30T03:46:30.578+0000","updated":"2010-11-30T03:46:30.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12965226","id":"12965226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The serialization of data types seems to have changed in both 10.4 and 10.5. It would be interesting to know if you see this problem when upgrading the database from 10.3 to 10.4. If that works, try upgrading from 10.4 to 10.5.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2010-11-30T14:09:32.061+0000","updated":"2010-11-30T14:09:32.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12970321","id":"12970321","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I got the nested exception back  after the initcause patch which is \r\n\r\n\t... 63 more\r\nCaused by: java.lang.ClassCastException: org.apache.derby.catalog.types.OldRoutineType incompatible with org.apache.derby.iapi.types.DataTypeDescriptor\r\n\tat org.apache.derby.impl.sql.GenericColumnDescriptor.readExternal(GenericColumnDescriptor.java:223)\r\n\tat org.apache.derby.iapi.services.io.FormatIdInputStream.readObject(FormatIdInputStream.java:126)\r\n\t... 69 more\r\n\r\n * Read this object from a stream of stored objects.\r\n\t *\r\n\t * @param in read this.\r\n\t *\r\n\t * @exception IOException\t\t\t\t\tthrown on error\r\n\t * @exception ClassNotFoundException\t\tthrown on error\r\n\t */\r\n\tpublic void readExternal(ObjectInput in) \r\n\t\tthrows IOException, ClassNotFoundException\r\n\t{\r\n\t\tFormatableHashtable fh = (FormatableHashtable)in.readObject();\t\t\r\n\t\tname = (String)fh.get(\"name\");\r\n\t\ttableName = (String)fh.get(\"tableName\");\r\n\t\tschemaName = (String)fh.get(\"schemaName\");\r\n\t\tcolumnPos = fh.getInt(\"columnPos\");\r\n\t\ttype = (DataTypeDescriptor)fh.get(\"type\");\r\n\t\tisAutoincrement = fh.getBoolean(\"isAutoincrement\");\r\n\t\tupdatableByCursor = fh.getBoolean(\"updatableByCursor\");\r\n\t}\r\n\t\r\n\r\nMike said this to me, which looks like a good clue:\r\n\r\n\r\nThis kind of code exists:   /**\r\n    * Old releases (10.3 and before) wrote out the runtime\r\n    * DataTypeDescriptor for routine parameter and return types.\r\n    * 10.4 onwards (DERBY-2775) always writes out the catalog\r\n    * type TypeDescriptor. Here we see what object was read from\r\n    * disk and if it was the old type, now mapped to OldRoutineType,\r\n    * we extract the catalog type and use that.\r\n    *\r\n    * @param onDiskType The object read that represents the type.\r\n    * @return A type descriptor.\r\n    */\r\n   private static TypeDescriptor getStoredType(Object onDiskType)\r\n   {\r\n       if (onDiskType instanceof OldRoutineType)\r\n           return ((OldRoutineType) onDiskType).getCatalogType();\r\n       return (TypeDescriptor) onDiskType;\r\n   }\r\nkey might be to figure out if this code should also be in GenericResultDescription.\r\n\r\n\r\n\r\nStill working to get a local reproduction.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-12-10T21:42:44.962+0000","updated":"2010-12-10T22:00:41.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12970351","id":"12970351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"OldRoutineType was introduced with DERBY-2775 so linking this issue to that one.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-12-11T00:17:42.094+0000","updated":"2010-12-11T00:17:42.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12975552","id":"12975552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is a reproduction for this issue.\r\nRun the script 10_3work.sql with 10.3 and then the program TestGetFunctions with 10.5\r\n\r\nThe test case can probably be narrowed down some.  But the problem has been so elusive that  I just wanted to get the repro posted before mucking with it more.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-12-28T16:16:29.194+0000","updated":"2010-12-28T16:16:29.194+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12975563","id":"12975563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"In the second part of the reproduction, only the connection is important in TestGetFunctions.   I can reproduce with just ij by \r\n1) Run 10_3work.sql with 10.3\r\n3) Connect with connect 'jdbc:derby:wombat;create=true;upgrade=true'; with 10.5\r\n\r\nOddly the create=true attribute is important as I tried several times without it and could not reproduce.  I am not sure why it would make a difference as the database is not being created.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-12-28T17:11:10.311+0000","updated":"2010-12-28T17:11:10.311+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12975576","id":"12975576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I noticed if I change the Upgrade tests to specify both upgrade=true and create=true on hard upgrade   I hit eight instances of this error, e.g.\r\nIndex: java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/Pha\r\nseChanger.java\r\n===================================================================\r\n--- java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/PhaseC\r\nhanger.java     (revision 1053401)\r\n+++ java/testing/org/apache/derbyTesting/functionTests/tests/upgradeTests/PhaseC\r\nhanger.java     (working copy)\r\n@@ -99,7 +99,7 @@\r\n\r\n         case UpgradeChange.PH_HARD_UPGRADE:\r\n             JDBCDataSource.setBeanProperty(ds, \"connectionAttributes\",\r\n-                    \"upgrade=true\");\r\n+                    \"upgrade=true;create=true\");\r\n             break;\r\n         default:\r\n             break;\r\n\r\n\r\n\r\nI don't really want to change the upgrade tests in this way permanantly, but will try to figure out how to have a sparate PH_HARD_UPGRADE_WITH_CREATE phase to test this issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-12-28T18:34:46.088+0000","updated":"2010-12-28T18:34:46.088+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12975819","id":"12975819","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is a patch for this issue, derby-4913_diff.txt.   In GenericColumnDescriptor we needed to handle the case where an OldRoutineType was stored  rather than a DataTypeDescriptor.\r\n  \r\nA few notes:\r\n- I did not investigate why specifying create with upgrade triggers a different code path.\r\n- Rather than making OldRoutineType public I just assume it is a OldRoutineType if it is not already a DataTypeDescriptor, since these are the only two options. \r\n- For testing, I just added another iteration of the upgrade tests, just for 10.3.3.0 with both upgrade and create set.  \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-12-29T16:17:46.089+0000","updated":"2010-12-29T16:17:46.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12975866","id":"12975866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Here is an updated patch derby-4913_diff2.txt.  After talking to Lily on IRC, I made the folllowing changes:\r\n\r\n1) Improved the comment for getStoredDataTypeDescriptor\r\n2) Changed the upgrade tests to just always run with create for 10.3.3.0 and removed the extra run. We should get enough coverage for 10.3 without the create by running 10.3.1.4. This way we avoid adding extra time to the tests.\r\n\r\nThanks Lily for looking at this.  will commit this afternoon and start back porting tomorrow.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-12-29T18:47:37.602+0000","updated":"2010-12-29T18:47:37.602+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12976730","id":"12976730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Would it be better to check the contents of the version object instead of checking the offset? I think we have a way to run the upgrade tests against a specific set of old versions, in which case 10.3.3.0 may be at a different offset.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-01-03T13:30:37.920+0000","updated":"2011-01-03T13:30:37.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12977436","id":"12977436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thank you Knut for looking at the patch. Here is the test fix to check the actual version and not the offset. I'll go ahead and check it in.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-01-04T20:04:34.147+0000","updated":"2011-01-04T20:04:34.147+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/12979807","id":"12979807","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Merged fix and test from trunk back to 10.5 and fix only to 10.4.  Earlier  branches are not affected.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-01-10T22:24:33.508+0000","updated":"2011-01-10T22:24:33.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/13001074","id":"13001074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Sounds good, but of course deregister=false will be the common usage to keep the driver loaded. true is the default so I am guessing would be rarely used.  Thank you Kim for picking up the documentation issue!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-03-01T19:57:16.138+0000","updated":"2011-03-01T19:57:16.138+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12480760/comment/13532797","id":"13532797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think implementing this will entail invoking something similar to ExceptionUtil.dumpThreads and JVMInfo javaDump() in the test code.\r\nThen in SpawnedProcess.complete before destroying the process we would have to somehow trigger the thread dump of the process that is to be destroyed. I am not quite sure how to force the dump to occur in the spawned process.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-12-14T23:45:05.134+0000","updated":"2012-12-14T23:45:05.134+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4913/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06mf3:"}}