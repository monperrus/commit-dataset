{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12634415","self":"https://issues.apache.org/jira/rest/api/latest/issue/12634415","key":"DERBY-6094","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2013-03-07 04:26:05.601","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"314908","customfield_12310222":"1_*:*_1_*:*_1204587370_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-03-13T13:18:09.178+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6094/watchers","watchCount":4,"isWatching":false},"created":"2013-02-27T14:41:41.844+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"11.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12364935","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12364935","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12354444","key":"DERBY-2026","self":"https://issues.apache.org/jira/rest/api/2/issue/12354444","fields":{"summary":"Setting a login timeout in client driver can lead to query timeout","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12364934","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12364934","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12616758","key":"DERBY-6000","self":"https://issues.apache.org/jira/rest/api/2/issue/12616758","fields":{"summary":"Implement support for JDBC 4.2","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12365609","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12365609","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12636772","key":"DERBY-6107","self":"https://issues.apache.org/jira/rest/api/2/issue/12636772","fields":{"summary":"Investigate why setting a login timeout causes NativeAuthenticationServiceTest to fail when run in a suite","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12371583","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12371583","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12642023","key":"DERBY-6167","self":"https://issues.apache.org/jira/rest/api/2/issue/12642023","fields":{"summary":"Interrupt restarts clock for login timeout","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12366163","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12366163","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"12638364","key":"DERBY-6122","self":"https://issues.apache.org/jira/rest/api/2/issue/12638364","fields":{"summary":"InterruptResilienceTest fails with: junit.framework.ComparisonFailure: Database shutdown expected:<[08006]> but was:<[XBDA0]>","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-03-24T23:15:01.456+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"}],"timeoriginalestimate":null,"description":"If you set a login timeout using the DriverManager, Derby ignores the setting. I will attach a test case which shows this.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10367","value":"Deviation from standard","id":"10367"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"315252","summary":"Derby ignores DriverManager.setLoginTimeout()","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":23,"total":23,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13588394","id":"13588394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching LoginTimeoutTest, a program which shows this problem. The test installs a user authenticator which takes 5 seconds to do its job. If you set the login timeout to 1 second and try to connect to Derby, you will get a Derby connection after 5 seconds.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-02-27T14:44:08.347+0000","updated":"2013-02-27T14:44:08.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13588396","id":"13588396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Linking to DERBY-6000 because this issue was discovered while buddy-testing the JDBC 4.2 support: http://wiki.apache.org/db-derby/TenTenOneBuddyTesting. Also linking to DERBY-2026 because Dag posed a question there about whether we even test DriverManager.setLoginTimeout(). Apparently we don't.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-02-27T14:46:18.935+0000","updated":"2013-02-27T14:46:18.935+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13588550","id":"13588550","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"In private email, JDBC spec lead Lance Andersen confirms that the Driver implementation (not the DriverManager itself) is responsible for enforcing login timeouts.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-02-27T17:41:15.969+0000","updated":"2013-02-27T17:41:15.969+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13590527","id":"13590527","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a new version of LoginTimeoutTest, correcting a bug which caused it to always set the login timeout to 1 second.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-01T13:58:20.090+0000","updated":"2013-03-01T13:58:20.090+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13590896","id":"13590896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a new version of LoginTimeoutTest. This version shows what Derby does in the following situations:\r\n\r\n1) An embedded app tries to connect after calling DriverManager.setLoginTimeout() on the embedded VM.\r\n\r\n2) A client app tries to connect after someone called DriverManager.setLoginTimeout() on the server VM.\r\n\r\n3) A client app tries to connect after calling DriverManager.setLoginTimeout() on the client VM.\r\n\r\nI believe that in all 3 situations, sluggish logins should result in java.sql.SQLTimeoutException. The behavior right now is:\r\n\r\n(1) and (2): no exception\r\n\r\n(3): a java.sql.SQLNonTransientConnectionException\r\n\r\nI have coded a candidate solution, but I want to run a battery of tests before submitting it for community review.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-01T20:08:45.065+0000","updated":"2013-03-01T20:08:45.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13593850","id":"13593850","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a new version of LoginTimeoutTest. This version shows the login timeout behavior of Derby's DataSources also.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-05T20:08:43.919+0000","updated":"2013-03-05T20:08:43.919+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13595535","id":"13595535","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Good tests. Minor: comment say 5 seconds sleep, code says 2.\r\n\r\nI don't quite understand this result:\r\n\r\nStopping server...\r\nStarting server with timeout 10\r\n:\r\nSetting timeout 10 on local connector\r\n    Testing derby6094.Derby6094$DriverManagerConnector( jdbc:derby://localhost:8246/memory:db1 )\r\n        java.sql.SQLNonTransientConnectionException: SQLState = 08001. Message = java.net.ConnectException : \\\r\n             Error connecting to server localhost on port 8246 with message Connection refused: connect.\r\n        Experiment took 1030 milliseconds.\r\n\r\nIf both the client and the server side timeout is 10 seconds (I presume only the client side one sets any actual timeout: on the socket) and the authenticator sleeps only 2 (or 5) seconds, why the failure?\r\n\r\nAnother question: You fork a server, but the test has unused code for starting the server via the API in the same VM. Have you seen a difference in behavior there?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-03-07T04:26:05.601+0000","updated":"2013-03-07T04:27:28.603+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13595880","id":"13595880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Dag,\r\n\r\nThanks for taking a look at the LoginTimeoutTest repro. Attaching a new version of the repro which fixes that typo you found.\r\n\r\nI agree that the result you are seeing is odd. I don't see that result myself. This is a warning to me: when I turn this code into a regression test, it may be plagued by heisenbugs like our other timing-sensitive network tests. This is the result I see:\r\n\r\nStopping server...\r\nStarting server with timeout 10\r\n\r\nSetting timeout 1 on local connector\r\n    Testing LoginTimeoutTest$DriverManagerConnector( jdbc:derby://localhost:8246/memory:db1 )\r\n        java.sql.SQLNonTransientConnectionException: SQLState = 08006. Message = A communications error has been detected: Read timed out.\r\n        Experiment took 1040 milliseconds.\r\nSetting timeout 10 on local connector\r\n    Testing LoginTimeoutTest$DriverManagerConnector( jdbc:derby://localhost:8246/memory:db1 )\r\n        Ha! Got a org.apache.derby.client.net.NetConnection40\r\n        Experiment took 4010 milliseconds.\r\n\r\nNote that when I ran the experiment, the odd test case succeeded (as expected), but it took 4 seconds rather than the authentication sleep time of 2 seconds. That is because Derby does double authentication when you create a database. I don't understand why you are seeing a \"connection refused\" error after 1 second when you run that experiment. A socket timeout ought to be reported as such, as you can see from the immediately preceding experiment on my machine. So it seems that you are seeing some other communications failure. Are your results reproducible?\r\n\r\nIt's true that an earlier rev of the test ran the server in the same VM as the client. I thought that would make the test run faster because I wouldn't have to keep bouncing the server. But I abandoned that approach early on because it didn't test the case where the client and server set different timeouts.\r\n\r\nThanks,\r\n-Rick\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-07T13:51:19.018+0000","updated":"2013-03-07T13:51:19.018+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13596044","id":"13596044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6094-01-ac-enforceDriverManagerLoginTimeout.diff. This is the first rev of a patch to fix this issue. The new regression test is vacuous and needs to be beefed up with the actual test cases from the repro. I am attaching this patch because I would like to get advice and early feedback from the community.\r\n\r\nAt a high level, the patch does the following:\r\n\r\n1) Enforces login timeouts on the embedded driver and data sources.\r\n\r\n2) Makes client-side login timeouts conform to the JDBC 4.2 spec. That is, makes them raise SQLTimeoutException rather than the less refined SQLTransientException.\r\n\r\n3) Adds a debug flag so that JUnit tests can be run with login timeouts set.\r\n\r\nI would like the community's feedback on the following issues:\r\n\r\nA) Login timeouts are NOT implemented for CDC/FP 1.1. This is because I used java.util.concurrent classes to implement login timeouts and those classes are not available on CDC/FP 1.1. I think that it should be possible to implement login timeouts using the Thread support in FP 1.1, but I think that the java.util.concurrent approach is going to be easier to understand and maintain and likely to be more robust. If someone cares about login timeouts on CDC/FP 1.1, please speak up. We can log another JIRA for adding that feature. Note that I'm not volunteering to do that work: it's not an important platform to me.\r\n\r\nB) I am not sure what to do about Thread interrupts incurred during a timed login attempt. I would like advice from the experts on Derby interrupt handling. The attached patch simply wraps the interrupt exception in a SQLException. But maybe the right thing to do is to retry the login attempt until the timer expires. Or something else. I tripped across this problem while running InterruptResilienceTest with login timeouts. When I run that test like this...\r\n\r\njava -Dderby.tests.login.timeout=10 junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.store.InterruptResilienceTest\r\n\r\n...I get errors in testRAFReadWriteMultipleThreads. It looks to me like the following is happening: A WorkerThread catches an interrupted lock exception, which it expects will happen from time to time. The WorkerThread then goes on to create a new connection but gets another interrupt before the login timeout expires.\r\n\r\n\r\nTouches the following files:\r\n\r\n------------------\r\n\r\nM       java/build/org/apache/derbyBuild/splitmessages.java\r\nM       java/engine/org/apache/derby/impl/jdbc/SQLExceptionFactory40.java\r\nM       java/engine/org/apache/derby/loc/messages.xml\r\nM       java/shared/org/apache/derby/shared/common/reference/SQLState.java\r\nM       java/client/org/apache/derby/client/am/SQLExceptionFactory40.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/ErrorCodeTest.java\r\n\r\nNew SQLState for login timeouts. This is wrapped in a SQLTimeoutException on Java 6 and higher.\r\n\r\n------------------\r\n\r\nM       java/engine/org/apache/derby/jdbc/InternalDriver.java\r\nM       java/engine/org/apache/derby/jdbc/Driver169.java\r\nM       java/engine/org/apache/derby/jdbc/Driver20.java\r\n\r\nThe guts of (1). This is where the java.util.concurrent classes are used to enforce login timeouts for the embedded driver.\r\n\r\n------------------\r\n\r\nM       java/engine/org/apache/derby/impl/jdbc/LOBStoredProcedure.java\r\nM       java/engine/org/apache/derby/impl/jdbc/authentication/NativeAuthenticationServiceImpl.java\r\nM       java/engine/org/apache/derby/impl/db/SlaveDatabase.java\r\nM       java/engine/org/apache/derby/jdbc/EmbeddedBaseDataSource.java\r\nM       java/engine/org/apache/derby/jdbc/EmbeddedSimpleDataSource.java\r\nM       java/engine/org/apache/derby/catalog/SystemProcedures.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/tools/RollBackWrappingWhenFailOnImportTest.java\r\n\r\nThe changes to the embedded driver resulted in an api change which percolated through the classes above.\r\n\r\n------------------\r\n\r\nM       java/client/org/apache/derby/client/net/NetConnection.java\r\n\r\nThis is the enforcement of (2), the raising of SQLTimeoutException on the client when the login timeout expires.\r\n\r\n------------------\r\n\r\nM       java/testing/org/apache/derbyTesting/junit/DriverManagerConnector.java\r\nM       java/testing/org/apache/derbyTesting/junit/DataSourceConnector.java\r\nM       java/testing/org/apache/derbyTesting/junit/TestConfiguration.java\r\nM       java/testing/org/apache/derbyTesting/junit/XADataSourceConnector.java\r\nM       java/testing/org/apache/derbyTesting/junit/JDBCDataSource.java\r\nM       java/testing/org/apache/derbyTesting/junit/ConnectionPoolDataSourceConnector.java\r\nM       java/testing/org/apache/derbyTesting/junit/Connector.java\r\n\r\nThe changes for (3). Adds a new debug flag: derby.tests.login.timeout. You can set this to an integer, the length in seconds of the login timeout which you want to apply to all connection attempts. I have run the full JUnit suite with this flag set to 10. The tests run cleanly except for the following problems:\r\n\r\ni) The errors in InterruptResilienceTest described above.\r\n\r\nii) I had to comment out NativeAuthenticationServiceTest. By itself, this test runs fine with derby.tests.login.timeout=10. However, when running the full JUnit suite with derby.tests.login.timeout=10, NativeAuthenticationServiceTest fails and its failure then chokes the rest of the suite. I need to investigate what's going on here.\r\n\r\n------------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/_Suite.java\r\nA       java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/LoginTimeoutTest.java\r\n\r\nThis is the shell of a new test which will contain the cases from the repro.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-07T16:47:16.657+0000","updated":"2013-03-07T16:47:16.657+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13597322","id":"13597322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6094-01-ad-enforceDriverManagerLoginTimeout.diff. This version of the patch beefs up LoginTimeoutTest with test cases from the repro. I'm running tests now. If the tests pass, I plan to commit this version.\r\n\r\nI'm still interested in the community's advice about how thread interrupts should interact with login timeouts.\r\n\r\nI've also looked into the failures in NativeAuthenticationServiceTest which appear when you put it in a suite with another test and set derby.tests.login.timeout=10. I'm fairly certain that this is a test design defect but I haven't gotten to the bottom of it yet.\r\n\r\n\r\n\r\nTouches the following additional file:\r\n\r\nM       java/testing/org/apache/derbyTesting/junit/JDBCClient.java\r\n\r\nMade the DERBYNETCLIENT constant public so that LoginTimeoutTest can use it.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-08T17:39:18.314+0000","updated":"2013-03-08T17:39:40.068+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13597489","id":"13597489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6094-01-ae-enforceDriverManagerLoginTimeout.diff. This third rev of the patch changes LoginTimeoutTest to use the singleUseDatabaseDecorator rather than CleanDatabaseTestSetup. For some reason, CleanDatabaseTestSetup results in errors when LoginTimeoutTest is run in a suite alongside other JUnit tests. Re-running the JUnit tests...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-08T20:02:55.504+0000","updated":"2013-03-08T20:02:55.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13597615","id":"13597615","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"JUnit tests passed cleanly for me on derby-6094-01-ae-enforceDriverManagerLoginTimeout.diff. Committed at subversion revision 1454600.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-08T22:05:41.419+0000","updated":"2013-03-08T22:05:41.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598157","id":"13598157","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks, Rick. For the record, the odd results I saw was due to pilot error (NetBeans doesn't pass the active class path to the server subprocess, to it never got started). I'll have a look at the interrupts issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-03-10T04:35:10.218+0000","updated":"2013-03-10T04:35:26.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598174","id":"13598174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Currently, when Derby sees an interrupt, it does one of two things: a) if it is at a reasonable point to stop execution, e.g. waiting for a lock, or between statements in a batch, it will return control to the user with an exception b) if it is not in such a point of execution, it will make a note, but proceed, but possibly throw later, cf. point a).  In both cases the interrupt flag remains set when the user regains control (i.e the JDBC call returns).\r\n\r\nI think in a login situation, we would only want to stop execution of the login if it is safe (as in in we wouldn't lose resources or cause internal inconsistencies). I see you use the Future class to carry out the login using an upper time bound corresponding to the login timeout. I don't know how the execution of the asynchronous task would be stopped in such a case. Would it be safe (necessarily)?\r\n\r\nIf the Future#get method throws an interrupt exception, we could retry but with a shorter timeout, I guess (after noting and clearing the flag as per our common approach). Since we already have a mechanism for stopping if login takes too long I don't see the need for having interrupts as a mechanism to stop it.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-03-10T06:26:08.603+0000","updated":"2013-03-10T06:26:08.603+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598177","id":"13598177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The new test failed in the latest nightly test cycle:\r\n\r\nhttp://download.java.net/javadesktop/derby/javadb-5573775-report/javadb-5573775-3606706-details.html\r\n\r\njunit.framework.AssertionFailedError: Should have been able to connect!\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbc4.LoginTimeoutTest.tryTimeout(LoginTimeoutTest.java:290)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbc4.LoginTimeoutTest.tryTimeout(LoginTimeoutTest.java:277)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbc4.LoginTimeoutTest.vetConnector(LoginTimeoutTest.java:266)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbc4.LoginTimeoutTest.testBasic(LoginTimeoutTest.java:255)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:117)\r\n        (...)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-03-10T07:21:25.779+0000","updated":"2013-03-10T07:21:25.779+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598207","id":"13598207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading a modified Driver20.java suggesting how we could handle interrupts seen in the util.concurrent calls. Basically, the code retries the connect until the timeout has happened or success, reestablish the interrupt flag on exit. This also makes InterruptResilienceTest work in my environment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-03-10T11:07:40.210+0000","updated":"2013-03-10T11:07:40.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598781","id":"13598781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks, Dag. The change to Driver20 looks good to me. I suppose that in an interrupt-intensive application, this change could result in login timeouts lasting up to twice the time which the application specifies. In such an environment, timing is likely to be throw off a lot. I don't think this needs to be sanded down further. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-11T12:49:35.541+0000","updated":"2013-03-11T12:49:35.541+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598845","id":"13598845","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6094-02-aa-createDBFirst.diff. Hopefully, this will fix the failure in LoginTimeoutTest seen on Linux. Committed at subversion revision 1455156.\r\n\r\nI ran the LoginTimeoutTest on Java 7 on Linux running inside VirtualBox on Mac OSX. The test failed for me there. For some reason, database creation takes a long time in that environment. This caused an initial connection attempt to fail on a login timeout when the test expected the connection attempt to succeed. I have changed the test in order to remove this source of heisenbugs. Now the test creates the database before trying to test timeouts.\r\n\r\nWhile I was in there, I also added some more defensive logic to make the test cleanup after itself when an unexpected error occurs.\r\n\r\nTouches the following files:\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/LoginTimeoutTest.java\r\nM       java/testing/org/apache/derbyTesting/junit/BaseTestCase.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-11T14:20:32.853+0000","updated":"2013-03-11T14:20:32.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598872","id":"13598872","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6094-03-aa-retryOnInterrupt.diff. This patch applies Dag's suggested changes. I am running tests now.\r\n\r\nI also added a login timeout to the InterruptResilienceTest. That forces the new logic to be excercised.\r\n\r\nWith the new logic, I have successfully run InterruptResilienceTest and LoginTimeoutTest on Mac OSX and on Linux on top of VirtualBox on top of Mac OSX.\r\n\r\nTouches the following files:\r\n\r\nM       java/engine/org/apache/derby/jdbc/Driver20.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/store/InterruptResilienceTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-11T15:04:51.055+0000","updated":"2013-03-11T15:04:51.055+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598948","id":"13598948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for fixing the test instability, Rick.\r\n\r\nTwo small nits:\r\n\r\n- The new connection that's used to ensure the database is created, should probably be closed after use (connections created with openDefaultConnection() aren't automatically closed by the framework).\r\n\r\n- The new minion failWithTrace() duplicates the functionality in BaseTestCase.fail(String msg, Throwable t), except the latter will make the original stack trace available to the JUnit machinery, not just print it to the console.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-03-11T16:25:09.260+0000","updated":"2013-03-11T16:25:09.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598974","id":"13598974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Tests passed cleanly for me on derby-6094-03-aa-retryOnInterrupt.diff. Committed at subversion revision 1455230.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-11T16:51:14.720+0000","updated":"2013-03-11T16:51:14.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13598999","id":"13598999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for the quick review, Knut. Attaching derby-6094-04-aa-testCleanup.diff. This patch makes the changes Knut suggested. The patched test runs cleanly for me on Mac OSX and on Linux on VirtualBox on Mac OSX. Committed at subversion revision 1455238.\r\n\r\nTouches the following file:\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/jdbc4/LoginTimeoutTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-11T17:08:09.406+0000","updated":"2013-03-11T17:08:09.406+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12634415/comment/13601127","id":"13601127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I believe the work on this issue is done. I have logged a follow-on issue, DERBY-6107, to investigate why setting a login timeout causes NativeAuthenticationServiceTest to fail when run inside a larger suite.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-03-13T13:18:09.202+0000","updated":"2013-03-13T13:18:09.202+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6094/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1icav:"}}