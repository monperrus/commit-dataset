{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12389682","self":"https://issues.apache.org/jira/rest/api/latest/issue/12389682","key":"DERBY-3475","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-02-28 13:56:43.709","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23658","customfield_12310222":"1_*:*_1_*:*_511848543_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_2707481","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-03-04T10:54:54.089+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3475/watchers","watchCount":0,"isWatching":false},"created":"2008-02-27T12:44:05.546+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-03-04T11:40:01.554+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312050","id":"12312050","name":"Replication"}],"timeoriginalestimate":null,"description":"Master:\nij> connect 'jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost';\nij(CONNECTION1)> delete from t where i > 8192;\n253952 rows inserted/updated/deleted\nij(CONNECTION1)> connect 'jdbc:derby:masterDB;user=oystein;password=pass;failover=true';\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\n\nSlave reports in the log:\n\n\n------------  BEGIN SHUTDOWN ERROR STACK -------------\n\nERROR XSLA7: Cannot redo operation null in the log.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525)\n\tat org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)\n\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)\n\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)\n\tat org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)\n\tat org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)\n\tat org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)\n\tat java.lang.Thread.run(Thread.java:619)\nCaused by: ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)\n\t... 17 more\n============= begin nested exception, level (1) ===========\nERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)\n\tat org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)\n\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)\n\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)\n\tat org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)\n\tat org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)\n\tat org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)\n\tat java.lang.Thread.run(Thread.java:619)\n============= end nested exception, level (1) ===========\n\n\n------------  END SHUTDOWN ERROR STACK -------------\n\n--------  BEGIN REPLICATION ERROR MESSAGE ---------\nReplication slave got a fatal error for database 'slaveDB'. Replication will be stopped.\nReplication slave role was stopped for database 'slaveDB'.\n\n2008-02-27 12:03:00.830 GMT:\nShutting down instance a816c00e-0118-5ac5-f06b-000003e6d478\n----------------------------------------------------------------\nERROR XSLAA: The store has been marked for shutdown by an earlier exception.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:279)\n\tat org.apache.derby.impl.store.raw.log.LogToFile.appendLogRecord(LogToFile.java:3696)\n\tat org.apache.derby.impl.services.replication.slave.SlaveController$SlaveLogReceiverThread.handleLogChunk(SlaveController.java:540)\n\tat org.apache.derby.impl.services.replication.slave.SlaveController$SlaveLogReceiverThread.run(SlaveController.java:486)\nCaused by: ERROR XSLA7: Cannot redo operation null in the log.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525)\n\tat org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)\n\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)\n\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)\n\tat org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)\n\tat org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)\n\tat org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)\n\tat java.lang.Thread.run(Thread.java:619)\nCaused by: ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)\n\t... 17 more\n============= begin nested exception, level (1) ===========\nERROR XSLA7: Cannot redo operation null in the log.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525)\n\tat org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)\n\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)\n\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)\n\tat org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)\n\tat org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)\n\tat org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)\n\tat java.lang.Thread.run(Thread.java:619)\nCaused by: ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)\n\t... 17 more\n============= end nested exception, level (1) ===========\n============= begin nested exception, level (2) ===========\nERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)\n\tat org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)\n\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\n\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)\n\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)\n\tat org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:425)\n\tat org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)\n\tat org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:312)\n\tat java.lang.Thread.run(Thread.java:619)\n============= end nested exception, level (2) ===========\n\n---------  END REPLICATION ERROR MESSAGE ----------\nReplication slave role was stopped for database 'slaveDB'.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39522","summary":"Replication:  Slave reports ERROR XSLA7: Cannot redo operation null in the log.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Derby trunk revision 631534 + DERBY 3205 patch failover-slave-2a.","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":8,"total":8,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389682/comment/12572898","id":"12572898","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"If I try to do recovery on the slave database, I get the same error again:\r\n\r\n------------  BEGIN SHUTDOWN ERROR STACK -------------\r\n\r\nERROR XSLA7: Cannot redo operation null in the log.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:296)\r\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1525)\r\n\tat org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)\r\n\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\r\n\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\r\n\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)\r\n\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1836)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1702)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1582)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:1001)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:542)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2369)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.java:336)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection30.<init>(EmbedConnection30.java:73)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection40.<init>(EmbedConnection40.java:54)\r\n\tat org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)\r\n\tat org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:226)\r\n\tat org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:582)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:154)\r\n\tat org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:1238)\r\n\tat org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:1088)\r\n\tat org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:916)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:328)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)\r\n\tat org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\r\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\r\n\tat org.apache.derby.impl.tools.ij.Main.main(Main.java:73)\r\n\tat org.apache.derby.tools.ij.main(ij.java:59)\r\n\tat org.apache.derby.iapi.tools.run.main(run.java:51)\r\nCaused by: ERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\r\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)\r\n\t... 39 more\r\n============= begin nested exception, level (1) ===========\r\nERROR XSLAO: Recovery failed unexpected problem log record is Not first but transaction is not in transaction table : 58625.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:286)\r\n\tat org.apache.derby.impl.store.raw.log.FileLogger.redo(FileLogger.java:1289)\r\n\tat org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:920)\r\n\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\r\n\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:419)\r\n\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:793)\r\n\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1836)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1702)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1582)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:1001)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:542)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2369)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.java:336)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection30.<init>(EmbedConnection30.java:73)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection40.<init>(EmbedConnection40.java:54)\r\n\tat org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)\r\n\tat org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:226)\r\n\tat org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:582)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:154)\r\n\tat org.apache.derby.impl.tools.ij.ij.dynamicConnection(ij.java:1238)\r\n\tat org.apache.derby.impl.tools.ij.ij.ConnectStatement(ij.java:1088)\r\n\tat org.apache.derby.impl.tools.ij.ij.ijStatement(ij.java:916)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:328)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)\r\n\tat org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\r\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\r\n\tat org.apache.derby.impl.tools.ij.Main.main(Main.java:73)\r\n\tat org.apache.derby.tools.ij.main(ij.java:59)\r\n\tat org.apache.derby.iapi.tools.run.main(run.java:51)\r\n============= end nested exception, level (1) ===========\r\n\r\n\r\n------------  END SHUTDOWN ERROR STACK -------------\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-02-27T12:51:37.001+0000","updated":"2008-02-27T12:51:37.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389682/comment/12572900","id":"12572900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"slaveDB.zip contains the slave database.\r\nDoing recovery on this DB should provoke the error.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-02-27T13:01:53.337+0000","updated":"2008-02-27T13:01:53.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389682/comment/12573285","id":"12573285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"body":"I have a pretty strong theory on this one:\r\n\r\nconnect with startSlave option does the following:\r\n\r\nboot db in pre-slave mode to check authentication. No datapages or log is modified by this boot.\r\nshutdown db\r\nboot db in slavemode.\r\n\r\nTheory: When booting up the second time, LogToFile#recover tries to read the last checkpoint. However, the log.ctrl file has been modified by the pre-slave boot and the checkpoint is therefore not found. It then tries to read the log from the beginning, and encounteres a log record that is not in the transaction table and is not a begin transaction. If this theory is correct, we have not noticed earlier because we started out with an empty master, and all log files therefore exist on the slave after the copy.\r\n\r\nI will investigate this further.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"created":"2008-02-28T13:56:43.709+0000","updated":"2008-02-28T13:56:43.709+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389682/comment/12573710","id":"12573710","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"body":"As expected, the problem was caused by the log.ctrl file pointing to the wrong place in the log. Patch 1a ensures that the control file is not updated when the database is booted in slave pre mode.\r\n\r\nWithout the patch, the error can be reproduced by using any master database where some old log files have been deleted.\r\n\r\nAll tests passed. Request for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"created":"2008-02-29T12:39:47.989+0000","updated":"2008-02-29T12:39:47.989+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389682/comment/12574392","id":"12574392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"If I run ReplicationRun_Local with this patch, the slave fails with the following error:\r\n\r\n2008-03-03 08:56:46.374 GMT:\r\nShutting down instance 72e9c096-0118-73db-611b-ffffb3022b6a\r\n----------------------------------------------------------------\r\nNew exception raised during cleanup 0 >= 0\r\njava.lang.ArrayIndexOutOfBoundsException: 0 >= 0\r\n\tat java.util.Vector.setElementAt(Vector.java:483)\r\n\tat org.apache.derby.impl.services.daemon.BasicDaemon.unsubscribe(BasicDaemon.java:180)\r\n\tat org.apache.derby.impl.store.raw.log.LogToFile.stop(LogToFile.java:3402)\r\n\tat org.apache.derby.impl.services.monitor.TopService.stop(TopService.java:405)\r\n\tat org.apache.derby.impl.services.monitor.TopService.shutdown(TopService.java:349)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(BaseMonitor.java:237)\r\n\tat org.apache.derby.impl.db.DatabaseContextImpl.cleanupOnError(DatabaseContextImpl.java:60)\r\n\tat org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:332)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:419)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:337)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2082)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.java:454)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection30.<init>(EmbedConnection30.java:73)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection40.<init>(EmbedConnection40.java:54)\r\n\tat org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68)\r\n\tat org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:226)\r\n\tat org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)\r\n\tat org.apache.derby.impl.drda.Database.makeConnection(Database.java:238)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.getConnFromDatabaseName(DRDAConnThread.java:1387)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.verifyUserIdPassword(DRDAConnThread.java:1337)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.parseSECCHK(DRDAConnThread.java:3122)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.parseDRDAConnection(DRDAConnThread.java:1131)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:937)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:279)\r\nCleanup action completed\r\n--------  BEGIN REPLICATION ERROR MESSAGE ---------\r\nReplication slave got a fatal error for database '/export/tmp/oysteing/derby-repl/testing_repl/db_master/wombat'. Replication will be stopped.\r\n---------  END REPLICATION ERROR MESSAGE ----------\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-03T09:19:19.979+0000","updated":"2008-03-03T09:19:19.979+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389682/comment/12574393","id":"12574393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"If I understand the patch correctly, when in replication slave pre\r\nmode, it both prevents checkpoints from being initiated and makes sure\r\na checkpoint is a null op.  Would not just making checkpoint be a null\r\nop be sufficient?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-03T09:25:40.370+0000","updated":"2008-03-03T09:25:40.370+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389682/comment/12574507","id":"12574507","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"body":"I agree - it's easier to read the code if only checkpoint is made a noop. The reported exception illustrates this perfectly. Patch v1b only makes checkpoint a noop. All tests passed. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"created":"2008-03-03T13:59:36.568+0000","updated":"2008-03-03T13:59:36.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389682/comment/12574926","id":"12574926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Patch 1b committed as revision 633419.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-04T10:46:07.262+0000","updated":"2008-03-04T10:46:07.262+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3475/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i074nz:"}}