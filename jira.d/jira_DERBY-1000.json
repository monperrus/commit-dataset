{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12329096","self":"https://issues.apache.org/jira/rest/api/latest/issue/12329096","key":"DERBY-1000","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-02-18 07:46:01.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22253","customfield_12310222":"1_*:*_1_*:*_12100101000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_377149000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-07-07T17:00:58.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1000/watchers","watchCount":0,"isWatching":false},"created":"2006-02-17T15:52:37.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.png","name":"Trivial","id":"5"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10920","id":"10920","description":"initial source drop","name":"10.0.2.0","archived":false,"released":true,"releaseDate":"2004-08-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/10991","id":"10991","description":"snapshot","name":"10.0.2.1","archived":false,"released":true,"releaseDate":"2004-12-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andersmo","name":"andersmo","emailAddress":"andersmo at stud dot ntnu dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anders Morken","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-30T00:14:43.470+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"derby.authentication.server does not recognize secure ldap url - ie if  the url starts with ldaps:// \n\nTrying to connect using LDAP authentication with the following properties set\nderby.authentication.provider=LDAP\nderby.authentication.server=ldaps://xyz.abc.com:636\nderby.authentication.ldap.searchBase='ou=xyz,o=abc.com'\nderby.authentication.ldap.searchFilter='(emailaddress=%USERNAME%)'\nderby.connection.requireAuthentication=true\n\nthrows InvalidNameException\n\nij> connect 'jdbc:derby:testdb;user=a;password=p';\nERROR 08004: Connection refused : javax.naming.InvalidNameException: Invalid name: /xyz.abc.com:636\n\nCode - LDAPAuthenticationSchemeImpl#setJNDIProviderProperties.\nProblem is the code expects that if Context.PROVIDER_URL is not and if derby.authentication.server is set, then the ldapServer is either of the format //server:port  or it already starts with ldap://  else it just adds ldap://  .\n\nThus for a ldaps://xyz.com:636  url , it will become ldap://ldaps://xyz.com:636\n\n                                                                                     in the code snippet, dflLDAPURL is ldap://\n\n\t\t\t\tif (ldapServer.startsWith(dfltLDAPURL))\n\t\t\t\t\tthis.providerURL = ldapServer;\n\t\t\t\telse if (ldapServer.startsWith(\"//\"))\n\t\t\t\t\tthis.providerURL = \"ldap:\" + ldapServer;\n\t\t\t\telse\n\t\t\t\t\tthis.providerURL = dfltLDAPURL + ldapServer;\n\t\t\t}\n\t\t\tinitDirContextEnv.put(Context.PROVIDER_URL, providerURL);\n\n\nWe should support specifiying secure ldap , ie ldaps://  in the derby.authentication.server. Add condition to support the ldaps:// \nie. \n\t\t\tif (ldapServer.startsWith(dfltLDAPURL) || ldapServer.startsWith(\"ldaps://\"))\n\t\t\t\t\tthis.providerURL = ldapServer;\n\n========\nA workaround to the problem is to set the Context.PROVIDER_URL instead.  ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10361","value":"Security","id":"10361"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38864","summary":"For LDAP authentication: derby.authentication.server should support ldaps:// as part of the server url.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"all","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329096/comment/12366858","id":"12366858","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=forsini","name":"forsini","emailAddress":"francois dot orsini at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Francois Orsini","active":true},"body":"Correct - I remember testing LDAPS using the Context.PROVIDER_URL route.\r\n\r\nThe derby tuning guide documentation should also make mention of using the JNDI Context.PROVIDER_URL property to connect to an LDAP server, as an alternative to the derby 'derby.authentication.server' property. (see 'derby.authentication.server' property section).\r\n\r\nUpon fixing this simple issue, The syntax for the derby 'derby.authentication.server' property should be enhanced to also mention LDAPS: as a valid syntax as well as adding an example in the respective section.\r\n\r\nderby.authentication.server=\r\n[{ ldap: | ldaps: | nisplus: }]\r\n[//]\r\n{\r\nhostname\r\n:\r\nportnumber |\r\nnisServerName\r\n/\r\nnisDomain\r\n}\r\n\r\n##LDAPS example\r\nderby.authentication.server=ldaps://godfrey:9090","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=forsini","name":"forsini","emailAddress":"francois dot orsini at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Francois Orsini","active":true},"created":"2006-02-18T07:46:01.000+0000","updated":"2006-02-18T07:46:01.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329096/comment/12372830","id":"12372830","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andersmo","name":"andersmo","emailAddress":"andersmo at stud dot ntnu dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anders Morken","active":true},"body":"DERBY-1000.patch: This little one-line change is all it takes to make derby authenticate against a ldap server over SSL for me. (In addition to the necessary setup of the LDAP server, the self-signed certificate and telling the java SSL certificate verifier to trust it, of course. And the change in DERBY-1174 which I needed for LDAP authentication to work at all for me.)\r\n\r\nThis change didn't seem to cause any problems in derbyall - sysinfo and sysinfo_withproperties failed due to my locale,  the forupdate test fails in the tinderbox test of 390705 as well, and one failure of CompatibilityTest in the initial derbyall run went away when I ran the derbynetclientmats suite without a network server already started.\r\n\r\nAs for documentation issues, I agree that the docs could use a bit of polishing when it comes to LDAP authentication. I'll see if I can figure out how to update them. =)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andersmo","name":"andersmo","emailAddress":"andersmo at stud dot ntnu dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anders Morken","active":true},"created":"2006-04-02T20:40:50.000+0000","updated":"2006-04-02T20:40:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329096/comment/12372850","id":"12372850","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andersmo","name":"andersmo","emailAddress":"andersmo at stud dot ntnu dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anders Morken","active":true},"body":"DERBY1000-docs.patch is a suggestion for an update to the documentation if we start supporting ldaps:// URLs. Further updates to the docs regarding LDAP support will be attached to DERBY-870 if I end up writing some. =)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andersmo","name":"andersmo","emailAddress":"andersmo at stud dot ntnu dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anders Morken","active":true},"created":"2006-04-03T03:34:52.000+0000","updated":"2006-04-03T03:34:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329096/comment/12418713","id":"12418713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andersmo","name":"andersmo","emailAddress":"andersmo at stud dot ntnu dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anders Morken","active":true},"body":"Now that DERBY-1174 is resolved the patches attached to this issue is technically all you need to let Derby use SSL-enabled LDAP connections to a LDAP directory. While I've tested this manually I haven't written a regression test for it. You need a lot of manual preparation to test this - most notably an SSL-enabled LDAP server to query and bind against, and you need the LDAP server's SSL certificate (or the CA certificate that signed the LDAP server's cert) in your java installation's trusted certificate store. See http://java.sun.com/products/jndi/tutorial/ldap/security/ssl.html for more details.\r\nThe fact that you need to import the ldap server's cert should probably be mentioned in the docs as well. Is the above URL \"stable\" enough for us to refer to in Derby documentation?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andersmo","name":"andersmo","emailAddress":"andersmo at stud dot ntnu dot no","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Anders Morken","active":true},"created":"2006-07-01T04:45:37.000+0000","updated":"2006-07-01T04:45:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329096/comment/12419625","id":"12419625","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"Thanks Anders for posting the patch as well as the doc changes. I applied the DERBY-1000.patch and could successfully connect to a secure ldap server  that I have access to and it all works ok.   I briefly looked at the docs patch and it looked ok to me. I will leave the doc changes for someone more familiar with dita to comment. \r\n\r\nI am not sure how we can add tests for ldap, because it needs a ldap server setup etc. \r\n\r\nderby-1000.patch looks good to me.  I vote +1 for commit.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-07-07T06:53:57.000+0000","updated":"2006-07-07T06:53:57.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329096/comment/12419676","id":"12419676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I think the doc patch is ready to be committed too.\r\n\r\nCode patch committed with revision 419852.\r\nDoc patch committed with revision 419853.\r\n\r\nThanks to Anders for fixing the code and updating the documentation. Thanks to Sunitha for reviewing the changes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2006-07-07T17:00:58.000+0000","updated":"2006-07-07T17:00:58.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1000/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i070lr:"}}