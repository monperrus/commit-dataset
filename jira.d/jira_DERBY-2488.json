{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12365826","self":"https://issues.apache.org/jira/rest/api/latest/issue/12365826","key":"DERBY-2488","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-03-26 19:22:02.059","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23072","customfield_12310222":"1_*:*_1_*:*_2266713495_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_24014487882","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-04-22T00:13:31.535+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2488/watchers","watchCount":0,"isWatching":false},"created":"2007-03-26T18:34:58.040+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312027","id":"12312027","description":"","name":"10.2.2.0","archived":false,"released":true,"releaseDate":"2006-12-19"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-01-24T22:54:59.414+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"}],"timeoriginalestimate":null,"description":"Updated the problem description to reflect the actual issue [Stan 4/5/07]:  EmbeddedConnectionPoolDataSource is not returning a JDBC 4 compliant PooledConnection object\n\nWhen loaded using JVM 1.6 the JDBC 3.0 data source (org.apache.derby.jdbc.EmbeddedConnectionPoolDataSource) is reporting a JDBC spec compliance level of 4.  The DatabaseMetaData.getJDBCMajorVersion method should return the\ncorrect spec compliance level (3) for the JDBC 3.0 data source.  The application server that relies on the reported spec compliance level to determine if a statement event listener should be registered will encounter a failure when  attemptting to register  an event listener with the JDBC 3.0 driver.\n\nNote that the JDBC 4.0 metadata call ..getMetaData().supportsStoredFunctionsUsingCallSyntax() is executed by the JDBC 3.0 driver.  This doesn't bother me but seems curious that this is supported by a JDBC 3.0 driver.\n\nAttached is a test case based on the test code from DERBY-8862 (JDBC 4 driver reports incorrect spec complieance level).\n\nRunning the test:\nset JAVA_HOME to a 1.6 JVM\nCompile program\nrun command:   ${JAVA_HOME}/java showJDBCdsMetaDataLis <path-to-database> 3.0 \n\nUsing JAVA 6.0\n\n> \"%JAVA_HOME%\\bin\\java\" showJDBCdsMetaDataLis \"c:\\tstdb102\" 3.0\n . . JDBC 3 or less: Using jdbc.EmbeddedConnectionPoolDataSource\nDatabase product: Apache Derby\nDatabase version: 10.2.2.0 - (485682)\nDriver name:      Apache Derby Embedded JDBC Driver\nDriver version:   10.2.2.0 - (485682)\nJDBC driver major version: 4\nJDBC driver minor version: 0\nJDBC 4.0 metaData - SFusingCall: true\n >> exception thrown:\nA non SQL error occured.\njava.lang.AbstractMethodError: org.apache.derby.jdbc.EmbedPooledConnection.addStatementEventListener(Ljavax/sql/Statemen\ntEventListener;)V\n        at showJDBCdsMetaDataLis.main(showJDBCdsMetaDataLis.java:103)\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39591","summary":"When loaded by jvm1.6 - EmbeddedConnectionPoolDataSource is not returning a JDBC 4 compliant PooledConnection object","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"subtasks":[{"id":"12366945","key":"DERBY-2538","self":"https://issues.apache.org/jira/rest/api/2/issue/12366945","fields":{"summary":"Update documentation to describe the expected behavior when a JDBC 4 app creates a JDBC 3 datasource.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}},{"id":"12367869","key":"DERBY-2582","self":"https://issues.apache.org/jira/rest/api/2/issue/12367869","fields":{"summary":"EmbeddedConnectionPoolDataSource does not implement java.sql.Wrapper but reports JDBC 4 compliance when run with JDK 6 ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Run test using JVM 1.6","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10051","value":"Urgent","id":"10051"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":16,"total":16,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12484183","id":"12484183","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"body":"load the JDBC 4.0 datasource driver when args[1] = 6.0\r\nIf any other value is passed the JDBC 3.0 datasource driver is used","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"created":"2007-03-26T18:37:10.535+0000","updated":"2007-03-26T18:37:10.535+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12484185","id":"12484185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"body":"Attaching again: Forgot to Grant license to ASF.  Thought it might be important","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"created":"2007-03-26T18:39:03.703+0000","updated":"2007-03-26T18:39:03.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12484202","id":"12484202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I think the bug here is that EmbeddedConnectionPoolDataSource is not returning a JDBC 4 compliant PooledConnection object in JDK 6.\r\n\r\nThese \"older\" data source implementations do return JDBC 4 objects (at least they are meant to), it's just that they themselves cannot implement the JDBC apis such as Wrapper and CommonDataSource because these new interfaces do not exist on older jvms. They are not just JDBC 3 versions of the driver.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-03-26T19:22:02.059+0000","updated":"2007-03-26T19:22:02.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12485010","id":"12485010","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"body":"Thanks, Dan, for the information.  I realized the results of this test could be interpreted two ways and it looks like I recorded the wrong interpretation.  Unless you or someone corrects me (I am still confused on the subject) I will change the description of this issue to be: \r\n\r\nWhen loaded by jvm1.6, the jdbc.EmbeddedConnectionPoolDataSource does not support registering a JDBC 4.0 Statement Event Listener.\r\n\r\nThe documentation, however, seems to say there are two versions, so I will also file documentation sub-tasks related to this once I am sure I understand this correctly. Below are a few of the statements that lead me to believe there was a version 3.0 and 4.0 datasource.  \r\n...If I now understand correctly people should always reference EmbeddedConnectionPoolDataSource and there is no need to reference EmbeddedConnectionPoolDataSource40 (except as a workaround to a bug like this one) .\r\n >> Is this correct?\r\n\r\nDocumentation talking about different implementations/variants of the datasources:\r\nJAVADOC\r\n EmbeddedConnectionPoolDataSource40 supports the JDBC 4.0 specification for the J2SE 6.0 Java Virtual Machine environment. Use EmbeddedConnectionPoolDataSource if your application runs in the following environments:\r\n\r\n    * JDBC 3.0 - Java 2 - JDK 1.4, J2SE 5.0\r\n    * JDBC 2.0 - Java 2 - JDK 1.2,1.3 \r\n\r\nDevelopers Guide:\r\nEach of these DataSources has two variants. Use the first variant if your application run\r\non JDK 1.5 or lower. Use the second variant (the one whose class name ends with \"40\")\r\nif your application runs on JDK 1.6 or higher.\r\n• org.apache.derby.jdbc.EmbeddedDataSource and\r\norg.apache.derby.jdbc.EmbeddedDataSource40    ....","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"created":"2007-03-28T22:15:08.432+0000","updated":"2007-03-28T22:15:08.432+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12485033","id":"12485033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"No, there are two data sources versions, the 40 ones and the older ones.\r\n\r\nIn a JDK 1.4/1.5 environment the applications must use the old ones (e.g. EmbeddedConnectionPoolDataSource)\r\n\r\nIn JDK 6 applications should be using EmbeddedConnectionPoolDataSource40.\r\n\r\nThe situation you are seeing is that the old version is being run in JDK 6, which of course could happen for existing applications.\r\nIn this case the api presented is a bit of a mix-up, it is not coded to be a JDBC 3.0 data source.\r\nIt will (should) return JDBC 4 objects even though the object it self does not satisify the JDBC 4.0 interfaces. Ie. EmbeddedConnectionPoolDataSource does not implement Wrapper and CommonDataSource.\r\n\r\nI think the documentation is correct, but silent on what happens when using the old versions in JDK 6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-03-29T00:09:00.167+0000","updated":"2007-03-29T00:09:00.167+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12486415","id":"12486415","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"I read Dan's comments on this issue and I (perhaps incorrectly) interpret them to mean that the fix for this problem is to simply ensure that EmbeddedConnectionPoolDataSource returns JDBC 4 objects when the app is running with JDK 6.  That said, it looks like there is only one JDBC 4 object that can be returned from EmbeddedConnectionPoolDataSource, and that object is a PooledConnection.  So I made the attached change (d2488_notTested_v1.patch), which is pretty much just a one-liner to return a JDBC 4 PooledConnection when running with JDK 6.\r\n\r\nThe patch does a similar thing in EmbeddedXADataSource just because that *seems* like a similar situation.  I don't know for sure if that's necessary, but it looks like it could be.\r\n\r\nAs the name implies I have not fully tested this patch.  All I've done is run the repro attached to this issue and verified that the _v1 patch causes the repro to run successfully, even with an input argument that is not \"6.0\":\r\n\r\n  > java showJDBCdsMetaDataLis dbdb 2.4\r\n   . . JDBC 3 or less: Using jdbc.EmbeddedConnectionPoolDataSource\r\n  Database product: Apache Derby\r\n  Database version: 10.3.0.0 alpha - (1)\r\n  Driver name:      Apache Derby Embedded JDBC Driver\r\n  Driver version:   10.3.0.0 alpha - (1)\r\n  JDBC driver major version: 4\r\n  JDBC driver minor version: 0\r\n  JDBC 4.0 metaData - SFusingCall: true\r\n  Event: statementClosed a816c00e-0111-b830-0576-0000003d4c38\r\n\r\nPlease note, though, that I am not at all familiar with this area of code, so it's possible I'm being far too naive here.  If that's the case then I'm hoping someone can elaborate a bit more on what the correct approach might be...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-04-03T16:49:16.155+0000","updated":"2007-04-03T16:49:16.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12486456","id":"12486456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Okay, so d2488_noTest_v1 is not a valid patch.  It was fine when I applied and built, but when I clobbered and then built there are failures (because the 40 classes can't be built with jdk14).  Oops, silly me; sorry for th noise.\r\n\r\nStill curious to know, though, if this is the correct approach *functionally* speaking?  I.e. we need to return JDBC 4 objects from the non-40 data sources?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-04-03T18:26:06.878+0000","updated":"2007-04-03T18:26:06.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12486785","id":"12486785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Attaching a second patch that has the same functional behavior as the first one, except that it uses reflection to create the JDBC 4 object so that the non-JDBC 4 classes will still compile with 1.4.\r\n\r\nI did a full ant clobber and ant all with this patch and the build finishes cleanly.  I also ran suites.All and derbyall on Red Hat Linux with ibm142 with no issues.  I haven't run those suites with jdk16 yet because I don't have a machine available with that jvm at the moment.\r\n\r\nBefore going any further with this I'm hoping someone can offer input as to whether or not this is the correct approach.  Or to be more explicit, Dan, do these changes correlate with your comments above, or am I totally off-track here?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-04-04T21:36:26.585+0000","updated":"2007-04-04T21:36:26.585+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12486796","id":"12486796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Your approach is what I was describing though I think there is a somewhat cleaner way that doesn't require reflection.\r\n\r\nInternalDriver is the class that is the factory for all JDBC object, e.g. Connections, ResultSets etc. It has methods that return the correct level of JDBC object for a given JVM environment. This is because the specific version of InternalDriver is active in the JVM, e.g. Driver30 for JDBC 3.0 and Driver40 for JDBC 4.0.\r\n\r\nSo the first thought would be to add a getNewPooledConnection(...) and getNewXAConnection(...) to InternalDriver, and then have the various implementations return the correct type for their JDBC level, thus no reflection.\r\n\r\nHowever, InternalDriver needs to work on JSR169 as it's the factory for objects there as well, and JSR169 does not support PooledConnection or XAConnection,\r\nso the methods cannot be added there.\r\n\r\nWhat could be done is to add the newPooledConnection(...) and newXAConnection(...)  methods to Driver30 and then have the data source use those methods to get the objects, e.g.\r\n\r\n\r\n   ((Driver30) findDriver()).getNewPooledConnection(...);\r\n\r\nThat code would then work on JDBC 3.0 and JDBC 4.0 with no need for the 40 versions of the DataSource to have specific methods to get new objects, instead that code would be in Driver40.\r\n\r\n   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-04-04T22:31:14.359+0000","updated":"2007-04-04T22:31:14.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12486799","id":"12486799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thank you for the feedback, Dan.  The approach you've mentioned does indeed sound cleaner.  I will work with this some more to see if I can implement your suggestions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-04-04T22:44:59.209+0000","updated":"2007-04-04T22:44:59.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12487126","id":"12487126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"body":"Updated the description to accurately reflect the problem as it is now understood.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"created":"2007-04-06T00:50:32.998+0000","updated":"2007-04-06T00:50:32.998+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12487638","id":"12487638","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Attaching d2488_v3.patch, which is an attempt to implement Dan's suggested approach.  This new approach is far cleaner than the original--so thank you to Dan for the great feedback.\r\n\r\nWhile working on this I discovered that the ClientXADataSource class suffers from the same problem as the Embedded classes, so I made similar changes there.  Note that the ClientConnectionPoolDataSource file was already doing something very similar to what Dan had suggested for Embedded, except that instead of using \"Driver30\" it uses \"ClientDriver.getFactory()\". So that particular data source was working correctly even before my changes.  Given that, I have now updated the ClientXADataSource class to match the behavior of ClientConnectionPoolDataSource.\r\n\r\nThis patch also includes a new test, jdbc4/JDBC4FromJDBC3DataSourceTest, which verifies that JDBC 4 connections will be returned from JDBC 3 data sources if the JDK in use is JDK 1.6.  I had to make some minor modifications to several classes in the junit/ directory, but hopefully none of these is a problem.  In a clean trunk the new test shows 3 failures (the ClientConnectionPoolDataSource test passes, as mentioned above); after applying d2488_v3.patch, the test runs cleanly.\r\n\r\nI ran derbyall and suites.All on a SUSE Linux 10.0 machine and there were the following failures, which also appear in the Tinderbox:\r\n\r\n  - derbyall:   lang/grantRevokeDDL.sql\r\n  - suites.All: GroupByExpressionTest.testMiscExpressions\r\n  - suites.All: SecurityPolicyReloadingTest\r\n  - suites.All: UpdateCursorTest.testVirtualMemoryHeap\r\n\r\nThere was also a failure in derbynet/testconnection.java, which does not show up in the tinderbox:\r\n\r\n  9d8\r\n  < Unable to find host: ihave-inmyname.com.\r\n  Test Failed.\r\n\r\nWhen I ran this on my Windows 2000 laptop the diff was slightly different:\r\n\r\n  9 del\r\n  < Unable to find host: ihave-inmyname.com.\r\n  9a9\r\n  > Could not connect to Derby Network Server on host ihave-inmyname.com, port 1527.\r\n\r\nI did an \"ant clobber\" and rebuilt just to make sure, but the test still fails.  I then tried running it on a clean, fully-synced client and it still failed (with the same diff).  So I don't think this is related to my changes...\r\n\r\nReview comments and any other feedback would be much appreciated, especially since (as I mentioned earlier) this area of code is very new to me...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-04-09T22:02:46.800+0000","updated":"2007-04-09T22:02:46.800+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12487655","id":"12487655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Attaching a _v4 patch that is identical to _v3 in terms of engine/client changes.  The only difference is that I have made the following tweaks to the new test:\r\n\r\n  1. Wired it into jdbc4/_Suite.java (forgot to do that with _v3)\r\n  2. Created a new convenience method on TestConfiguration for forcing use of JDBC 3 datasources (instead of putting that code inside the new test).\r\n  3. Updated the test (jdbc4/JDBC4FromJDBC3DataSourceTest) to use the new convenience method.\r\n\r\nNote that the convenience method on TestConfiguration wraps the test inside a CleanDatabaseTestSetup configuration.  This ensures that the target database (\"wombat\") will always exist before the fixtures are run (which was not the case for the _v3 test).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-04-09T23:58:29.497+0000","updated":"2007-04-09T23:58:29.497+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12490391","id":"12490391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"I haven't heard any comments (good nor bad) about the _v4 patch for this issue.  I hope to re-run the regression suites later today to make sure everything is still okay (esp. since some DataSource tests were added to suites.All aftet I posted the patch), and if everything passes then I will likely commit  d2488_v4.patch before the end of today (Friday).\r\n\r\nIf people have comments/feedback after that, I can of course address them in subsequent patches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-04-20T16:03:20.385+0000","updated":"2007-04-20T16:03:20.385+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12490674","id":"12490674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"derbyall and suites.All both ran cleanly for me after a full sync / clobber / rebuild.  So I removed an extraneous import from the _v4 patch and committed with svn # 531129:\r\n\r\n  URL: http://svn.apache.org/viewvc?view=rev&rev=531129\r\n\r\nMarking the issue as resolved.  Thanks again to Dan for his input on how to best fix this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-04-22T00:13:31.505+0000","updated":"2007-04-22T00:13:31.505+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12365826/comment/12562270","id":"12562270","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"body":"Catching up on Closing my reported issues.  Thanks to Dyre for the workflow reminder today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stan","name":"stan","emailAddress":"Stan dot Bradbury at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stan Bradbury","active":true},"created":"2008-01-24T22:54:56.827+0000","updated":"2008-01-24T22:54:56.827+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2488/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0753b:"}}