{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12497539","self":"https://issues.apache.org/jira/rest/api/latest/issue/12497539","key":"SOLR-2346","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319065","id":"12319065","description":"Major release after 3.5","name":"3.6","archived":false,"released":true,"releaseDate":"2012-04-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314992","id":"12314992","description":"Alpha release of 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-02-03 11:32:38.596","customfield_12312323":null,"customfield_12310420":"369","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_28345702542_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-12-28T07:37:04.497+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-2346/watchers","watchCount":1,"isWatching":false},"created":"2011-02-03T05:48:42.297+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315096","id":"12315096","description":"Bug fix release for users of 1.4","name":"1.4.1","archived":false,"released":true,"releaseDate":"2010-06-25"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314371","id":"12314371","description":"Major release after 1.4.1","name":"3.1","archived":false,"released":true,"releaseDate":"2011-03-31"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314992","id":"12314992","description":"Alpha release of 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:39:02.915+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313049","id":"12313049","name":"contrib - Solr Cell (Tika extraction)","description":"Extract content from rich documents using Tika"}],"timeoriginalestimate":null,"description":"I am able to successfully index/search non-Engilsh files (like Hebrew, Japanese) which was encoded in UTF-8. However, When I tried to index data which was encoded in local encoding like Big5 for Japanese I could not see the desired results. The contents after indexing looked garbled for Big5 encoded document when I searched for all indexed documents. When I index attached non utf-8 file it indexes in following way\r\n\r\n- <result name=\"response\" numFound=\"1\" start=\"0\">\r\n- <doc>\r\n- <arr name=\"attr_content\">\r\n  <str>�� ������</str>\r\n  </arr>\r\n- <arr name=\"attr_content_encoding\">\r\n  <str>Big5</str>\r\n  </arr>\r\n- <arr name=\"attr_content_language\">\r\n  <str>zh</str>\r\n  </arr>\r\n- <arr name=\"attr_language\">\r\n  <str>zh</str>\r\n  </arr>\r\n- <arr name=\"attr_stream_size\">\r\n  <str>17</str>\r\n  </arr>\r\n- <arr name=\"content_type\">\r\n  <str>text/plain</str>\r\n  </arr>\r\n  <str name=\"id\">doc2</str>\r\n  </doc>\r\n  </result>\r\n  </response>\r\n\r\nHere you said it index file in UTF8 however it seems that non UTF8 file gets indexed in Big5 encoding.\r\nHere I tried fetching indexed data stream in Big5 and converted in UTF8.\r\n\r\nString id = (String) resulDocument.getFirstValue(\"attr_content\");\r\n            byte[] bytearray = id.getBytes(\"Big5\");\r\n            String utf8String = new String(bytearray, \"UTF-8\");\r\nIt does not gives expected results.\r\n\r\nWhen I index UTF-8 file it indexes like following\r\n\r\n- <doc>\r\n- <arr name=\"attr_content\">\r\n  <str>マイ ネットワーク</str>\r\n  </arr>\r\n- <arr name=\"attr_content_encoding\">\r\n  <str>UTF-8</str>\r\n  </arr>\r\n- <arr name=\"attr_stream_content_type\">\r\n  <str>text/plain</str>\r\n  </arr>\r\n- <arr name=\"attr_stream_name\">\r\n  <str>sample_jap_unicode.txt</str>\r\n  </arr>\r\n- <arr name=\"attr_stream_size\">\r\n  <str>28</str>\r\n  </arr>\r\n- <arr name=\"attr_stream_source_info\">\r\n  <str>myfile</str>\r\n  </arr>\r\n- <arr name=\"content_type\">\r\n  <str>text/plain</str>\r\n  </arr>\r\n  <str name=\"id\">doc2</str>\r\n  </doc>\r\n\r\nSo, I can index and search UTF-8 data.\r\n\r\n\r\nFor more reference below is the discussion with Yonik.\r\n    Please find attached TXT file which I was using to index and search.\r\n\r\n    curl \"http://localhost:8983/solr/update/extract?literal.id=doc1&uprefix=attr_&fmap.content=attr_content&fmap.div=foo_t&boost.foo_t=3&commit=true&charset=utf-8\" -F \"myfile=@sample_jap_non_UTF-8\"\r\n\r\n\r\nOne problem is that you are giving big5 encoded text to Solr and saying that it's UTF8.\r\nHere's one way to actually tell solr what the encoding of the text you are sending is:\r\n\r\ncurl \"http://localhost:8983/solr/update/extract?literal.id=doc1&uprefix=attr_&fmap.content=attr_content&fmap.div=foo_t&boost.foo_t=3&commit=true\" --data-binary @sample_jap_non_UTF-8.txt -H 'Content-type:text/plain; charset=big5'\r\n\r\nNow the problem appears that for some reason, this doesn't work...\r\nCould you open a JIRA issue and attach your two test files?\r\n\r\n-Yonik\r\nhttp://lucidimagination.com\r\n\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"18888","summary":"Non UTF-8 Text files having other than english texts(Japanese/Hebrew) are no getting indexed correctly.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasad.deshpande13","name":"prasad.deshpande13","emailAddress":"prasad dot deshpande13 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Deshpande","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasad.deshpande13","name":"prasad.deshpande13","emailAddress":"prasad dot deshpande13 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Deshpande","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Solr 1.4.1, Packaged Jetty as servlet container, Windows XP SP1, Machine was booted in Japanese Locale.","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":17,"total":17,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/12989975","id":"12989975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasad.deshpande13","name":"prasad.deshpande13","emailAddress":"prasad dot deshpande13 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Deshpande","active":true},"body":"I have verified use case using attached files.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasad.deshpande13","name":"prasad.deshpande13","emailAddress":"prasad dot deshpande13 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Deshpande","active":true},"created":"2011-02-03T05:51:31.046+0000","updated":"2011-02-03T05:51:31.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/12990060","id":"12990060","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"{noformat}\r\nString id = (String) resulDocument.getFirstValue(\"attr_content\");\r\nbyte[] bytearray = id.getBytes(\"Big5\");\r\nString utf8String = new String(bytearray, \"UTF-8\");\r\nIt does not gives expected results.\r\n{noformat}\r\n\r\nYou cannot convert character sets this way in java (asking for the bytes in big5 but \r\nthen making a string as utf-8)... this is wrong.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2011-02-03T11:32:38.596+0000","updated":"2011-02-03T11:32:38.596+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/12990172","id":"12990172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"From the email thread:\r\n{quote}\r\nOne problem is that you are giving big5 encoded text to Solr and saying that it's UTF8.\r\nHere's one way to actually tell solr what the encoding of the text you are sending is:\r\n\r\ncurl \"http://localhost:8983/solr/update/extract?literal.id=doc1&uprefix=attr_&fmap.content=attr_content&fmap.div=foo_t&boost.foo_t=3&commit=true\" --data-binary @sample_jap_non_UTF-8.txt -H 'Content-type:text/plain; charset=big5'\r\n\r\nNow the problem appears that for some reason, this doesn't work...\r\nCould you open a JIRA issue and attach your two test files?\r\n{quote}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2011-02-03T16:50:17.417+0000","updated":"2011-02-03T16:50:17.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/12990185","id":"12990185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"Right, I agree solr should work with a non-UTF8 encoded doc in this way,\r\nbut the code is still wrong: its not a correct way to convert characters in java.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2011-02-03T17:11:42.204+0000","updated":"2011-02-03T17:11:42.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/12990444","id":"12990444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasad.deshpande13","name":"prasad.deshpande13","emailAddress":"prasad dot deshpande13 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Deshpande","active":true},"body":"I agree, I was just trying to decode the garbled characters so that it can be readable to the user. Still the problem is in indexing, while indexing the all the characters are getting garbled.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasad.deshpande13","name":"prasad.deshpande13","emailAddress":"prasad dot deshpande13 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Deshpande","active":true},"created":"2011-02-04T03:56:37.268+0000","updated":"2011-02-04T05:23:25.021+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/12990547","id":"12990547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasad.deshpande13","name":"prasad.deshpande13","emailAddress":"prasad dot deshpande13 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Deshpande","active":true},"body":"Hope following issue could be same.\r\n\r\nAbove are the Hebrew *.msg files which I have tried to index using following command.\r\ncurl \"http://localhost:8983/solr/update/extract?literal.id=doc1&uprefix=attr_&fmap.content=attr_content&fmap.div=foo_t&boost.foo_t=3&commit=true\" -F \"myfile=@NormalSave.msg\" \r\n\r\nFile UnicodeSave.msg was saved as \"Outlook Message Format - Unicode\" and normalSave.msg was saved as \"Outlook Message Format\".\r\nWhen I search with *:* in solr it gives junk characters in case NormalSave.msg and in case of UnicodeSave.msg it gives empty \"attr_content\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasad.deshpande13","name":"prasad.deshpande13","emailAddress":"prasad dot deshpande13 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Prasad Deshpande","active":true},"created":"2011-02-04T12:52:08.574+0000","updated":"2011-02-04T12:52:08.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13004339","id":"13004339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"I've faced the same problem. I'm trying to index a Shift_JIS encoded text file through the following request:\r\n\r\nhttp://localhost:8983/solr/update/extract?literal.id=docA0000001&stream.file=/foo/bar/sjis.txt&commit=true&stream.contentType=text%2Fplain%3B+charset%3DShift_JIS\r\n\r\nBut Tika's AutoDetectParser doesn't regard Solr's charset (or Solr doesn't set the content type to Tika Parser; I should dig in).\r\n\r\nI looked into ExtractingDocumentLoader.java and it seemed that I could select an appropriate parser if I use stream.type parameter:\r\n\r\n{code:title=ExtractingDocumentLoader.java}\r\npublic void load(SolrQueryRequest req, SolrQueryResponse rsp, ContentStream stream) throws IOException {\r\n  errHeader = \"ExtractingDocumentLoader: \" + stream.getSourceInfo();\r\n  Parser parser = null;\r\n  String streamType = req.getParams().get(ExtractingParams.STREAM_TYPE, null);\r\n  if (streamType != null) {\r\n    //Cache?  Parsers are lightweight to construct and thread-safe, so I'm told\r\n    MediaType mt = MediaType.parse(streamType.trim().toLowerCase());\r\n    parser = config.getParser(mt);\r\n  } else {\r\n    parser = autoDetectParser;\r\n  }\r\n  :\r\n}\r\n{code}\r\n\r\nThe request was:\r\n\r\nhttp://localhost:8983/solr/update/extract?literal.id=docA0000001&stream.file=/foo/bar/sjis.txt&commit=true&stream.contentType=text%2Fplain%3B+charset%3DShift_JIS&stream.type=text%2Fplain\r\n\r\nI could select TXTParser rather than AutoDetectParser, but the problem wasn't solved.\r\n\r\nAnd I looked at Tika Javadoc for TXTParser and it said \"The text encoding of the document stream is automatically detected based on the byte patterns found at the beginning of the stream. The input metadata key HttpHeaders.CONTENT_ENCODING is used as an encoding hint if the automatic encoding detection fails.\":\r\n\r\nhttp://tika.apache.org/0.8/api/org/apache/tika/parser/txt/TXTParser.html\r\n\r\nSo I tried to insert the following hard coded fix:\r\n\r\n{code:title=ExtractingDocumentLoader.java}\r\nMetadata metadata = new Metadata();\r\nmetadata.add(ExtractingMetadataConstants.STREAM_NAME, stream.getName());\r\nmetadata.add(ExtractingMetadataConstants.STREAM_SOURCE_INFO, stream.getSourceInfo());\r\nmetadata.add(ExtractingMetadataConstants.STREAM_SIZE, String.valueOf(stream.getSize()));\r\nmetadata.add(ExtractingMetadataConstants.STREAM_CONTENT_TYPE, stream.getContentType());\r\nmetadata.add(HttpHeaders.CONTENT_ENCODING, \"Shift_JIS\");   // <= temporary fix\r\n{code}\r\n\r\nand the problem was gone (anymore garbled characters indexed).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2011-03-09T02:25:28.396+0000","updated":"2011-03-09T02:25:28.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13004346","id":"13004346","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"By looking at Tika, HtmlParser and TXTParser see HttpHeaders.CONTENT_ENCODING value in metadata.\r\nI think Solr sould set it in metadata if the charset value is presented by user.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2011-03-09T03:02:52.012+0000","updated":"2011-03-09T03:02:52.012+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13004357","id":"13004357","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"The patch that solves my problem,\r\n\r\nPrasad, can you try the patch with your Big5 text and see the result?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2011-03-09T03:44:21.188+0000","updated":"2011-03-09T03:44:21.188+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13043640","id":"13043640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"Bulk move 3.2 -> 3.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2011-06-03T16:46:15.719+0000","updated":"2011-06-03T16:46:15.719+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13106381","id":"13106381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"3.4 -> 3.5","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2011-09-16T14:50:50.186+0000","updated":"2011-09-16T14:50:50.186+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13174637","id":"13174637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shinichiro+abe","name":"shinichiro abe","emailAddress":"shinichiro dot abe dot 1 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shinichiro Abe","active":true},"body":"I've faced the same problem. Tika parsed my Shift_JIS file as windows-1252, I could not see the desired results. I can index the file correctly by applying Koji's patch. But this patch is effective for remote streaming, not for POST. So, I changed a part of code below.\r\n{noformat}      //String charset = ContentStreamBase.getCharsetFromContentType(stream.getContentType());\r\n      String contentType = req.getParams().get(CommonParams.STREAM_CONTENTTYPE, null);\r\n      String charset = ContentStreamBase.getCharsetFromContentType(contentType);\r\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shinichiro+abe","name":"shinichiro abe","emailAddress":"shinichiro dot abe dot 1 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shinichiro Abe","active":true},"created":"2011-12-22T06:04:39.688+0000","updated":"2011-12-22T06:04:39.688+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13176446","id":"13176446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"bq. I can index the file correctly by applying Koji's patch. But this patch is effective for remote streaming, not for POST.\r\n\r\nI don't understand what you said and your fix (I don't understand why you use CommonParams.STREAM_CONTENTTYPE to fix for your POST case).\r\n\r\nIf you meant curl command by *POST*, you can set content type via -H parameter.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2011-12-28T05:04:03.615+0000","updated":"2011-12-28T05:04:03.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13176449","id":"13176449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"New patch attached. I updated for current trunk and getCharsetFromContentType() method to remove unnecessary strings after the charset value.\r\n\r\nI think this is ready to go.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2011-12-28T05:12:16.961+0000","updated":"2011-12-28T05:12:16.961+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13176464","id":"13176464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"bq. getCharsetFromContentType() method to remove unnecessary strings after the charset value.\r\n\r\nMy fault. This is not necessary. I should add --data-binary option to curl.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2011-12-28T05:51:53.498+0000","updated":"2011-12-28T05:51:53.498+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13176501","id":"13176501","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"committed trunk and 3x.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2011-12-28T07:37:04.745+0000","updated":"2011-12-28T07:37:04.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12497539/comment/13176548","id":"13176548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Nice fix, is in-line with the other charset handling e.g. for XML imports using standard request handler. I fixed the incorrect XML handling in solr a year ago and did the same thing to pass the charset to the XML parser as \"hint\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2011-12-28T09:53:29.540+0000","updated":"2011-12-28T09:53:29.540+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-2346/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03lbr:"}}