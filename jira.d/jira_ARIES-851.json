{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12555984","self":"https://issues.apache.org/jira/rest/api/latest/issue/12555984","key":"ARIES-851","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321544","id":"12321544","name":"1.0","archived":false,"released":true}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-05-22 09:44:31.934","customfield_12312323":null,"customfield_12310420":"293153","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_544537808_*|*_5_*:*_2_*:*_176281975_*|*_4_*:*_1_*:*_63489415","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-05-25T10:24:10.587+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-851/watchers","watchCount":3,"isWatching":false},"created":"2012-05-16T08:32:21.518+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-05-25T10:24:10.627+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313176","id":"12313176","name":"JPA","description":"RFC 143 JPA Integration"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313851","id":"12313851","name":"Util"}],"timeoriginalestimate":null,"description":"Steps to reproduce\r\n\r\n* Compile or get a karaf-3.0.0-SNAPSHOT and unpack it\r\n* Install openjpa-2.2.0 (using the attached feature-file)\r\n* Deploy a bundle containing a persistence-unit (attached jar for example)\r\n\r\nget the following Exception 4 times:\r\n{code}\r\nERROR: Bundle org.apache.aries.jpa.container [78] EventDispatcher: Error during dispatch. (java.lang.IllegalStateException: Unable to create persistence units for the bundle test.jpa.test.jpa.bundle/0.1.0.SNAPSHOT as previous persistence units already exist.)\r\njava.lang.IllegalStateException: Unable to create persistence units for the bundle test.jpa.test.jpa.bundle/0.1.0.SNAPSHOT as previous persistence units already exist.\r\n{code}\r\nSee attachment for full stacktrace\r\n\r\nIn subsequent startups the Exception is still thrown but the stacktrace does not show in the console or the log.\r\nAlso when using equinox the Stacktrace does not appear in either the console or the log ever, but it's still thrown.\r\n\r\nThe problem is that the PersistenceBundleManager#addingBundle is called multiple times for the newly installed bundle.\r\nThe PersistenceBundleManager is passed as a BundleTrackerCustomizer to a BundleHookBundleTracker.\r\nThe BundleHookBundleTracker stores it in it's own private attribute and also passes it to it's super-constructor.\r\nSo the customizer is stored in the instance twice.\r\nIt's called by both BundleTracker$Tracked.customizerAdding and BundleHookBundleTracker$Tracked.customizerAdding.\r\nBoth \"Tracked\" recognize the bundle as untracked and call the addingBundle-method.\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"166179","summary":"BundleTrackerCustomizer in BundleHookBundleTracker is called multiple times for the same event.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Linux-3.0.0, Karaf-3.0.0-SNAPSHOT with Felix, openjdk-6","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555984/comment/13276712","id":"13276712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"body":"Attached two possible solutions that prevent, that addingBundle is called too often.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"created":"2012-05-16T12:58:50.892+0000","updated":"2012-05-16T12:59:27.045+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555984/comment/13280847","id":"13280847","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pieber","name":"pieber","emailAddress":"anpieber at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pieber&avatarId=10398","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pieber&avatarId=10398","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pieber&avatarId=10398","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pieber&avatarId=10398"},"displayName":"Andreas Pieber","active":true},"body":"I get nagged on by exactly the same problem. I can confirm that both of the attached patches fix the problem for me (although I think solution2 is the way to go). Can any commiter pls give this problem a shot? Maybe before the 1.0.0 release? :-)\r\n\r\nmany thanks in advance and kind regards","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pieber","name":"pieber","emailAddress":"anpieber at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=pieber&avatarId=10398","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pieber&avatarId=10398","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pieber&avatarId=10398","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pieber&avatarId=10398"},"displayName":"Andreas Pieber","active":true},"created":"2012-05-22T09:44:31.934+0000","updated":"2012-05-22T09:44:31.934+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555984/comment/13281039","id":"13281039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"body":"I also found a way to illustriate the behaviour with plain felix.\r\n\r\nDownload and start felix-4.0.2\r\n\r\n> felix:install file:/path/to/org.apache.aries.util-1.0.0-SNAPSHOT.jar\r\n> start <id>\r\n\r\n> felix:install file:/path/to/test.bundletracker.bundle-0.1.0-SNAPSHOT.jar\r\n> start <id>\r\n\r\nthen install any bundle (e.g. commons-collections) and watch how often the bundletracker prints the event\r\n\r\n> felix:install file:/path/to/commons-collections-3.2.1.jar\r\n\r\n{code}\r\n\r\ng! felix:lb\r\nSTART LEVEL 1\r\n   ID|State      |Level|Name\r\n    0|Active     |    0|System Bundle (4.0.2)\r\n    1|Active     |    1|Apache Felix Bundle Repository (1.6.6)\r\n    2|Active     |    1|Apache Felix Gogo Command (0.12.0)\r\n    3|Active     |    1|Apache Felix Gogo Runtime (0.10.0)\r\n    4|Active     |    1|Apache Felix Gogo Shell (0.10.0)\r\n    5|Active     |    1|Test :: BundleTracker :: Bundle (0.1.0.SNAPSHOT)\r\n    7|Active     |    1|Apache Aries Util (1.0.0.SNAPSHOT)\r\n    9|Installed  |    1|Commons Collections (3.2.1)\r\ng! felix:start 9\r\nEvent: org.osgi.framework.BundleEvent[source=org.apache.commons.collections [9]]\r\nmodified bundleorg.apache.commons.collections\r\nEvent: org.osgi.framework.BundleEvent[source=org.apache.commons.collections [9]]\r\nmodified bundleorg.apache.commons.collections\r\nEvent: org.osgi.framework.BundleEvent[source=org.apache.commons.collections [9]]\r\nmodified bundleorg.apache.commons.collections\r\nEvent: org.osgi.framework.BundleEvent[source=org.apache.commons.collections [9]]\r\nmodified bundleorg.apache.commons.collections\r\nEvent: org.osgi.framework.BundleEvent[source=org.apache.commons.collections [9]]\r\nmodified bundleorg.apache.commons.collections\r\nEvent: org.osgi.framework.BundleEvent[source=org.apache.commons.collections [9]]\r\nmodified bundleorg.apache.commons.collections\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"created":"2012-05-22T15:41:16.090+0000","updated":"2012-05-22T15:41:16.090+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555984/comment/13281042","id":"13281042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"body":"I think we should go the first way as the whole purpose of this class is to use EventHook and the second way just ignore all that stuff which makes this class useless.\r\nI actually don't see why this class inherit the BundleTracker.\r\nWhat if we just remove that parent class ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"created":"2012-05-22T15:43:15.662+0000","updated":"2012-05-22T15:43:15.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555984/comment/13281050","id":"13281050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"body":"Fixed by removing calls to super.open() and super.close()","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"created":"2012-05-22T15:47:59.305+0000","updated":"2012-05-22T15:47:59.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555984/comment/13282606","id":"13282606","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"body":"The initial fix caused several JPA-related tests to fail","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"created":"2012-05-24T16:46:01.247+0000","updated":"2012-05-24T16:46:01.247+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-851/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0st0v:"}}