{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12547298","self":"https://issues.apache.org/jira/rest/api/latest/issue/12547298","key":"DERBY-5667","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323456","id":"12323456","description":"Third release on the 10.8 branch","name":"10.8.3.0","archived":false,"released":true,"releaseDate":"2012-11-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12310220":"2012-04-11 17:48:36.421","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"232456","customfield_12310222":"1_*:*_1_*:*_3098883489_*|*_6_*:*_2_*:*_20416710757_*|*_5_*:*_2_*:*_15700501962_*|*_4_*:*_2_*:*_20815883388","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-02-13T17:56:21.459+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5667/watchers","watchCount":3,"isWatching":false},"created":"2012-03-20T22:23:21.903+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323456","id":"12323456","description":"Third release on the 10.8 branch","name":"10.8.3.0","archived":false,"released":true,"releaseDate":"2012-11-16"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-02-13T17:56:21.493+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"one failure and 2 errors which I would guess are because of the failure.  Failed against 10.8 branch, ibm15, windows, build 1302046\r\nThere were 2 errors:\r\n1) testSerializable(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)java.sql.SQLException: Table/View 'A' already exists in Schema 'APP'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.doRunTests(UpdateLocksTest.java:185)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.testSerializable(UpdateLocksTest.java:154)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\nCaused by: ERROR X0Y32: Table/View 'A' already exists in Schema 'APP'.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\r\n\tat org.apache.derby.impl.sql.catalog.DataDictionaryImpl.duplicateDescriptorException(Unknown Source)\r\n\tat org.apache.derby.impl.sql.catalog.DataDictionaryImpl.addDescriptor(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.CreateTableConstantAction.executeConstantAction(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\r\n\t... 36 more\r\n2) testReadUncommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)java.sql.SQLException: Table/View 'A' already exists in Schema 'APP'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeUpdate(Unknown Source)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.doRunTests(UpdateLocksTest.java:185)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.testReadUncommitted(UpdateLocksTest.java:158)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\nCaused by: ERROR X0Y32: Table/View 'A' already exists in Schema 'APP'.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\r\n\tat org.apache.derby.impl.sql.catalog.DataDictionaryImpl.duplicateDescriptorException(Unknown Source)\r\n\tat org.apache.derby.impl.sql.catalog.DataDictionaryImpl.addDescriptor(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.CreateTableConstantAction.executeConstantAction(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\r\n\t... 36 more\r\nThere were 2 failures:\r\n1) testReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet\r\n\tat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java:1349)\r\n\tat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java:1285)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.updateBtreeSetLocks(UpdateLocksTest.java:6764)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.doRunTests(UpdateLocksTest.java:387)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.testReadCommitted(UpdateLocksTest.java:150)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:79)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\r\nhttp://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm15/1302046-suites.All_diff.txt","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35517","summary":"testReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10102","value":"Patch Available","id":"10102"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":34,"total":34,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13251782","id":"13251782","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I see this failure pop up frequently in the nightly tests. \r\n\r\nI did a cursory check, a variation of this has been happening before Mike logged it, see e.g. the run on Fri Mar 9, 2012 on this same platform (10.8 on windows 2008 / ibm 1.7):  \r\ntestReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Unexpected row count expected:<2> but was:<3>\r\n(http://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm17/1299147-suites.All_diff.txt)\r\n\r\nThe current failure is happening a couple of times per week.\r\nFor example\r\n- Fri April 5, 2012, ibm 1.7 on windows 2008: http://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm17/1310152-suites.All_diff.txt\r\n- Mon April 9, 2012, ibm 1.7 on windows 2008: http://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm17/1311551-suites.All_diff.txt \r\n- Tue April 10, 2012, ibm 1.4.2 on windows 2008: http://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm142/1312069-suites.All_diff.txt\r\n\r\nJust like the intermittent AccessTest failure of DERBY-5377 this problem seems to show up only on this machine, but not reproducible at will or with a smaller subset of tests than suites.All even on this machine.\r\nI do not have another Windows 2008 machine available to check if it's something related to this OS.\r\nI also do not have any other 4 CPU boxes available to me to do further experimenting with that.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-04-11T17:48:36.421+0000","updated":"2012-04-11T17:48:36.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13261059","id":"13261059","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a patch that creates a WAIT_FOR_POST_COMMIT procedure in the decorateSQL and then calls it before doing the assertUnorderedResultSet after a delete.\r\n\r\nI intend to commit this shortly; then backport it to 10.8.\r\n\r\nAs I've not been able to reproduce the issue at will this is a bit of a guess, we might have to revisit the issue again later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-04-24T21:48:46.707+0000","updated":"2012-04-24T21:48:46.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13261156","id":"13261156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"comments from the review.   The call to wait_for_post_commit should be placed after the commit that follows a delete.  putting after the delete but before the commit does not help.  The problem is caused by async work done that starts when commit is called.\r\n\r\nThe calls on lines 6774 and 7140 and 7340 are all too soon, they should come after the first commit following the delete.\r\n\r\nAlso the change does not handle the deletes that are made because of deleteRow() being called.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-24T23:57:40.125+0000","updated":"2012-04-24T23:57:40.125+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13261204","id":"13261204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"You're right of course.\r\nThis was because I looked at the stack trace of the original error, which shows this:\r\n------------\r\ntestReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet\r\nat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java:1349)\r\nat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java:1285)\r\nat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.updateBtreeSetLocks(UpdateLocksTest.java:6764) \r\n-------------\r\nSo I assumed I had to put the call for wait_for_post_commit *before* the assertUnorderedResultSet call on line 6764.\r\n\r\nThe delete-commit it would affect is then not the delete call right before ((original file line 6760/6761):  s.executeUpdate(\"delete from a where a = 2 or a = 4 or a = 6\");)\r\nBecause, as you say, there's no commit for that one yet.\r\nInstead it would be for the earlier delete (original file line 6689/6690):   \r\n         s.executeUpdate(\r\n            \"delete from a where a = 4\"); \r\nwhich got committed on line (again, original file numbers:) 6732.\r\n\r\nStill, there's no good explanation for the placing of the other wait_for_commit calls. I will make a new patch that does the call after the commit belonging to each delete - and after the commit following each deleteRow() call.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-04-25T01:33:05.136+0000","updated":"2012-04-25T01:59:04.458+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13261242","id":"13261242","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching patch _2.diff which puts the calls for wait_for_post_commit after each commit following a delete.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-04-25T02:10:13.659+0000","updated":"2012-04-25T02:10:13.659+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13261827","id":"13261827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"the second patch looks good to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-04-25T17:28:45.972+0000","updated":"2012-04-25T17:28:45.972+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13261962","id":"13261962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I applied the changes as per patch _2.diff to trunk with revision 1330482 and merged 1330066 and 1330482 to 10.8 with revision 1330489. \r\nI'm resolving this issue. It's possible the test will fail again because of activity resulting from updates, if it does, we can repeat the solution for that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-04-25T19:11:25.302+0000","updated":"2012-04-25T19:11:25.302+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13289523","id":"13289523","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"The problem occurred again last night, with ibm 1.4.2, with the 10.8 branch updated to revision 1346212.\r\n\r\nThis is the stack trace:\r\n\r\n1) testReadUncommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet\r\n\tat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java(Compiled Code))\r\n\tat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java(Compiled Code))\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.updateBtreeSetLocks(UpdateLocksTest.java:7373)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.doRunTests(UpdateLocksTest.java:264)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.testReadUncommitted(UpdateLocksTest.java:168)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code))\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java(Compiled Code))\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-06-05T16:42:56.585+0000","updated":"2012-06-05T16:42:56.585+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13289626","id":"13289626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"See: http://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm142/1346212-suites.All_diff.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-06-05T18:28:51.290+0000","updated":"2012-06-05T18:28:51.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13423900","id":"13423900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Looking again at the previous mention, it seems something else than post-commit activity after a delete-commit is going on, because the code that failed already had the post-commit call in place...\r\nI think more detailed output on error would help.\r\n\r\nThis test failed again, on July 24, on nightly builds off the 10.8 branch synced to revision 1365402 on windows with ibm 1.4.2.: \r\nhttp://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm142/1365402-suites.All_diff.txt.\r\n\r\nThe stack trace indicates the trouble this time was after an update, not a delete:\r\n1) testSerializable(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Unexpected row count expected:<4> but was:<6>\r\n\tat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java(Compiled Code))\r\n\tat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java(Compiled Code))\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.updateBtreeSetLocks(UpdateLocksTest.java:7085)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.doRunTests(UpdateLocksTest.java:252)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.testSerializable(UpdateLocksTest.java:164)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code))\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java(Compiled Code))\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n(There was also an error in the subsequent fixture testReadUncommitted (java.sql.SQLException: Table/View 'A' already exists in Schema 'APP') - but I'm chalking that up to a result of the failure)\r\n\r\nAlso, I it seems these failures in UpdateLocksTest seem to be happening only on the machine running 10.8 windows tests, and most often with ibm 1.4.2. Could be there's just more concurrency trouble on this machine - it's a 4 CPU but it's running suites.All for 6 jvm versions at the same time...\r\n\r\nI will work towards a new patch which does:\r\n1. print out more detailed info on error\r\n2. adds the wait_for_post_commit calls to all commits following an update.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-07-27T14:27:18.828+0000","updated":"2012-07-27T14:27:18.828+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13427754","id":"13427754","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a patch which:\r\n- in store.UpdateLocksTest, adds a call to wait_for_post_commit after each commit following an update\r\n- in junit.JDBC, modifies the 'missing Rows' output to always print out the actual and expected rows:\r\n\r\nIndex: java/testing/org/apache/derbyTesting/junit/JDBC.java\r\n===================================================================\r\n--- java/testing/org/apache/derbyTesting/junit/JDBC.java        (revision 1368744)\r\n+++ java/testing/org/apache/derbyTesting/junit/JDBC.java        (working copy)\r\n@@ -1392,7 +1392,9 @@\r\n             expected.removeAll( actual );\r\n             BaseTestCase.println\r\n                 ( \"These expected rows don't appear in the actual result: \" + expected );\r\n-            Assert.fail( \"Missing rows in ResultSet\" );\r\n+            String message = \"Missing rows in ResultSet; expected rows: \\n\\t\"\r\n+                + expected + \", actual result: \\n\\t\" + actual;\r\n+            Assert.fail( message );\r\n         }\r\n     }\r\n\r\nI hesitated before changing this, because there is a BaseTestCase.println line that does mostly the same - but of course we need to have verbose on. I could change the nightly run mechanisms to always run with verbose. But I think that will give us too much info in full runs, and this test does not fail often.\r\n\r\nAlso, this change is on trunk, and I tend to backport to 10.8, as it is the community's common practice to backport from trunk. However. Alternatively, I could make this change only on 10.8, as that is where we appear to be seeing this (mostly?). Anyone having a preference to this 10.8 alternative?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-03T00:09:06.979+0000","updated":"2012-08-03T00:09:06.979+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13427758","id":"13427758","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"reattaching the file, after renaming it to _3.diff, so I can flag the grant to ASF button.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-03T00:12:26.615+0000","updated":"2012-08-03T00:12:26.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13427760","id":"13427760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"patch available for review","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-03T00:12:53.636+0000","updated":"2012-08-03T00:12:53.636+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13429314","id":"13429314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thank you Myna for the patch.\r\nI think printing the missing  expected results and the actual results as part of the failure is a good idea but since actual and expected are Array's, I think the following won't print the contents of the array, just the Array object reference.  \r\n\r\n\r\n+            String message = \"Missing rows in ResultSet; expected rows: \\n\\t\" \r\n+                + expected + \", actual result: \\n\\t\" + actual;\r\n\r\nOtherwise the patch looks fine to me. My vote is to put  it into trunk and backport to 10.8. I generally don't like to dead end anything in a branch unless it is an alternate fix to a trunk fix.\r\n \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-08-06T18:14:56.340+0000","updated":"2012-08-06T18:14:56.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13429558","id":"13429558","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Thanks for the review and input, Kathey.\r\nBut 'actual' and 'expected' are not Arrays, but ArrayLists. To my delight, ArrayList has a toString() method that seems sufficient to print out further info.\r\n(ArrayList.toString():\r\nReturns a string representation of this collection. The string representation consists of a list of the collection's elements in the order they are returned by its iterator, enclosed in square brackets (\"[]\"). Adjacent elements are separated by the characters \", \" (comma and space). Elements are converted to strings as by String.valueOf(Object). )\r\n\r\nI modified the placings of \\n and \\t a little since I created my patch.\r\nTo see what we'd get if the test failed, for debugging, I moved the creation of the 'message' String out of the if block, added a println, and ran UpdateLocksTest. I got output like this:\r\n\t expected rows: \r\n\t\t[[APP, UserTran, TABLE, 1, IX, A, Tablelock, GRANT, ACTIVE]], \r\n\t actual result: \r\n\t\t[[APP, UserTran, TABLE, 1, IX, A, Tablelock, GRANT, ACTIVE]]\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-06T23:07:09.468+0000","updated":"2012-08-06T23:07:09.468+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13429563","id":"13429563","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a patch that is just like the previous DERBY-5667_3.diff, except that there's some minor changes in the location of the returns and tabs, to facilitate visual comparison in the output.\r\n\r\nI will commit this shortly to trunk, then port it back to 10.9 and 10.8 later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-06T23:12:55.008+0000","updated":"2012-08-06T23:12:55.008+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13429567","id":"13429567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"committed patch _3b.diff to trunk with revision: http://svn.apache.org/viewvc?view=revision&revision=1370058","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-06T23:22:08.992+0000","updated":"2012-08-06T23:22:08.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13430821","id":"13430821","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a patch which is the result of svn  merge -c for UpdateLocksTest, but JDBC.java needed manual adjustment. \r\n\r\nI will to commit this shortly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-08T02:47:57.973+0000","updated":"2012-08-08T02:47:57.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13430823","id":"13430823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"committed patch _3_109.diff to 10.9 with revision: http://svn.apache.org/viewvc?view=revision&revision=1370647","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-08T02:51:35.229+0000","updated":"2012-08-08T02:51:35.229+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13432119","id":"13432119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"committed backport of revison 1370647 from 10.9 branch to 10.8 (clean merge using svn merge -c 1370647  https://svn.apache.org/repos/asf/db/derby/code/branches/10.9), see: http://svn.apache.org/viewvc?view=revision&revision=1371433","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-08-09T20:26:53.360+0000","updated":"2012-08-09T20:26:53.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13565836","id":"13565836","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I think this issue has been resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2013-01-29T21:34:26.832+0000","updated":"2013-01-29T21:34:26.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13897341","id":"13897341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"This failed again on the 10.8 branch, with ibm 1.4.2, linux, see:\r\nhttp://people.apache.org/~myrnavl/derby_test_results/v10_8/linux/testlog/ibm142/1566493-suites.All_diff.txt\r\ntestReadUncommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Unexpected row count expected:<3> but was:<2>\r\n\tat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java(Compiled Code))\r\n\tat org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java(Compiled Code))\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.updateBtreeCursorLocks2(UpdateLocksTest.java:5874)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.doRunTests(UpdateLocksTest.java:337)\r\n\tat org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.testReadUncommitted(UpdateLocksTest.java:168)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java(Compiled Code))\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code))\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java(Compiled Code))\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\r\nInterestingly, I can now duplicate this behavior very easily on my machine with 10.8 classes and running the store suite.\r\nI narrowed it down to (apparently) a cleanup issue in the test Derby4676Test.java.\r\nI will work on an improved cleanup.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-11T00:36:28.376+0000","updated":"2014-02-11T00:36:28.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13897427","id":"13897427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"On closer look, it's not that simple.\r\n\r\nI think there is an issue with ibm 1.4.2 and Thread maintenance, I believe we have seen other instances of trouble. \r\nIf ,with 10.8 classes and ibm 1.4.2, I have only the Derby4676Test run before UpdateLocksTest, then on my system, there are always one or more failures in the UpdateLocksTest.\r\nWith ibm 1.5 or higher, all is fine.\r\nIf I do not have Derby4676Test, all is fine.\r\nIf I only have embeddedSuite for Derby4676Test, all is fine in UpdateLocksTest also.\r\nIf I only have clientServerSuite for Derby4676Test, all is fine in UpdateLocksTest also.\r\nBut if I have defaultSuite, the UpdateLocksTest fails with ibm 1.4.2\r\n\r\nI have tried to put waitforPostCommit calls in various places in the teardown, but it does not appear to matter.\r\n\r\nAt this point, I propose to make the Derby4676Test to only run in embedded with ibm 1.4.2  on 10.8. I do not intend to make this change on any other branch, even on 10.8 I do not really expect anyone to run with 1.4.2 anymore.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-11T01:43:50.145+0000","updated":"2014-02-11T01:44:21.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13897565","id":"13897565","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Unfortunately, when I ran the normal length store._Suite, UpdateLocksTest failed again.\r\nWhen I eliminate the Derby4676Test altogether, then the UpdateLocksTest passes...\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-11T06:19:30.496+0000","updated":"2014-02-11T06:19:30.496+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13898254","id":"13898254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I made a little modification in JDBC.assertUnorderedResultSet, and added a commit to UpdateLocksTest.teardown, and this resulted in the following test output (ibm 1.4.2, 10.8, on my windows 7 laptop):\r\n\r\n(emb)store.Derby4676Test.testConcurrentFetchAndDelete used 4817 ms .\r\n(net)store.Derby4676Test.testConcurrentFetchAndDelete used 4103 ms .\r\n(emb)store.UpdateLocksTest.testRepeatableRead used 3814 ms .\r\n(emb)store.UpdateLocksTest.testReadCommitted used 3401 ms .\r\n(emb)store.UpdateLocksTest.testSerializable used 3568 ms F.\r\n(emb)store.UpdateLocksTest.testReadUncommitted used 1773 ms F\r\nTime: 28.754\r\nThere were 2 failures:\r\n1) testSerializable(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Unexpected row count, expected: 2, actual: 3\r\n         expected rows:\r\n                [[APP, UserTran, TABLE, 2, IX, A, Tablelock, GRANT, ACTIVE], [APP, UserTran, ROW, 3, X, A, (1,9), GRANT, ACTIVE]]\r\n         actual result:\r\n                [[APP, UserTran, TABLE, 2, IX, A, Tablelock, GRANT, ACTIVE], [APP, UserTran, ROW, 1, U, A, (1,9), GRANT, ACTIVE], [APP, UserTran, ROW, 2, X, A, (1,9), GRANT, ACTIVE]] expected:<2> but was:<3>\r\n        at org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java(Compiled Code))\r\n        at org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java:1304)\r\n        at org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.updateBtreeSetLocks(UpdateLocksTest.java:7028)\r\n        at org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.doRunTests(UpdateLocksTest.java:254)\r\n        at org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.testSerializable(UpdateLocksTest.java:166)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:88)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:61)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code))\r\n        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n2) testReadUncommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Unexpected row count, expected: 3, actual: 2\r\n         expected rows:\r\n                [[APP, UserTran, TABLE, 2, IX, A, Tablelock, GRANT, ACTIVE], [APP, UserTran, ROW, 1, X, A, (1,10), GRANT, ACTIVE], [APP, UserTran, ROW, 3, X, A, (1,9), GRANT, ACTIVE]]\r\n         actual result:\r\n                [[APP, UserTran, TABLE, 2, IX, A, Tablelock, GRANT, ACTIVE], [APP, UserTran, ROW, 2, X, A, (1,9), GRANT, ACTIVE]] expected:<3> but was:<2>\r\n        at org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java(Compiled Code))\r\n        at org.apache.derbyTesting.junit.JDBC.assertUnorderedResultSet(JDBC.java:1304)\r\n        at org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.updateBtreeSetLocks(UpdateLocksTest.java:7472)\r\n        at org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.doRunTests(UpdateLocksTest.java:266)\r\n        at org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest.testReadUncommitted(UpdateLocksTest.java:170)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:88)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:61)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java(Compiled Code))\r\n        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:113)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\r\nIt is surprising that I can make UpdateLocksTest fail when run after Derby4676Test. But if we're assuming that there issue is background threads from the deletes in the earlier test, then why doesn't that show up in the first test cases?\r\n\r\nI can modify the 10.8 store._Suite so it runs the two tests in reverse order with ibm 1.4.2.\r\nBut I would like to understand a bit more, in case failures pop up again in UpdateLocksTest on later branches with newer jvms.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-11T20:11:54.530+0000","updated":"2014-02-11T20:11:54.530+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13898566","id":"13898566","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I looked closely at the first failure in your recent posting, a failure in testSerializable, with updateBtreeSetLocks.  This test is expecting a query plan to use the index.  The difference is rather than 3 X row locks, we end up with 2 X row locks and a U lock.\r\n\r\nThe query is:\r\n       /* ------------------------------------------------------------\r\n         * Test updates an exact match on a with base row qualification\r\n         * necessary.\r\n         *\r\n         * At this point the table should look like:\r\n         * 1, 10, 'one'\r\n         * 3, 300, 'three'\r\n         * 5, 50, 'five'\r\n         * 7, 70, 'seven'\r\n         * ------------------------------------------------------------\r\n         */\r\n        s.executeUpdate(\r\n            \"update a  set b = 30 where a = 3 and b = 300\");\r\n\r\nThere is a index on a, and query needs to go to base table to read and write b.\r\n\r\nI think the expected locks are:\r\nlook up a=3 in index (IX table on a, X lock on row a=3)\r\nfind base row and get value b (X lock on row a=3, b=300 in base table)\r\nseparate step to update the value in base table (IX table on a, X lock on row a=3, b=300)\r\n\r\nI believe we actually in-line ask for a U row lock first at some point and then escalate\r\nit to X when we have gotten it and know we are going to do the update.  I don't know\r\nwhy a U lock would be left around in any case.  It would not cause any problem because the xact already has X lock until end transaction so the U lock becomes\r\nmeaningless.  \r\n\r\nThe lock count is an internal implementation detail and probably should not have\r\nbeen exposed, but doing that would have been more work than just dumping the\r\nlock table state.  And originally the tool really was more for debugging the lock\r\nmanager than providing something for users.\r\n\r\n  \r\n\r\nI looked closely and it looks like the code handles committed deletes with proper wait for post commit.  \r\n\r\nSo, given you are seeing intermittent issues, I started wondering if it could be related to the other background timing issue with tests - the automatic statistics gatherer.  This test has very few rows and in this test case  I think all the rows fit on one page of index and one page of a data page.   I could see the optmizer picking\r\na different plan with a change of statistics.  I sugest turning off the statistics gatherer for all locking tests like these\r\nthat expect to own exactly how the query will be executed.  \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2014-02-12T00:42:03.136+0000","updated":"2014-02-12T00:42:03.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13898567","id":"13898567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"the second failure:\r\n2) testReadUncommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Unexpected row count, expected: 3, actual: 2\r\nexpected rows:\r\n[[APP, UserTran, TABLE, 2, IX, A, Tablelock, GRANT, ACTIVE], [APP, UserTran, ROW, 1, X, A, (1,10), GRANT, ACTIVE], [APP, UserTran, ROW, 3, X, A, (1,9), GRANT, ACTIVE]]\r\nactual result:\r\n[[APP, UserTran, TABLE, 2, IX, A, Tablelock, GRANT, ACTIVE], [APP, UserTran, ROW, 2, X, A, (1,9), GRANT, ACTIVE]] expected:<3> but was:<2>\r\n\r\nIn this case we expected X row locks on both rows in the table since the scan is a range\r\nthat includes both rows.  But we only got locks on one row, can't tell from the output but\r\nhave to assume it is on the one qualifying row.  This does have the feel of a different\r\nexecution plan for some reason.\r\n\r\n /* ------------------------------------------------------------\r\n         * Test qualified full cursor scan which updates a row.\r\n         *\r\n         * At this point the table should look like:\r\n         * 3, -30, '-three'\r\n         * 5, -50, 'five'\r\n         * ------------------------------------------------------------\r\n         */\r\n        s.executeUpdate(\r\n            \"update a  set b = 30 where a > 2 and a < 5\");\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2014-02-12T00:44:57.289+0000","updated":"2014-02-12T19:42:20.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13899715","id":"13899715","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"The failures (still only with ibm 1.4.2 and only if I run Derby4676Test first) are always in the method UpdateLocksTest.updateBtreeSetLocks, and always in the checks after a delete or update, but before commit. I've seen all of them fail at one point or another. I've seen test failures in all the isolations in differing combinations. The test mostly repeats the same checks after a commit and those are always fine.\r\n\r\nI've thought of updating runtimestatistics before the check, but that seems to only cause additional IS locks. I could do a commit after the runtimestatistics call, but that would make the checks unnecessary because we already have the one after commit.\r\n\r\nI have tried to make the UpdateLocksTest bounce the database, from the comments this should happen when you pass 'true' as the third argument to the SystemPropertyTestSetup, but that did not change the behavior.\r\n\r\nAlthough it's still mysterious that this pops when I run the Derby4676Test first, I think at this point I am satisfied that for some reason it makes the optimizer like a different plan. The instability remains possible and only if we modify the entire test and make a search for only those locks we are really after will this be completely eliminated. I do not intend to make that effort at this time.\r\n\r\nI will do the following:\r\nfor all branches\r\n- add a commit() to the teardown in UpdateLocksTest so it doesn't choke in attempting to create 'A' table for subsequent test fixtures if one fails\r\n- expand the error reporting in JDBC.assertUnorderedResultSet to show any missing rows\r\nonly for 10.8:\r\n- add a private method (assertUnorderedResultSet) in UpdateLocksTest which just returns if the jvm is ibm142, and calls the public JDBC.assertUnorderedResultSet otherwise, and use this method in the problematic calls in UpdateLocksTest.updateBtreeSetLocks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-12T22:53:30.248+0000","updated":"2014-02-12T22:54:26.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13899728","id":"13899728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1567787 from [~myrna] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1567787 ]\r\n\r\nDERBY-5667; testReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet\r\n   further improving error message in assert, and avoiding error message re table exists if a test case fails","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-12T23:01:36.627+0000","updated":"2014-02-12T23:01:36.627+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13899888","id":"13899888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1567823 from [~myrna] in branch 'code/branches/10.10'\r\n[ https://svn.apache.org/r1567823 ]\r\n\r\nDERBY-5667;  testReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet\r\n   backport of revision 1567787 from trunk - improve error message","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-13T01:21:18.193+0000","updated":"2014-02-13T01:21:18.193+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13899918","id":"13899918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1567826 from [~myrna] in branch 'code/branches/10.9'\r\n[ https://svn.apache.org/r1567826 ]\r\n\r\nDERBY-5667; testReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet\r\n   backport of revision 1567823 from trunk, not a clean merge of JDBC.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-13T01:53:11.474+0000","updated":"2014-02-13T01:53:11.474+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13899928","id":"13899928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1567828 from [~myrna] in branch 'code/branches/10.8'\r\n[ https://svn.apache.org/r1567828 ]\r\n\r\nDERBY-5667; testReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet\r\n  merge of revision 1567826 from 10.9 branch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-13T02:03:56.117+0000","updated":"2014-02-13T02:03:56.117+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13899932","id":"13899932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1567831 from [~myrna] in branch 'code/branches/10.8'\r\n[ https://svn.apache.org/r1567831 ]\r\n\r\nDERBY-5667; testReadCommitted(org.apache.derbyTesting.functionTests.tests.store.UpdateLocksTest)junit.framework.AssertionFailedError: Missing rows in ResultSet\r\n   making part of the tests' checks skip with ibm 1.4.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-13T02:09:20.389+0000","updated":"2014-02-13T02:09:20.389+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12547298/comment/13900548","id":"13900548","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Although several improvements have gone in (some improved error messaging, and especially, adding of calls to wait for background commit tasks), and I've  added skipping of one set of checks that failed on one particular machine with one particular JVM in the 10.8 branch, it is still possible that this test might show instability. To eliminate that, we'd have to go through this test and figure out in each case, which lock we're really interested in, and look for that one only.\r\n\r\nI do not intend to do that at this time, so I am closing this issue as 'Won't Fix'. If this failure becomes prevalent, we can re-evaluate.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-13T17:56:21.489+0000","updated":"2014-02-13T17:56:21.489+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5667/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06fxz:"}}