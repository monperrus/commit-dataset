{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12523479","self":"https://issues.apache.org/jira/rest/api/latest/issue/12523479","key":"MAHOUT-814","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310751","id":"12310751","key":"MAHOUT","name":"Mahout","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310751&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310751&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310751&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310751&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13060","id":"13060","description":"Apache Mahout","name":"Mahout"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316364","id":"12316364","description":"","name":"0.6","archived":false,"released":true,"releaseDate":"2012-02-06"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-09-18 20:43:15.799","customfield_12312323":null,"customfield_12310420":"9249","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_642861342_*|*_1_*:*_1_*:*_127007832_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-09-27T12:26:08.852+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-814/watchers","watchCount":0,"isWatching":false},"created":"2011-09-18T14:34:59.725+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315255","id":"12315255","description":"","name":"0.5","archived":false,"released":true,"releaseDate":"2011-05-27"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-02-09T14:00:40.230+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"Running Mahout in an environment with Jenkins also running and am getting:\r\n{quote}\r\njava.io.FileNotFoundException: /tmp/q-temp.seq (Permission denied)\r\n        at java.io.FileOutputStream.open(Native Method)\r\n        at java.io.FileOutputStream.<init>(FileOutputStream.java:209)\r\n        at org.apache.hadoop.fs.RawLocalFileSystem$LocalFSFileOutputStream.<init>(RawLocalFileSystem.java:187)\r\n        at org.apache.hadoop.fs.RawLocalFileSystem$LocalFSFileOutputStream.<init>(RawLocalFileSystem.java:183)\r\n        at org.apache.hadoop.fs.RawLocalFileSystem.create(RawLocalFileSystem.java:241)\r\n        at org.apache.hadoop.fs.ChecksumFileSystem$ChecksumFSOutputSummer.<init>(ChecksumFileSystem.java:335)\r\n        at org.apache.hadoop.fs.ChecksumFileSystem.create(ChecksumFileSystem.java:368)\r\n        at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:528)\r\n        at org.apache.hadoop.io.SequenceFile$BlockCompressWriter.<init>(SequenceFile.java:1198)\r\n        at org.apache.hadoop.io.SequenceFile.createWriter(SequenceFile.java:401)\r\n        at org.apache.hadoop.io.SequenceFile.createWriter(SequenceFile.java:284)\r\n        at org.apache.mahout.math.hadoop.stochasticsvd.qr.QRFirstStep.getTempQw(QRFirstStep.java:263)\r\n        at org.apache.mahout.math.hadoop.stochasticsvd.qr.QRFirstStep.flushSolver(QRFirstStep.java:104)\r\n        at org.apache.mahout.math.hadoop.stochasticsvd.qr.QRFirstStep.map(QRFirstStep.java:175)\r\n        at org.apache.mahout.math.hadoop.stochasticsvd.qr.QRFirstStep.collect(QRFirstStep.java:279)\r\n        at org.apache.mahout.math.hadoop.stochasticsvd.QJob$QMapper.map(QJob.java:142)\r\n        at org.apache.mahout.math.hadoop.stochasticsvd.QJob$QMapper.map(QJob.java:71)\r\n        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)\r\n        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)\r\n        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)\r\n        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:212)\r\n{quote}\r\n\r\nAlso seeing the following tests fail:\r\n{quote}\r\n\r\nTests in error: \r\n  testSSVDSolverSparse(org.apache.mahout.math.hadoop.stochasticsvd.LocalSSVDSolverSparseSequentialTest): Q job unsuccessful.\r\n  testSSVDSolverPowerIterations1(org.apache.mahout.math.hadoop.stochasticsvd.LocalSSVDSolverSparseSequentialTest): Q job unsuccessful.\r\n  testSSVDSolverPowerIterations1(org.apache.mahout.math.hadoop.stochasticsvd.LocalSSVDSolverDenseTest): Q job unsuccessful.\r\n  testSSVDSolverDense(org.apache.mahout.math.hadoop.stochasticsvd.LocalSSVDSolverDenseTest): Q job unsuccessful.\r\n{quote}\r\n\r\nI haven't checked all of them, but I suspect they are all due to the same reason.  We should dynamically create a temp area for each test using temporary directories under the main temp dir.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"22607","summary":"SSVD local tests should use their own tmp space to avoid collisions","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":18,"total":18,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13107529","id":"13107529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"they used to use their own space. But I think Sebastian did a fix to use some methods from abstract mahout test class an\r\nd now they land somewhere else. I can take a look, provided I know what the best practice really is for using temp directories for tests using local Mr jobs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-18T20:43:15.799+0000","updated":"2011-09-18T20:43:15.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13107534","id":"13107534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"oh I think this particular thing is different. There's semiofficial rule in map red how to access task temporary space.  Maoreduce boxes each task in a way that its temporary space can be accessed thru a system variable.\r\n\r\nApparently, local Mr spends much less effort to box a task properly. We can probably figure a workaround for the local mode task boxing.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-18T20:56:35.750+0000","updated":"2011-09-18T20:56:35.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13107567","id":"13107567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"Yeah, it is different.  It's not actually in the test, it just manifested itself for me via the test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2011-09-19T00:16:54.915+0000","updated":"2011-09-19T00:16:54.915+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13107609","id":"13107609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"it's actually will only manifest in test with Jenkins for some reason. There's actually nothing to be fixed (except for maybe the local mode of the mapreduce itself), and it will work exactly as it is supposed in distributed mode. \r\n\r\nbut we can probably squeeze in a workaround into mahout abstract test class. Just another piece of black magic to plug a hole in local mapreduce mode.\r\n\r\nI can take a look at it next week, but I am not sure how to verify it with Jenkins other than committing it first.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-19T03:50:37.343+0000","updated":"2011-09-19T03:50:37.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13108303","id":"13108303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"Ok, I actually don't know what the best way to fix this. \r\n\r\nHadoop boxes tasks so that java.io.tmpdir points to the task's temporary directory in the mapred folder (in distributed mode). That's basically their contract for task temporary space. \r\n\r\nMy idea was to hack that in the case of local mapred to point something more suitable with mahout. \r\n\r\nBut that more suitable turns out to be... /tmp+something as in the following code: \r\n{code:title=MahoutTestCase.java}\r\n\r\n  protected final File getTestTempDir() throws IOException {\r\n    if (testTempDir == null) {\r\n      String systemTmpDir = System.getProperty(\"java.io.tmpdir\");\r\n      long simpleRandomLong = (long) (Long.MAX_VALUE * Math.random());\r\n      testTempDir = new File(systemTmpDir, \"mahout-\" + getClass().getSimpleName() + '-' + simpleRandomLong);\r\n      if (!testTempDir.mkdir()) {\r\n        throw new IOException(\"Could not create \" + testTempDir);\r\n      }\r\n      testTempDir.deleteOnExit();\r\n    }\r\n    return testTempDir;\r\n  }\r\n\r\n{code}\r\n\r\nSo... it looks like Mahout's test framework is already hooked on that (which in its turn is deregulated by Mahout, so it points to /tmp perhaps in test mode already). \r\n\r\nSo it looks like i cannot override java.io.tmpdir Mahout-wide because Mahout already attributes some meaning to that variable.\r\n\r\nI don't immediately see the best solution here. \r\n\r\ni can probably change the solvers so that they don't necessarily write to the task's root folder but create another folder there, but that still doesn't guarantee absence of clashes during tests (because only getTestTempDir() would guarantee that).\r\n\r\nSo i would want to solicit some discussion here.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-20T01:09:19.416+0000","updated":"2011-09-20T01:09:19.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13108304","id":"13108304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"Also -- I am not sure if I am construing the exception correctly in this sense -- the original stack trace doesn't look like there's a clash, but rather that in that Jenkins' environment, java.io.tmp is not writable by the process. which would be a problem regardless of what we do.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-20T01:14:13.061+0000","updated":"2011-09-20T01:14:13.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13108319","id":"13108319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"One hack that can probably overcome this. i am still not convinced that's the best way to do it, but at least the task wouldn't be writing directly into java.io.tmpdir when specifically requested not to.\r\n\r\nGithub snapshot is here: https://github.com/dlyubimov/mahout-commits/tree/MAHOUT-814\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-20T01:48:58.337+0000","updated":"2011-09-20T01:51:16.683+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13108328","id":"13108328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"another workaround, per tutorial, seems to be to construct this task per the rule below but does it have to be that complicated just to access task scratchpad path? besides, i looked at the history of this and it really subject to change. So using java.io.tmpdir really seems like the safest bet. \r\n\r\n{quote}\r\n\r\n$${mapred.local.dir}/taskTracker/jobcache/$jobid/$taskid/work/tmp : The temporary directory for the task. (User can specify the property mapred.child.tmp to set the value of temporary directory for map and reduce tasks. This defaults to ./tmp. If the value is not an absolute path, it is prepended with task's working directory. Otherwise, it is directly assigned. The directory will be created if it doesn't exist. Then, the child java tasks are executed with option -Djava.io.tmpdir='the absolute path of the tmp dir'. Anp pipes and streaming are set with environment variable, TMPDIR='the absolute path of the tmp dir'). This directory is created, if mapred.child.tmp has the value ./tmp\r\n\r\n\r\n{quote}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-20T02:08:54.496+0000","updated":"2011-09-20T02:37:47.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13108392","id":"13108392","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srowen","name":"srowen","emailAddress":"srowen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srowen&avatarId=10104","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srowen&avatarId=10104","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srowen&avatarId=10104","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srowen&avatarId=10104"},"displayName":"Sean Owen","active":true},"body":"Your analysis is completely correct. java.io.tmpdir is more than that -- it's the definition of \"writable temp space\" for Java itself. There should be nothing wrong with using this; in fact, it's the only reliable temp space available.\r\n\r\n1. If it's not writable, that's a problem with the host machine. As you might have noticed, Jenkins seems to be quite flaky; a few times a week it will fail for some internal machine-specific reason.\r\n\r\n2. However I too am not sure that's the issue; it could still be a clash somehow. Can you change the job that uses q-temp.seq to stash it in a file that maybe includes the timestamp? like q-temp-125095095090.seq. In general I think this is a good strategy, and why the test framework does exactly this.\r\n\r\nIt's either nothing for us to fix (1), or, I think, a case of making temp files more unique (2). You shouldn't have to do anything more complex.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srowen","name":"srowen","emailAddress":"srowen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srowen&avatarId=10104","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srowen&avatarId=10104","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srowen&avatarId=10104","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srowen&avatarId=10104"},"displayName":"Sean Owen","active":true},"created":"2011-09-20T06:16:32.074+0000","updated":"2011-09-20T06:16:32.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13108598","id":"13108598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"+1 on Sean's option #2.  The only question then is do we want to make it a little more forceful in the cleanup of temp files?  Perhaps a deleteOnExit?  Not sure what that would mean in distributed mode (I would assume it's safe, but what happens if you are reusing the JVM?)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2011-09-20T11:23:29.789+0000","updated":"2011-09-20T11:23:29.789+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13108858","id":"13108858","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"Actually, from what i am reading, even java.io.tmpdir may be shared between different tasks even in distributed mode in case jvm sharing is enabled (forget the property name, but i use it also at value of ~5-10 to speed up small tasks setup). \r\n\r\nIn which case using java.io.tmp/q-temp may potentially be a problem as well. \r\n\r\n+What i propose is it probably would be safer to use a directory *$java.io.tmp/$taskAttemptID* which would guarantee task uniqueness (but perhaps not with local tests, if it is not unique with local tests, i will add some random numbers).+\r\n\r\n{panel}\r\nA little background: having to write a temporary file in this task is a corner case only arising when Q block height set is smaller than the number of input rows of A coming in in one split, which should never be the case with normal block sizes but may be a case with minSplitSize splits set at 1G or something, or if A input is extremely sparse (such as one non-zero element per row on average, then yeah, Q blocks, which are k+p wide (the number of eigenvalues requested), could be rather memory intensive, which is not a very good use case for this method, i'd rather try to transpose first to see if it helps row-wise sparsity). \r\n\r\nOnly with those corner cases out-of-core version of task's local computation of what i call Q-hat blocks is used. But that pass is always sequential so it should capitalize on sequential read speeds and potentially OS I/O cache if there's enough memory installed.\r\n\r\nThe test however is set up intentionally the way that Q block height is set extremely small to test both blocking within a split and among the splits.\r\n{panel}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-20T17:50:44.106+0000","updated":"2011-09-20T18:03:54.573+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13108875","id":"13108875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"or timestamp approach may work too, of course.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-20T18:09:18.829+0000","updated":"2011-09-20T18:09:18.829+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13109689","id":"13109689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nathanhalko","name":"nathanhalko","emailAddress":"nathan at spotinfluence dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nathan Halko","active":true},"body":"Not sure it this is related, but sounds similar.  I can't run more than one power iteration, ie q=2 produces\r\n\r\n11/09/21 11:25:46 INFO mapred.LocalJobRunner: reduce > reduce\r\n11/09/21 11:25:46 INFO mapred.Task: Task 'attempt_local_0004_r_000000_0' done.\r\n11/09/21 11:25:50 INFO mapred.JobClient: Cleaning up the staging area file:/tmp/hadoop-nathanhalko/mapred/staging/nathanhalko-200181280/.staging/job_local_0005\r\nException in thread \"main\" org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory temp/ABt-job-1 already exists\r\n\tat org.apache.hadoop.mapreduce.lib.output.FileOutputFormat.checkOutputSpecs(FileOutputFormat.java:134)\r\n\tat org.apache.hadoop.mapred.JobClient$2.run(JobClient.java:830)\r\n\tat org.apache.hadoop.mapred.JobClient$2.run(JobClient.java:791)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat javax.security.auth.Subject.doAs(Subject.java:396)\r\n\tat org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1059)\r\n\tat org.apache.hadoop.mapred.JobClient.submitJobInternal(JobClient.java:791)\r\n\tat org.apache.hadoop.mapreduce.Job.submit(Job.java:465)\r\n\tat org.apache.mahout.math.hadoop.stochasticsvd.ABtJob.run(ABtJob.java:454)\r\n\tat org.apache.mahout.math.hadoop.stochasticsvd.SSVDSolver.run(SSVDSolver.java:312)\r\n\tat org.apache.mahout.math.hadoop.stochasticsvd.SSVDCli.run(SSVDCli.java:118)\r\n\tat org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)\r\n\tat org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:79)\r\n\tat org.apache.mahout.math.hadoop.stochasticsvd.SSVDCli.main(SSVDCli.java:163)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat org.apache.hadoop.util.ProgramDriver$ProgramDescription.invoke(ProgramDriver.java:68)\r\n\tat org.apache.hadoop.util.ProgramDriver.driver(ProgramDriver.java:139)\r\n\tat org.apache.mahout.driver.MahoutDriver.main(MahoutDriver.java:188)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat org.apache.hadoop.util.RunJar.main(RunJar.java:156)\r\n\r\nfor q=0,1 everything works fine.  I am running with --overwrite and I rm -rf the temp dir before running.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nathanhalko","name":"nathanhalko","emailAddress":"nathan at spotinfluence dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nathan Halko","active":true},"created":"2011-09-21T17:32:36.974+0000","updated":"2011-09-21T17:32:36.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13109725","id":"13109725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"no it isn't related. Good catch. q=1 has put such a good showing i never tried q>1, not even in local tests. That should be a typo-kind fix.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-21T18:08:42.912+0000","updated":"2011-09-21T18:08:42.912+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13109767","id":"13109767","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"Nathan, your issue is now resolved in MAHOUT-816 (pending commit)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-21T18:43:02.072+0000","updated":"2011-09-21T18:43:02.072+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13109814","id":"13109814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"Implementation per Grant's suggestion. \r\n\r\nBTW, part of the suggestion (cleaning out task temp files) has already been implemented before. And that actually happens on cleanup() of the mapper.\r\n\r\nI am still kind of dubious of the reason of the exception. looks like permission issues on java.io.tmpdir to me.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-21T19:32:25.702+0000","updated":"2011-09-21T19:32:25.702+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13113020","id":"13113020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"body":"Ok, i take it there's no objections, then i will commit it. it is a simple patch, and that's what Grant wanted...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dlyubimov","name":"dlyubimov","emailAddress":"dlyubimov at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dmitriy Lyubimov","active":true},"created":"2011-09-22T23:27:09.357+0000","updated":"2011-09-22T23:27:09.357+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12523479/comment/13113130","id":"13113130","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #1057 (See [https://builds.apache.org/job/Mahout-Quality/1057/])\r\n    MAHOUT-814 (patch rev.1)\r\n\r\ndlyubimov : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1174452\r\nFiles : \r\n* /mahout/trunk/core/src/main/java/org/apache/mahout/math/hadoop/stochasticsvd/qr/QRFirstStep.java\r\n* /mahout/trunk/core/src/test/java/org/apache/mahout/math/hadoop/stochasticsvd/LocalSSVDSolverDenseTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-09-23T03:21:26.079+0000","updated":"2011-09-23T03:21:26.079+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-814/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i048a7:"}}