{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12685636","self":"https://issues.apache.org/jira/rest/api/latest/issue/12685636","key":"SOLR-5561","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325573","id":"12325573","description":"Major release after 4.6","name":"4.7","archived":false,"released":true,"releaseDate":"2014-02-26"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321664","id":"12321664","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2014-01-13 22:09:57.939","customfield_12312323":null,"customfield_12310420":"364711","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4602925375_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-02-10T23:59:19.434+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5561/watchers","watchCount":5,"isWatching":false},"created":"2013-12-19T17:23:54.085+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["similarity"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325000","id":"12325000","description":"Major release after 4.5","name":"4.6","archived":false,"released":true,"releaseDate":"2013-11-24"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-03-16T13:04:09.562+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312520","id":"12312520","name":"Schema and Analysis","description":"Issues and features related to the IndexSchema, FieldTypes, and Analysis (TokenizerFactory, TokenFilterFactory, etc.)"}],"timeoriginalestimate":null,"description":"As a result, discountOverlap is not initialized to true, and the default behavior is that multiple terms on the same position DO affect the fieldNorm. this is not the intended default.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"365011","summary":"DefaultSimilarity 'init' method is not called, if the similarity plugin is not explicitly declared in the schema","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isaachebsh","name":"isaachebsh","emailAddress":"isaac dot hebsh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Isaac Hebsh","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isaachebsh","name":"isaachebsh","emailAddress":"isaac dot hebsh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Isaac Hebsh","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":8,"total":8,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685636/comment/13856995","id":"13856995","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isaachebsh","name":"isaachebsh","emailAddress":"isaac dot hebsh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Isaac Hebsh","active":true},"body":"Patch attached.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isaachebsh","name":"isaachebsh","emailAddress":"isaac dot hebsh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Isaac Hebsh","active":true},"created":"2013-12-26T18:47:37.182+0000","updated":"2013-12-26T18:47:37.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685636/comment/13870056","id":"13870056","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"bq. As a result, discountOverlap is not initialized to true, and the default behavior is that multiple terms on the same position DO affect the fieldNorm. this is not the intended default.\r\n\r\nGrr... that really sucks -- and seems easily confusing.\r\n\r\nMy concern about making this change as written in Isaac's patch is that it could cause some very weird inconsistencies for people who upgrade.\r\n\r\nMy suggestion would be to do the following...\r\n\r\n1) in DefaultSimilarityFactory, change the declaration of the discountOverlaps variable to default to true for cnsistency (seems like a good idea in general, even if we do fix the lifecycle to ensure init() gets called)\r\n2) in IndexSchema.java, where Isaac's patch currently fixes the hadcoded construction of a default instance of DefaultSimilarityFactory to always call init with empty SolrParams, make the params pased to the init param contingent on the value of the luceneMatchVersion -- if it's less then 4.7, pass discountOverlaps=false to the init method for backcompat, and if it's 4.7 or greater pass an empty set of params (so the factories defaults are used correctly)\r\n3) write some tests using trivial solrconfig.xml+schema.xml files with hardcoded version match params to verify that the correct behavior is being implemented.\r\n\r\nthoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2014-01-13T22:09:57.939+0000","updated":"2014-01-13T22:09:57.939+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685636/comment/13873339","id":"13873339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iorixxx","name":"iorixxx","emailAddress":"iorixxx at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=iorixxx&avatarId=18545","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=iorixxx&avatarId=18545","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=iorixxx&avatarId=18545","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=iorixxx&avatarId=18545"},"displayName":"Ahmet Arslan","active":true},"body":"I had this test case handy.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=iorixxx","name":"iorixxx","emailAddress":"iorixxx at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=iorixxx&avatarId=18545","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=iorixxx&avatarId=18545","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=iorixxx&avatarId=18545","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=iorixxx&avatarId=18545"},"displayName":"Ahmet Arslan","active":true},"created":"2014-01-16T13:06:00.882+0000","updated":"2014-01-16T13:06:00.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685636/comment/13885697","id":"13885697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vzhovtiuk","name":"vzhovtiuk","emailAddress":"vzhovtiuk at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vitaliy Zhovtyuk","active":true},"body":"Added changes to IndexSchema\r\nAdded IndexSchema tests checking discountOverlaps depending on luceneMatchVersion","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vzhovtiuk","name":"vzhovtiuk","emailAddress":"vzhovtiuk at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Vitaliy Zhovtyuk","active":true},"created":"2014-01-29T19:35:47.322+0000","updated":"2014-01-29T19:35:47.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685636/comment/13897114","id":"13897114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Ahmet & Vitaliy - thanks for your tests & improvements!\r\n\r\nHere's a slightly updated patch...\r\n\r\n* introduce a String constant for the \"discountOverlaps\" param name (since it's now used outside the class in IndexSchema, a constant is appropriate)\r\n* consolidated the two tests classes into one to reduce some duplication & leverage some existing BaseSimilarityTestCase helper methods\r\n* change the tests to leverage the Version enum values instead of just version string constants (this will make it easier to find/remove tests refering to 4.6 and 4.7 once those constants are no longer explicitly supported)\r\n* added some javadocs\r\n\r\nI'll commit soon unless anyone sees any problems?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2014-02-10T22:18:10.917+0000","updated":"2014-02-10T22:18:10.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685636/comment/13897275","id":"13897275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1566842 from hossman@apache.org in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1566842 ]\r\n\r\nSOLR-5561: Fix implicit DefaultSimilarityFactory initialization in IndexSchema to properly specify discountOverlap option","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-10T23:26:22.944+0000","updated":"2014-02-10T23:26:22.944+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685636/comment/13897302","id":"13897302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1566871 from hossman@apache.org in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1566871 ]\r\n\r\nSOLR-5561: Fix implicit DefaultSimilarityFactory initialization in IndexSchema to properly specify discountOverlap option (merge r1566842)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-02-10T23:55:37.752+0000","updated":"2014-02-10T23:55:37.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685636/comment/13897307","id":"13897307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Thanks everyone!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2014-02-10T23:59:19.455+0000","updated":"2014-02-10T23:59:19.455+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5561/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qv3j:"}}