{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12325690","self":"https://issues.apache.org/jira/rest/api/latest/issue/12325690","key":"DERBY-709","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-02-24 07:38:21.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22104","customfield_12310222":"1_*:*_1_*:*_9645581000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_32642991333","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-03-08T02:24:12.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-709/watchers","watchCount":0,"isWatching":false},"created":"2005-11-16T11:04:31.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10920","id":"10920","description":"initial source drop","name":"10.0.2.0","archived":false,"released":true,"releaseDate":"2004-08-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-30T00:14:44.188+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"CALL SYSCS_UTIL.SYSCS_BACKUP_DATABASE('extinout/bkup1');\nERROR 38000: The exception 'java.security.AccessControlException: access denied\n(java.util.PropertyPermission user.dir read)' was thrown while evaluating an exp\nression)\n\nCan be seen in the store/encryptionKey.sql test, modify the _app.properties file to enable the security manager.\n\nDue to logging messages using File.getCanonicalPath in RawStore.java, lines 675 and 686.\n\nPossible solutions:\n  - use a privileged block and required user.dir permission granted to user.dir to backup to a relative directory\n  - use a privileged block,if a security exception is thrown then just display the relative name, otherwise display the full name. This would allow backups to succeed without requiring granting additional permissions to derby.jar\n  - just log the relative path","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10361","value":"Security","id":"10361"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38857","summary":"SecurityException thrown when passing a relative path name when backing up database","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325690/comment/12357751","id":"12357751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Adding tests for absolute paths with backup would be good as well. Could use a Java function to create a absolute path from a relative name. In that case the code for the function would be in derby.jar whick can be granted permissions to read user.dir.\r\n\r\nE.g.\r\n\r\n CALL SYSCS_UTIL.SYSCS_BACKUP_DATABASE(FILENAME_RELATIVE('extinout/bkup1')); \r\n\r\nMaybe such tests exist already.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2005-11-16T11:08:35.000+0000","updated":"2005-11-16T11:08:35.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325690/comment/12367585","id":"12367585","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"DERBY-709:\r\n-- Removed the requirement for read permission on \"user.dir\" for backup to\r\nrun under security manager. Absolute Path were used only to log into backup\r\nhistory file. Changed it to log canonical paths only if it can be obtainer\r\n,otherwise only relative paths are written to the backup history file. \r\n  \r\n-- Added a missing privileged blocks to the save service.properties file into the backup. \r\n\r\n-- Added  privileged blocks for  test util file functions that are called \r\n   through SQL functions/procedures.\r\n   \r\n-- Enabled some of the tests which were not running under security manager \r\n   earlier because of this bug to run by default with security manager. \r\n   \r\nBackup tests that test backup with jar Operations still can not be run under security\r\nmanager due to bug DERBY-537. \r\n \r\n\r\nTESTS : derbyall test suite passed on Windows XP/JDK142\r\n\r\nIt would be great if some can review and commit this patch. \r\n\r\nsvn stat:\r\n\r\nM      java\\engine\\org\\apache\\derby\\impl\\services\\monitor\\StorageFactoryService.java\r\nM      java\\engine\\org\\apache\\derby\\impl\\store\\raw\\RawStore.java\r\nM      java\\engine\\org\\apache\\derby\\iapi\\reference\\MessageId.java\r\nM      java\\engine\\org\\apache\\derby\\loc\\messages_en.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\storetests\\st_1_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\OnlineBackupTest1_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\onlineBackupTest2_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\rollForwardBackup_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\RecoveryAfterBackup_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\BackupPathTests_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\backupRestore_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\RecoveryAfterBackupSetup_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\encryptionKey_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\backupRestore1_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\logDevice_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\OnlineBackupTest3_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\onlineBackupTest4_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\rollForwardRecovery_app.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\util\\FTFileUtil.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2006-02-24T07:38:21.000+0000","updated":"2006-02-24T07:38:21.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325690/comment/12367990","id":"12367990","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I reviewed and committed this patch:\r\nm1_142:79>svn commit\r\n\r\nSending        java\\engine\\org\\apache\\derby\\iapi\\reference\\MessageId.java\r\nSending        java\\engine\\org\\apache\\derby\\impl\\services\\monitor\\StorageFactory\r\nService.java\r\nSending        java\\engine\\org\\apache\\derby\\impl\\store\\raw\\RawStore.java\r\nSending        java\\engine\\org\\apache\\derby\\loc\\messages_en.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\Ba\r\nckupPathTests_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\On\r\nlineBackupTest1_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\On\r\nlineBackupTest3_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\Re\r\ncoveryAfterBackupSetup_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\Re\r\ncoveryAfterBackup_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\ba\r\nckupRestore1_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\ba\r\nckupRestore_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\en\r\ncryptionKey_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\lo\r\ngDevice_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\on\r\nlineBackupTest2_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\on\r\nlineBackupTest4_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\ro\r\nllForwardBackup_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\ro\r\nllForwardRecovery_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\storetes\r\nts\\st_1_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\util\\FTFileUti\r\nl.java\r\nTransmitting file data ...................\r\nCommitted revision 381389.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-02-28T02:20:13.000+0000","updated":"2006-02-28T02:20:13.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325690/comment/12368166","id":"12368166","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"This pach (derby-709_latest.diff)  fixes the  problems appreared with earlier patch when tests are run againest JARS. \r\n\r\n--- correctly catch the Security Exception  when  there is no permission to get a canonical path. \r\n---  Modified the deryb_tests.plocy to allow deltes in  ${user.dir}${/}extinout${/}-    ., \r\n      It is needed because , backup tests deletes the old copy of the backup  at the backup location.\r\n---  set noSecurityManager = true for the tests that can not  be run under security manager due to bug : 1066\r\n---  changes st_1   properties to use external  tests dirs ,  so  that  tests does not required  \"user.dir\" permission to create \r\n     parent  directories for the backup paths. \r\n\r\nTESTS:  storeall, encryptionAll passed.  on Jdk142/WindowsXP;   \r\n\r\nIt would be great if  some one can review and commit this patch. \r\n\r\nThanks\r\n-suresht\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2006-03-01T05:43:59.000+0000","updated":"2006-03-01T05:43:59.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325690/comment/12368205","id":"12368205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I have committed the latest patch which should address the jar specific test failures seen with the last patch:\r\n\r\nm1_142:5>svn commit\r\n\r\nSending        java\\engine\\org\\apache\\derby\\impl\\store\\raw\\RawStore.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\en\r\ncryptionKey_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\lo\r\ngDevice_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\ro\r\nllForwardBackup_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\storetes\r\nts\\st_1_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\util\\derby_tes\r\nts.policy\r\nTransmitting file data ......\r\nCommitted revision 381883.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-03-01T12:04:23.000+0000","updated":"2006-03-01T12:04:23.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-709/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i070k7:"}}