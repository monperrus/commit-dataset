{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12405871","self":"https://issues.apache.org/jira/rest/api/latest/issue/12405871","key":"DERBY-3902","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-05-05 11:45:01.753","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23909","customfield_12310222":"1_*:*_1_*:*_611021465_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-10-14T01:22:26.692+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3902/watchers","watchCount":0,"isWatching":false},"created":"2008-10-06T23:38:45.227+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12321974","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12321974","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12344406","key":"DERBY-1411","self":"https://issues.apache.org/jira/rest/api/2/issue/12344406","fields":{"summary":"DRDAConnThread uses SQLState.NO_SUCH_DATABASE, which has no matching message","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.png","name":"Trivial","id":"5"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-13T22:11:38.851+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11400","id":"11400","name":"Miscellaneous"}],"timeoriginalestimate":null,"description":"MessageBundleTest was taken out of derbyall because it only ran with classes, not with jars, and it was decided that it would be better to make this into a build check rather than a test...\r\n\r\nHowever, the build check - DERBY-1458 - was never implemented, and so, the test has not been run.\r\nWhen I ran, I got the following output:\r\n\r\ntestSQLStateOrphanedIds ERROR: Message id 22003.S.4 in SQLState.java was not found in messages_en.properties\r\nERROR: Message id XCL32.S in SQLState.java was not found in messages_en.properties\r\nERROR: Message id X0RQ3.C in SQLState.java was not found in messages_en.properties\r\nERROR: Message id XSAX1 in SQLState.java was not found in messages_en.properties\r\nused 188 ms .\r\ntestMessageIdOrphanedIds used 0 ms .\r\ntestMessageBundleOrphanedMessages WARNING: Message id 22004.S.4 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\nWARNING: Message id J106 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\nWARNING: Message id J107 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\nWARNING: Message id J108 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\nWARNING: Message id J109 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\nWARNING: Message id 08000.S.1 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\nWARNING: Message id XCL17.S in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\nWARNING: Message id XJ102.S in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\nused 0 ms \r\n\r\nSome of these are known issues, e.g. XCL32 - it's been in MessageBundleTest.out for a long time...\r\nXSAX1 looks like a assumption mismatch in MessageBundleTest, see DERBY-1413....\r\n\r\nBut others need some minor code changes/cleanup, for instance, looks like the need for J106 was removed during DERBY-2692, see http://svn.apache.org/viewvc?view=rev&revision=543428, and should probably get removed from messages_en.properties/messages.xml.\r\n\r\nNeeds further checking.\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37618","summary":"some messages are referenced but never used - MessageBundleTest output","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":4,"total":4,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405871/comment/12638399","id":"12638399","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"With revision 703170 for DERBY-1411 removed the X0RQ3 unused sqlstate.\r\nWith revision 703259 I corrected the SQLState reference in messages.xml & all translated .properties files for 22003.S.4 / 22004.S.4 - should've been 2004.S.4 both in SQLState.java & messages.xml (originally messages_en.properties) (See also a comment in DERBY-1567).\r\nI also fixed up the MessageBundleTest to ignore SQLStates XCL32 and XSAX1, which aren't exposed to end users and so do not need text. (See also DERBY-1414 and DERBY-1413).\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2008-10-09T21:24:29.466+0000","updated":"2008-10-09T21:24:29.466+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405871/comment/12638465","id":"12638465","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Some further research:\r\nJ106, J107, J108 and J109 were added with revision 395484. \r\nThey were thrown in only one class (J106, J107 in client.am.SqlExcpetion; J108 & J109 in client.am.Version), and maybe that's why they weren't moved into MessageId.java?\r\nSince then, the throwing of J106 has been removed, as I mentioned in an earlier comment, but the reference in SqlException still exist. That reference and the entries in messages.xml should get removed.\r\n\r\nWhat to do about J107, J108 and J109? Is there any reason why it's better to have these defined in individual classes rather than grouped in MessageId?\r\n\r\n---\r\n\r\n08000.S.1 (\"Cannot close a connection with an active transaction.  The transaction remains open and the connection was not closed\") was added to messages_en.properties with revision 388309.\r\nI think this might originally have been intended to replace this in client.am.Connection:\r\n@@ -713,8 +711,7 @@\r\n        // The following precondition matches CLI semantics, see SQLDisconnect()\r\n        if (!autoCommit_ && inUnitOfWork_ && !allowCloseInUOW_()) {\r\n            throw new SqlException(agent_.logWriter_,\r\n-                    \"java.sql.Connection.close() requested while a transaction is in progress on the connection.\" +\r\n-                    \"The transaction remains active, and the connection cannot be closed.\");\r\n+                    new MessageId (SQLState.CANNOT_CLOSE_ACTIVE_XA_CONNECTION));\r\n        }\r\n    }\r\nBut as per the svn diff, instead of a an entry in SQLState for 08000 it was mapped to CANNOT_CLOSE_ACTIVE_XA_CONNECTION (XJ059), later (revision 390176) and after discussion re DERBY-1149, this was changed to  CANNOT_CLOSE_ACTIVE_CONNECTION, which was added as SQLState 25001.S.1: Invalid transaction state: active SQL transaction\r\n\r\nSo, what's best here - add a code for 08000 and see if that section still exists &  map it? Or is it ok as is an we can just remove 08000 from the messages.xml?\r\n\r\n---\r\n\r\nXCL17 is a left over of expired Cloudscape-source and should be removed.\r\n\r\n---\r\n\r\nXJ102 - \"Can not perform an insert at the current position\" in messages_en.properties since revision 393967.\r\nProbably it was meant to replace the following in insertRowXXX in client.am.ResultSet:\r\n         // if not on a valid row, then do not accept updateXXX calls\r\n         if (!isValidCursorPosition_) {\r\n-            throw new SqlException(agent_.logWriter_, \"Invalid operation to \" +\r\n-                    \"insert at current cursor position\");\r\n+            throw new SqlException(agent_.logWriter_, \r\n+                new MessageId(SQLState.CURSOR_INVALID_OPERATION_AT_CURRENT_POSITION));\r\n         }\r\n(Note: the comment is probably the result of cut-and-paste-without-edit, should be insertXXX calls)\r\nBut as per the svn diff it was set to XJ121: \"Invalid operation at current cursor position\".\r\n\r\nAgain, what is best, leave it as is & remove XJ102 references from messages_en.properties or add an appropriate reference to SQLState?\r\n\r\nI'll remove the orphaned references to XCL17 and J106 now, but I'll wait a bit to see if anyone chimes in on the other issues.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2008-10-10T03:14:58.530+0000","updated":"2008-10-10T03:14:58.530+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405871/comment/12639268","id":"12639268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I addressed this by:\r\n- moving J107, J108 and J109 to common.reference.MessageId.\r\n  It seemed to me that there were no benefits from having them in the classes where they \r\n  were used, and logically, they belong with the rest of the constant message ids.\r\n- removed 08000.S.1.\r\n  Embedded throws error CANNOT_CLOSE_ACTIVE_CONNECTION (25001 - Cannot close a connection while a transaction is still active) in the similar situation, so it seemed better to leave this as is and remove the remove 08000.S.1 from messages.xml and the messages properties files.\r\n- removed XJ102\r\n  The current message XJ121 refers to the cursor position - I think that's preferred over clarifying that it's an insert that fails (which is likely clear from the end-user's actions).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2008-10-14T01:22:26.598+0000","updated":"2008-10-14T01:22:26.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405871/comment/12864289","id":"12864289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Closing issue.\r\nThese checks are now run as part of the build.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-05-05T11:45:01.753+0000","updated":"2010-05-05T11:45:01.753+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3902/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06swv:"}}