{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12401743","self":"https://issues.apache.org/jira/rest/api/latest/issue/12401743","key":"DERBY-3823","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315436","id":"12315436","description":"Head of 10.5 branch - version bump for DERBY-4835","name":"10.5.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315434","id":"12315434","description":"Head of 10.6 branch as of 2014-01-13","name":"10.6.2.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315902","id":"12315902","description":"Head of 10.7 branch as of 2010-11-29","name":"10.7.1.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323456","id":"12323456","description":"Third release on the 10.8 branch","name":"10.8.3.0","archived":false,"released":true,"releaseDate":"2012-11-16"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-01-07 07:30:10.721","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23864","customfield_12310222":"1_*:*_1_*:*_102336521150_*|*_5_*:*_2_*:*_11428998162_*|*_4_*:*_1_*:*_542927625","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-03-21T00:08:37.274+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3823/watchers","watchCount":1,"isWatching":false},"created":"2008-08-05T23:47:50.816+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_triage10_5_2"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313143","id":"12313143","description":"Head of 10.3 branch","name":"10.3.3.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314116","id":"12314116","description":"10.5.2 Release July 30 2009 (794445) Now deprecated","name":"10.5.2.0","archived":false,"released":true,"releaseDate":"2009-07-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314117","id":"12314117","description":"Next release after 10.5.2.0 release candidate #1","name":"10.5.3.0","archived":false,"released":true,"releaseDate":"2009-08-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315343","id":"12315343","description":"Derby 10.6.2.1 Release","name":"10.6.2.1","archived":false,"released":true,"releaseDate":"2010-10-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12337592","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12337592","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12499069","key":"DERBY-5059","self":"https://issues.apache.org/jira/rest/api/2/issue/12499069","fields":{"summary":"NPE in StressMultiTest on Solaris on Java 6","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12343744","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12343744","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12525131","key":"DERBY-5435","self":"https://issues.apache.org/jira/rest/api/2/issue/12525131","fields":{"summary":"org.apache.derby.client.am.SqlException in stressMultiTest: The DDM object 0x1232 is not supported.  The connection has been terminated.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12322872","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322872","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12347204","key":"DERBY-1635","self":"https://issues.apache.org/jira/rest/api/2/issue/12347204","fields":{"summary":"stress.multi fails on 10.1/ibm131/jcc2.4","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12349276","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12349276","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"inwardIssue":{"id":"12546430","key":"DERBY-5654","self":"https://issues.apache.org/jira/rest/api/2/issue/12546430","fields":{"summary":"10.5 Backport issue (2012)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-11-15T08:15:18.363+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"I saw the following NPE in stress.multi running on 10.3 with derbyclient.\r\njava.lang.NullPointerException\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.getMetaData(Unknown\r\n Source)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.writeSQLDARD(Unknown Source\r\n)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Sou\r\nrce)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)\r\nCleanup action completed\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35857","summary":"NullPointerException in stress.multi test","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":36,"total":36,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/12661236","id":"12661236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Saw this again on trunk with IBM 1.5  on 1/4/2009 (722718)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-01-06T18:13:03.595+0000","updated":"2009-01-06T18:13:03.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/12661473","id":"12661473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The same stack trace (with line numbers) is mentioned in DERBY-1635.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-07T07:30:10.721+0000","updated":"2009-01-07T07:30:10.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/12726844","id":"12726844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Triaged July 3, 2009:  Assigned normal urgency.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-07-03T09:30:10.798+0000","updated":"2009-07-03T09:30:10.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/12881106","id":"12881106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Changed title to reflect that the issue has been seen on other JVMs than IBM.\r\n\r\nThe error appeared in a tinderbox test run [1] on JVM Sun Microsystems Inc. 1.6.0_18  with the same stack trace as earlier, in the JUnit stress multi test.\r\n\r\n[1] http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/Limited/testSummary-956615.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-06-22T07:03:48.387+0000","updated":"2010-06-22T07:03:48.387+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13116440","id":"13116440","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Seen again in the tinderbox: http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/1176669-org.apache.derbyTesting.functionTests.suites.All_diff.txt\r\n\r\nThe stack trace in the test output is different because it's the client-side trace. The stack trace on the server is the same as the one in the original report (see also the attached derby.log):\r\n\r\njava.lang.NullPointerException\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.getMetaData(Unknown Source)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.writeSQLDARD(Unknown Source)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-09-28T13:17:51.488+0000","updated":"2011-09-28T13:17:51.488+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13116814","id":"13116814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The most likely way we could get NPE in this method is if the variable preparedStatement is null. That only happens if EmbedPreparedStatement was closed prior to calling getMetaData on it, I think.\r\nPreparedStatement#close calls EmbedPreparedStatement#closeActions which nulls out EmbedPreparedStatement#preparedStatement (line 244).\r\nThat variable is first consulted in line 1081:\r\n\r\n//bug 4579 - if the statement is invalid, regenerate the metadata info\r\nif (preparedStatement.isValid() == false)\r\n{\r\n   //need to revalidate the statement here, otherwise getResultDescription would\r\n   //still have info from previous valid statement\r\n   preparedStatement.rePrepare(lcc);\r\n   rMetaData = null;\r\n}\r\n\r\nNo idea yet how this can happen.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-09-28T21:26:39.515+0000","updated":"2011-09-28T21:26:39.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13118914","id":"13118914","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I have managed to reproduce this (the DERBY-5435 variant which is marked as a duplicate of this) four of times in three days. On the server side in all four cases I see the error printed from DRDA_Conn_Thread: \"agentError(\"Why am I getting another SQLException?\")\" when an exception (NPE?) is thrown from the call to writeSQLDARD (line 1026). Now, some instrumentation.. ;-)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-01T21:20:20.355+0000","updated":"2011-10-01T21:20:20.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13119767","id":"13119767","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Here is the NPE with line numbers:\r\n\r\njava.lang.NullPointerException\r\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.getMetaData(EmbedPreparedStatement.java:1095)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.writeSQLDARD(DRDAConnThread.java:6608)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(DRDAConnThread.java:1018)\r\n        at org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:295)\r\n\r\nthis is the line in question in getMetaData:\r\n\r\n  if (gcDuringGetMetaData == null || gcDuringGetMetaData.equals(execp.getActivationClass().getName()) == false)\r\n  {\r\n      rMetaData = null;\r\n      gcDuringGetMetaData = execp.getActivationClass().getName(); // <*******************\r\n      \r\nexecp is just a cast of preparedStatement which has been accessed earlier in the method, e.g. preparedStatement.isValid()\r\nso either it has changed under our feet, or it is its activationClass that's null...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-03T23:45:39.228+0000","updated":"2011-10-03T23:45:39.228+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13119795","id":"13119795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"As for activation class, while preparing a statement, the activation class can be null for a while, cf. code in GenericStatement#prepMinion, ca line 207: and then set again line 502. If the above code tries to access the prepared statement's metadata while the statement is being recompiled (many threads, cached ps), getActivationClass could return null. I am not sure that's what's happening, though, since I can't see why the statement should become invalidated in the test (update of main/main2). \r\n        ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-04T00:28:37.878+0000","updated":"2011-10-04T00:28:37.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13121626","id":"13121626","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I split that line in two and reran till I hit the error again. It was indeed the returned activation class that was null. So, I think we can conclude that this is not thread safe and is a bug in Derby.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-06T00:13:03.106+0000","updated":"2011-10-06T00:13:03.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13121697","id":"13121697","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading a trial patch to EmbedPreparedStatement#getMetaData which changes the logic to detect if a prepared statement has been/is the the process of being recompiled as we are trying to get the metadata. It should avoid the race condition in the existign code where it can happen that we try to get the ps's activation class while it is being recompiled (hence is null temporarily).\r\n\r\nEven if with the patch, we get a consistent picture of the ps's current activation class and result description (my hope), I am not sure I understand how this approach is always correct: We are trying to get metadata for a result set. If the prepared statement has been invalidated (i.e. recompiled), I wonder if the ResultDescription will still necessarily be correct for that result set? Perhaps it will, since if the some change were to occur to the table that would change the column information, presumably, such changes would block on the fact that the result set was still open (?). At least on embedded that seems reasonable assumption. On client/server I think we can possible close the result set as a result of prefetching rows, so I am not sure if this always holds. But maybe the retrieval of the metadata happens before the time the result set is closed.. Can anyone shed light on this?\r\n\r\nIn any case, I will try to run the test for some time with the new patch and see what happens...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-06T03:19:05.902+0000","updated":"2011-10-06T03:19:05.902+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13122324","id":"13122324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"For what it's worth, I haven't seen the error again after I applied the patch, i.e. during the last 30-40 hours running time since yesterday (2 machines) - I'll leave it running for some time before concluding, though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-06T21:38:54.404+0000","updated":"2011-10-06T21:38:54.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13122890","id":"13122890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Another night, no recurrences of the bug. In light of the frequency with which I used to see it, this makes me believe the patch does fix this particular race condition (and hence the test instability). I'll run ordinary regressions before I consider committing it. Please review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-07T15:45:41.772+0000","updated":"2011-10-07T15:45:41.772+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13123247","id":"13123247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Hi Dag, Thanks for working on this jira. I spent some time on it and your patch. I want to first recap my understanding of the issue and then share my thoughts on result set descriptor. Please let me know if my understanding of the jira or your concern about result set descriptor is incorrect\r\n\r\nThe problem seems to be that while getting the metadata by calling EmbedPreparedStatement.getMetaData(),we can run into NPE because activation class assoicated with the prepared statement might be NULL. Activation class is temporarily set to null while the prepared statement is getting recompiled(GenericStatement.prepMinion) and it is possible that during that temporary NULL activation stage, metadata code is trying to use the activation class. \r\n\r\nThe proposed fix is to synchronize part of the logic in EmbedPreparedStatement.getMetaData(). The code that will be synchronized will be in a loop which will repreare the invalid prepared statement and get it's activation class. If the activation class is null, then we will stay in the while loop until we can grab a non-null activation class for the prepared statement. When we get out of the synchronization code, we can rest assured that activation is not null. After that, we pretty much follow the existing logic(with some code rework but the logic stays the same) in EmbedPreparedStatement.getMetaData() \r\n\r\nThe existing code in EmbedPreparedStatement.getMetaData() code is as follows \r\n                                if (preparedStatement.isValid() == false) \r\n                                { \r\n                                        //need to revalidate the statement here, otherwise getResultDescription would \r\n                                        //still have info from previous valid statement \r\n                                        preparedStatement.rePrepare(lcc); \r\n                                        rMetaData = null; \r\n                                } \r\n                                //bug 4579 - gcDuringGetMetaData will be null if this is the first time \r\n                                //getMetaData call is made. \r\n                                //Second check - if the statement was revalidated since last getMetaData call, \r\n                                //then gcDuringGetMetaData wouldn't match with current generated class name \r\n                                if (gcDuringGetMetaData == null || gcDuringGetMetaData.equals(execp.getActivationClass().getName()) == false) \r\n                                { \r\n                                        rMetaData = null; \r\n                                        gcDuringGetMetaData = execp.getActivationClass().getName(); \r\n                                } \r\nThe code above can run into npe in \"gcDuringGetMetaData = execp.getActivationClass().getName();\"  because getActivationClass() can be NULL. \r\n\r\nPart of the new suggested code is as follows \r\n+                synchronized(execp) { \r\n+                    // DERBY-3823 Some other thread may be repreparing \r\n+                    do { \r\n+                        while (!execp.upToDate()) { \r\n+                            execp.rePrepare(lcc); \r\n+                        } \r\n+ \r\n+                        currAc = execp.getActivationClass(); \r\n+                        resd = execp.getResultDescription(); \r\n+                    } while (currAc == null); \r\n+                } \r\n+ \r\n+                if (gcDuringGetMetaData == null) { \r\n+                    gcDuringGetMetaData = currAc.getName(); \r\n+                    rMetaData = null; \r\n+                } else { \r\n+                    if (!gcDuringGetMetaData.equals(currAc.getName())) { \r\n+                        rMetaData = null; \r\n+                        gcDuringGetMetaData = currAc.getName(); \r\n+                    } \r\n+                } \r\n+ \r\nWith the new code, we can be certain that currAC is not null once we are outside the synchronized code and hence we should not run into NPE later when we are accessing currAC\r\n\r\nLater on, EmbedPreparedStatement.getMetaData() gets the resultDescription(existing code to get the resultDescription is as follows ResultDescription resd = preparedStatement.getResultDescription();) and new code from Dag is as follows (resd = execp.getResultDescription();) \r\n\r\nThe concern raised here by Dag is that the resultDescription may not match the newly reprepared statement's result description. I spent some time looking at the supporting code for getResultDescription and I think we might be ok with the result description being in sync with preapred statement. Following is what I found. Let me know if I might have missed something. \r\n\r\ngetResultDescription() call from EmbedPreparedStatement.getMetaData() results into a call to GenericPreparedStatement.getResultDescription() which simply return local variable resultDesc. The resultDesc variable gets set by another method in the same class namely, GenericPreparedStatement.completeCompile. \r\n\r\nThe completeCompile method has following comment \r\n                // get the result description (null for non-cursor statements) \r\n                // would we want to reuse an old resultDesc? \r\n                // or do we need to always replace in case this was select *? \r\n                resultDesc = qt.makeResultDescription(); \r\nIt appears from the comment in completeCompile  above that we don't simply return the existing cached resultDesc(if it is not null). Instead, we actually reload the resultDesc everytime by calling qt.makeResultDescription(). Based on this, I think result description and prepared statement will not get out of sync. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2011-10-07T21:59:16.362+0000","updated":"2011-10-07T21:59:16.362+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13123361","id":"13123361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I am leaning more towards NOT backporting the changes to 10.8. I realize that in our regression tests, we have run into this intermittent NPE in stress test for quite a few releases now but we have not heard of this specific NPE from a user as of yet. \r\n\r\nThe Derby code we are planning to change is traversed heavily and since the suggested code change would not have gone through enough testing, I am hesitant about having it in 10.8 release. In future, if we do come across users who run into this problem, it will be easy to track this jira down since the NPE stack trace is clear about where things are going wrong. At that point, we can consider backporting these changes as needed. Just my 2cents.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2011-10-08T03:29:55.905+0000","updated":"2011-10-08T03:29:55.905+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13123599","id":"13123599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks, Mamta. I agree with you opinion concerning 10.8. Your understanding of my patch is sorrect. As for the correctness of the resultset description my concern was slightly different: I was wondering if the retrieved result set description actually still describes the result set (for which we are retrieving the metadata), if the ps has been invalidated and recompiled (presumably after the result set was generated).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-09T02:33:42.214+0000","updated":"2011-10-09T02:33:42.214+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13124427","id":"13124427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Dag, I wrote a program to see what happens to the resultset's metadata description when it gets changed underneath while a resultset is still open. (I ran this program with the current trunk codeline, ie without Dag;s suggested changes)\r\n\r\nAs you suspected, embedded version throws an error because the resultset is still open but netwrok server goes ahead and allows the metadata change but this change does not get reflected in the resultset's metadata descriptor even after a fresh fetch of resultset's metadata descriptor after the metadata change. \r\n\r\nTo run in the embedded mode, run the program with no parameters or with '1'. To run it in network server mode, have the network server running and then run the program with any value other than '1' for the parameter. eg\r\nembedded mode\r\njava DERBY3824StressTestNPE 1\r\nor\r\njava DERBY3824StressTestNPE\r\nFor Network server mode\r\njava DERBY3824StressTestNPE 0\r\n\r\n\r\nThe test results for embedded mode looks as follows\r\n*************\r\nDone loading data\r\nchar column length is 5\r\nshould get error for inserting too large of a data\r\nError is A truncation error was encountered trying to shrink VARCHAR '12345678'to length 5.\r\nException in thread \"main\" java.sql.SQLException: Operation 'ALTER TABLE' cannot be performed on object 'T1' because there is an open ResultSet dependent on tha\r\nt object.\r\n*************\r\n\r\n\r\nThe test results for network server mode looks as follows\r\n*************\r\nDone loading data\r\nchar column length is 5\r\nshould get error for inserting too large of a data\r\nError is A truncation error was encountered trying to shrink VARCHAR '12345678'to length 5.\r\nchar column length after alter table is 5\r\nwas able to insert large data\r\n*************\r\n\r\n\r\nFollowing is the program. \r\nimport java.sql.*;\r\n\r\npublic class DERBY3824StressTestNPE extends Thread {\r\n    public static void main(String[] args) throws Exception {\r\n\t\t\r\n\t\tConnection conn = null;\r\n\t\tif (args.length == 1) {\r\n\t\t\tint embedded = Integer.parseInt(args[0]);\r\n\t\t\tif (embedded == 1) {\r\n\t\t        Class.forName(\"org.apache.derby.jdbc.EmbeddedDriver\");\r\n\t\t        conn =  DriverManager.getConnection(\r\n                \"jdbc:derby:DERBY4437DB;create=true\");\r\n\t\t\t} else {\r\n\t\t        Class.forName(\"org.apache.derby.jdbc.ClientDriver\"); \r\n\t\t        String url = \"jdbc:derby://localhost:1527/DERBY4437DB;create=true\";\r\n\t\t        conn = DriverManager.getConnection(url);\r\n\t\t\t}\r\n\t    } else {\r\n\t        Class.forName(\"org.apache.derby.jdbc.EmbeddedDriver\");\r\n\t        conn =  DriverManager.getConnection(\r\n            \"jdbc:derby:DERBY4437DB;create=true\");\r\n\t    }\r\n        \r\n        conn.setAutoCommit(false);\r\n        Statement st  = conn.createStatement();\r\n        st.executeUpdate(\"create table t1(c11 int, \"+\r\n        \t\t\"c12 varchar(5))\");\r\n        PreparedStatement ps = \r\n\t        conn.prepareStatement(\"insert into t1 values(?,'aaaaa')\");\r\n\t\tfor (int i = 0; i < 1000; i++) {\r\n\t\t\tps.setInt(1, i);\r\n\t        ps.executeUpdate();\r\n\t\t}\r\n        System.out.println(\"Done loading data\");\r\n        conn.commit();\r\n\r\n        ResultSet rs = st.executeQuery(\"select * from t1\");\r\n\t\tfor (int i = 0; i < 100; i++) {\r\n\t\t\trs.next();\r\n\t\t}\r\n\t\tResultSetMetaData rsmd = rs.getMetaData();\r\n\t\tint charLength = rsmd.getColumnDisplaySize(2);\r\n\t\tSystem.out.println(\"char column length is \" + charLength);\r\n        Statement st2  = conn.createStatement();\r\n        try {\r\n\t\tst2.executeUpdate(\"insert into t1 values(99,'12345678')\");\r\n        } catch(Exception ex) {\r\n        \tSystem.out.println(\"should get error for inserting too large of a data\");\r\n        \tSystem.out.println(\"Error is \" + ex.getMessage());\r\n        }\r\n\r\n\t\tst2.execute(\"alter table t1 alter column c12 set data type varchar(8)\");\r\n\t\trsmd = rs.getMetaData();\r\n\t\tcharLength = rsmd.getColumnDisplaySize(2);\r\n\t\tSystem.out.println(\"char column length after alter table is \" + charLength);\r\n\t\tst2.executeUpdate(\"insert into t1 values(99,'12345678')\");\r\n\t\tSystem.out.println(\"was able to insert large data\");\r\n    }\r\n}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2011-10-10T19:51:33.089+0000","updated":"2011-10-10T19:51:33.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13124579","id":"13124579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I applied Dag's changes to trunk and saw the same behavior from my test program, ie embedded gave an error for metadata change while the resultset is still open but network server allowed the metadata change but didn't reflect those changes in resultset's metadada descriptor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2011-10-10T23:39:20.196+0000","updated":"2011-10-11T00:33:26.820+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13124666","id":"13124666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I am thinking if we should create a new jira for resultset meta data getting out of sync with the underlying system metadata in case of network server. \r\n\r\nWe already have 2 jiras, DERBY-3839(Convert \"org.apache.derbyTesting.functionTests.tests.store.holdCursorJDBC30.sql\" to junit. ) and DERBY-4373 (different results with network server vs. embedded on select from a temporary table with resultset cursor hold over commit) in which we see difference in behavior between client-server and embedded mode with how resultsets are handled because of server pre-fetching of the rows. I think in our specific case, we do want the resultset metadata to correctly reflect the metadata assoicated with underlying columns. Dag, do you think we should create a new jira for this mismatch of metadata and associate the new jira with the other 2 jiras related to resulset behavior?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2011-10-11T03:54:19.134+0000","updated":"2011-10-11T03:54:19.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13126252","id":"13126252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for helping me understand this, Mamta! From you test program it appears that the metadata returned even in the client case is still correct (i.e. c12's size is still 5) . Since that's the result set we are processing (still), I think that is correct even though the underlying table now has length 8. I was worried we might somehow be able to retrieve the new values, 8, while still reading the \"old\" style result set on the client. Isn't metadata cached on the client also? If so the second call to \"rsmd = rs.getMetaData();\" may not even visit the server, unless you trace it to determine that it did.. I will try to tweak your program and debug to see if I can provoke it to return \"8\" while we are still reading the result set that has 5 as max lenght for c12... If that were possible it would be an error, I think. That fact that we are able to *insert* longer data than 5 is not wrong, since the underlying database has changed. I believe *database* metadata would correctly reflect that? But the *result set* metadata should stick to the actual data in the (old) result set I believe.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-12T23:48:36.361+0000","updated":"2011-10-12T23:48:36.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13126287","id":"13126287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Fiddling with your program I think the actual result set's getMetaData\r\nis is correct (ResultSet#getMetaData) in the case I was worried about,\r\nit appears it is read early on while processing the rs. (Sorry, I was\r\na bit mixed up here).\r\n\r\nBut your concern is *also* correct :) I changed the program to use an\r\n*explicit* prepared statement (since the method for which we made the\r\npatch is PreparedStatement#getMetaData) to retrieve metadata from\r\nthere, *as well as* getting the metadata from the actual result set.\r\n\r\nThe PreparedStatement's getMetaData method is described in this way in\r\nthe Javadoc:\r\n\r\n   \"getMetaData() Retrieves a ResultSetMetaData object\r\n    that contains information about the columns of the ResultSet\r\n    object that *will be* returned when this PreparedStatement object\r\n    is executed.\" (\"will be\": my emphasis, not \"just was\".. ;-)\r\n\r\nhere is my run result (incl some trace from EmbedPreparedStatement#getMetaData)\r\n\r\nClient/server:\r\n\r\n$ java -cp .:$CLASSPATH DERBY3823StressTestNPE 2 \r\nexecp.getResultDescription: insert into t1 values(?,'aaaaa')\r\nexecp.getResultDescription: insert into t1 values(?,'aaaaa')\r\nDone loading data\r\nexecp.getResultDescription: select * from t1\r\nexecp.getResultDescription: select * from t1\r\nexecuting alter\r\n2. PS#getMetaData: char column length is 5\r\nReexecuting ps on changed table...\r\n3. RS#getMetadata: char column length is 5\r\ndata:1 12345678\r\n\r\nAs we can see we are getting a value 8 long, but both ps's metadata\r\nand rs's metadata are both out of date. Note that there is no new call\r\nto execp.getResultDescription *after* we alter the table...\r\n\r\nOn embedded it is correct:\r\n\r\n$ java -cp .:$CLASSPATH DERBY3823StressTestNPE\r\nDone loading data\r\nexecuting alter\r\nexecp.getResultDescription: select * from t1\r\n2. PS#getMetaData: char column length is 8\r\nReexecuting ps on changed table...\r\n3. RS#getMetadata: char column length is 8\r\ndata:1 12345678\r\n\r\nAs you observed, it should return 8. Maybe because it's cached on the\r\nclient side, but should have been invalidated. This looks like a bug\r\nto me.\r\n\r\nIn any case, I think the patch improves the situation in that we now\r\nwill wait if the underlying prepared statement is being re-prepared. I\r\nthink we should file a new bug for this and relate it to the two you\r\nmentioned. I can do it if you like. The current patch as least assures we get a consistent\r\n\"snapshot\" at the time metadata is attempted retrieved.\r\n\r\n\r\n---------------------------------------------------\r\nimport java.sql.*;\r\n\r\npublic class DERBY3823StressTestNPE extends Thread {\r\n    public static void main(String[] args) throws Exception {\r\n\r\n        Connection conn = null;\r\n        if (args.length == 1) {\r\n            int embedded = Integer.parseInt(args[0]);\r\n            if (embedded == 1) {\r\n                Class.forName(\"org.apache.derby.jdbc.EmbeddedDriver\");\r\n                conn = DriverManager.getConnection(\r\n                    \"jdbc:derby:DERBY3823DB;create=true\");\r\n            } else {\r\n                Class.forName(\"org.apache.derby.jdbc.ClientDriver\");\r\n                String url = \"jdbc:derby://localhost:1527/DERBY3823DB;create=true\";\r\n                conn = DriverManager.getConnection(url);\r\n            }\r\n        } else {\r\n            Class.forName(\"org.apache.derby.jdbc.EmbeddedDriver\");\r\n            conn = DriverManager.getConnection(\r\n                \"jdbc:derby:DERBY3823DB;create=true\");\r\n        }\r\n        \r\n        conn.setAutoCommit(false);\r\n        Statement st = conn.createStatement();\r\n        st.executeUpdate(\"create table t1(c11 int, \"+\r\n                         \"c12 varchar(5))\");\r\n        {\r\n            PreparedStatement ps =\r\n                conn.prepareStatement(\"insert into t1 values(?,'aaaaa')\");\r\n            for (int i = 0; i < 1000; i++) {\r\n                ps.setInt(1, i);\r\n                ps.executeUpdate();\r\n            }\r\n        }\r\n        System.out.println(\"Done loading data\");\r\n        conn.commit();\r\n\r\n        PreparedStatement ps = conn.prepareStatement(\"select * from t1\");\r\n        ResultSet rs = ps.executeQuery();\r\n\r\n        for (int i = 0; i < 990; i++) {\r\n            rs.next();\r\n        }\r\n        rs.close();\r\n\r\n        Statement st2 = conn.createStatement();\r\n        System.err.println(\"executing \" + \"alter\");\r\n        st2.execute(\"alter table t1 alter column c12 set data type varchar(8)\");\r\n        st2.execute(\"delete from t1\");\r\n        st2.execute(\"insert into t1 values (1, '12345678')\");\r\n        \r\n        {\r\n\r\n            // Ps' javadoc: getMetaData() Retrieves a ResultSetMetaData object\r\n            // that contains information about the columns of the ResultSet\r\n            // object that *will be* returned when this PreparedStatement object\r\n            // is executed. (my emphasis)\r\n\r\n            ResultSetMetaData rsmd = ps.getMetaData();\r\n            int charLength = rsmd.getColumnDisplaySize(2);\r\n            System.out.println(\"2. PS#getMetaData: char column length is \" + charLength);\r\n            System.out.println(\"Reexecuting ps on changed table...\");\r\n            rs = ps.executeQuery();\r\n            ResultSetMetaData rsmd2 = rs.getMetaData();\r\n            charLength = rsmd2.getColumnDisplaySize(2);\r\n            System.out.println(\"3. RS#getMetadata: char column length is \" + charLength);\r\n            while (rs.next()) {\r\n                System.out.println(\"data:\" + rs.getString(1) + \" \" + rs.getString(2));\r\n            }\r\n            rs.close();\r\n        }\r\n    }\r\n}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-13T01:23:29.336+0000","updated":"2011-10-13T01:23:29.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13126289","id":"13126289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Btw, regressions ran ok with the patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-13T01:25:35.422+0000","updated":"2011-10-13T01:25:35.422+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13126338","id":"13126338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Mamta, I filed DERBY-5459 for the out-of-date metadata issue on client. If you are otherwise OK with the patch, I'll commit it soon.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-13T04:29:53.021+0000","updated":"2011-10-13T04:29:53.021+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13126352","id":"13126352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Earlier today, I added(in trunk) a test case to AlterTableTest showing that in case of a network server, an open resulset's metadata can get changed underneath it but it is not reflected in the metadata.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2011-10-13T05:27:16.182+0000","updated":"2011-10-13T05:27:16.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13126354","id":"13126354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Dag, I think we should go ahead and commit your patch into trunk. The metadata stuff can be handled under DERBY-5459.Thanks for filing that jira","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2011-10-13T05:31:40.842+0000","updated":"2011-10-13T05:31:40.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13127222","id":"13127222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed patch as svn 1183192, resolving. As we have discussed, it would probably not be wise to back-port at this point.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-14T01:36:01.327+0000","updated":"2011-10-14T01:36:01.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13127230","id":"13127230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Marking \"affects version\" back to the first seen by Kathey: 10.3.3.1, but it's probably even older.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-10-14T01:49:46.139+0000","updated":"2011-10-14T01:49:46.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13202620","id":"13202620","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I am wondering if the consensus is still that we should not backport this fix to 10.8?  It has run successfully for some time now in trunk.  The fix looks localized to me.  I understand that it does not fix everything, but seems to be better than no fix.  What is the risk of the fix?\r\n\r\nFor some reason we seem to be seeing the stressmulti error quite a lot in 10.8 nightly runs, tracked under \r\nDERBY-5435","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-02-07T18:49:23.650+0000","updated":"2012-02-07T18:49:23.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13202766","id":"13202766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I'm OK with it now I think.  Mamta had concerns that this (new) code path isn't exercised often enough for us to trust it an update release yet.That is a valid concern of course. The related DERBY-5459 could also be backported I think.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-02-07T20:51:50.076+0000","updated":"2012-02-07T20:51:50.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13203049","id":"13203049","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"We have the fix for this jira in for a long time now so I feel comfortable backporting it to 10.8. My worry was that we were touching a highly traversed code but the fix approach sounds correct so it will be ok to backport this fix. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2012-02-08T00:47:46.106+0000","updated":"2012-02-08T00:47:46.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13203120","id":"13203120","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"i am temporarily assigning this to myself and plan on backporting it to 10.8.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-02-08T01:42:42.059+0000","updated":"2012-02-08T01:42:42.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13203772","id":"13203772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"back ported fix from trunk to 10.8 and setting original owner back.  Change can be backported farther if necessary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-02-08T17:47:33.679+0000","updated":"2012-02-08T17:47:33.679+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13229391","id":"13229391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Reopen for 10.5 backport consideration. If working on the backport for this issue. Temporarily assign yourself and add a comment that you are working on it. When finished, reresolve with the new fix versions or label backport_reject_10_x as appropriate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-03-14T17:19:50.114+0000","updated":"2012-03-14T17:19:50.114+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13231772","id":"13231772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"temp assign to mikem for backport.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-03-17T00:52:55.865+0000","updated":"2012-03-17T00:52:55.865+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13233966","id":"13233966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"backported to 10.5, 10.6 and 10.7.  resetting to original owner.  Don't plan on backporting to any other branches now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2012-03-21T00:07:12.893+0000","updated":"2012-03-21T00:07:12.893+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12401743/comment/13823456","id":"13823456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update: close all resolved issues that haven't had any activity the last year]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-15T08:15:18.361+0000","updated":"2013-11-15T08:15:18.361+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3823/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06i1j:"}}