{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12551315","self":"https://issues.apache.org/jira/rest/api/latest/issue/12551315","key":"SOLR-3369","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324324","id":"12324324","description":"Major release after 4.3","name":"4.4","archived":false,"released":true,"releaseDate":"2013-07-23"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-04-18 21:10:38.115","customfield_12312323":null,"customfield_12310420":"236179","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_38079439270_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-07-02T16:15:20.714+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-3369/watchers","watchCount":12,"isWatching":false},"created":"2012-04-17T22:38:01.458+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314992","id":"12314992","description":"Alpha release of 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"issuelinks":[{"id":"12350709","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12350709","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12542632","key":"SOLR-3134","self":"https://issues.apache.org/jira/rest/api/2/issue/12542632","fields":{"summary":"Include shard Information in response","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-23T18:38:52.071+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310674","id":"12310674","name":"search","description":"Query the search collection"}],"timeoriginalestimate":null,"description":"In a distributed environment, shards.tolerant=true allows for partial results to be returned when individual shards are down.  For group=true and facet=true queries, using this feature results in an error when shards are down.  This patch allows users to use the shard tolerance feature with facet and grouping queries. ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"13328","summary":"shards.tolerant=true broken on group queries","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Distributed environment (shards)","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":18,"total":18,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13256963","id":"13256963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=martijn.v.groningen","name":"martijn.v.groningen","emailAddress":"martijn dot v dot groningen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=martijn.v.groningen&avatarId=15048","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=martijn.v.groningen&avatarId=15048","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=martijn.v.groningen&avatarId=15048","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=martijn.v.groningen&avatarId=15048"},"displayName":"Martijn van Groningen","active":true},"body":"I took a quick look. Patch also seems to add support for adding shards.info parameter for grouping and adds exception information to the response when a shard request fails.\r\n\r\nI don't that think that shards.tolerant is a supported feature in Solr 3.x versions (I couldn't find any reference of this param in the 3.6 source). So I think we shouldn't add this to the 3.6 branch since that would be adding a new feature to a Solr version that is actually in maintenance mode.\r\n\r\n  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=martijn.v.groningen","name":"martijn.v.groningen","emailAddress":"martijn dot v dot groningen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=martijn.v.groningen&avatarId=15048","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=martijn.v.groningen&avatarId=15048","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=martijn.v.groningen&avatarId=15048","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=martijn.v.groningen&avatarId=15048"},"displayName":"Martijn van Groningen","active":true},"created":"2012-04-18T21:10:38.115+0000","updated":"2012-04-18T21:10:38.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13257057","id":"13257057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"body":"Martijn,\r\n\r\nYou're right, 3.6 doesn't have this feature.  My mistake.  Just use the trunk patch if you wish.  \r\n\r\nThe reason I had a 3.6 version of this patch is that we have backported SOLR-3134 (original shards info/tolerance feature) to 3.6.  SOLR-3369-shards-tolerant-3_6.patch is intended to be applied on top of that, and is of no use without it.  I just posted our SOLR-3134 backport patch if you have an interest in adding shards.info and shards.tolerant to 3.x.  If not, at least the patch will be available for other 3.x users who want that feature.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"created":"2012-04-18T22:57:07.137+0000","updated":"2012-04-18T22:57:07.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13258329","id":"13258329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"body":"removed 3.6 from affected versions","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"created":"2012-04-20T15:47:38.702+0000","updated":"2012-04-20T15:47:38.702+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13540622","id":"13540622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"body":"The patch in SOLR-3557 contained some overlap with the patch on this ticket.  I am updating the patch on this ticket accordingly.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"created":"2012-12-28T22:48:22.695+0000","updated":"2012-12-28T22:48:22.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13603244","id":"13603244","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ferrylandzaat","name":"ferrylandzaat","emailAddress":"flandzaat at elmar dot nl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ferry Landzaat","active":true},"body":"Is there any plan to fix this issue? We want to upgrade from 3.x and really need this patch to make the system reliable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ferrylandzaat","name":"ferrylandzaat","emailAddress":"flandzaat at elmar dot nl","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ferry Landzaat","active":true},"created":"2013-03-15T09:07:58.685+0000","updated":"2013-03-15T09:07:58.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13650755","id":"13650755","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aboiscrettez","name":"aboiscrettez","emailAddress":"andre dot bois at kelkoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"André Bois-Crettez","active":true},"body":"Same here, with Solr 4.2.1 it is still not possible to do queries with both shards.tolerant=true and grouping.\r\n\r\nIs there anything wrong with the patch itself ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aboiscrettez","name":"aboiscrettez","emailAddress":"andre dot bois at kelkoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"André Bois-Crettez","active":true},"created":"2013-05-07T12:16:23.111+0000","updated":"2013-05-07T12:16:23.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13650759","id":"13650759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"If someone adds a test to exercise this patch, I'll commit it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2013-05-07T12:23:46.009+0000","updated":"2013-05-07T12:23:46.009+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13658443","id":"13658443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djice","name":"djice","emailAddress":"jcjabouille at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jabouille jean Charles","active":true},"body":"Hi,\r\n\r\nhere is a test, you just have to copy it in solr/core/src/test/org/apache/solr/:\r\n\r\n{code:title=TestDistributedGroupingWithShardTolerantActivated.java|borderStyle=solid}\r\npackage org.apache.solr;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\n\r\nimport org.apache.lucene.util.LuceneTestCase.Slow;\r\nimport org.apache.solr.client.solrj.SolrServer;\r\nimport org.apache.solr.client.solrj.SolrServerException;\r\nimport org.apache.solr.client.solrj.embedded.JettySolrRunner;\r\nimport org.apache.solr.cloud.ChaosMonkey;\r\nimport org.apache.solr.common.params.CommonParams;\r\nimport org.apache.solr.common.params.ModifiableSolrParams;\r\nimport org.apache.solr.common.params.ShardParams;\r\n\r\n\r\n@Slow\r\npublic class TestDistributedGroupingWithShardTolerantActivated extends BaseDistributedSearchTestCase {\r\n\r\n  String t1=\"a_t\";\r\n  String i1=\"a_si\";\r\n  String s1=\"a_s\";\r\n  String tlong = \"other_tl1\";\r\n  String tdate_a = \"a_n_tdt\";\r\n  String tdate_b = \"b_n_tdt\";\r\n  String oddField=\"oddField_s\";\r\n\r\n  @Override\r\n  public void doTest() throws Exception {\r\n    del(\"*:*\");\r\n    commit();\r\n\r\n    handle.clear();\r\n    handle.put(\"QTime\", SKIPVAL);\r\n    handle.put(\"timestamp\", SKIPVAL);\r\n    handle.put(\"grouped\", UNORDERED);   // distrib grouping doesn't guarantee order of top level group commands\r\n\r\n    indexr(id,1, i1, 100, tlong, 100,t1,\"now is the time for all good men\",\r\n           tdate_a, \"2010-04-20T11:00:00Z\",\r\n           tdate_b, \"2009-08-20T11:00:00Z\",\r\n           \"foo_f\", 1.414f, \"foo_b\", \"true\", \"foo_d\", 1.414d);\r\n    indexr(id,2, i1, 50 , tlong, 50,t1,\"to come to the aid of their country.\",\r\n           tdate_a, \"2010-05-02T11:00:00Z\",\r\n           tdate_b, \"2009-11-02T11:00:00Z\");\r\n    indexr(id,3, i1, 2, tlong, 2,t1,\"how now brown cow\",\r\n           tdate_a, \"2010-05-03T11:00:00Z\");\r\n    indexr(id,4, i1, -100 ,tlong, 101,\r\n           t1,\"the quick fox jumped over the lazy dog\",\r\n           tdate_a, \"2010-05-03T11:00:00Z\",\r\n           tdate_b, \"2010-05-03T11:00:00Z\");\r\n    indexr(id,5, i1, 500, tlong, 500 ,\r\n           t1,\"the quick fox jumped way over the lazy dog\",\r\n           tdate_a, \"2010-05-05T11:00:00Z\");\r\n    indexr(id,6, i1, -600, tlong, 600 ,t1,\"humpty dumpy sat on a wall\");\r\n    indexr(id,7, i1, 123, tlong, 123 ,t1,\"humpty dumpy had a great fall\");\r\n    indexr(id,8, i1, 876, tlong, 876,\r\n           tdate_b, \"2010-01-05T11:00:00Z\",\r\n           t1,\"all the kings horses and all the kings men\");\r\n    indexr(id,9, i1, 7, tlong, 7,t1,\"couldn't put humpty together again\");\r\n    indexr(id,10, i1, 4321, tlong, 4321,t1,\"this too shall pass\");\r\n    indexr(id,11, i1, -987, tlong, 987,\r\n           t1,\"An eye for eye only ends up making the whole world blind.\");\r\n    indexr(id,12, i1, 379, tlong, 379,\r\n           t1,\"Great works are performed, not by strength, but by perseverance.\");\r\n\r\n    indexr(id, 14, \"SubjectTerms_mfacet\", new String[]  {\"mathematical models\", \"mathematical analysis\"});\r\n    indexr(id, 15, \"SubjectTerms_mfacet\", new String[]  {\"test 1\", \"test 2\", \"test3\"});\r\n    indexr(id, 16, \"SubjectTerms_mfacet\", new String[]  {\"test 1\", \"test 2\", \"test3\"});\r\n    String[] vals = new String[100];\r\n    for (int i=0; i<100; i++) {\r\n      vals[i] = \"test \" + i;\r\n    }\r\n    indexr(id, 17, \"SubjectTerms_mfacet\", vals);\r\n\r\n    indexr(\r\n        id, 18, i1, 232, tlong, 332,\r\n        t1,\"no eggs on wall, lesson learned\",\r\n        oddField, \"odd man out\"\r\n    );\r\n    indexr(\r\n        id, 19, i1, 232, tlong, 432,\r\n        t1, \"many eggs on wall\",\r\n        oddField, \"odd man in\"\r\n    );\r\n    indexr(\r\n        id, 20, i1, 232, tlong, 532,\r\n        t1, \"some eggs on wall\",\r\n        oddField, \"odd man between\"\r\n    );\r\n    indexr(\r\n        id, 21, i1, 232, tlong, 632,\r\n        t1, \"a few eggs on wall\",\r\n        oddField, \"odd man under\"\r\n    );\r\n    indexr(\r\n        id, 22, i1, 232, tlong, 732,\r\n        t1, \"any eggs on wall\",\r\n        oddField, \"odd man above\"\r\n    );\r\n    indexr(\r\n        id, 23, i1, 233, tlong, 734,\r\n        t1, \"dirty eggs\",\r\n        oddField, \"odd eggs\"\r\n    );\r\n\r\n    for (int i = 100; i < 150; i++) {\r\n      indexr(id, i);\r\n    }\r\n\r\n    int[] values = new int[]{9999, 99999, 999999, 9999999};\r\n    for (int shard = 0; shard < clients.size(); shard++) {\r\n      int groupValue = values[shard];\r\n      for (int i = 500; i < 600; i++) {\r\n        index_specific(shard, i1, groupValue, s1, \"a\", id, i * (shard + 1), t1, shard);\r\n      }\r\n    }\r\n\r\n    commit();\r\n    \r\n    // SOLR-3369: shrds.tolreant=true with grouping\r\n    for (int numDownServers = 0; numDownServers < jettys.size() - 1; numDownServers++) {\r\n      List<JettySolrRunner> upJettys = new ArrayList<JettySolrRunner>(jettys);\r\n      List<SolrServer> upClients = new ArrayList<SolrServer>(clients);\r\n      List<JettySolrRunner> downJettys = new ArrayList<JettySolrRunner>();\r\n      List<String> upShards = new ArrayList<String>(Arrays.asList(shardsArr));\r\n      for (int i = 0; i < numDownServers; i++) {\r\n        // shut down some of the jettys\r\n        int indexToRemove = r.nextInt(upJettys.size());\r\n        JettySolrRunner downJetty = upJettys.remove(indexToRemove);\r\n        upClients.remove(indexToRemove);\r\n        upShards.remove(indexToRemove);\r\n        ChaosMonkey.stop(downJetty);\r\n        downJettys.add(downJetty);\r\n      }\r\n\r\n      simpleQuery(\"q\", \"*:*\", \"rows\", 100, \"fl\",\r\n          \"id,\" + i1, \"group\", \"true\", \"group.query\", t1 + \":kings OR \" + t1\r\n              + \":eggs\", \"group.limit\", 10, \"sort\", i1 + \" asc, id asc\",\r\n          CommonParams.TIME_ALLOWED, 1, ShardParams.SHARDS_INFO, \"true\",\r\n          ShardParams.SHARDS_TOLERANT, \"true\");\r\n      \r\n      // restart the jettys\r\n      for (JettySolrRunner downJetty : downJettys) {\r\n        downJetty.start();\r\n      }\r\n    }\r\n  }\r\n\r\n  private void simpleQuery(Object... queryParams) throws SolrServerException {\r\n    ModifiableSolrParams params = new ModifiableSolrParams();\r\n    for (int i = 0; i < queryParams.length; i += 2) {\r\n      params.add(queryParams[i].toString(), queryParams[i + 1].toString());\r\n    }\r\n    params.set(\"shards\", shards);\r\n    queryServer(params);\r\n  }\r\n\r\n}\r\n{code}\r\n\r\nYour patch works perfectly in \"select\" mode. In \"browse\" mode there in a other exception:\r\n{noformat}\r\nERROR org.apache.solr.core.SolrCore:log:85  - java.lang.NullPointerException\r\n    at org.apache.solr.handler.component.SpellCheckComponent.finishStage(SpellCheckComponent.java:297)\r\n    at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:317)\r\n{noformat}\r\n\r\nThank you very much for this patch, *we hope it will be in the next release of solr*.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djice","name":"djice","emailAddress":"jcjabouille at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jabouille jean Charles","active":true},"created":"2013-05-15T15:19:20.668+0000","updated":"2013-05-15T15:19:20.668+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13658664","id":"13658664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"body":"This test case fails sometimes because it occasionally tries to use one of the \"down\" servers as the collator.  I'll fix this and include it in a new patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"created":"2013-05-15T18:53:27.644+0000","updated":"2013-05-15T18:53:38.656+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13659018","id":"13659018","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"body":"As requested, I added a test case to the patch file.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"created":"2013-05-15T23:31:30.649+0000","updated":"2013-05-15T23:33:01.266+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13659021","id":"13659021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"latest patch adds:\r\n{code}\r\n+      // test group query\r\n+      queryPartialResults(upShards, upClients, \r\n+          \"q\", \"*:*\", \r\n+          \"rows\", 100, \r\n+          \"fl\", \"id,\" + i1, \r\n+          \"group\", \"true\", \r\n+          \"group.query\", t1 + \":kings OR \" + t1 + \":eggs\", \r\n+          \"group.limit\", 10, \r\n+          \"sort\", i1 + \" asc, id asc\",\r\n+          CommonParams.TIME_ALLOWED, 1, \r\n+          ShardParams.SHARDS_INFO, \"true\",\r\n+          ShardParams.SHARDS_TOLERANT, \"true\");\r\n{code}\r\n\r\n\r\nbut does not include TestDistributedGroupingWithShardTolerantActivated.java\r\n\r\nIs this intentional?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2013-05-15T23:35:02.227+0000","updated":"2013-05-15T23:35:02.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13659030","id":"13659030","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"body":"Yes, this is intentional.  TestDistributedGroupingWithShardTolerantActivated.java duplicated much of what was in TestDistributedSearch.java.  TestDistributedSearch.java already has the framework in place for dealing with partial results.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"created":"2013-05-15T23:39:35.838+0000","updated":"2013-05-15T23:39:35.838+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13673482","id":"13673482","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"body":"Ryan, is there anything preventing this patch from committing?  Was the test case satisfactory?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rblack","name":"rblack","emailAddress":"black dot russell at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Russell Black","active":true},"created":"2013-06-03T19:43:41.830+0000","updated":"2013-06-03T19:43:41.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13691975","id":"13691975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"body":"This patch looks alright on first pass. There's something wrong with the solrcloud tests in trunk right now (unrelated to the patch). I'll wait for it to be fixed and then commit once I get a clean pass on all tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"created":"2013-06-24T13:56:02.024+0000","updated":"2013-06-24T13:56:02.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13697919","id":"13697919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1498992 from shalin@apache.org\r\n[ https://svn.apache.org/r1498992 ]\r\n\r\nSOLR-3369: shards.tolerant=true is broken for group queries","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-02T16:10:17.404+0000","updated":"2013-07-02T16:10:17.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13697922","id":"13697922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1498993 from shalin@apache.org\r\n[ https://svn.apache.org/r1498993 ]\r\n\r\nSOLR-3369: shards.tolerant=true is broken for group queries","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-02T16:12:58.842+0000","updated":"2013-07-02T16:12:58.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13697927","id":"13697927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"body":"shards.tolerant already works for facet queries so this issue is only about group queries.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"created":"2013-07-02T16:15:08.740+0000","updated":"2013-07-02T16:15:08.740+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12551315/comment/13716882","id":"13716882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"body":"Bulk close resolved 4.4 issues","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"created":"2013-07-23T18:38:52.068+0000","updated":"2013-07-23T18:38:52.068+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-3369/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i02n07:"}}