{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12500665","self":"https://issues.apache.org/jira/rest/api/latest/issue/12500665","key":"CASSANDRA-2282","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316241","id":"12316241","description":"","name":"0.7.4","archived":false,"released":true,"releaseDate":"2011-03-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-03-08 04:26:35.857","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"1_*:*_1_*:*_156276997_*|*_5_*:*_1_*:*_0","customfield_12310420":"20538","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-03-09T14:58:39.772+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-2282/watchers","watchCount":5,"isWatching":false},"created":"2011-03-07T19:34:02.789+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thobbs","name":"thobbs","emailAddress":"tyler at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thobbs&avatarId=17039","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thobbs&avatarId=17039","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thobbs&avatarId=17039","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thobbs&avatarId=17039"},"displayName":"Tyler Hobbs","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-04-28T16:21:09.682+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"In a three node cluster with RF=2, when trying to page through all rows with get_range_slices() at CL.ONE, I get timeouts on the client side.  Looking at the Cassandra logs, all of the nodes show the following AssertionError repeatedly:\r\n\r\n{noformat}\r\nERROR [RequestResponseStage:2] 2011-03-07 19:10:27,527 DebuggableThreadPoolExecutor.java (line 103) Error in ThreadPoolExecutor\r\njava.lang.AssertionError\r\n        at org.apache.cassandra.service.ReadCallback.response(ReadCallback.java:127)\r\n        at org.apache.cassandra.net.ResponseVerbHandler.doVerb(ResponseVerbHandler.java:49)\r\n        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:72)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n        at java.lang.Thread.run(Thread.java:636)\r\nERROR [RequestResponseStage:2] 2011-03-07 19:10:27,529 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread[RequestResponseStage:2,5,main]\r\njava.lang.AssertionError\r\n        at org.apache.cassandra.service.ReadCallback.response(ReadCallback.java:127)\r\n        at org.apache.cassandra.net.ResponseVerbHandler.doVerb(ResponseVerbHandler.java:49)\r\n        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:72)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n        at java.lang.Thread.run(Thread.java:636)\r\n{noformat}\r\n\r\nThe nodes are all running 0.7.3.  The cluster was at size 3 before any data was inserted, and everything else appears perfectly healthy.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12472984","id":"12472984","filename":"2282.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-08T16:34:05.895+0000","size":2654,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12472984/2282.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12473017","id":"12473017","filename":"2282-v2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-08T18:02:31.983+0000","size":3113,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12473017/2282-v2.txt"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"93123","summary":"ReadCallback AssertionError: resolver.getMessageCount() <= endpoints.size()","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thobbs","name":"thobbs","emailAddress":"tyler at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thobbs&avatarId=17039","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thobbs&avatarId=17039","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thobbs&avatarId=17039","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thobbs&avatarId=17039"},"displayName":"Tyler Hobbs","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thobbs","name":"thobbs","emailAddress":"tyler at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thobbs&avatarId=17039","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thobbs&avatarId=17039","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thobbs&avatarId=17039","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thobbs&avatarId=17039"},"displayName":"Tyler Hobbs","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":17,"total":17,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13003804","id":"13003804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"body":"In our case, the same AssertionError occurs on multi node cluster with replication factor = 3 (0.7.3 release version).\r\nFeeding data into cassandra looks ok (consistency level = QUORUM). Though, UnavailableException was received via hector 0.7.0-28 several times. It warns about number of replica (see the following stack trace). It might relate to this problem. But not sure. \r\n\r\nWhen querying data, AssertionError occurs in cassandra and client gets timedout exception.\r\nOur client queries in several query types in different column families. This timeout occurs quite often in secondary index query.\r\nThe error is only logged on the host which client connects via thrift (according to timestamp in log).\r\n\r\nAnother experience is when I tried to retrieve data via CLI.\r\nQuery like \"list Standard1 limit 10\" returns results normally. But the cassandra logs the AssertionError on the host. Other node doesn't have the log.\r\n(When query returns \"null\" (I guess there is not enough replica), this exception is very likely to be logged.)\r\n\r\n-------------------\r\n* Unavailable exception stack trace received via hector 0.7.0-28 when feeding data into cassandra:\r\n\r\nme.prettyprint.hector.api.exceptions.HUnavailableException: : May not be enough replicas present to handle consistency level.\r\n        at me.prettyprint.cassandra.service.ExceptionsTranslatorImpl.translate(ExceptionsTranslatorImpl.java:52)\r\n        at me.prettyprint.cassandra.service.KeyspaceServiceImpl$1.execute(KeyspaceServiceImpl.java:95)\r\n        at me.prettyprint.cassandra.service.KeyspaceServiceImpl$1.execute(KeyspaceServiceImpl.java:88)\r\n        at me.prettyprint.cassandra.service.Operation.executeAndSetResult(Operation.java:101)\r\n        at me.prettyprint.cassandra.connection.HConnectionManager.operateWithFailover(HConnectionManager.java:221)\r\n        at me.prettyprint.cassandra.service.KeyspaceServiceImpl.operateWithFailover(KeyspaceServiceImpl.java:129)\r\n        at me.prettyprint.cassandra.service.KeyspaceServiceImpl.batchMutate(KeyspaceServiceImpl.java:100)\r\n        at me.prettyprint.cassandra.service.KeyspaceServiceImpl.batchMutate(KeyspaceServiceImpl.java:106)\r\n        at me.prettyprint.cassandra.model.MutatorImpl$2.doInKeyspace(MutatorImpl.java:203)\r\n        at me.prettyprint.cassandra.model.MutatorImpl$2.doInKeyspace(MutatorImpl.java:200)\r\n        at me.prettyprint.cassandra.model.KeyspaceOperationCallback.doInKeyspaceAndMeasure(KeyspaceOperationCallback.java:20)\r\n        at me.prettyprint.cassandra.model.ExecutingKeyspace.doExecute(ExecutingKeyspace.java:85)\r\n        at me.prettyprint.cassandra.model.MutatorImpl.execute(MutatorImpl.java:200)\r\n        at jp.co.rakuten.gsp.cassandra_connector.feeder.CassandraFeeder.batchInsert(CassandraFeeder.java:506)\r\n        at jp.co.rakuten.gsp.purchase_history.cassandra_connector.PHCassandraFeeder.consume(PHCassandraFeeder.java:240)\r\n        at jp.co.rakuten.gsp.cassandra_connector.feeder.CassandraFeeder.process(CassandraFeeder.java:330)\r\n        at jp.co.rakuten.gsp.cassandra_connector.feeder.Feeder.run(Feeder.java:164)\r\n        at java.lang.Thread.run(Thread.java:662)\r\nCaused by: UnavailableException()\r\n        at org.apache.cassandra.thrift.Cassandra$batch_mutate_result.read(Cassandra.java:16485)\r\n        at org.apache.cassandra.thrift.Cassandra$Client.recv_batch_mutate(Cassandra.java:916)\r\n        at org.apache.cassandra.thrift.Cassandra$Client.batch_mutate(Cassandra.java:890)\r\n        at me.prettyprint.cassandra.service.KeyspaceServiceImpl$1.execute(KeyspaceServiceImpl.java:93)\r\n        ... 16 more\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"created":"2011-03-08T04:26:35.857+0000","updated":"2011-03-08T04:26:35.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13003946","id":"13003946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=terjem","name":"terjem","emailAddress":"tmarthinussen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Terje Marthinussen","active":true},"body":"From ReadCallback.java\r\n\r\n\r\n        this.endpoints = repair || resolver instanceof RowRepairResolver\r\n                       ? endpoints\r\n                       : endpoints.subList(0, Math.min(endpoints.size(), blockfor)); // min so as to not throw exception until assureSufficient is called\r\n\r\nThis will cut the list of endpoints to whatever is the consistency requirement (in the case where repair is false, which for instance happens all the time for a rangescan).\r\n\r\nLater:\r\nassert resolver.getMessageCount() <= endpoints.size()\r\n\r\nwhich will cause an assert if all nodes answers on a range request (or if you have a random readrepair).\r\n\r\nI am actually not 100% sure what the fix is right now as I have not had time to scan the rest of the code and need to leave office for today, but that is the problem anyway :)\r\nTo be honest, the logic here may look a bit broken.\r\n\r\nThe assert happening here may good either. The error condition is not returned to the client, so it will hang around waiting for a timeout to occur.\r\nMaybe the code should throw some exception before the assert?\r\n\r\nSomething like\r\nassert resolver.getMessageCount() <= endpoints.size() :  \"Got \" + resolver.getMessageCount() + \" replies but only know \" + endpoints.size() + \" endpoints\";\r\nmay also be good?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=terjem","name":"terjem","emailAddress":"tmarthinussen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Terje Marthinussen","active":true},"created":"2011-03-08T14:04:24.931+0000","updated":"2011-03-08T14:04:24.931+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13003948","id":"13003948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=terjem","name":"terjem","emailAddress":"tmarthinussen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Terje Marthinussen","active":true},"body":"Just to make this very clear.\r\nThe list of endpoints is cut to the consistency requirement so if:\r\n- The request requires gossip with more than one node\r\n- all nodes answers\r\n- you do not use consistencylevel ALL,\r\nthen the assert will trigger.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=terjem","name":"terjem","emailAddress":"tmarthinussen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Terje Marthinussen","active":true},"created":"2011-03-08T14:06:25.021+0000","updated":"2011-03-08T14:06:25.021+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004043","id":"13004043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"The bug is that range queries were not restricting the set of endpoints it queries to handler.endpoints the way single-row queries do. Fix attached with a couple extra comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-08T16:34:05.921+0000","updated":"2011-03-08T16:34:05.921+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004095","id":"13004095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"body":"Hi Jonathan,\r\n\r\nI tried your patch. But still the assertion happens in our cluster. Query is IndexedSlicesQuery with QUORUM.\r\n\r\n\r\nERROR [RequestResponseStage:23] 2011-03-09 02:47:23,343 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread[RequestResponseStage:23,5,main]\r\njava.lang.AssertionError: Got 3 replies but requests were only sent to 2 endpoints\r\n        at org.apache.cassandra.service.ReadCallback.response(ReadCallback.java:129)\r\n        at org.apache.cassandra.net.ResponseVerbHandler.doVerb(ResponseVerbHandler.java:49)\r\n        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:72)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n        at java.lang.Thread.run(Thread.java:662)\r\nERROR [RequestResponseStage:10] 2011-03-09 02:48:48,463 AbstractCassandraDaemon.java (line 114) Fatal exception in thread Thread[RequestResponseStage:10,5,main]\r\njava.lang.AssertionError: Got 3 replies but requests were only sent to 2 endpoints\r\n        at org.apache.cassandra.service.ReadCallback.response(ReadCallback.java:129)\r\n        at org.apache.cassandra.net.ResponseVerbHandler.doVerb(ResponseVerbHandler.java:49)\r\n        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:72)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n        at java.lang.Thread.run(Thread.java:662)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"created":"2011-03-08T17:57:06.589+0000","updated":"2011-03-08T17:57:06.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004100","id":"13004100","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"v2 adds same fix for indexed queries","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-08T18:02:32.015+0000","updated":"2011-03-08T18:02:32.015+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004233","id":"13004233","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Workaround: remove this line from cassandra-env.sh\r\n\r\n{noformat}\r\nJVM_OPTS=\"$JVM_OPTS -ea\"\r\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-08T21:40:04.471+0000","updated":"2011-03-08T21:40:04.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004241","id":"13004241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thobbs","name":"thobbs","emailAddress":"tyler at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thobbs&avatarId=17039","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thobbs&avatarId=17039","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thobbs&avatarId=17039","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thobbs&avatarId=17039"},"displayName":"Tyler Hobbs","active":true},"body":"v2 patch fixes the issue for me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thobbs","name":"thobbs","emailAddress":"tyler at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thobbs&avatarId=17039","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thobbs&avatarId=17039","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thobbs&avatarId=17039","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thobbs&avatarId=17039"},"displayName":"Tyler Hobbs","active":true},"created":"2011-03-08T21:50:32.645+0000","updated":"2011-03-08T21:50:32.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004349","id":"13004349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"body":"v2 patch works for me too. Server side errors are gone.\r\n\r\nMy client still gets TimedOut exception. But maybe this is a different problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"created":"2011-03-09T03:18:55.993+0000","updated":"2011-03-09T03:18:55.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004581","id":"13004581","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. My client still gets TimedOut exception. But maybe this is a different problem.\r\n\r\nreal timeouts can still happen. :)\r\n\r\ni'd suggest 1) checking for dropped message warnings in the log; if there aren't any, 2) enabling debug logging to see where the commands are going and not coming back from in time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-09T14:55:57.537+0000","updated":"2011-03-09T14:55:57.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004582","id":"13004582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-09T14:58:39.779+0000","updated":"2011-03-09T14:58:39.779+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004593","id":"13004593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"body":"I'm trying to find out when the timeout happens. So, I put logging to CassandraServer.java and  ReadCallback.java just before timeout exception.\r\nI saw Timeout occurs even when 2 responses are received for query with quorum. 2 responses should be enough for quorum. Is it correct behavior?\r\n\r\n------\r\n INFO [pool-1-thread-44] 2011-03-09 23:34:47,685 ReadCallback.java (line 125) Operation timed out - received only 2 responses from /xx.xx.xx.67, /xx.xx.xx.68, command class = org.apache.cassandra.db.SliceFromReadCommand\r\n INFO [pool-1-thread-44] 2011-03-09 23:34:47,686 CassandraServer.java (line 110) --- timed out: Operation timed out - received only 2 responses from /xx.xx.xx.67, /xx.xx.xx.68,  .\r\n-----\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"created":"2011-03-09T15:08:50.693+0000","updated":"2011-03-09T15:08:50.693+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004599","id":"13004599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra-0.7 #366 (See [https://hudson.apache.org/hudson/job/Cassandra-0.7/366/])\r\n    update CHANGES for CASSANDRA-2282 that got committed already (in r1079812 I think)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-03-09T15:16:22.833+0000","updated":"2011-03-09T15:16:22.833+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004604","id":"13004604","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"And what does the Blockfor/repair is %s/%s; setting up requests to %s debug line show?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-09T15:21:52.951+0000","updated":"2011-03-09T15:21:52.951+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004617","id":"13004617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"body":"Timeout setting in cassandra.yaml is 15sec. So, the following must be the line. IP address of cassandra node which has the log is xx.xx.xx.70.\r\n\r\n----\r\nDEBUG [pool-1-thread-121] 2011-03-09 23:34:32,726 ReadCallback.java (line 88) Blockfor/repair is 2/true; setting up requests to /xx.xx.xx.66,/xx.xx.xx.67,/xx.xx.xx.68\r\n----\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skamio","name":"skamio","emailAddress":"kamioshot at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shotaro Kamio","active":true},"created":"2011-03-09T15:39:34.925+0000","updated":"2011-03-09T15:39:34.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13004656","id":"13004656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Sounds like you're getting replies back from digest request but not data.  In StorageProxy:\r\n\r\n{code}\r\n            // The data-request message is sent to dataPoint, the node that will actually get\r\n            // the data for us. The other replicas are only sent a digest query.\r\n{code}\r\n\r\nNote that debug logs show which node gets the data request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-03-09T17:04:56.104+0000","updated":"2011-03-09T17:04:56.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12500665/comment/13023126","id":"13023126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stuhood","name":"stuhood","emailAddress":"stuhood at twitter dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stuhood&avatarId=10049","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stuhood&avatarId=10049","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stuhood&avatarId=10049","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stuhood&avatarId=10049"},"displayName":"Stu Hood","active":true},"body":"> Sounds like you're getting replies back from digest request but not data.\r\nCreated CASSANDRA-2540","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=stuhood","name":"stuhood","emailAddress":"stuhood at twitter dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=stuhood&avatarId=10049","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=stuhood&avatarId=10049","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=stuhood&avatarId=10049","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=stuhood&avatarId=10049"},"displayName":"Stu Hood","active":true},"created":"2011-04-22T05:59:19.266+0000","updated":"2011-04-22T05:59:19.266+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-2282/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0gag7:"}}