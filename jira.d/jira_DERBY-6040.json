{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12627022","self":"https://issues.apache.org/jira/rest/api/latest/issue/12627022","key":"DERBY-6040","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323475","id":"12323475","description":"Head of 10.8 branch starting 2014-01-13","name":"10.8.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323562","id":"12323562","description":"Head of 10.9 branch after releasing 10.9.1.0","name":"10.9.2.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2013-01-11 05:04:28.41","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"303715","customfield_12310222":"1_*:*_1_*:*_337745899_*|*_5_*:*_2_*:*_13040519209_*|*_4_*:*_1_*:*_19300","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-06-14T17:10:46.339+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6040/watchers","watchCount":5,"isWatching":false},"created":"2013-01-10T20:59:21.951+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323475","id":"12323475","description":"Head of 10.8 branch starting 2014-01-13","name":"10.8.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12323562","id":"12323562","description":"Head of 10.9 branch after releasing 10.9.1.0","name":"10.9.2.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12371907","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12371907","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12656863","key":"DERBY-6289","self":"https://issues.apache.org/jira/rest/api/2/issue/12656863","fields":{"summary":"Derby 10.8 backport issue (summer 2013)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12362975","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12362975","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12624875","key":"DERBY-6022","self":"https://issues.apache.org/jira/rest/api/2/issue/12624875","fields":{"summary":"Add a system procedure for (un)registering optional packages of Derby tools.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12363643","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12363643","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12629601","key":"DERBY-6058","self":"https://issues.apache.org/jira/rest/api/2/issue/12629601","fields":{"summary":"2 ClassNotFoundException failures on trunk with ibm's weme6.2 since build 1433263","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-08-04T02:48:25.772+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"Using the metadata table functions introduced by DERBY-6022, I get the wrong row order on this query:\r\n\r\nselect t.table_name c2, c.column_name c3\r\nfrom table( getTables( null, '%', '%' ) ) t,\r\n        table( getColumns( null, '%', '%', '%') ) c\r\nwhere c.table_name = t.table_name\r\nand t.table_type = 'TABLE'\r\nand c.table_schem = t.table_schem\r\norder by c2, c3;\r\n\r\nHowever, I get the correct order on the following query. The good query returns the same rows but in the correct order. The only difference between the queries is that the bad one has an extra, NOP join clause.\r\n\r\nHere is the full result of a script showing the problem:\r\n\r\nij version 10.10\r\nij> connect 'jdbc:derby:memory:db;create=true';\r\nij> create table t( d int, u varchar( 30 ) );\r\n0 rows inserted/updated/deleted\r\nij> create table s( d int, u varchar( 30 ) );\r\n0 rows inserted/updated/deleted\r\nij> call syscs_util.syscs_register_tool( 'databaseMetaData', true );\r\n0 rows inserted/updated/deleted\r\nij> -- columns are ordered correctly\r\nselect t.table_name c2, c.column_name c3\r\nfrom table( getTables( null, '%', '%' ) ) t,\r\n        table( getColumns( null, '%', '%', '%') ) c\r\nwhere c.table_name = t.table_name\r\nand t.table_type = 'TABLE'\r\norder by c2, c3;\r\nC2                                                                                                                              |C3                                                                                                                              \r\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nS                                                                                                                               |D                                                                                                                               \r\nS                                                                                                                               |U                                                                                                                               \r\nT                                                                                                                               |D                                                                                                                               \r\nT                                                                                                                               |U                                                                                                                               \r\n\r\n4 rows selected\r\nij> -- columns are ordered incorrectly\r\nselect t.table_name c2, c.column_name c3\r\nfrom table( getTables( null, '%', '%' ) ) t,\r\n        table( getColumns( null, '%', '%', '%') ) c\r\nwhere c.table_name = t.table_name\r\nand t.table_type = 'TABLE'\r\nand c.table_schem = t.table_schem\r\norder by c2, c3;\r\nC2                                                                                                                              |C3                                                                                                                              \r\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nT                                                                                                                               |D                                                                                                                               \r\nS                                                                                                                               |D                                                                                                                               \r\nT                                                                                                                               |U                                                                                                                               \r\nS                                                                                                                               |U                                                                                                                               \r\n\r\n4 rows selected\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10366","value":"Wrong query result","id":"10366"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"251238","summary":"Incorrect row order returned for an ORDER BY on a join of two table functions","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":10,"total":10,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13550827","id":"13550827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The first column gets eliminated from the OrderByList in SelectNode#preprocess -> OrderByList#removeConstantColumns because the code thinks this column references is \"TABLE_TYPE\", which is part of one of the where expressions that has a constant.\r\n\r\nThis mis-identification happens in BinaryRelationOperatorNode#getOperand in these lines:\r\n\r\nif (cr.getSource().getColumnPosition() ==\r\n    cRef.getColumnNumber())\r\n{\r\n\r\nboth sides evaluate to 3. \"cr\" should point to \"T.TABLE_TYPE\", and \"cRef\" should point to C.TABLE_NAME. So, I believe the wrong number here is assigned to \"cr\"; it should be 4. Possibly because FromVTI#genProjectRestrict removes column from the result set that are not used, cf. his code:\r\n\r\n/* Project out any unreferenced columns.  If there are no referenced \r\n * columns, generate and bind a single ResultColumn whose expression is 1.\r\n */\r\nprRCList.doProjection();\r\n\r\nI'll see if referencing it makes a difference. [Update: adding \", t.table_cat c4\" to the select list made the query work.]\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-01-11T05:04:28.410+0000","updated":"2013-01-11T05:10:21.914+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13551167","id":"13551167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for that investigation, Dag. I'm attaching a simpler repro, derby-6040.sql. This repro eliminates the databaseMetaData functions and uses, instead, the vti introduced by derby-3069-08-aa-stringArrayTable.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-11T15:23:57.977+0000","updated":"2013-01-11T15:23:57.977+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13551180","id":"13551180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Changing the one line description of this issue. Removed the red-herring reference to the metadata table functions since this problem affects non-metadata table functions too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-11T15:30:13.777+0000","updated":"2013-01-11T15:30:13.777+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13551504","id":"13551504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Dag has identified why the first column is being stripped from the OrderByList: it has been confused with the column which is guaranteed to be constant by this predicate: l.a3 = 'Z'. If you run a similar query against base tables rather than table functions, the confusion does not occur. The difference between the behavior of base tables and table functions is contained in ResultColumn.getColumnPosition():\r\n\r\n\tpublic int getColumnPosition()\r\n\t{\r\n\t\tif (columnDescriptor!=null)\r\n\t\t\treturn columnDescriptor.getPosition();\r\n\t\telse\r\n\t\t\treturn virtualColumnId;\r\n\r\n\t}\r\n\r\nFor both the base table and table function cases, the virtualColumnIds are the same. But the ResultColumn for a base table has a columnDescriptor, and that causes getColumnPosition() to return a different identifying number for the ResultColumn. For base tables, the returned number is the column position in the base table. For table functions, the returned number is the virtualColumnId, which is the ResultColumn's index into the ResultColumnList which contains it. The column position and virtualColumnId are different because the first column of the base table (and table function) has been removed by the ProjectRestrict logic. That, in turn, is because it is not referenced anywhere in the query. Some approaches to fixing the problem might be: \r\n\r\n1) Fabricate a ColumnDescriptor for the table function ResultColumn.\r\n\r\n2) Change the value of virtualColumnId for table functions.\r\n\r\n3) Add another case to ResultColumn.getColumnPosition() to handle ResultColumns in table functions.\r\n\r\nI am attaching derbyAST.xml. This shows the parse, bind, and optimize ASTs for the base table and table function queries. I generated this file using the following script and the ASTInspector tool attached to DERBY-4415:\r\n\r\nconnect 'jdbc:derby:memory:db;create=true';\r\n\r\ncreate function leftTable\r\n(\r\n    columnNames varchar( 32672 ),\r\n    rowContents varchar( 32672 ) ...\r\n)\r\nreturns table\r\n(\r\n    a0   varchar( 5 ),\r\n    a1   varchar( 5 ),\r\n    a2   varchar( 5 ),\r\n    a3   varchar( 5 )\r\n)\r\nlanguage java parameter style derby_jdbc_result_set no sql\r\nexternal name 'org.apache.derbyTesting.functionTests.tests.lang.VarargsRoutines.stringArrayTable';\r\n\r\ncreate function rightTable\r\n(\r\n    columnNames varchar( 32672 ),\r\n    rowContents varchar( 32672 ) ...\r\n)\r\nreturns table\r\n(\r\n    b1   varchar( 5 ),\r\n    b2   varchar( 5 ),\r\n    b3   varchar( 5 )\r\n)\r\nlanguage java parameter style derby_jdbc_result_set no sql\r\nexternal name 'org.apache.derbyTesting.functionTests.tests.lang.VarargsRoutines.stringArrayTable';\r\n\r\ncreate table leftTable\r\n(\r\n    a0   varchar( 5 ),\r\n    a1   varchar( 5 ),\r\n    a2   varchar( 5 ),\r\n    a3   varchar( 5 )\r\n);\r\n\r\ncreate table rightTable\r\n(\r\n    b1   varchar( 5 ),\r\n    b2   varchar( 5 ),\r\n    b3   varchar( 5 )\r\n);\r\n\r\ninsert into leftTable values\r\n( 'X', 'APP', 'T', 'Z' ),\r\n( 'X', 'APP', 'S', 'Z' );\r\n\r\ninsert into rightTable values\r\n( 'APP', 'T', 'A' ),\r\n( 'APP', 'T', 'B' ),\r\n( 'APP', 'S', 'A' ),\r\n( 'APP', 'S', 'B' );\r\n\r\ncall syscs_util.syscs_register_tool( 'customTool', true, 'ASTInspector', 'XmlASTPrinter' );\r\n\r\nselect l.a2 c2, r.b3 c3\r\nfrom leftTable l, rightTable r\r\nwhere r.b2 = l.a2\r\nand l.a3 = 'Z'\r\nand r.b1 = l.a1\r\norder by c2, c3;\r\n\r\nselect l.a2 c2, r.b3 c3\r\nfrom\r\n    table( leftTable\r\n            (\r\n            'A0 A1 A2 A3',\r\n            'X APP T Z',\r\n            'X APP S Z'\r\n            ) ) l,\r\n    table( rightTable\r\n           (\r\n           'B1 B2 B3',\r\n           'APP T A',\r\n           'APP T B',\r\n           'APP S A',\r\n           'APP S B'\r\n           ) ) r\r\nwhere r.b2 = l.a2\r\nand l.a3 = 'Z'\r\nand r.b1 = l.a1\r\norder by c2, c3;\r\n\r\ncall syscs_util.syscs_register_tool( 'customTool', false, 'ASTInspector' );\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-11T20:50:35.945+0000","updated":"2013-01-11T20:50:35.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13552846","id":"13552846","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6040-01-aa-makeColumnDescriptor.diff. This patch stuffs a ColumnDescriptor into each ResultColumn created for a table function. I am running tests now.\r\n\r\nWhen the table function's ResultColumnList is created and bound, we now stuff a ColumnDescriptor into each ResultColumn. This causes each ResultColumn to correctly report its position in the full shape of the table function even when projection removes leading columns from the ResultColumnList.\r\n\r\n\r\nTouches the following files:\r\n\r\n---------------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/FromVTI.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/ResultColumnList.java\r\n\r\nStuff a ColumnDescriptor into each ResultColumn created for a table function.\r\n\r\n---------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java\r\n\r\nAdd a regression test for this bug.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-14T16:28:29.190+0000","updated":"2013-01-14T16:28:29.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13552979","id":"13552979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Tests passed cleanly for me on derby-6040-01-aa-makeColumnDescriptor.diff. Committed at subversion revision 1433031.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-14T18:46:58.327+0000","updated":"2013-01-14T18:46:58.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13703207","id":"13703207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I think that the actual fix for the bug could be backported to 10.8. However, the regression test case relies on a 10.10 feature, vararg functions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-07-09T12:25:32.763+0000","updated":"2013-07-09T12:25:32.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13704199","id":"13704199","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Temporarily assigning to me while doing the backport. I will do the backport without the regression test since it uses vararg function which is not available in 10.9 and before","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-07-10T04:33:22.146+0000","updated":"2013-07-10T04:33:22.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13704695","id":"13704695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1501816 from [~mamtas]\r\n[ https://svn.apache.org/r1501816 ]\r\n\r\nDERBY-6040(Incorrect row order returned for an ORDER BY on a join of two table functions)\r\n\r\nHand backported(svn merge was running into conflicts) revision 1433031 from trunk to 10.9 without junit test since junit test is using feature not available in 10.9","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-10T16:03:29.842+0000","updated":"2013-07-10T16:03:29.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12627022/comment/13706127","id":"13706127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1502329 from [~mamtas]\r\n[ https://svn.apache.org/r1502329 ]\r\n\r\nDERBY-6040(Incorrect row order returned for an ORDER BY on a join of two table functions)\r\n\r\nBackporting to 10.8 from 10.9. Original fix contributed by Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-11T19:14:36.912+0000","updated":"2013-07-11T19:14:36.912+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6040/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i17e07:"}}