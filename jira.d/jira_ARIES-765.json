{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12528628","self":"https://issues.apache.org/jira/rest/api/latest/issue/12528628","key":"ARIES-765","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316139","id":"12316139","description":"","name":"0.4","archived":true,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-10-25 09:52:18.732","customfield_12312323":null,"customfield_12310420":"214488","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4853019755_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-12-20T10:43:14.046+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-765/watchers","watchCount":0,"isWatching":false},"created":"2011-10-25T06:39:34.414+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315310","id":"12315310","description":"","name":"0.3","archived":true,"released":true,"releaseDate":"2011-02-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-20T10:43:14.147+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313048","id":"12313048","name":"Blueprint","description":"OSGi Blueprint Services implementation"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313176","id":"12313176","name":"JPA","description":"RFC 143 JPA Integration"}],"timeoriginalestimate":null,"description":"We use the JPA entities in the following way:\r\n- entities1.jar\r\n- entities2.jar\r\n- pu.jar\r\n\r\nThe first two contains entity classes but no persistence unit, the third contains the Meta-Persistence header and a persistence.xml file (named to something else not to be realized by Glassfish)\r\nWe use the persistence unit with blueprint.\r\nWhen we re-deploy the pu.jar we have to re-deploy everything else (even the jars that do contain only services that are related to unchanged entity classes) manually as the following exception occurs:\r\n\r\njava.lang.IllegalStateException: Attempting to execute an operation on a closed EntityManagerFactory.\r\n\tat org.eclipse.persistence.internal.jpa.EntityManagerFactoryDelegate.verifyOpen(EntityManagerFactoryDelegate.java:305)\r\n\tat org.eclipse.persistence.internal.jpa.EntityManagerFactoryDelegate.createEntityManagerImpl(EntityManagerFactoryDelegate.java:276)\r\n\tat org.eclipse.persistence.internal.jpa.EntityManagerFactoryImpl.createEntityManagerImpl(EntityManagerFactoryImpl.java:290)\r\n\tat org.eclipse.persistence.internal.jpa.EntityManagerFactoryImpl.createEntityManager(EntityManagerFactoryImpl.java:275)\r\n\tat org.apache.aries.jpa.container.impl.CountingEntityManagerFactory.createEntityManager(CountingEntityManagerFactory.java:71)\r\n\tat org.apache.aries.jpa.container.context.transaction.impl.JTAPersistenceContextRegistry.getCurrentPersistenceContext(JTAPersistenceContextRegistry.java:132)\r\n\tat org.apache.aries.jpa.container.context.transaction.impl.JTAEntityManager.getPersistenceContext(JTAEntityManager.java:87)\r\n\tat org.apache.aries.jpa.container.context.transaction.impl.JTAEntityManager.getCriteriaBuilder(JTAEntityManager.java:391)\r\n\r\nIt would be nice if JTAEntityManager would realize when the persistence unit gets redeployed and would use the new instance.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"166210","summary":"Attempting to execute an operation on a closed EntityManagerFactory when the persistence unit is re-deployed","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=balazs.zsoldos","name":"balazs.zsoldos","emailAddress":"zs_b at freemail dot hu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Balazs Zsoldos","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=balazs.zsoldos","name":"balazs.zsoldos","emailAddress":"zs_b at freemail dot hu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Balazs Zsoldos","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Glassfish 3.1.1","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12528628/comment/13134908","id":"13134908","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"body":"Having looked into this, this isn't actually an issue with the JTAEntityManager, it's an issue with blueprint (or possibly the JPA namespace hander, depending on your view of the world).\r\n\r\nEffectively what we have is the following blueprint:\r\n\r\n<reference id=\"foo\" interface=\"javax.persistence.EntityManagerFactory/>\r\n\r\n<bean id=\"not_working_after_update\" class=\"SomeClass\">\r\n    <property name=\"bar\">\r\n        <bean factory-component=\"foo\" factory-method=\"createEntityManager\"/>\r\n    </property>\r\n</bean>\r\n\r\n\r\nThis injects the not_working_after_update bean with an EntityManager, created from the service reference. If the service reference goes away, and is then replaced, there is no re-injection of the stale EntityManager. This goes against the OSGi model of throwing away objects created by services when the service is unregistered.\r\n\r\nWe will discuss the best course of action (which may be to get something put in the spec) on the Aries lists\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"created":"2011-10-25T09:52:18.732+0000","updated":"2011-10-25T09:52:18.732+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12528628/comment/13134928","id":"13134928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=balazs.zsoldos","name":"balazs.zsoldos","emailAddress":"zs_b at freemail dot hu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Balazs Zsoldos","active":true},"body":"Thank you very much for the amazingly fast response! I will be very interested in the conceptual solution.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=balazs.zsoldos","name":"balazs.zsoldos","emailAddress":"zs_b at freemail dot hu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Balazs Zsoldos","active":true},"created":"2011-10-25T10:43:41.680+0000","updated":"2011-10-25T10:43:41.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12528628/comment/13135056","id":"13135056","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"body":"There is one more thing I should add. This scenario violates the packaging required by the JPA service specification, which states that the Entity Classes should live inside the persistence bundle. If you were to do this then you would not see this problem as the client would be refreshed to pick up the new entity class package.\r\n\r\nPackaging the Entity Classes separately from the persistence unit definition is a poor modularity pattern because the entity classes are tightly bound to the database configuration and mapping information from the persistence unit. I would strongly recommend against this pattern.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"created":"2011-10-25T13:38:13.889+0000","updated":"2011-10-25T13:38:13.889+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12528628/comment/13135105","id":"13135105","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=balazs.zsoldos","name":"balazs.zsoldos","emailAddress":"zs_b at freemail dot hu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Balazs Zsoldos","active":true},"body":"About your last comment I wrote a mail to the mailing list in this topic as I am not sure that my questions are strongly related to this issue entry.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=balazs.zsoldos","name":"balazs.zsoldos","emailAddress":"zs_b at freemail dot hu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Balazs Zsoldos","active":true},"created":"2011-10-25T14:43:39.828+0000","updated":"2011-10-25T14:45:05.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12528628/comment/13173070","id":"13173070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"body":"I was unable to recreate the problem in testing, but there is a fix in trunk that should work. It would be great if people who've hit this problem could vaerify the fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"created":"2011-12-20T10:43:14.107+0000","updated":"2011-12-20T10:43:14.107+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-765/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0st7r:"}}