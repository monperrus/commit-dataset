{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12394939","self":"https://issues.apache.org/jira/rest/api/latest/issue/12394939","key":"DERBY-3649","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-04-28 22:33:32.058","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23769","customfield_12310222":"1_*:*_1_*:*_348478423_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-05-02T23:14:21.508+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3649/watchers","watchCount":0,"isWatching":false},"created":"2008-04-28T22:26:23.085+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12322392","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322392","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12394291","key":"DERBY-3631","self":"https://issues.apache.org/jira/rest/api/2/issue/12394291","fields":{"summary":"UDF used with aggregate arguments results in error 30000","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:51:56.765+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"hi,\n\ni cant execute the following statement with an aggregate (count(*)) argument:\n\nSELECT checkCount(count(*)) FROM SYS.SYSTABLES;\n\n.. without  getting this error/stacktrace:\n\nERROR 42Y29: The SELECT list of a non-grouped query contains at least one invalid expression. When the SELECT list contains at least one aggregate then all entries must be valid aggregate expressions.\njava.sql.SQLSyntaxErrorException: The SELECT list of a non-grouped query contains at least one invalid expression. When the SELECT list contains at least one aggregate then all entries must be valid aggregate expressions.\n\tat org.apache.derby.client.am.SQLExceptionFactory40.getSQLException(Unknown Source)\n\tat org.apache.derby.client.am.SqlException.getSQLException(Unknown Source)\n\tat org.apache.derby.client.am.Statement.execute(Unknown Source)\n\tat org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)\n\tat org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)\n\tat org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)\n\tat org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)\n\tat org.apache.derby.impl.tools.ij.Main.go(Unknown Source)\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)\n\tat org.apache.derby.impl.tools.ij.Main.main(Unknown Source)\n\tat org.apache.derby.tools.ij.main(Unknown Source)\nCaused by: org.apache.derby.client.am.SqlException: The SELECT list of a non-grouped query contains at least one invalid expression. When the SELECT list contains at least one aggregate then all entries must be valid aggregate expressions.\n\tat org.apache.derby.client.am.Statement.completeSqlca(Unknown Source)\n\tat org.apache.derby.client.net.NetStatementReply.parsePrepareError(Unknown Source)\n\tat org.apache.derby.client.net.NetStatementReply.parsePRPSQLSTTreply(Unknown Source)\n\tat org.apache.derby.client.net.NetStatementReply.readPrepareDescribeOutput(Unknown Source)\n\tat org.apache.derby.client.net.StatementReply.readPrepareDescribeOutput(Unknown Source)\n\tat org.apache.derby.client.net.NetStatement.readPrepareDescribeOutput_(Unknown Source)\n\tat org.apache.derby.client.am.Statement.readPrepareDescribeOutput(Unknown Source)\n\tat org.apache.derby.client.am.Statement.flowExecute(Unknown Source)\n\tat org.apache.derby.client.am.Statement.executeX(Unknown Source)\n\t... 9 more\n\nhere the code to create the function in derby:\n\nCREATE FUNCTION checkCount\n(count INTEGER)\nRETURNS INTEGER\nLANGUAGE JAVA PARAMETER STYLE JAVA\nNO SQL\nEXTERNAL NAME 'ExceptionOnZeroCount.checkCount';\n\nand here the code of the (quite simple) java method:\n\npublic class ExceptionOnZeroCount {\n\n    public static int checkCount(int count)\n            throws SQLException {\n\n        if (count == 0) \n            throw new SQLException(\"No results found\", \"38777\");\n        }\n        return count;\n    }\n}\n\nhope this will be fixed :) Good night!\n\nmamurdian","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37289","summary":"can't call a stored function with an aggregate argument without getting the following error: ERROR 42Y29","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamurdian","name":"mamurdian","emailAddress":"Sebastian dot Pfaff at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10102","value":"Patch Available","id":"10102"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamurdian","name":"mamurdian","emailAddress":"Sebastian dot Pfaff at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"------------------ Java Information ------------------\nJava Version:    1.6.0\nJava Vendor:     Sun Microsystems Inc.\nJava home:       /usr/java/jdk1.6.0/jre\nJava classpath:  /me/apache_libs/db-derby-10.4.1.3-bin/lib/derby.jar:/me/apache_libs/db-derby-10.4.1.3-bin/lib/derbynet.jar:/me/apache_libs/db-derby-10.4.1.3-bin/lib/derbytools.jar:/me/apache_libs/db-derby-10.4.1.3-bin/lib/derbyclient.jar\nOS name:         Linux\nOS architecture: i386\nOS version:      2.6.23.1\nJava user name:  me\nJava user home:  /me\nJava user dir:   /me/apache_libs/db-derby-10.4.1.3-bin/bin\njava.specification.name: Java Platform API Specification\njava.specification.version: 1.6\n--------- Derby Information --------\nJRE - JDBC: Java SE 6 - JDBC 4.0\n[/me/apache_libs/db-derby-10.4.1.3-bin/lib/derby.jar] 10.4.1.3 - (648739)\n[/me/apache_libs/db-derby-10.4.1.3-bin/lib/derbytools.jar] 10.4.1.3 - (648739)\n[/me/apache_libs/db-derby-10.4.1.3-bin/lib/derbynet.jar] 10.4.1.3 - (648739)\n[/me/apache_libs/db-derby-10.4.1.3-bin/lib/derbyclient.jar] 10.4.1.3 - (648739)\n------------------------------------------------------\n----------------- Locale Information -----------------\nCurrent Locale :  [English/United States [en_US]]\nFound support for locale: [cs]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [de_DE]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [es]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [fr]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [hu]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [it]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [ja_JP]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [ko_KR]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [pl]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [pt_BR]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [ru]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [zh_CN]\n         version: 10.4.1.3 - (648739)\nFound support for locale: [zh_TW]\n         version: 10.4.1.3 - (648739)\n------------------------------------------------------\n","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":8,"total":8,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394939/comment/12592915","id":"12592915","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"The query works fine with 10.1 and seems related to this change for DERBY-883.\r\nhttp://svn.apache.org/viewvc/db/derby/code/trunk/java/engine/org/apache/derby/impl/sql/compile/VerifyAggregateExpressionsVisitor.java?p2=%2Fdb%2Fderby%2Fcode%2Ftrunk%2Fjava%2Fengine%2Forg%2Fapache%2Fderby%2Fimpl%2Fsql%2Fcompile%2FVerifyAggregateExpressionsVisitor.java&p1=%2Fdb%2Fderby%2Fcode%2Ftrunk%2Fjava%2Fengine%2Forg%2Fapache%2Fderby%2Fimpl%2Fsql%2Fcompile%2FVerifyAggregateExpressionsVisitor.java&r1=437070&r2=437069&view=diff&pathrev=437070\r\n\r\nThe change I think was intended to prevent group by java function, but disallows java functions with aggregate arguments.\r\nRemoving the code when node instanceof JavaToSQLValueNode, corrects the problem but  also allows group by function.\r\nLooking for a better way to check for that.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-04-28T22:33:32.058+0000","updated":"2008-04-28T22:33:32.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394939/comment/12592919","id":"12592919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamurdian","name":"mamurdian","emailAddress":"Sebastian dot Pfaff at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian","active":true},"body":"i corrected my eviroment information.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamurdian","name":"mamurdian","emailAddress":"Sebastian dot Pfaff at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian","active":true},"created":"2008-04-28T22:43:59.234+0000","updated":"2008-04-28T22:43:59.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394939/comment/12592922","id":"12592922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Interestingly the code does not correctly restrict group by expression if the expression is not in the select list.\r\n\r\nEven with the check in place, I can \r\n\r\nCREATE FUNCTION R() returns double external name 'java.lang.Math.random' language java parameter style java;\r\n\r\nij> select count(*) from test group by r();\r\n1\r\n-----------\r\n1\r\n\r\nWhich I don't think I am supposed to be able to do.\r\n\r\nThe functional test does \r\nselect r(), count(*) from test group by r()\r\n\r\nso gets the expected error.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-04-28T22:50:47.359+0000","updated":"2008-04-28T22:50:47.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394939/comment/12592923","id":"12592923","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Yes, I believe that VerifyAggregateExpressionsVisitor visits the\r\nselect's \"result column list\", and for each component of that list,\r\nverifies that it is either a valid aggregate function, or a valid grouping column.\r\n\r\nFrom memory, I thought that in your example:\r\n\r\n   select count(*) from test group by r()\r\n\r\nthe \"r()\" expression should have been \"generated\" into the\r\nresult column list (look at the places where ResultColumn.markGenerated\r\ngets called to see how that process occurs).\r\n\r\nGenerating the group by expression into the select's RCL should have\r\nthen resulted in the Verify visitor encountering it, so I'm not sure why\r\nyour example isn't being caught, but maybe this provides some\r\nideas to investigate further.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-04-28T22:58:08.611+0000","updated":"2008-04-28T22:58:08.611+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394939/comment/12592927","id":"12592927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"It seems to only add it to the generated columns if it is an instance of ColumnReference.\r\nIn GroupByList see ~line 177\r\n\t\tif (! matchFound && \r\n\t\t\t    groupingCol.getColumnExpression() instanceof ColumnReference) \r\n\t\t\t{\r\n\t\t\t    \t// only add matching columns for column references not \r\n\t\t\t    \t// expressions yet. See DERBY-883 for details. \r\n\r\n\r\nI am wondering if VerifyAggregateExpressionsVisitor  is even the right place to check if the group by expression is a function.\r\nIt seems to know only about the select columns. Maybe we should be checking elsewhere entirely.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-04-28T23:22:51.509+0000","updated":"2008-04-28T23:22:51.509+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394939/comment/12592938","id":"12592938","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is an experimental patch for this issue.  I have not run tests or added regression tests yet, but it passes for the repro and disallows group by function as expected I believe.  I moved the check to GroupByNode.bindStatement() where I could check the node type of the group by expression. Please let me know if this approach looks ok.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-04-29T02:36:01.470+0000","updated":"2008-04-29T02:36:01.470+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394939/comment/12592939","id":"12592939","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"GroupByNode.bindStatement() definitely seems like a natural\r\nand appropriate location for this sort of check. \r\n\r\nThanks for working on this problem, Kathey!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-04-29T02:47:45.607+0000","updated":"2008-04-29T02:47:45.607+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12394939/comment/12593163","id":"12593163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is a patch for this issue. derbyall and suites.All ran fine except for some strange network server timeouts that don't seem to be related to this change as I get them without my changes as well.  \r\n\r\nI saw one file merge on svn update so I will rerun tests, but this patch is ready for review.\r\n\r\nMoves the check for routine in group by expression from VerifyAggregateExpressionsVistor to GroupByList.bindGroupByColumns.\r\n\r\nKathey\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-04-29T23:11:23.957+0000","updated":"2008-04-29T23:11:23.957+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3649/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06qvr:"}}