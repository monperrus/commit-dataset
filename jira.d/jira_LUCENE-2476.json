{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12465384","self":"https://issues.apache.org/jira/rest/api/latest/issue/12465384","key":"LUCENE-2476","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314799","id":"12314799","description":"Bugfixes of 2.9.2","name":"2.9.3","archived":false,"released":true,"releaseDate":"2010-06-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314798","id":"12314798","description":"Bugfixes for 3.0.1","name":"3.0.2","archived":false,"released":true,"releaseDate":"2010-06-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314822","id":"12314822","description":"Major release after 3.x","name":"3.1","archived":false,"released":true,"releaseDate":"2011-03-31"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314025","id":"12314025","description":"Alpha release of the 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-05-25 15:37:28.6","customfield_12312323":null,"customfield_12310420":"11344","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3404305_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-05-25T16:25:30.494+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-2476/watchers","watchCount":1,"isWatching":false},"created":"2010-05-25T15:28:46.189+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314401","id":"12314401","description":"Bugfixes for 3.0","name":"3.0.1","archived":false,"released":true,"releaseDate":"2010-02-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-06-18T08:04:08.941+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310236","id":"12310236","name":"core/store","description":"issues with store code (e.g. Directory)"}],"timeoriginalestimate":null,"description":"Constructor of IndexWriter let's runtime exceptions pop up, while keeping the writeLock obtained.\r\n\r\nThe init method in IndexWriter catches IOException only (I got NegativeArraySize by reading up a _corrupt_ index), and now, there is no way to recover, since the writeLock will be kept obtained. Moreover, I don't have IndexWriter instance either, to \"grab\" the lock somehow, since the init() method is called from IndexWriter constructor.\r\n\r\nEither broaden the catch to all exceptions, or at least provide some circumvention to clear up. In my case, I'd like to \"fallback\", just delete the corrupted index from disk and recreate it, but it is impossible, since the LOCK_HELD NativeFSLockFactory's entry about obtained WriteLock is _never_ cleaned out and is no (at least apparent) way to clean it out forcibly. I can't create new IndexWriter, since it will always fail with LockObtainFailedException.","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10121","value":"New","id":"10121"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"25534","summary":"Constructor of IndexWriter let's runtime exceptions pop up, while keeping the writeLock obtained","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":14,"total":14,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871200","id":"12871200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"Can you post here the full stacktrace?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2010-05-25T15:37:28.600+0000","updated":"2010-05-25T15:37:28.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871201","id":"12871201","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"I agree, we should fix this.  I'll change to a try/finally w/ a success boolean.\r\n\r\nYou can use IndexWriter#unlock to forcefully remove the lock, as a workaround.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2010-05-25T15:37:54.461+0000","updated":"2010-05-25T15:37:54.461+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871206","id":"12871206","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"body":"I tried both IndexWriter#unlock and Directory#cleanLock(IndexWriter.WRITE_LOCK_NAME) but non of those removed the entry from LOCK_HELD HashSet. It was unchanged.\r\n\r\nThe NativeFSLock#release() was returning false in both cases.\r\n\r\nSo, this is what I meant by \"provide some circumvention\", since up to now, I did not figure out any other means to remove the entry from LOCK_HELD. All of these did _not_ remove it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"created":"2010-05-25T15:44:56.070+0000","updated":"2010-05-25T15:44:56.070+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871207","id":"12871207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2010-05-25T15:44:57.703+0000","updated":"2010-05-25T15:44:57.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871217","id":"12871217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"bq. I tried both IndexWriter#unlock and Directory#cleanLock(IndexWriter.WRITE_LOCK_NAME) but non of those removed the entry from LOCK_HELD HashSet. It was unchanged.\r\n\r\nAhh, sorry, I think you are hitting LUCENE-2104.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2010-05-25T16:02:12.054+0000","updated":"2010-05-25T16:02:12.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871218","id":"12871218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"body":"Just to confirm this patch as fix.\r\n\r\nThe patch applied to 3.0.1 (I had to do it manually, since I believe this patch is against trunk, not 3.0.1) does fix my problem. The IndexWriter is now successfully recreated and my UT does recover just fine from corrupted indexes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"created":"2010-05-25T16:03:41.706+0000","updated":"2010-05-25T16:03:41.706+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871219","id":"12871219","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"body":"Yes, I do hit LUCENE-2104 at the same time... nice.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"created":"2010-05-25T16:05:13.285+0000","updated":"2010-05-25T16:05:13.285+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871220","id":"12871220","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"Out of curiosity - would you mind posting here the exception?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2010-05-25T16:07:18.999+0000","updated":"2010-05-25T16:07:18.999+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871224","id":"12871224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"body":"This is an UT, that 1st _copies_ a known (broken) Index files to a place, and than tries to use it. Naturally, it fails (since the index files are corrupted), and then it tries to _recreate_ the index files and recreate the index content, but it fails to obtain the write lock again. After patch above applied to 3.0.1, the UT does pass okay.\r\n\r\nThis is the stack trace I have with vanilla 3.0.1:\r\n\r\n{noformat}\r\norg.sonatype.timeline.TimelineException: Fail to configure timeline index!\r\n\tat org.sonatype.timeline.DefaultTimelineIndexer.configure(DefaultTimelineIndexer.java:106)\r\n\tat org.sonatype.timeline.DefaultTimeline.repairTimelineIndexer(DefaultTimeline.java:79)\r\n\tat org.sonatype.timeline.DefaultTimeline.configure(DefaultTimeline.java:60)\r\n\tat org.sonatype.timeline.TimelineTest.testRepairIndexCouldNotRead(TimelineTest.java:103)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat junit.framework.TestCase.runTest(TestCase.java:164)\r\n\tat junit.framework.TestCase.runBare(TestCase.java:130)\r\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\r\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\r\n\tat junit.framework.TestResult.run(TestResult.java:109)\r\n\tat junit.framework.TestCase.run(TestCase.java:120)\r\n\tat org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)\r\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)\r\nCaused by: org.apache.lucene.store.LockObtainFailedException: Lock obtain timed out: NativeFSLock@/Users/cstamas/worx/sonatype/spice/trunk/spice-timeline/target/index/write.lock\r\n\tat org.apache.lucene.store.Lock.obtain(Lock.java:84)\r\n\tat org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1045)\r\n\tat org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:868)\r\n\tat org.sonatype.timeline.DefaultTimelineIndexer.configure(DefaultTimelineIndexer.java:99)\r\n\t... 19 more\r\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"created":"2010-05-25T16:13:09.995+0000","updated":"2010-05-25T16:13:09.995+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871226","id":"12871226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"bq. The patch applied to 3.0.1 (I had to do it manually, since I believe this patch is against trunk, not 3.0.1) does fix my problem. The IndexWriter is now successfully recreated and my UT does recover just fine from corrupted indexes.\r\n\r\nOK thanks for confirming -- I'll backport to 3.0.x as well.\r\n\r\n(Yes patch is against trunk).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2010-05-25T16:14:11.340+0000","updated":"2010-05-25T16:14:11.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871227","id":"12871227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"bq. The patch applied to 3.0.1 (I had to do it manually, since I believe this patch is against trunk, not 3.0.1) does fix my problem. The IndexWriter is now successfully recreated and my UT does recover just fine from corrupted indexes.\r\n\r\nOK thanks for confirming -- I'll backport to 3.0.x as well.\r\n\r\n(Yes patch is against trunk).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2010-05-25T16:17:22.126+0000","updated":"2010-05-25T16:17:22.126+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871230","id":"12871230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"This exception shows a LockObtainFailed exception - can you post the one that resulted in NegativeArraySize -- curious to know where you hit it, and what sort of corruption yields to that :).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2010-05-25T16:19:32.901+0000","updated":"2010-05-25T16:19:32.901+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12871236","id":"12871236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"body":"This is a Lucene index _known_ to be corrupt (got from a \"live\" Nexus or just \"breaking\" it manually by tampering with hex editor, not remember anymore). The Lucene used to create this index is 2.3.2, so during this UT I believe an index upgrade happens too.\r\n\r\n{noformat}\r\n[INFO] Failed to configure timeline index, trying to repair it.\r\norg.sonatype.timeline.TimelineException: Fail to configure timeline index!\r\n\tat org.sonatype.timeline.DefaultTimelineIndexer.configure(DefaultTimelineIndexer.java:107)\r\n\tat org.sonatype.timeline.DefaultTimeline.configure(DefaultTimeline.java:49)\r\n\tat org.sonatype.timeline.TimelineTest.testRepairIndexCouldNotRead(TimelineTest.java:103)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat junit.framework.TestCase.runTest(TestCase.java:164)\r\n\tat junit.framework.TestCase.runBare(TestCase.java:130)\r\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\r\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\r\n\tat junit.framework.TestResult.run(TestResult.java:109)\r\n\tat junit.framework.TestCase.run(TestCase.java:120)\r\n\tat org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)\r\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)\r\nCaused by: java.lang.NegativeArraySizeException\r\n\tat org.apache.lucene.store.IndexInput.readString(IndexInput.java:126)\r\n\tat org.apache.lucene.index.SegmentInfo.<init>(SegmentInfo.java:173)\r\n\tat org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:258)\r\n\tat org.apache.lucene.index.SegmentInfos$1.doBody(SegmentInfos.java:312)\r\n\tat org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:677)\r\n\tat org.apache.lucene.index.SegmentInfos$FindSegmentsFile.run(SegmentInfos.java:521)\r\n\tat org.apache.lucene.index.SegmentInfos.read(SegmentInfos.java:308)\r\n\tat org.apache.lucene.index.IndexWriter.init(IndexWriter.java:1076)\r\n\tat org.apache.lucene.index.IndexWriter.<init>(IndexWriter.java:868)\r\n\tat org.sonatype.timeline.DefaultTimelineIndexer.configure(DefaultTimelineIndexer.java:100)\r\n\t... 18 more\r\n{noformat}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cstamas","name":"cstamas","emailAddress":"tamas at cservenak dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=cstamas&avatarId=19622","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cstamas&avatarId=19622","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cstamas&avatarId=19622","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cstamas&avatarId=19622"},"displayName":"Cservenak, Tamas","active":true},"created":"2010-05-25T16:39:27.094+0000","updated":"2010-05-25T16:39:27.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465384/comment/12873409","id":"12873409","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Merged to 2.9 revision: 949507\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2010-05-30T12:13:44.961+0000","updated":"2010-05-30T12:13:44.961+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-2476/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i04qcn:"}}