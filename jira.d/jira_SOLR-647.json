{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12400811","self":"https://issues.apache.org/jira/rest/api/latest/issue/12400811","key":"SOLR-647","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312486","id":"12312486","description":"","name":"1.3","archived":false,"released":true,"releaseDate":"2008-09-16"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-07-28 14:17:10.126","customfield_12312323":null,"customfield_12310420":"6966","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_2262934601_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-08-18T15:32:40.601+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-647/watchers","watchCount":1,"isWatching":false},"created":"2008-07-23T10:57:06.829+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"15.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312486","id":"12312486","description":"","name":"1.3","archived":false,"released":true,"releaseDate":"2008-09-16"}],"issuelinks":[{"id":"12321218","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12321218","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12394490","key":"SOLR-545","self":"https://issues.apache.org/jira/rest/api/2/issue/12394490","fields":{"summary":"remove MultiCore \"default\" core / cleanup DispatchHandler","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12321047","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12321047","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12395304","key":"SOLR-561","self":"https://issues.apache.org/jira/rest/api/2/issue/12395304","fields":{"summary":"Solr replication by Solr (for windows also)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png","name":"New Feature","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:40:31.034+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"The method _SolrCore.close()_ directly closes the core . It can cause Exceptions for in-flight requests. The _close()_ method should just do a decrement on refcount and the actual close must happen when the last request being processed by that core instance is completed","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"20542","summary":"Do SolrCore.close() in a refcounted way","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":46,"total":46,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12617434","id":"12617434","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"body":"Yonik, what do you feel about adding to to 1.3? Although it's immediate use is in SOLR-561 but it is still an unsafe existing API call.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"created":"2008-07-28T14:17:10.126+0000","updated":"2008-07-28T14:17:10.126+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12617435","id":"12617435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"I took a quick peek.... looks like there are probably race conditions.\r\nA core could be obtained in thread A, then decRef() could be called in thread B that triggers a real close, then incRef() would be called in thread A (oops).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-07-28T14:29:13.226+0000","updated":"2008-07-28T14:29:13.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12617760","id":"12617760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"body":"I hope this fixes the race condition ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"created":"2008-07-29T10:24:25.711+0000","updated":"2008-07-29T10:24:25.711+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12620276","id":"12620276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Looking at both versions of the patch, it seems you did not upload the intended one..","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-06T15:08:25.314+0000","updated":"2008-08-06T17:13:47.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12620331","id":"12620331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Being hit by the same core issue swapping/closing cores, here is another take at it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-06T17:27:08.558+0000","updated":"2008-08-06T17:27:08.558+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12620416","id":"12620416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"Quick glance suggests it needs unit tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2008-08-06T20:27:30.787+0000","updated":"2008-08-06T20:27:30.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12620441","id":"12620441","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Will do (tomorrow); might be the opportunity to align EmbeddedSolrServer & SolrDispatchFilter behaviors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-06T21:55:15.907+0000","updated":"2008-08-06T21:55:15.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12620572","id":"12620572","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"A few modifications to make things (hopefully) a little clearer & tests (single & multi threaded).\r\nThis new patch version solely deals with reference counting implementation (not its usage).\r\nSolrDispatchFilter/EmbeddedSolrServer should be patched through solr-545.\r\nCoreDescriptor (the reloadCore() method) might be better patched through solr-561 (this is easy to reintroduce if needed though).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-07T09:43:17.387+0000","updated":"2008-08-07T09:43:17.387+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12620764","id":"12620764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Hopefully last version of it.\r\nI goofed the MT test on the previous one.\r\nRe-added CoreDescriptor.reloadCore().\r\nNote that the same code is included in solr-545.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-07T21:53:25.933+0000","updated":"2008-08-07T21:53:25.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12620997","id":"12620997","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"new version based on Yonik's comment in solr-545.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-08T18:07:35.400+0000","updated":"2008-08-08T18:07:35.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621597","id":"12621597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"This doesn't compile.  The TimeUnit.MINUTES in SolrCoreTest is a 1.6 constant.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2008-08-11T20:57:45.575+0000","updated":"2008-08-11T20:57:45.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621598","id":"12621598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"But, I changed it to awaitTermination(60, TimeUnit.SECONDS) and that's just fine...  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2008-08-11T20:58:58.028+0000","updated":"2008-08-11T20:58:58.028+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621629","id":"12621629","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"fixed 1.6 dependency (sorry & thanks Grant);\r\nupdated to trunk;\r\nfixed a bug in SolrDispatchFilter (Multicore.getAdminCore can return a null core);\r\nintroduced calls to acquire/release instead and modified EmbeddedSolrServer (for completeness).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-11T22:08:39.012+0000","updated":"2008-08-11T22:08:39.012+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621812","id":"12621812","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"I'd like to see some more documentation on this.  Namely, when should SolrCore.Reference be used, etc.  This may just be for my own edification.  For instance, what's the relationship in MultiCore between getCore and acquireCore and openCore?  (Since openCore just calls acquireCore w/ a null reference, we probably should just call it acquireCore as well.)\r\n\r\nAlso, when do would I call Reference.release() versus core.close()?\r\n\r\nHow does CoreDescriptor.reloadCore factor in?   I don't see that it is used.  Why would I call that instead of MultiCore.reload()?\r\n\r\nPart of these questions may just be bigger questions related to Multicore all together.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2008-08-12T13:23:30.089+0000","updated":"2008-08-12T13:23:30.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621817","id":"12621817","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"body":"bq.How does CoreDescriptor.reloadCore factor in? I don't see that it is used. Why would I call that instead of MultiCore.reload()?\r\n\r\nHow else can I reload the core in a single core deployment?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"created":"2008-08-12T13:47:49.011+0000","updated":"2008-08-12T13:47:49.011+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621837","id":"12621837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"\r\nGrant;\r\ngetCore() does not protect the core from being closed by another thread (it must either be protected by another mean or earlier or it does not matter).\r\n\r\nFor the other cases, calls should be used in pairs with the following convention; if you call an \"open\", you should call a \"close\", if you call an \"acquire\", you should call a \"release\".\r\n\r\nopenCore()/openAdminCore() do protect from the core from a // close and core.close() should be used to decrease the refcount.\r\nacquireCore()/acquireAdminCore() use a SolrCore.Reference and decreasing the refcount should be done through the ref via ref.release().\r\n\r\nThe only difference between openCore()/close() or acquireCore()/release() is the usage of a reference which is just a convenience (at least to me: avoiding to test for null, assigning to final, etc).\r\n\r\nHope this makes sense.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-12T14:47:37.542+0000","updated":"2008-08-12T14:47:37.542+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621849","id":"12621849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"{quote}\r\nHow else can I reload the core in a single core deployment?\r\n{quote}\r\n\r\nIn email, I said, \"OK, I'll buy that, maybe I just don't get Multicore/Single Core relationship.  Also, reload is not used anywhere and we've never had the notion of reloading in the single core case, AFAICT.\"\r\n\r\nBut, thinking about it some more, I guess I don't.  The descriptor up until this patch, was merely a container for storing core information, hence the name.  Now all of a sudden it has reload capabilities (but, it doesn't have open/close capabilities to go with it) so it just doesn't fit in my mind.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2008-08-12T15:12:17.733+0000","updated":"2008-08-12T15:12:17.733+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621853","id":"12621853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"Henri,\r\n\r\nAt a minimum, all that should be documented, but I must admit to still being confused (but I'm no expert in the multicore stuff so, please bear with me)\r\n\r\n{quote}\r\ngetCore() does not protect the core from being closed by another thread (it must either be protected by another mean or earlier or it does not matter).\r\n{quote}\r\n\r\nYes, but there appears to be mixed uses, the MultiCoreHandler uses getCore() in places, while the SolrDispatchFilter uses the Reference.  Isn't it possible for the core to then be closed behind the MultiCoreHandler?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2008-08-12T15:32:16.980+0000","updated":"2008-08-12T15:32:16.980+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621867","id":"12621867","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Grant,\r\n\r\nbq.At a minimum, all that should be documented\r\n\r\nI'll adapt the previous comments accordingly to make the Javadoc more obvious.\r\n\r\nbq. the MultiCoreHandler uses getCore() in places, while the SolrDispatchFilter uses the Reference\r\n\r\nGood catch; the admin core (the one used to generate output) is protected but is this enough?\r\nThe MultiCoreHandler only deals with CoreDescriptor (not SolrCore); it does not perform \"real\" queries although getStatus comes close to it.\r\nHowever, it would seem preferable to avoid manipulating the (multicore) cores map while we are are processing such requests.\r\n\r\n I'll fix it in the next upload.\r\nThanks for reviewing this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-12T16:06:55.928+0000","updated":"2008-08-12T17:13:19.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621900","id":"12621900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"It seems like some simplifications could be made... see attached refcount_example.patch.\r\n\r\nI think we need to be able to describe in simple terms how the mechanism works:\r\nCores are created with a reference count of 1 and put in multicore.  As long as a core can\r\nbe obtained from the map, it will have at least a reference count of 1.  Thus, if we increment the core's reference during a time when we know that no other core is modifying multicore, we know we have a core that is safe from being asynchronously closed.\r\n\r\nTo destroy a core, simply remove it from the map and call close on it.\r\n\r\nThere are other issues that are still a bit muddled IMO... like the whole role of CoreDescriptor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-12T17:49:19.359+0000","updated":"2008-08-12T17:49:19.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12621909","id":"12621909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"body":"This patch is very clear as to what it is doing (and simple). \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"created":"2008-08-12T18:07:57.479+0000","updated":"2008-08-12T18:07:57.479+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622568","id":"12622568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"My apologies to all for cluttering the issue. \r\n\r\nNew simplified version based on Yonik's example for trunk 685913 (post solr-695 commit), dont let the patch size fool you:\r\nCoreContainer.getCore() & CoreContainer.getAdminCore() now return an incref-ed (\"opened\") core;\r\ncore.close() must be called when these 2 have been used.\r\nSolrCore.Reference is gone.\r\n\r\nSolrCore.open() & SolrCore.close() method are kept because we can retrieve cores in 3 \"close-unprotected\" ways:\r\n1 - a call to CoreDescriptor.getCore(), descriptors that can be retrieved through CoreContainer.getCoreDescriptors())\r\n2 - a list of close-unprotected cores through CoreContainer.getCores().\r\n3 - SolrCore.getCore() - which is deprecated\r\nThe first 2 can be used in a user-defined filter/servlet after the SolrDispatchFilter falls through the filter-chain, the CoreContainer being\r\nset as an attribute of the request (\"org.apache.solr.CoreContainer\"). \r\n\r\nBecause of this, we are not always synchronized by the CoreContainer#cores when we incref/decref.\r\nWe can thus try to open() a core which is closed and cant use a simple refCount.incrementAndGet().\r\nThus the refCount.get()/refCount.compareAndSet() pattern in both open & close.\r\n\r\nThe TestHarness is modified to always create a CoreContainer that contains the \"unnamed\" core so testCoreMT uses\r\nCoreContainer.getCore(\"\").\r\nAlso touched some tests that were using SolrCore.getCore() when they can use the TestHarness core.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-14T14:40:33.475+0000","updated":"2008-08-14T14:40:33.475+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622575","id":"12622575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"body":"I fail to see the need for this code in SolrCore#close()\r\n{code:java}\r\n    int count;\r\n    do {\r\n      count = refCount.get();\r\n      if (count <= 0)\r\n        return;\r\n    } while (!refCount.compareAndSet(count, count - 1));\r\n{code}\r\n\r\nIf you do refCount.decrementAndGet() it should be fine. \r\n\r\nsimilarly in SolrCore$open() also\r\n\r\nyou can do a refCount.incrementAndGet() and will be fine. \r\nWhat you have written is a duplication of code in AtomicInteger\r\n\r\nEven the RefCounted class does increment and decrement in the same way\r\n\r\nYonik's patch does it simply and I do not see anything wrong with that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"created":"2008-08-14T15:21:15.470+0000","updated":"2008-08-14T15:36:44.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622579","id":"12622579","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Based on Ryan's comment, simplified the patch to strictly focus on the matter at hand.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-14T15:30:52.287+0000","updated":"2008-08-14T15:30:52.287+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622583","id":"12622583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"About the SolrCore.open() & close():\r\n\r\nIf we were to do an incrementAndGet(), we could end up opening a closed core;\r\nWe thus must check the refcount is not <=0 first.\r\nThe close could use a decrementAndGet() but the current code ensures the count will never go < 0 and is symmetrical to open.\r\nIn both cases, it is the test in between the get() & compareAndSet() that makes the whole difference with {in,de]crementAndGet.\r\n\r\nMy understanding of Yonik's version is that, as a premise, opening a core is always performed under the CoreContainer#cores synchronized protection; as I explained in a previous comment, the assumption can not be strictly met. \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-14T15:41:51.137+0000","updated":"2008-08-14T15:46:03.922+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622586","id":"12622586","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"bq. he close could use a decrementAndGet() but the current code ensures the count will never go < 0.\r\n\r\nI don't think we should cover this error case up since it could lead to premature closure in other cases.\r\nI think we should do a simple decrementAndGet() followed by a logged error if the current count is less than zero.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-14T15:48:14.853+0000","updated":"2008-08-14T15:48:14.853+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622592","id":"12622592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Yonik;\r\nAbout the close(), you're right: the refcount < 0 being an error, shouldn't we go all the way and throw a runtime exception ?\r\nAre you in agreement about open()?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-14T16:13:05.974+0000","updated":"2008-08-14T16:13:05.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622610","id":"12622610","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"updated to reflect Yonik's last suggestion.\r\nfixed test attempting to close closed core.\r\n(throwing an exception was useful for quick detection).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-14T17:18:31.949+0000","updated":"2008-08-14T17:18:31.949+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622613","id":"12622613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"bq. Are you in agreement about open()?\r\n\r\nYes, if cores obtained through other methods need to be open for some reason, then open() would need to be called.  I'm not sure if we have any cases like that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-14T17:26:41.695+0000","updated":"2008-08-14T17:26:41.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622614","id":"12622614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"body":"bq.About the close(), you're right: the refcount < 0 being an error, shouldn't we go all the way and throw a runtime exception ?\r\n refcount < 0 is an error . but should it throw an exception?  I am not too sure. logging a severe error should be fine. because that should not be a reason to crash a server\r\n\r\nbq.Are you in agreement about open()?\r\neven open() does not need a compareAndSet. just do a refCount.incrementAndget(). if count <=1 return null .because it is already closed or being closed .\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"created":"2008-08-14T17:31:25.054+0000","updated":"2008-08-14T17:31:25.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622618","id":"12622618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"bq. refcount < 0 is an error . but should it throw an exception? I am not too sure. logging a severe error should be fine. because that should not be a reason to crash a server\r\n\r\nRight... on one hand an exception brings more visibility, but on the other hand it's a recoverable error that's not necessarily tied to the request that would get the exception.\r\n\r\nbq. even open() does not need a compareAndSet. just do a refCount.incrementAndget(). if count <=1 return null .because it is already closed or being closed .\r\n\r\nAnd then if another thread calls open() at the same time, count will be 2 and it would incorrectly return a closing core.  If open() is needed, Henri has the right impl there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-14T17:37:51.499+0000","updated":"2008-08-14T17:37:51.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622628","id":"12622628","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=otis","name":"otis","emailAddress":"otis at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=otis&avatarId=15859","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=otis&avatarId=15859","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=otis&avatarId=15859","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=otis&avatarId=15859"},"displayName":"Otis Gospodnetic","active":true},"body":"bq. Right... on one hand an exception brings more visibility, but on the other hand it's a recoverable error that's not necessarily tied to the request that would get the exception.\r\n\r\nShould we then do:\r\nLOG.severe(\"XYZ happened.  Please report this problem on solr-user@lucene.apache.org\");\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=otis","name":"otis","emailAddress":"otis at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=otis&avatarId=15859","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=otis&avatarId=15859","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=otis&avatarId=15859","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=otis&avatarId=15859"},"displayName":"Otis Gospodnetic","active":true},"created":"2008-08-14T18:14:25.842+0000","updated":"2008-08-14T18:14:25.842+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622632","id":"12622632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"body":"The CoreContainer#create(CoreDescriptor dcore)  must close the old core after creating the new one","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"created":"2008-08-14T18:27:21.276+0000","updated":"2008-08-14T18:27:21.276+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12622735","id":"12622735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"bq. Yes, if cores obtained through other methods need to be open for some reason, then open() would need to be called.\r\nbq. I'm not sure if we have any cases like that.\r\nNo, we don't have any cases today. It could have been useful to someone implementing another filter or servlet.\r\nSince the same effect can be obtained with:\r\n{code}\r\nCoreDescriptor dcore;\r\nCoreContainer container;\r\n...\r\nSolrCore opened = container.getCore(dcore.getName());\r\n{code}\r\n\r\nopen() can just be incrementAndGet(). (finally!:-))\r\n\r\nbq.LOG.severe(\"XYZ happened. Please report this problem on solr-user@lucene.apache.org\")\r\nSeems to be the consensus; updated.\r\n\r\nbq.The CoreContainer#create(CoreDescriptor dcore) must close the old core after creating the new one \r\nCorrect, fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-14T23:20:41.514+0000","updated":"2008-08-14T23:20:41.514+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623000","id":"12623000","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"I'm thinking of changing the cores map to <String,SolrCore> (from <String,CoreDescriptor>)\r\nand removing getCore() from CoreDescriptor.  Thoughts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-15T19:48:35.761+0000","updated":"2008-08-15T19:48:35.761+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623001","id":"12623001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Also, is there any reason not to allow the same core to be registered more than once if desired?  It really seems like CoreContainer should just map from a String to a SolrCore and not worry about some of the other stuff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-15T19:53:23.883+0000","updated":"2008-08-15T19:53:23.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623003","id":"12623003","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"bq. I'm thinking of changing the cores map to <String,SolrCore> (from <String,CoreDescriptor>) and removing getCore() from CoreDescriptor. Thoughts? \r\n\r\nsince every core has a CoreDescriptor, this seems much cleaner then have the (existing) double link.\r\n\r\n\r\nbq. is there any reason not to allow the same core to be registered more than once if desired?\r\n\r\nsounds good.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2008-08-15T20:08:38.409+0000","updated":"2008-08-15T20:08:38.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623007","id":"12623007","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"FYI, I'm also overhauling some of the synchronization... the lock is held far too long in some cases (like reload when it's held the whole time a new core is being created).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-15T20:27:56.907+0000","updated":"2008-08-15T20:27:56.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623019","id":"12623019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Also, persistFile looks like it would take enough time that I'm going to change it to synchronize on a separate lock so it doesn't block requests in the meantime.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-15T20:54:51.651+0000","updated":"2008-08-15T20:54:51.651+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623142","id":"12623142","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Here's an updated patch:\r\n- cores is a Map<String,SolrCore>\r\n- no prohibition of adding a SolrCore to the CoreContainer multiple times (to be able to access it from multiple URLs, for back compatible migration for example)\r\n\r\nI was going to remove the SolrCore name altogether.... but things like JMX and logging use it.\r\nThat's a weakness in both the way multicore worked (core swap wouldn't swap JMX) and the current patch (core name is independent of how it's mapped via CoreContainer).\r\n\r\nOne resolution would be to have a callback on SolrCore whenever it's name is changed, so JMX and logging strings could be appropriately adjusted.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-16T16:50:08.627+0000","updated":"2008-08-16T16:50:08.627+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623173","id":"12623173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"bq. I was going to remove the SolrCore name altogether.... but things like JMX and logging use it.\r\n\r\nCan we remove it and always access the name via the CoreDescriptor?  Having a name on the core made sense before we added the descriptor...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2008-08-17T01:07:59.907+0000","updated":"2008-08-17T01:07:59.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623190","id":"12623190","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Here's a slight update:\r\n- removes the SolrCore finalizer to prevent too many closes exception (we could do a refcount check too)\r\n- calls SolrCore.setName() when a core is added or renamed in the CoreContainer (it was just too wierd to do a core swap and not have the names change).  This does not affect JMX.\r\n\r\nI was going to remove the SolrCore name altogether.... but things like JMX and logging use it.\r\n\r\nbq. Can we remove it and always access the name via the CoreDescriptor? Having a name on the core made sense before we added the descriptor...\r\n\r\nIf we did want to change JMX or other things on a name change, it seems like the call needs to be on the SolrCore.  Currently this does change the logging string too (probably good for avoiding confusion on a core swap)\r\n\r\nUnless there are objections, I think this is close enough to commit soon and then propose smaller patches off of trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-17T13:22:54.117+0000","updated":"2008-08-17T13:22:54.117+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623201","id":"12623201","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"body":"bq. Also, is there any reason not to allow the same core to be registered more than once if desired? \r\n\r\nHow will SolrCore#getCoreDescriptor() work. what will it return?\r\n\r\nshould the getCore() have synchronized block? \r\n\r\ncan we manage with a ConcurrentHashMap? A lock to be obtained per request looks like too much of a price . The only problem with concurrent map is that if you remove while an iteration is going on you may get an exception (correct me if I am wrong). If we can have a separate lock for just that we can have synchronization only in those places and we can spare the getCore()\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=noble.paul","name":"noble.paul","emailAddress":"noble dot paul at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=noble.paul&avatarId=18547","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=noble.paul&avatarId=18547","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=noble.paul&avatarId=18547","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=noble.paul&avatarId=18547"},"displayName":"Noble Paul","active":true},"created":"2008-08-17T15:56:30.397+0000","updated":"2008-08-17T15:56:30.397+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623204","id":"12623204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"body":"Small err that  would affect reload() in CoreContainer.register, ~line 261, it seems this should be:\r\n{code}\r\nlog.info( \"replacing core: \"+name );\r\nif (!returnPrev) {\r\n        old.close(); // not core.close()\r\n}\r\n{code}\r\n\r\nHarmless, the \"alias\" attribute feature is folded into \"name\" so:\r\n{code}\r\nString aliasesStr = DOMUtil.getAttr(node, \"aliases\", null);\r\n{code}\r\ncan go.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=henrib","name":"henrib","emailAddress":"henrib at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Henri Biestro","active":true},"created":"2008-08-17T16:27:44.508+0000","updated":"2008-08-17T16:34:22.191+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623379","id":"12623379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"bq. How will SolrCore#getCoreDescriptor() work. what will it return?\r\n\r\nThe original core descriptor (the original name).\r\n\r\nbq. should the getCore() have synchronized block?\r\n\r\nCoreContainer.getCore() does.\r\nI removed CoreDescriptor.getCore()\r\n\r\nbq. can we manage with a ConcurrentHashMap? A lock to be obtained per request looks like too much of a price .\r\n\r\nIt could be reworked in the future, but a single synchronized map lookup per top-level request is certainly nothing to worry about - there are probably at least hundreds of synchronized calls per average request.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-18T15:30:11.444+0000","updated":"2008-08-18T15:30:11.444+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12400811/comment/12623380","id":"12623380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"I've committed this patch.\r\nThere is probably some more multicore work to be done, but they can get their own issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-08-18T15:32:40.559+0000","updated":"2008-08-18T15:32:40.559+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-647/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03vjb:"}}