{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12348100","self":"https://issues.apache.org/jira/rest/api/latest/issue/12348100","key":"DERBY-1707","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-09-12 11:54:44.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22653","customfield_12310222":"1_*:*_1_*:*_3187288000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_38585756432","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-09-22T18:49:14.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1707/watchers","watchCount":1,"isWatching":false},"created":"2006-08-16T21:27:46.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-12-13T09:05:10.430+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"After we get the NPE, any other operation gives:\nERROR 40XT0: An internal error was identified by RawStore module.\n\nSpecifying constraint=null as an optimizer override is actually a usage error. I tried this thinking it is allowed like index=null which can be used to force a table scan. But specifying constraint=null gives a NPE and other operations give the above error. I am attaching a repro 'illegal_overrides.sql'. \n\nFound this when testing with 10.2.1.0 beta. Stack traces below:\n\nij> --- specifying null value for constraint gives NPE\nSELECT * FROM t1 --DERBY-PROPERTIES constraint=null\n;\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\njava.lang.NullPointerException\n        at org.apache.derby.impl.sql.compile.FromBaseTable.verifyProperties(Unknown Source)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.verifyProperties(Unknown Source)\n        at org.apache.derby.impl.sql.compile.FromList.verifyProperties(Unknown Source)\n        at org.apache.derby.impl.sql.compile.OptimizerImpl.<init>(Unknown Source)\n        at org.apache.derby.impl.sql.compile.Level2OptimizerImpl.<init>(Unknown Source)\n        at org.apache.derby.impl.sql.compile.Level2OptimizerFactoryImpl.getOptimizerImpl(Unknown Sou\nrce)\n        at org.apache.derby.impl.sql.compile.OptimizerFactoryImpl.getOptimizer(Unknown Source)\n        at org.apache.derby.impl.sql.compile.ResultSetNode.getOptimizer(Unknown Source)\n        at org.apache.derby.impl.sql.compile.SelectNode.optimize(Unknown Source)\n        at org.apache.derby.impl.sql.compile.DMLStatementNode.optimize(Unknown Source)\n        at org.apache.derby.impl.sql.compile.CursorNode.optimize(Unknown Source)\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\n        at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(\nUnknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main.go(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source)\n        at org.apache.derby.tools.ij.main(Unknown Source)\nij> --- something goes wrong in validation of properties after we get the NPE\nSELECT * FROM t1 --DERBY-PROPERTIES constrant=cons1\n;\nERROR 40XT0: An internal error was identified by RawStore module.\nERROR 40XT0: An internal error was identified by RawStore module.\n        at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n        at org.apache.derby.impl.store.raw.xact.Xact.setActiveState(Unknown Source)\n        at org.apache.derby.impl.store.raw.xact.Xact.openContainer(Unknown Source)\n        at org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(Unknown Source)\n        at org.apache.derby.impl.store.access.heap.Heap.open(Unknown Source)\n        at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(Unknown Source)\n        at org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getDescriptorViaIndex(Unknown Source\n)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.locateSchemaRow(Unknown Source)\n        at org.apache.derby.impl.sql.catalog.DataDictionaryImpl.getSchemaDescriptor(Unknown Source)\n        at org.apache.derby.impl.sql.compile.QueryTreeNode.getSchemaDescriptor(Unknown Source)\n        at org.apache.derby.impl.sql.compile.QueryTreeNode.getSchemaDescriptor(Unknown Source)\n        at org.apache.derby.impl.sql.compile.FromBaseTable.bindTableDescriptor(Unknown Source)\n        at org.apache.derby.impl.sql.compile.FromBaseTable.bindNonVTITables(Unknown Source)\n        at org.apache.derby.impl.sql.compile.FromList.bindTables(Unknown Source)\n        at org.apache.derby.impl.sql.compile.SelectNode.bindNonVTITables(Unknown Source)\n        at org.apache.derby.impl.sql.compile.DMLStatementNode.bindTables(Unknown Source)\n        at org.apache.derby.impl.sql.compile.DMLStatementNode.bind(Unknown Source)\n        at org.apache.derby.impl.sql.compile.CursorNode.bind(Unknown Source)\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\n        at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(\nUnknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)\n        at org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main.go(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)\n        at org.apache.derby.impl.tools.ij.Main14.main(Unknown Source)\n        at org.apache.derby.tools.ij.main(Unknown Source)\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39659","summary":"Specifying an incorrect optimizer property (constraint=null) gives NullPointerException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348100/comment/12434129","id":"12434129","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I have a patch for this Jira entry which is very trivial. Basically, FromBaseTable.verifyProperties method had following if condition\r\n\r\n  if (constraintSpecified)\r\n  {\r\n   ConglomerateDescriptor cd = \r\n    dDictionary.getConglomerateDescriptor(\r\n     consDesc.getConglomerateId());\r\n   String indexName = cd.getConglomerateName();\r\n   tableProperties.remove(\"constraint\");\r\n   tableProperties.put(\"index\", indexName);\r\n  }\r\n\r\n\r\nThe if condition above did not do null check for consDesc. In Sunitha's case, her sql statement looked as follows\r\nSELECT * FROM t1 --DERBY-PROPERTIES constraint=null \r\n;\r\nWhen null value is supplied for constraint property, consDesc will be null and the code inside the if condition above should not be executed. I changed the if condition above as follows\r\n  if (constraintSpecified && consDesc != null)\r\nand now constraint=nulll does not result in null pointer exception. I added a test case for this in lang/optimizerOverrides.sql and noticed that constraint=null resulted in an index scan. There is already a test which checks for index=null and that property results in a table scan. This behavior seems to be in line with the documentation in Tuning Derby Guide for 10.2 (section name Overriding the default optimizer behavior) which says that if null is specified for property index, a table scan will be performed on the table. It does not say anything about a table scan for constraint=null\r\n \r\nThe files affected by this change are as follows\r\nM      java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\FromBaseTable.java\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\lang\\optimizerOverrides.sql\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\optimizerOverrides.out\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\optimizerOverrides.out\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNetClient\\optimizerOverrides.out\r\n\r\nThe patch is attached as DERBY1707ConstraintNullPropertyV1diff.txt\r\n\r\nPlease review the patch and commit it if it looks ready.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-09-12T11:54:44.000+0000","updated":"2006-09-12T11:54:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348100/comment/12434439","id":"12434439","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"derbyall test suite ran fine with the proposed changes on Windows XP with Sun's jdk14.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-09-13T13:21:12.000+0000","updated":"2006-09-13T13:21:12.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348100/comment/12435282","id":"12435282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I reviewed the simple patch, ran full set of successful tests against ibm142 jvm and committed the \r\nDERBY1707ConstraintNullPropertyV1diff.txt patch to the trunk.  This should get merged into 10.2.\r\n\r\nm3_142:160>svn commit\r\n\r\nSending        java\\engine\\org\\apache\\derby\\impl\\sql\\compile\\FromBaseTable.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNet\\optimizerOverrides.out\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\DerbyNetClient\\optimizerOverrides.out\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\optimizerOverrides.out\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\lang\\optimizerOverrides.sql\r\nTransmitting file data .....\r\nCommitted revision 447011.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-09-17T03:57:08.000+0000","updated":"2006-09-17T03:57:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348100/comment/12436967","id":"12436967","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Marking resolved, merged to 10.2 with revision 448961.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-09-22T18:49:14.000+0000","updated":"2006-09-22T18:49:14.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348100/comment/12551401","id":"12551401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"This issue has been resolved for over a year with no further movement. Closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2007-12-13T09:05:10.429+0000","updated":"2007-12-13T09:05:10.429+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1707/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i075if:"}}