{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12544095","self":"https://issues.apache.org/jira/rest/api/latest/issue/12544095","key":"MAHOUT-985","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310751","id":"12310751","key":"MAHOUT","name":"Mahout","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310751&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310751&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310751&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310751&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13060","id":"13060","description":"Apache Mahout","name":"Mahout"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320153","id":"12320153","description":"The release will stabilize core components, improve performances and adds new streaming algorithms. Unmaintained code is getting killed as part of this","name":"0.8","archived":false,"released":true,"releaseDate":"2013-07-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-02-26 02:09:02.143","customfield_12312323":null,"customfield_12310420":"229333","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_10228841743_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-06-22T11:58:14.774+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-985/watchers","watchCount":2,"isWatching":false},"created":"2012-02-25T02:37:33.170+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":["Arff"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315255","id":"12315255","description":"","name":"0.5","archived":false,"released":true,"releaseDate":"2011-05-27"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srowen","name":"srowen","emailAddress":"srowen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srowen&avatarId=10104","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srowen&avatarId=10104","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srowen&avatarId=10104","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srowen&avatarId=10104"},"displayName":"Sean Owen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-02-03T08:05:58.090+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313154","id":"12313154","name":"Integration"}],"timeoriginalestimate":null,"description":"When parsing an Arff file that contain instance-specific weights, MapBackedArffModel throws the following NPE exception. While I have only tested this in 0.5, I suspect this bug also occur in 0.6\r\n\r\nException in thread \"main\" java.lang.NullPointerException\r\n        at org.apache.mahout.utils.vectors.arff.MapBackedARFFModel.getValue(MapBackedARFFModel.java:87)\r\n        at org.apache.mahout.utils.vectors.arff.ARFFIterator.computeNext(ARFFIterator.java:75)\r\n        at org.apache.mahout.utils.vectors.arff.ARFFIterator.computeNext(ARFFIterator.java:30)\r\n        at com.google.common.collect.AbstractIterator.tryToComputeNext(AbstractIterator.java:136)\r\n        at com.google.common.collect.AbstractIterator.hasNext(AbstractIterator.java:131)\r\n        at org.apache.mahout.utils.vectors.io.SequenceFileVectorWriter.write(SequenceFileVectorWriter.java:43)\r\n        at org.apache.mahout.utils.vectors.arff.Driver.writeFile(Driver.java:159)\r\n        at org.apache.mahout.utils.vectors.arff.Driver.main(Driver.java:127)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.apache.hadoop.util.ProgramDriver$ProgramDescription.invoke(ProgramDriver.java:68)\r\n        at org.apache.hadoop.util.ProgramDriver.driver(ProgramDriver.java:139)\r\n        at org.apache.mahout.driver.MahoutDriver.main(MahoutDriver.java:187)\r\n\r\nThe code works properly when all instance weights are set to the default value of 1. However when any instance has a non-default weight, such as in the sample Arff file below, the NPE occurs when MapBackedArffModel attempts to parse line 8. \r\n\r\n-----\r\n@relation 'Test Mahout'\r\n\r\n@attribute Attr0 numeric\r\n@attribute Label {True,False}\r\n\r\n@data\r\n0,False\r\n1,True,{2}\r\n-----\r\n\r\nThe reason is that in Weka, all data instances are assumed to have a default weight of 1 and this default weight is not saved in the Arff file. However when a data instance DOES NOT have the default weight of 1, the non-default instance weight is appended at the end of the line surrounded by curly braces. When MapBackedArffModel.getValue method tries to parse this weight as an attribute, typeMap.get(idx) returns a null ARFFtype as there is no such attribute, which results in an NPE. \r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"22438","summary":"MapBackedArffModel Unable To Parse ARFF Files Containing Instance Weights","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davekor","name":"davekor","emailAddress":"davekor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Kor","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davekor","name":"davekor","emailAddress":"davekor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Kor","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544095/comment/13216614","id":"13216614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joekumar","name":"joekumar","emailAddress":"joekumar at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=joekumar&avatarId=12144","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=joekumar&avatarId=12144","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=joekumar&avatarId=12144","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=joekumar&avatarId=12144"},"displayName":"Joe Prasanna Kumar","active":true},"body":"Dave,\r\n\r\nI am trying to understand the implication of weights when we convert an ARFF to one of the mahout vectors. Should we normalize the vector values when there is a weight specified for an instance ? In Weka, When you add weights to an instance, how does it influence the actual instance values ? \r\nDepending on the usage of weight on ARFF instances, we can handle the situation in mahout. Please let me know your thoughts.\r\n\r\nJoe. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joekumar","name":"joekumar","emailAddress":"joekumar at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=joekumar&avatarId=12144","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=joekumar&avatarId=12144","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=joekumar&avatarId=12144","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=joekumar&avatarId=12144"},"displayName":"Joe Prasanna Kumar","active":true},"created":"2012-02-26T02:09:02.143+0000","updated":"2012-02-26T02:09:02.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544095/comment/13216709","id":"13216709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davekor","name":"davekor","emailAddress":"davekor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Kor","active":true},"body":"This is best answered from a machine learning perspective. Instance weights are used for quite a wide variety of ML related tasks and that is why Weka supports it. Examples include:\r\n\r\n(A) Resampling Datasets\r\nSometimes, there is a need to get the machine learning algorithm to focus on specific parts of the dataset. For example, when the dataset is imbalanced and the class label you are interested is swamped by a huge number of uninteresting instances (in other words, the proverbial needle in a haystack problem). Most techniques for handling such cases involve some form of careful resampling, either boosting the weightage of instances that have the desired class label, or down-weighting the unwanted instances, or both.\r\n\r\n(B) Smoothing or Regularization (See http://en.wikipedia.org/wiki/Regularization_(mathematics) )\r\nSome methods of Bayesian learning often take into consideration the prior distribution of labels when training a model and the simpler ways of introducing a prior is apply them as instance weights. Algorithms that can make use of instance weights include Naive Bayes, K-Means, Logistic Regression, Expectation Maximization/Gradient Descent/Conjugate Gradient, Nearest Neighbor, AdaBoost and many more. \r\n\r\nThese are the two main uses of instance weighting I can remember off the top of my mind. I'm sure there are a few more uses that I have missed out. As to how the weights are used, it is different from algorithm to algorithm and not all algorithms will make use of instance weights. In Weka, the algorithms that to take advantage of instance weights all implement weka.core.WeightedInstanceHandler. Weka algorithms that do not implement WeightedInstanceHandler simply assume the weights don't exist. For your reference, you can see the list of algorithms at http://weka.sourceforge.net/doc.dev/weka/core/WeightedInstancesHandler.html\r\n\r\nAs for Mahout, I am really not in a position to say as I have only started evaluating Mahout this week. The easy way out is simply to make sure MapBackedArffModel is able to successfully parse Arff files that contain weights and throw these weights away. However, it would be good if the weights can be passed on to Mahout's algorithms and let them have a chance to use the weights if the algorithm so desires. \r\n\r\nI hope this helps.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davekor","name":"davekor","emailAddress":"davekor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dave Kor","active":true},"created":"2012-02-26T12:18:29.700+0000","updated":"2012-02-26T12:18:29.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544095/comment/13217883","id":"13217883","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joekumar","name":"joekumar","emailAddress":"joekumar at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=joekumar&avatarId=12144","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=joekumar&avatarId=12144","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=joekumar&avatarId=12144","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=joekumar&avatarId=12144"},"displayName":"Joe Prasanna Kumar","active":true},"body":"Since the DenseVector and RandomAccessSparseVector dont have weight attributes, we'll currently discard the weights in ARFF files. This patch contains code to discard the weights specified for instances in ARFF files. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joekumar","name":"joekumar","emailAddress":"joekumar at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=joekumar&avatarId=12144","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=joekumar&avatarId=12144","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=joekumar&avatarId=12144","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=joekumar&avatarId=12144"},"displayName":"Joe Prasanna Kumar","active":true},"created":"2012-02-28T04:27:42.958+0000","updated":"2012-02-28T04:27:42.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544095/comment/13399274","id":"13399274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srowen","name":"srowen","emailAddress":"srowen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srowen&avatarId=10104","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srowen&avatarId=10104","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srowen&avatarId=10104","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srowen&avatarId=10104"},"displayName":"Sean Owen","active":true},"body":"I want to commit this. It seems to fail in the dense vector case. I'm guessing that, in that case, the 'split' items need to be trimmed, and need to be checked for \"?\", right?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srowen","name":"srowen","emailAddress":"srowen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srowen&avatarId=10104","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srowen&avatarId=10104","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srowen&avatarId=10104","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srowen&avatarId=10104"},"displayName":"Sean Owen","active":true},"created":"2012-06-22T11:52:52.820+0000","updated":"2012-06-22T11:52:52.820+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12544095/comment/13399369","id":"13399369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #1556 (See [https://builds.apache.org/job/Mahout-Quality/1556/])\r\n    MAHOUT-985 ignore ARFF instance weights, handle ? correctly (Revision 1352857)\r\n\r\n     Result = SUCCESS\r\nsrowen : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1352857\r\nFiles : \r\n* /mahout/trunk/integration/src/main/java/org/apache/mahout/utils/vectors/arff/ARFFIterator.java\r\n* /mahout/trunk/integration/src/main/java/org/apache/mahout/utils/vectors/arff/ARFFModel.java\r\n* /mahout/trunk/integration/src/test/java/org/apache/mahout/utils/vectors/arff/ARFFVectorIterableTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2012-06-22T15:09:02.147+0000","updated":"2012-06-22T15:09:02.147+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-985/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0478n:"}}