{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12473494","self":"https://issues.apache.org/jira/rest/api/latest/issue/12473494","key":"CASSANDRA-1477","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315251","id":"12315251","description":"","name":"0.7 beta 2","archived":false,"released":true,"releaseDate":"2010-10-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-09-09 12:27:02.45","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"10002_*:*_2_*:*_22179104_*|*_1_*:*_1_*:*_585336489_*|*_5_*:*_2_*:*_9534616_*|*_4_*:*_1_*:*_71645357","customfield_12310420":"20159","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-09-15T20:39:29.113+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1477/watchers","watchCount":0,"isWatching":false},"created":"2010-09-07T21:21:13.547+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-09-17T13:55:34.744+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"using 0.7 latest from trunk as of few minutes ago.  1 client, 1 node\r\n\r\ni have the scenario where i want to drop a column family and recreate it \r\n- unit testing for instance, is a good reason you may want to do this \r\n(always start fresh).\r\n\r\nthe problem i observe is that if i do the following:\r\n\r\n1 - drop the column family\r\n2 - recreate it\r\n3 - read data from a key that existed before dropping, but doesn't exist now\r\n\r\nif those steps happen fast enough, i will get the old row - definitely \r\nno good.\r\n\r\nif they happen slow enough, get_slice throws:\r\n\r\n\"org.apache.thrift.TApplicationException: Internal error processing \r\nget_slice\"\r\n\r\n.. and on the server i see:\r\n\r\n2010-09-07 13:53:48,086 ERROR \r\n[org.apache.cassandra.thrift.Cassandra$Processor] (pool-1-thread-4:) - \r\nInternal error processing get_slice\r\njava.lang.RuntimeException: java.util.concurrent.ExecutionException: \r\njava.io.IOError: java.io.FileNotFoundException: \r\ncassandra-data/data/Queues/test_1283892789285_Waiting-e-1-Data.db (No \r\nsuch file or directory)\r\n     at \r\norg.apache.cassandra.service.StorageProxy.weakRead(StorageProxy.java:275)\r\n     at \r\norg.apache.cassandra.service.StorageProxy.readProtocol(StorageProxy.java:218)\r\n     at \r\norg.apache.cassandra.thrift.CassandraServer.readColumnFamily(CassandraServer.java:114)\r\n     at \r\norg.apache.cassandra.thrift.CassandraServer.getSlice(CassandraServer.java:220)\r\n     at \r\norg.apache.cassandra.thrift.CassandraServer.multigetSliceInternal(CassandraServer.java:299)\r\n     at \r\norg.apache.cassandra.thrift.CassandraServer.get_slice(CassandraServer.java:260)\r\n     at \r\norg.apache.cassandra.thrift.Cassandra$Processor$get_slice.process(Cassandra.java:2795)\r\n     at \r\norg.apache.cassandra.thrift.Cassandra$Processor.process(Cassandra.java:2651)\r\n     at \r\norg.apache.cassandra.thrift.CustomTThreadPoolServer$WorkerProcess.run(CustomTThreadPoolServer.java:167)\r\n     at \r\njava.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n     at \r\njava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n     at java.lang.Thread.run(Thread.java:619)\r\nCaused by: java.util.concurrent.ExecutionException: java.io.IOError: \r\njava.io.FileNotFoundException: \r\ncassandra-data/data/Queues/test_1283892789285_Waiting-e-1-Data.db (No \r\nsuch file or directory)\r\n     at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)\r\n     at java.util.concurrent.FutureTask.get(FutureTask.java:83)\r\n     at \r\norg.apache.cassandra.service.StorageProxy.weakRead(StorageProxy.java:271)\r\n     ... 11 more\r\nCaused by: java.io.IOError: java.io.FileNotFoundException: \r\ncassandra-data/data/Queues/test_1283892789285_Waiting-e-1-Data.db (No \r\nsuch file or directory)\r\n     at \r\norg.apache.cassandra.io.util.BufferedSegmentedFile.getSegment(BufferedSegmentedFile.java:68)\r\n     at \r\norg.apache.cassandra.io.sstable.SSTableReader.getFileDataInput(SSTableReader.java:509)\r\n     at \r\norg.apache.cassandra.db.columniterator.SSTableSliceIterator.<init>(SSTableSliceIterator.java:49)\r\n     at \r\norg.apache.cassandra.db.filter.SliceQueryFilter.getSSTableColumnIterator(SliceQueryFilter.java:65)\r\n     at \r\norg.apache.cassandra.db.filter.QueryFilter.getSSTableColumnIterator(QueryFilter.java:76)\r\n     at \r\norg.apache.cassandra.db.ColumnFamilyStore.getTopLevelColumns(ColumnFamilyStore.java:961)\r\n     at \r\norg.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:856)\r\n     at \r\norg.apache.cassandra.db.ColumnFamilyStore.getColumnFamily(ColumnFamilyStore.java:826)\r\n     at org.apache.cassandra.db.Table.getRow(Table.java:321)\r\n     at \r\norg.apache.cassandra.db.SliceFromReadCommand.getRow(SliceFromReadCommand.java:63)\r\n     at \r\norg.apache.cassandra.service.StorageProxy$weakReadLocalCallable.call(StorageProxy.java:737)\r\n     at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\r\n     at java.util.concurrent.FutureTask.run(FutureTask.java:138)\r\n     ... 3 more\r\nCaused by: java.io.FileNotFoundException: \r\ncassandra-data/data/Queues/test_1283892789285_Waiting-e-1-Data.db (No \r\nsuch file or directory)\r\n     at java.io.RandomAccessFile.open(Native Method)\r\n     at java.io.RandomAccessFile.<init>(RandomAccessFile.java:212)\r\n     at java.io.RandomAccessFile.<init>(RandomAccessFile.java:98)\r\n     at \r\norg.apache.cassandra.io.util.BufferedRandomAccessFile.<init>(BufferedRandomAccessFile.java:142)\r\n     at \r\norg.apache.cassandra.io.util.BufferedSegmentedFile.getSegment(BufferedSegmentedFile.java:62)\r\n     ... 15 more\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454689","id":"12454689","filename":"ASF.LICENSE.NOT.GRANTED--v4-0001-revert-r996974.-fix-by-adding-a-switch-to-files-to-all.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-15T19:34:44.698+0000","size":8408,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454689/ASF.LICENSE.NOT.GRANTED--v4-0001-revert-r996974.-fix-by-adding-a-switch-to-files-to-all.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454690","id":"12454690","filename":"ASF.LICENSE.NOT.GRANTED--v4-0002-move-directory-scrubbing-to-startup.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-15T19:34:44.726+0000","size":3306,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454690/ASF.LICENSE.NOT.GRANTED--v4-0002-move-directory-scrubbing-to-startup.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454691","id":"12454691","filename":"ASF.LICENSE.NOT.GRANTED--v4-0003-avro-system-tests.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-15T19:34:44.782+0000","size":4407,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12454691/ASF.LICENSE.NOT.GRANTED--v4-0003-avro-system-tests.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12454499","id":"12454499","filename":"RaceConditionTest.java","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"created":"2010-09-13T23:28:31.268+0000","size":6484,"mimeType":"text/x-java","content":"https://issues.apache.org/jira/secure/attachment/12454499/RaceConditionTest.java"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"92289","summary":"drop/recreate column family race condition","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":"1 Node cluster, latest code from 0.7 trunk","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":26,"total":26,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12907612","id":"12907612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"On the ML you indicated you had a unit tests that was producing this failure.  Is it possible for you to attach it to this ticket?  I would like to include it in our tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-09T12:27:02.450+0000","updated":"2010-09-09T12:27:02.450+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12907680","id":"12907680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"body":"it uses Pelops at the moment.  lemme see if i can rework it for raw thrift.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"created":"2010-09-09T17:05:10.227+0000","updated":"2010-09-09T17:05:10.227+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909045","id":"12909045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"body":"using latest trunk code as of now\r\n\r\nThe attached JUnit (method testRaceTooFast) illustrates the problem of data still existing even though the column family has been dropped and recreated, but no data inserted.\r\n\r\nHowever, I cannot make the test fail by throwing \"org.apache.thrift.TApplicationException: Internal error processing get_slice\" as i indicate before because the first problem above never corrects itself.  The data file never goes away no matter how long i wait.  not sure what i was doing different in my app, or possibly code changed.  i no longer do it this way in my app so not sure.\r\n\r\nin addition, i tried to drop the keyspace between tests to make sure the keyspace was \"clear\" and this returns \"InvalidRequestException(why:java.io.IOException: Unable to create compaction marker)\" when the keyspace does exist, but i guess i dropped the column family during the previous test and caused it grief.  not sure.\r\n\r\ngood luck!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"created":"2010-09-13T23:28:31.333+0000","updated":"2010-09-13T23:28:31.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909281","id":"12909281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"I see now (I can reproduce this fwiw).  We changed the way to cleanup after dropped CFs at the end of August.  Prior to that, we blocked on deletion, but now just mark the CF compacted and wait for normal cleanup to do it's thing.\r\n\r\nIn hindsight, I'm not sure if this was the best approach.  If we allow creating, dropping, then recreating in rapid succession we should support it better.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-14T15:14:57.883+0000","updated":"2010-09-14T15:14:57.883+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909285","id":"12909285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"why do sstables-marked-compacted have any effect on anything?  isn't that a relatively simple fix?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-14T15:24:48.373+0000","updated":"2010-09-14T15:24:48.373+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909287","id":"12909287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"I'm not sure.  Is it as simple as changing CFS.files() to ignore those that have compacted markers?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-14T15:29:27.034+0000","updated":"2010-09-14T15:29:27.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909288","id":"12909288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"either that, or have it clean out the compacted ones before doing its filtering","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-14T15:35:08.268+0000","updated":"2010-09-14T15:35:08.268+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909290","id":"12909290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"(ignoring is probably safer since it's possible for a file to be marked compacted, but still open for a reader in progress)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-14T15:35:48.131+0000","updated":"2010-09-14T15:35:48.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909300","id":"12909300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-14T16:03:01.928+0000","updated":"2010-09-14T16:03:01.928+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909325","id":"12909325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"body":"the patch fixes the first problem, but the second method, testRaceSlowEnoughToCauseException, in the attached unit test still throws the following from get_slice:\r\n\r\nInvalidRequestException(why:java.io.IOException: Unable to create compaction marker)\r\n    at org.apache.cassandra.thrift.Cassandra$system_drop_column_family_result.read(Cassandra.java:22872)\r\n    at org.apache.cassandra.thrift.Cassandra$Client.recv_system_drop_column_family(Cassandra.java:1342)\r\n    at org.apache.cassandra.thrift.Cassandra$Client.system_drop_column_family(Cassandra.java:1317)\r\n    at RaceConditionTest.testRaceSlowEnoughToCauseException(RaceConditionTest.java:87)\r\n\r\non the server side i see this:\r\n\r\n10/09/14 09:46:32 ERROR thrift.CassandraDaemon: Uncaught exception in thread Thread[MIGRATION_STAGE:1,5,main]\r\njava.util.concurrent.ExecutionException: java.io.IOError: java.io.IOException: Unable to create compaction marker\r\n\tat java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)\r\n\tat java.util.concurrent.FutureTask.get(FutureTask.java:83)\r\n\tat org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor.afterExecute(DebuggableThreadPoolExecutor.java:87)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:888)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n\tat java.lang.Thread.run(Thread.java:619)\r\nCaused by: java.io.IOError: java.io.IOException: Unable to create compaction marker\r\n\tat org.apache.cassandra.io.sstable.SSTableReader.markCompacted(SSTableReader.java:484)\r\n\tat org.apache.cassandra.io.sstable.SSTableTracker.replace(SSTableTracker.java:76)\r\n\tat org.apache.cassandra.db.ColumnFamilyStore.removeAllSSTables(ColumnFamilyStore.java:711)\r\n\tat org.apache.cassandra.db.Table.dropCf(Table.java:271)\r\n\tat org.apache.cassandra.db.migration.DropColumnFamily.applyModels(DropColumnFamily.java:94)\r\n\tat org.apache.cassandra.db.migration.Migration.apply(Migration.java:157)\r\n\tat org.apache.cassandra.thrift.CassandraServer$1.call(CassandraServer.java:644)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:138)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n\t... 2 more\r\nCaused by: java.io.IOException: Unable to create compaction marker\r\n\tat org.apache.cassandra.io.sstable.SSTableReader.markCompacted(SSTableReader.java:480)\r\n\t... 11 more\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"created":"2010-09-14T16:49:56.493+0000","updated":"2010-09-14T16:49:56.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909331","id":"12909331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"body":"i should point out that testRaceSlowEnoughToCauseException runs fine in isolation, but run the junit class as a whole and it will fail.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"created":"2010-09-14T17:01:14.301+0000","updated":"2010-09-14T17:01:14.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909422","id":"12909422","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"Setting this to blocker. The bug is such that valid sstables can be deleted when the compaction markers stick around after a CF is dropped and recreated.\r\n\r\nThe fix is to check for a compaction marker when a sstable is created and delete it if it's there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-14T20:14:04.284+0000","updated":"2010-09-14T20:14:04.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909451","id":"12909451","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"somehow we're getting into a situation where there is X.compacted but no other sign of X?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-14T20:58:35.477+0000","updated":"2010-09-14T20:58:35.477+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909467","id":"12909467","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"The exception happens because the compaction marker exists but the deletion executor hasn't done its thing.  It's easy to visualize:\r\n* A keyspace is created along with a column family.  sstables are written.\r\n* That keyspace is dropped. compacted markers are written.\r\n* That keyspace and column family are recreated.  Meanwhile, no files have been deleted.\r\n* As part of re-Table.open()ing it, CFS.scrubDataDirectories() is called but doesn't scrub the compacted markers because of those are now excluded by files() * (I'm pretty sure this wasn't working, or wasn't working like we expect, in the first place, since B.Todd was getting the error before applying the patch).\r\n* Newly created sstables match the names of the compaction markers and will be possibly deleted if timing is bad.\r\n\r\nTwo fixes come to mind:\r\n1. keep the first patch that has already been committed and make AddKeyspace ensure that data directories, if they exist, are empty.\r\n2. revert the last patch and make AddColumnFamily ensure that its data directory, if it exists, is empty.\r\n\r\nI favor option 2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-14T21:48:37.269+0000","updated":"2010-09-14T21:48:37.269+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909473","id":"12909473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"this seems like a race-prone thing to do in the first place since it's not valid to remove a data file that has a reader open to it...\r\n\r\nverifying empty data directories on KS creation is fine but what is the analogue for CFs?  and how do you tell the client \"sorry, you're SOL\" if it's not empty?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-14T21:56:19.570+0000","updated":"2010-09-14T21:56:19.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909732","id":"12909732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"You're right.  I was trying to take a shortcut.  \r\n\r\nThe real problem is that CFS.files() is being used for two things: determine valid files to read from and also count the files to determine generation.  It can't determine the right generation if it doesn't include the invalid files (compacted), but if it includes the invalid files, we read data we shouldn't.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-15T13:53:36.940+0000","updated":"2010-09-15T13:53:36.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909733","id":"12909733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I think you've nailed it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-15T13:56:00.027+0000","updated":"2010-09-15T13:56:00.027+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909764","id":"12909764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #536 (See [https://hudson.apache.org/hudson/job/Cassandra/536/])\r\n    ensure that compacted sstables are excluded from newly instantiated readers. patch by gdusbabek, reviewed by jbellis. CASSANDRA-1477\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-09-15T15:17:25.233+0000","updated":"2010-09-15T15:17:25.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909766","id":"12909766","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"don't we also need to change scrub to only run at server start to avoid race-with-reader?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-15T15:19:54.034+0000","updated":"2010-09-15T15:19:54.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909835","id":"12909835","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"Yes. v3 addresses that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-15T18:33:52.232+0000","updated":"2010-09-15T18:33:52.232+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909838","id":"12909838","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1\r\n\r\n(in patch 2, CFS.all() may offer a small simplification.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-15T18:42:14.628+0000","updated":"2010-09-15T18:42:14.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909855","id":"12909855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"Your suggestion on patch 2 made me realize that the scrubbing should happen pior to populating the instances in CFS.  v4 fixes that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-15T19:37:34.553+0000","updated":"2010-09-15T19:37:34.553+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909869","id":"12909869","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"body":"seems like these patches are fixing the issues i found","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=btoddb","name":"btoddb","emailAddress":"btoddb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"B. Todd Burruss","active":true},"created":"2010-09-15T20:14:19.575+0000","updated":"2010-09-15T20:14:19.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909874","id":"12909874","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-09-15T20:31:28.355+0000","updated":"2010-09-15T20:31:28.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12909879","id":"12909879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"new and improved fix committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-09-15T20:39:29.090+0000","updated":"2010-09-15T20:39:29.090+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12473494/comment/12910584","id":"12910584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #538 (See [https://hudson.apache.org/hudson/job/Cassandra/538/])\r\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-09-17T13:55:34.730+0000","updated":"2010-09-17T13:55:34.730+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1477/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g5av:"}}