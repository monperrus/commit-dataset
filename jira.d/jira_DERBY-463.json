{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12312313","self":"https://issues.apache.org/jira/rest/api/latest/issue/12312313","key":"DERBY-463","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-08-16 21:30:19.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21968","customfield_12310222":"3_*:*_2_*:*_12618339000_*|*_1_*:*_1_*:*_2763144000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_2_*:*_585891000_*|*_4_*:*_1_*:*_44000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-01-16T17:13:45.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-463/watchers","watchCount":1,"isWatching":false},"created":"2005-07-15T21:50:21.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10991","id":"10991","description":"snapshot","name":"10.0.2.1","archived":false,"released":true,"releaseDate":"2004-12-06"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-05-18T05:36:48.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"}],"timeoriginalestimate":null,"description":"I have a table\nPEOPLE(SEQ_ID INT NOT NULL PRIMARY KEY, PICTURE BLOB).\n\nA row is inserted; both values are not NULL.\n\nFrom inside a JDBC program, I select the Blob for update.\nI then get the Blob output stream with a call to\n  Blob.setBinaryStream(long)\nTo this stream I write several times with\n  OutputStream.write(byte[], int, int)\nI close the stream, update the selected row with the new Blob and commit.\n\nThe new value of the Blob now is exactly the value of the last content of the byte[],\nand it is like the previous calls to write() have never taken place, or as if the file pointer\nof the output stream has been reset between the calls.\n\nA sample program follows; the size of the input file \"picture.jpg\" is 23237, the length\nof the Blob after the program has run is 23237 % 1024 = 709\n\n------------ sample program -------------\nimport java.sql.*;\n\nclass TestApp {\n   private TestApp() {}\n\n   public static void main(String[] args)\n         throws ClassNotFoundException, SQLException, java.io.IOException {\n      // try to load JDBC driver\n      Class.forName(\"com.ibm.db2.jcc.DB2Driver\");\n\n      // open the input file\n      java.io.InputStream instream = new java.io.FileInputStream(\"picture.jpg\");\n\n      // login to database\n      Connection conn = DriverManager.getConnection(\n            \"jdbc:derby:net://dbtuxe/testdb\", \"laurenz\", \"apassword\");\n      conn.setAutoCommit(false);\n\n      // select Blob for update\n      PreparedStatement stmt = conn.prepareStatement(\n            \"SELECT PICTURE FROM PEOPLE WHERE SEQ_ID=? FOR UPDATE OF PICTURE\");\n      stmt.setInt(1, 1);\n      ResultSet rs = stmt.executeQuery();\n\n      // get Blob output stream\n      rs.next();\n      Blob blob = rs.getBlob(1);\n      java.io.OutputStream outstream = blob.setBinaryStream(1l);\n\n      // copy the input file to the Blob in chunks of 1K\n      byte[] buf = new byte[1024];\n      int count;\n      while (-1 != (count = instream.read(buf))) {\n         outstream.write(buf, 0, count);\n         System.out.println(\"Written \" + count + \" bytes to Blob\");\n      }\n\n      // close streams\n      instream.close();\n      outstream.close();\n\n      // update Blob with new value\n      String cursor = rs.getCursorName();\n      PreparedStatement stmt2 = conn.prepareStatement(\n            \"UPDATE PEOPLE SET PICTURE=? WHERE CURRENT OF \" + cursor);\n      stmt2.setBlob(1, blob);\n      stmt2.executeUpdate();\n\n      // clean up\n      stmt2.close();\n      stmt.close();\n      conn.commit();\n      conn.close();\n   }\n}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40690","summary":"Successive writes to a java.sql.Blob.setBinaryStream(long) seem to reset the file pointer","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=laurenz","name":"laurenz","emailAddress":"all at adv dot magwien dot gv dot at","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laurenz Albe","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=laurenz","name":"laurenz","emailAddress":"all at adv dot magwien dot gv dot at","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laurenz Albe","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Sun java full version \"1.4.2_05-b04\"\nLinux x86\nDerby is run in network server mode","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":16,"total":16,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12318880","id":"12318880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"body":"Change method write (byte[], int, int) in java/client/org/apache/derby/client/am/BlobOutputStream.java. offset_ was not being incremented.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"created":"2005-08-16T21:30:19.000+0000","updated":"2005-08-16T21:30:19.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12318896","id":"12318896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=laurenz","name":"laurenz","emailAddress":"all at adv dot magwien dot gv dot at","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laurenz Albe","active":true},"body":"While you are at it:\r\n\r\nIn my program there is a line of code:\r\n  java.io.OutputStream outstream = blob.setBinaryStream(1l);\r\n\r\nMy original attempt was with blob.setBinaryStream(0l), as it should be in my opinion,\r\nbut then the first byte written to the Blob does not get written, i.e. the resulting Blob is one byte\r\nshort. By trial and error I found that it works when I use 1 instead of 0.\r\n\r\nIs that also a bug or is that intended?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=laurenz","name":"laurenz","emailAddress":"all at adv dot magwien dot gv dot at","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Laurenz Albe","active":true},"created":"2005-08-16T23:06:55.000+0000","updated":"2005-08-16T23:06:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12318899","id":"12318899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"body":"It also surprised me that it would start form 1, but it is intended to be so that the first byte is 1 and not 0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"created":"2005-08-16T23:46:54.000+0000","updated":"2005-08-16T23:46:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12319005","id":"12319005","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bakksjo","name":"bakksjo","emailAddress":"oyvind dot bakksjo at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oyvind Bakksjo","active":true},"body":"The bugfix looks ok.\r\n\r\nMy comments do not concern the fix, but the patch itself:\r\n- BlobOutputStream.java: The System.arraycopy() line's diff is just a different ordering of subtraction and addition - same behaviour as before.\r\n- blobclob4BLOB.java: A blank line removed, and an added javadoc header without a function - should probably go into blobSetBinaryStream.java?\r\n- blobSetBinaryStream.java:\r\n  * No newline at end of file\r\n  * The 'isDerbyNet' variable seems to be unused\r\n  * Do you need the 'startJBMS()' and 'setAutoCommit()' calls after the call to testBlob1() in main()?\r\n...and maybe this is a little picky, but:\r\n  * Some lines are not properly indented in main().\r\n  * Some typos in the string literals: \"setBinaryStram\", \"mutiple\" (don't forget to update the master file also).\r\n\r\nYou will usually catch things such ac unnecessary diffs yourself by looking closely at the patch before submitting it. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bakksjo","name":"bakksjo","emailAddress":"oyvind dot bakksjo at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oyvind Bakksjo","active":true},"created":"2005-08-17T20:29:03.000+0000","updated":"2005-08-17T20:29:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12319387","id":"12319387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bakksjo","name":"bakksjo","emailAddress":"oyvind dot bakksjo at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oyvind Bakksjo","active":true},"body":"Committed revision 233487.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bakksjo","name":"bakksjo","emailAddress":"oyvind dot bakksjo at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oyvind Bakksjo","active":true},"created":"2005-08-19T23:25:53.000+0000","updated":"2005-08-19T23:25:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12319413","id":"12319413","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bandaram","name":"bandaram","emailAddress":"bandaram at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Satheesh Bandaram","active":true},"body":"I wonder if similar problem exists if write(int) method is used, instead of write(b[], int, int) method. It seems the offset is not incremented in this case either. Looking at ClobOutputStream.java, does this need patching too?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bandaram","name":"bandaram","emailAddress":"bandaram at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Satheesh Bandaram","active":true},"created":"2005-08-20T03:57:25.000+0000","updated":"2005-08-20T03:57:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12320114","id":"12320114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"body":"Check if clobs have a similar problem, and extend the test to use both write(byte[], int, int) and write(int).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"created":"2005-08-26T18:10:31.000+0000","updated":"2005-08-26T18:10:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12322917","id":"12322917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"body":"- The test blobSetBinaryStreams.java was only testing the write(byte[], int, int) method for blobs. I have extendedit so that it would use both write(byte[], int, int) and write(int) for both blobs and clobs. Since it was not a blob specific test, I have renamed it to lobStreams.java.\r\n- Similar problems as the one fixed in the previous patch (the offset was not being incremented) existed in write(int) (for clobs and blobs) and write(byte[], int, int) (for clobs). These problems have now been fixed.\r\n- I have run derbyall successfully, except for store/encryptionKey.sql that failed, but I don't think it was related to my patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"created":"2005-09-08T17:57:30.000+0000","updated":"2005-09-08T17:57:30.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12356622","id":"12356622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"body":"On the 08/Sep/05 I attached a new patch for this issue containing a fix for Clobs (write(byte[], int, int) and write(int)) and blobs (write(int)). I forgot to ask someone to review the patch. So could someone please review it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"created":"2005-11-03T01:12:26.000+0000","updated":"2005-11-03T01:12:26.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12356735","id":"12356735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bandaram","name":"bandaram","emailAddress":"bandaram at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Satheesh Bandaram","active":true},"body":"Submitted this patch. Thanks for addressing my review comments and fixing other API calls too. I do like your new test!\r\n\r\nLooks like you haven't signed an ICLA with Apache... I would advise considering this step as your patches are getting bigger ...!\r\n\r\nSending        java\\client\\org\\apache\\derby\\client\\am\\BlobOutputStream.java\r\nSending        java\\client\\org\\apache\\derby\\client\\am\\ClobOutputStream.java\r\nDeleting       java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\blobSetBinaryStream.out\r\nAdding         java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\lobStreams.out\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\suites\\derbynetclientmats.runall\r\nDeleting       java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\jdbcapi\\blobSetBinaryStream.java\r\nDeleting       java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\jdbcapi\\blobSetBinaryStream_app.properties\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\jdbcapi\\build.xml\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\jdbcapi\\copyfiles.ant\r\nAdding         java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\jdbcapi\\lobStreams.java\r\nAdding         java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\jdbcapi\\lobStreams_app.properties\r\nTransmitting file data ........\r\nCommitted revision 330687.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bandaram","name":"bandaram","emailAddress":"bandaram at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Satheesh Bandaram","active":true},"created":"2005-11-04T11:22:57.000+0000","updated":"2005-11-04T11:22:57.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12356737","id":"12356737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"I have one comment on this fix.\r\n\r\nIn ClobOutputStream.java \r\n     public void write(int b) throws java.io.IOException {\r\n+        byte[] newByte = new byte[1];\r\n+        newByte[0] = (byte)b;\r\n\r\nI think it is incorrect to cast int to a byte. This will lead to incorrect results for unicode characters whose value is greater than a byte. \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2005-11-04T11:45:24.000+0000","updated":"2005-11-04T11:45:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12356742","id":"12356742","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Sunitha, I don't think that is a problem because the api for OutputStream.write(int b) is that it is a write of a byte, the top 24 bits are discarded.\r\n\r\nThere is a different serious problem with the class, nothing to do with this patch, it's an existing problem.\r\nThe code use String(byte[]) to create a string from a byte array. This uses the default platform encoding, which is typically not required\r\nbehaviour. Since this class is used for Clob.setAsciiStream I assume the encoding should be ascii based.\r\nThough the performance of this class  looks terrible if write(int) is used,  at least five objects created for eveny byte written!\r\n\r\nIn fact this class and the client Clob have code like this everywhere, as the Clob is updated:\r\n\r\n        clob_.string_ = clob_.string_.concat(new String(newByte));\r\n        clob_.asciiStream_ = new java.io.StringBufferInputStream(clob_.string_);\r\n        clob_.unicodeStream_ = new java.io.StringBufferInputStream(clob_.string_);\r\n        clob_.characterStream_ = new java.io.StringReader(clob_.string_);\r\n\r\nWould probably be better to create most of those objects on demand, rather than on every modification. I mean if the CLOB is modified\r\nbut the application never retrieives the ascii  or character streams, what was the benefit of creating them?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2005-11-04T12:39:38.000+0000","updated":"2005-11-04T12:39:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12361448","id":"12361448","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bandaram","name":"bandaram","emailAddress":"bandaram at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Satheesh Bandaram","active":true},"body":"Looks like this patch has been committed for sometime... Fernanda, can you resolve the defect and after confirming the fix, can you also close the bug?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bandaram","name":"bandaram","emailAddress":"bandaram at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Satheesh Bandaram","active":true},"created":"2005-12-31T06:37:26.000+0000","updated":"2005-12-31T06:37:26.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12411999","id":"12411999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"body":"Attaching 'derby-463-v10.1.diff' which ports this fix to 10.1 branch. This port is required to merge and test DERBY-683. A direct merge was not possible. Hence created a patch for v10.1.\r\n\r\nWith this patch, I ran derbyall in v10.1 with Sun jdk 1.4.2 on Windows XP. Please take a look at this patch. Thanks.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"created":"2006-05-16T22:37:14.000+0000","updated":"2006-05-16T22:37:14.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12412000","id":"12412000","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"body":"Add fix version - 10.1.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"created":"2006-05-16T22:40:21.000+0000","updated":"2006-05-16T22:40:21.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12312313/comment/12412251","id":"12412251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Committed to 10.1 with revision 407391.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-05-18T05:36:48.000+0000","updated":"2006-05-18T05:36:48.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-463/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07bvj:"}}