{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12434994","self":"https://issues.apache.org/jira/rest/api/latest/issue/12434994","key":"DERBY-4371","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-10-09 16:15:46.63","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24212","customfield_12310222":"3_*:*_1_*:*_9827972248_*|*_1_*:*_1_*:*_20587076753_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-08-25T12:11:21.473+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4371/watchers","watchCount":1,"isWatching":false},"created":"2009-09-07T11:33:52.472+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12327305","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12327305","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12437871","key":"DERBY-4406","self":"https://issues.apache.org/jira/rest/api/2/issue/12437871","fields":{"summary":"Wrong order when using ORDER BY on non-deterministic function","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:19:13.250+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"How to repeat:\r\n\r\nij> create table t (i integer, j integer);;\r\n0 rows inserted/updated/deleted\r\nij> insert into t values (1,2),(1,3);\r\n2 rows inserted/updated/deleted\r\nij> select distinct i from t order by j;\r\nERROR 42879: The ORDER BY clause may not contain column 'J', since the query specifies DISTINCT and that column does not appear in the query result.\r\nij> select distinct i from t order by j*2;\r\nI          \r\n-----------\r\n1          \r\n1          \r\n\r\n2 rows selected\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10366","value":"Wrong query result","id":"10366"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37853","summary":"Non-selected columns for SELECT DISTINCT allowed in ORDER BY clause if ordered by expression","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bernt","name":"bernt","emailAddress":"bernt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bernt M. Johnsen","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bernt","name":"bernt","emailAddress":"bernt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bernt M. Johnsen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":41,"total":41,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12758255","id":"12758255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bernt","name":"bernt","emailAddress":"bernt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bernt M. Johnsen","active":true},"body":"Wrong result. Should be \"Critical\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bernt","name":"bernt","emailAddress":"bernt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bernt M. Johnsen","active":true},"created":"2009-09-22T14:21:41.998+0000","updated":"2009-09-22T14:21:41.998+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12764074","id":"12764074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"SQL:2003 talks about this in part 2, 14.1 <declare cursor>, syntax rule 18d (18 d 9 B II, to be specific). My understanding is that if you have SELECT DISTINCT, all the columns/expressions in the ORDER BY clause must also be found in the select list.\r\n\r\nAdding this restriction would solve the issue by rejecting the problematic query. Whereas the behaviour of this particular query is not well-defined, there may be some meaningful queries that will be rejected too, like \"select distinct i from t order by -i\", so we should probably add a release note if we choose to fix it this way.\r\n\r\nAnother data point, PostgreSQL does not allow any of the queries discussed here:\r\n\r\nkh160127=# select distinct i from t order by j;\r\nERROR:  for SELECT DISTINCT, ORDER BY expressions must appear in select list\r\nkh160127=# select distinct i from t order by j*2;\r\nERROR:  for SELECT DISTINCT, ORDER BY expressions must appear in select list\r\nkh160127=# select distinct i from t order by -i;\r\nERROR:  for SELECT DISTINCT, ORDER BY expressions must appear in select list\r\n\r\nMySQL allows all three of them, although only the latter has a well-defined ordering.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-09T16:15:46.630+0000","updated":"2009-10-09T16:15:46.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12764728","id":"12764728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The error for \"select distinct i from t order by j\" is raised by OrderByColumn.bindOrderByColumn() if the query is distinct, the sort key is a column reference, and the sort key has been added to the result column list. Ideally, we should raise the error if the query is distinct and the sort key has been added to the RCL, and not care about whether or not it's a column reference. However, we always add the sort key to the RCL if it's an expression, even if the same expression is already in the RCL. DERBY-4406 is caused by this, and a fix for that issue is likely to make it easier to fix this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-10-12T16:00:27.628+0000","updated":"2009-10-12T16:00:27.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12858492","id":"12858492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi All,\r\n\r\nI like to do some work on this bug as well. If someone can suggest me a starting point, it would be great.\r\n\r\nFollowing is some of my understandings/ findings, please correct me if I am wrong.\r\n\r\nI think we need to perform a check inside OrderByColumn.bindOrderByColumn(), to find out whether the order by *expression* (not only column references) is same as the expression in RCL. If they are different we should raise that error if and only if (target instanceof SelectNode)=true and ( (SelectNode)target ).hasDistinct() =true.\r\n\r\nI think this will make Derby to not pull-up an expression that is already there in RCL. Currently Derby pull-up j*2 expression in both occasions mentioned below:\r\n\r\n          select distinct i from t order by j*2; // addedColumnOffset = 0\r\n          select distinct j*2 from t order by j*2; // addedColumnOffset = 0 this ideally should be -1.\r\n\r\nI like to get your view thoughts on this.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-19T14:09:44.858+0000","updated":"2010-04-19T14:09:44.858+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12858739","id":"12858739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Nirmal, thanks for looking at this issue.\r\n\r\nI wonder if it would be helpful to take a close look at how GROUP BY handles\r\na somewhat similar situation:\r\n\r\n  select a, sum(b) from t group by a having a+c > 1 \r\n\r\nis not legal because of the reference to column 'c'. But, the related statement:\r\n\r\n  select a+c, sum(b) from t group by a+c having a+c > 1 \r\n\r\nis legal, because the expression is the same in all cases (I think -- please check this!)\r\n\r\nYou can find the code that implements this behavior, I think, in the method\r\naddNewColumnsForAggregation() in GroupByNode.java. In particular, look\r\nclosely at how the SubstituteExpressionsVisitor and CollectNodesVisitor\r\nget used to process the HAVING clause's expression tree.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-04-20T01:07:21.794+0000","updated":"2010-04-20T01:07:21.794+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12858810","id":"12858810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Actually, GROUP BY A+C is not valid SQL. It is non-standard syntax that was added in DERBY-883. SQL:2003 only allows column references in group by clauses, as far as I can see.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-04-20T10:41:49.583+0000","updated":"2010-04-20T10:41:49.583+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12858959","id":"12858959","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Bryan & Knut,\r\n\r\nselect a, sum(b) from t group by a having a+c > 1  : I checked this in both Derby and PostgreSQL, this is not legal as Bryan correctly mentioned since column reference 'c' included in having clause is not in group by clause, though the 'a' in select clause is in the group by clause. (Note that 'b' is used as 'sum(b)', i.e. if we use a column reference with an aggregate function it need not to be in the group by clause.)\r\n\r\nselect a+c, sum(b) from t group by a+c having a+c > 1  :This is a valid query in both Derby and PostgreSQL. I think Bryan is correct, since the same expression used in *all 3* cases, this is successful. I verified this by following queries:\r\n     select a, sum(b) from t group by a+c having a+c > 1 //this fails \r\n     select a-c, sum(b) from t group by a+c having a+c > 1 //this fails\r\n     select a-c, sum(b) from t group by a,c having a+c > 1 //this passes\r\n     select a, sum(b) from t group by a+c,a having a+c > 1 //this passes\r\n                      ---> this implies expressions in select clause should be in group by clause\r\n\r\nsame way I figured out that an expression used in a having clause should be in group by clause.\r\n\r\nThanks.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-20T16:26:16.298+0000","updated":"2010-04-20T16:26:16.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12860572","id":"12860572","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi All,\r\n\r\nI have attached a patch for this issue. This patch shows following error for the query mentioned in the description:\r\n\r\nERROR 42879: The ORDER BY clause may not contain column 'expression' , since the query specifies DISTINCT and that column does not appear in the query result.\r\n\r\nI used 'expression' in the error, since j*2 is not a column reference, but I think it is better if we can show a new error for this.\r\n\r\nI am expecting your valuable comments on the patch.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-24T20:11:13.913+0000","updated":"2010-04-24T20:11:13.913+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12860573","id":"12860573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"I am running derbyall tests now.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-24T20:13:24.159+0000","updated":"2010-04-24T20:13:24.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12860658","id":"12860658","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi All,\r\n\r\nI ran the derbyall tests with my modification, but it failed (I was wondering why). Following is a quote from derbyall_report.txt:\r\n\r\nGenerating report for RunSuite derbyall  null null null true \r\n------------------ Java Information ------------------\r\nJava Version:    1.6.0_16\r\nJava Vendor:     Sun Microsystems Inc.\r\nJava home:       C:\\Program Files\\Java\\jre6\r\nJava classpath:  %classpath%;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derby.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbytools.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyrun.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbynet.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyclient.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyTesting.jar;C:\\OtherNirmal\\GSoC\\Code\\tools\\java\\jakarta-oro-2.0.8.jar;C:\\OtherNirmal\\GSoC\\Code\\tools\\java\\junit.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_cs.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_de_DE.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_es.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_fr.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_hu.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_it.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_ja_JP.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_ko_KR.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_pl.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_pt_BR.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_ru.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_zh_CN.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_zh_TW.jar;C:\\OtherNirmal\\GSoC\\xalan-j_2_7_1-bin-2jars\\xalan-j_2_7_1\\samples\\xalansamples.jar;C:\\OtherNirmal\\GSoC\\Document\\lib\\fop.jar;C:\\OtherNirmal\\GSoC\\Document\\lib\\avalon-framework-4.2.0.jar;C:\\OtherNirmal\\GSoC\\Document\\lib\\batik-all-1.6.jar;.\r\nOS name:         Windows Vista\r\nOS architecture: x86\r\nOS version:      6.0\r\nJava user name:  Nirmal\r\nJava user home:  C:\\Users\\Nirmal\r\nJava user dir:   C:\\OtherNirmal\\GSoC\\Testing\\DerbyAll\r\njava.specification.name: Java Platform API Specification\r\njava.specification.version: 1.6\r\n--------- Derby Information --------\r\nJRE - JDBC: Java SE 6 - JDBC 4.0\r\n[C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derby.jar] 10.6.0.0 alpha - (exported)\r\n[C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbytools.jar] 10.6.0.0 alpha - (exported)\r\n[C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbynet.jar] 10.6.0.0 alpha - (exported)\r\n[C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyclient.jar] 10.6.0.0 alpha - (exported)\r\n------------------------------------------------------\r\n----------------- Locale Information -----------------\r\nCurrent Locale :  [English/United States [en_US]]\r\nFound support for locale: [cs]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [de_DE]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [es]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [fr]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [hu]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [it]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [ja_JP]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [ko_KR]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [pl]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [pt_BR]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [ru]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [zh_CN]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [zh_TW]\r\n\t version: 10.6.0.0 alpha - (exported)\r\n------------------------------------------------------\r\nTest environment information:\r\nCOMMAND LINE STYLE: jdk13\r\nTEST CANONS: master\r\n------------------------------------------------------\r\n------------------------------------------------------\r\nSummary results:\r\n\r\nTest Run Started: 2010-04-25 01:19:16.0\r\nTest Run Duration: 00:48:47\r\n\r\n204 Tests Run\r\n31% Pass (65 tests passed)\r\n69% Fail (139 tests failed)\r\n3 Suites skipped\r\n\r\n=================================================================\r\nSince I was pretty sure, that these failures occurred not because of my modifications, I ran derbyall again after commenting the code I added.\r\nThe result was what I expected.\r\n\r\nGenerating report for RunSuite derbyall  null null null true \r\n------------------ Java Information ------------------\r\nJava Version:    1.6.0_16\r\nJava Vendor:     Sun Microsystems Inc.\r\nJava home:       C:\\Program Files\\Java\\jre6\r\nJava classpath:  %classpath%;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derby.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbytools.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyrun.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbynet.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyclient.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyTesting.jar;C:\\OtherNirmal\\GSoC\\Code\\tools\\java\\jakarta-oro-2.0.8.jar;C:\\OtherNirmal\\GSoC\\Code\\tools\\java\\junit.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_cs.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_de_DE.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_es.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_fr.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_hu.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_it.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_ja_JP.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_ko_KR.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_pl.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_pt_BR.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_ru.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_zh_CN.jar;C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyLocale_zh_TW.jar;C:\\OtherNirmal\\GSoC\\xalan-j_2_7_1-bin-2jars\\xalan-j_2_7_1\\samples\\xalansamples.jar;C:\\OtherNirmal\\GSoC\\Document\\lib\\fop.jar;C:\\OtherNirmal\\GSoC\\Document\\lib\\avalon-framework-4.2.0.jar;C:\\OtherNirmal\\GSoC\\Document\\lib\\batik-all-1.6.jar;.\r\nOS name:         Windows Vista\r\nOS architecture: x86\r\nOS version:      6.0\r\nJava user name:  Nirmal\r\nJava user home:  C:\\Users\\Nirmal\r\nJava user dir:   C:\\OtherNirmal\\GSoC\\Testing\\DerbyAll2\r\njava.specification.name: Java Platform API Specification\r\njava.specification.version: 1.6\r\n--------- Derby Information --------\r\nJRE - JDBC: Java SE 6 - JDBC 4.0\r\n[C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derby.jar] 10.6.0.0 alpha - (exported)\r\n[C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbytools.jar] 10.6.0.0 alpha - (exported)\r\n[C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbynet.jar] 10.6.0.0 alpha - (exported)\r\n[C:\\OtherNirmal\\GSoC\\Code\\jars\\sane\\derbyclient.jar] 10.6.0.0 alpha - (exported)\r\n------------------------------------------------------\r\n----------------- Locale Information -----------------\r\nCurrent Locale :  [English/United States [en_US]]\r\nFound support for locale: [cs]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [de_DE]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [es]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [fr]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [hu]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [it]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [ja_JP]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [ko_KR]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [pl]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [pt_BR]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [ru]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [zh_CN]\r\n\t version: 10.6.0.0 alpha - (exported)\r\nFound support for locale: [zh_TW]\r\n\t version: 10.6.0.0 alpha - (exported)\r\n------------------------------------------------------\r\nTest environment information:\r\nCOMMAND LINE STYLE: jdk13\r\nTEST CANONS: master\r\n------------------------------------------------------\r\n------------------------------------------------------\r\nSummary results:\r\n\r\nTest Run Started: 2010-04-25 10:29:54.0\r\nTest Run Duration: 00:48:08\r\n\r\n204 Tests Run\r\n31% Pass (65 tests passed)\r\n69% Fail (139 tests failed)\r\n3 Suites skipped\r\n\r\n============================================================\r\n\r\nBut, since the both reports failed same number of tests, I suppose I can conclude that my modifications, not resulted of failure of any tests.\r\n\r\nExpect your views on this.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-25T06:03:38.431+0000","updated":"2010-04-25T06:03:38.431+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12860718","id":"12860718","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi All,\r\n\r\nderbyall Tests ran successfully. \r\n\r\nIf someone can review the patch it would be great.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-25T17:33:27.937+0000","updated":"2010-04-25T17:33:27.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12860928","id":"12860928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Nirmal, thanks for the patch, it looks very promising.\r\nHere's a couple things that occurred to me as I read it:\r\n\r\n1) Is the instanceof check for BinaryOperatorNode necessary?\r\nWhat would happen if it was removed?\r\n\r\n2) Did you run the JUnit test suites? Or just the derbyall suite?\r\n\r\n3) Can you add some new JUnit test cases to cover some of\r\nthe variations that are handled by the new code? In particular,\r\nit would be nice to have test cases for the ORDER BY statements that\r\nare mentioned in the bug description, and it would be nice to have\r\ntest cases for the ORDER BY statements that you mention in\r\nyour comments in the patch.\r\n\r\nI think that DistinctTest.java would be a fine place to add the test cases.\r\n\r\n4) Something about this loop looks strange:\r\n\r\n    for (int i=1; i<target.getResultColumns().size() ;i++ ){\r\n\r\nUsually, either the loop counter starts at 0, or the loop test\r\nis for <=, not <. Do you think the start and end conditions are\r\ncorrect in this case?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-04-26T14:05:33.261+0000","updated":"2010-04-26T14:05:33.261+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12861009","id":"12861009","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Bryan,\r\n\r\nThank you very much for reviewing the patch.\r\n\r\n1) I added this simply because queries like select distinct i*2 from order by i are already giving that error. But I think removing this will not affect anything instead we will able to handle queries like select distinct i from order by random() such that it shows the error. Thanks for pointing it.\r\n\r\n2) I ran just the derbyall suite, I will run suites.all now.\r\n\r\n3) This will probably the next thing I like to learn. I will read up on Junit tests.\r\n\r\n4) Whoops, thanks Bryan, it was a mistake, and I corrected that, and I modified the patch too, please find the new attachment.\r\n\r\nThanks Again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-26T17:34:32.754+0000","updated":"2010-04-26T17:34:32.754+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12861651","id":"12861651","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Bryan,\r\n\r\nI ran Junit tests for the new modification and there's a failure. Following is the output in JunitAll.out:\r\n\r\n orderby(org.apache.derbyTesting.functionTests.tests.lang.LangScripts)junit.framework.ComparisonFailure: Output at line 1736 expected:<[C1 |C2 ]> but was:<[ERROR 42879: The ORDER BY clause may not contain column 'expression', since the query specifies DISTINCT and that column does not appear in the query result.]>\r\nat org.apache.derbyTesting.functionTests.util.CanonTestCase.compareCanon(CanonTestCase.java:106)\r\nat org.apache.derbyTesting.functionTests.util.ScriptTestCase.runTest(ScriptTestCase.java:198)\r\nat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:109)\r\nat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\nat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\nat junit.extensions.TestSetup.run(TestSetup.java:25)\r\nat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\r\n\r\nWhere can I found the query related to this ?\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-28T02:27:24.604+0000","updated":"2010-04-28T02:27:24.604+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12861654","id":"12861654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"There's a bit of a trick to reading the following output:\r\n\r\n>  orderby(org.apache.derbyTesting.functionTests.tests.lang.LangScripts)junit.framework.ComparisonFailure: \r\n> Output at line 1736 expected:<[C1 |C2 ]> but was:<[ERROR 42879: The ORDER BY clause \r\n> may not contain column 'expression', since the query specifies DISTINCT and that column does \r\n> not appear in the query result.]> \r\n\r\nThe output is referring to line 1736 in the file \r\njava/testing/org/apache/derbyTesting/functionTests/master/orderby.out\r\n\r\nThe \"LangScripts\" test is a special JUnit test which takes files full of SQL statements, such as\r\njava/testing/org/apache/derbyTesting/functionTests/tests/lang/orderby.sql, feeds them\r\ninto the \"ij\" tool, and then compares the output against the corresponding XXX.out file.\r\n\r\nSo have a look at line 1736 in orderby.out and the message should make more sense.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-04-28T02:58:45.423+0000","updated":"2010-04-28T02:58:45.423+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12861655","id":"12861655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Thanks Bryan for help me out to read this.\r\n\r\nSo, I found that the line 1736 is referred to the query: select distinct c1, c2 from t1 order by c1+1;\r\n\r\nAccording to the standards this should fail with the error I created:\r\n\r\nERROR 42879: The ORDER BY clause may not contain column 'expression', since the query specifies DISTINCT and that column does\r\nnot appear in the query result.\r\n\r\nBut it expects the query to be pass and output this:\r\n\r\nC1         |C2        \r\n----------------------\r\n1          |c         \r\n2          |b         \r\n3          |a         \r\n4          |c  \r\n\r\nSo, I think we need to modify this test, isn't it? Isn't this the place I need to add additional queries to test the functionality of the modified code?\r\n\r\nThanks.\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-28T03:13:13.176+0000","updated":"2010-04-28T03:13:13.176+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12861661","id":"12861661","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"It sounds like your proposed patch would cause\r\na query which previously passed to get an error instead.\r\n\r\nThis is the sort of thing that we always think very carefully\r\nabout, because people may be currently using queries\r\nlike this, and depending on them, and so we are hesitant\r\nto disrupt functionality that is currently operational for fear\r\nof breaking existing applications.\r\n\r\nIn this particular case, we can see by using the Subversion \"annotate\" feature\r\nhttp://svn.apache.org/viewvc/db/derby/code/trunk/java/testing/org/apache/derbyTesting/functionTests/master/orderby.out?view=annotate\r\n that the particular query was changed by DERBY-2351 in revision 637529:\r\nhttp://svn.apache.org/viewvc/db/derby/code/trunk/java/testing/org/apache/derbyTesting/functionTests/master/orderby.out?r1=637528&r2=637529&\r\n\r\nI think that the next step is probably to have a close review of the\r\nDERBY-2351 notes and try to understand why the DERBY-2351 changes\r\nare in conflict with the changes in your proposed patch.\r\n\r\nIt's quite possible that your patch is implementing the desired behavior,\r\nbut it would better still if we can understand why DERBY-2351 felt that\r\nthe other behavior was desirable.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-04-28T03:32:59.107+0000","updated":"2010-04-28T03:32:59.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12861668","id":"12861668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Bryan,\r\n\r\nOkey, I understood the importance.\r\n\r\nI will study on DERBY-2351.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-28T03:53:44.666+0000","updated":"2010-04-28T03:53:44.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12862039","id":"12862039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Bryan,\r\n\r\nAs I understood after going through DERBY-2351, we must allow queries like:\r\n\r\nselect distinct i from t order by i*2\r\n\r\n          should be allow as this functionality may have been using by Derby users, in there applications. Derby allows this is because i is there in the distinct even though i*2 is not there.\r\n\r\nSo, if we follow this rule it implies that:\r\n select distinct * from t order by i*2\r\n       is also allow.\r\n\r\nTo check whether a column reference in a distinct is contained in this order by column I have to perform a check for each operand in both ways (j*2 and 2*j).\r\n\r\nI have attached a patch proposal. Your reviews are highly appreciated.\r\n\r\nNote: This patch is not tend to handle queries like below:\r\nselect distinct i from t order by random()\r\nselect distinct i from t order by j*2*3;\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-04-29T00:59:31.165+0000","updated":"2010-04-29T00:59:31.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12862345","id":"12862345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Nirmal,\r\n\r\nIf I understand correctly, the patch only addresses the case with a binary operator with one numeric constant operand and one result column operand. Unfortunately, that's just one out of an infinite number of possible shapes the ORDER BY clause could take, and we cannot address each one of those cases individually, so I think we should aim for a more general approach.\r\n\r\nPerhaps this would work:\r\n\r\nWhen DISTINCT is specified, do this for each OrderByColumn:\r\n\r\n1) Check if there's a column in the target's result column list with an equivalent expression (can be checked with the isEquivalent() method in ValueNode). If there is one, this OrderByColumn is OK.\r\n\r\n2) Otherwise, collect all columns referenced by the expression in the OrderByColumn (CollectNodesVisitor could probably do this for you), and check if all the columns are also in the target's result column list. If they all are, the OrderByColumn is OK. If not, throw an exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-04-29T18:52:36.359+0000","updated":"2010-04-29T18:52:36.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12863315","id":"12863315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Thanks Knut, for reviewing the patch, yes me too felt that it is too generic and thanks for suggesting me possible two ways, that was really helpful. I think the most appropriate way is the second way, since we want queries like select distinct c1, c2 from t1 order by c1+1 to be valid.\r\n\r\nThe patch DERBY-4371-4.diff contains the new modifications. Highly appreciate reviews from all of you. Thanks.\r\n\r\nI am now running the tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-05-03T11:40:25.824+0000","updated":"2010-05-03T11:40:25.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12863347","id":"12863347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Nirmal,\r\n\r\nSorry for not being clear. I didn't mean to suggest two different approaches, but one approach with two steps. If we only implement step 2, we won't allow statements like this one (which are allowed according to the standard):\r\n\r\nSELECT DISTINCT C1+1 FROM T ORDER BY C1+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-05-03T13:36:44.838+0000","updated":"2010-05-03T13:37:21.866+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12863356","id":"12863356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Knut,\r\n\r\nIt's okey. With a slight modification I managed to use 2) and it worked fine.\r\nMethod:\r\nIt checks the ColumnReferences in distinct clause (using CollectNodesVisitor ), with ColumnReferences in OrderByColumn.\r\n\r\nThis successfully allow the above query.\r\n\r\nAny thoughts of this approach? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-05-03T14:04:50.830+0000","updated":"2010-05-03T14:04:50.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12863382","id":"12863382","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Nirmal,\r\n\r\nAfter a quick look at the patch, I have these comments:\r\n\r\nI don't think the CollectNodesVisitor should be used on the expressions in the select list, as that would allow too many queries to be executed. For example, the #4 patch will allow this statement:\r\n\r\n    select distinct i*j from t1 order by i/j\r\n\r\nThis statement should be rejected because none of the columns I or J, or the expression I/J are contained directly in the select list (both I and J are in an expression in the select list, but not on the top level, so there's no functional dependency between the columns in the select list and the expression in the order by clause).\r\n\r\nI'm not sure if it's enough to check the name of the columns to see if it's the same column, as they may refer to columns in different tables. Perhaps ColumnReference.isEquivalent() would work better?\r\n\r\nI don't think column names should be compared with String.equalsIgnoreCase(), as column names are case sensitive. For example, I think this select statement is supposed to fail because \"I\" is not the same column as \"i\":\r\n\r\nij> create table t2(\"I\" int , \"i\" int);\r\n0 rows inserted/updated/deleted\r\nij> select distinct \"I\"+1 from t2 order by \"i\"+1;\r\n1          \r\n-----------\r\n\r\n0 rows selected","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-05-03T15:39:20.343+0000","updated":"2010-05-03T15:39:20.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12863409","id":"12863409","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Knut,\r\n\r\nThanks for the comments.\r\n\r\nI'll look into your first and second comments.\r\n\r\nI printed out a column name given by ColumnReference.getColumnName(), though the column in the table is 'i' it shows as 'I'. To confirm this I created a new table with columns 's' and inserted some values to it, and issued select * command, and the result was displayed as 'S'. That's why I used that method, but now only I knew that we can issue case sensitive column names, by adding within a quotation mark(\").\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-05-03T17:14:37.752+0000","updated":"2010-05-03T17:14:37.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900258","id":"12900258","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi,\r\n\r\nI'll resume my work on this issue.\r\n\r\nBut I've a small doubt. \r\nShould we allow following type of queries:\r\n\"select distinct i from t order by i/j;\"\r\n \r\nthanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-19T11:50:00.653+0000","updated":"2010-08-19T11:50:00.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900296","id":"12900296","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Hi Nirmal:\r\n     I am new to this issue. However, will \"select distinct i from t order by i/j\" fits in to 2) collect all columns referenced by the expression in the OrderByColumn (CollectNodesVisitor could probably do this for you), and check if all the columns are also in the target's result column list. If they all are, the OrderByColumn is OK. If not, throw an exception.  \"j\" is not in the column of target's result column list so we throw an exception. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2010-08-19T14:54:48.002+0000","updated":"2010-08-19T14:54:48.002+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900304","id":"12900304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Lily,\r\n\r\nThanks for the reply. \r\n\r\nI got confused with Knut's last post \r\n\r\ni.e.   select distinct i*j from t1 order by i/j\r\nThis statement should be rejected because none of the columns I or J, or the expression I/J are contained directly in the select list (both I and J are in an expression in the select list, but not on the top level, so there's no functional dependency between the columns in the select list and the expression in the order by clause). \r\n\r\nWhat you think? Isn't this implies as it's enough to have I OR J? May be Knut accidentally mistyped it.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-19T15:06:43.094+0000","updated":"2010-08-19T15:06:43.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900326","id":"12900326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi,\r\n\r\nI'm attaching patch #5 which is capable of fixing this issue. \r\nIt would be nice if someone can review this.\r\n\r\nPS: This will allow a query like\r\nselect distinct i from t order by i/j;\r\n for now. After I get clarified whether this type of \r\nquery is valid, I'll update the patch.\r\n\r\nThanks.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-19T15:57:37.810+0000","updated":"2010-08-19T15:57:37.810+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900327","id":"12900327","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"> Should we allow following type of queries:\r\n> \"select distinct i from t order by i/j;\"\r\n\r\nNo, this query should not be allowed. Consider the table\r\n\r\n i  |  j  | i/j\r\n---------------\r\n100 |  10 | 10\r\n100 | 100 |  1\r\n200 |  40 |  5\r\n  3 |   1 |  3\r\n\r\nHere, the ORDER BY clause is ambiguous, because it's not clear whether\r\n100 should be the first value or the last value in the result.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-08-19T15:58:56.484+0000","updated":"2010-08-19T15:58:56.484+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900336","id":"12900336","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Knut,\r\n\r\nThanks for the explanation! \r\nI'll update the patch soon!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-19T16:17:28.327+0000","updated":"2010-08-19T16:17:28.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900352","id":"12900352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Attaching the updated patch. Following our few queries which I've tested:\r\n\r\nFailing queries:\r\nselect distinct i from t order by j;\r\nselect distinct i from t order by j*2;\r\nselect distinct i,j*3 from t order by j*2;\r\nselect distinct i from t order by i*2,j*3;\r\nselect distinct i*j from t order by i/j;\r\nselect distinct i from t order by -j;\r\nselect distinct i from t order by i/j;\r\n\r\nPassing queries:\r\nselect distinct i,j from t order by j;\r\nselect distinct i,j from t order by j*2;\r\nselect distinct i,j*2 from t order by j*2;\r\nselect distinct i,j from t order by i*2,j*3;\r\nselect distinct * from t order by j*2, i*3;\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-19T16:46:14.575+0000","updated":"2010-08-19T16:46:14.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900664","id":"12900664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for the patch, Nirmal. This looks promising! I found the new logic in bindOrderByColumn() a bit hard to follow, though, mainly because of the many nesting levels. Do you think it is possible to factor out some of that code into helper methods to improve the readability?\r\n\r\nIt would be great if you could add the queries you posted above to one of the regression tests (both the ones that are expected to work, and those that are expected to fail).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-08-20T10:58:49.821+0000","updated":"2010-08-20T10:58:49.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900665","id":"12900665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"bindOrderByColumn() doesn't seem to handle the case where the CollectNodeVisitor returns an empty list. For example, these two queries used to work, but now they fail:\r\n\r\nij> select distinct i from t order by 1+1;\r\nERROR 42879: The ORDER BY clause may not contain column 'null', since the query specifies DISTINCT and that column does not appear in the query result.\r\nij> select distinct i from t order by random();\r\nERROR 42879: The ORDER BY clause may not contain column 'null', since the query specifies DISTINCT and that column does not appear in the query result.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-08-20T11:02:56.767+0000","updated":"2010-08-20T11:02:56.767+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900684","id":"12900684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Knut,\r\n\r\nThanks for reviewing the patch!\r\n\r\nI have attached the patch #6, this will allow those queries you have mentioned and broke the code into another method for the ease of read.\r\n\r\nPS: I'll attach a different patch including the changes to the orderby.out.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-20T13:08:33.258+0000","updated":"2010-08-20T13:08:33.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12900800","id":"12900800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi,\r\n\r\nHere's the diff of tests added. Tests ran successfully in my environment.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-20T18:00:48.635+0000","updated":"2010-08-20T18:00:48.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12901435","id":"12901435","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks Nirmal, the new patch was easier to read. And thanks for adding all the test cases.\r\n\r\nI believe the code is correct, but it's still somewhat tricky to understand, especially because of the nesting levels and the way it breaks out of the loops. Here are some suggestions that I think would make the code easier to follow:\r\n\r\n1) Reduce the nesting level in the else branch in bindOrderByColumn(). Instead of the current code with two levels\r\n\r\n        if (addedColumnOffset >= 0 && ....) {\r\n            if (!expressionMatch(target)) {\r\n\r\nmerge them into one if statement:\r\n\r\n    if (addedColumnOffset >= 0 && ....\r\n        && !expressionMatch(target)) {\r\n\r\n2. Instead of breaking out of the loop in bindOrderByColumn() with the \"break\" keyword when a non-matching column is found, just throw the exception immediately. Then it's easier to see what the effect of a mismatch is.\r\n\r\n3. Given that the \"throw\" statement is moved inside the loop as part of comment (2), there's no need to check explicitly whether the list of collected nodes was empty, so \"if(collectNodesVisitor.getList().isEmpty())\" can be removed.\r\n\r\n4. The results of some sub-expressions could be put in to local variables to avoid having to repeat them. For example, target.getResultColumns() in expressionMatch(), and target.getResultColumns() and target.getResultColumns().getResultColumn(i).getExpression() in columnMatchFound().\r\n\r\n5. The loop in columnMatchFound() could be simplified by returning true immediately when a match is found, instead of setting a flag and then checking the flag further down in the loop body.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-08-23T15:17:57.509+0000","updated":"2010-08-23T15:17:57.509+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12901760","id":"12901760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Hi Knut,\r\n\r\nPatch #7 is included the modifications that you've suggested.\r\n\r\nThanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-24T07:51:20.543+0000","updated":"2010-08-24T07:51:20.543+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12902398","id":"12902398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thank you, Nirmal! The #7 patch looks good to me. I've checked it in along with the new test cases.\r\n\r\nCommitted revision 989048.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-08-25T12:11:21.165+0000","updated":"2010-08-25T12:11:21.165+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/12902405","id":"12902405","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"body":"Thanks Knut for committing the patch!! ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nirmal","name":"nirmal","emailAddress":"nirmal070125 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=nirmal&avatarId=17689","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=nirmal&avatarId=17689","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=nirmal&avatarId=17689","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=nirmal&avatarId=17689"},"displayName":"Nirmal Fernando","active":true},"created":"2010-08-25T12:32:14.690+0000","updated":"2010-08-25T12:32:14.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12434994/comment/13685164","id":"13685164","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:13.241+0000","updated":"2013-06-17T09:19:13.241+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4371/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06ud3:"}}