{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12331746","self":"https://issues.apache.org/jira/rest/api/latest/issue/12331746","key":"DERBY-1187","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":null,"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22358","customfield_12310222":"1_*:*_1_*:*_85567000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_8196750000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-04-08T06:31:50.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1187/watchers","watchCount":0,"isWatching":false},"created":"2006-04-07T06:45:43.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-07-12T03:24:20.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"For the following script defragment pass is not freeing up the free pages:\n\ndrop table t1;\ncreate table t1 (i integer primary key, j integer, c char(200));\ninsert into t1 values (1, 1, 'a');\ninsert into t1 (select t1.i + 1,    t1.j + 1,    t1.c from t1);\ninsert into t1 (select t1.i + 2,    t1.j + 2,    t1.c from t1);\ninsert into t1 (select t1.i + 4,    t1.j + 4,    t1.c from t1);\ninsert into t1 (select t1.i + 8,    t1.j + 8,    t1.c from t1);\ninsert into t1 (select t1.i + 16,   t1.j + 16,   t1.c from t1);\ninsert into t1 (select t1.i + 32,   t1.j + 32,   t1.c from t1);\ninsert into t1 (select t1.i + 64,   t1.j + 64,   t1.c from t1);\ninsert into t1 (select t1.i + 128,  t1.j + 128,  t1.c from t1);\ninsert into t1 (select t1.i + 256,  t1.j + 256,  t1.c from t1);\ninsert into t1 (select t1.i + 512,  t1.j + 512,  t1.c from t1);\n\n\ndelete from t1 where i < 512;\n\nselect\n    cast(conglomeratename as char(12)) as tabname,\n    isindex,\n    cast(numallocatedpages as int) as alloc,\n    numfreepages,\n    cast(numunfilledpages as int) as unfilled,\n    pagesize,\n    estimspacesaving\nfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;\n\n\nCALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP', 'T1', 1, 1, 1);\n\nselect\n    cast(conglomeratename as char(12)) as tabname,\n    isindex,\n    cast(numallocatedpages as int) as alloc,\n    numfreepages,\n    cast(numunfilledpages as int) as unfilled,\n    pagesize,\n    estimspacesaving\nfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;\n\nselect\n    cast(conglomeratename as char(12)) as tabname,\n    isindex,\n    cast(numallocatedpages as int) as alloc,\n    numfreepages,\n    cast(numunfilledpages as int) as unfilled,\n    pagesize,\n    estimspacesaving\nfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;\n\nHere is example output from a run on the trunk:\nij> drop table t1;\n0 rows inserted/updated/deleted\nij> create table t1 (i integer primary key, j integer, c char(200));\n0 rows inserted/updated/deleted\nij> insert into t1 values (1, 1, 'a');\n1 row inserted/updated/deleted\nij> insert into t1 (select t1.i + 1,    t1.j + 1,    t1.c from t1);\n1 row inserted/updated/deleted\nij> insert into t1 (select t1.i + 2,    t1.j + 2,    t1.c from t1);\n2 rows inserted/updated/deleted\nij> insert into t1 (select t1.i + 4,    t1.j + 4,    t1.c from t1);\n4 rows inserted/updated/deleted\nij> insert into t1 (select t1.i + 8,    t1.j + 8,    t1.c from t1);\n8 rows inserted/updated/deleted\nij> insert into t1 (select t1.i + 16,   t1.j + 16,   t1.c from t1);\n16 rows inserted/updated/deleted\nij> insert into t1 (select t1.i + 32,   t1.j + 32,   t1.c from t1);\n32 rows inserted/updated/deleted\nij> insert into t1 (select t1.i + 64,   t1.j + 64,   t1.c from t1);\n64 rows inserted/updated/deleted\nij> insert into t1 (select t1.i + 128,  t1.j + 128,  t1.c from t1);\n128 rows inserted/updated/deleted\nij> insert into t1 (select t1.i + 256,  t1.j + 256,  t1.c from t1);\n256 rows inserted/updated/deleted\nij> insert into t1 (select t1.i + 512,  t1.j + 512,  t1.c from t1);\n512 rows inserted/updated/deleted\nij> delete from t1 where i < 512;\n511 rows inserted/updated/deleted\nij> select\n    cast(conglomeratename as char(12)) as tabname,\n    isindex,\n    cast(numallocatedpages as int) as alloc,\n    numfreepages,\n    cast(numunfilledpages as int) as unfilled,\n    pagesize,\n    estimspacesaving\nfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;\nTABNAME     |ISIND&|ALLOC      |NUMFREEPAGES        |UNFILLED   |PAGESIZE   |EST\nIMSPACESAVING\n--------------------------------------------------------------------------------\n-----------------\nSQL060406034|1     |7          |0                   |0          |4096       |0\n\nT1          |0     |60         |9                   |0          |4096       |368\n64\n\n2 rows selected\nij> CALL SYSCS_UTIL.SYSCS_INPLACE_COMPRESS_TABLE('APP', 'T1', 1, 1, 1);\n0 rows inserted/updated/deleted\nij> select\n    cast(conglomeratename as char(12)) as tabname,\n    isindex,\n    cast(numallocatedpages as int) as alloc,\n    numfreepages,\n    cast(numunfilledpages as int) as unfilled,\n    pagesize,\n    estimspacesaving\nfrom new org.apache.derby.diag.SpaceTable('T1') t order by conglomeratename;\nTABNAME     |ISIND&|ALLOC      |NUMFREEPAGES        |UNFILLED   |PAGESIZE   |EST\nIMSPACESAVING\n--------------------------------------------------------------------------------\n-----------------\nSQL060406034|1     |7          |0                   |1          |4096       |0\n\nT1          |0     |69         |0                   |0          |4096       |0\n\n\n2 rows selected\nij>\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40533","summary":"defragment of inplace compress pass for described dataset is not freeing up empty pages.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":2,"total":2,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12331746/comment/12373687","id":"12373687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"committed the fix for this as:\r\nm1_142:271>svn commit\r\n\r\nSending        java\\engine\\org\\apache\\derby\\iapi\\db\\OnlineCompress.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\OnlineC\r\nompressTest.out\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\Ba\r\nseTest.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\store\\On\r\nlineCompressTest.java\r\nTransmitting file data ....\r\nCommitted revision 392439.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-04-08T06:31:50.000+0000","updated":"2006-04-08T06:31:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12331746/comment/12377341","id":"12377341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"backported fix from trunk to 10.1 line :\r\n\r\nr398761 | mikem | 2006-05-01 18:27:21 -0700 (Mon, 01 May 2006) | 11 lines\r\n\r\nDERBY-1187\r\n\r\nbackported fix for DERBY-1187 from trunk to 10.1 branch, targeted for the\r\n10.1.3 release.  Original comments from fix (392439):\r\nDefragment pass was not being committed properly, so when rows at\r\nfront of table were being deleted and freeing pages the defragment\r\npass did not move the rows to the free pages.  Longer term the\r\ndefragment pass should commit more often, see DERBY-1188.\r\nAdded extra test to OnlineCompressTest.java for this case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-05-02T14:25:43.000+0000","updated":"2006-05-02T14:25:43.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1187/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07awn:"}}