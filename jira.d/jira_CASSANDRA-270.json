{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12429232","self":"https://issues.apache.org/jira/rest/api/latest/issue/12429232","key":"CASSANDRA-270","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314533","id":"12314533","description":"","name":"0.7 beta 1","archived":false,"released":true,"releaseDate":"2010-08-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-07-09 15:21:21.968","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"1_*:*_1_*:*_32493306837_*|*_5_*:*_1_*:*_0","customfield_12310420":"27476","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-07-11T23:02:05.756+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-270/watchers","watchCount":4,"isWatching":false},"created":"2009-06-30T21:06:58.919+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-07-14T13:56:23.118+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"This is a series of patches against a very old version of Cassandra - they certainly won't apply, but Jonathan asked me to upload the patches here to do the ASF grant.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12449089","id":"12449089","filename":"270.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-09T15:21:21.893+0000","size":19690,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12449089/270.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12449096","id":"12449096","filename":"270-v2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-09T17:42:31.008+0000","size":29018,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12449096/270-v2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12412205","id":"12412205","filename":"patches.tar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","emailAddress":"todd at cloudera dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Todd Lipcon","active":true},"created":"2009-06-30T21:08:09.085+0000","size":71680,"mimeType":"application/x-tar","content":"https://issues.apache.org/jira/secure/attachment/12412205/patches.tar"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"91091","summary":"Reduce copies in data write path","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","emailAddress":"todd at cloudera dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Todd Lipcon","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","emailAddress":"todd at cloudera dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Todd Lipcon","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429232/comment/12725808","id":"12725808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","emailAddress":"todd at cloudera dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Todd Lipcon","active":true},"body":"Patches uploaded in a tar:\r\ncommit 22867357d6073197781a6cdc47dead27447e6880\r\nAuthor: Todd Lipcon <todd@amiestreet.com>\r\nDate:   Fri Aug 1 15:35:13 2008 -0400\r\n\r\n    Make RequestCountSampler flush using ChainedBufferOutput\r\n    \r\n    Memory usage no longer has 512MB spikes on flush!\r\n    \r\n    Test plan: made sure flushes still happen and that it's still 256MB.\r\n\r\ncommit cd3bf215571720049db69b02775820159ef026fa\r\nAuthor: Todd Lipcon <todd@amiestreet.com>\r\nDate:   Fri Aug 1 15:16:35 2008 -0400\r\n\r\n    Add ChainedBufferOutput - this is a DataOutput that avoids copying when a block of bytes is written\r\n\r\ncommit 7c9df9620389d5d68cf20d7e13a9b5956d5b4710\r\nAuthor: Todd Lipcon <todd@amiestreet.com>\r\nDate:   Fri Aug 1 14:55:27 2008 -0400\r\n\r\n    Make ICompactSerializer take a DataOutput instead of DataOutputStream as its second parameter.\r\n    \r\n    This caused issues for the GMS messages which need to have access to DataOutputStream.size().\r\n    I couldn't figure out a good way around this, so I chose a bad one -- there's a new\r\n    ICompactStreamSerializer which takes the old style DataOutputStream.\r\n    \r\n    The purpose for this commit is so that we can write from serializers directly into SequenceFiles\r\n    with no intermediate copy\r\n\r\ncommit 1c9d5b129ed768d10fc57ac4fbed135f70684be2\r\nAuthor: Todd Lipcon <todd@amiestreet.com>\r\nDate:   Fri Aug 1 13:33:20 2008 -0400\r\n\r\n    Refactor writing of DataOutputBuffers into DataOutputs into an IWritable interface\r\n    \r\n    This is working towards getting rid of the remaining copy when flushing cardinality\r\n\r\ncommit 198b1037324d8e4d32604dbeaa0613308efc6734\r\nAuthor: Todd Lipcon <todd@amiestreet.com>\r\nDate:   Fri Aug 1 13:04:43 2008 -0400\r\n\r\n    Only make shallow copies when performing cardinality flushes\r\n    \r\n    This should reduce cut half of height of the 512M memory spikes every 5 minutes\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tlipcon","name":"tlipcon","emailAddress":"todd at cloudera dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Todd Lipcon","active":true},"created":"2009-06-30T21:08:09.089+0000","updated":"2009-06-30T21:08:09.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429232/comment/12886741","id":"12886741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"The root of the problem is that writing a ColumnFamily [row data] object has been\r\n\r\n 1. serialize the row to a DataOutput\r\n 2. write the DataOutput's length, followed by the DataOutput's content, to the sstable file\r\n\r\nThus, there is an extra copy to the intermediate DataOutput before getting to the file.\r\n\r\nThis patch takes a different approach than Todd's: instead of using a clever DataOutput to avoid copying the byte[] inside Column objects, we change the algorithm to\r\n\r\n 1. write a placeholder length value\r\n 2. serialize the row directly to the sstable\r\n 3. seek back and write the correct length now that we know it\r\n\r\nIf we seek within our BufferedRandomAccessFile buffer, we're not actually generating seek system calls, so there's basically no penalty for doing this, and we can guarantee that this is our situation by setting the buffer size to the InMemoryCompactionLimit (past which we do two passes already as explained in CASSANDRA-16).\r\n\r\n(This did require a small modification to BRAF, which would flush whenever seeking backwards, which is unnecessarily pessimistic.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-09T15:21:21.968+0000","updated":"2010-07-09T15:21:21.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429232/comment/12886790","id":"12886790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"v2 updates xml to yaml Converter and makes deeper changes to BRAF: seeking back to the current end-of-file also caused flush unnecessarily, since seek was in charge of reloading the buffer for both reads and writes.  moved that code into reBuffer method, and made criteria different on writes (have to be writing at > hi_) than reads (where we use >= hi as before).\r\n\r\nStu points out that this doesn't necessarily avoid seeks entirely -- it only limits them to at most one per InMemoryCompactionLimit's worth, if a single row crosses the buffer boundary.  i think we can live with that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-09T17:42:31.101+0000","updated":"2010-07-09T17:42:31.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429232/comment/12887234","id":"12887234","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdennis","name":"mdennis","emailAddress":"mdennis at riptano dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew F. Dennis","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mdennis","name":"mdennis","emailAddress":"mdennis at riptano dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matthew F. Dennis","active":true},"created":"2010-07-11T21:31:01.155+0000","updated":"2010-07-11T21:31:01.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429232/comment/12887246","id":"12887246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-11T23:02:05.705+0000","updated":"2010-07-11T23:02:05.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12429232/comment/12888346","id":"12888346","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #491 (See [http://hudson.zones.apache.org/hudson/job/Cassandra/491/])\r\n    ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-07-14T13:56:23.102+0000","updated":"2010-07-14T13:56:23.102+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-270/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0fxwn:"}}