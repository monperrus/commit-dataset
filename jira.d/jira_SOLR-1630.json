{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12442640","self":"https://issues.apache.org/jira/rest/api/latest/issue/12442640","key":"SOLR-1630","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314371","id":"12314371","description":"Major release after 1.4.1","name":"3.1","archived":false,"released":true,"releaseDate":"2011-03-31"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314992","id":"12314992","description":"Alpha release of 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2009-12-15 16:54:35.476","customfield_12312323":null,"customfield_12310420":"6042","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_22109811334_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-08-20T14:01:42.514+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-1630/watchers","watchCount":5,"isWatching":false},"created":"2009-12-07T16:24:51.180+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313351","id":"12313351","description":"","name":"1.4","archived":false,"released":true,"releaseDate":"2009-11-10"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:39:05.352+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312520","id":"12312520","name":"Schema and Analysis","description":"Issues and features related to the IndexSchema, FieldTypes, and Analysis (TokenizerFactory, TokenFilterFactory, etc.)"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312015","id":"12312015","name":"spellchecker","description":"Returning spelling suggestions"}],"timeoriginalestimate":null,"description":"For some documents/search strings, the SpellCheckComponent throws StringIndexOutOfBoundsException\r\nSee: http://www.lucidimagination.com/search/document/3be6555227e031fc/\r\n\r\nh2. Replication\r\n\r\n * Save attached schema.xml and solrconfig.xml in apache-solr-1.4.0/example/solr/conf\r\n * Start Solr\r\n * Index attached bug.xml\r\n * Query [http://localhost:8983/solr/select/?q=awehjse-wjkekw]\r\n\r\nIt throws a StringIndexOutOfBoundsException\r\n{noformat} String index out of range: -7\r\n\r\njava.lang.StringIndexOutOfBoundsException: String index out of range: -7\r\n\tat java.lang.AbstractStringBuilder.replace(Unknown Source)\r\n\tat java.lang.StringBuilder.replace(Unknown Source)\r\n\tat org.apache.solr.handler.component.SpellCheckComponent.toNamedList(SpellCheckComponent.java:248)\r\n\tat org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:143)\r\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:195)\r\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)\r\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1316)\r\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:338)\r\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:241)\r\n{noformat} ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"19577","summary":"StringIndexOutOfBoundsException in SpellCheckComponent","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robin.wojciki%40gmail.com","name":"robin.wojciki@gmail.com","emailAddress":"robin dot wojciki at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robin Wojciki","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robin.wojciki%40gmail.com","name":"robin.wojciki@gmail.com","emailAddress":"robin dot wojciki at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robin Wojciki","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Solr 1.4\r\nLucene 2.9.1\r\nWin XP\r\njava version \"1.6.0_14\"","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":15,"total":15,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12786978","id":"12786978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robin.wojciki%40gmail.com","name":"robin.wojciki@gmail.com","emailAddress":"robin dot wojciki at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robin Wojciki","active":true},"body":"Solr config and Solr doc for replicating the issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robin.wojciki%40gmail.com","name":"robin.wojciki@gmail.com","emailAddress":"robin dot wojciki at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Robin Wojciki","active":true},"created":"2009-12-07T16:39:35.265+0000","updated":"2009-12-07T16:39:35.265+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12790816","id":"12790816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=glebourg","name":"glebourg","emailAddress":"glebourg at konodeo dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Lebourgeois","active":true},"body":"Hi, it seems I've encountered the same bug. All queries using the - char, or the _ char make solr throw an exception when using the SpellCheckComponent. It is possible to temporary fix it by setting accuracy parameter to 1.0 (which makes the spellcheck pretty useless, but avoid exceptions).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=glebourg","name":"glebourg","emailAddress":"glebourg at konodeo dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Lebourgeois","active":true},"created":"2009-12-15T16:54:35.476+0000","updated":"2009-12-15T16:54:35.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12791318","id":"12791318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"body":"I'm not able to reproduce this issue. I used Robin's document, schema and solrconfig.xml in the form of a unit test and it gives an empty spell check response but no exceptions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"created":"2009-12-16T11:05:54.704+0000","updated":"2009-12-16T11:05:54.704+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12791325","id":"12791325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=glebourg","name":"glebourg","emailAddress":"glebourg at konodeo dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Lebourgeois","active":true},"body":"Ok, i'lm gonna try to upload my own config in case it can help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=glebourg","name":"glebourg","emailAddress":"glebourg at konodeo dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Lebourgeois","active":true},"created":"2009-12-16T11:12:56.906+0000","updated":"2009-12-16T11:12:56.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12791334","id":"12791334","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=glebourg","name":"glebourg","emailAddress":"glebourg at konodeo dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Lebourgeois","active":true},"body":"This file provide a spellcheck configuration and a requesthandler which may raise an exception when making queries\r\n    \r\n    Example of queries which work fine :\r\n      * ?q=test\r\n      * ?q=my+name+is+henry\r\n      * ?q=éléphant\r\n    \r\n    Example of queries which throw an exception :\r\n      * ?q=sous-marin\r\n      * ?q=sous-marin+russe\r\n      * ?q=sous_marin\r\n      * ?q=éléphant-blanc\r\n      \r\n      \r\n   It may be linked to the content of the index, and/or the spellcheck index.\r\n\r\nHere is the stack :\r\n\r\n\tat java.lang.AbstractStringBuilder.replace(AbstractStringBuilder.java:797)\r\n\tat java.lang.StringBuilder.replace(StringBuilder.java:271)\r\n\tat org.apache.solr.handler.component.SpellCheckComponent.toNamedList(SpellCheckComponent.java:248)\r\n\tat org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:143)\r\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:195)\r\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)\r\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1316)\r\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:338)\r\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:241)\r\n\tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1089)\r\n\tat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:365)\r\n\tat org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\r\n\tat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)\r\n\tat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712)\r\n\tat org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)\r\n\tat org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:211)\r\n\tat org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)\r\n\tat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)\r\n\tat org.mortbay.jetty.Server.handle(Server.java:285)\r\n\tat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:502)\r\n\tat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:821)\r\n\tat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:513)\r\n\tat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:208)\r\n\tat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:378)\r\n\tat org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:226)\r\n\tat org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=glebourg","name":"glebourg","emailAddress":"glebourg at konodeo dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Lebourgeois","active":true},"created":"2009-12-16T11:35:56.840+0000","updated":"2009-12-16T11:38:03.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12791342","id":"12791342","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"body":"Thanks Guillaume, can you give me an example document too?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shalinmangar","name":"shalinmangar","emailAddress":"shalin dot mangar at lucidworks dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=shalinmangar&avatarId=19501","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shalinmangar&avatarId=19501","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shalinmangar&avatarId=19501","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shalinmangar&avatarId=19501"},"displayName":"Shalin Shekhar Mangar","active":true},"created":"2009-12-16T12:09:40.417+0000","updated":"2009-12-16T12:09:40.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12791360","id":"12791360","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=glebourg","name":"glebourg","emailAddress":"glebourg at konodeo dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Lebourgeois","active":true},"body":"I've been trying to reproduce the bug with a \"one-document index\", but I fail... on the other hand, on index of 500k+ documents this issue is \"automatic\". Maybe it's linked with some kinds of documents ? I don't know, I'm gonna test some other possibilities in case it can help.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=glebourg","name":"glebourg","emailAddress":"glebourg at konodeo dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Lebourgeois","active":true},"created":"2009-12-16T13:25:07.600+0000","updated":"2009-12-16T13:25:07.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12800622","id":"12800622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralf_kraus","name":"ralf_kraus","emailAddress":"rk at pixelhouse dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ralf Kraus","active":true},"body":"We have found an hint to the problem:\r\n\r\nWe run into into this problem ONLY when the search result includes words with \"-\" in it! \r\nFor example \"t-bone-steak\".\r\n\r\nWhen I search with \"t-bone-steak\" the error occurs every time !\r\n\r\nI hope we could help!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ralf_kraus","name":"ralf_kraus","emailAddress":"rk at pixelhouse dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ralf Kraus","active":true},"created":"2010-01-15T08:46:55.592+0000","updated":"2010-01-15T08:46:55.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12802630","id":"12802630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayallenhill%40gmail.com","name":"jayallenhill@gmail.com","emailAddress":"jayallenhill at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jay Hill","active":true},"body":"I have seen another case of a production system hitting this exact same exception. However I'm unable to reproduce it outside of production. However it is occurring on all queries with hyphenated words. For a search on: ochoa-brillembourg\r\n\r\nSEVERE: java.lang.StringIndexOutOfBoundsException: String index out of range: -14\r\n        at java.lang.AbstractStringBuilder.replace(AbstractStringBuilder.java:797)\r\n        at java.lang.StringBuilder.replace(StringBuilder.java:271)\r\n        at org.apache.solr.handler.component.SpellCheckComponent.toNamedList(SpellCheckComponent.java:248)\r\n        at org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:143)\r\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:195)\r\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)\r\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1316)\r\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:338)\r\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:241)\r\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\r\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\r\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\r\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\r\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)\r\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\r\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\r\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)\r\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:849)\r\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)\r\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:454)\r\n        at java.lang.Thread.run(Thread.java:619)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jayallenhill%40gmail.com","name":"jayallenhill@gmail.com","emailAddress":"jayallenhill at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jay Hill","active":true},"created":"2010-01-20T02:44:34.131+0000","updated":"2010-01-20T02:44:34.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12858474","id":"12858474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=grahamp","name":"grahamp","emailAddress":"graham dot poulter at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Graham P","active":true},"body":"We get the same StringIndexOutOfBoundsException with hyphenated query strings, on production and development - Solr 1.4.0 on CentOS 5.4 x86_64 using 32-bit Java 1.6.0_12","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=grahamp","name":"grahamp","emailAddress":"graham dot poulter at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Graham P","active":true},"created":"2010-04-19T12:39:02.427+0000","updated":"2010-04-19T12:41:02.601+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12874765","id":"12874765","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=khaledh","name":"khaledh","emailAddress":"khaledh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Khaled Hammouda","active":true},"body":"We just hit this bug as well. To reproduce, you must index a document that contains a hyphen (or underscore) and then search with a misspelled version of the indexed text; e.g.\r\n\r\ndocument contains: mid-term\r\nquery: mis-term\r\nresult: exception thrown\r\n\r\nI looked at the code of where this is happening and it seems to be related to token offsets (of the tokenized query) in conjunction with a feature of the spellcheck component called collation. Basically collation tries to replace the original query with the top suggested words. It relies on the tokenizer to remove the original misspelled words and insert the suggested ones (using StringBuilder.replace). Unfortunately the token offsets look weird for words with hyphens (or underscore); for example:\r\n\r\nquery: abc_def\r\n1st token: value = abc; startOffset = 0; endOffset = 7\r\n2nd token: value = def; startOffset = 0; endOffset = 7\r\n\r\nBecause the two tokens occupy the same range (0-7) this messes up the replacement logic. I'm not sure if this tokenizer behavior is the correct one, but it's part of the problem.\r\n\r\nHaving said that, I tried to change the spellcheck tokenizer from standard to whitespace and this actually solved the problem; no errors and I get correct suggestions.\r\n\r\nSo, until this gets fixed you can either:\r\n\r\n1) Disable spellchecker collation, or\r\n2) Use a whitespace tokenizer for the spellchecker component","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=khaledh","name":"khaledh","emailAddress":"khaledh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Khaled Hammouda","active":true},"created":"2010-06-02T19:55:22.998+0000","updated":"2010-06-02T19:55:22.998+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12895001","id":"12895001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"attached is a patch with a testcase for the issue (and maybe a fix/workaround, though it still doesnt seem really right to me and i dont completely understand what this spellcheck collate should do)\r\n\r\nI was able to trigger it easily by using synonymfilter + wdf at querytime, which i know will muck with the offsets.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2010-08-03T19:39:45.683+0000","updated":"2010-08-03T19:39:45.683+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12900687","id":"12900687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"I'm fine w/ the fix, but it should be noted that we say in http://wiki.apache.org/solr/SpellCheckingAnalysis, which is linked from the http://wiki.apache.org/solr/SpellCheckComponent#Spell_Checking_Analysis page that the analysis used for spelling should be dead simple, even stemming is not recommended.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2010-08-20T13:24:27.982+0000","updated":"2010-08-20T13:24:27.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12900694","id":"12900694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"body":"Trunk: Committed revision 987509.\r\n\r\n3.x: Committed revision 987511.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gsingers","name":"gsingers","emailAddress":"gsingers at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Grant Ingersoll","active":true},"created":"2010-08-20T14:01:42.429+0000","updated":"2010-08-20T14:01:42.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442640/comment/12900704","id":"12900704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"{quote}\r\nI'm fine w/ the fix, but it should be noted that we say in http://wiki.apache.org/solr/SpellCheckingAnalysis, which is linked from the http://wiki.apache.org/solr/SpellCheckComponent#Spell_Checking_Analysis page that the analysis used for spelling should be dead simple, even stemming is not recommended.\r\n{quote}\r\n\r\nThanks Grant, that was the gist of my concern with the fix. It didn't seem obvious to me what the \"correct\" behavior of collation should be with this sort of analysis, but this answers my question. \r\n\r\nAt least we have the \"defensive\" measure in case someone configures it like this, thinks its working for the most part, but then a user enters a hyphen.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2010-08-20T14:24:15.344+0000","updated":"2010-08-20T14:24:15.344+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-1630/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03pkv:"}}