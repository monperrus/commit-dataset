{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12385772","self":"https://issues.apache.org/jira/rest/api/latest/issue/12385772","key":"DERBY-3303","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313142","id":"12313142","description":"","name":"10.3.3.0","archived":false,"released":true,"releaseDate":"2008-05-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-01-08 16:08:43.472","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23558","customfield_12310222":"1_*:*_1_*:*_3817337984_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_6700","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-02-21T17:46:33.782+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3303/watchers","watchCount":1,"isWatching":false},"created":"2008-01-08T13:24:15.798+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12318764","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12318764","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12325311","key":"DERBY-681","self":"https://issues.apache.org/jira/rest/api/2/issue/12325311","fields":{"summary":"Eliminate the parser's rewriting of the abstract syntax tree for queries with GROUP BY and/or HAVING clauses","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-30T15:55:51.491+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"Derby throws ArrayIndexOutOfBoundsException  when I try to execute SQL query shown below.\n\nThis is a regression, since Derby 10.2.2.0 executes this query without problems.\n\nAttached are DDL statements to create DB tables, and database itself (with data).\n\n2008-01-08 12:32:34.461 GMT Thread[DRDAConnThread_5,6,derby.daemons] (XID = 1497), (SESSIONID = 0), (DATABASE = InventorizacijaDB), (DRDAID = NF000001.G46A-666250070078662256{1}), Failed Statement is: select MAX(preke0_.BARKODAS) as col_0_0_, MAX(preke0_.PAVADINIMAS) as col_1_0_, MAX(preke0_.KIEKIS) as col_2_0_, SUM(irasas1_.FAKTINIS_KIEKIS) as col_3_0_ from PREKE preke0_, IRASAS irasas1_, IRASU_BLOKAS irasubloka2_ where irasas1_.IRASU_BLOKAS=irasubloka2_.ID and preke0_.UNIKALUS_KODAS=irasas1_.UNIKALUS_KODAS and irasubloka2_.INVENTORIZACIJA=? group by irasas1_.UNIKALUS_KODAS order by abs(SUM(irasas1_.FAKTINIS_KIEKIS)-MAX(preke0_.KIEKIS)) DESC with 1 parameters begin parameter #1: 1 :end parameter \njava.lang.ArrayIndexOutOfBoundsException: 5\n\tat org.apache.derby.impl.store.access.sort.MergeSort.compare(Unknown Source)\n\tat org.apache.derby.impl.store.access.sort.SortBuffer.insert(Unknown Source)\n\tat org.apache.derby.impl.store.access.sort.MergeInserter.insert(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.SortResultSet.loadSorter(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.SortResultSet.openCore(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source)\n\tat org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source)\n\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)\n\tat org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38808","summary":"ArrayIndexOutOfBoundsException at MergeSort.compare","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"------------------ Java Information ------------------\nJava Version:    1.6.0_03\nJava Vendor:     Sun Microsystems Inc.\nJava home:       D:\\Programs\\Java\\jre1.6.0_03\nJava classpath:  derbytools.jar\nOS name:         Windows XP\nOS architecture: x86\nOS version:      5.1\nJava user name:  Donatas\nJava user home:  C:\\Documents and Settings\\Donatas\nJava user dir:   d:\\java\\derby-10.3.2.1\\lib\njava.specification.name: Java Platform API Specification\njava.specification.version: 1.6\n--------- Derby Information --------\nJRE - JDBC: Java SE 6 - JDBC 4.0\n[D:\\java\\derby-10.3.2.1\\lib\\derbytools.jar] 10.3.2.1 - (599110)\n------------------------------------------------------\n----------------- Locale Information -----------------\n------------------------------------------------------","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":15,"total":15,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12556892","id":"12556892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"body":"Actual database with data","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"created":"2008-01-08T13:26:06.317+0000","updated":"2008-01-08T13:26:06.317+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12556894","id":"12556894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"body":"SQL that fails:\r\n\r\nSELECT MAX(Preke.pavadinimas) AS PAVADINIMAS, MAX(Preke.barkodas) AS BARKODAS, \r\n        MAX(Preke.kiekis) AS KIEKIS, SUM(Irasas.faktinis_kiekis) AS FAKTINIS_KIEKIS,\r\n        SUM(Irasas.faktinis_kiekis)-MAX(Preke.kiekis) AS TRUKUMAS\r\nFROM Preke LEFT JOIN Irasas ON Preke.unikalus_kodas = Irasas.unikalus_kodas\r\n    JOIN Irasu_Blokas ON Irasas.irasu_blokas = Irasu_Blokas.id\r\nWHERE Irasu_Blokas.inventorizacija = 1\r\nGROUP BY Irasas.unikalus_kodas  \r\nORDER BY ABS(SUM(Irasas.faktinis_kiekis) - MAX(Preke.kiekis)) DESC","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"created":"2008-01-08T13:28:06.097+0000","updated":"2008-01-08T13:28:06.097+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12556895","id":"12556895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"body":"DDL script to create database (without data)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"created":"2008-01-08T13:31:10.532+0000","updated":"2008-01-08T13:31:10.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12556925","id":"12556925","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thank you *very* much for the reproduction script, Donatas.\r\n\r\nI ran your script against trunk and the bug reproduces there, as well.  Using a sane build the query fails with the following assertion error:\r\n\r\norg.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED column ordering error\r\n    at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120)\r\n    at org.apache.derby.impl.store.access.sort.MergeSort.initialize(MergeSort.java:535)\r\n    at org.apache.derby.impl.store.access.sort.ExternalSortFactory.createSort(ExternalSortFactory.java:216)\r\n    at org.apache.derby.impl.store.access.RAMTransaction.createSort(RAMTransaction.java:1711)\r\n    at org.apache.derby.impl.sql.execute.SortResultSet.loadSorter(SortResultSet.java:301)\r\n    at org.apache.derby.impl.sql.execute.SortResultSet.openCore(SortResultSet.java:268)\r\n\r\nThe query runs without error at svn # 516453, but fails with # 516454.  So it looks like this is related to DERBY-681.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-01-08T16:08:43.472+0000","updated":"2008-01-08T16:08:43.472+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12568780","id":"12568780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"A simpler way to reproduce the problem on trunk:\r\n\r\n  create table t1 (i int, j int, k int);\r\n  insert into t1 values (1, 1, 2), (1, 3, 3), (2, 3, 1), (2, 2, 4);\r\n\r\n  -- Works.\r\n  select sum(k) as s from t1 group by i order by 1;\r\n\r\n  -- Works.\r\n  select sum(k) as s from t1 group by i order by s;\r\n\r\n  -- Fails (ArrayIndexOutOfBounds / ASSERT); should fail with ERROR 42X77...\r\n  select sum(k) as s from t1 group by i order by 2;\r\n\r\n  -- Fails (ArrayIndexOutOfBounds / ASSERT)\r\n  select sum(k) as s from t1 group by i order by abs(1);\r\n\r\n  -- Fails (ArrayIndexOutOfBounds / ASSERT)\r\n  select sum(k) as s from t1 group by i order by sum(k);\r\n\r\nConfirmed that all of these run without error before DERBY-681 changes were committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-02-14T01:41:57.445+0000","updated":"2008-02-14T01:42:34.791+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12569360","id":"12569360","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"From what I could gather the failures mentioned in my previous comment were caused by two different problems, but both come down to the mistreatment (esp. ignoring) of columns in a ResultColumnList that have been \"pulled up\" for GROUP BY processing.\r\n\r\nI'm attaching a patch, d3303_v1.patch, which makes two very small changes to OrderByColumn.java to account for \"pulled\" GROUP BY columns.  With this patch applied all of the queries posted in my previous comment run as expected.\r\n\r\nI also ran derbyall and suites.All with ibm142 and they ran cleanly.\r\n\r\nI _think_ this constitutes a complete fix for the issue, but I am not all that familiar with the GROUP BY and ORDER BY column \"pulling\" logic that exists in Derby.  I've skimmed through the relevant code for reviews but have never actually changed it myself.  So if anyone out there can double-check the change, that would be great.  It's only two lines of code change plus some additional comments, so it should in theory be quick...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-02-15T18:42:35.058+0000","updated":"2008-02-15T18:42:35.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12569369","id":"12569369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Army, thanks for working on this problem. I'll try to have a look at your patch over the weekend (little busy today).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-02-15T18:51:50.865+0000","updated":"2008-02-15T18:51:50.865+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12569449","id":"12569449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Army, things lightened up a bit this afternoon so I had a look at the patch.\r\n\r\nThe comments are excellent! Thank you very much; they make it very clear.\r\nYour change seems correct to me. The code is also considerably cleaner\r\nby using visibleSize(), and reads better.\r\n\r\nHere are a few suggestions; none are worth holding up the patch for.\r\n\r\n- It might be nice to format your detailed comment for resolveAddedColumns()\r\nas a true javadoc comment for that method (which currently has no javadoc),\r\nrather than as an inline comment.\r\n\r\n- I recalled from my investigations with DERBY-1861 that some of this code\r\ngets exercised by various combinations of including \"*\" in the select list, and\r\nusing expressions in the order by list. So I tried a couple more test cases.\r\nThey didn't find any additional problems, but here they are anyway, in case you\r\nthink that they might add value to the regression suite:\r\n\r\n  select d3303.i as old_i, sum(d3303.k), d3303.* from d3303 group by k, i, j order by j;\r\n\r\n  select d3303.i as old_i, sum(d3303.k), d3303.* from d3303 group by k, i, j order by 4;\r\n\r\n  select d3303.i as old_i, sum(d3303.k), d3303.* from d3303 group by k, i, j order by k+2;\r\n\r\n+1 to commit.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-02-15T23:08:26.441+0000","updated":"2008-02-15T23:08:26.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12569459","id":"12569459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thank you very much for taking the time to review, Bryan.  I appreciate it!\r\n\r\nYour suggestions are great ones so I'm attaching a _v2 patch which incorporates them.  I did modify the comments a bit to try to be more accurate about what \"resolveAddedColumn()\" really does--esp. for the example query, it doesn't really look for a column corresponding to \"SUM(J)\", rather it looks for a column corresponding to \"this.addedColumnOffset\", which (in the old example) ends up being SUM(J).  I also changed the example to order by SUM(K) instead of SUM(J) in hopes of making it clearer (since there are two \"SUM(J)\"s in the old example).\r\n\r\nHopefully the new comments are not worse than the old ones...\r\n\r\nThanks again for the quick feedback!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-02-16T00:24:28.242+0000","updated":"2008-02-16T00:24:28.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12569510","id":"12569510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Patch 2 looks great, and changing that extra SUM(J) in the comments\r\ndoes indeed make it clearer. I have no additional suggestions to offer.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-02-16T05:39:35.590+0000","updated":"2008-02-16T05:39:35.590+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12569955","id":"12569955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Many thanks for the timely and useful feedback, Bryan!\r\n\r\nI committed the _v2 patch with svn # 628823:\r\n\r\n  URL: http://svn.apache.org/viewvc?rev=628823&view=rev\r\n\r\nIf tinderbox runs are clean over the next day or two, I plan to port this back to 10.3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-02-18T17:22:18.031+0000","updated":"2008-02-18T17:22:18.031+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12570304","id":"12570304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"The \"svn merge\" command from trunk to 10.3 had a conflict in orderby.sql.  From what I can tell it was perhaps a line-ending issue, though I'm not real sure.  In any event, I resolved the conflict and am attaching d3303_10_3_merge.patch, which is what I plan to commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-02-19T16:41:20.947+0000","updated":"2008-02-19T16:41:20.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12570751","id":"12570751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Ported the fix for this issue back to 10.3 by commiting d3303_10_3_merge.patch with svn # 629535:\r\n\r\n  URL: http://svn.apache.org/viewvc?rev=629535&view=rev\r\n\r\nDonatas, if you have a moment can you check to see if your issue is fixed with this commit, and report back?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-02-20T17:04:13.065+0000","updated":"2008-02-20T17:04:13.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12571111","id":"12571111","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"body":"Sorry, I have migrated to DB2 already (have changed jdbc driver, connection url, and so on), so I don't have development environment suitable for Derby any more. And I don't know, how to build version 10.3.2.2. I have attached db scripts, it shouldn't be difficult to run them and check whether this issue still holds.\r\n\r\nGood luck.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=donatasc","name":"donatasc","emailAddress":"donatas dot ciuksys at mif dot vu dot lt","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Donatas Ciuksys","active":true},"created":"2008-02-21T17:40:09.912+0000","updated":"2008-02-21T17:40:09.912+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12385772/comment/12571114","id":"12571114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Fixed in trunk and 10.3, original repro now runs without error, and tinderbox tests on 10.3 ran with no errors.  So closing the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-02-21T17:46:33.768+0000","updated":"2008-02-21T17:46:33.768+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3303/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0709b:"}}