{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12327847","self":"https://issues.apache.org/jira/rest/api/latest/issue/12327847","key":"DERBY-826","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-04-08 11:57:33.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22165","customfield_12310222":"1_*:*_1_*:*_7418889000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_34034997379","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-04-16T00:01:46.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-826/watchers","watchCount":0,"isWatching":false},"created":"2006-01-20T03:13:37.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12312185","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12312185","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12325220","key":"DERBY-668","self":"https://issues.apache.org/jira/rest/api/2/issue/12325220","fields":{"summary":"SysInfo does not print the right information when Derby is not loaded through the classpath.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-05-14T22:11:43.377+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11414","id":"11414","name":"Tools"}],"timeoriginalestimate":null,"description":"derby.jar is in the classpath here indirectly because derbynet.jar includes it through a manifest entry.\njava -cp jars/sane/derbynet.jar org.apache.derby.tools.sysinfo\n\n------------------ Java Information ------------------\nJava Version:    1.4.2\nJava Vendor:     IBM Corporation\nJava home:       C:\\Program Files\\IBM\\Java142\\jre\nJava classpath:  jars/sane/derbynet.jar\nOS name:         Windows XP\nOS architecture: x86\nOS version:      5.1\nJava user name:  djd\nJava user home:  C:\\Documents and Settings\\Administrator\nJava user dir:   c:\\_work\\svn_clean2\\trunk\njava.specification.name: Java Platform API Specification\njava.specification.version: 1.4\n--------- Derby Information --------\nJRE - JDBC: J2SE 1.4.2 - JDBC 3.0\n[C:\\_work\\svn_clean2\\trunk\\jars\\sane\\derbynet.jar] 10.2.0.0 alpha - (370500M)\n------------------------------------------------------\n----------------- Locale Information -----------------\nCurrent Locale :  [English/United States [en_US]]\nFound support for locale: [de_DE]\n         version: 10.2.0.0 alpha - (370500M)\nFound support for locale: [es]\n         version: 10.2.0.0 alpha - (370500M)\nFound support for locale: [fr]\n         version: 10.2.0.0 alpha - (370500M)\nFound support for locale: [it]\n         version: 10.2.0.0 alpha - (370500M)\nFound support for locale: [ja_JP]\n         version: 10.2.0.0 alpha - (370500M)\nFound support for locale: [ko_KR]\n         version: 10.2.0.0 alpha - (370500M)\nFound support for locale: [pt_BR]\n         version: 10.2.0.0 alpha - (370500M)\nFound support for locale: [zh_CN]\n         version: 10.2.0.0 alpha - (370500M)\nFound support for locale: [zh_TW]\n         version: 10.2.0.0 alpha - (370500M)\n------------------------------------------------------","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40020","summary":"sysinfo does not report the version of derby.jar if the class does not explictly contain it.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12327847/comment/12373711","id":"12373711","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"This patch attempts to locate the info properties files using getResource() first, and then through the classpath. This allows us to find the info properties files when loaded from mechanisms other than through the classpath, e.g. from the extensions directory, java -jar, the Class-Path attribute, etc. Also added javadoc for the methods that I touched.\r\n\r\nRelated to DERBY-668, this fixes the regular (non -cp) part of that issue.\r\n\r\nI will commit this early next week if there are no concerns.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-04-08T11:57:33.000+0000","updated":"2006-04-08T11:57:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12327847/comment/12374580","id":"12374580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Thanks for the helpful review, Bryan. \r\n\r\n1 - Yes, I removed this and an unused import from an experiment I had done previously.\r\n\r\n2 & 3 - A great suggestion on 3. I pulled out the formatting code and put it into a new method, formatURL. This also normalizes the path separators in the jar/directory locations, so the duplicates are properly removed for 2.\r\n\r\n4 - Added additional javadoc comments to mergeZips.\r\n\r\nLet me know if you think this needs any more refinement, otherwise I'd like to commit it soon.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-04-15T05:35:23.000+0000","updated":"2006-04-15T05:35:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12327847/comment/12374588","id":"12374588","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Andrew. Thank you for considering all my feedback. Your new patch looks very good to me. I have only one final concern. When I was spot-testing your patch, I noticed that, while the mergeZips method appears to strip duplicates out of zip1 entirely, and it strips out of zip2 any entries that also exist in zip1, it does not strip duplicates which exist twice in zip2.\r\n\r\nFor example, try running java -cp derby.jar:db2jcc.jar:db2jcc.jar:derbytools.jar sysinfo. I believe you will see info about db2jcc.jar being printed twice.\r\n\r\nI think this can be fixed by changing the zip2 processing loop in mergeZips so that, when it searches to see if the current entry duplicates an existing entry, it searches the entries in \"v\", rather than searching the entries in zip1.\r\n\r\nI've attached a proposed version 3 of the patch. The only substantive change between this version and your version is as follows:\r\n\r\n< +            for (int k = 0; k < zip1.length; k++)\r\n---\r\n> +            for (int k = 0; k < v.size(); k++)\r\n265c265,266\r\n< +                  if (zip1[k] == null)\r\n---\r\n> +                  ZipInfoProperties z = (ZipInfoProperties)v.get(k);\r\n> +                  if (z == null)\r\n267c268\r\n< +                  if (zip2[j].getLocation().equals(zip1[k].getLocation()))\r\n---\r\n> +                  if (zip2[j].getLocation().equals(z.getLocation()))\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-04-15T07:28:39.000+0000","updated":"2006-04-15T07:28:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12327847/comment/12374603","id":"12374603","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Good catch, Bryan!\r\n\r\nI'm attaching derby-826-v4.diff, which includes your changes plus the following:\r\n\r\n- removes the check for z == null in the second loop of mergeZips(). We already checked that elements being added to the vector are not null in the first loop.\r\n\r\n- catches possible NullPointerExceptions if loadZipFromResource() returns a null array. This is unlikely, but possible, if somehow sysinfo is able to run but is isolated from the info properties files so that it cannot load them using getResourceAsStream() or they don't exist. The corresponding diff in getAllInfo() is:\r\n\r\n+        // No info properties files found, but here we are in sysinfo.\r\n+        // Avoid an NPE in mergeZips by creating a ZipInfoProperties array\r\n+        // with the location of the sysinfo that is currently executing.\r\n+        if (zips == null)\r\n+        {\r\n+            zips = new ZipInfoProperties[1];\r\n+            ZipInfoProperties zip = new ZipInfoProperties(ProductVersionHolder.getProductVersionHolderFromMyEnv(org.apache.derby.tools.sysinfo.TOOLS));\r\n+            zip.setLocation(getFileWhichLoadedClass(new Main().getClass()));\r\n+            zips[0] = zip;\r\n+        }\r\n\r\nThis is looking pretty airtight. Do you see any other potential problems?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-04-15T15:26:44.000+0000","updated":"2006-04-15T15:26:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12327847/comment/12374635","id":"12374635","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"> Do you see any other potential problems?\r\n\r\nNope, this patch looks great; please check this puppy in!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-04-15T21:43:42.000+0000","updated":"2006-04-15T21:43:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12327847/comment/12374648","id":"12374648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Committed derby-826-v.diff with revision 394334.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-04-16T00:01:46.000+0000","updated":"2006-04-16T00:01:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12327847/comment/12495801","id":"12495801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"sysinfo now shows derby.jar information even if it's not explicitly in the classpath","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-05-14T22:11:43.373+0000","updated":"2007-05-14T22:11:43.373+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-826/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i077qn:"}}