{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12345805","self":"https://issues.apache.org/jira/rest/api/latest/issue/12345805","key":"DERBY-1502","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-07-12 04:06:21.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22543","customfield_12310222":"1_*:*_1_*:*_39100000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_21710006101","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-07-12T14:42:41.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1502/watchers","watchCount":0,"isWatching":false},"created":"2006-07-12T03:51:01.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-29T22:57:53.836+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"Sometimes I see the following failure in lang/grantRevokeDDL.sql. I have seen this on linux under jdk 1.4 and 1.5.\n\n560 del\n< ERROR 28508: User 'MAMTA3' does not have select permission on column 'C111' of table 'MAMTA2'.'V22'.\n560a560\n> ERROR 28508: User 'MAMTA3' does not have select permission on column 'C111' of table 'MAMTA2'.'V21'.\nTest Failed.\n*** End:   grantRevokeDDL jdk1.4.2_08 2006-07-11 13:38:51 ***\n\nIt would appear that when two permissions are inadequate, it's not clear which one will fail the statement.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38969","summary":"Non-deterministic behavior of lang/grantRevokeDDL.sql","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"linux, jdk1.4 and jdk 1.5","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":3,"total":3,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12345805/comment/12420437","id":"12420437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"There was some discussion on this diff in DERBY-1330 and on the derby list. I am copying them in chronological order here to track the discussion\r\n\r\n<start comment from Knut Anders Hatlen>\r\nI have seen this regression test failure a couple of times lately. Could it be related to this issue? \r\n\r\n********* Diff file derbyall/derbylang/grantRevokeDDL.diff \r\n*** Start: grantRevokeDDL jdk1.5.0_04 derbyall:derbylang 2006-07-10 09:56:26 *** \r\n560 del \r\n< ERROR 28508: User 'MAMTA3' does not have select permission on column 'C111' of table 'MAMTA2'.'V22'. \r\n560a560 \r\n> ERROR 28508: User 'MAMTA3' does not have select permission on column 'C111' of table 'MAMTA2'.'V21'. \r\nTest Failed. \r\n*** End: grantRevokeDDL jdk1.5.0_04 derbyall:derbylang 2006-07-10 09:56:37 *** \r\n\r\nIt seems to happen on both Solaris and Linux, JVM 1.4 and 1.5: \r\nhttp://www.multinet.no/~solberg/public/Apache/Derby/testlog/Linux-2.6.9-34.ELsmp_x86_64-x86_64/420328-derbylang_diff.txt \r\nhttp://www.multinet.no/~solberg/public/Apache/Derby/testlog/SunOS-5.10_i86pc-i386/420328-derbylang_diff.txt \r\nhttp://www.multinet.no/~solberg/public/Apache/DerbyJvm1.4/testlog/Linux-2.6.9-34.ELsmp_x86_64-x86_64/420328-derbyall_diff.txt \r\nhttp://www.multinet.no/~solberg/public/Apache/DerbyJvm1.4/testlog/SunOS-5.10_i86pc-i386/420328-derbyall_diff.txt \r\n\r\nIt does not happen on the tinderbox, though. \r\n<end comment from Knut Anders Hatlen>\r\n\r\n\r\n\r\n<start comment from Mamta Satoor>\r\nKnut, the diffs you are noticing is in one of the new tests that I added to grantRevokeDDL.sql \r\n\r\nThe diff is for following sql which is executed by mamta3(Note that mamta3 does not have SELECT privilege on mamta2.v22.c111 and on mamta2.v21.c111 but does have SELECT privilege on mamta1.t11) \r\n\r\ncreate view v33 as select v22.c111 as a, t11.c111 as b from mamta2.v22 v22, mamta1.t11 t11, mamta2.v21; \r\n\r\nWhen this create view is compiled by Derby, it collects the privileges required by the create view. Derby collects following privilege requirements for the create view sql above \r\n1)SELECT on mamta2.v22 \r\n2)SELECT on mamta1.t11 \r\n3)SELECT on mamta2.v21 \r\n4)ownership of the schema in which create view is being issued \r\n\r\nLater on, at create view execution time, Derby grows through the required privileges list and checks if mamta3 has the required privileges or not. And since mamta3 does not have the required privileges on mamta2.v22 and mamta2.v21, the create view fails. \r\n\r\nIn the diff that you posted above, both the error messages are correct. It seems like \r\n1)either the order in which the privilege requirements get added to the list in compile phase is not always the same \r\n2)or the order in which privileges get retrieved in the execution phase is not always the same \r\nand hence different error messages \r\n\r\nCompilerContextimpl.addRequiredTablePriv() has following \r\nrequiredTablePrivileges.put(key, key); \r\nand requiredTablePrivileges is defined as follows in CompilerContextimpl \r\nprivate HashMap requiredTablePrivileges; \r\n\r\nIs this a Java behavior that you can count on the order in which items will be added and retrieved from HashMap? \r\n\r\nAt this point, I am not sure, how to make sure that items get added and retrieved in the same order from the HashMap so that we will have consistent error message return from the create view sql above. Any insight from the list will be appreciated. \r\n<end comment from Mamta Satoor>\r\n\r\n\r\n\r\n\r\n<start comment from Mamta Satoor>\r\nMike responded following on the mailing list \r\n<quote> \r\nI do not believe you can count on the order of a HashMap, different \r\nJVM's may use different hash algo's which may result in different orders \r\nwhen you ask for the full list. I have seen this behavior in queries \r\nwhich use hash nodes in derby (I believe we first noticed a difference \r\nbetween j9 and other jvm's). In that case we added order by's as \r\nnecessary to the tests, as either order of results was correct from \r\nSQL point of view. \r\n\r\nIn your case is the order a code problem, or just a testing issue? \r\n</quote> \r\n\r\nFirst of all, thanks Mike for your response. \r\n\r\nAs to your question, the order is not a testing issue because test is simply trying a scenario where a user is trying to create a object based on more than one object on which the user doesn't have access to. And depending on how items got into HashMap, the test fails with privilege error on one object vs the other. So, in this case, the order is a code problem. \r\n<end comment from Mamta Satoor>\r\n\r\n\r\n\r\n<start comment from Mike Matrigali>\r\nIf the order of the error is not documented, then I am not sure it is a\r\ncode error.  Sort of similar to the fact that on different jvm's derby\r\nwill return rows in different orders for the same db, same query (unless\r\na specific order by is used).\r\nI would define it as a test problem, as the test assumes a specific\r\nerror where either of 2 errors is valid.\r\n\r\nThe code could use some sorting mechanism to guarantee an ordering, but\r\nit would have to be careful about the key (object id's could also vary\r\nfrom machine to machine, or time to time).  Doing so would likely mean\r\nmore memory and more code, doesn't seem worth it to me for this case -\r\nanyone think so?\r\n<end comment from Mike Matrigali>\r\n\r\n\r\n<start comment from Knut Anders Hatlen>\r\nI agree. Since the SQL state is equal in the two cases, I think a sed\r\nscript that strips everything but the message would be OK. Something\r\nlike this in grantRevokeDDL_sed.properties:\r\n\r\nsubstitute=^ERROR ([^:]*):.*$;ERROR: Failed with SQLSTATE $1\r\n\r\n\r\n> The code could use some sorting mechanism to guarantee an ordering, but\r\n> it would have to be careful about the key (object id's could also vary\r\n> from machine to machine, or time to time).  Doing so would likely mean\r\n> more memory and more code, doesn't seem worth it to me for this case -\r\n> anyone think so?\r\n\r\n\r\nPerhaps a LinkedHashMap would do the trick, but I agree, I don't think\r\nit's worth it.\r\n<end comment from Knut Anders Hatlen>\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-07-12T04:06:21.000+0000","updated":"2006-07-12T04:06:21.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12345805/comment/12420442","id":"12420442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Based on Knut's suggestion, I have created a sed file to remove the error messages from the test. This will mask the privilege ordering in the HashMap object. If the attached patch looks good, can someone please commit it?\r\n\r\nsvn stat -q\r\nA      java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\lang\\grantRevokeDDL_sed.properties\r\nM      java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\grantRevokeDDL.out","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2006-07-12T04:23:05.000+0000","updated":"2006-07-12T04:23:05.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12345805/comment/12420536","id":"12420536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks Mamta! Committed revision 421179.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2006-07-12T14:42:41.000+0000","updated":"2006-07-12T14:42:41.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1502/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07193:"}}