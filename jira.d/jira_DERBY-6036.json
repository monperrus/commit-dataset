{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12626358","self":"https://issues.apache.org/jira/rest/api/latest/issue/12626358","key":"DERBY-6036","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12310220":"2013-06-19 07:55:22.085","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"302949","customfield_12310222":null,"customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6036/watchers","watchCount":5,"isWatching":false},"created":"2013-01-07T15:10:26.897+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_triage10_11"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12365627","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12365627","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12636820","key":"DERBY-6109","self":"https://issues.apache.org/jira/rest/api/2/issue/12636820","fields":{"summary":"Allow CREATE SYNONYM for table function invocations.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-12-13T14:44:43.259+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"This also affects SELECTs from views wrapping RestrictedVTIs. Restrictions are pushed into a restricted VTI if you wrap it in a view. However, projections are not. I will attach a script showing this problem.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10362","value":"Performance","id":"10362"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10421","value":"Seen in production","id":"10421"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"250058","summary":"If you wrap a SELECT * view around a table, all of the columns are read from the base row even when you SELECT only a subset of the view columns.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10427","value":"Workaround attached","id":"10427"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":12,"total":12,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13545951","id":"13545951","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a repro, derby-6036.sql.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-07T15:12:22.121+0000","updated":"2013-01-07T15:12:22.121+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13546022","id":"13546022","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"If you wrap a base table in a view, it appears that the projection is not passed through to the base table. I am attaching derbyAST.xml, which is the printout of parse(), bind(), and optimize() ASTs produced by the following script when you use the XmlASTPrinter attached to DERBY-4415. From the printout, you can see the following:\r\n\r\n1) For the SELECT from a base table (select s_nr from t where ns_r = 3000), the optimizer wraps the base table in a ProjectRestrict node which projects out only two columns.\r\n\r\n2) However, for the SELECT from a view on that base table (select s_nr from vt where ns_r = 3000), the optimizer wraps the base table in a ProjectRestrict node which projects out ALL four columns in the table.\r\n\r\nHere is the script:\r\n\r\nconnect 'jdbc:derby:memory:db;create=true';\r\n\r\ncreate function integerList()\r\nreturns table( s_r int, s_nr int, ns_r int, ns_nr int )\r\nlanguage java\r\nparameter style derby_jdbc_result_set\r\nno sql\r\nexternal name 'org.apache.derbyTesting.functionTests.tests.lang.RestrictedVTITest.integerList';\r\n\r\ncreate view vf as select * from table( integerList() ) s;\r\n\r\ncreate table t ( s_r int, s_nr int, ns_r int, ns_nr int );\r\ninsert into t values ( 1, 2, 3, 4 ), ( 100, 200, 300, 400 ), ( 1000, 2000, 3000, 4000 ), ( 10000, 20000, 30000, 40000 );\r\ncreate view vt as select * from t;\r\n\r\ncreate procedure setInspector( visitorClassName varchar( 32672 ) )\r\nlanguage java\r\nparameter style java\r\nmodifies sql data\r\nexternal name 'ASTInspector.setInspector'\r\n;\r\n\r\ncall setInspector( 'XmlASTPrinter' );\r\n\r\nselect s_nr from t where ns_r = 3000;\r\nselect s_nr from table( integerList() ) s where ns_r = 3000;\r\n\r\nselect s_nr from vt where ns_r = 3000;\r\nselect s_nr from vf where ns_r = 3000;\r\n\r\ncall setInspector( null );\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-07T16:45:41.821+0000","updated":"2013-01-09T16:32:21.296+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13547178","id":"13547178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I have verified that there is no special jiggery-pokery to reduce the number of columns read from the base table when it is wrapped in a view. For the SELECT from the view (select s_nr from vt where ns_r = 3000), the whole row is read from the Store.\r\n\r\nFixing this performance problem may be a little tricky. The ProjectRestrict nodes are added by the optimizer AFTER the bind-phase has expanded the * in the view and concluded that ALL of the columns are being referenced.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-08T19:42:44.015+0000","updated":"2013-01-08T19:42:44.015+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13548547","id":"13548547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I don't think I'm ready to propose a solution to this issue. My feeling is that this requires more thought and experiment than I have time for right now. Before putting this issue aside, I want to record a couple notes:\r\n\r\n1) There is a workaround for this issue, viz., rewrite the query to eliminate the view.\r\n\r\n2) What queries are really affected by this problem? Affected queries are those in which the cost of materializing the unneeded columns is significant. For instance,\r\n\r\na) SELECTs of base tables with large rows which span multiple pages.\r\n\r\nb) SELECTs where the needed columns live in a covering index and a base table probe is needed to fetch the unneeded columns.\r\n\r\n3) Here are some problem cases which a solution needs to address:\r\n\r\na) SELECT * views. This is the original test case discussed by this issue:\r\n\r\n    create view vt as select * from t;\r\n    select s_nr from vt where ns_r = 3000;\r\n\r\nb) Views which explicitly SELECT columns not needed by the outer query:\r\n\r\n    create view vt1 as select s_r, s_nr from t where ns_r = 3000;\r\n    select s_nr from vt1;\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-09T14:49:24.532+0000","updated":"2013-01-09T14:49:24.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13548677","id":"13548677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6036-01-aa-testForRestrictionPushing.diff. This adds a test case to verify that restrictions are passed through the view but not projections. Committed at subversion revision 1430957.\r\n\r\nWhen we address this issue, we should adjust RestrictedVTITest.test_12_6036() to verify that projections are passed through also.\r\n\r\n\r\nTouches the following file:\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/RestrictedVTITest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-01-09T16:54:20.147+0000","updated":"2013-01-09T16:54:20.147+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13687744","id":"13687744","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Triaged for 10.11.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-06-19T07:55:22.085+0000","updated":"2013-06-19T07:55:22.085+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13687745","id":"13687745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The \"Affects version\" field could probably include all older versions here, but I didn't mark then now them since it's a fair amount of work to verify.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-06-19T07:57:29.996+0000","updated":"2013-06-19T07:57:29.996+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13846261","id":"13846261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhuddusa","name":"rhuddusa","emailAddress":"rhuddusa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rhuddusa&avatarId=18347","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rhuddusa&avatarId=18347","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rhuddusa&avatarId=18347","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rhuddusa&avatarId=18347"},"displayName":"Richard Huddleston","active":true},"body":"i'm working on a project that uses 1 derby function and n views of that 1 function to access data in a foreign database. for each foreign database table, we have a corresponding view in derby with the EXACT name of the table in the foreign database.\r\n\r\nwe were able to port our code over to derby by simply changing the jdbc connection params to derby instead of our foreign database, and all the code magically worked.  if we had to change to functions instead of views, we'd lose the flexibility of our code running against the foreign database or derby. i have 30+ developers who have existing sql in tons of different places and development languages that reference the table names / matching derby view name, it's not practical for us to change all the table.\r\n\r\nwhy performance matters.  i created a derby facade to our foreign database out there that supports bulk extractions .  that database shards data into 16 or more different slave machines. i use derby to issue a query to the \"master\" machine instructing all the slaves to send data back to derby. those slave machines in aggregate pump data to our derby facade machine at greater than 1 gigabit/sec, where the data flow lasts more than 30 seconds and we are network bandwidth constrained.  so, it's LOTS of data.  we have more than 8 fields, and this is a common thing in our facade:\r\nselect some_id from my_derby_function_view where theDate = '12/11/2013'\r\nselect count(some_id) from my_derby_function_view where theDate = '12/11/2013'\r\nbecause derby doesn't pass down the field names from the view into our function via initscan, our data flow is more than 8x larger than needed. if this bug were fixed, instead of say 32 seconds, our query would in 4 seconds if we knew which columns derby really needed.\r\n\r\nis there any way to motivate a fix for this bug ?\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhuddusa","name":"rhuddusa","emailAddress":"rhuddusa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rhuddusa&avatarId=18347","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rhuddusa&avatarId=18347","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rhuddusa&avatarId=18347","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rhuddusa&avatarId=18347"},"displayName":"Richard Huddleston","active":true},"created":"2013-12-12T12:02:24.064+0000","updated":"2013-12-12T12:02:24.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13846298","id":"13846298","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Richard,\r\n\r\nThanks for your detailed description of how this problem affects your production app. I have marked the issue as \"Seen in production.\" That will boost its urgency slightly. Voting for the issue will boost its urgency too.\r\n\r\nOne workaround would be to define a family of table functions and views for each table, one table function/view for each SELECT list. Then use those views in your queries. Unfortunately, that would involve changing the queries in your app.\r\n\r\nThanks,\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-12T13:27:08.133+0000","updated":"2013-12-12T13:27:08.133+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13847246","id":"13847246","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhuddusa","name":"rhuddusa","emailAddress":"rhuddusa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rhuddusa&avatarId=18347","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rhuddusa&avatarId=18347","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rhuddusa&avatarId=18347","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rhuddusa&avatarId=18347"},"displayName":"Richard Huddleston","active":true},"body":"We are trying to work around this issue by calling the function directly instead of the view, but have noticed that it would be much simpler if Derby VTI exposed the function name to the VTI implementation ResultSet .  i don't believe there currently is a way to access the function name in the VTI ResultSet class. \r\n\r\nWe are accessing n different remote data tables, each with its own table definition.  Thus in Derby, we must register n different functions. Note, we only need 1 implementation class of the function to actually get the data and return our custom ResultSet implementation. We'd prefer to NOT write a separate class and redeploy our application each time someone adds a new remote data table, as we have many actually derby instances running this codebase.\r\n\r\npseudo code / sql\r\n\r\nwe have to create register n function definitions in , for i in 1 .. n, where tableName_i is our ith table name, (tableName_i is like customers)\r\nregister derby function selectFromRemote_tableName_i('tableName_i')  java method is selectFromRemote.read , \r\n\r\nthen to call any specific function we have to write (pseudo sql)\r\n\r\nselect s.* from table ( selectFromRemote_customers('customers') ) s where custId = 2\r\n\r\nit would be MUCH cleaner if we could just\r\n\r\nregister a derby function with different names and no parameters \r\nso instead of selectFromRemote_customers, we would just register function \"customers\"\r\nand derby function customers is java method selectFromRemote.read , \r\n\r\nand then be able to call\r\nselect c.* from table ( customers() ) c where custId = 2\r\n\r\nthen our ResultSet implementation could access some variable about the function name, and we would use that in lieu of a function parameters (it would also save us having to declare function params when we register functions, which is tedious )\r\n\r\ni think in the future you may want to add more information about VTI function context, \r\nwould it be logical to add more stuff to VTIEnvironment and make VTIEnvironment available / applicable to all VTI resultsets, not just those that implement VTICosting ?  side question, if we did implement VTICosting , is it guaranteed that its methods will be called ?\r\n\r\nperhaps there should be a new VTIContextAware interface that has something like\r\ninit(VTIContext context)\r\nthat VTIContext for now could have just getFunctionName, but it would be also nice to have things like getFunctionComment so that instead of params to a function, we could also dynamically change a function's behaviour by altering JUST the comments of a regstered function, and NOT having to change all the queries which call the function and pass arguments.\r\n\r\nbecause that VTIContext is an interface you could continue to add methods to in the future you expose more information to the function., note it would have been nice if in RestrictedVTI, the initScan method took in an interface object like InitScanParams which had currently getColumnNames and getRestriction, that would probably have allowed this bug to be solved rather easily by just adding \"getFunctionName\" on that InitScanParams interface. \r\n\r\nPerhaps I should stop just being a writing critic and start writing something myself how easy would it be for me to start hacking up and contributing to the derby project myself ?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhuddusa","name":"rhuddusa","emailAddress":"rhuddusa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rhuddusa&avatarId=18347","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rhuddusa&avatarId=18347","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rhuddusa&avatarId=18347","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rhuddusa&avatarId=18347"},"displayName":"Richard Huddleston","active":true},"created":"2013-12-13T08:08:05.931+0000","updated":"2013-12-13T08:25:08.942+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13847492","id":"13847492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Richard,\r\n\r\nThese are all interesting suggestions for improving the api for table functions. I think this discussion deserves its own, separate JIRA.\r\n\r\nI understand your comments about the tedium of declaring table functions. Much of this tedium may be addressed by the optional foreignViews tool introduced in release 10.10.1: http://db.apache.org/derby/docs/10.10/tools/rtoolsoptforeignviews.html\r\n\r\nIf you're interested in contributing to Derby, a good place to start is here: http://db.apache.org/derby/derby_comm.html. Once you subscribe to the derby-dev mailing list, the community can guide you through the process.\r\n\r\nWelcome!\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-13T13:55:26.333+0000","updated":"2013-12-13T13:55:26.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12626358/comment/13847533","id":"13847533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhuddusa","name":"rhuddusa","emailAddress":"rhuddusa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rhuddusa&avatarId=18347","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rhuddusa&avatarId=18347","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rhuddusa&avatarId=18347","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rhuddusa&avatarId=18347"},"displayName":"Richard Huddleston","active":true},"body":"unfortunately we cannot use the foreign views / ForeignTableVTI as we are writing our own adapter to greenplum. \r\n\r\nwe use derby as a front end to greenplum. we use derby to parse the sql and then we submit the query to the greenplum master and instead of getting a result in the jdbc connection,  we do an ETL write to an external servlet which is running in derby.  ETLs in greenplum are VERY fast and prevent the bandwidth crunch on the master greenplum node.  In the ETL, EACH of our greenplum slaves reaches out individually to the derby instance to post back result sets, and does NOT use any resources on the master. Data gets pushed back to our derby instance at greater than 1 gbit/sec, and our resultset merges the multiple http posts back into a single result.  People love our derby frontend to greenplum, and now are thinking about other systems we should expose through derby. but our system is not as fast as it could be.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhuddusa","name":"rhuddusa","emailAddress":"rhuddusa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rhuddusa&avatarId=18347","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rhuddusa&avatarId=18347","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rhuddusa&avatarId=18347","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rhuddusa&avatarId=18347"},"displayName":"Richard Huddleston","active":true},"created":"2013-12-13T14:44:43.259+0000","updated":"2013-12-13T14:44:43.259+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6036/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i176q7:"}}