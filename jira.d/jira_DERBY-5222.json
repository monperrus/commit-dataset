{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12506617","self":"https://issues.apache.org/jira/rest/api/latest/issue/12506617","key":"DERBY-5222","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-05-13 06:57:49.724","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24718","customfield_12310222":"1_*:*_1_*:*_1189081412_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-05-23T08:42:00.738+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5222/watchers","watchCount":0,"isWatching":false},"created":"2011-05-09T14:23:59.412+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12339482","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12339482","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12501953","key":"DERBY-5144","self":"https://issues.apache.org/jira/rest/api/2/issue/12501953","fields":{"summary":"Intermittent \"connection refused\" errors in the compatibility tests","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12339154","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12339154","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12501953","key":"DERBY-5144","self":"https://issues.apache.org/jira/rest/api/2/issue/12501953","fields":{"summary":"Intermittent \"connection refused\" errors in the compatibility tests","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-10-25T17:09:40.844+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"The compatibility tests fail frequently on one platform (Solaris 10, x86 (32-bit), Java 7 ea b131). For example here: http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/sol32/1100759-compatibility_diff.txt\r\n\r\nFrom what's printed to the console, it looks like it fails to delete the database directory:\r\n\r\n> Failed deleting database dir '/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat'\r\n\r\nAnd then, when running the actual test, it fails to create the log directory on that location (presumably because one already exists):\r\n\r\nException in thread \"main\" java.sql.SQLException: Failed to start database 'wombat' with class loader sun.misc.Launcher$AppClassLoader@53c015, see the next exception for details.\r\n(...)\r\nCaused by: java.sql.SQLException: cannot create log file at directory /export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/log.\r\n(...)\r\nCaused by: ERROR XSLAQ: cannot create log file at directory /export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/log.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.log.LogToFile.getLogDirectory(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.log.LogToFile.getControlFileName(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.log.LogToFile.boot(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.bootLogFactory(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.setRawStoreFactory(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.RawStore.boot(Unknown Source)\r\n(...)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36223","summary":"Compatibility tests fail to delete database directory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":13,"total":13,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13030770","id":"13030770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The patch d5222-1a-logging.diff makes CompatibilityCombinations use a helper method from BaseTestCase to delete the database directory. That helper method has better logging when something goes wrong. At least we should be able to see which files it cannot delete. Committed to trunk with revision 1101059.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-09T15:20:35.399+0000","updated":"2011-05-09T15:20:35.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13031167","id":"13031167","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"This test has failed every day for a week now. But, of course, once we added extra logging to see what was going on, it didn't fail...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-10T13:04:32.777+0000","updated":"2011-05-10T13:04:32.777+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13032399","id":"13032399","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Failed again today: http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/testlog/sol32/1101932-compatibility_diff.txt\r\n\r\nIt looks like there's a problem with deleting some of the files in the seg0 directory, but it's hard to say exactly what the problem is.\r\n\r\nDeleting database dir '/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat'\r\n<assertDirectoryDeleted> attempt 1 left 37 files/dirs behind: 0=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d480.dat 1=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d490.dat 2=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d4b0.dat 3=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d4f0.dat 4=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d510.dat 5=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d4d0.dat 6=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d520.dat 7=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d550.dat 8=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d580.dat 9=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d5a0.dat 10=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d560.dat 11=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d5b0.dat 12=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d5d0.dat 13=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d630.dat 14=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d670.dat 15=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d690.dat 16=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d650.dat 17=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d6c0.dat 18=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d6f0.dat 19=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d720.dat 20=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d760.dat 21=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d770.dat 22=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d7e0.dat 23=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d810.dat 24=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d850.dat 25=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d880.dat 26=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d8b0.dat 27=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d8d0.dat 28=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d890.dat 29=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d8e0.dat 30=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d8c0.dat 31=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d930.dat 32=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d960.dat 33=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d9f0.dat 34=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/d9b0.dat 35=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/da10.dat 36=/export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat/seg0/da60.dat","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-12T13:23:56.663+0000","updated":"2011-05-12T13:23:56.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13032849","id":"13032849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"I'm puzzled by the output from the delete method and the test log file, but here is what I see:\r\n a) The first round of attempted deletes fails to delete 37 files.\r\n b) The next round fails with an assert because the database root directory isn't found:\r\n     junit.framework.AssertionFailedError: directory doesn't exist: /export/home/tmp/jagtmp/autoderbyN_regression/compatibility_3/log/wombat\r\n\r\nAt this point, these facts supports at least these two theories (assuming the Derby delete method is correct):\r\n 1) A \"delete race\" taking place (directory/files deleted from two or more threads/processes concurrently).\r\n 2) A bug in the VM, either misreporting the outcome of the deletions, or allowing non-empty directories to be deleted.\r\n\r\nHowever, looking at the files that couldn't be deleted, one sees that they are all stub files (starting with 'd' instead of 'c'). I don't know the specifics, but I believe stub files are deleted by Derby itself at certain times (for instance during/after a checkpoint?). That makes this bug a timing and/or order sensitive bug with respect to when the files are attempted deleted. One explanation is that Derby is still shutting down when the delete method obtains the list of files to delete, and when it tries to delete the stub files they have already been deleted by Derby.\r\n\r\nThis is merely a hypothesis, and it depends on whether the database server is shut down completely when the deletion begins.\r\nAnyone with knowledge about the runtime characteristics of the upgrade test around?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-05-13T06:57:49.724+0000","updated":"2011-05-13T06:57:49.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13032896","id":"13032896","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for those observations, Kristian!\r\n\r\nHow's this theory:\r\n\r\nThe embedded variant of the compat test doesn't wait for the forked process to shut down before it moves on to the next version (it does wait until is sees that the process prints \"OK\", but that doesn't mean every database thread has stopped). If a checkpoint happens to be running, the forked process could be deleting the stub conglomerates when we invoke removeDirectory().\r\n\r\nIf such a stub is deleted after removeDirectory() calls File.list() and before it actually calls delete(), it'll fail to delete it (since it's already deleted) and add it to the list of failed deletes. However, it will still try to delete the parent directory, and that's successful since there aren't any files there.\r\n\r\nThe code that deleted the directory before we switched to using BaseTestCase.removeDirectory() would give up as soon as one of the files couldn't be deleted, so the next test would fail because it found a half-deleted database. BaseTestCase.removeDirectory() is on the other extreme: it goes on trying to delete files even after it has failed to delete one, and gets surprised when it sees that it actually had succeeded.\r\n\r\nI can see these possible solutions (not mutually exclusive):\r\n\r\n1) Make the compatibility test wait for the forked process to complete.\r\n\r\n2) Stop BaseTestCase.removeDirectory() from failing if the reason why it couldn't delete a file was that the file no longer existed.\r\n\r\nWe should probably at least do 1. Not so sure about 2, since it usually means that there is a problem if we have a delete race, and it would be good to get it reported.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-13T08:07:30.894+0000","updated":"2011-05-13T08:07:30.894+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13032918","id":"13032918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"If that's how the test works, the theory sounds very reasonable.\r\n\r\nRegarding improvements, I'd opt for fixing the test logic and keeping BaseTestCase.removeDirectory as it is, exactly for the reason you mention, even though the method has actually succeeded in removing the directory.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2011-05-13T08:57:50.148+0000","updated":"2011-05-13T08:57:50.148+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13032926","id":"13032926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I think that's how the test works, yes. Attaching a patch (2a) that calls Process.waitFor() after having read the output from the process. The compatibility tests ran cleanly in my environment with the patch, so I committed it to trunk with revision 1102620. Let's see if this silences the test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-13T09:19:34.013+0000","updated":"2011-05-13T09:19:34.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13033949","id":"13033949","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Nope, that didn't do the trick. It's still failing...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-16T10:13:37.968+0000","updated":"2011-05-16T10:13:37.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13033996","id":"13033996","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"There are more processes that get started by the compatibility test and that we don't wait for to complete (for example the process in which the network server runs). Attaching yet another patch (3a) that waits for all processes started by the compatibility test before moving on to the next combination. Maybe this isn't what's causing the failures, but it's probably worth fixing in any case. The compatibility test ran cleanly in my environment with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-16T12:38:16.666+0000","updated":"2011-05-16T12:38:16.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13034021","id":"13034021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed revision 1103742.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-16T14:01:57.136+0000","updated":"2011-05-16T14:01:57.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13035324","id":"13035324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The test hasn't failed on that platform in the first two test cycles after the commit. It failed five times in a row just before the commit. So it looks promising, but let's give it a few more days before we declare victory.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-18T11:56:24.603+0000","updated":"2011-05-18T11:56:24.603+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13037798","id":"13037798","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The failure hasn't been seen again after the last commit. Marking the issue as resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-23T08:42:00.758+0000","updated":"2011-05-23T08:42:00.758+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506617/comment/13053190","id":"13053190","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Merged to 10.8. Committed revision 1138409.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-22T11:37:23.042+0000","updated":"2011-06-22T11:37:23.042+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5222/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06kav:"}}