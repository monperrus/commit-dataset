{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12413000","self":"https://issues.apache.org/jira/rest/api/latest/issue/12413000","key":"DERBY-4028","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313401","id":"12313401","description":"Head of 10.4 branch","name":"10.4.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-01-23 11:25:16.332","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23975","customfield_12310222":"3_*:*_1_*:*_1461750208_*|*_1_*:*_1_*:*_3108956871_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-03-16T12:53:13.787+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4028/watchers","watchCount":0,"isWatching":false},"created":"2009-01-22T15:14:46.708+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:52:13.773+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"}],"timeoriginalestimate":null,"description":"The following DDL allows two rows to be inserted with the same value in a column when a unique constraint on that column should prevent it. The select statement (see the end of the mail) produces:\r\n\r\nij> ALBUMID             |RANK       |YEARRELEAS&|ALBUM\r\n\r\n--------------------------------------------------------------------------------\r\n-----------------------------------------------------------------\r\n11100               |1          |1945       |\r\n\r\n13300               |1          |1966       |\r\n\r\n2000                |7          |1974       |Songs in the Key of Life\r\n\r\n88000               |12         |1971       |\r\n\r\n\r\n4 rows selected\r\n\r\nThe first two rows have the same rank value of 1 despite there being a unique constraint on that column.\r\n\r\nderby version: 10.4.1.3\r\n\r\nBryan Pendleton reproduced this and suggested that the problem \"is related to the fairly new feature of Derby\r\nwhich allows definition of a unique constraint on a null-able column\".\r\nhttps://issues.apache.org/jira/browse/DERBY-3330\r\n\r\nRedefining the rank column as 'not null' made the problem go away.\r\n\r\nI came across this after running a program that randomly makes inserts, updates, and deletes into this table. It usually takes between 500-600 DDL statements to make it happen. I then took the results and hand-pruned out as many statements as I could and tried to minimize the number of rows produced by the select statement, while still reproducing the issue. At this point it is very sensitive to any changes. For example, re-running the test after removing what appear to be redundantly inserted rows will make the problem go away, as will modifications to band and album names. It's all very strange.\r\n\r\nA very old version of Cloudscape (3.6.9), from which I am trying to upgrade, does not have this problem.\r\n\r\n-------------------------------------------------------------------------\r\ndrop table tra;\r\n\r\ncreate table tra (\r\n    albumId bigint,\r\n    rank int,\r\n    CONSTRAINT UNIQUE_RANK\r\n        UNIQUE(rank),\r\n    band varchar(100),\r\n    album varchar(100),\r\n    yearReleased int,\r\n    CONSTRAINT PK_TOPROCKALBUMS\r\n        PRIMARY KEY(albumId)\r\n);\r\n\r\ninsert into tra values(1000, 1, '', '', 1966);\r\ninsert into tra values(2000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(3000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(4000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(5000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(6000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(7000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(8000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(9000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(13000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(14000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(15000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(16000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(17000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(18000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(19000, 14, 'Joni ', 'Blue', 1971);\r\ninsert into tra values(20000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(21000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(22000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(23000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(24000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(25000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(26000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(27000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(28000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(29000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(30000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(31000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(32000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(33000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(34000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(36000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(36000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(37000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(38000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(39000, 1, 'The Beatles', '', 1966);\r\ninsert into tra values(40000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(41000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(42000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(43000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(44000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(45000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(46000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(47000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(48000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(49000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(50000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(51000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(52000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(53000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(54000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(55000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(56000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(57000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(59000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(60000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(61000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(62000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(63000, 1, 'The Beatles', '', 1966);\r\ndelete from tra where rank=1;\r\ninsert into tra values(64000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(65000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(66000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(67000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(68000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(69000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(70000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(71000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(72000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(73000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(74000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(75000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(76000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(77000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(78000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(79000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ndelete from tra where rank=14;\r\ninsert into tra values(80000, 14, 'Joni Mitchell', 'Blue', 1971);\r\ninsert into tra values(81000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(82000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(83000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(84000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(85000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(86000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(87000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(88000, 12, '', '', 1971);\r\ninsert into tra values(89000, 1, 'The Beatles', '', 1966);\r\ninsert into tra values(90000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(91000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(92000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(93000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(94000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(95000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(96000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(97000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(98000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(99000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10100, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10200, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10300, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10400, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10500, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ndelete from tra where rank=1;\r\ninsert into tra values(10600, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10700, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10800, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(10900, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11100, 1, 'The Beatles', '', 1966);\r\ninsert into tra values(11200, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11300, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11400, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11500, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11600, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11700, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11800, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(11900, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12100, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12200, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ndelete from tra where rank=14;\r\ninsert into tra values(12300, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12400, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\nupdate tra set yearReleased=1945 where rank=1;\r\ninsert into tra values(12500, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12600, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12700, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12800, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(12900, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(13000, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(13100, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(13200, 7, 'Stevie Wonder', 'Songs in the Key of Life', 1974);\r\ninsert into tra values(13300, 1, 'The Beatles', '', 1966);\r\nselect albumId, rank, yearReleased, album from tra order by rank;\r\nexit;\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10367","value":"Deviation from standard","id":"10367"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10366","value":"Wrong query result","id":"10366"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37257","summary":"two rows can be inserted with the same value in a column that a unique constraint on that column should prevent","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gmbradford","name":"gmbradford","emailAddress":"gmbradford at alcatel-lucent dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Glenn Bradford","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gmbradford","name":"gmbradford","emailAddress":"gmbradford at alcatel-lucent dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Glenn Bradford","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Windows XP","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10051","value":"Urgent","id":"10051"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":14,"total":14,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12666486","id":"12666486","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It seems like BTreeController.compareLeftAndRightSiblings() doesn't handle deleted records correctly. If it finds a committed deleted record with the same key, it thinks that it is OK to insert a new record with the same key. I guess this would have been an OK assumption in a unique index, but the UNIQUE constraint is backed by a non-unique index (because multiple NULLs are allowed), so if you find a deleted record you really need to move past that record and check again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-23T11:25:16.332+0000","updated":"2009-01-23T11:25:16.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12666530","id":"12666530","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The attached patch (check-deleted.diff) appears to fix the reported problem. What it does is:\r\n\r\n  1) Make BTreeController.compareRowsForInsert() return MATCH_FOUND even if the row is deleted, and say in its javadoc that callers should check if the row is deleted\r\n\r\n  2) Make BTreeController.comparePreviousRecord() and BTreeController.compareNextRecord() check if the found record is deleted, and if it is, move on to see if an existing record can be found\r\n\r\n  3) Make BTreeController.comparePreviousRecord() look at the record before the previous one instead of the record after the previous one if the previous doesn't match (probably a copy/paste error from compareNextRecord())\r\n\r\nI suspect that there may be other problems in comparePreviousRecord() and compareNextRecord(). At least it looks to me as if there are paths through those methods where we latch pages and never release them. I'm not 100% convinced that the slot boundary checks are correct either, but I'll need to double check that.\r\n\r\nI haven't run any tests on the patch, except the script that reproduced the bug, and I'm not sure if this is the correct way to fix it. But I'm posting it in case someone else wants to investigate the bug.\r\n\r\nWhat I find strange, though, is that if I remove any of the failing inserts right before the insert that incorrectly succeeds, the insertion of the duplicate is correctly rejected. I thought that the rejected inserts shouldn't change anything in the B-tree, but apparently they do.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-23T12:40:02.231+0000","updated":"2009-01-23T12:40:02.231+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12666550","id":"12666550","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Perhaps the rejected insert causes an internal page split, and then discovers\r\nthe non-uniqueness. It then terminates the insert processing, but leaves\r\nthe split? \r\n\r\nOr, similar, perhaps the rejected insert causes a page allocation, and then\r\nrefuses the insert but leaves the page allocated?\r\n\r\nThat is, maybe it's some sort of \"physical\" or \"structural\" change to the\r\nBTree that doesn't \"logically\" change the content of the Btree, so when we\r\nabort the user-level insert operation we leave the physical change as is?\r\n\r\nI'm just guessing; your overall approach seems great to me, and many thanks\r\nto the original reporter for tracking down this great repro script.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-01-23T14:42:58.896+0000","updated":"2009-01-23T14:42:58.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12667234","id":"12667234","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I guess you're right. But I still find it a bit odd that there is a difference between failing to add the value 7 to the index 119 times and failing to do so 120 times. I would have expected that the next attempt to insert the value would try to reuse the unused space allocated by the previous failed attempt rather than allocating space once more.\r\n\r\nOut of curiosity, I tried this code:\r\n\r\n        s.execute(\"create table d4028(x int unique)\");\r\n        while (true) {\r\n            try {\r\n                s.execute(\"insert into d4028 values 1\");\r\n            } catch (SQLException e) {\r\n                System.out.println(e);\r\n            }\r\n        }\r\n\r\nEven though it only inserts one row, the disk footprint just keeps growing. It's the disk footprint of the table that's growing, though, not the index, so it looks like the free space in the index is reused.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-01-26T12:53:35.304+0000","updated":"2009-01-26T12:53:35.304+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12673202","id":"12673202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The problem with the growing table has been logged as DERBY-4056.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-13T10:23:43.518+0000","updated":"2009-02-13T10:23:43.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12673444","id":"12673444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I have not had time to debug this or review any of the patches.  \r\n\r\nJust wanted to say what I believe the assumptions are for the btree, so that we don't add the\r\nwrong fixes.  \r\n\r\nA btree must be able to uniquely identify every row in the tree, it does this by comparing some\r\nnumber of the columns in the tree.  In the case of a unique btree it does this by comparing all\r\ncolumns except for last one.  In the case of a non-unique btree it does this by comparing all\r\ncollumns including the last one (which is the row id pointer of the base table).  To uniquely identify\r\nthis row, whether it is deleted or not does not matter, there is meant to be code in the case of\r\ndeleted rows to wait around to make sure there is only one value with respect to these cases.\r\n\r\nFor the new feature which allows a unique constraint, but allows multiple nulls - the implementation is meant to use a \"non-unique\" btree.  This means that rows, including deleted \r\nrows are allowed to be duplicate.   At insert time there is meant to be new code that allows duplicate null values but not other duplicates.  I assume there is a bug in that new code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2009-02-14T01:14:27.926+0000","updated":"2009-02-14T01:14:27.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12673446","id":"12673446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"the code that knut's patch is going at, is the new code so very likely the right place to fix this one.  Keep an eye out for the \"isUniqueWithDuplicateNulls\" paths.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2009-02-14T01:22:24.260+0000","updated":"2009-02-14T01:22:24.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12677315","id":"12677315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Here's a simpler way to reproduce the bug:\r\n\r\nij> create table t (x int unique);\r\n0 rows inserted/updated/deleted\r\nij> insert into t values 1,2,3;\r\n3 rows inserted/updated/deleted\r\nij> delete from t where x = 2;\r\n1 row inserted/updated/deleted\r\nij> update t set x = 2;\r\n2 rows inserted/updated/deleted\r\nij> select * from t;\r\nX          \r\n-----------\r\n2          \r\n2          \r\n\r\n2 rows selected","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-27T11:00:28.585+0000","updated":"2009-02-27T11:00:28.585+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12677384","id":"12677384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Uploading an updated patch (1a) which adds test cases to NullableUniqueConstraintTest. I haven't run any other tests yet. I still suspect that there are some problems with how the latches are released in these methods, but I'll investigate more and file a separate issue if that turns out to be the case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-27T14:54:08.569+0000","updated":"2009-02-27T14:54:08.569+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12677405","id":"12677405","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"With the patch NullableUniqueConstraintTest.testMixedInsertDelete() starts failing intermittently with an exception indicating that there's an attempt to unlatch a page that is not latched. I haven't investigated whether it's a problem with the patch or if the patch has exposed some of the existing latch problems that I've mentioned.\r\n\r\nCaused by: org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED\r\n        at org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:98)\r\n        at org.apache.derby.impl.store.raw.data.BasePage.unlatch(BasePage.java:1319)\r\n        at org.apache.derby.impl.store.access.btree.ControlRow.release(ControlRow.java:926)\r\n        at org.apache.derby.impl.store.access.btree.BTreeController.comparePreviousRecord(BTreeController.java:419)\r\n        at org.apache.derby.impl.store.access.btree.BTreeController.compareLeftAndRightSiblings(BTreeController.java:579)\r\n        at org.apache.derby.impl.store.access.btree.BTreeController.doIns(BTreeController.java:841)\r\n        at org.apache.derby.impl.store.access.btree.BTreeController.insert(BTreeController.java:1289)\r\n        at org.apache.derby.impl.store.access.btree.index.B2IController.insert(B2IController.java:210)\r\n        at org.apache.derby.impl.sql.execute.IndexChanger.insertAndCheckDups(IndexChanger.java:439)\r\n        at org.apache.derby.impl.sql.execute.IndexChanger.doInsert(IndexChanger.java:383)\r\n        at org.apache.derby.impl.sql.execute.IndexChanger.insert(IndexChanger.java:589)\r\n        at org.apache.derby.impl.sql.execute.IndexSetChanger.insert(IndexSetChanger.java:268)\r\n        at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:453)\r\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1022)\r\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:495)\r\n        at org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)\r\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)\r\n        ... 28 more","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-02-27T16:09:24.526+0000","updated":"2009-02-27T16:09:24.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12678277","id":"12678277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching an updated patch (1b). The assert failure was caused by some changes in how the latches were released in the previous patches. I changed it back and also added comments explaining the logic behind the releasing of the latches (but I think there's still a bug there, see DERBY-4080). This change made the intermittent assert failures go away.\r\n\r\nI'm running the regression tests now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-03-03T10:50:41.106+0000","updated":"2009-03-03T10:50:41.106+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12678329","id":"12678329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"All the regression tests ran cleanly. The patch is ready for review. A description of the approach can be found in the comment dated 23/Jan/09 04:40 AM. That comment mentioned possible problems with boundary checks. Those problems were fixed in DERBY-4027. It also mentioned potential problems with releasing of latches, and those problems have now been logged as DERBY-4080 and DERBY-4081.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-03-03T14:41:23.821+0000","updated":"2009-03-03T14:41:23.821+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12681248","id":"12681248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"There has been interest in doing a full rewrite of the code that inserts rows in an index backing a nullable unique constraint [1], which would make this fix unnecessary. But since it's getting close to the 10.5 release and the work on the rewrite hasn't started, I'm checking in the fix anyway to ensure that it will be fixed 10.5.\r\n\r\nCommitted revision 752826.\r\n\r\n[1] <URL:http://mail-archives.apache.org/mod_mbox/db-derby-dev/200903.mbox/%3C49AEBA96.5010609@sbcglobal.net%3E>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-03-12T10:24:54.064+0000","updated":"2009-03-12T10:24:54.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413000/comment/12682304","id":"12682304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Merged to 10.4 and committed revision 754881.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-03-16T12:53:13.620+0000","updated":"2009-03-16T12:53:13.620+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4028/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06qon:"}}