{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12601181","self":"https://issues.apache.org/jira/rest/api/latest/issue/12601181","key":"DERBY-5889","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12310220":"2012-08-14 18:55:18.895","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"241142","customfield_12310222":null,"customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5889/watchers","watchCount":4,"isWatching":false},"created":"2012-08-02T08:31:57.555+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_triage10_10"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12358586","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358586","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12355551","key":"DERBY-2076","self":"https://issues.apache.org/jira/rest/api/2/issue/12355551","fields":{"summary":"Rewrite junitTests/derbyNet/CompatibilityTest to conform to current JUnit usage","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-10-05T11:22:17.754+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"The modernized compatibility test fails for certain combinations on Windows Vista.\r\nIt is not clear to me why the failing combinations work on other platforms.\r\n\r\nErrors from http://dbtg.foundry.sun.com/derby/test/Daily/jvm1.7/testing/Limited/testSummary-1367634.html :\r\n1) combination(client 10.9.1.0 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.9.1.0 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")\r\n2) combination(client 10.8.2.2 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.8.2.2 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")\r\n3) combination(client 10.7.1.1 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.7.1.1 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")\r\n4) combination(client 10.6.2.1 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.6.2.1 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")\r\n5) combination(client 10.5.3.0 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.5.3.0 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")\r\n6) combination(client 10.4.2.1 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.4.2.1 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")\r\n7) combination(client 10.3.3.0 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.3.3.0 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")\r\n8) combination(client 10.2.2.1 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.2.2.1 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")\r\n9) combination(client 10.1.3.1 <> server 10.10.0.0)(org.apache.derbyTesting.functionTests.tests.compatibility.ClientCompatibilityRunControl)junit.framework.AssertionFailedError: client VM failed: :Spawned combination(client 10.1.3.1 <> server 10.10.0.0) exitCode=1\r\n1) JDBCDriverTest suitejava.security.AccessControlException: access denied (\"java.net.SocketPermission\" \"127.0.0.1:1527\" \"connect,resolve\")","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"9211","summary":"tests.compatibility._Suite has AccessControlException errors on Windows","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Windows Vista (possibly more variants)","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":14,"total":14,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13427175","id":"13427175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Looks like the failing runs are all with a non-trunk client.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-08-02T08:34:34.429+0000","updated":"2012-08-02T08:34:34.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13430326","id":"13430326","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Disabled the suite on Windows with revision 1370233 (patch 1a).\r\nWill look into the bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-08-07T13:02:05.018+0000","updated":"2012-08-07T13:02:05.018+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13430973","id":"13430973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"This bug doesn't reproduce on the Windows 7 and the Windows Vista (32-bit) machines I have available.\r\nI'll try to look at the runs that are failing and see if I can find some useful information there. The only lead I have so far is special paths, but I did try to run the tests from a directory with spaces in it. Now that I'm writing this, I realize I should try to put both trunk and the old releases in directories with spaces to see if that makes a difference.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-08-08T09:26:39.891+0000","updated":"2012-08-08T09:26:39.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13434034","id":"13434034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching a possible fix for this issue (patch 2a), which disabled the security manager for the client if the old releases live on a Windows network drive/mount (i.e. \"\\\\name\\dir\\dir\\file\").\r\n\r\nThe problem here is that I'm unable to insert a valid URL for the code source in the policy file. This leads to missing privileges.\r\nFrom the top of my head, I think these options are alternative solutions/work-arounds:\r\n o map the network mount to a drive letter\r\n o install a custom URL protocol handler\r\n o grant permissions without specifying code source\r\n   (this can probably be made somewhat conditional, i.e. by specifying nonsene values that are inserted into the policy file aka 'file://unsued' as used already).\r\n\r\nPatch ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-08-14T10:12:24.034+0000","updated":"2012-08-14T10:12:24.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13434119","id":"13434119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Updated patch 2 to deal with paths containing a mix of slash and back-slash. Not very likely, but the code gets more compact as side effect :)\r\n\r\nPatch ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-08-14T13:38:57.656+0000","updated":"2012-08-14T13:38:57.656+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13434385","id":"13434385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Just to verify that I've understood the details. The issue here is that we need to update the security policies to point to jar files for the old versions, and these references must be in the form of URLs. But, for some reason, the URLs produced by the test code are not usable in the policy files if the jar files are located on a Windows network drive. Is that correct? Where's the code that does this transformation? (I did a quick search for places in the test code where we convert java.io.File objects to java.net.URL or java.net.URI, which returned many hits, so I didn't immediately see which of these were used by the compatibility test.)\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-08-14T18:55:18.895+0000","updated":"2012-08-14T18:55:18.895+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13434407","id":"13434407","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"There's no explicit conversion as such.\r\nAccess using File works fine, the problem is the URLs in the security policy. These URLs are obtained by asking the VM where certain classes are loaded from (see SecurityManagerSetup).\r\nAssuming a CodeSource is defined for class X, you typically do \"X.class.getProtectionDomain().getCodeSource().getLocation()\". In some cases getCodeSource() returns null (see the docs).\r\n\r\nAlso note that in this case a new VM is forked for the client. The policy file is not updated in any other way than what happens normally, the only difference is the classpath (for instance \"c:\\derby\\lib\\derbyclient.jar\" vs \"\\\\myhost\\share\\derby\\lib\\derbyclient.jar\").","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-08-14T19:15:55.974+0000","updated":"2012-08-14T19:15:55.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13434490","id":"13434490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks. I noticed that the test code sometimes converted File to URL by using file.toURL().toExternalForm() and other times using file.toURI().toURL().toExternalForm(). The latter does some extra escaping of the network drive paths, so I thought maybe that could be related somehow.\r\n\r\nBut I'm wondering if this might be a product issue and not a test issue. For example, when I try to start the network server on Windows using a derbynet.jar located on a network drive, it refuses to start unless I specify -noSecurityManager:\r\n\r\nC:\\cygwin\\home\\lroot\\test> java -jar \\\\yme\\cluwin\\usr\\local\\share\\java\\derby\\lib\\10.9.1.0\\derbynet.jar start\r\nTue Aug 14 22:23:33 CEST 2012 : Security manager installed using the Basic server security policy.\r\nStartup failed due to missing functionality for org.apache.derby.iapi.services.stream.InfoStreams. Please ensure your classpath includes the correct Derby software.\r\nERROR XBM02: Startup failed due to missing functionality for org.apache.derby.iapi.services.stream.InfoStreams. Please ensure your classpath includes the correct Derby software.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.missingImplementation(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(Unknown Source)\r\n\tat org.apache.derby.impl.services.monitor.FileMonitor.<init>(Unknown Source)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Unknown Source)\r\n\tat org.apache.derby.iapi.jdbc.JDBCBoot.boot(Unknown Source)\r\n\tat org.apache.derby.jdbc.EmbeddedDriver.boot(Unknown Source)\r\n\tat org.apache.derby.jdbc.EmbeddedDriver.<clinit>(Unknown Source)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Unknown Source)\r\n\tat org.apache.derby.impl.drda.NetworkServerControlImpl.startNetworkServer(Unknown Source)\r\n\tat org.apache.derby.impl.drda.NetworkServerControlImpl.blockingStart(Unknown Source)\r\n\tat org.apache.derby.impl.drda.NetworkServerControlImpl.executeWork(Unknown Source)\r\n\tat org.apache.derby.drda.NetworkServerControl.main(Unknown Source)\r\n\r\nI think this is supposed to work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-08-14T20:41:11.809+0000","updated":"2012-08-14T20:41:11.809+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13434867","id":"13434867","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Regarding the various conversions, we sometimes need a URL (not the class, but the concept) and sometimes we need a path.\r\n\r\nI fixed a recent introduction of the escaping issue with DERBY-5897. I had a look for others, but haven't gotten around to verify that they are indeed problems yet.\r\n\r\nYour case above (currently) equals running with a security manager, but without a custom policy.\r\nBy adding \"grant { java.security.AllPermissions; };\" to the Derby policy file the above example works.\r\n\r\nI've been testing a lot of different things, and maybe I overlooked something. I don't remember any more if I tested doing the URL to URI to String conversion.\r\nWhat I did test was to create a separate URLClassLoader for jars on a Windows network drive. That worked, which suggests that either my changes didn't take effect in the right places for the policy file, or that the security manager does something else than the class loader when it comes to handling URLs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-08-15T07:53:52.089+0000","updated":"2012-08-15T07:53:52.089+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13434933","id":"13434933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I see that the network server starts successfully on a windows network drive, with the default policy, if NetworkServerControl.getCodeSourcePrefix() is modified to manually change a \"file://\" prefix to \"file:////\". So at least it looks like it should be possible to work around this issue on trunk.\r\n\r\nBut getting the already released versions to run with the default policy would be difficult, so the compatibility test probably needs a workaround like the one in your patch. Maybe we should add the workaround to the compatibility test here, and file a new bug to track the problem with running the network server on a network drive?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-08-15T10:07:24.574+0000","updated":"2012-08-15T10:07:24.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13438608","id":"13438608","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Thanks, Knut.\r\n\r\nI've logged and attached a patch to DERBY-5908. This will fix the issue with the network server, but not for the compatibility tests.\r\n\r\nI don't think we need the java.security.policy=<NONE> (Derby specific) workaround for the compatibility test, as the problem can be fixed in SecurityManagerSetup (the compatibility suite fires off test cases in separate VMs).\r\nI also expect a few other tests to fail due to path issues, but I'll get back to those later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-08-21T11:03:54.848+0000","updated":"2012-08-21T11:03:54.848+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13460028","id":"13460028","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I'm marking normal urgency, and patch available.\r\nKristian, are you still working on this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-09-20T22:53:09.434+0000","updated":"2012-09-20T22:53:09.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13469668","id":"13469668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Committed patch 1b to trunk with revision 1394250.\r\nIt relaxes the criteria for disabling the test, such that it will run on Windows as long as the old releases don't reside on a network drive / UNC path (i.e. \"\\\\myhost\\share\").\r\n\r\nThere is more work to make this work, but I don't think it is urgent. This hasn't worked for a long time...\r\n\r\nOne must ensure URLs/URIs have the host name in the path component, not in the authority component. Existing code in the Java API doesn't always make this happen, and one such example is ClassLoader.getResource[AsStream](String). So, some resources must be obtained manually, making sure the UNC path is correctly representedby the URL object.\r\nSome more information here: http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7195175\r\n\r\nThere are also some other issues, where paths inserted into security policy must be manipulated in the case of UNC paths. The general issue is that \"file://blabla\" must be converted to \"file:////blabla\". Some additional issues dealing with these paths when going from URL to File etc.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-10-04T20:42:05.132+0000","updated":"2012-10-04T20:42:05.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12601181/comment/13469670","id":"13469670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Clearing patch available. Patches 2x are not sufficient and should not be committed.\r\n\r\nI do plan to look at this later, but most likely it won't happen before early 2013. If someone wants to pick this up, feel free to.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2012-10-04T20:43:51.031+0000","updated":"2012-10-04T20:43:51.031+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5889/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i01xlb:"}}