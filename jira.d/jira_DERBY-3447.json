{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12389293","self":"https://issues.apache.org/jira/rest/api/latest/issue/12389293","key":"DERBY-3447","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-02-25 07:56:18.54","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23646","customfield_12310222":"1_*:*_1_*:*_3384788815_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-04-01T13:48:40.939+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3447/watchers","watchCount":0,"isWatching":false},"created":"2008-02-22T09:35:32.124+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"10.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12319590","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12319590","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"inwardIssue":{"id":"12391444","key":"DERBY-3541","self":"https://issues.apache.org/jira/rest/api/2/issue/12391444","fields":{"summary":"quit; on ij with authentication enabled does not shutdown the derby modules that are loaded","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:51:30.603+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312050","id":"12312050","name":"Replication"}],"timeoriginalestimate":null,"description":null,"customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37330","summary":"Shutdown on a database without stopping replication hangs","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":32,"total":32,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12572021","id":"12572021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"body":"I tried to start replication and then shutdown the master database, but did not get a hang. This may have been fixed in a recent commit. If you still get a hang, could you please submit a reproducible script? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"created":"2008-02-25T07:56:18.540+0000","updated":"2008-02-25T07:56:18.540+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12574946","id":"12574946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"body":"When replication has been set up in embedded using ij,\r\n\r\nconnect 'jdbc:derby:;shutdown=true'\r\nquit;\r\n\r\nworks fine on the master, whereas only\r\n\r\nquit;\r\n\r\nhangs. I'm not sure what the difference here is, but the thread stack reports that the log shipper thread is still alive. I think we shoul add cleanup code in MC#stop to get rid of this thread in the case that the module is unbooted without calling stopMaster or failover first. That happens e.g. for system shutdown.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jorgenlo","name":"jorgenlo","emailAddress":"jorgen dot loland at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jørgen Løland","active":true},"created":"2008-03-04T11:56:47.480+0000","updated":"2008-03-04T11:56:47.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12574952","id":"12574952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"The same operation also hangs on the slave.  Neither the log receiver thread nor the boot thread seems to have been terminated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-04T12:30:46.692+0000","updated":"2008-03-04T12:30:46.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12576054","id":"12576054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Modified the stop() method to call stopMaster in the attached patch.\r\n\r\nRan the following cases as repros, seems to run fine.\r\n\r\nRepro 1\r\n-------\r\n\r\nexit ij with quit;\r\n\r\nij version 10.4\r\nij> connect 'jdbc:derby:masterDB;user=oystein;password=pass;create=true';\r\nij> call syscs_util.syscs_freeze_database(); \r\n0 rows inserted/updated/deleted\r\nij> connect 'jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost;slavePort-8001';\r\nERROR XJ028: The URL 'jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost;slavePort-8001' is not properly formed.\r\nij> connect 'jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost;slavePort=8001';\r\nij(CONNECTION1)> quit;\r\nvn@vn-laptop:~/work/workspaces/Derby3447/master$ \r\n\r\nRepro 2\r\n-------\r\n\r\nexit ij, with system shutdown\r\n\r\nconnect 'jdbc:derby:;shutdown=true' \r\nand\r\nquit\r\n\r\nvn@vn-laptop:~/work/workspaces/Derby3447/master$ java org.apache.derby.tools.ij\r\nij version 10.4\r\nij> connect 'jdbc:derby:masterDB;user=oystein;password=pass;create=true';\r\nij> call syscs_util.syscs_freeze_database();\r\n0 rows inserted/updated/deleted\r\nij>  connect 'jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost;slavePort=8001';\r\nij(CONNECTION1)> connect 'jdbc:derby:;shutdown=true';\r\nERROR XJ015: Derby system shutdown.\r\nij(CONNECTION1)> quit;\r\nvn@vn-laptop:~/work/workspaces/Derby3447/master$ \r\n\r\nRepro 3\r\n--------\r\n\r\nexit ij, with database shutdown.\r\n\r\nvn@vn-laptop:~/work/workspaces/Derby3447/master$ java org.apache.derby.tools.ij\r\nij version 10.4\r\nij>  connect 'jdbc:derby:masterDB;user=oystein;password=pass;create=true';\r\nij>  call syscs_util.syscs_freeze_database();\r\n0 rows inserted/updated/deleted\r\nij>  connect 'jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost;slavePort=8001';\r\nij(CONNECTION1)> connect 'jdbc:derby:masterDB;shutdown=true';\r\nERROR 08006: Database 'masterDB' shutdown.\r\nij(CONNECTION1)> exit;\r\nvn@vn-laptop:~/work/workspaces/Derby3447/master$\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-07T06:40:19.057+0000","updated":"2008-03-07T06:40:19.057+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577345","id":"12577345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Hi, I tried the patch, but I still get I hang when I quit an ij that is running a master.\r\n(Since MasterController has moved, I modified the path in the diff file before applying the patch.)\r\n(I am runnig with classes.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-11T09:28:58.400+0000","updated":"2008-03-11T09:28:58.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577348","id":"12577348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":">Hi, I tried the patch, but I still get I hang when I quit an ij that is running a master.\r\n\r\nYou just did a quit; and it hanged? Surprising the repro worked for me. I will check this.\r\n\r\n>(Since MasterController has moved, I modified the path in the diff file before applying the patch.)\r\n\r\nJust modified the file names in the diff?\r\n\r\n>(I am runnig with classes.)\r\n\r\nWould this be different from running with the jars?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-11T09:35:27.046+0000","updated":"2008-03-11T09:35:27.046+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577389","id":"12577389","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I am not able to reproduce this problem on both embedded and network/client\r\n\r\nNetwork Client\r\n\r\nvn@vn-laptop:~/work/workspaces/Derby3447_1/master$ java org.apache.derby.tools.ij\r\nij version 10.5\r\nij> connect 'jdbc:derby://localhost:1527/replicationdb';\r\nij> connect 'jdbc:derby://localhost:1527/replicationdb;startMaster=true;slaveHost=localhost;slavePort=8001';\r\nij(CONNECTION1)> quit;\r\nvn@vn-laptop:~/work/workspaces/Derby3447_1/master$\r\n\r\nEmbedded\r\n\r\nvn@vn-laptop:~/work/workspaces/Derby3447_1/master$ java org.apache.derby.tools.ij\r\nij version 10.5\r\nij> connect 'jdbc:derby:masterDB;user=oystein;password=pass;create=true';\r\nij> call SYSCS_UTIL.SYSCS_FREEZE_DATABASE(); \r\n0 rows inserted/updated/deleted\r\nij> connect 'jdbc:derby:masterDB;user=oystein;password=pass;startMaster=true;slaveHost=localhost;slavePort=8001';\r\nij(CONNECTION1)> quit;\r\nvn@vn-laptop:~/work/workspaces/Derby3447_1/master$ \r\n\r\nCan you pls re-run and confirm on the current workspace to see if this problem is occurring?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-11T11:04:42.035+0000","updated":"2008-03-11T11:04:42.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577393","id":"12577393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"It works for me if I turn off authentication and SQL authorization.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-11T11:17:25.566+0000","updated":"2008-03-11T11:17:25.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577785","id":"12577785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I am not able to reproduce this problem on the network client (surprises me, Maybe I did something wrong!!). \r\nBut am able to reproduce this in the embedded mode. I did a jstack to find out what is hanging and found the\r\nfollowing relevant\r\n\r\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\nmaster\r\n\r\n\"Attach Listener\" daemon prio=10 tid=0x08312000 nid=0x2086 waiting on condition [0x00000000..0x00000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"DestroyJavaVM\" prio=10 tid=0x08059800 nid=0x2004 waiting on condition [0x00000000..0xb7dfc090]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"derby.master.logger-mydb\" prio=10 tid=0x08311800 nid=0x203b in Object.wait() [0xb5594000..0xb55950c0]\r\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c0b6180> (a org.apache.derby.impl.store.replication.master.AsynchronousLogShipper)\r\n        at org.apache.derby.impl.store.replication.master.AsynchronousLogShipper.run(AsynchronousLogShipper.java:203)\r\n        - locked <0x8c0b6180> (a org.apache.derby.impl.store.replication.master.AsynchronousLogShipper)\r\n\r\n\"derby.rawStoreDaemon\" daemon prio=10 tid=0x082b5c00 nid=0x2015 in Object.wait() [0xb5607000..0xb5608040]\r\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c61f0a0> (a org.apache.derby.impl.services.daemon.BasicDaemon)\r\n        at org.apache.derby.impl.services.daemon.BasicDaemon.rest(BasicDaemon.java:571)\r\n        - locked <0x8c61f0a0> (a org.apache.derby.impl.services.daemon.BasicDaemon)\r\n        at org.apache.derby.impl.services.daemon.BasicDaemon.run(BasicDaemon.java:388)\r\n        at java.lang.Thread.run(Thread.java:619)\r\n\r\n\"Timer-0\" daemon prio=10 tid=0x08294000 nid=0x2014 in Object.wait() [0xb5666000..0xb5666fc0]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c5d47b0> (a java.util.TaskQueue)\r\n        at java.lang.Object.wait(Object.java:485)\r\n        at java.util.TimerThread.mainLoop(Timer.java:483)\r\n        - locked <0x8c5d47b0> (a java.util.TaskQueue)\r\n        at java.util.TimerThread.run(Timer.java:462)\r\n\r\n\"derby.antiGC\" daemon prio=10 tid=0x08213c00 nid=0x2013 in Object.wait() [0xb56ba000..0xb56baf40]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c5870a8> (a org.apache.derby.impl.services.monitor.AntiGC)\r\n        at java.lang.Object.wait(Object.java:485)\r\n        at org.apache.derby.impl.services.monitor.AntiGC.run(BaseMonitor.java:2196)\r\n        - locked <0x8c5870a8> (a org.apache.derby.impl.services.monitor.AntiGC)\r\n        at java.lang.Thread.run(Thread.java:619)\r\n\r\n\"Low Memory Detector\" daemon prio=10 tid=0x0808e000 nid=0x200a runnable [0x00000000..0x00000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"CompilerThread0\" daemon prio=10 tid=0x0808c400 nid=0x2009 waiting on condition [0x00000000..0xb5a5b858]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"Signal Dispatcher\" daemon prio=10 tid=0x0808b000 nid=0x2008 runnable [0x00000000..0xb5aace20]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"Finalizer\" daemon prio=10 tid=0x08082800 nid=0x2007 in Object.wait() [0xb5b3c000..0xb5b3d0c0]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c551968> (a java.lang.ref.ReferenceQueue$Lock)\r\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:116)\r\n        - locked <0x8c551968> (a java.lang.ref.ReferenceQueue$Lock)\r\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:132)\r\n        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\r\n\r\n\"Reference Handler\" daemon prio=10 tid=0x08081800 nid=0x2006 in Object.wait() [0xb5b8d000..0xb5b8e040]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c5519f8> (a java.lang.ref.Reference$Lock)\r\n        at java.lang.Object.wait(Object.java:485)\r\n        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\r\n        - locked <0x8c5519f8> (a java.lang.ref.Reference$Lock)\r\n\r\n\"VM Thread\" prio=10 tid=0x08080000 nid=0x2005 runnable \r\n\r\n\"VM Periodic Task Thread\" prio=10 tid=0x0808f800 nid=0x200b waiting on condition \r\n\r\nJNI global references: 690\r\n\r\n-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\nSlave\r\n\r\n\"Attach Listener\" daemon prio=10 tid=0x0820ac00 nid=0x2092 runnable [0x00000000..0x00000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"DestroyJavaVM\" prio=10 tid=0x08059800 nid=0x2029 waiting on condition [0x00000000..0xb7d66090]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"derby.slave.logger-mydb\" prio=10 tid=0x0820f000 nid=0x203a runnable [0xb54ac000..0xb54acf40]\r\n   java.lang.Thread.State: RUNNABLE\r\n        at java.net.SocketInputStream.socketRead0(Native Method)\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:129)\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:182)\r\n        at java.io.ObjectInputStream$PeekInputStream.peek(ObjectInputStream.java:2247)\r\n        at java.io.ObjectInputStream$BlockDataInputStream.peek(ObjectInputStream.java:2540)\r\n        at java.io.ObjectInputStream$BlockDataInputStream.peekByte(ObjectInputStream.java:2550)\r\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1297)\r\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:351)\r\n        at org.apache.derby.impl.store.replication.net.SocketConnection.readMessage(SocketConnection.java:84)\r\n        at org.apache.derby.impl.store.replication.net.ReplicationMessageReceive.readMessage(ReplicationMessageReceive.java:387)\r\n        at org.apache.derby.impl.store.replication.slave.SlaveController$SlaveLogReceiverThread.run(SlaveController.java:476)\r\n\r\n\"derby.rawStoreDaemon\" daemon prio=10 tid=0x083bc800 nid=0x2039 in Object.wait() [0xb5503000..0xb5503fc0]\r\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c1201b8> (a org.apache.derby.impl.services.daemon.BasicDaemon)\r\n        at org.apache.derby.impl.services.daemon.BasicDaemon.rest(BasicDaemon.java:571)\r\n        - locked <0x8c1201b8> (a org.apache.derby.impl.services.daemon.BasicDaemon)\r\n        at org.apache.derby.impl.services.daemon.BasicDaemon.run(BasicDaemon.java:388)\r\n        at java.lang.Thread.run(Thread.java:619)\r\n\r\n\"derby.slave.boot-mydb\" prio=10 tid=0x083bc400 nid=0x2038 in Object.wait() [0xb5570000..0xb5571040]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c120268> (a java.lang.Object)\r\n        at java.lang.Object.wait(Object.java:485)\r\n        at org.apache.derby.impl.store.raw.log.LogToFile.recover(LogToFile.java:712)\r\n        - locked <0x8c120268> (a java.lang.Object)\r\n        at org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:334)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\r\n        at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\r\n        at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427)\r\n        at org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:1999)\r\n        at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:553)\r\n        at org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427)\r\n        at org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:789)\r\n        at org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:205)\r\n        at org.apache.derby.impl.db.SlaveDatabase.bootBasicDatabase(SlaveDatabase.java:421)\r\n        at org.apache.derby.impl.db.SlaveDatabase.access$000(SlaveDatabase.java:70)\r\n        at org.apache.derby.impl.db.SlaveDatabase$SlaveDatabaseBootThread.run(SlaveDatabase.java:308)\r\n        at java.lang.Thread.run(Thread.java:619)\r\n\r\n\"Timer-0\" daemon prio=10 tid=0x0816d800 nid=0x2036 in Object.wait() [0xb55cf000..0xb55d0140]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c5d4980> (a java.util.TaskQueue)\r\n        at java.lang.Object.wait(Object.java:485)\r\n        at java.util.TimerThread.mainLoop(Timer.java:483)\r\n        - locked <0x8c5d4980> (a java.util.TaskQueue)\r\n        at java.util.TimerThread.run(Timer.java:462)\r\n\r\n\"derby.antiGC\" daemon prio=10 tid=0x08062400 nid=0x2035 in Object.wait() [0xb5623000..0xb5623dc0]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c587550> (a org.apache.derby.impl.services.monitor.AntiGC)\r\n        at java.lang.Object.wait(Object.java:485)\r\n        at org.apache.derby.impl.services.monitor.AntiGC.run(BaseMonitor.java:2196)\r\n        - locked <0x8c587550> (a org.apache.derby.impl.services.monitor.AntiGC)\r\n        at java.lang.Thread.run(Thread.java:619)\r\n\r\n\"Low Memory Detector\" daemon prio=10 tid=0x0808e000 nid=0x202f runnable [0x00000000..0x00000000]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"CompilerThread0\" daemon prio=10 tid=0x0808c400 nid=0x202e waiting on condition [0x00000000..0xb59c59d8]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"Signal Dispatcher\" daemon prio=10 tid=0x0808b000 nid=0x202d runnable [0x00000000..0xb5a16ca0]\r\n   java.lang.Thread.State: RUNNABLE\r\n\r\n\"Finalizer\" daemon prio=10 tid=0x08082800 nid=0x202c in Object.wait() [0xb5aa6000..0xb5aa7040]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c551960> (a java.lang.ref.ReferenceQueue$Lock)\r\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:116)\r\n        - locked <0x8c551960> (a java.lang.ref.ReferenceQueue$Lock)\r\n        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:132)\r\n        at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\r\n\r\n\"Reference Handler\" daemon prio=10 tid=0x08081800 nid=0x202b in Object.wait() [0xb5af7000..0xb5af80c0]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c5519f0> (a java.lang.ref.Reference$Lock)\r\n        at java.lang.Object.wait(Object.java:485)\r\n        at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\r\n        - locked <0x8c5519f0> (a java.lang.ref.Reference$Lock)\r\n\r\n\"VM Thread\" prio=10 tid=0x08080000 nid=0x202a runnable \r\n\r\n\"VM Periodic Task Thread\" prio=10 tid=0x0808f800 nid=0x2030 waiting on condition \r\n\r\nJNI global references: 732\r\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------------","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-12T10:14:56.143+0000","updated":"2008-03-12T10:14:56.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577788","id":"12577788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"This shows that\r\n\r\n\"derby.master.logger-mydb\" prio=10 tid=0x08311800 nid=0x203b in Object.wait() [0xb5594000..0xb55950c0]\r\n   java.lang.Thread.State: TIMED_WAITING (on object monitor)\r\n        at java.lang.Object.wait(Native Method)\r\n        - waiting on <0x8c0b6180> (a org.apache.derby.impl.store.replication.master.AsynchronousLogShipper)\r\n        at org.apache.derby.impl.store.replication.master.AsynchronousLogShipper.run(AsynchronousLogShipper.java:203)\r\n        - locked <0x8c0b6180> (a org.apache.derby.impl.store.replication.master.AsynchronousLogShipper) \r\n\r\nthe log shipper thread is still running causing the hang in the master\r\n\r\nThis shows that\r\n\r\nderby.slave.logger-mydb\" prio=10 tid=0x0820f000 nid=0x203a runnable [0xb54ac000..0xb54acf40]\r\n   java.lang.Thread.State: RUNNABLE\r\n        at java.net.SocketInputStream.socketRead0(Native Method)\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:129)\r\n        at java.net.SocketInputStream.read(SocketInputStream.java:182)\r\n        at java.io.ObjectInputStream$PeekInputStream.peek(ObjectInputStream.java:2247)\r\n        at java.io.ObjectInputStream$BlockDataInputStream.peek(ObjectInputStream.java:2540)\r\n        at java.io.ObjectInputStream$BlockDataInputStream.peekByte(ObjectInputStream.java:2550)\r\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1297)\r\n        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:351)\r\n        at org.apache.derby.impl.store.replication.net.SocketConnection.readMessage(SocketConnection.java:84)\r\n        at org.apache.derby.impl.store.replication.net.ReplicationMessageReceive.readMessage(ReplicationMessageReceive.java:387)\r\n        at org.apache.derby.impl.store.replication.slave.SlaveController$SlaveLogReceiverThread.run(SlaveController.java:476) \r\n\r\nThe SlaveLogReceiver thread is hanging on the read method of the socket it is listening on causing the hang on the slave.\r\n\r\nThe questions I am searching for answers now is\r\n\r\n1) Why is this happening only in the embedded mode?\r\n\r\n2) How does turning authentication on affect this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-12T10:19:55.795+0000","updated":"2008-03-12T10:19:55.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577790","id":"12577790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Fixed the earlier broken patch for the new trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-12T10:26:43.233+0000","updated":"2008-03-12T10:26:43.233+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577863","id":"12577863","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"V.Narayanan (JIRA) wrote:\r\n> I am not able to reproduce this problem on the network client (surprises me, Maybe I did something wrong!!). \r\n\r\nThis may be ovious, but to be sure:  Note that when embedded a quit in ij will stop the VM that contains the master.  If client/server, the master is running in a separate VM.  I not quite sure you will necessarily get the same code path by stopping a server.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-12T14:45:11.683+0000","updated":"2008-03-12T14:45:11.683+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12577876","id":"12577876","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I understand that the code path will be different in the case of the \r\nclient. But I am confused about its import.\r\n\r\nAre you trying to say that the problem of the log shipper thread \r\nclean-up not happening might still be there\r\nin the client but our current way of trying to reproduce the problem is \r\nnot right? (or)\r\n\r\nAre you trying to say that this problem need not be looked from the \r\nclient perspective at all (I think you don't mean\r\nthis but just to be sure)\r\n\r\nI am trying to work with the embedded reproducible for now.\r\n\r\nBut from your comment it looks like finding a solution in the embedded \r\ncase might not necessarily mean that this\r\nproblem has been solved in all cases?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-12T15:34:47.142+0000","updated":"2008-03-12T15:34:47.142+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12578200","id":"12578200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"V.Narayanan (JIRA) wrote:\r\n> Are you trying to say that the problem of the log shipper thread \r\n> clean-up not happening might still be there\r\n> in the client but our current way of trying to reproduce the problem is \r\n> not right? (or)\r\n\r\nNo, my point is that there will never be a log shipper problem in the client, because the log shipper is running in the server.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-13T09:41:50.675+0000","updated":"2008-03-13T09:41:50.675+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12578293","id":"12578293","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"With the Derby3447_v2.diff patch, the replication test suite fails as follows:\r\n\r\n> java junit.textui.TestRunner -noloading org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationSuite ...F...\r\nTime: 536.931\r\nThere was 1 failure:\r\n1) testReplication_Local_StateTest_part1_1(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1)junit.framework.AssertionFailedError: jdbc:derby://localhost:4527//export/tmp/oysteing/derby-repl/testing_repl/db_slave/wombat;stopSlave=true failed: -1 XRE11 DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE11, SQLERRMC: stopSlave/export/tmp/oysteing/derby-repl/testing_repl/db_slave/wombatXRE11\r\n        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1._testPostStartedMasterAndSlave_StopSlave(ReplicationRun_Local_StateTest_part1_1.java:222)\r\n        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1.testReplication_Local_StateTest_part1_1(ReplicationRun_Local_StateTest_part1_1.java:130)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\r\nFAILURES!!!\r\nTests run: 6,  Failures: 1,  Errors: 0\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-13T13:51:02.215+0000","updated":"2008-03-13T13:51:02.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12578688","id":"12578688","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Thank you for the inputs Oystein.\r\n\r\nI have been single stepping this issue and will briefly try to describe my progress so far.\r\n\r\nI tried calling the stopMaster() method from RawStore#stop() to check if this will help me\r\nin determining if this would help result in a proper master shutdown. It did not.\r\n\r\nI resorted to good old single stepping with my buddy Netbeans\r\n\r\nI placed breakpoints in the following places\r\n\r\n1) ij#quit() line no 342\r\n2) TopService#shutdown() line no 327 (I did this after I did one round of single stepping with 3) below)\r\n3) MasterController#stopMaster() line no 262\r\n\r\nI basically started ij with the following command\r\n\r\njava -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=9009 org.apache.derby.tools.ij\r\n\r\nand connected to it through netbeans\r\n\r\nI basically observed the following when authentication is enabled\r\n\r\n1) MasterController#stopMaster() is never called (called when authentication is not enabled)\r\n2) TopService#shutdown() is never called with authentication enabled ( I tried this twice and observed the\r\n   same this. Shouldn't the modules that are currently loaded be shutdown when authentication is enabled too?\r\n   I am not sure how replication code can influence this.)\r\n\r\nI need to basically take it from here. I decided to report because I thought maybe people\r\ncould guide me as to why TopService#shutdown() is not called with authentication enabled and as to whether\r\nthis is something they know of?\r\n\r\nTopService#shutdown() is however called when I do a connect 'jdbc:derby:;shutdown=true;user=oystein;password=pass';","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-14T11:19:27.695+0000","updated":"2008-03-14T11:19:27.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12578739","id":"12578739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I did a little bit more digging on a more generalized behaviour when authentication\r\nis enabled in the embedded mode and raised https://issues.apache.org/jira/browse/DERBY-3541\r\nto address this issue.\r\n\r\nThis issue depends on DERBY-3451 to be resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-14T13:55:45.945+0000","updated":"2008-03-14T13:55:45.945+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579160","id":"12579160","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"When I found out about Derby-3451 I was thinking why the quit without\r\nstarting replication does not seem to hang. I found out that it does not\r\nhang because the other threads used in derby are Daemon threads .\r\n\r\nsee BaseMonitor#getDaemonThread (line no 2080)\r\n\r\nrelevant lines\r\n\r\nThread t =  new Thread(daemonGroup, task, \"derby.\".concat(name));\r\nt.setDaemon(true);\r\n\r\nfound \"The Java Virtual Machine exits when the only threads running are all daemon threads.\"\r\nhere http://java.sun.com/j2se/1.3/docs/api/java/lang/Thread.html#setDaemon(boolean)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-16T04:41:25.652+0000","updated":"2008-03-16T04:41:25.652+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579175","id":"12579175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I believe it is not right for the replication threads to prevent the jvm running\r\nan embedded application (like ij) from shutting down. These threads should also\r\nbe brought down along with the jvm. Hence I believe that the replication\r\nthreads should be daemon threads so that when the vm exits these threads\r\nare also brought down along with the vm.\r\n\r\nConverting the following replication related threads to\r\nDaemon threads resolved the problem of these threads blocking\r\nthe ij process from executing a quit; on both the master and\r\nthe slave.\r\n\r\n1)  Slave database boot thread (slave)\r\n2)  Log receiver thread (slave)\r\n3)  Log shipper thread (master)\r\n\r\nI will run the replication suite of tests and shall revert back with\r\nresults for this patch.\r\n\r\nI request for this patch to be please considered for reviews/comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-16T09:22:08.510+0000","updated":"2008-03-16T09:22:08.510+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579176","id":"12579176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I was able to quit ij with authentication enabled on both the master\r\nand slave with patch v3.\r\n\r\nOn the Master\r\n-----------------\r\n\r\nvn@vn-laptop:~/work/workspaces/Derby3447_1/master$ java org.apache.derby.tools.ij\r\nij version 10.5\r\nij>  connect 'jdbc:derby:mydb;create=true;user=oystein;password=pass';\r\nij>  call syscs_util.syscs_freeze_database();\r\n0 rows inserted/updated/deleted\r\nij> connect 'jdbc:derby:mydb;user=oystein;password=pass;startMaster=true;slaveHost=localhost;slavePort=8001';\r\nij(CONNECTION1)> create table narayanan(i int, name varchar(30));\r\n0 rows inserted/updated/deleted\r\nij(CONNECTION1)> insert into narayanan values(2,'n1');\r\n1 row inserted/updated/deleted\r\nij(CONNECTION1)> insert into narayanan values(3, 'n2');\r\n1 row inserted/updated/deleted\r\nij(CONNECTION1)> quit;\r\nvn@vn-laptop:~/work/workspaces/Derby3447_1/master$\r\n\r\nOn the slave\r\n-------------\r\n\r\nij version 10.5\r\nij>  connect 'jdbc:derby:mydb;user=oystein;password=pass;startSlave=true;slaveHost=localhost;slavePort=8001';\r\nERROR XRE08: Replication slave mode started successfully for database 'mydb'. Connection refused because the database is in replication slave mode. \r\nij> quit;\r\nvn@vn-laptop:~/work/workspaces/Derby3447_1/slave$\r\n\r\nI tried it in both orders also (i.e.) first trying a quit on the master and then a quit on the slave\r\nand vice versa.\r\n\r\nI also tried quit without executing any transactions on the master and in both orders.\r\n\r\nIt worked fine for me in all the cases with patch v3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-16T09:29:58.623+0000","updated":"2008-03-16T09:31:18.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579348","id":"12579348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I ran the replication suite of tests and observed this failure. I am investigating this failure.\r\n\r\n java -Xmx512m -XX:MaxPermSize=128M junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationSuite\r\n...F...\r\nTime: 542.146\r\nThere was 1 failure:\r\n1) testReplication_Local_StateTest_part1_1(org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1)junit.framework.AssertionFailedError: jdbc:derby://localhost:4527//home/vn/work/workspaces/Derby3447_1/tests/db_slave/wombat;stopSlave=true failed: -1 XRE11 DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE11, SQLERRMC: stopSlave/home/vn/work/workspaces/Derby3447_1/tests/db_slave/wombatXRE11\r\n        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1._testPostStartedMasterAndSlave_StopSlave(ReplicationRun_Local_StateTest_part1_1.java:222)\r\n        at org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationRun_Local_StateTest_part1_1.testReplication_Local_StateTest_part1_1(ReplicationRun_Local_StateTest_part1_1.java:130)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:23)\r\n\r\nFAILURES!!!\r\nTests run: 6,  Failures: 1,  Errors: 0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-17T08:46:35.314+0000","updated":"2008-03-17T08:46:35.314+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579358","id":"12579358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"This error looks like what if run with classes instead of jar files.  Is this the case for you?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-17T09:27:47.337+0000","updated":"2008-03-17T09:27:47.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579361","id":"12579361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I ran my tests with the jars Oystein, I observed this error when run with jars","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-17T09:31:42.330+0000","updated":"2008-03-17T09:31:42.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579387","id":"12579387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Sorry the comment I deleted was a click too quick.\r\n\r\nThe part of the replication test where the failure occurs tries to test a slave\r\nshutdown after the master has been taken down.\r\n\r\nI tried doing the above manually and observe the following\r\n\r\nij>  connect 'jdbc:derby://localhost:1528/replicationdb;user=oystein;password=pass;stopSlave=true';\r\nERROR XRE41: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE41, SQLERRMC: XRE41\r\nij> connect 'jdbc:derby://localhost:1528/replicationdb;user=oystein;password=pass;stopSlave=true';\r\nERROR XRE42: DERBY SQL error: SQLCODE: -1, SQLSTATE: XRE42, SQLERRMC: replicationdbXRE42\r\nij>\r\n\r\nSo before the master is killed the slave take down attempt fails XRE41\r\n\r\nand after the master is killed it succeeds XRE42.\r\n\r\nSeems like the code is behaving as the tests ask it too. I will investigate further into this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-17T11:13:03.619+0000","updated":"2008-03-17T11:13:03.619+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579442","id":"12579442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"I think I have a strong theory to explain this test failure,\r\n\r\nWhen the Network Server running the master is shutdown as is being done in the test it result in the stop method\r\nof the MasterController module being called. This causes the master to send a STOP message\r\nto the slave. This causes a slave shutdown.\r\n\r\nThe cleanup code was added in the MasterController stop method as part of this patch.\r\n\r\nI think this is expected behaviour and XRE11 is the right message in this case. The NetworkServer\r\nrunning the master being shutdown results in the Replication master shutting down, this is similar\r\nto the stopMaster being called.\r\n\r\nI think the tests need to be fixed to accomodate this new and correct behaviour\r\n\r\nI will fix this test and submit the patch again","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-17T13:58:01.788+0000","updated":"2008-03-17T13:58:01.788+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579443","id":"12579443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"In my earlier comment I had written that I was getting an XRE42.\r\nI was getting a XRE42 because I had misunderstood killing the\r\nslave to mean doing a kill on the network server running the master.\r\nThis does not result in a proper shutdown of the master.  Hence\r\nresulting in a XRE42 (allowing a proper shutdown of the slave).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-17T14:02:57.923+0000","updated":"2008-03-17T14:02:57.923+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12579496","id":"12579496","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Fixed the test that was failing when run with v3, as described in\r\nthe comments above.\r\n\r\nRan the replication tests and observed no failure\r\n\r\nvn@vn-laptop:~/work/workspaces/Derby3447_1/tests$ java -Xmx512m -XX:MaxPermSize=128M junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.replicationTests.ReplicationSuite\r\n......\r\nTime: 545.178\r\n\r\nOK (6 tests)\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-17T16:17:32.506+0000","updated":"2008-03-17T16:17:32.506+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12582118","id":"12582118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"v4 applies cleanly to a freshworkspace. I had also run tests earlier before I submitted v4.\r\nI please request v4 to be considered for a commit if everything is OK.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-26T04:03:50.781+0000","updated":"2008-03-26T04:03:50.781+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12582268","id":"12582268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Thanks for the patch, Narayanan.  Changes look good, and my brief\r\ntesting shows that I am now able to quit ij when replication is\r\nrunning.  However, it would be good if you could add some regression\r\ntests for this issue to the replication test suite.\r\n\r\nBefore committing this patch, I want to get one question clarified:\r\nIn MasterController#stop, if stopMaster fails, you will still write\r\n'Replication master role stopped for database' to derby.log.  Can you\r\nbe certain that this is the case regardless of what the error is?\r\n\r\nSome nitpicks you may fix if you have to go another round with this\r\npatch: \r\n\r\n - SlaveDatabase: I think sdbThread instead of sdb_Thread is more in\r\n   line with the naming style used in the derby code.\r\n\r\n - MasterController: The casting to Thread does not seem to be\r\n   necessary.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-26T12:39:13.383+0000","updated":"2008-03-26T12:39:13.383+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12582549","id":"12582549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"body":"Thank you for taking a look at the patch Oystein\r\n\r\nI intended the message to be printed that way (similar to the printStackTrace and stop method)\r\n\r\nI have two justifications for this\r\n\r\n1) The only time the message is thrown is when the master has already stopped\r\n2) It is like saying the master has stopped but the following exception  \r\n   occurred (which is this case is only when the master is stopped)\r\n\r\nI have fixed the nits pointed out.\r\n\r\nI was hoping to submit regression tests in a follow up.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=narayanan","name":"narayanan","emailAddress":"v dot narayanan at sun dot com-disabled","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"V.Narayanan","active":true},"created":"2008-03-27T08:51:32.622+0000","updated":"2008-03-27T08:51:32.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12582978","id":"12582978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Thanks, for the latest updates, Narayanan.\r\nI have tested the patch, and my problem is solved.\r\nv5 patch committed at revision 642191.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-03-28T10:44:34.330+0000","updated":"2008-03-28T10:44:34.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12389293/comment/12584140","id":"12584140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Fix ported to 10.4 branch at revision 643399.\r\nSVN command used:\r\nsvn merge -r642190:642191 https://svn.apache.org/repos/asf/db/derby/code/trunk/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2008-04-01T13:48:40.814+0000","updated":"2008-04-01T13:48:40.814+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3447/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06r4v:"}}