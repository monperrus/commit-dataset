{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12328260","self":"https://issues.apache.org/jira/rest/api/latest/issue/12328260","key":"DERBY-892","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-01-31 03:47:02.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22191","customfield_12310222":"1_*:*_1_*:*_9939286000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_2_*:*_33132000_*|*_4_*:*_1_*:*_1686858000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-06-15T02:09:51.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-892/watchers","watchCount":0,"isWatching":false},"created":"2006-01-31T03:28:51.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-06-15T02:10:07.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"It would be nice to be able to specify a test-specific policy file.\n\nThis should get handled similar to existing properties, i.e. get specified in a test_app.properties file (or, for a suite, in the suite.properties file).  The file should then be copied into the correct place.\n\nNote, that the 'old' functionTests harness (as opposed to junit tests) includes a check for a property called 'serverPolicyFile' (in harness/jvm.java). The name is a left over from when the policy file was only used for/by network server, and should be renamed - derbyTestPolicyFile, for instance. It is not used anywhere at present, and not specific to network server. It would be nice if this could be expanded, or, if not used, removed.\n\nThe default policy file used is the derby_tests.policy file under functionTests/util.\n\nAlso, currently, the property can only be used with RunTest - for further traction, it should probably get passed on through RunSuite/RunList.\nOnce confirmed to be working, the property should get documented in <trunk>/java/testing/README.htm.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40641","summary":"add mechanism for specifying policy file for individual function tests","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":19,"total":19,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12364493","id":"12364493","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"This is a good improvement.\r\n\r\nThe best flexibility would be to have the option for a test to add permissions to a standard policy  file or replace the standard policy file.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-01-31T03:47:02.000+0000","updated":"2006-01-31T03:47:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12364513","id":"12364513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"I vote for this too, I think this makes a lot of sense.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2006-01-31T08:43:34.000+0000","updated":"2006-01-31T08:43:34.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12365394","id":"12365394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Can you give an example of what kind of permissions would make sense to get added?\r\ni.e., to what section e.g. of the current derby_testing.policy file?\r\n\r\nWe can probably achieve a full replacement fairly easily, using the current code for supporting files...But I think the 'addition' might be a little harder.\r\nWe may need to take this in two steps.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-02-07T14:40:58.000+0000","updated":"2006-02-07T14:40:58.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12365438","id":"12365438","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"My concern with multiple complete files is keeping them all up to date, too easy for only one file to be modified.\r\n\r\nThere are several examples in the derbyTests.policy file where a policy is granted for a single test, e.g..\r\n\r\n  // sane=true, jdbcapi/secureUsers1.sql\r\n  permission java.io.FilePermission \"${user.dir}${/}CloudLDAP.out\", \"write\"; \r\n\r\n  // unit tests (e.g. store/T_RecoverFullLog) set this property \r\n  // (called from derbyTesting.jar through code in derby.jar)\r\n  permission java.util.PropertyPermission \"derbyTesting.unittest.*\", \"write\";\r\n\r\nI think, though I haven't tried it, that adding permissions into a policy file is as simple as adding two files together.\r\nIf the system allows multiple grant blocks to a single codebase then additional files would look like this and could\r\nbe just appended by the harness to the base policy file.\r\n\r\ngrant codeBase \"${derbyTesting.codejar}derby.jar\" {\r\n// sane=true, jdbcapi/secureUsers1.sql\r\n  permission java.io.FilePermission \"${user.dir}${/}CloudLDAP.out\", \"write\"; \r\n}\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-02-07T23:14:10.000+0000","updated":"2006-02-07T23:14:10.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12377110","id":"12377110","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Attached is a patch which updates derby_tests.policy if there is a {test}.policy in the functionTests/tests dir for this test. Included is a sample policy for derbynet/sysinfo.java. The patch is not ready to be committed, but I thought I would put it out there for others to review.\r\n\r\nHowever, I can't seem to get  derbynet/sysinfo.java to fail (or pass) in any of the ways that I'm expecting at the moment and its driving me slightly insane. For instance, I can't get the test to fail as expected by removing the permissions noted in DERBY-622 (along with those added by Rick for 955), the circumstances mentioned in DERBY-1129, and the locale jar files output fails to appear even though I've granted the permissions noted in DERBY-622 which allowed the test to pass before. Maybe the jvm on Mac OS X is just not cooperating. I'll try it on Windows later.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-04-30T01:09:41.000+0000","updated":"2006-04-30T01:09:41.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12402217","id":"12402217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attached is DERBY-892_20060514.*, which takes the pre-patch a step further.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-05-14T22:32:32.000+0000","updated":"2006-05-14T22:32:32.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12402218","id":"12402218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I looked at the pre-patch, running the test derbynet/sysinfo.java and it seems to me this is a good step.\r\n\r\nHowever, the calls to updatePolicyFile() method were too late for networkserver, which is the relevant place for the sysinfo test which had securityManager switched off.\r\n\r\nThe new patch (DERBY-892_20060514.*) differs from the prepatch by Andrew in the following ways:\r\n-  removes the CopySuppFiles(..., <policyfile>) from jvm.java and adds it to updatePolicyFile() in RunTest.java.\r\n- renames updatePolicyFile() to composePolicyFile()) (because it no longer just updates the policy file)\r\n- calls the updatePolicyFile() method before starting networkserver, as well as in both the execTestNoProcess and ExecTestProcess methods\r\n- adjusts the sysinfo.policy file to:\r\n   . add a semi-colon after } for each codeBase section\r\n   . grants the same permissions as are currently in derby_tests.policy for DERBY-622, rather than the derbyLocale jar read grants.\r\n(Granting read permissions for the locales did not work for me - I assumed there was more needed that related to a fix for DERBY-622 than was in the pre-patch).\r\n- removed derbynet/sysinfo_app.properties' restriction to not run the client side with security manager by adding the following permission to sysinfo.policy:\r\n   grant codeBase \"${derbyTesting.codejar}derbyTesting.jar\" {\r\n      permission java.io.FilePermission \"<<ALL FILES>>\", \"execute\";\r\n   };\r\n   and same to ${derbyTesting.codeclasses}.\r\n   Note: the sysinfo_app.properties file suggested read permission, but that gave an error indicating execute was needed, and that made sense to me\r\n- stripped derby_tests.policy of permissions for specific tests:\r\n   . sysinfo and sysinfo_withproperties\r\n   . secureUsers1.sql\r\n   . NSinSameJVM:\r\n   . derbynet/getCurrentProperties.java\r\n   . lang/errorStream.java:  \r\n- After running derbyall, I found the permissions for errorStream.java (setIO)were also required for derybnet/dataSourcePermissions_net, testSecMec and OutBufferedStream, so I created policy files for those tests too.\r\n- Following Andrew's example in previous commits I eliminated the need for changing copyfiles.ant in tests/lang\r\n- I added *.policy to the build.xml files in the test directories where I added one (or more).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-05-14T22:51:45.000+0000","updated":"2006-05-14T22:51:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12412433","id":"12412433","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Wow, thanks for cooking up a great patch from my half-baked idea. This looks good, I've gone ahead and committed what you have to the trunk with revision 407642, as I think it's a very good improvement\r\n\r\nCouple of minor things:\r\n\r\n- a property to replace the standard policy file completely would be nice. e.g. setting the property derbyTesting.replacePolicyFile=true would not copy the standard policy file just the test-specific one. Need to think about where and how to set that property for a single test. In the _app.properties? If so, need to think about how we will load the _app.properties and check for the property before we've actually run the test.\r\n\r\n- document the new functionality and property in java/testing/README.htm\r\n\r\nPlease let me know if you can followup with a patch for those, otherwise I'll take care of it. Leaving this issue open until then.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-05-19T05:00:33.000+0000","updated":"2006-05-19T05:00:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413062","id":"12413062","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a follow-up patch - DERBY-892_3_20060523.* - does the following: \r\n- changes the location of the composePolicyFile() calls so that there is ever only one call (the method was being called twice, before)\r\n- adds the property replacePolicyFile (true/false, default false, i.e. append)\r\n- adds documentation in testing/README.htm for replacePolicyFile\r\n- removes reference to serverPolicyFile property from jvm.java (because that property was never used and the copying is now done in RunTest anyway)\r\n- adds code to ensure a suite-specific policy file can also be used \r\n- adds a policy file for the nist suite and removes the entries from derby_tests.policy.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-05-24T11:28:51.000+0000","updated":"2006-05-24T11:28:51.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413063","id":"12413063","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I could not reproduce the problem with nist suite of DERBY-1337, not sure what I was doing wrong... But if someone who could reproduce that could take a look at this patch to see if the behavior is still ok with this patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-05-24T11:32:14.000+0000","updated":"2006-05-24T11:32:14.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413064","id":"12413064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"This looks good, but shouldn't we leave the permissions needed for running tests in useprocess=false mode in the base harness policy file, considering the recent work that was done with DERBY-1141? Since the permission is only granted on derbyTesting.jar, the tests are still quite secure when running in from the jars. You could have the harness append the necessary permissions if running in useprocess=false mode, but that might be more trouble than its worth. Also, this makes the lang/errorStream.policy file unnecessary, unless you choose to go the append-permissions-for-useprocess=false route.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-05-24T11:58:05.000+0000","updated":"2006-05-24T11:58:05.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413070","id":"12413070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a next patch in this series - DERBY-892_4_20060523.* - which differs from _3_ only in that instead of a suites/nist.policy, there now is a util/useprocessfalse.policy and this one gets appended whenever useprocess=false.\r\n\r\nNote that I forgot to mention with my comment on the _3_ patch that derby_tests.policy now also will get deleted when the test is successful (unless -Dkeepfiles=true).\r\n\r\nThe problem of DERBY-1337 is not occurring this way. \r\nderbyall is running, will report results.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-05-24T13:20:23.000+0000","updated":"2006-05-24T13:20:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413223","id":"12413223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Derbyall passed, except for a failure in unit/fillLog.unit, which failed on linux and solaris with jars, but not on windows with classes. After spending copious time on trying to figure out how that failure could be related, I backed out my changes and tried it again and I still see this failure. So I don't think it's related, and this patch is good to go.\r\n\r\nBut maybe an interested committer can verify.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-05-25T14:21:52.000+0000","updated":"2006-05-25T14:21:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413308","id":"12413308","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Committed DERBY-892_4_20060523.diff to trunk with revision 409471. Two minor changes, adding if (verbose) to printing of 'appending to derby_tests.policy' and removed the copyfiles.ant.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-05-26T04:23:37.000+0000","updated":"2006-05-26T04:23:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413378","id":"12413378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Reopening this issue due to a problem with the test harness. There is some sort of race-type condition whereby the test harness does not have the necessary setIO permission to reassign the system out and err streams when the nist suite is run as a subsuite of derbyall in useprocess=false mode. The error does not occur when running the nist suite separately. I haven't had time to analyze the problem completely, but I'm guessing that we've set a security manager for the test harness code without the setIO permissions in the policy file in effect at the time, but the setIO permission needed for running in useprocess=false mode has not been granted to the test harness by the policy file currently in effect. Reinstated blanket setIO and setSecurityManager permissions for the test harness in derby_tests.policy with revision 409565. Full stack trace that appears in the top-level execution of derbyall below:\r\n\r\n*** Start: schema1 jdk1.5.0_02 derbyall:nist 2006-05-25 21:54:46 ***\r\nException in thread \"main\" java.security.AccessControlException: access denied (java.lang.RuntimePermission setIO)\r\n        at java.security.AccessControllerContext.checkPermission(AccessControlContext.java:264)\r\n        at java.security.AccessController.checkPermission(AccessController.java:427)\r\n        at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)\r\n        at java.lang.System.checkIO(System.java:207)\r\n        at java.lang.System.setOut(System.java:147)\r\n        at org.apache.derbyTesting.functionTests.harness.RunTest.execTestNoProcess(RunTest.java:2552)\r\n        at org.apache.derbyTesting.functionTests.harness.RunTest.testRun(RunTest.java:493)\r\n        at org.apache.derbyTesting.functionTests.harness.RunTest.main(RunTest.java:352)\r\n        at org.apache.derbyTesting.functionTests.harness.RunList.runTests(RunList.java:575)\r\n        at org.apache.derbyTesting.functionTests.harness.RunList.runSuites(RunList.java:310)\r\n        at org.apache.derbyTesting.functionTests.harness.RunList.<init>(RunList.java:164)\r\n        at org.apache.derbyTesting.functionTests.harness.RunSuite.getSuitesList(RunSuite.java:208)\r\n        at org.apache.derbyTesting.functionTests.harness.RunSuite.main(RunSuite.java:147)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-05-26T13:35:33.000+0000","updated":"2006-05-26T13:35:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413550","id":"12413550","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I am only now noticing that my util/useprocessfalse.policy file - added in patch _4_ never made it in with the check-in. \r\n\r\nI will double check if things work ok with that in...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-05-27T07:09:40.000+0000","updated":"2006-05-27T07:09:40.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413557","id":"12413557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Yes, I'm a bonehead for not noticing it before checking in patch_4. I just discovered that independently myself, and checked it in with 409805. Since everything was working on my machine, I naturally looked for another solution. If you double-check that it runs ok as a subsuite of another suite, I'll take the permissions out of derby_tests.policy again. Sorry for the confusion and breakage.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-05-27T10:20:56.000+0000","updated":"2006-05-27T10:20:56.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12413558","id":"12413558","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"At least the failure makes sense without the file...Yes, I double checked on windows  (sane) jars an classes, and (sane) jars on linux that indeed the nist test passes when part of another suite.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-05-27T12:05:09.000+0000","updated":"2006-05-27T12:05:09.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328260/comment/12415617","id":"12415617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"We still have setIO permission in derby_tests.policy.\r\nI thought it should now be ok to take the setIO permission out, but Tomohito Nagayama indicated that he still saw a failure - in store/streamingColumn.java when storemats suite is run from the encryption suite -  when this permission is *not* present in derby_tests.policy.\r\n\r\nI cannot duplicate a security exception or test exit there, not with classes, insane, or sane jars, not when running derbyall, or a subset (when I take setIO out of derby_tests.policy).\r\n\r\nI think that becomes another issue, and would like to propose to leave the setIO permission in derby_tests.policy, and still close this issue, because the essential functionality has been implemented.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2006-06-10T04:32:57.000+0000","updated":"2006-06-10T04:32:57.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-892/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07bkn:"}}