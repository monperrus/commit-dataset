{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12506875","self":"https://issues.apache.org/jira/rest/api/latest/issue/12506875","key":"SOLR-2509","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319065","id":"12319065","description":"Major release after 3.5","name":"3.6","archived":false,"released":true,"releaseDate":"2012-04-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314992","id":"12314992","description":"Alpha release of 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-06-16 04:40:43.417","customfield_12312323":null,"customfield_12310420":"361","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_18138348662_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-12-07T14:47:09.980+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-2509/watchers","watchCount":5,"isWatching":false},"created":"2011-05-11T16:21:21.496+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.png","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314371","id":"12314371","description":"Major release after 1.4.1","name":"3.1","archived":false,"released":true,"releaseDate":"2011-03-31"}],"issuelinks":[{"id":"12349913","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12349913","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12548838","key":"SOLR-3300","self":"https://issues.apache.org/jira/rest/api/2/issue/12548838","fields":{"summary":"SpellChecker and Dismax fail when using value from q containing hyphen","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:40:00.562+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"Hi,\r\n\r\nI'm a french user of SOLR and i've encountered a problem since i've installed SOLR 3.1.\r\n\r\nI've got an error with this query : \r\ncle_frbr:\"LYSROUGE1149-73190\"\r\n\r\n*SEE COMMENTS BELOW*\r\n\r\nI've tested to escape the minus char and the query worked :\r\ncle_frbr:\"LYSROUGE1149(BACKSLASH)-73190\"\r\n\r\nBut, strange fact, if i change one letter in my query it works :\r\ncle_frbr:\"LASROUGE1149-73190\"\r\n\r\n\r\nI've tested the same query on SOLR 1.4 and it works !\r\n\r\nCan someone test the query on next line on a 3.1 SOLR version and tell me if he have the same problem ? \r\nyourfield:\"LYSROUGE1149-73190\"\r\n\r\nWhere do the problem come from ?\r\n\r\nThank you by advance for your help.\r\n\r\nTom","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"18725","summary":"spellcheck: StringIndexOutOfBoundsException: String index out of range: -1","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=calitom","name":"calitom","emailAddress":"thomas at cd-script dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Gambier","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=calitom","name":"calitom","emailAddress":"thomas at cd-script dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Gambier","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Debian Lenny\r\nJAVA Version \"1.6.0_20\"\r\n","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":14,"total":14,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13032320","id":"13032320","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=calitom","name":"calitom","emailAddress":"thomas at cd-script dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Gambier","active":true},"body":"More investigation :\r\n\r\nI've located that spellchecker collate function is the trouble.\r\n\r\nhttp://localhost:8983/solr/spell?q=cle_frbr%3A\"LYSROUGE1149-73190\"&spellcheck=true&spellcheck.collate=true\r\nThe query failed with the same error as above.\r\n\r\nhttp://localhost:8983/solr/spell?q=cle_frbr%3A\"LYSROUGE1149-73190\"&spellcheck=true\r\nThis query works fine.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=calitom","name":"calitom","emailAddress":"thomas at cd-script dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Gambier","active":true},"created":"2011-05-12T08:43:40.218+0000","updated":"2011-05-12T08:43:40.218+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13050211","id":"13050211","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Moved original stack trace out of description for brevity...\r\n\r\n{noformat}\r\nThe error is :\r\nHTTP ERROR 500\r\n\r\nProblem accessing /solr/select. Reason:\r\n\r\n    String index out of range: -1\r\n\r\njava.lang.StringIndexOutOfBoundsException: String index out of range: -1\r\n\tat java.lang.AbstractStringBuilder.replace(AbstractStringBuilder.java:797)\r\n\tat java.lang.StringBuilder.replace(StringBuilder.java:271)\r\n\tat org.apache.solr.spelling.SpellCheckCollator.getCollation(SpellCheckCollator.java:131)\r\n\tat org.apache.solr.spelling.SpellCheckCollator.collate(SpellCheckCollator.java:69)\r\n\tat org.apache.solr.handler.component.SpellCheckComponent.addCollationsToResponse(SpellCheckComponent.java:179)\r\n\tat org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:157)\r\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:194)\r\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)\r\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1360)\r\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:356)\r\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:252)\r\n\tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1212)\r\n\tat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:399)\r\n\tat org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\r\n\tat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)\r\n\tat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:766)\r\n\tat org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:450)\r\n\tat org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)\r\n\tat org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)\r\n\tat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\r\n\tat org.mortbay.jetty.Server.handle(Server.java:326)\r\n\tat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\r\n\tat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:928)\r\n\tat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:549)\r\n\tat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)\r\n\tat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\r\n\tat org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:228)\r\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\r\n\r\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2011-06-16T04:40:43.417+0000","updated":"2011-06-16T04:40:43.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13050212","id":"13050212","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"the stack trace is different, but based on the fact that it has to do with using spellcheck.collate and \"-\" in the query this smells like it might be realted to SOLR-1630","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2011-06-16T04:41:54.280+0000","updated":"2011-06-16T04:41:54.280+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13090066","id":"13090066","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janhoy","name":"janhoy","emailAddress":"jh at cominvent dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=janhoy&avatarId=10130","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=janhoy&avatarId=10130","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=janhoy&avatarId=10130","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=janhoy&avatarId=10130"},"displayName":"Jan Høydahl","active":true},"body":"I see this issue in 1.4 with query \"Irano-Hind\" and spellcheck w/collate. However, I cannot reproduce in 3.1, so my issue was probably SOLR-1630 related.\r\n\r\nSure you're on 3.1? Can you describe closer what you do, what field type you use, how you setup spellcheck etc?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=janhoy","name":"janhoy","emailAddress":"jh at cominvent dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=janhoy&avatarId=10130","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=janhoy&avatarId=10130","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=janhoy&avatarId=10130","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=janhoy&avatarId=10130"},"displayName":"Jan Høydahl","active":true},"created":"2011-08-24T07:51:45.717+0000","updated":"2011-08-24T08:22:49.027+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13151129","id":"13151129","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seg","name":"seg","emailAddress":"sego at dtic dot dtu dot dk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steffen Elberg Godskesen","active":true},"body":"\r\nWe seem to be hitting this bug in in 4.0 also. I've attached the simplest (that I could come up with) config, schema and document that enables me to reproduce the exception on the latest nightly build (from https://builds.apache.org/job/Solr-trunk/lastSuccessfulBuild/artifact/artifacts/apache-solr-4.0-2011-11-16_08-54-59.tgz) \r\n\r\nTo reproduce:\r\n\r\n# Start a Solr instance using the attached schema.xml and solrconfig.xml\r\n# Add the attached document.xml to the index\r\n# Query for hypenated-wotd with spellchecking on and collation on (e.g. http://localhost:8983/solr/select?&q=hypenated-wotd&spellcheck=true&spellcheck.collate=true)\r\n\r\nThis will log the following exception (very similar to the one above, but included for completeness)\r\n\r\n{noformat}\r\nNov 16, 2011 11:18:33 AM org.apache.solr.core.SolrCore execute\r\nINFO: [] webapp=/solr path=/select params={spellcheck.collate=true&spellcheck=true&q=hypenated-wotd} hits=0 status=500 QTime=34 \r\nNov 16, 2011 11:18:33 AM org.apache.solr.common.SolrException log\r\nSEVERE: java.lang.StringIndexOutOfBoundsException: String index out of range: -4\r\n\tat java.lang.AbstractStringBuilder.replace(AbstractStringBuilder.java:797)\r\n\tat java.lang.StringBuilder.replace(StringBuilder.java:271)\r\n\tat org.apache.solr.spelling.SpellCheckCollator.getCollation(SpellCheckCollator.java:131)\r\n\tat org.apache.solr.spelling.SpellCheckCollator.collate(SpellCheckCollator.java:70)\r\n\tat org.apache.solr.handler.component.SpellCheckComponent.addCollationsToResponse(SpellCheckComponent.java:177)\r\n\tat org.apache.solr.handler.component.SpellCheckComponent.process(SpellCheckComponent.java:154)\r\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:194)\r\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)\r\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1475)\r\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:353)\r\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:248)\r\n\tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1212)\r\n\tat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:399)\r\n\tat org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\r\n\tat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)\r\n\tat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:766)\r\n\tat org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:450)\r\n\tat org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:230)\r\n\tat org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)\r\n\tat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\r\n\tat org.mortbay.jetty.Server.handle(Server.java:326)\r\n\tat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\r\n\tat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:928)\r\n\tat org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:549)\r\n\tat org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:212)\r\n\tat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\r\n\tat org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:228)\r\n\tat org.mortbay.thread.QueuedThreadPool$PoolThread.run(QueuedThreadPool.java:582)\r\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seg","name":"seg","emailAddress":"sego at dtic dot dtu dot dk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steffen Elberg Godskesen","active":true},"created":"2011-11-16T10:37:59.210+0000","updated":"2011-11-16T10:37:59.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13151281","id":"13151281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdyer","name":"jdyer","emailAddress":"james dot dyer at ingrambook dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Dyer","active":true},"body":"This patch contains a failing unit test, based on Steffan's config files.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdyer","name":"jdyer","emailAddress":"james dot dyer at ingrambook dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Dyer","active":true},"created":"2011-11-16T16:00:01.353+0000","updated":"2011-11-16T16:00:01.353+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13155380","id":"13155380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seg","name":"seg","emailAddress":"sego at dtic dot dtu dot dk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steffen Elberg Godskesen","active":true},"body":"This patch passes James' new unit tests, but fails testCollate() in org.apache.solr.handler.component.SpellCheckComponentTest, since the collation \"pixmaa-a-b-c-d-e-f-g\" is now returned for the query \"pixma-a-b-c-d-e-f-g\" with the word \"pixmaa\" in the index. The test expects the collation \"pixmaa\" to be returned. \r\n\r\nI'm not really in a position to decide which behavior is correct. The new behavior passes James' tests and fixes the StringIndexOutOfBoundsException, but may deviate enough from the current behavior to cause problems for existing users.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seg","name":"seg","emailAddress":"sego at dtic dot dtu dot dk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steffen Elberg Godskesen","active":true},"created":"2011-11-22T19:55:51.663+0000","updated":"2011-11-22T19:55:51.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13162416","id":"13162416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"body":"This seems like a fairly straight-forward patch code-change wise, but I confess I know nothing about this code. So if someone who does can take a glance at the actual changes (three lines total, and unit tests, cool!) and render an opinion on Steffan's note about the collation issue is something to be concerned about or not I can alter the failing test and get this into the code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"created":"2011-12-04T16:31:54.003+0000","updated":"2011-12-04T16:31:54.003+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13163103","id":"13163103","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdyer","name":"jdyer","emailAddress":"james dot dyer at ingrambook dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Dyer","active":true},"body":"Steffen's changes are most certainly correct.  The index contains \"pixmaa\" and we are querying on \"pixma-a-b-c-d-e-f-g\".  The spelling index is using analyzer \"lowerpunctfilt\" (solrconfig-spellcheckcomponent.xml, line 44) which includes WordDelimiterFilter and \"generateWordParts=1\".  So we would expect this query to tokenize down to \"pixma\" \"a\" \"b\" \"c\" \"d\" \"e\" \"f\" \"g\".  As the Collate feature is only supposed to replace the misspelled token with the new one, I wonder why this test scenario would expect all 8 tokens to be replaced by 1 token (!).\r\n\r\nIndeed, this test scenario was added during a refactoring (r1022768) with no JIRA # or bug mentioned at all in the comments.  So we can't know for sure why it was added.  I'm thinking this is invalid.  I would expect the correct collation to be \"pixma-a-b-c-d-e-f-g\".  \r\n\r\nJust for grins, I put a \"println\" in SpellingQueryConverter to show the start & end offsets for each token before and after the patch.  In both cases, we get the same token texts, but prior to the patch the offset values are clearly wrong.\r\n\r\n--before:\r\nTOKEN: pixma so=0 eo=19\r\nTOKEN: a so=0 eo=19\r\nTOKEN: b so=0 eo=19\r\nTOKEN: c so=0 eo=19\r\nTOKEN: d so=0 eo=19\r\nTOKEN: e so=0 eo=19\r\nTOKEN: f so=0 eo=19\r\nTOKEN: g so=0 eo=19\r\nTOKEN: pixmaabcdefg so=0 eo=19\r\n\r\n--after:\r\nTOKEN: pixma so=0 eo=5\r\nTOKEN: a so=6 eo=7\r\nTOKEN: b so=8 eo=9\r\nTOKEN: c so=10 eo=11\r\nTOKEN: d so=12 eo=13\r\nTOKEN: e so=14 eo=15\r\nTOKEN: f so=16 eo=17\r\nTOKEN: g so=18 eo=19\r\nTOKEN: pixmaabcdefg so=0 eo=19\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdyer","name":"jdyer","emailAddress":"james dot dyer at ingrambook dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Dyer","active":true},"created":"2011-12-05T22:16:52.439+0000","updated":"2011-12-05T22:16:52.439+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13163114","id":"13163114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"bq. Indeed, this test scenario was added during a refactoring (r1022768) with no JIRA # or bug mentioned at all in the comments. \r\n\r\nMy commit :-)\r\n\r\nThe commit comment said \"tests: fix resource leaks and simplify\", and hopefully that's all I did!\r\n\r\nLooking back wrt pixma, it looks like I replaced this:\r\n{code}\r\n-  @Test\r\n-  public void testCollate2() throws Exception {\r\n-    SolrCore core = h.getCore();\r\n-    SearchComponent speller = core.getSearchComponent(\"spellcheck\");\r\n-    assertTrue(\"speller is null and it shouldn't be\", speller != null);\r\n-\r\n-    ModifiableSolrParams params = new ModifiableSolrParams();\r\n-    params.add(CommonParams.QT, \"spellCheckCompRH\");\r\n-    params.add(SpellCheckComponent.SPELLCHECK_BUILD, \"true\");\r\n-    params.add(CommonParams.Q, \"pixma-a-b-c-d-e-f-g\");\r\n-    params.add(SpellCheckComponent.COMPONENT_NAME, \"true\");\r\n-    params.add(SpellCheckComponent.SPELLCHECK_COLLATE, \"true\");\r\n-\r\n-    SolrRequestHandler handler = core.getRequestHandler(\"spellCheckCompRH\");\r\n-    SolrQueryResponse rsp = new SolrQueryResponse();\r\n-    rsp.add(\"responseHeader\", new SimpleOrderedMap());\r\n-    handler.handleRequest(new LocalSolrQueryRequest(core, params), rsp);\r\n-    NamedList values = rsp.getValues();\r\n-    NamedList spellCheck = (NamedList) values.get(\"spellcheck\");\r\n-    NamedList suggestions = (NamedList) spellCheck.get(\"suggestions\");\r\n-    String collation = (String) suggestions.get(\"collation\");\r\n-    assertEquals(\"pixmaa\", collation);\r\n-  }\r\n{code}\r\n\r\nWith this:\r\n\r\n{code}\r\n+    assertJQ(req(\"json.nl\",\"map\", \"qt\",rh, SpellCheckComponent.COMPONENT_NAME, \"true\", \"q\",\"pixma-a-b-c-d-e-f-g\", SpellCheckComponent.SPELLCHECK_COLLATE, \"true\")\r\n+       ,\"/spellcheck/suggestions/collation=='pixmaa'\"\r\n+    );\r\n{code}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2011-12-05T22:34:04.624+0000","updated":"2011-12-05T22:34:04.624+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13163695","id":"13163695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdyer","name":"jdyer","emailAddress":"james dot dyer at ingrambook dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Dyer","active":true},"body":"ahhhh.  I see in r1022768 you combined \"testCollate()\" with \"testCollate2()\", where this test scenario was originally.  Thanks for the clarification (and sorry!).  So in fact this was added with SOLR-1630 (r987509), the comments therein are not very reassuring that it was a \"correct\" or \"final\" fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jdyer","name":"jdyer","emailAddress":"james dot dyer at ingrambook dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Dyer","active":true},"created":"2011-12-06T16:51:59.392+0000","updated":"2011-12-06T16:51:59.392+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13163770","id":"13163770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"body":"Here's the updated patch. The only difference between this and the original is that I changed the failing test to expect pixmaa rather than pixma-a-b-c-d-e-f-g.\r\n\r\nIf nobody objects, I'll commit this tomorrow (7-Dec) on both trunk and 3x.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"created":"2011-12-06T19:43:51.071+0000","updated":"2011-12-06T19:43:51.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13164434","id":"13164434","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"body":"\r\nTrunk r: 1211456\r\n3x r:    1211457","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"created":"2011-12-07T14:47:10.103+0000","updated":"2011-12-07T14:47:10.103+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12506875/comment/13165200","id":"13165200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"body":"By the way, many thanks to Thomas and Steffen!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"created":"2011-12-08T13:01:51.700+0000","updated":"2011-12-08T13:01:51.700+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-2509/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03kbj:"}}