{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12442556","self":"https://issues.apache.org/jira/rest/api/latest/issue/12442556","key":"CASSANDRA-606","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314040","id":"12314040","description":"","name":"0.5","archived":false,"released":true,"releaseDate":"2010-01-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-12-06 01:31:13.892","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"1_*:*_1_*:*_7926114_*|*_5_*:*_1_*:*_0","customfield_12310420":"19777","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-12-06T01:46:57.097+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-606/watchers","watchCount":1,"isWatching":false},"created":"2009-12-05T23:34:50.983+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-12-06T12:35:08.071+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"We have been seeing issues with compaction running very often. We ran into this case when I found out in one of our CFs we were inserting a high volume of columns. Our threshold for memtable size flushes is 64MB but the MemtableObjectCountInMillions is 0.1 (we know this is low and will increase). On average we are writing so much data that compaction kicks off reguarly. And when we start trying to lookup data, we get lots of errors during compaction and get_slice (since sometimes files don't get cleaned up). In every event that this has occurred, a -Filter file was left behind. Never Data or Index.\r\n\r\nERROR [COMPACTION-POOL:1] 2009-12-05 15:04:47,412 DebuggableThreadPoolExecutor.java (line 120) Error in executor futuretask\r\njava.util.concurrent.ExecutionException: java.io.FileNotFoundException: /mnt/var/cassandra/data/Digg/UserActivity-1243-Data.db (No such file or directory)\r\n        at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)\r\n        at java.util.concurrent.FutureTask.get(FutureTask.java:83)\r\n        at org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor.afterExecute(DebuggableThreadPoolExecutor.java:112)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:888)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n        at java.lang.Thread.run(Thread.java:619)\r\nCaused by: java.io.FileNotFoundException: /mnt/var/cassandra/data/Digg/UserActivity-1243-Data.db (No such file or directory)\r\n        at java.io.RandomAccessFile.open(Native Method)\r\n        at java.io.RandomAccessFile.<init>(RandomAccessFile.java:212)\r\n        at java.io.RandomAccessFile.<init>(RandomAccessFile.java:98)\r\n        at org.apache.cassandra.io.BufferedRandomAccessFile.<init>(BufferedRandomAccessFile.java:142)\r\n        at org.apache.cassandra.io.SSTableScanner.<init>(SSTableScanner.java:47)\r\n        at org.apache.cassandra.io.SSTableReader.getScanner(SSTableReader.java:386)\r\n        at org.apache.cassandra.io.CompactionIterator.getCollatingIterator(CompactionIterator.java:65)\r\n        at org.apache.cassandra.io.CompactionIterator.<init>(CompactionIterator.java:48)\r\n        at org.apache.cassandra.db.ColumnFamilyStore.doFileCompaction(ColumnFamilyStore.java:902)\r\n        at org.apache.cassandra.db.ColumnFamilyStore.doFileCompaction(ColumnFamilyStore.java:861)\r\n        at org.apache.cassandra.db.ColumnFamilyStore.doCompaction(ColumnFamilyStore.java:663)\r\n        at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:180)\r\n        at org.apache.cassandra.db.CompactionManager$1.call(CompactionManager.java:177)\r\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n        ... 2 more\r\n INFO [main] 2009-12-05 15:08:54,384 SSTable.java (line 156) Deleted /mnt/var/cassandra/data/Digg/UserActivity-1130-Data.db\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12427082","id":"12427082","filename":"0001-ColumnFamily.onStart-was-not-checking-files-related-.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"created":"2009-12-06T01:29:35.215+0000","size":1818,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12427082/0001-ColumnFamily.onStart-was-not-checking-files-related-.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12427083","id":"12427083","filename":"0001-v2-ColumnFamily.onStart-was-not-checking-files-related-.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"created":"2009-12-06T01:39:59.569+0000","size":2344,"mimeType":"text/x-diff","content":"https://issues.apache.org/jira/secure/attachment/12427083/0001-v2-ColumnFamily.onStart-was-not-checking-files-related-.patch"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"91425","summary":"Compaction can't find files","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":4,"total":4,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442556/comment/12786546","id":"12786546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"body":"Looks like ColumnFamilyStore.onStart() is not restricting itself to it's own CF files only. After CF A onstart finishes CF B onstart could remove orphans.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"created":"2009-12-06T00:20:49.316+0000","updated":"2009-12-06T00:20:49.316+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442556/comment/12786554","id":"12786554","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"the filename.contains(columnFamily_)) and cfName.equals(columnFamily_) checks are redundant too w/ this","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-12-06T01:31:13.892+0000","updated":"2009-12-06T01:31:13.892+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442556/comment/12786556","id":"12786556","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"+1 v2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2009-12-06T01:44:46.815+0000","updated":"2009-12-06T01:45:45.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12442556/comment/12786611","id":"12786611","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #279 (See [http://hudson.zones.apache.org/hudson/job/Cassandra/279/])\r\n    ColumnFamily.onStart() was not checking files related to only it's column family. It was possible to remove files from other CFs thinking they were orphans. Skip files not apart of the CF. patch by goffinet; reviewed by jbellis for \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2009-12-06T12:35:08.037+0000","updated":"2009-12-06T12:35:08.037+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-606/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0fzyv:"}}