{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12357819","self":"https://issues.apache.org/jira/rest/api/latest/issue/12357819","key":"DERBY-2153","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-12-05 21:39:37.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22911","customfield_12310222":"1_*:*_1_*:*_501636000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_7000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-12-11T16:35:33.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2153/watchers","watchCount":0,"isWatching":false},"created":"2006-12-05T21:14:57.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-30T15:55:45.423+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"When attempting to run:\n<j9binpath>/j9 -jcl:foun10 -Dderby.system.home=<testhome> -DderbyTesting.serverhost=localhost -DderbyTesting.clienthost=localhost -DderbyTesting.codeclasses=file:/<classesdir>/ -DderbyTesting.junit=file://unused -DderbyTesting.antjunit=file://unused -Djava.security.policy=file:/<classesdir>/org/apache/derbyTesting/functionTests/util/derby_tests.policy -Xbootclasspath/a:<j9libpath>/jdbc.jar -cp <classesdir>;junit.jar junit.textui.TestRunner org.apache.derbyTesting.functionTests.suites.All \n\nThe textui.TestRunner keels over with the following error:\nFailed to invoke suite():java.lang.NoClassDefFoundError: javax.xml.parsers.DocumentBuilderFactory\n\nThis happens after, but not before revision 482433. \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38824","summary":"suites.All falls over with foundation after revision 482433; java.lang.NoClassFoundError: javax.xml.parsers.DocumentBuilderFactory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"IBM's wctme5.7 (a.k.a. j9) jcl Foundation libraries (j2MEjdk 1.0)","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":8,"total":8,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357819/comment/12455764","id":"12455764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"This is caused by addition of the DocumentBuilderFactory to junit/XML.java.  When I added the import I knew it would make it so that the XML tests would fail with 1.3 JVMs, as indicated by this diff:\r\n\r\n+/* The following import is for a JDBC 3.0 JAXP class, which means that\r\n+ * this file can only be built with 1.4 or later (see build.xml in\r\n+ * this directory).  This means that 1.3 JVMs will not be able to\r\n+ * instantiate this class--but since 1.3 is deprecated as of 10.3,\r\n+ * we do not worry about that here.\r\n+ */\r\n+import javax.xml.parsers.DocumentBuilderFactory;\r\n+\r\n\r\nBut of course, I failed to realize that wctme is (apparently?) based on a 1.3 JVM and it (wctme) is *not* deprecated as of 10.3.  So my mistake.\r\n\r\nI think the fix here is going to be to create a separate file in the juni/t directory that is only instantiated when all required XML classes are in the classpath (similar to the SqlXmlUtil.java class in the engine).  I'll look into making that change.\r\n\r\nJust as a sidenote: if you have the required XML classes (esp. xml-apis.jar, a JAXP parser, and Xalan) in your classpath, the tests should run fine with wctme5.7.  It's only  if those jars are missing that this will be a problem.\r\n\r\nThanks for catching this!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-12-05T21:39:37.000+0000","updated":"2006-12-05T21:39:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357819/comment/12456156","id":"12456156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"The code that uses DocumentBuilderFactory in junit.XML has this\r\n\r\nClass.forName(DocumentBuilderFactory.newInstance().getClass().getName())\r\n\r\nI think that could be simplified with:\r\n\r\nDocumentBuilderFactory.newInstance().getClass()\r\n\r\nand then reading the comments above this line, I wonder if this could have been used instead?\r\n\r\nDocumentBuilderFactory.class\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-12-06T18:30:19.000+0000","updated":"2006-12-06T18:30:19.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357819/comment/12456159","id":"12456159","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Just to be clear Derby is supoorted on J2ME/CDC/Foundation 1.0 with JSR 169.\r\nJ2ME/CDC/Foundation 1.0 is separate to J2SE 1.3 (but I think was derived from JDK 1.3, though it also includes additional classes.\r\nJSR169 is a subset of JDBC 3.0\r\n\r\nAlso the coment you quoted above says \"The following import is for a JDBC 3.0 JAXP class\".\r\nI think you meant to say something instead of JDBC 3.0, since JAXP is not part of JDBC.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-12-06T18:35:49.000+0000","updated":"2006-12-06T18:35:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357819/comment/12456171","id":"12456171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"> I think that could be simplified with:\r\n>    DocumentBuilderFactory.newInstance().getClass()\r\n\r\nYes, you're absolutely right.  I'll include this in my patch for this issue.\r\n\r\n> and then reading the comments above this line, I wonder if this could have been\r\n> used instead?\r\n>    DocumentBuilderFactory.class \r\n\r\nI don't think this will always work.  The 1.4, 1.5, and 1.6 JVMs (at least, Sun and IBM) all embed the JAXP API classes.  But in the case of, say, Sun 1.5, the JAXP *implementation* classes are not embedded.  So if we're running with Sun 1.5 then any attempts to look up the URL for \"DocumentBuilderFactory.class\" would return null because it's embedded within the JVM.  But if we have an external JAXP implementation (say Xerces) in the classpath, we need to find that jar file.  By instantiating the DocBuilderFactory class and using the the *implementation*-specific class name we ensure that, for external (w.r.t the JVM) JAXP implementations, we can find the implementation jar file and thus we can assign the correct permissions.\r\n\r\nNote that I haven't tried it yet, but if the user was using Sun 1.5 and *endorsed* the JAXP parser, I think the use of DocumentBuilderFactory.class would work.  But I don't think we want to make that a requirement, do we?\r\n\r\n> Also the coment you quoted above says \"The following import is for a JDBC 3.0 JAXP class\".\r\n> I think you meant to say something instead of JDBC 3.0, since JAXP is not part of JDBC. \r\n\r\nOkay, I think I've made this mistake before (sorry).  Will change it in my patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-12-06T19:20:43.000+0000","updated":"2006-12-06T19:20:43.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357819/comment/12456250","id":"12456250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Attaching a patch, d2153_v1.patch, to create a new file, junit/JAXPFinder.java, that is only instantiated when all required XML classes are in the classpath.  The patch then moves the import of DocumentBuilderFactory out of junit/XML.java and into junit/JAXPFinder.java.  This extra level of indirection combined with the conditional instantiation of JAXPFinder ensures that we do not attempt to instantiate a DocumentBuilderFactory unless we have the necessary JAXP classes.  Thus the NoClassFoundError will no longer occur for wctme5.7 (j9).\r\n\r\nThe patch also makes the changes suggested by Dan in his previous comments (thanks Dan!).\r\n\r\nI ran suites.All with wctme5.7 and saw 8 failures:\r\n\r\nFAILURES!!!\r\nTests run: 1166,  Failures: 0,  Errors: 8\r\n\r\nAll eight failures are covered by DERBY-2157 and DERBY-2158 and are not related to my changes.  I also ran XMLSuite using wctme after putting the required JAXP and Xalan classes in the classpath; all XML tests then ran without error, as expected.\r\n\r\nPatch is ready for review.  I tried to add extensive comments explaining why these changes are needed, so it'd be great if people can at least review the comments and let me know what I can do to improve them.\r\n\r\nAnd as a final note, I tried running suites.All with wctme5.7 without the patch and I did indeed see the error reported here--so hopefully that means I'm running the wctme tests correctly :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-12-06T23:01:32.000+0000","updated":"2006-12-06T23:01:32.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357819/comment/12456257","id":"12456257","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Patch enables me to run the junit tests under J2ME/CDC/Foundation again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-12-06T23:24:50.000+0000","updated":"2006-12-06T23:24:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357819/comment/12456481","id":"12456481","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thank you for verifying the patch, Dan.  I went ahead and committed the changes  with svn 483532 since it allows J2ME tests to run again and since it does not appear to break anything else.\r\n\r\nIf anyone is/was/would like to review, though, please feel free to do so.  I will gladly post follow-up patches as necessary.  In the absence of any further comments, I'll resolve/close this issue in a day or two.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-12-07T16:51:23.000+0000","updated":"2006-12-07T16:51:23.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12357819/comment/12457397","id":"12457397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Patch committed on 12/07 and no further comments/issues have come up, so resolving/closing this Jira entry.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-12-11T16:35:33.000+0000","updated":"2006-12-11T16:35:33.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2153/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i070cv:"}}