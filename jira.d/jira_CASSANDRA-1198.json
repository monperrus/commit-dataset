{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12467113","self":"https://issues.apache.org/jira/rest/api/latest/issue/12467113","key":"CASSANDRA-1198","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315056","id":"12315056","description":"","name":"0.6.3","archived":false,"released":true,"releaseDate":"2010-06-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-06-16 18:39:37.422","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"1_*:*_1_*:*_791195300_*|*_5_*:*_1_*:*_0","customfield_12310420":"20031","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-06-25T22:12:51.401+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1198/watchers","watchCount":3,"isWatching":false},"created":"2010-06-16T18:26:16.101+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-06-25T22:12:51.390+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"Row iteration with get_range_slices() does not return all keys. This behaviour only occurs with more than one node and depends on how the nodes are located on the ring.\r\n\r\nTo reproduce, insert some records into a cluster with more than one node. A subsequent row iteration will return fewer records than were inserted. This has been observed when 1) inserting into a single node, bootstrapping a second node then using get_range_slices() and 2) inserting into a cluster of several nodes then using get_range_slices().\r\n\r\nThis appears to be similar to https://issues.apache.org/jira/browse/CASSANDRA-781","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12447546","id":"12447546","filename":"1198.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-20T05:51:01.599+0000","size":6603,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12447546/1198.txt"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"92013","summary":"In a cluster, get_range_slices() does not return all the keys it should","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cgist","name":"cgist","emailAddress":"christopher dot gist at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Gist","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cgist","name":"cgist","emailAddress":"christopher dot gist at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Gist","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":"Linux 2.6.18-128.1.10.el5.xs5.5.0.51xen\r\nJava build 1.6.0_17-b04\r\nCassandra 0.7 2010-06-15 including patch for https://issues.apache.org/jira/browse/CASSANDRA-1130","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467113/comment/12879445","id":"12879445","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Christopher reported on IRC that he cannot reproduce in 0.6, so this does appear to be a 0.7-only bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-16T18:39:37.422+0000","updated":"2010-06-16T18:39:37.422+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467113/comment/12880585","id":"12880585","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cgist","name":"cgist","emailAddress":"christopher dot gist at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Gist","active":true},"body":"It looks like this issue is a regression of https://issues.apache.org/jira/browse/CASSANDRA-1042 so it should in fact affect 0.6.3, though I haven't confirmed.\r\n\r\nWhen doing a row iteration starting from token 0, since the ranges are no longer sorted by ring order after #1042 but by wrap order, the iteration could start with the range to the left of 0. This results in either iterating through fewer than all keys, or iterating through duplicate keys. I have seen the following different behaviour, varying based on the ring tokens, key count and distribution, and range count:\r\n1) too few keys because range slice command had lower count than keys in (z,0] range and subsequent range slice was restricted to only the (z,0] range\r\n2) duplicate keys because range slice command had higher count than keys in (z,0] range and keys in range (z,0] were repeated\r\n3) too few keys because ranges were handled out of token order, eg. (z,0] before (y,z] so no keys in (y,z] were returned\r\n\r\nAlso it would appear that token ranges passed into get_range_slices() are in fact start inclusive, contrary to the wiki. Is this correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cgist","name":"cgist","emailAddress":"christopher dot gist at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Gist","active":true},"created":"2010-06-20T03:58:32.958+0000","updated":"2010-06-20T03:58:32.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467113/comment/12880592","id":"12880592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Excellent work.  Yes, the sort that was removed was in fact necessary (which is stated in the docstring to getRestrictedRanges, but then the sort was done elsewhere so the confusion was understandable).\r\n\r\nThis patch adds back the sort (this time in gRR) and moves the endpoints-handling to getRangeSlice (where doing just-in-time liveness checking has the added benefit of improving availability for large queries) to make gRR less muddled.\r\n\r\n(Token-based range queries are turned into Bounds objects, which are start-inclusive, as opposed to Range objects, which are not.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-20T05:51:01.661+0000","updated":"2010-06-20T05:51:01.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467113/comment/12880621","id":"12880621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"body":"Oh crumb!\r\n\r\nWe had fixed the problem manifest in 1045 but overlooked that part of it. Nice catch.\r\n\r\nI'll go ahead and try that patch out on the word count example to make sure it works tomorrow.\r\n\r\nThanks Christopher and Jonathan.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"created":"2010-06-20T11:52:37.748+0000","updated":"2010-06-20T11:52:37.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467113/comment/12880877","id":"12880877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"body":"Hmmm, I tried latest vanilla 0.6 branch with this patch and the duplicates have come back in the word count example. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeromatron","name":"jeromatron","emailAddress":"jeremy dot hanna1234 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Hanna","active":true},"created":"2010-06-21T15:57:24.535+0000","updated":"2010-06-21T15:57:24.535+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467113/comment/12882737","id":"12882737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=urandom","name":"urandom","emailAddress":"eevans at opennms dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=urandom&avatarId=10031","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=urandom&avatarId=10031","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=urandom&avatarId=10031","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=urandom&avatarId=10031"},"displayName":"Eric Evans","active":true},"created":"2010-06-25T22:09:59.476+0000","updated":"2010-06-25T22:09:59.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467113/comment/12882739","id":"12882739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed.  (CASSANDRA-1042 is re-opened for fixing the original bug.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-25T22:12:51.379+0000","updated":"2010-06-25T22:12:51.379+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1198/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g3lj:"}}