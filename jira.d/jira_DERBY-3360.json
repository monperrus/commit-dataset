{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12387371","self":"https://issues.apache.org/jira/rest/api/latest/issue/12387371","key":"DERBY-3360","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313143","id":"12313143","description":"Head of 10.3 branch","name":"10.3.3.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-02-26 11:01:04.75","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23594","customfield_12310222":"1_*:*_1_*:*_15418019533_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-07-25T22:05:38.717+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3360/watchers","watchCount":0,"isWatching":false},"created":"2008-01-29T11:18:39.184+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313142","id":"12313142","description":"","name":"10.3.3.0","archived":false,"released":true,"releaseDate":"2008-05-12"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:51:23.954+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"Invalid method java.lang.Integer >> void <init>(short) because java.lang.NoSuchMethodException: java.lang.Integer.<init>(short)\n\n\nTrue, but I believe, not a helpful observation :-)\n\nFN_MATCHES(A.f, C.d) returns short/SMALLINT\n\nrelated to DERBY-3310 ? But this is on the 10.3 branch [10.3.2.2 - (616244M)]\n\n\nDEBUG 68421 [Main] (Template.java:69) - SQL: SELECT A.a, D.b, B.c, C.d FROM C JOIN A ON C.e = 'I' AND A.f IS NOT NULL AND A.g = C.g AND FN_MATCHES(A.f, C.d) <> 1 JOIN B ON B.h = A.g JOIN D ON D.h = URID.h\njava.lang.NoSuchMethodException: java.lang.Integer.<init>(short)\n        at java.lang.Class.getConstructor0(Class.java:2706)\n        at java.lang.Class.getConstructor(Class.java:1657)\n        at org.apache.derby.impl.services.bytecode.d_BCValidate.checkMethod(d_BCValidate.java:115)\n        at org.apache.derby.impl.services.bytecode.BCMethod.callMethod(BCMethod.java:745)\n        at org.apache.derby.impl.services.bytecode.BCMethod.pushNewComplete(BCMethod.java:779)\n        at org.apache.derby.impl.sql.compile.StaticMethodCallNode.generateExpression(StaticMethodCallNode.java:995)\n        at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.generateExpression(JavaToSQLValueNode.java:167)\n        at org.apache.derby.impl.sql.compile.BinaryOperatorNode.generateExpression(BinaryOperatorNode.java:599)\n        at org.apache.derby.impl.sql.compile.BinaryLogicalOperatorNode.generateExpression(BinaryLogicalOperatorNode.java:157)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1484)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302)\n        at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1579)\n        at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1555)\n        at org.apache.derby.impl.sql.compile.JoinNode.generate(JoinNode.java:1479)\n        at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1577)\n        at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1555)\n        at org.apache.derby.impl.sql.compile.JoinNode.generate(JoinNode.java:1479)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1440)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302)\n        at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(ScrollInsensitiveResultSetNode.java:109)\n        at org.apache.derby.impl.sql.compile.CursorNode.generate(CursorNode.java:564)\n        at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:347)\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:447)\n        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88)\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:746)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.<init>(EmbedPreparedStatement.java:129)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.<init>(EmbedPreparedStatement20.java:82)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.<init>(EmbedPreparedStatement30.java:63)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.<init>(EmbedPreparedStatement40.java:40)\n        at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:105)\n        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:923)\n        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:751)\n\n       [..]\n        at org.apache.derby.exe.ac12564092x0117xc525x43e4xffffbce342b018.g0(Unknown Source)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46)\n        at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:74)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173)\n        at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173)\n        at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299)\n        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101)\n        at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745)\n        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801)\n        at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)\n        \nInvalid method java.lang.Integer >> void <init>(short) because java.lang.NoSuchMethodException: java.lang.Integer.<init>(short)\n\nDEBUG 70472 [Main] (Template.java:120) - java.sql.SQLException: Java exception: 'ASSERT FAILED Invalid method java.lang.Integer >> void <init>(short) because java.lang.NoSuchMethodException: java.lang.Integer.<init>(short): org.apache.derby.shared.common.sanity.AssertFailure'.\nERROR 70500 [Main] (TransactionTemplate.java:163) - Application exception overridden by rollback exception\norg.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException for SQL [ <Statement that fires trigger removed> ]; SQL state [XJ001]; error code [0]; Java exception: ': java.lang.NullPointerException'.; nested exception is java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\nCaused by: \njava.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88)\n        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:245)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1573)\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1294)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299)\n        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101)\n        at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745)\n        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801)\n        at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)\nCaused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:135)\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)\n        ... 29 more\nCaused by: java.lang.NullPointerException\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:217)\n        at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173)\n        at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203)\n        ... 22 more\nFATAL 70508 [Main] (Start.java:153) - Start FAILED\norg.springframework.transaction.TransactionSystemException: Could not roll back JDBC transaction; nested exception is java.sql.SQLNonTransientConnectionException: No current connection.\nCaused by: \njava.sql.SQLNonTransientConnectionException: No current connection.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:76)\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:88)\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:104)\n        at org.apache.derby.impl.jdbc.Util.noCurrentConnection(Util.java:208)\n        at org.apache.derby.impl.jdbc.EmbedConnection.checkIfClosed(EmbedConnection.java:1548)\n        at org.apache.derby.impl.jdbc.EmbedConnection.setupContextStack(EmbedConnection.java:1759)\n        at org.apache.derby.impl.jdbc.EmbedConnection.rollback(EmbedConnection.java:1142)\n        at org.apache.commons.dbcp.DelegatingConnection.rollback(DelegatingConnection.java:265)\n        at org.apache.commons.dbcp.PoolingDataSource$PoolGuardConnectionWrapper.rollback(PoolingDataSource.java:288)\n        at org.springframework.jdbc.datasource.DataSourceTransactionManager.doRollback(DataSourceTransactionManager.java:259)\n        at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:742)\n        at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:719)\n        at org.springframework.transaction.support.TransactionTemplate.rollbackOnException(TransactionTemplate.java:160)\n        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:138)\n Caused by: java.sql.SQLException: No current connection.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:135)\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)\n        ... 21 more\n\n\nderby.log\n\norg.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED Invalid method java.lang.Integer >> void <init>(short) because java.lang.NoSuchMethodException: java.lang.Integer.<init>(short)\n        at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162)\n        at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147)\n        at org.apache.derby.impl.services.bytecode.d_BCValidate.checkMethod(d_BCValidate.java:190)\n        at org.apache.derby.impl.services.bytecode.BCMethod.callMethod(BCMethod.java:745)\n        at org.apache.derby.impl.services.bytecode.BCMethod.pushNewComplete(BCMethod.java:779)\n        at org.apache.derby.impl.sql.compile.StaticMethodCallNode.generateExpression(StaticMethodCallNode.java:995)\n        at org.apache.derby.impl.sql.compile.JavaToSQLValueNode.generateExpression(JavaToSQLValueNode.java:167)\n        at org.apache.derby.impl.sql.compile.BinaryOperatorNode.generateExpression(BinaryOperatorNode.java:599)\n        at org.apache.derby.impl.sql.compile.BinaryLogicalOperatorNode.generateExpression(BinaryLogicalOperatorNode.java:157)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1484)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302)\n        at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1579)\n        at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1555)\n        at org.apache.derby.impl.sql.compile.JoinNode.generate(JoinNode.java:1479)\n        at org.apache.derby.impl.sql.compile.JoinNode.getJoinArguments(JoinNode.java:1577)\n        at org.apache.derby.impl.sql.compile.JoinNode.generateCore(JoinNode.java:1555)\n        at org.apache.derby.impl.sql.compile.JoinNode.generate(JoinNode.java:1479)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1440)\n        at org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302)\n        at org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(ScrollInsensitiveResultSetNode.java:109)\n        at org.apache.derby.impl.sql.compile.CursorNode.generate(CursorNode.java:564)\n        at org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:347)\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:447)\n        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88)\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:746)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.<init>(EmbedPreparedStatement.java:129)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement20.<init>(EmbedPreparedStatement20.java:82)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement30.<init>(EmbedPreparedStatement30.java:63)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement40.<init>(EmbedPreparedStatement40.java:40)\n        at org.apache.derby.jdbc.Driver40.newEmbedPreparedStatement(Driver40.java:105)\n        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:923)\n        at org.apache.derby.impl.jdbc.EmbedConnection.prepareStatement(EmbedConnection.java:751)\n[our trigger stored proc java code]\n        at org.apache.derby.exe.ac12564092x0117xc525x43e4xffffbce342b018.g0(Unknown Source)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46)\n        at org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:74)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173)\n        at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173)\n        at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299)\n        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101)\n        at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745)\n        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801)\n        at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)\n \nCleanup action completed\n2008-01-29 10:44:58.980 GMT Thread[Main,5,main] Cleanup action starting\njava.lang.NullPointerException\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:217)\n        at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(GenericTriggerExecutor.java:173)\n        at org.apache.derby.impl.sql.execute.StatementTriggerExecutor.fireTrigger(StatementTriggerExecutor.java:80)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(TriggerEventActivator.java:278)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1163)\n        at org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:497)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:370)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1203)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299)\n        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101)\n        at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745)\n        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801)\n        at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)\n\n2008-01-29 10:44:58.987 GMT Thread[Main,5,main] Equally severe exception raised during cleanup (ignored) null\njava.lang.NullPointerException\n        at org.apache.derby.impl.sql.compile.CompilerContextImpl.initRequiredPriv(CompilerContextImpl.java:698)\n        at org.apache.derby.impl.sql.compile.CompilerContextImpl.resetContext(CompilerContextImpl.java:158)\n        at org.apache.derby.impl.sql.compile.CompilerContextImpl.cleanupOnError(CompilerContextImpl.java:107)\n        at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:327)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:419)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:337)\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:1573)\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1294)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1652)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:299)\n        at org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:101)\n        at org.springframework.jdbc.core.JdbcTemplate$2.doInPreparedStatement(JdbcTemplate.java:745)\n        at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:538)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:739)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:797)\n        at org.springframework.jdbc.core.JdbcTemplate.update(JdbcTemplate.java:801)\n        at org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate.update(NamedParameterJdbcTemplate.java:218)\n \nCleanup action completed\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37344","summary":"Invalid method java.lang.Integer >> void <init>(short) because java.lang.NoSuchMethodException: java.lang.Integer.<init>(short)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Derby 10.3 Branch [10.3.2.2 - (616244M)] and 10.3.2.1\njava version \"1.6.0_03\"\nJava(TM) SE Runtime Environment (build 1.6.0_03-b05)\nJava HotSpot(TM) 64-Bit Server VM (build 1.6.0_03-b05, mixed mode)","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":15,"total":15,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12563531","id":"12563531","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"body":"More info,\r\n\r\nCAST(FN_MATCHES(..) AS INTEGER) avoids the bug.\r\n\r\n10.3.1.4 (sane) shows this behaviour too\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"created":"2008-01-29T14:27:21.493+0000","updated":"2008-01-29T14:40:23.956+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12563608","id":"12563608","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"body":"10.3.2.1 (sane) shows the behaviour.\r\n\r\nNow, here's the rub:\r\n\r\n10.3.2.1 (insane) runs more of the SQL script, but fails with seemingly the same stack trace, the top of which from derby.log is:\r\n\r\njava.lang.NullPointerException\r\n        at org.apache.derby.impl.sql.compile.ResultColumn.columnTypeAndLengthMatch(Unknown Source)\r\n        at org.apache.derby.impl.sql.compile.ResultColumnList.columnTypesAndLengthsMatch(Unknown Source)\r\n        at org.apache.derby.impl.sql.compile.ResultSetNode.columnTypesAndLengthsMatch(Unknown Source)\r\n        at org.apache.derby.impl.sql.compile.UnionNode.addNewNodes(Unknown Source)\r\n        at org.apache.derby.impl.sql.compile.UnionNode.modifyAccessPaths(Unknown Source)\r\n        at org.apache.derby.impl.sql.compile.SingleChildResultSetNode.modifyAccessPaths(Unknown Source)\r\n        at org.apache.derby.impl.sql.compile.DMLStatementNode.optimizeStatement(Unknown Source)\r\n        at org.apache.derby.impl.sql.compile.DMLModStatementNode.optimizeStatement(Unknown Source)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\r\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeBatchElement(Unknown Source)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeBatch(Unknown Source)\r\n\r\nThis second failure point is like\r\n\r\nINSERT INTO t1 (c1)\r\nSELECT c1 FROM t2\r\nUNION\r\nSELECT c1FROM t3.\r\n\r\nThe crucial point is that the UNION has a SMALLINT column in it. If I re-write as:\r\n\r\nINSERT INTO t1 (c1)\r\nSELECT CAST(V.c1 AS SMALLINT)\r\nFROM (\r\nSELECT c1 FROM t2\r\nUNION\r\nSELECT c1FROM t3\r\n) AS V\r\n\r\nno NPE!!!!\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"created":"2008-01-29T18:37:58.195+0000","updated":"2008-01-29T18:37:58.195+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12572419","id":"12572419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"This issue seems to use either 'existing application impact' or 'release note needed' incorrectly, according to the description at \r\n\r\nhttp://db.apache.org/derby/DerbyBugGuidelines.html#Set+appropriate+special+%22flags%22\r\n\r\nI plan to remove the flags shortly unless there are additional comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-02-26T11:01:04.750+0000","updated":"2008-02-26T11:01:04.750+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12572440","id":"12572440","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"body":"I am unable to use Derby in my application because of this issue.\r\n\r\nI am using Postgres for the time being.\r\n\r\nIf this is fixed then I can continue debugging (DERBY-3221) and hopefully support Derby again.\r\n\r\nIs this not what the flag is for?\r\n\r\nThis issue may be a duplicate of DERBY-3310\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"created":"2008-02-26T11:57:16.034+0000","updated":"2008-02-26T11:57:16.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12572450","id":"12572450","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"To quote from the link I mentioned:\r\n\r\n\"Existing Application impact: an existing application can be impacted by the solution to this issue.\"\r\n\r\nNote that is the SOLUTION that will impact an existing application, NOT the bug. \r\n\r\nThe typical example would be if Derby incorrectly allowed something which either JDBC  or SQL forbids. The solution is to forbid that something and throw an exception. But that could cause existing applications, that inadvertently had come to rely on the incorrect behavior, to break. \r\n\r\nI can't really see anyone depending on the incorrect behavior caused by DERBY-3360, so that is why I want to remove the flag.\r\n\r\nIt seems like DERBY-3221 has been closed? I believe DERBY-3310 is being worked on, but it seems to be a more fundamental problem than I first thought...\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-02-26T12:24:20.038+0000","updated":"2008-02-26T12:25:35.779+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12572465","id":"12572465","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"body":"My apologies.\r\n\r\nMy use was because the SOLUTION would enable me to return to using Derby in my EXISTING application.\r\n\r\nI can understand if you do not feel that this is within the scope of the flag.\r\n\r\nDERBY-3221 has been closed, but I do not believe it is in any released version yet?\r\n\r\n\"I can't really see anyone depending on the incorrect behavior caused by DERBY-3360, so that is why I want to remove the flag. \"\r\n\r\nIf the meaning of the flag is that SOLUTION (as a verb) of this bug may change the behaviour of EXISTING applications DEPENDING ON THE CURRENT BEHAVIOUR of the bug reported, then I do not read this from the definition, and I would suggest it be made clearer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"created":"2008-02-26T13:14:56.179+0000","updated":"2008-02-26T13:14:56.179+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12572513","id":"12572513","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"James, can you attach a reproducible test case to this issue?  The description does not seem to have the function definition and schema.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-02-26T15:24:23.666+0000","updated":"2008-02-26T15:24:23.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12572857","id":"12572857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"body":"Test case attached\r\n\r\nRunning against 10.3.2.1 sane:\r\n\r\nij version 10.3\r\nCONNECTION0* - \tjdbc:derby:testcase\r\n* = current connection\r\nij> CREATE FUNCTION FN_SMALLINT(i INT) RETURNS SMALLINT PARAMETER STYLE JAVA NO SQL LANGUAGE JAVA EXTERNAL NAME 'Functions.smallint' RETURNS NULL ON NULL INPUT;\r\n0 rows inserted/updated/deleted\r\nij> CREATE TABLE test (a INT);\r\n0 rows inserted/updated/deleted\r\nij> INSERT INTO test VALUES (1),(2),(3),(4),(5);\r\n5 rows inserted/updated/deleted\r\nij> SELECT a FROM test WHERE FN_SMALLINT(a) <> 1;\r\njava.lang.NoSuchMethodException: java.lang.Integer.<init>(short)\r\n\tat java.lang.Class.getConstructor0(Class.java:2706)\r\n\tat java.lang.Class.getConstructor(Class.java:1657)\r\n\tat org.apache.derby.impl.services.bytecode.d_BCValidate.checkMethod(d_BCValidate.java:116)\r\n\tat org.apache.derby.impl.services.bytecode.BCMethod.callMethod(BCMethod.java:745)\r\n\tat org.apache.derby.impl.services.bytecode.BCMethod.pushNewComplete(BCMethod.java:779)\r\n\tat org.apache.derby.impl.sql.compile.StaticMethodCallNode.generateExpression(StaticMethodCallNode.java:995)\r\n\tat org.apache.derby.impl.sql.compile.JavaToSQLValueNode.generateExpression(JavaToSQLValueNode.java:167)\r\n\tat org.apache.derby.impl.sql.compile.BinaryOperatorNode.generateExpression(BinaryOperatorNode.java:599)\r\n\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1484)\r\n\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302)\r\n\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(ProjectRestrictNode.java:1351)\r\n\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(ProjectRestrictNode.java:1302)\r\n\tat org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(ScrollInsensitiveResultSetNode.java:109)\r\n\tat org.apache.derby.impl.sql.compile.CursorNode.generate(CursorNode.java:564)\r\n\tat org.apache.derby.impl.sql.compile.StatementNode.generate(StatementNode.java:347)\r\n\tat org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:447)\r\n\tat org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88)\r\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConnectionContext.java:746)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:579)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:528)\r\n\tat org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:330)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:522)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:364)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:262)\r\n\tat org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\r\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\r\n\tat org.apache.derby.impl.tools.ij.Main14.main(Main14.java:56)\r\n\tat org.apache.derby.tools.ij.main(ij.java:71)\r\nInvalid method java.lang.Integer >> void <init>(short) because java.lang.NoSuchMethodException: java.lang.Integer.<init>(short)\r\nERROR XJ001: Java exception: 'ASSERT FAILED Invalid method java.lang.Integer >> void <init>(short) because java.lang.NoSuchMethodException: java.lang.Integer.<init>(short): org.apache.derby.shared.common.sanity.AssertFailure'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=northshorefiend","name":"northshorefiend","emailAddress":"spam123 at JamesAshepherd dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James Alan Shepherd","active":true},"created":"2008-02-27T10:18:58.056+0000","updated":"2008-02-27T10:18:58.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12604023","id":"12604023","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"For the record, implicit casting seems to be done when both operands are columns from the same table. The following works:\r\n\r\nij> create table test2( a int, b smallint );\r\n0 rows inserted/updated/deleted\r\nij> insert into test2( a, b ) values ( 1, 1 ), ( 2, 3 );\r\n2 rows inserted/updated/deleted\r\nij> select * from test2 where a <> b;\r\nA          |B     \r\n------------------\r\n2          |3     \r\n\r\n1 row selected","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-06-10T20:29:46.210+0000","updated":"2008-06-10T20:29:46.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12615826","id":"12615826","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Putting this as SQL component for now. It wasn't showing up on the bug reports because there was no component.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-07-22T23:27:20.577+0000","updated":"2008-07-22T23:27:20.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12616146","id":"12616146","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"If I define the function without the \"RETURNS NULL ON NULL INPUT\"  it works ok. e.g.\r\n\r\nCREATE FUNCTION FN_SMALLINT(i INT) RETURNS SMALLINT PARAMETER STYLE JAVA NO SQL LANGUAGE JAVA EXTERNAL NAME 'Functions.smallint';\r\n\r\ninstead of \r\n\r\nCREATE FUNCTION FN_SMALLINT(i INT) RETURNS SMALLINT PARAMETER STYLE JAVA NO SQL LANGUAGE JAVA EXTERNAL NAME 'Functions.smallint' RETURNS NULL ON NULL INPUT;\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-07-23T16:23:12.324+0000","updated":"2008-07-23T16:23:12.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12616236","id":"12616236","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is my first shot at fixing this issue. It is not for commit as no tests have been written or run.  I just verified that it resolves the repro.  I'm just posting to make sure I am on the right track.\r\n\r\nFunctions returning SMALLINT are a special case.  The function definition returns short but the actual java return type if RETURN NULL ON NULL INPUT is java.lang.Integer.  I think this is because getObject on a SMALLINT column returns an Integer according to the JDBC spec.  I am assuming this java return type is right.\r\n\r\nSince the java return type is Integer we need to upcast the short to an int before calling \tmbnc.pushNewComplete(1); for this case.\r\n\r\nI'd appreciate if someone could validate this approach.  I will work to turn it into a full patch with tests.  It seems we don't have much in the way of testing for RETURN NULL ON NULL INPUT, so I will add tests for the other types too.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-07-23T19:43:25.153+0000","updated":"2008-07-23T19:43:25.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12616714","id":"12616714","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is a patch for this issue.  The code change is the same as I proposed earlier.  Please review.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-07-24T23:58:24.355+0000","updated":"2008-07-24T23:58:24.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12616874","id":"12616874","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Looks like a reasonable fix to me. +1 to commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-25T12:22:26.402+0000","updated":"2008-07-25T12:22:26.402+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387371/comment/12617079","id":"12617079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Ported fix to 10.4 and 10.3 branches. Please verify the fix and close the issue.\r\n\r\nThanks\r\nKathey\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-07-25T22:05:38.640+0000","updated":"2008-07-25T22:05:38.640+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3360/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06r7z:"}}