{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12419205","self":"https://issues.apache.org/jira/rest/api/latest/issue/12419205","key":"DERBY-4110","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-07-02 18:26:06.391","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24031","customfield_12310222":"1_*:*_1_*:*_25019623991_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-01-07T00:11:23.566+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4110/watchers","watchCount":2,"isWatching":false},"created":"2009-03-23T10:17:39.575+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:19:13.555+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"Getting an error (using Derby 10.4.1.3) when deleting records from a table using a qualified synonymn name.\r\nTable Name is ABC_PROCESS_INVOCATION_XML and the synonmyn name is SYN_ABC_P_I_X\r\n\r\nThe query being fired was\r\n\"Delete from SYN_ABC_P_I_X where ID = ? \"\r\n\r\nfrom the error log\r\n---------------\r\nCaused by: ERROR 42X04: Column 'APP.ABC_PROCESS_INVOCATION_XML.ID' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then 'APP.ABC_PROCESS_INVOCATION_XML.ID' is not a column in the target table.\r\n---------------\r\n\r\nAfter going thru few earlier bugs, a similar bug has been logged earlier bug DERBY-1784 \r\nhttp://issues.apache.org/jira/browse/DERBY-1784\r\n\r\nBut looks like the fix did not make its way to 10.4.1.3?\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38254","summary":"When deleting rows from a table name with its synonym name, Derby throws SQLSTATE 42X04.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanna_pramati","name":"prasanna_pramati","emailAddress":"prasanna at pramati dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lakshmi Prasanna","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=prasanna_pramati","name":"prasanna_pramati","emailAddress":"prasanna at pramati dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lakshmi Prasanna","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":12,"total":12,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12726600","id":"12726600","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Triaged July 2, 2009: Downgrading urgency to normal.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2009-07-02T18:26:06.391+0000","updated":"2009-07-02T18:26:06.391+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12781211","id":"12781211","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I ran the script from DERBY-1784 against both the 10.4.1.3 release as well as against the trunk,\r\nand the script runs fine, so it appears that DERBY-1784 is definitely fixed both in 10.4.1.3\r\nas well as in the trunk. I also checked the subversion logs, and they show that the DERBY-1784\r\nfix is present in both places. So I think that the DERBY-1784 fix is fine.\r\n\r\nBelow is the output of the script I ran.\r\n\r\nIs there a script which can reproduce this problem more exactly, either in 10.4.1.3 or in the trunk?\r\n\r\nC:\\temp\\d1784>java -cp \\tools\\derby\\db-derby-10.4.1.3-bin\\lib\\derbyrun.jar org.apache.derby.tools.ij\r\nij version 10.4\r\nij> run '/temp/d1784.sql';\r\nij> connect 'jdbc:derby:wombat;create=true' user 'user1' as user1;\r\nij> create schema test1;\r\n0 rows inserted/updated/deleted\r\nij> create schema test2;\r\n0 rows inserted/updated/deleted\r\nij> create table test1.t1 ( id bigint not null );\r\n0 rows inserted/updated/deleted\r\nij> insert into test1.t1 values (1),(2);\r\n2 rows inserted/updated/deleted\r\nij> create synonym test2.t1 for test1.t1;\r\n0 rows inserted/updated/deleted\r\nij> set schema test1;\r\n0 rows inserted/updated/deleted\r\nij> select t1.id from t1;\r\nID\r\n--------------------\r\n1\r\n2\r\n\r\n2 rows selected\r\nij> set schema test2;\r\n0 rows inserted/updated/deleted\r\nij> select t1.id from t1;\r\nID\r\n--------------------\r\n1\r\n2\r\n\r\n2 rows selected\r\nij> select id from t1;\r\nID\r\n--------------------\r\n1\r\n2\r\n\r\n2 rows selected\r\nij> delete from t1 where id = 2;\r\n1 row inserted/updated/deleted\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-11-22T20:29:00.339+0000","updated":"2009-11-22T20:29:00.339+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12782340","id":"12782340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bjustx","name":"bjustx","emailAddress":"jb at wuestenrot dot at","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Boris Just","active":true},"body":"I have the same Problem. We are already working with Derby 10.1.3.1. We upgraded to Version 10.5.3.0 and encrypted the database with dataEncryption=true. Everything works fine. Only deletes on synonym tables fail with ERROR 42X04 and the mentioned message. I have also tried 10.4.1.3 and it also failed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bjustx","name":"bjustx","emailAddress":"jb at wuestenrot dot at","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Boris Just","active":true},"created":"2009-11-25T08:31:10.538+0000","updated":"2009-11-25T08:31:10.538+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12782450","id":"12782450","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Boris.\r\n\r\nDo you have a script you can contribute which demonstrates the problem?\r\n\r\nCan you run the script that I posted above? Does it fail for you in 10.4.1.3?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-11-25T14:37:47.717+0000","updated":"2009-11-25T14:37:47.717+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12782515","id":"12782515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bjustx","name":"bjustx","emailAddress":"jb at wuestenrot dot at","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Boris Just","active":true},"body":"Hi Bryan!\r\nThere is a difference between your script and my definition. In addition I have defined an unique index on the table badax.r058100.\r\nWithout index it also works on my database.\r\n\r\nIJ Version 10.5\r\nij> connect 'jdbc:derby:d:\\temp\\testDB;create=true';\r\nij> create schema BADAX;\r\n0 Zeilen eingef³gt/aktualisiert/gel÷scht\r\nij> create table BADAX.R058100 (CHGTSP TIMESTAMP, DELFLAG CHAR(1), LIZENZ INTEGER, KUNDNR INTEGER, ERSTTSP TIMESTAMP, LFDNR SMALLINT, KONTAKTART CHAR(2), KONTAKTDAT INTEGER, SCHLAGW CHAR(60), TXT VARCHAR(2048), ERSTSPARTE CHAR(4), ERSTPRODNR CHAR(11), ERSTPGM CHAR(8), VERSION SMALLINT);\r\n0 Zeilen eingef³gt/aktualisiert/gel÷scht\r\nij> create synonym BADAX.Q058100 FOR BADAX.R058100;\r\n0 Zeilen eingef³gt/aktualisiert/gel÷scht\r\nij> CREATE UNIQUE INDEX XR0581B ON BADAX.R058100(LIZENZ,KUNDNR,LFDNR,ERSTTSP);\r\n0 Zeilen eingef³gt/aktualisiert/gel÷scht\r\nij> insert into \"BADAX\".\"R058100\" (\"CHGTSP\", \"DELFLAG\", \"LIZENZ\", \"KUNDNR\", \"ERS\r\nTTSP\", \"LFDNR\", \"KONTAKTART\", \"KONTAKTDAT\", \"SCHLAGW\", \"TXT\", \"ERSTSPARTE\", \"ERS\r\nTPRODNR\", \"ERSTPGM\", \"VERSION\") values ('2009-10-16 13:38:21.781', 'A', 105911,1\r\n377917, '2009-10-16 13:38:21.781', 999, 'F ', 20091016, 'Fonds-Polizze/08\r\n                               ', '<dokumente><dokument logicalID=\"2009-10-16-13\r\n.38.21.734000\" physicalID=\"P1255693101734.pdf\" status=\"V\"/></dokumente>', '    '\r\n, '           ', '        ', 0);\r\n1 Zeile eingef³gt/aktualisiert/gel÷scht\r\nij> delete from BADAX.Q058100;\r\nFEHLER 42X04: Die Spalte 'BADAX.R058100.LIZENZ' ist in keiner Tabelle der FROM-L\r\niste enthalten, erscheint in einer Verkn³pfungsspezifikation und befindet sich a\r\nu▀erhalb des Geltungsbereichs derselben oder erscheint in einer HAVING-Klausel u\r\nnd ist nicht in der 'GROUP BY'-Liste enthalten. Wenn es sich um eine Anweisung C\r\nREATE oder ALTER TABLE handelt, ist 'BADAX.R058100.LIZENZ' keine Spalte in der Z\r\nieltabelle.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bjustx","name":"bjustx","emailAddress":"jb at wuestenrot dot at","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Boris Just","active":true},"created":"2009-11-25T17:19:37.857+0000","updated":"2009-11-25T17:19:37.857+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12782533","id":"12782533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Boris! Adding the CREATE UNIQUE INDEX did the trick.\r\n\r\nI can now reproduce the strange behavior in both the 10.4 release and in the trunk.\r\n\r\nAttached is 'repro.sql', which causes the strange message to appear.\r\n\r\nI'll see if I can figure out what is going on under the covers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-11-25T17:55:42.239+0000","updated":"2009-11-25T17:55:42.239+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12782573","id":"12782573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I see that UpdateNode and InsertNode have some special code in their\r\nbindStatement() methods to call normalizeSynonymColumns, but\r\nDeleteNode does not have such special code. That looks intriguing,\r\nso I'll chase that theory for a while...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-11-25T19:34:56.885+0000","updated":"2009-11-25T19:34:56.885+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12784252","id":"12784252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The patch below appears to make the repro script pass, and appears to cause\r\nno other ill effects (in simple testing). The idea behind the patch is that when\r\nbuilding the ResultColumnList that is used to tie together the search results\r\nfrom the WHERE clause with the processing of the DELETE, the result columns\r\nwill be bound against the exposed table name of the table named in the DELETE\r\nstatement, so if the statement used a synonymTableName, then the result\r\ncolumn list should manufacture column references which use a synonymTableName as well.\r\n\r\nI'm not sure about the operation of the 'normalizeSynonymColumns' code that I\r\ncommented on last week; I don't understand exactly when that code comes into play,\r\nbut it does NOT appear to be relevant to this particular case. I think it has more to\r\ndo with the fact that INSERT and UPDATE can refer to a named set of columns which\r\nare to be affected by the statement, whereas DELETE operates on the entire row.\r\n\r\nAnyway, here's the patch I'm currently pursuing:\r\n\r\nIndex: java/engine/org/apache/derby/impl/sql/compile/DMLModStatementNode.java\r\n===================================================================\r\n--- java/engine/org/apache/derby/impl/sql/compile/DMLModStatementNode.java  (revision 885667)\r\n+++ java/engine/org/apache/derby/impl/sql/compile/DMLModStatementNode.java  (working copy)\r\n@@ -361,7 +361,7 @@\r\n      (FromBaseTable)\r\n        (getNodeFactory().getNode(\r\n                    C_NodeTypes.FROM_BASE_TABLE,\r\n-                   targetTableName,\r\n+                   synonymTableName != null ? synonymTableName : targetTableName,\r\n                    null,\r\n                    null,\r\n                    null,\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-12-01T14:51:45.700+0000","updated":"2009-12-01T14:51:45.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12793900","id":"12793900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is a patch proposal containing the code change and a regression\r\ntest based on the repro script.\r\n\r\nThe full regression test was clean.\r\n\r\nAny suggestions for additional regression tests, particularly w.r.t. synonym\r\nhandling, are welcome.\r\n\r\nI'm proposing to commit this patch, since it appears to resolve the\r\nrepro script and doesn't break any other tests.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-12-23T02:39:14.596+0000","updated":"2009-12-23T02:39:14.596+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12794119","id":"12794119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"+1 to commit. This looks like an improvement to me. I won't claim that I have understood if/how normalizeSynonymColumns() should come into play here, though...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-12-23T17:35:25.982+0000","updated":"2009-12-23T17:35:25.982+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/12797406","id":"12797406","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks for the code review, Knut. I don't have any further improvements\r\nto make to this patch at this time, so I'm committing it to the trunk for\r\nfurther shakeout and usage.\r\n\r\nCommitted to the trunk as revision 896722.\r\n\r\nI'm not planning to backport this fix to earlier branches at this time,\r\nalthough I don't think it would be hard to do, if somebody else wants to.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-01-07T00:11:23.436+0000","updated":"2010-01-07T00:11:23.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12419205/comment/13685166","id":"13685166","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:13.544+0000","updated":"2013-06-17T09:19:13.544+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4110/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06wu7:"}}