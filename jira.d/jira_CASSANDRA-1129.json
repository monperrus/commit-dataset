{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12465392","self":"https://issues.apache.org/jira/rest/api/latest/issue/12465392","key":"CASSANDRA-1129","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315056","id":"12315056","description":"","name":"0.6.3","archived":false,"released":true,"releaseDate":"2010-06-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-05-25 17:37:06.431","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"3_*:*_1_*:*_129503881_*|*_10002_*:*_1_*:*_179127446_*|*_1_*:*_1_*:*_303596761_*|*_5_*:*_1_*:*_0","customfield_12310420":"20001","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-06-01T19:26:55.226+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1129/watchers","watchCount":3,"isWatching":false},"created":"2010-05-25T17:23:07.138+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-06-04T02:38:45.700+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"I don't know if this is a general bug or only something related to my instance, but for me (v0.6.1) I've noticed that when defining KeysCached=\"50%\" (or KeysCached=\"100%\" and I didn't test other values with %) then cfstats reports Key cache capacity: 1\r\n\r\n      <ColumnFamily CompareWith=\"BytesType\" Name=\"KvAds\"\r\n        KeysCached=\"100%\"\r\n        RowsCached=\"10000\"\r\n        />\r\n\r\n\r\n                Column Family: KvAds\r\n                SSTable count: 7\r\n                Space used (live): 797535964\r\n                Space used (total): 797535964\r\n                Memtable Columns Count: 42292\r\n                Memtable Data Size: 10514176\r\n                Memtable Switch Count: 24\r\n                Read Count: 2563704\r\n                Read Latency: 4.590 ms.\r\n                Write Count: 1963804\r\n                Write Latency: 0.025 ms.\r\n                Pending Tasks: 0\r\n                Key cache capacity: 1\r\n                Key cache size: 1\r\n                Key cache hit rate: 0.0\r\n                Row cache capacity: 10000\r\n                Row cache size: 10000\r\n                Row cache hit rate: 0.2206178354382234\r\n                Compacted row minimum size: 386\r\n                Compacted row maximum size: 9808\r\n                Compacted row mean size: 616\r\n\r\nI'll attach one of the sstable files from this CF","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12445832","id":"12445832","filename":"0001-CASSANDRA1129.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-05-29T05:42:32.169+0000","size":7610,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12445832/0001-CASSANDRA1129.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12445907","id":"12445907","filename":"0002-CASSANDRA1129.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-05-31T07:26:46.105+0000","size":8992,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12445907/0002-CASSANDRA1129.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12446030","id":"12446030","filename":"0003-CASSANDRA1129.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-06-01T15:33:06.606+0000","size":6862,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12446030/0003-CASSANDRA1129.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12445489","id":"12445489","filename":"KvAds-84.zip","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rantav","name":"rantav","emailAddress":"rantav at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ran Tavory","active":true},"created":"2010-05-25T19:04:01.094+0000","size":4815426,"mimeType":"application/zip","content":"https://issues.apache.org/jira/secure/attachment/12445489/KvAds-84.zip"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12446118","id":"12446118","filename":"TOTRUNK-2-CASSANDRA1129.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-06-02T06:42:51.243+0000","size":6780,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12446118/TOTRUNK-2-CASSANDRA1129.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12446084","id":"12446084","filename":"TOTRUNK-CASSANDRA1129.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-06-02T00:50:52.064+0000","size":6699,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12446084/TOTRUNK-CASSANDRA1129.patch"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"91944","summary":"Using KeysCached=\"xx%\" results in Key cache capacity: 1","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rantav","name":"rantav","emailAddress":"rantav at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ran Tavory","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rantav","name":"rantav","emailAddress":"rantav at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ran Tavory","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":16,"total":16,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12871260","id":"12871260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rantav","name":"rantav","emailAddress":"rantav at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ran Tavory","active":true},"body":"The smallest sstable file I could find of this CF.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rantav","name":"rantav","emailAddress":"rantav at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ran Tavory","active":true},"created":"2010-05-25T17:33:57.438+0000","updated":"2010-05-25T17:33:57.438+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12871261","id":"12871261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"can you include index and filter parts too, as a zip or tarball?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-05-25T17:37:06.431+0000","updated":"2010-05-25T17:37:17.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12871292","id":"12871292","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rantav","name":"rantav","emailAddress":"rantav at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ran Tavory","active":true},"body":"zip file with index, data and filter","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rantav","name":"rantav","emailAddress":"rantav at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ran Tavory","active":true},"created":"2010-05-25T19:04:02.421+0000","updated":"2010-05-25T19:04:02.421+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12872218","id":"12872218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"So to troubleshoot this you would\r\n\r\n* check out the 0.6 branch\r\n* add the CF definition above to your conf/storage-conf.xml\r\n* unzip the sstable files into your data/Keyspace1 directory\r\n* set a breakpoint in DatabaseDescriptor.getKeysCachedFor and see why it's calculating 1 instead of the number of rows in the sstable","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-05-27T13:38:49.169+0000","updated":"2010-05-27T13:38:49.169+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12873240","id":"12873240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"body":"Status for first patch:\r\nM       test/unit/org/apache/cassandra/db/CompactionsPurgeTest.java\r\nM       test/conf/storage-conf.xml\r\nM       src/java/org/apache/cassandra/db/ColumnFamilyStore.java\r\nM       src/java/org/apache/cassandra/utils/FBUtilities.java\r\nM       src/java/org/apache/cassandra/cache/InstrumentedCache.java\r\nM       src/java/org/apache/cassandra/io/SSTableTracker.java\r\n\r\nThis bug was two bugs:\r\n# FBUtilities#absoluteFromFraction(double,long) is a bit ambiguous. The method reads 100% as *absolute* 1, so the keyCacheCapacity is always going to be 1. This fix is already in 0.7.\r\n# The bigger bug is that the keyCacheCapacity was not getting changed during runtime. There was a boolean capacityModified that controlled access to the capacity. It gets set true the first time the capacity is modified (read: creation of table/cfstore) and then never goes back to false. By removing this bool, the cache size gets updated on flushes and on compactions correctly.\r\n\r\nAlso included are tests in CompactionsPurgeTest that shows this fix works for both 50% and 100% (that the keyCacheCapacity changes dynamically).\r\n\r\nThe update is O(1), so it shouldn't matter for performance that it's being called on every flush and every compaction.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-05-29T05:42:32.250+0000","updated":"2010-05-29T05:42:32.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12873274","id":"12873274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed the absoluteFromFraction fix.\r\n\r\nfor the rest, we need to preserve the boolean, but make it only get set when the cache capacity is set manually from JMX (see CASSANDRA-1079)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-05-29T11:59:11.159+0000","updated":"2010-05-29T11:59:11.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12873567","id":"12873567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"body":"Removed the FBUtil change from patch.\r\n\r\nsetCapacity(int) changed to setCapacity(int,bool) in both interface and object.\r\nThe boolean in the object is now capacityFrozen with the same logic as before.\r\nsetCapacity from the automatic update (flushing/compaction) pass in a false to not freeze the capacity afterward, setCapacity from the JMX command pass in a true to do so.\r\n\r\n(To remedy a previous statement, the running time is not O(1) overall. It's O(|SSTables|) with constant time per table.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-05-31T07:26:46.191+0000","updated":"2010-05-31T07:26:46.191+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12874019","id":"12874019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"instead of overloading setCapacity to be the interface for both normal adjustments and manual overrides, let's split it up.  have setCapacity(value) be the mbean interface, setting a capacitySetManually boolean, and make a method updateCapacity(value) for internal use.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-01T14:15:34.229+0000","updated":"2010-06-01T14:15:34.229+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12874071","id":"12874071","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"body":"capacitySetManually is in place.\r\nsetCapacity(int), updateCapacity(int) work as described above.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-06-01T15:33:06.699+0000","updated":"2010-06-01T15:33:06.699+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12874177","id":"12874177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-01T19:26:55.206+0000","updated":"2010-06-01T19:26:55.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12874179","id":"12874179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"could you submit a version of this patch against trunk, too?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-01T19:31:00.770+0000","updated":"2010-06-01T19:31:00.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12874349","id":"12874349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"body":"Here's the patch for trunk.\r\nThe testconf.xml is now a testconf.yaml.\r\nThe test itself uses trunk-style clock, decorated keys.\r\n\r\nio/SSTableTracker changes go to io/sstable/SSTableTracker.\r\n\r\nThe other changes patched easily.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-06-02T00:50:52.159+0000","updated":"2010-06-02T00:50:52.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12874398","id":"12874398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I'm getting test failures on trunk (but not 0.6):\r\n\r\n    [junit] Testcase: testKeyCache50(org.apache.cassandra.db.CacheSizeTest):\tFAILED\r\n    [junit] 128\r\n    [junit] junit.framework.AssertionFailedError: 128\r\n    [junit] \tat org.apache.cassandra.db.CacheSizeTest.testKeyCache(CacheSizeTest.java:93)\r\n    [junit] \tat org.apache.cassandra.db.CacheSizeTest.testKeyCache50(CacheSizeTest.java:49)\r\n\r\n(I moved it to a separate CacheSizeTest class, in case the others in CompactionsPurgeTest were messing with it.  Didn't help.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-02T03:34:52.216+0000","updated":"2010-06-02T03:34:52.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12874455","id":"12874455","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"body":"All right, the difference is between SSTableReader.estimatedKeys() in 0.6 and RowIndexedReader.estimatedKeys() in 0.7 -- RIR increments the size once during estimation whereas SSTR does not.\r\nKnowing this, I'm making the test explicitly catch 128/256.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-06-02T06:42:51.305+0000","updated":"2010-06-02T06:42:51.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12874459","id":"12874459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"body":"By the way, the RIR increment looks unintentional to me. It might be a bug; I can't see a reason why it gets incremented for CASS-777 when SSTableReader went to RIReader.\r\nIf this is the case, then the +1 can be reverted and the test can go back to catching 64/128.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhermes","name":"jhermes","emailAddress":"hermes at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jon Hermes","active":true},"created":"2010-06-02T06:53:27.851+0000","updated":"2010-06-02T06:53:27.851+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465392/comment/12875436","id":"12875436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed the original version for trunk, and removed the extra +1 from estimatedKeys.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-06-04T02:38:45.656+0000","updated":"2010-06-04T02:38:45.656+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1129/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g367:"}}