{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12375677","self":"https://issues.apache.org/jira/rest/api/latest/issue/12375677","key":"SOLR-331","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312235","id":"12312235","description":"","name":"1.2","archived":false,"released":true,"releaseDate":"2007-06-06"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2007-08-09 17:34:15.803","customfield_12312323":null,"customfield_12310420":"7261","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_91626454_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-08-10T15:58:32.454+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-331/watchers","watchCount":2,"isWatching":false},"created":"2007-08-09T14:31:26.973+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312235","id":"12312235","description":"","name":"1.2","archived":false,"released":true,"releaseDate":"2007-06-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:41:09.207+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310674","id":"12310674","name":"search","description":"Query the search collection"}],"timeoriginalestimate":null,"description":"When searching index using highlighting and synonyms we get the following exception:\n\njava.lang.StringIndexOutOfBoundsException: String index out of range: 42\n\tat java.lang.String.substring(String.java:1935)\n\tat org.apache.lucene.search.highlight.Highlighter.getBestTextFragments(Highlighter.java:271)\n\tat org.apache.solr.util.HighlightingUtils.doHighlighting(HighlightingUtils.java:266)\n\tat org.apache.solr.request.StandardRequestHandler.handleRequest(StandardRequestHandler.java:164)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:595)\n\tat org.apache.solr.servlet.SolrServlet.doGet(SolrServlet.java:92)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:697)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:810)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:252)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\n\tat org.jboss.web.tomcat.filters.ReplyHeaderFilter.doFilter(ReplyHeaderFilter.java:96)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:202)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:173)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:213)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:178)\n\tat org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:175)\n\tat org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:74)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:126)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:105)\n\tat org.jboss.web.tomcat.tc5.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:156)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:107)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:148)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:869)\n\tat org.apache.coyote.http11.Http11BaseProtocol$Http11ConnectionHandler.processConnection(Http11BaseProtocol.java:664)\n\tat org.apache.tomcat.util.net.PoolTcpEndpoint.processSocket(PoolTcpEndpoint.java:527)\n\tat org.apache.tomcat.util.net.MasterSlaveWorkerThread.run(MasterSlaveWorkerThread.java:112)\n\tat java.lang.Thread.run(Thread.java:619)\n\nthe problem is reproduceable and permanent with the attached files to this issue. Just use SOLR internal \n\"Make a Query[Full Interface]\" Admin Interface option and search for:\nStatement: adhs\nEnable Highlighting: X\nFields to Highlight: content\n\ne.g.\nhttp://127.0.0.1:8080/solr/select?indent=on&version=2.2&q=adhs&start=0&rows=10&fl=*%2Cscore&qt=standard&wt=standard&explainOther=&hl=on&hl.fl=content\n\nThank you in advance!\n\nOliver","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"20853","summary":"StringIndexOutOfBoundsException when using synonyms and highlighting","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliverkuhn","name":"oliverkuhn","emailAddress":"oliver dot kuhn at onvista-group dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Kuhn","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliverkuhn","name":"oliverkuhn","emailAddress":"oliver dot kuhn at onvista-group dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Kuhn","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"JBOSS  4.0.5.GA\nSOLR 1.2 binary release","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12375677/comment/12518724","id":"12518724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliverkuhn","name":"oliverkuhn","emailAddress":"oliver dot kuhn at onvista-group dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Kuhn","active":true},"body":"to create index with our data we used: \r\n\r\ncurl http://127.0.0.1:8080/solr/update --data-binary @adhs_small.xml -H \"Content-type:text/xml; charset=utf-8\"\r\ncurl http://127.0.0.1:8080/solr/update --data-binary \"<commit />\"\r\n\r\nadhs_small.xml contains our content.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliverkuhn","name":"oliverkuhn","emailAddress":"oliver dot kuhn at onvista-group dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Kuhn","active":true},"created":"2007-08-09T14:34:43.685+0000","updated":"2007-08-09T14:34:43.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12375677/comment/12518769","id":"12518769","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Thanks for the very clear report.\r\nIt looks like WordDelimiterFilter is messing up the offsets.\r\n\r\nhttp://localhost:8983/solr/admin/analysis.jsp?nt=name&name=content&highlight=on&val=&qverbose=on&qval=dummy+dummy+dummy+ADHS+dummy\r\n\r\nAs a side note, you probably don't want to be expanding the same synonym list at both index and query time.  And expanding multi-word synonyms (of differing numbers of tokens) at query time doesn't really work... see the wiki for details on that.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-08-09T17:34:15.803+0000","updated":"2007-08-09T17:34:15.803+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12375677/comment/12518782","id":"12518782","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"OK, the issue is the offsets for subwords.  For example, WordDelimiterFilter is looking at\r\nAufmerksamkeits-Defizite, and it doesn't know that it's not part of the original text, so when it creates the sub-token\r\nAufmerksamkeits, it sets the offsets to match the length of \"Aufmerksamkeits\" (which is bigger than the original).\r\n\r\nSome ideas to fix:\r\n- Make sure that generated offsets never exceed original offsets (this we should always do).  That will eliminate the exception, but generate highlighting mismatches in some cases.\r\n- try to recognize non-original tokens like synonyms\r\n  1) by token type???  but not everyone uses that\r\n  2) by seeing that the offsets don't match the token... stemming would cause this, but stemming should always be after WordDelimiterFilter.  Anything else that would cause \"length != end-start\"?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-08-09T17:55:01.312+0000","updated":"2007-08-09T17:55:01.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12375677/comment/12518890","id":"12518890","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"This patch seems to work fine (not adjusting offsets if they don't match the original token length)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-08-10T02:11:36.526+0000","updated":"2007-08-10T02:11:36.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12375677/comment/12519053","id":"12519053","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-08-10T15:58:32.443+0000","updated":"2007-08-10T15:58:32.443+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12375677/comment/12519055","id":"12519055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliverkuhn","name":"oliverkuhn","emailAddress":"oliver dot kuhn at onvista-group dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Kuhn","active":true},"body":"Hi Yonik, thanks for the quick answer.. we will try this patch in the near future!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oliverkuhn","name":"oliverkuhn","emailAddress":"oliver dot kuhn at onvista-group dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Oliver Kuhn","active":true},"created":"2007-08-10T16:26:38.003+0000","updated":"2007-08-10T16:26:38.003+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-331/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03xgf:"}}