{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12625898","self":"https://issues.apache.org/jira/rest/api/latest/issue/12625898","key":"ARIES-996","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312323":null,"customfield_12310420":"302479","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_329392070_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-01-07T15:07:00.986+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-996/watchers","watchCount":1,"isWatching":false},"created":"2013-01-03T19:37:08.956+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwross%40us.ibm.com","name":"jwross@us.ibm.com","emailAddress":"jwross at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Ross","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-01-07T15:07:01.020+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313176","id":"12313176","name":"JPA","description":"RFC 143 JPA Integration"}],"timeoriginalestimate":null,"description":"The org.apache.aries.jpa.container.context.impl.GlobalPersistenceManager class creates and manages multiple PersistenceContextManagers across multiple nested frameworks. More generally, \"multiple nested frameworks\" can be replaced with the term \"isolation units\". There is one PersistenceContextManager per isolation unit. Currently, the class uses a system bundle as the map key, which is fine for \"multiple nested frameworks\" since each nested framework contains its own system bundle along with a composite bundle. At least two problems arise when used with Subsystems, however, because there are isolation units (i.e. subsystems) existing within a single framework. \r\n\r\nThe first problem is that the system bundle might be hidden from the client bundle by find hooks. This results in an NPE on line 104 of GlobalPersistenceManager.registerContext.\r\n\r\nThe second problem is that even if the first is gotten around by getting the system bundle by location instead of by ID, duplicate transaction exceptions occur since there is only one system bundle.\r\n\r\nOne solution would be to use a bundle tracker that tracks subsystem region context bundles. This is easily done since all region context bundles have the same symbolic name prefix per the spec. GlobalPersistenceManager.registerContext would first iterate over any tracked region context bundles. If a region context bundle is visible to the client bundle, then the bundle context of the region context bundle is used. If there are no region context bundles, or none are visible to the client bundle, then the system bundle context is used as before.\r\n\r\nA more general issue not addressed by this bug is how JPA should function within a framework isolated by any generic mechanism using hooks. It's not clear how the bundle context to use would be identified.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"249526","summary":"JPA does not work for bundles that are constituents of subsystems.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwross%40us.ibm.com","name":"jwross@us.ibm.com","emailAddress":"jwross at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Ross","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwross%40us.ibm.com","name":"jwross@us.ibm.com","emailAddress":"jwross at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Ross","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":2,"total":2,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12625898/comment/13544259","id":"13544259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwross%40us.ibm.com","name":"jwross@us.ibm.com","emailAddress":"jwross at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Ross","active":true},"body":"Proposed Patch\r\n\r\nA bundle tracker was added to track the region context bundles of subsystems. When a context is registered, these bundles are\r\nexamined to see if one is visible to the client bundle. If so, that region context bundle is used to establish the relationship\r\nwith a persistence context manager. If no subsystem region context bundles are present, the behavior is the same as before.\r\nComposite bundle frameworks are still supported as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwross%40us.ibm.com","name":"jwross@us.ibm.com","emailAddress":"jwross at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Ross","active":true},"created":"2013-01-04T21:12:29.585+0000","updated":"2013-01-04T21:12:29.585+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12625898/comment/13545945","id":"13545945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwross%40us.ibm.com","name":"jwross@us.ibm.com","emailAddress":"jwross at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Ross","active":true},"body":"Fixed in http://svn.apache.org/viewvc?view=revision&revision=1429829.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jwross%40us.ibm.com","name":"jwross@us.ibm.com","emailAddress":"jwross at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Ross","active":true},"created":"2013-01-07T15:07:01.012+0000","updated":"2013-01-07T15:07:01.012+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-996/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i173g7:"}}