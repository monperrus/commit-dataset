{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12685304","self":"https://issues.apache.org/jira/rest/api/latest/issue/12685304","key":"LUCENE-5372","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325572","id":"12325572","description":"Major release after 4.6","name":"4.7","archived":false,"released":true,"releaseDate":"2014-02-26"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321663","id":"12321663","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-12-18 06:51:54.477","customfield_12312323":null,"customfield_12310420":"364381","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1626673644_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-01-05T23:15:12.013+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-5372/watchers","watchCount":5,"isWatching":false},"created":"2013-12-18T03:23:58.409+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-03-16T13:02:11.877+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310232","id":"12310232","name":"core/index","description":"issues with indexing code"}],"timeoriginalestimate":null,"description":"This is pretty minor, but I found a few issues with the toString implementations while looking through the facet data structures.\r\n\r\nThe most egregious is the use of string concatenation in the IntArray class. I have fixed that using StringBuilders. I also noticed that other classes were using StringBuffer instead of StringBuilder. According to the javadoc,\r\n\r\n\"This class is designed for use as a drop-in replacement for StringBuffer in places where the string buffer was being used by a single thread (as is generally the case). Where possible, it is recommended that this class be used in preference to StringBuffer as it will be faster under most implementations.\"","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10120","value":"Patch Available","id":"10120"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"364681","summary":"Replace StringBuffer with StringBuilder where possible, add to forbidden-apis","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":20,"total":20,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13851323","id":"13851323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"body":"I was using git-svn, but I believe the patch should still apply with patch -p1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"created":"2013-12-18T03:43:02.058+0000","updated":"2013-12-18T03:43:02.058+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13851447","id":"13851447","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Looks good to me and I think it's applicable to 4.x and 5.x (StringBuilder requires Java >= 1.5 but both of these branches do, right)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-12-18T06:51:54.477+0000","updated":"2013-12-18T06:51:54.477+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13851794","id":"13851794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"Yes, 4x=6, 5x=7","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-12-18T14:56:32.406+0000","updated":"2013-12-18T14:56:32.406+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852199","id":"13852199","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"body":"I can also optimize memory usage by precalculating the maximum size in advance for the StringBuilder for each collection. May be overkill - what are your thoughts? I am new here.\r\n\r\nhttp://wiki.apache.org/lucene-java/HowToContribute implies I should wait for the patch to be pulled in by a lucene dev. Is this a correct interpretation?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"created":"2013-12-18T21:54:21.731+0000","updated":"2013-12-18T21:54:21.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852214","id":"13852214","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"No need to be paranoid about performance here, Josh. The patch is fine, I'll apply it, although tomorrow because it's gotten really late over here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-12-18T22:02:14.614+0000","updated":"2013-12-18T22:02:14.614+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852216","id":"13852216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Hi Joshua, thank you for the patch here, but we are in the process of simplifying the facet APIs (on this branch: https://svn.apache.org/repos/asf/lucene/dev/branches/lucene5339 ), and I believe most (all?) of the affected code here has been removed.  So I would hold off for now, or maybe check out the branch and see if any of these O(N^2) problems still remain.\r\n\r\nThanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-12-18T22:04:17.276+0000","updated":"2013-12-18T22:04:17.276+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852707","id":"13852707","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Do you want me to hold it, Mike? Josh -- perhaps you could rebase your patch against the branch Mike pointed to (if there's anything left)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-12-19T07:48:41.844+0000","updated":"2013-12-19T07:48:41.844+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852717","id":"13852717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Oh oh, we should put StringBuffer on the forbidden-apis list. It is one entry in our base.txt signatures file (please don't add a new one).\r\n\r\nWe replaced all StringBuffers already earlier when we moved to Lucene 3.0 (which is the first one for Java 5), so we can disallow StringBuffer everywhere!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-19T08:08:21.026+0000","updated":"2013-12-19T08:08:21.026+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852723","id":"13852723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"This already fails in lucene-core's test! So we should replace them everywhere (although tests is not an issue).\r\n\r\n{noformat}\r\nant check-forbidden-apis\r\n\r\n[...]\r\n\r\n-check-forbidden-base:\r\n[forbidden-apis] Reading bundled API signatures: jdk-unsafe-1.7\r\n[forbidden-apis] Reading bundled API signatures: jdk-deprecated-1.7\r\n[forbidden-apis] Reading API signatures: C:\\Users\\Uwe Schindler\\Projects\\lucene\\trunk-lusolr3\\lucene\\tools\\forbiddenApis\\base.txt\r\n[forbidden-apis] Loading classes to check...\r\n[forbidden-apis] Scanning for API signatures and dependencies...\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.TestSearchForDuplicates (TestSearchForDuplicates.java:56)\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.TestSearchForDuplicates (TestSearchForDuplicates.java:64)\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.analysis.tokenattributes.CharTermAttributeImpl (CharTermAttributeImpl.java:148)\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.TestSearch (TestSearch.java:95)\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.TestSearch (TestSearch.java:103)\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.index.TestDoc (TestDoc.java:152)\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.index.TestDoc (TestDoc.java:193)\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.analysis.tokenattributes.TestCharTermAttributeImpl (TestCharTermAttributeImpl.java:179)\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.analysis.tokenattributes.TestCharTermAttributeImpl (TestCharTermAttributeImpl.java:216)\r\n[forbidden-apis] Scanned 2369 (and 462 related) class file(s) for forbidden API invocations (in 1.19s), 9 error(s).\r\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-19T08:11:58.368+0000","updated":"2013-12-19T08:13:22.912+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852727","id":"13852727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"his one is wanted, but mostly obsolete - maybe put on exclusion list:\r\n\r\n{noformat}\r\n[forbidden-apis] Forbidden class/interface use: java.lang.StringBuffer [Use StringBuilder instead, which has no synchronization]\r\n[forbidden-apis]   in org.apache.lucene.analysis.tokenattributes.CharTermAttributeImpl (CharTermAttributeImpl.java:148)\r\n{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-19T08:18:59.375+0000","updated":"2013-12-19T08:18:59.375+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852728","id":"13852728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Should we put the remaining StringBuffers on a separate issue or fix it here?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-12-19T08:19:38.972+0000","updated":"2013-12-19T08:19:38.972+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852732","id":"13852732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"I think we can fix it here since Josh brought that up.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-12-19T08:28:43.420+0000","updated":"2013-12-19T08:28:43.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13852836","id":"13852836","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"bq. Do you want me to hold it, Mike?\r\n\r\nYes, please!\r\n\r\n+1 to fix StringBuffers here!  Thanks, Joshua.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-12-19T12:00:32.146+0000","updated":"2013-12-19T12:00:32.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13853260","id":"13853260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"body":"I'll make the StringBuffer -> StringBuilder fix on trunk the branch mentioned by Mike and attach new patches for each. Expect the patch this evening or tomorrow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"created":"2013-12-19T20:27:11.622+0000","updated":"2013-12-19T20:27:11.622+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13856085","id":"13856085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"body":"Uploaded versions of the patch for both trunk and lucene5339 branches for replacing StringBuffer -> StringBuilder. Due to API constraints it is not possible to do so in all cases.\r\n\r\nMike was also correct. Code related to the specific O(n^2) issue this JIRA was started for no longer exists on lucene5339.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jhartman","name":"jhartman","emailAddress":"AtomicForce at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joshua Hartman","active":true},"created":"2013-12-24T02:18:38.925+0000","updated":"2013-12-24T02:18:38.925+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13857098","id":"13857098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"I wanted to apply these patches but then looked deeper and it seems we can't just apply them without some consideration. For example, while reviewing, I noticed things such as this one:\r\n{code}\r\n- * All use of StringBuffers has been refactored to StringBuilder for speed.\r\n+ * All use of StringBuilders has been refactored to StringBuilder for speed.\r\n{code}\r\nwhich seem to be an auto-replacement artifact. While this is a no-problem, this may be:\r\n{code}\r\n+++ b/lucene/core/src/java/org/apache/lucene/analysis/tokenattributes/CharTermAttributeImpl.java\r\n@@ -144,8 +144,8 @@ public class CharTermAttributeImpl extends AttributeImpl implements CharTermAttr\r\n       } else if (csq instanceof CharBuffer && ((CharBuffer) csq).hasArray()) {\r\n         final CharBuffer cb = (CharBuffer) csq;\r\n         System.arraycopy(cb.array(), cb.arrayOffset() + cb.position() + start, termBuffer, termLength, len);\r\n-      } else if (csq instanceof StringBuffer) {\r\n-        ((StringBuffer) csq).getChars(start, end, termBuffer, termLength);\r\n+      } else if (csq instanceof StringBuilder) {\r\n+        ((StringBuilder) csq).getChars(start, end, termBuffer, termLength);\r\n{code}\r\nbut CharTermAttributeImpl  already has an if clause for StringBuilder, the full code is:\r\n{code}\r\n      if (csq instanceof String) {\r\n        ((String) csq).getChars(start, end, termBuffer, termLength);\r\n      } else if (csq instanceof StringBuilder) {\r\n        ((StringBuilder) csq).getChars(start, end, termBuffer, termLength);\r\n      } else if (csq instanceof CharTermAttribute) {\r\n        System.arraycopy(((CharTermAttribute) csq).buffer(), start, termBuffer, termLength, len);\r\n      } else if (csq instanceof CharBuffer && ((CharBuffer) csq).hasArray()) {\r\n        final CharBuffer cb = (CharBuffer) csq;\r\n        System.arraycopy(cb.array(), cb.arrayOffset() + cb.position() + start, termBuffer, termLength, len);\r\n      } else if (csq instanceof StringBuffer) {\r\n        ((StringBuffer) csq).getChars(start, end, termBuffer, termLength);\r\n      } else {\r\n        while (start < end)\r\n          termBuffer[termLength++] = csq.charAt(start++);\r\n        // no fall-through here, as termLength is updated!\r\n        return this;\r\n      }\r\n{code}\r\nI would actually leave it for Uwe to modify the api checker rules and then hand-pick offenders. Your contribution won't be lost, Joshua, it'll just go in via another route (not a direct patch, rather a good suggestion :).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-12-26T21:42:22.717+0000","updated":"2013-12-26T21:42:22.717+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13862678","id":"13862678","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Here is a new patch that was created from scratch by using Eclipse search for java.lang.StringBuffer:\r\n- The queryparser problems are autogen'ed code. I modified the build.xml to do a replacement in ParseException.java and TokenMgrError.java (queryparser module and solr-core)\r\n- Some tests called StringWriter.getBuffer().toString() - this was only detected by forbidden-apis\r\n- Some code parts using regex.Matcher have to use StringBuilder, because Matcher internally also uses this, so appendReplacement() and appendTail() have to stay\r\n- I removed some useless methods in Solr's commons-csv fork. I hope we can remove that soon!\r\n- In some tests, Solr used StringBuffer, but synchronization seems to be needed, I left untouched.\r\n\r\nBecause we *have to use StringBuffer* quite often, I did not add it to forbidden apis, because the exclusions would prevent other forbidden stuff in the excluded files to be detected.\r\n\r\nI will commit this later and close this issue. Since the facet APIs were cleaned up, the original issue in IntArray disappeared, right? (the class is no longer there).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2014-01-05T22:50:50.762+0000","updated":"2014-01-05T22:52:50.458+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13862684","id":"13862684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1555645 from [~thetaphi] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1555645 ]\r\n\r\nLUCENE-5372: Replace StringBuffer by StringBuilder, where possible","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-01-05T23:04:53.324+0000","updated":"2014-01-05T23:04:53.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13862685","id":"13862685","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1555646 from [~thetaphi] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1555646 ]\r\n\r\nMerged revision(s) 1555645 from lucene/dev/trunk:\r\nLUCENE-5372: Replace StringBuffer by StringBuilder, where possible","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-01-05T23:11:40.299+0000","updated":"2014-01-05T23:11:40.299+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12685304/comment/13862686","id":"13862686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Thanks Joshua!\r\n\r\nIf somebody has an idea how to add StringBuffer to forbidden without excluding tons of files, reopen.\r\n\r\n\r\nOne idea for forbidden-apis would be: Add some new \"@IgnoreForbidden\" annotation (class file, not runtime visible), which makes the forbidden-api checker ignore methods or classes with that ann. This would allow to ignore only very specific code parts! Backside: You need a JAR file while compiling with the annotation...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2014-01-05T23:15:12.046+0000","updated":"2014-01-05T23:15:12.046+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-5372/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qt2f:"}}