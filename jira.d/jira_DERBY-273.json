{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"32498","self":"https://issues.apache.org/jira/rest/api/latest/issue/32498","key":"DERBY-273","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-05-23 05:58:54.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21870","customfield_12310222":"1_*:*_1_*:*_24511552000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_2_*:*_56745027261_*|*_4_*:*_1_*:*_399312000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-02-25T16:14:49.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-273/watchers","watchCount":0,"isWatching":false},"created":"2005-05-12T06:53:08.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12311625","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12311625","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12327439","key":"DERBY-803","self":"https://issues.apache.org/jira/rest/api/2/issue/12327439","fields":{"summary":"derbynet/DerbyNetAutoStart.java test fails intermittently with org.apache.derby.iapi.services.context.ShutdownException","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12310380","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12310380","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"outwardIssue":{"id":"12312741","key":"DERBY-478","self":"https://issues.apache.org/jira/rest/api/2/issue/12312741","fields":{"summary":"Function to force closing connection (and session)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12310587","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12310587","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"outwardIssue":{"id":"12313454","key":"DERBY-511","self":"https://issues.apache.org/jira/rest/api/2/issue/12313454","fields":{"summary":"Test of shutting down database when active connections alive.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-02T02:28:57.660+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"}],"timeoriginalestimate":null,"description":"The test fails in the derbyall/derbynetclientmats/derbynetmats suite stack with the following diff:\n*** Start: dataSourcePermissions_net jdk1.4.2 DerbyNetClient derbynetmats:derbynetmats 2005-05-11 04:24:11 ***\n17a18,19\n> org.apache.derby.iapi.services.context.ShutdownException: \n> agentThread[DRDAConnThread_2,5,derby.daemons]\nTest Failed.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38992","summary":"The derbynet/dataSourcePermissions_net.java test fails intermittently","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jackklebanoff","name":"jackklebanoff","emailAddress":"klebanoff-derby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jack Klebanoff","active":true},"subtasks":[{"id":"12311736","key":"DERBY-397","self":"https://issues.apache.org/jira/rest/api/2/issue/12311736","fields":{"summary":"Make it sure for the connection to be closed in drda.Database#close() even if Exception happens in conn.rollback().","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jackklebanoff","name":"jackklebanoff","emailAddress":"klebanoff-derby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jack Klebanoff","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"1.4.2 JVM (both Sun and IBM)\n1.5.0_02  JVM (sun)","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":26,"total":26,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/65999","id":"65999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"When network server closes a session, it tries to perform a rollback on the connection before closing the connection. If it encounters an exception during rollback it treats the exception as an unexpected exception and prints the error to the console. \r\n\r\nHowever, in this case, the database has been intentionally shut down and the error on rollback is expected. Network Server should treat an error on rollback, when closing a session, as an expected exception if the database has been intentionally shut down. \r\n\r\nThe intermittent nature of this diff seems to be related to when the session for the disconnected client that shutdown the database gets cleaned up. \r\n\r\nWhen the test fails, this is the trace in the tmp file: \r\n\r\norg.apache.derby.iapi.services.context.ShutdownException: \r\nat org.apache.derby.iapi.services.context.ContextManager.checkInterrupt(ContextManager.java:374) \r\nat org.apache.derby.iapi.services.context.ContextManager.popContext(ContextManager.java:152) \r\nat org.apache.derby.iapi.services.context.ContextImpl.popMe(ContextImpl.java:80) \r\nat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.resetSavepoints(GenericLanguageConnectionContext.java:1309) \r\nat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.doRollback(GenericLanguageConnectionContext.java:1288) \r\nat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.userRollback(GenericLanguageConnectionContext.java:1199) \r\nat org.apache.derby.impl.jdbc.TransactionResourceImpl.rollback(TransactionResourceImpl.java:244) \r\nagentThread[DRDAConnThread_3,5,derby.daemons] \r\nat org.apache.derby.impl.jdbc.EmbedConnection.rollback(EmbedConnection.java:894) \r\nat org.apache.derby.impl.drda.Database.close(Database.java:352) \r\nat org.apache.derby.impl.drda.Session.close(Session.java:110) \r\nat org.apache.derby.impl.drda.DRDAConnThread.closeSession(DRDAConnThread.java:6803) \r\nat org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:241) \r\nEXPECTED SHUTDOWN DERBY SQL error: SQLCODEWhen network server closes a session, it tries to perform a rollback on the connection before closing the connection. If it encounters an exception during rollback it treats the exception as an unexpected exception and prints the error to the console. \r\n\r\nHowever, in this case, the database has been intentionally shut down and the error on rollback is expected. Network Server should treat an error on rollback, when closing a session, as an expected exception if the database has been intentionally shut down. \r\n\r\nThe intermittent nature of this diff seems to be related to when the session for the disconnected client that shutdown the database gets cleaned up. \r\n\r\nWhen the test fails, this is the trace in the tmp file: \r\n\r\norg.apache.derby.iapi.services.context.ShutdownException: \r\nat org.apache.derby.iapi.services.context.ContextManager.checkInterrupt(ContextManager.java:374) \r\nat org.apache.derby.iapi.services.context.ContextManager.popContext(ContextManager.java:152) \r\nat org.apache.derby.iapi.services.context.ContextImpl.popMe(ContextImpl.java:80) \r\nat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.resetSavepoints(GenericLanguageConnectionContext.java:1309) \r\nat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.doRollback(GenericLanguageConnectionContext.java:1288) \r\nat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.userRollback(GenericLanguageConnectionContext.java:1199) \r\nat org.apache.derby.impl.jdbc.TransactionResourceImpl.rollback(TransactionResourceImpl.java:244) \r\nagentThread[DRDAConnThread_3,5,derby.daemons] \r\nat org.apache.derby.impl.jdbc.EmbedConnection.rollback(EmbedConnection.java:894) \r\nat org.apache.derby.impl.drda.Database.close(Database.java:352) \r\nat org.apache.derby.impl.drda.Session.close(Session.java:110) \r\nat org.apache.derby.impl.drda.DRDAConnThread.closeSession(DRDAConnThread.java:6803) \r\nat org.apache.derby.impl.drda.DRDAConnThread.run(DRDAConnThread.java:241) \r\nEXPECTED SHUTDOWN DERBY SQL error: SQLCODE: -1, SQLSTATE: 08006 ...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-05-23T05:58:54.000+0000","updated":"2005-05-23T05:58:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12312740","id":"12312740","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"I have started to survey ...\r\n\r\n\r\nMy first question was \"What is ShutdownException ?\"\r\n\r\nJavaDoc told \"A ShutdownException is a runtime exception that is used to notify code that the system has/is being shut down. \"\r\nhttp://incubator.apache.org/derby/javadoc/engine/org/apache/derby/iapi/services/context/ShutdownException.html\r\n\r\nGrepping whole code ,I found ShutdownException was thrown only from next two part.\r\n./engine/org/apache/derby/iapi/services/context/ContextManager.java:374:\t\t\tthrow new ShutdownException();\r\n./engine/org/apache/derby/iapi/services/context/ContextService.java:124:\t\t\tthrow new ShutdownException();\r\n\r\nReading each class, I found that these part are executed only when ContextManager or ContextService is in state of shutdown or  stopped.\r\n\r\nThese codes completely match explanation in JavaDoc.\r\nEach object is in state of shutdown , and ShutdownException happens.\r\n\r\n\r\nThen, next question arise.\r\nWhy there happens situation of  system has/is being shut down during running in  DRDAConnThread as reported ?\r\n\r\nI think reading dataSourcePermissions_net will give me answer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-06-06T20:32:18.000+0000","updated":"2005-06-06T20:32:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12312889","id":"12312889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"I have read the dataSourcePermissions_net.\r\n\r\ndataSourcePermissions_net  executes network version of test executed in dataSourcePermissions.\r\nContent of tests was implemented in dataSourcePermissions.runTest().\r\n\r\nIn the test, \r\nthere exist  parts where it is repeated , to create connection to database named wombat and to shut down database via the connection.\r\n\r\nReported exception seems to happen in this repeating part.\r\n...see http://issues.apache.org/jira/secure/attachment/20380/derbyall_diff.txt also.\r\n\r\nI suspect there exists remaining previous thread concerning with that database , when shutting down the database... \r\nThen ShutdownException is thrown from previous working thread , I wonder.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-06-07T23:33:02.000+0000","updated":"2005-06-07T23:33:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12313153","id":"12313153","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"In my previous comment, I wrote as next.\r\n\r\n>In the test, \r\n>there exist parts where it is repeated , to create connection to database named wombat and to shut down database via the connection.\r\n\r\nThis is incorrect.\r\nDatabase was shutdown via \"another\" connection using \"jdbc:derby:;shutdown=true\", \r\nthough there exists another connections .\r\n\r\nWell ...\r\nNow I think ShutdownException thrown by rollback process should be treated as Exception.\r\nUser should not shutdown Database if there remain connections ....\r\nThen, Exception in test result itself was truly Exception. \r\n\r\nAnd futhermore, connection should be surely closed , \r\nthough Database was earlier closed and Exception happens in rollback ....\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-06-09T20:31:46.000+0000","updated":"2005-06-09T20:31:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12313361","id":"12313361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"I read code org.apache.derby.impl.drda.Database#close();\r\nhttp://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/Database.java\r\n\r\nDocumentation comment for this method said \r\n\"Close the connection and clean up the statement table.\".\r\n\r\nReading the code , I found there are next processing\r\n\r\n1:if stmtTable exists, call every DRDAStatement.close() in stmtTable.\r\n2:if conn exists\r\n\t2-1:call conn.rollback() \r\n\t2-2:call conn.close().\r\n\r\nIf exception happens in conn.rollback() of 2-1 ,\r\nconn.close() of 2-2 would be not called as Kathey suggested in previous mail.\r\nhttp://mail-archives.apache.org/mod_mbox/db-derby-dev/200506.mbox/%3c42A65E51.6010800@sbcglobal.net%3e\r\n\r\n\r\nI think conn.close() should be called in finally clause in this method.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-06-11T15:54:25.000+0000","updated":"2005-06-11T15:54:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12313385","id":"12313385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"Consequently, there exists two matter to do.\r\n\r\nmodify-1: \r\nModify scenario of dataSourcePermissions not to shutdown when connection exists.\r\nThis will supress errors in test.\r\n\r\nmodify-2: \r\nModify how conn.rollback() is called in org.apache.derby.impl.drda.Database#close() ,\r\nand make it sure for connection to be closed in exceptional state.\r\n\r\nNow problem exits in modify-2.\r\nHow can this to be tested ?\r\nThe modify-2 can be confirmed under exceptional state that happens indeterministically ...\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-06-12T19:32:05.000+0000","updated":"2005-06-12T19:32:05.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12313462","id":"12313462","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"Regarding modify-1, there was a wrong guess in my previous thought.\r\n\r\nI thought database was shutdown before closing connection , then connection remains in the dataSourcePermissions test.\r\nHowever, I found connection was closed before shutting down database in the test.\r\n\r\n\r\nTo know why connection remains, \r\nI read the code around DRDAConnThread.\r\nhttp://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DRDAConnThread.java\r\n\r\nIn last part of DRDAConnThread#run() ,\r\nI found  closing connection at server was caused by DRDAProtocolException that stands for disconnection.\r\n\r\nThis exeption was caused in DDMReader and DDMWriter , calling DRDAConnThread#markCommunicationsFailure when catching IOException.\r\nhttp://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DDMReader.java\r\nhttp://svn.apache.org/repos/asf/incubator/derby/code/trunk/java/drda/org/apache/derby/impl/drda/DDMWriter.java\r\n\r\n\r\nI guess client close the connection one-sidely and \r\nDRDAProtocolException representing disconnection happens in server , \r\nand rollback and close connection at server follows .\r\n\r\nBecause client is one-side player , client doesn't know wheter server finished work of closing connection .\r\n\r\n\r\nThen ... how to ensure finishing closing connection before shutting down database ...? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-06-13T22:21:48.000+0000","updated":"2005-06-13T22:21:48.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12313468","id":"12313468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I have two ideas, neither of which seem ideal but maybe they will give you a better idea.\r\n\r\n1) If the exception is intermittent but not harmful you could specify an alternate consoleWriter when you call NetworkServerControl.start().  This way the exception does not print to System.out.  \r\nThis would mean that dataSourcePermissions_net.java would suffer the same deficiencey as the other tests, that the console is not monitored properly by the test.\r\n\r\n\r\n2) The NetworkServerControl method getRuntimeInfo will show the connection info from the server's perspective.  You could alternately sleep for a few seconds and call this method to see the connections from the server perspective.  The output is a string that would need to be parsed. It has output that looks like:\r\n# Connection Threads : 2\r\n# Active Sessions : 2\r\n# Waiting  Sessions : 0\r\n\r\nAnd always includes one session for the runtimeinfo request.\r\n\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-06-13T22:47:47.000+0000","updated":"2005-06-13T22:47:47.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12313814","id":"12313814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"The alternate plans ....\r\n\r\nalternate-plan-1:\r\nNot to output message of exception to STDOUT\r\n\r\nalternate-plan-2:\r\nIn the test program , wait to session closed seeing return value of \r\nNetworkServerControl#getRuntimeInfo\r\n\r\nalternate-plan-3:\r\nModify shutdown process to wait session closed. \r\n\r\n\r\nI think \r\n\r\nalternate-plan-1 have problem that\r\nthe message of exception should be shown to the user.\r\n\r\nalternate-plan-3 have problem that \r\nIf it was failed to close session, shutdown will fail.\r\n\r\n\r\nI think direction of alternation-2 would be best.\r\nI will survey one more how to detect all session was closed.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-06-16T19:43:17.000+0000","updated":"2005-06-16T19:43:17.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12314045","id":"12314045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"To accomplish plan-2,\r\ncount of session need to be polled to know wheter all session was closed ...\r\n\r\nThere are next two option.\r\n\r\noption1:\r\nAdding NetworkServerControl#getCountOfSession() method , which retrieve count of sessions from NetworkServerControl.\r\n\r\noption2:\r\nUsing getRuntimeInfo() method and parse result of it.\r\n\r\nIn a glance , option1 seems to be straight answer.\r\nHowever , NetworkServerControl#getCountOfSession() have wrong impact to make confusion in future.\r\nBecause count of session would be vary after the value is retrieved , accessd by other threads.\r\n\r\nI think count of session is very private information in NetworkServerControl , \r\nand should not be retrieved directly from NetworkServerControl.\r\n\r\n\r\nI think it is moderate to take option2 ,\r\nregarding user checking state of connection seeing getRuntimeInfo ...\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-06-20T21:44:18.000+0000","updated":"2005-06-20T21:44:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12316930","id":"12316930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"Summary of what I knew in this issue ever ...\r\n\r\nThe phenomena found in this issue happens when closing connection falls on shutting down database. \r\nTo make the phenomena not happen , it is needed to ensure closure of connection before shutting down database. \r\nHowever, it is impossible to close  connection in ConnectionPool only using jdbc interface.\r\n\r\nThen, I think connection managment mechanism outside jdbc is needed to solve this issue ....\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-07-28T01:09:18.000+0000","updated":"2005-07-28T01:09:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12317096","id":"12317096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"DERBY-273 is one of cases , of which it is needed to ensure to close Connection.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-07-29T00:13:39.000+0000","updated":"2005-07-29T00:13:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12317911","id":"12317911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I have not been able to follow this thread closely, but I don't think I understand how Connection Pooling relates to this problem.   Can you post a bit of java code or a standalone java program that demonstrates the issue?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-08-07T22:54:27.000+0000","updated":"2005-08-07T22:54:27.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12320335","id":"12320335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"To ignore errors in DERBY-273, test in DERBY-511 is to be added.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2005-08-28T14:50:11.000+0000","updated":"2005-08-28T14:50:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12362240","id":"12362240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"In this test an intentional shutdown causes the close of the connection by network server to encounter an error that prints to the console.  It appears it may be  the same issue as  DERBY-273.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-01-10T04:24:22.000+0000","updated":"2006-01-10T04:24:22.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12364835","id":"12364835","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"It seems this issue is on the high side of \"intermittent\"  I saw it fail twice last night, 1/31 - build 373975\r\nEnvironment:\r\nGenerating report for RunSuite derbyall  null null null true \r\n------------------ Java Information ------------------\r\nJava Version:    1.5.0_02\r\nJava Vendor:     Sun Microsystems Inc.\r\nJava home:       d:\\dev\\src\\jdk15\\jre\r\nJava classpath:  d:/dev/src/classes/derby.jar;d:/dev/src/classes/derbyLocale_zh_TW.jar;d:/dev/src/classes/derbyLocale_zh_CN.jar;d:/dev/src/classes/derbyLocale_pt_BR.jar;d:/dev/src/classes/derbyLocale_ko_KR.jar;d:/dev/src/classes/derbyLocale_ja_JP.jar;d:/dev/src/classes/derbyLocale_it.jar;d:/dev/src/classes/derbyLocale_fr.jar;d:/dev/src/classes/derbyLocale_es.jar;d:/dev/src/classes/derbyLocale_de_DE.jar;d:/dev/src/classes/derbytools.jar;d:/dev/src/classes/derbynet.jar;d:/dev/src/classes/derbyclient.jar;;d:/dev/src/classes/derbyTesting.jar;d:/dev/src/classes/maps.jar;d:/dev/src/classes/functionTests.jar;d:/dev/src/tools/java/junit.jar;d:/dev/src/tools/java/jndi/fscontext.jar;d:/dev/src/tools/java/RmiJdbc.jar;d:/dev/src/drda/jcc/2.4/db2jcc.jar;d:/dev/src/drda/jcc/2.4/db2jcc_license_c.jar\r\nOS name:         Windows 2000\r\nOS architecture: x86\r\nOS version:      5.0\r\nJava user name:  cloudtst\r\nJava user home:  C:\\Documents and Settings\\cloudtst\r\nJava user dir:   D:\\dev\\src\\JarResults.2006-01-31\\jdk15_derbyall\r\njava.specification.name: Java Platform API Specification\r\njava.specification.version: 1.5\r\n--------- Derby Information --------\r\nJRE - JDBC: J2SE 5.0 - JDBC 3.0\r\n[D:\\dev\\src\\classes\\derby.jar] 10.2.0.0 alpha - (373975)\r\n[D:\\dev\\src\\classes\\derbytools.jar] 10.2.0.0 alpha - (373975)\r\n[D:\\dev\\src\\classes\\derbynet.jar] 10.2.0.0 alpha - (373975)\r\n[D:\\dev\\src\\classes\\derbyclient.jar] 10.2.0.0 alpha - (373975)\r\n[D:\\dev\\src\\drda\\jcc\\2.4\\db2jcc.jar] 2.4 - (17)\r\n[D:\\dev\\src\\drda\\jcc\\2.4\\db2jcc_license_c.jar] 2.4 - (17)\r\n------------------------------------------------------\r\ndiff: \r\n********* Diff file derbyall/derbynetclientmats/DerbyNetClient/derbynetmats/derbynetmats/dataSourcePermissions_net.diff\r\n*** Start: dataSourcePermissions_net jdk1.5.0_02 DerbyNetClient derbynetmats:derbynetmats 2006-02-01 01:44:45 ***\r\n21a22,23\r\n> org.apache.derby.iapi.services.context.ShutdownException: \r\n> agentThread[DRDAConnThread_4,5,derby.daemons]\r\nTest Failed.\r\n*** End:   dataSourcePermissions_net jdk1.5.0_02 DerbyNetClient derbynetmats:derbynetmats 2006-02-01 01:45:28 ***\r\n********* Diff file derbyall/derbynetclientmats/DerbyNetClient/derbynetmats/jdbc20/batchUpdate.diff\r\n\r\n\r\nSecond failure:\r\nevironment:\r\nGenerating report for RunSuite derbynetmats  null null DerbyNet true \r\n------------------ Java Information ------------------\r\nJava Version:    1.5.0_02\r\nJava Vendor:     Sun Microsystems Inc.\r\nJava home:       d:\\dev\\src\\jdk15\\jre\r\nJava classpath:  d:/dev/src/classes/derby.jar;d:/dev/src/classes/derbytools.jar;d:/dev/src/classes/derbynet.jar;d:/dev/src/classes/derbyclient.jar;d:/dev/src/classes/functionTests.jar;d:/dev/src/classes/derbyTesting.jar;d:/dev/src/tools/java/jndi/fscontext.jar;d:/dev/src/drda/jcc/2.6/db2jcc.jar;d:/dev/src/drda/jcc/2.6/db2jcc_license_c.jar;d:/dev/src/tools/java/junit.jar;d:/dev/src/classes/derbyLocale_zh_TW.jar;d:/dev/src/classes/derbyLocale_zh_CN.jar;d:/dev/src/classes/derbyLocale_pt_BR.jar;d:/dev/src/classes/derbyLocale_ko_KR.jar;d:/dev/src/classes/derbyLocale_ja_JP.jar;d:/dev/src/classes/derbyLocale_it.jar;d:/dev/src/classes/derbyLocale_fr.jar;d:/dev/src/classes/derbyLocale_es.jar;d:/dev/src/classes/derbyLocale_de_DE.jar;\r\nOS name:         Windows 2000\r\nOS architecture: x86\r\nOS version:      5.0\r\nJava user name:  cloudtst\r\nJava user home:  C:\\Documents and Settings\\cloudtst\r\nJava user dir:   D:\\dev\\src\\JarResults.2006-01-31\\jdk15_derbynetmats_jcc_2.6\r\njava.specification.name: Java Platform API Specification\r\njava.specification.version: 1.5\r\n--------- Derby Information --------\r\nJRE - JDBC: J2SE 5.0 - JDBC 3.0\r\n[D:\\dev\\src\\classes\\derby.jar] 10.2.0.0 alpha - (373975)\r\n[D:\\dev\\src\\classes\\derbytools.jar] 10.2.0.0 alpha - (373975)\r\n[D:\\dev\\src\\classes\\derbynet.jar] 10.2.0.0 alpha - (373975)\r\n[D:\\dev\\src\\classes\\derbyclient.jar] 10.2.0.0 alpha - (373975)\r\n[D:\\dev\\src\\drda\\jcc\\2.6\\db2jcc.jar] 2.6 - (90)\r\n[D:\\dev\\src\\drda\\jcc\\2.6\\db2jcc_license_c.jar] 2.6 - (90)\r\n------------------------------------------------------\r\n\r\nDiff:\r\n********* Diff file derbynetmats/DerbyNet/derbynetmats/dataSourcePermissions_net.diff\r\n*** Start: dataSourcePermissions_net jdk1.5.0_02 DerbyNet derbynetmats:derbynetmats 2006-02-01 04:32:29 ***\r\n38a39,40\r\n> org.apache.derby.iapi.services.context.ShutdownException: \r\n> agentThread[DRDAConnThread_6,5,derby.daemons]\r\nTest Failed.\r\n*** End:   dataSourcePermissions_net jdk1.5.0_02 DerbyNet derbynetmats:derbynetmats 2006-02-01 04:33:05 ***\r\n********* Diff file derbynetmats/DerbyNet/derbynetmats/updatableResultSet.diff\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-02-02T03:01:04.000+0000","updated":"2006-02-02T03:01:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12366485","id":"12366485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"Description of patch :\r\n   Alter where derbynet/dataSourcePermissions_net.java print ShutdownException from System.out to shutdown.log.\r\n\r\nTest :\r\n   Execute derbyall and found no error.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2006-02-15T23:20:14.000+0000","updated":"2006-02-15T23:20:14.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12366965","id":"12366965","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"The patch committed.\r\n\r\nSending        java/drda/org/apache/derby/drda/NetworkServerControl.java\r\nSending        java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/dataSourcePermissions_net.java\r\nTransmitting file data ..\r\nCommitted revision 378903.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2006-02-19T23:39:00.000+0000","updated":"2006-02-19T23:39:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12366969","id":"12366969","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I noticed that the patch for this issue added a new method to the public API.\r\n \r\nI think if  the public API is being changed we should \r\n1) Add a  new Jira issue for that so people know what is being added and can comment\r\n2) Understand why  we need a new public method in the API\r\n3) Have javadoc for the api call.\r\n\r\n\r\nI almost missed this all together because it was not mentioned in the patch comments.\r\nI thought it was just a test modification.  When i updated my client I saw NetworkServerControl had changed so took a look.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-02-20T02:23:50.000+0000","updated":"2006-02-20T02:23:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12367020","id":"12367020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"I was not conscious for modification of public API.\r\nI think it is possible to go on alternative way ,which does not need new method.\r\n\r\nI will submit patch again for this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2006-02-20T20:08:03.000+0000","updated":"2006-02-20T20:08:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12367047","id":"12367047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"Writing and testing the new patch, I found manipulating log writer which exists in NetworkServerControlImpl seems to be insufficient...\r\nI could find error was printed to *.out file, though stream for file was passed via constructor.\r\n \r\nNow, I'm trying to utilize System.setOut and System.setErr instead.\r\nThis method seems to work well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2006-02-21T01:22:50.000+0000","updated":"2006-02-21T01:22:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12367048","id":"12367048","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"So are you saying that you start the server with the NetworkServerControl method\r\n\tpublic void start(PrintWriter consoleWriter) throws Exception\r\n\r\nbut messages are still going to System.out and System.err?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-02-21T01:31:31.000+0000","updated":"2006-02-21T01:31:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12367073","id":"12367073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I don't think for this test any of the console output needs to go to System.out.  The test is not for testing the console output.\r\nI think that it would be sufficient just start with an alternate console, e.g. DerbyNet.out and all the console output can go there.  \r\nI don't  understand why we need code to alter destination stream before and after shutting down network server\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-02-21T04:53:05.000+0000","updated":"2006-02-21T04:53:05.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12367337","id":"12367337","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"Description of the patch :\r\n   Alter output before and after shutting down database and \r\n   escape ShutDownException was printed to console.\r\n   This modification was done in derbynet/dataSourcePermissions_net.java and derbynet/testSecMec.java which is subclass of former.\r\n\r\nTest:\r\n   Execute derbynet/dataSourcePermissions_net.java and Shutting down exception was printed to altered log file.\r\n   I did same test on derbynet/testSecMec.java. \r\n   However ShutdownException was not recorded in both of log file and console.\r\n   It seems that problematic ShutdownException was not happen.\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2006-02-22T22:12:55.000+0000","updated":"2006-02-22T22:12:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12367494","id":"12367494","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"body":"Committed DERBY-273_2.patch\r\n\r\nSending        java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/dataSourcePermissions_net.java\r\nSending        java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/testSecMec.java\r\nTransmitting file data ..\r\nCommitted revision 380099.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=naka","name":"naka","emailAddress":"tomonaka at basil dot ocn dot ne dot jp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tomohito Nakayama","active":true},"created":"2006-02-23T20:51:11.000+0000","updated":"2006-02-23T20:51:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/32498/comment/12551272","id":"12551272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"This issue has been resolved for over a year with no further movement. Closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2007-12-13T09:04:39.255+0000","updated":"2007-12-13T09:04:39.255+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-273/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i071e7:"}}