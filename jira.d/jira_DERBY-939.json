{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12328816","self":"https://issues.apache.org/jira/rest/api/latest/issue/12328816","key":"DERBY-939","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-02-12 04:07:34.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22213","customfield_12310222":"1_*:*_1_*:*_15315240000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_2_*:*_17144824782_*|*_4_*:*_1_*:*_11456","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-02-21T18:50:50.752+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-939/watchers","watchCount":0,"isWatching":false},"created":"2006-02-11T02:09:50.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-02-21T18:51:06.236+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"If I set \"derby.language.logQueryPlan\" to true and then attempt to execute the following simple query using UNION and INTERSECT, Derby will return the correct results and then, _after_ returning the results, will throw a NullPointerException.  This error also occurs for 10.1.\n\nTo reproduce:\n\n> java -Dderby.language.logQueryPlan=true org.apache.derby.tools.ij\n\nand then do:\n\ncreate table t1 (i int);\ncreate table t2 (j int);\ncreate table t3 (a int);\n\nij> select i from t1 union (select j from t2 intersect select a from t3);\n1\n-----------\n\n0 rows selected\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\n\nIf I add data, the query will return the correct results,  but then throw the NPE.\n\ninsert into t1 values 1, 2, 3, 4, 5;\ninsert into t2 values 2, 4, 6, 8, 10;\ninsert into t3 values 2, 3, 4;\n\nij> select i from t1 union (select j from t2 intersect select a from t3);\n1\n-----------\n1\n2\n3\n4\n5\n\n5 rows selected\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\n\nThe embedded and client stack traces are shown below. Both suggest that the problem occurs during the close of the result set.\n\n-- Embedded --\n\njava.lang.NullPointerException\n\tat org.apache.derby.impl.sql.execute.rts.RealUnionResultSetStatistics.getStatementExecutionPlanText(RealUnionResultSetStatistics.java:107)\n\tat org.apache.derby.impl.sql.execute.rts.RealSortStatistics.getStatementExecutionPlanText(RealSortStatistics.java:124)\n\tat org.apache.derby.impl.sql.execute.rts.RunTimeStatisticsImpl.getStatementExecutionPlanText(RunTimeStatisticsImpl.java:293)\n\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.finishAndRTS(BasicNoPutResultSetImpl.java:633)\n\tat org.apache.derby.impl.sql.execute.SortResultSet.finish(SortResultSet.java:479)\n\tat org.apache.derby.impl.jdbc.EmbedResultSet.close(EmbedResultSet.java:533)\n\tat org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:272)\n\tat org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:260)\n\tat org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:381)\n\tat org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:434)\n\tat org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310)\n\tat org.apache.derby.impl.tools.ij.Main.go(Main.java:203)\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)\n\tat org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)\n\tat org.apache.derby.tools.ij.main(ij.java:60)\n\n-- Client --\n\nERROR (no SQLState): actual code point, 4692 does not match expected code point, 9224\njava.sql.SQLException: actual code point, 4692 does not match expected code point, 9224\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:280)\n        at org.apache.derby.client.am.ResultSet.close(ResultSet.java:412)\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:272)\n        at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:260)\n        at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:381)\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:434)\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310)\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:203)\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)\n        at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)\n        at org.apache.derby.tools.ij.main(ij.java:60)\nCaused by: org.apache.derby.client.am.DisconnectException: actual code point, 4692 does not match ex\npected code point, 9224\n        at org.apache.derby.client.net.Reply.zThrowSyntaxError(Reply.java:1157)\n        at org.apache.derby.client.net.Reply.parseLengthAndMatchCodePoint(Reply.java:1057)\n        at org.apache.derby.client.net.NetConnectionReply.parseSQLCARD(NetConnectionReply.java:2519)\n\n        at org.apache.derby.client.net.NetConnectionReply.parseRDBCMMreply(NetConnectionReply.java:2\n00)\n        at org.apache.derby.client.net.NetConnectionReply.readLocalCommit(NetConnectionReply.java:13\n3)\n        at org.apache.derby.client.net.ConnectionReply.readLocalCommit(ConnectionReply.java:42)\n        at org.apache.derby.client.net.NetConnection.readLocalCommit_(NetConnection.java:1347)\n        at org.apache.derby.client.am.Connection.readCommit(Connection.java:624)\n        at org.apache.derby.client.am.Connection.readAutoCommit(Connection.java:614)\n        at org.apache.derby.client.am.ResultSet.readAutoCommitIfNotAutoCommitted(ResultSet.java:509)\n\n        at org.apache.derby.client.am.ResultSet.readCloseAndAutoCommit(ResultSet.java:474)\n        at org.apache.derby.client.am.ResultSet.flowCloseAndAutoCommitIfNotAutoCommitted(ResultSet.j\nava:455)\n        at org.apache.derby.client.am.ResultSet.closeX(ResultSet.java:425)\n        at org.apache.derby.client.am.ResultSet.close(ResultSet.java:407)\n\nERROR XJ001: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerException\n[XX] XJ001.U\njava.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ001, SQLERRMC: java.lang.NullPointerException[XX]XJ001.U\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:280)\n        at org.apache.derby.client.am.SqlException.getSQLException(SqlException.java:295)\n        at org.apache.derby.client.am.ResultSet.close(ResultSet.java:412)\n        at org.apache.derby.tools.JDBCDisplayUtil.indent_DisplayResults(JDBCDisplayUtil.java:272)\n        at org.apache.derby.tools.JDBCDisplayUtil.DisplayResults(JDBCDisplayUtil.java:260)\n        at org.apache.derby.impl.tools.ij.utilMain.displayResult(utilMain.java:381)\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:434)\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:310)\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:203)\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:169)\n        at org.apache.derby.impl.tools.ij.Main14.main(Main14.java:55)\n        at org.apache.derby.tools.ij.main(ij.java:60)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40182","summary":"NullPointerException at ResultSet.close() time for simple query using UNION and INTERSECT","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Embedded and server modes, with derby.language.logQueryPlan=true","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":12,"total":12,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12365928","id":"12365928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Adding full trace for Client in case that's useful...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-02-11T02:18:01.000+0000","updated":"2006-02-11T02:18:01.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12365983","id":"12365983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Ask Satheesh Bandaram pointed out on derby-dev, it turns out that this error only occurs if derby.language.logQueryPlan is set to true.  So I've updated the description of the issue to reflect that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-02-11T06:42:36.000+0000","updated":"2006-02-11T06:42:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12366021","id":"12366021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"The client exception is printing non-ascii characters in the message for this case.  Removing them from the description as they have caused issues with Jira export in the past and will file a Jira issue.  It appears that this was a missed case in the fix for DERBY-285\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-02-12T04:07:34.000+0000","updated":"2006-02-12T04:07:34.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12422599","id":"12422599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"I believe the root of this problem is that the SetOpResultSet which implements the execution logic of INTERSECT and EXCEPT set operation does not have a corresponding runtime statistics(RTS) class define.  When the RTS mode is turned on via the derby.language.logQueryPlan property, the RealUnionResultSetStatistics object attempts to obtain the plan text from its child source inputs.  But since RealResultSetStatisticsFactory does not handle SetOpResultSet(intersect for the above case), its getResultSetStatistics() method will return null which eventually will cause the NPE from the RealUnionResultSetStatistics object.  I am almost done with the patch and will post it here for review when it passes the derbyall regression.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-07-21T09:54:36.000+0000","updated":"2006-07-21T09:54:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12422973","id":"12422973","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Here is the patch for DERBY-939.  \r\n\r\nThe attached file derby939trunkdiffpatch1.txt contains the fix for this issue + testcases and is diffed against the trunk codeline and derby939trunkstatpatch1.txt contains the list of file changes.  I have ran derbyall suite and no new regression is introduced by this patch.  \r\n\r\nAs noted from my previous comment, the NPE is caused by a missing implementation of the runtime statistics for SetOpResultSet; thus, I implemented a class called RealSetOpResultSetStatistics under org.apache.derby.impl.sql.execute.rts package where all the runtime statistics classes reside and modified SetOpResultSet to process the runtime statistics attributes that RealSetOpResultSetStatistics need to address this issue.  \r\n\r\nI verified the output of the testcases plan and they do not output null string or throw NPE anymore.  i.e.: \r\n\r\nSELECT i FROM t1 UNION SELECT j FROM t2 INTERSECT SELECT k FROM t3;\r\n\r\nwould have the following plan structure according to the plan output.  (See setOpPlan.sql for more details).\r\n\r\n           SORT ( no dups )\r\n                |\r\n          UNION\r\n              /     \\\r\n             /       \\\r\n    TSCAN   INTERSECT\r\n          |                 /   \\\r\n         t1               /     \\\r\n                   SORT  SORT\r\n                         |            |\r\n                  TSCAN  TSCAN\r\n                         |            |\r\n                        t2          t3\r\n\r\nHere is the release note if it makes it in 10.2:\r\n\r\n==========================================================\r\n\r\nRelease Note for DERBY-939\r\n----------------------------------------\r\n\r\nPROBLEM\r\n\r\n   Unable to produce query plan or runtime statistics for INTERSECT or EXCEPT operation when runtime statistics is enabled or when the property derby.language.logQueryPlan is set to true.\r\n    \r\nSYMPTOMS\r\n\r\n   (1) A NUllPointerException(NPE) occurs when a SQL query is executed that involves a UNION and INTERSECT/EXCEPT operation in: \r\n          a) when the property derby.language.logQueryPlan=true OR \r\n          b) runtime statistics mode via a CALL SYSCS_UTIL.SYSCS_SET_RUNTIMESTATISTICS(1)  \r\n\r\n       i.e.:\r\n\r\n       Case a:  \r\n\r\n       java -Dderby.language.logQueryPlan=true org.apache.derby.tools.ij\r\n       \r\n       ij> connect 'jdbc:derby:db1;create=true';\r\n       create table t1 (i int);\r\n       create table t2 (j int);\r\n       create table t3 (a int);\r\n\r\n       ij> select i from t1 union (select j from t2 intersect select a from t3);\r\n       1\r\n       -----------\r\n\r\n       0 rows selected\r\n       ERROR XJ001: Java exception: ': java.lang.NullPointerException'. \r\n\r\n\r\n       Case b:\r\n\r\n       CALL SYSCS_UTIL.SYSCS_SET_RUNTIMESTATISTICS(1);\r\n       SELECT i FROM t1 UNION SELECT j FROM t2 INTERSECT SELECT a FROM t3;\r\n       1\r\n       -----------\r\n\r\n       0 rows selected\r\n       ij> VALUES SYSCS_UTIL.SYSCS_GET_RUNTIMESTATISTIC();\r\n       1\r\n       --------------------------------------------------------------------------------\r\n       ------------------------------------------------\r\n       ERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.\r\n       ERROR XJ001: Java exception: ': java.lang.NullPointerException'. \r\n\r\n\r\n   (2) When a query only contains a simple INTERSECT or EXCEPT operation and   \r\n         the property derby.language.logQueryPlan=true., Derby outputs a null string in \r\n        derby.log instead of the actual execution plan in textual representation.\r\n\r\n       i.e.:\r\n       java -Dderby.language.logQueryPlan=true org.apache.derby.tools.ij\r\n\r\n       ij> connect 'jdbc:derby:db1';        \r\n       ij> SELECT i FROM t1 INTERSECT SELECT j FROM t2;\r\n       ij> quit;\r\n\r\n       In derby.log:\r\n       \r\n       2006-07-24 05:12:57.578 GMT Thread[main,5,main] (XID =186), (SESSIONID = 0), select i from t1 intersect select j from t2 ******* null\r\n\r\nCAUSE\r\n\r\n   Derby's INTERCEPT and EXCEPT runtime statistics are not implemented; \r\n   therefore, resulting in the stated problem above.The affected version is Derby \r\n   10.1.          \r\n\r\nSOLUTION\r\n    \r\n   A fix to resolve the Derby symptom is available in 10.2? builds. \r\n\r\nWORKAROUND\r\n\r\n   None.\r\n\r\n==========================================================\r\n\r\nI would appreciate it if someone can review this patch.  Thanks!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-07-24T05:55:07.000+0000","updated":"2006-07-24T05:55:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12423743","id":"12423743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Review comments can be found here:\r\n\r\n  http://article.gmane.org/gmane.comp.apache.db.derby.devel/24721","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-07-26T23:59:31.000+0000","updated":"2006-07-26T23:59:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12423888","id":"12423888","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"I fixed the whitespace issue.  Resubmitting the patch for review.  Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-07-27T18:33:59.000+0000","updated":"2006-07-27T18:33:59.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12423927","id":"12423927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"No further review comments from me.  +1 to commit  derby939trunkdiffpatch2.txt .\r\n\r\nThanks Yip!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-07-27T21:17:18.000+0000","updated":"2006-07-27T21:17:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12424921","id":"12424921","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Has anyone besides Yip run derbyall on this patch yet?  If it passes derbyall, I'd be happy to check it in.  If I need to run derbyall, that will take me some more time...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2006-08-01T16:33:38.000+0000","updated":"2006-08-01T16:33:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12425143","id":"12425143","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Ran derbyall on this, it passed with the exception of known diffs.  Committed revision 427899.  Leaving unresolved as it appears this still needs a release note written for it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2006-08-02T05:48:00.000+0000","updated":"2006-08-02T05:48:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12435151","id":"12435151","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Can someone please explain to me why this issue requires a release note? Why shouldn't this issue just appear in the same list with the other 150 or so bugs which were fixed for 10.2?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2006-09-15T23:42:25.000+0000","updated":"2006-09-15T23:42:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12328816/comment/12474792","id":"12474792","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Reopening to clear the \"Release Note Needed\" flag since no release note was necessary.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2007-02-21T18:50:39.274+0000","updated":"2007-02-21T18:50:39.274+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-939/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i078qn:"}}