{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12432431","self":"https://issues.apache.org/jira/rest/api/latest/issue/12432431","key":"DERBY-4341","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-08-06 18:31:04.359","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24197","customfield_12310222":"1_*:*_1_*:*_17034213208_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-02-19T21:53:54.368+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4341/watchers","watchCount":2,"isWatching":false},"created":"2009-08-06T18:10:21.160+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:19:22.935+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11405","id":"11405","name":"Build tools"}],"timeoriginalestimate":null,"description":"The problem happens when we are trying to compile the source code in a folder and have the CLASSPATH variable set to a different code tree folder. This results in compile failures like the following:\r\n\r\nrunmessagecheck:\r\n[runMessageBundleTest] WARNING: Message id 22011.S.1 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id 42Y03.S.0 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id 42Y03.S.1 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id 42Y03.S.2 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n\r\nBUILD FAILED\r\n/home/tiago/Desktop/DerbyStuff/CodeTenFiveTwo/build.xml:514: Message check failed. \r\nSee error in build output or call ant runmessagecheck.\r\n\r\nTotal time: 1 minute 11 seconds\r\n\r\nThis should be an easy fix and it is marked as a bug, since it doesn't seem very logical for the compiling process to be CLASSPATH-dependent. Note that unsetting the CLASSPATH altogether allows the compile to run without errors, so clearly this variable isn't needed and shouldn't be used when it is set.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38209","summary":"Building with ant all with a different CLASSPATH defined causes the build to fail","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10423","value":"Newcomer","id":"10423"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10427","value":"Workaround attached","id":"10427"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":15,"total":15,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12740187","id":"12740187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Tiago for having a look at this. This problem has bitten me before as well, and it would be nice to have it fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-08-06T18:31:04.359+0000","updated":"2009-08-06T18:31:04.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12764974","id":"12764974","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markiemark","name":"markiemark","emailAddress":"apache dot org dot Markie1 at dfgh dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark B","active":true},"body":"for now I'll just add the detail\r\n\r\n$ ant -v runmessagecheck\r\nApache Ant version 1.7.1 compiled on October 3 2008\r\nBuildfile: build.xml\r\nDetected Java version: 1.6 in: /usr/lib/jvm/java-6-sun-1.6.0.10/jre\r\nDetected OS: Linux\r\nparsing buildfile /home/mark/src/derbypristine/verypristine/build.xml with URI = file:/home/mark/src/derbypristine/verypristine/build.xml\r\nProject base dir set to: /home/mark/src/derbypristine/verypristine\r\n[antlib:org.apache.tools.ant] Could not load definitions from resource org/apache/tools/ant/antlib.xml. It could not be found.\r\n [property] Loading /home/mark/ant.properties\r\n [property] Unable to find property file: /home/mark/ant.properties\r\n [property] Loading /home/mark/src/derbypristine/verypristine/tools/ant/properties/dirs.properties\r\nProperty \"jdk\" has not been set\r\nProperty \"sanity\" has not been set\r\n [property] Loading /home/mark/src/derbypristine/verypristine/tools/ant/properties/sane${sanity}.properties\r\n [property] Unable to find property file: /home/mark/src/derbypristine/verypristine/tools/ant/properties/sane${sanity}.properties\r\n [property] Loading /home/mark/src/derbypristine/verypristine/java/engine/state.properties\r\nBuild sequence for target(s) `runmessagecheck' is [runmessagecheck]\r\nComplete build sequence is [runmessagecheck, checklocaleinfo, localeinfo, setInitialProperties, init, setissane, sanitynamesane, sanitynameinsane, setsanityname, junit-all-codeline-jars-set-properties, junit-init, junit-system-mini, junit-system-mini-codeline-jars, infowriter, toolsdocs, showenv, getstate, state, shared, parsers, engine, junit-sysinfo, getsvnversion, prebuild, setCompilerProperties, initjars, derbywar, include-in-javadoc, buildlocaleinfo, publishedapi-workhorse, ckversioninfo, writeversioninfo, versioninfo, emma-init, derbyjarwithosgi, localeinfowriter, junit-core, jdbc3stubs, clean, cleanstate, cleanparsers, cleanmessages, cleancatalog, cleantoursdb, clobber, snapshotError, snapshot, checksanenotset, state.exists, checkstateremoved, checkforpackagingfile, cleanalljars, cleandocs, cleansnapshot, cleanreleasefiles, prepareforrelease, junit-pptesting, checkCompilerLevel, jsr169stubs, jdbc4stubs, felixStubs, storeless, tools, drda, client, build, buildsource, vti-demo, demo, demodocs, cscuptodate, class_size_catalog, junit-jdbc4-workhorse, checkVMLevel, junit-jdbc4, junit-jmx, junit-lowmem, junit-all, insane, ensuresanitystate.insane, l10ncheck, derbyjar, derbytoolsjar, derbynetjar, derbyclientjar, derbyrunjar, derbylocalejars, ckderbytesting, derbytestingjar, buildjars, plugin, junit-clean, declare-autoloadable-driver, make-core-derbyjar-manifest, public-jdbc4-api, chkparser, genParser, testing, pptesting, all, publishedapi, derbydocs, grammardocs, testingdocs, javadoc, gump_all, junit-single, junit-single-codeline-jars, emma-instrumentation, emma-report, emma-all, localejar, evaluate.sane, sane, public-jdbc3-api, emma-single, printCompilerProperties, ensuresanitystate, ensuresanitystate.sane, cleanlocale, junit-html, junitreport, exclude-from-javadoc, engine_169_opt, emma-clean, meta-inf-common, cleanjars, cleanversion, junit-all-codeline-jars, make-locale-classpath-manifest, buildworld, dojjdocs, cibuild, buildjarsclean, ]\r\n\r\nrunmessagecheck:\r\n[runMessageBundleTest] WARNING: Message id XCL17.S in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id 08000.S.1 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id XJ102.S in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id J106 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id 25000 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id 22004.S.4 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n[runMessageBundleTest] WARNING: Message id 42Y03 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n\r\nBUILD FAILED\r\n/home/mark/src/derbypristine/verypristine/build.xml:514: Message check failed. \r\nSee error in build output or call ant runmessagecheck.\r\n\tat org.apache.derbyBuild.MessageBundleTest.execute(MessageBundleTest.java:69)\r\n\tat org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat org.apache.tools.ant.dispatch.DispatchUtils.execute(DispatchUtils.java:106)\r\n\tat org.apache.tools.ant.Task.perform(Task.java:348)\r\n\tat org.apache.tools.ant.Target.execute(Target.java:357)\r\n\tat org.apache.tools.ant.Target.performTasks(Target.java:385)\r\n\tat org.apache.tools.ant.Project.executeSortedTargets(Project.java:1337)\r\n\tat org.apache.tools.ant.Project.executeTarget(Project.java:1306)\r\n\tat org.apache.tools.ant.helper.DefaultExecutor.executeTargets(DefaultExecutor.java:41)\r\n\tat org.apache.tools.ant.Project.executeTargets(Project.java:1189)\r\n\tat org.apache.tools.ant.Main.runBuild(Main.java:758)\r\n\tat org.apache.tools.ant.Main.startAnt(Main.java:217)\r\n\tat org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\r\n\tat org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\r\n\r\nTotal time: 0 seconds\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markiemark","name":"markiemark","emailAddress":"apache dot org dot Markie1 at dfgh dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark B","active":true},"created":"2009-10-13T06:46:40.612+0000","updated":"2009-10-13T06:46:40.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12833313","id":"12833313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"body":"I was trying to look into this issue, but I think I am missing a key piece.  I have performed the runmessagecheck target with both CLASSPATH set and with CLASSPATH unset.  In both cases the build is successful and the messages are the same.\r\n\r\nCan you provide some additional information about how to duplicate this issue?\r\n\r\nThanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"created":"2010-02-13T04:01:51.237+0000","updated":"2010-02-13T04:01:51.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12833400","id":"12833400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi John, thanks for investigating this! You can mark the issue as \"assigned\" to you,\r\nduring the time you are studying it, so that others will know.\r\n\r\nThis problem doesn't *always* occur, only sometimes.\r\n\r\nI think that it tends to occur under a scenario like this:\r\n1) You have successfully built a certain vesion of the source\r\n2) Your classpath points to the built version of the source\r\n3) You update your subversion client to a new revision which holds new messages\r\n4) You try to build, with you classpath still pointing to the old built jars,\r\n   which do NOT refer to that message.\r\n\r\nSo see if it helps to reproduce the problem, by adding some new messages to messages.xml\r\nin your client, and then see if you are able to run the message checking tragets\r\nwith your classpath pointing at jars that don't hold those messages.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-02-13T15:20:42.299+0000","updated":"2010-02-13T15:20:42.299+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12833590","id":"12833590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"body":"What seems to be the simple solution to this is to run ant with the -noclasspath option.\r\n\r\n$ ant -v runmessagecheck -noclasspath\r\n\r\nI can duplicate the issue and adding the -noclasspath option allows the runmessagecheck task to complete successfully, when it would fail otherwise.\r\n\r\nI am looking into a way to modify the build.xml so that it ignores a user's CLASSPATH.  There are several options I have found, but none seem to have any effect on the results.  Still looking.\r\n\r\nAt this point there is a workaround (add the -noclasspath option), and I am still looking for a permanent solution.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"created":"2010-02-14T16:53:55.762+0000","updated":"2010-02-14T16:53:55.762+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12833904","id":"12833904","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"body":"I have been digging into this for a while and the more I read about ant the more it becomes clear that ant runs best when CLASSPATH is not set at all.  The ant documentation has a whole section about the classpath.\r\n\r\nhttp://ant.apache.org/manual/install.html\r\nSection: \"The CLASSPATH environment variable\"\r\n\r\nThe gist of it is that you should not run ant with CLASSPATH set.  And if you do, you should run ant with the -noclasspath option as I had indicated in the workaround section.\r\n\r\nThey also include the following code as something that you can add to your build.xml file to error out if the CLASSPATH is set.\r\n<property environment=\"env.\"/>\r\n<property name=\"env.CLASSPATH\" value=\"\"/>\r\n    <fail message=\"Unset $CLASSPATH / %CLASSPATH% before running Ant!\">\r\n        <condition>\r\n            <not><equals arg1=\"${env.CLASSPATH}\" arg2=\"\"/></not>\r\n        </condition>\r\n    </fail>\r\n\r\nThis essentially checks if your CLASSPATH is set and reports a relevant error message.\r\n\r\nI've tested it at the top of the build.xml and also within the runmessagecheck target.  With this in place, the build will fail with a message indicating the problem and how to fix it, which is at least clearer than just getting errors about missing messages.\r\n\r\nBelow is my modified version of the runmessagecheck target.\r\n  <!-- Run the MessageBundleTest -->\r\n  <target name=\"runmessagecheck\">\r\n    <property environment=\"env.\"/>\r\n    <property name=\"env.CLASSPATH\" value=\"\"/>\r\n    <fail message=\"Unset $CLASSPATH / %CLASSPATH% before running Ant!\">\r\n        <condition>\r\n            <not><equals arg1=\"${env.CLASSPATH}\" arg2=\"\"/></not>\r\n        </condition>\r\n    </fail>\r\n\r\n    <taskdef \r\n      name=\"runMessageBundleTest\"\r\n      classname=\"org.apache.derbyBuild.MessageBundleTest\"\r\n      classpath=\"${out.dir}\"\r\n    />\r\n    <runMessageBundleTest/>\r\n  </target>\r\n\r\n\r\nThe test could also be put at the top of the build.xml if we want to fail out any time CLASSPATH is set rather than just from within this one target.  I could see this same situation occurring with other targets and with it apparently never being a good idea to have the CLASSPATH set, we might want to avoid the case of getting additional bugs down the road as new targets exhibit the issue.\r\n\r\nIn my opinion, the solution that matches what ant recommends is to update the documentation to reflect that ant should be run without the CLASSPATH set (or with the -noclasspath option)\r\n\r\nAs a separate item, we can add the code I indicated to the appropriate place in build.xml to catch cases where it would fail so that a meaningful message is displayed.  One thing to keep in mind if the build.xml is changed.  If you have CLASSPATH set AND use the -noclasspath option, the code will still result in the fail since it does not check the -noclasspath option.  I am seeing if there is a way to also test for the -noclasspath option.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"created":"2010-02-15T18:02:59.333+0000","updated":"2010-02-15T18:02:59.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12833982","id":"12833982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks for working on this problem, John!\r\n\r\nCan we run MessageBundleTest as a sub-process, using <java fork=\"true\">,\r\nand would that allow us to ignore the parent process's CLASSPATH, if it was set?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-02-15T21:11:16.769+0000","updated":"2010-02-15T21:11:16.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12834064","id":"12834064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"body":"Thanks Bryan.\r\n\r\nI modified the runmessagecheck target to fork a java process.  Since this was no longer a taskdef running within the ant process, I had to modify the MessageBundleTest.java source so that it no longer extends org.apache.tools.ant.Task.  This meant changing the execute method to a standard main method.\r\n\r\nI also changed it to throw a basic Exception rather than a org.apache.tools.ant.BuildException.  Since it no longer runs in the ant environment, it does not have visibility to the ant classpath.\r\n\r\nNow when you run ant -v runmessagecheck, you get consistent results whether or not you have CLASSPATH set.  I also tested it with and without an extra message.\r\n\r\nThe only downside I see is that there are some extra lines of output, especially when it finds an extra message and throws the exception. The results seem to get lost in the output.\r\n\r\nI've attached a diff showing the changes I made from Revision 910374.\r\n\r\nI am new to all of this so if I am off in the weeds on my solution or not following the correct process for posting it, let me know.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"created":"2010-02-16T03:55:11.870+0000","updated":"2010-02-16T03:55:11.870+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12834797","id":"12834797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi John,\r\n\r\nThis seems like a promising approach to me.\r\n\r\nCan you attach an example of the output when MessageBundleTest finds problem,\r\nso we can see what it would look like when it occurs?\r\n\r\nAlso, is the '-v' necessary in your solution? Or will MessageBundleTest catch the\r\nmessage problems with just 'ant runmessagecheck'?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-02-17T15:06:13.056+0000","updated":"2010-02-17T15:06:13.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12834905","id":"12834905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"body":"Sorry about the -v.  That was how it was specified in the original posting so that is what I was using in all of my testing.  It does work without the -v, and the output is naturally much cleaner.\r\n\r\nHere is what the output shows if it finds a failure.\r\n$ ant runmessagecheck\r\nBuildfile: build.xml\r\n\r\nrunmessagecheck:\r\n     [java] WARNING: Message id 99999 in messages_en.properties is not referenced in either SQLState.java or MessageId.java\r\n     [java] Exception in thread \"main\" java.lang.Exception: Message check failed. \r\n     [java] See error in build output or call ant runmessagecheck.\r\n     [java] \tat org.apache.derbyBuild.MessageBundleTest.main(MessageBundleTest.java:68)\r\n\r\nBUILD FAILED\r\n/public/dev/svnwork/derby/build.xml:513: Java returned: 1\r\n\r\nTotal time: 0 seconds\r\n$\r\n\r\n\r\nIf no issues, you get the following.\r\n$ ant runmessagecheck\r\nBuildfile: build.xml\r\n\r\nrunmessagecheck:\r\n\r\nBUILD SUCCESSFUL\r\nTotal time: 0 seconds\r\n$\r\n\r\n\r\nOutputs are the same regardless of whether or not the CLASSPATH is set.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"created":"2010-02-17T18:22:34.926+0000","updated":"2010-02-17T18:22:34.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12835250","id":"12835250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"This seems like very reasonable behavior to me, and appears to address the principal concern\r\nof this issue as I understand it.\r\n\r\nAre you comfortable with the patch at this point? Do you feel it is complete?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-02-18T15:28:17.874+0000","updated":"2010-02-18T15:28:17.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12835354","id":"12835354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"body":"Yes.  I cannot think of anything else that should be done with it.  I think it addresses the reported problem with no side-effects that I have been able to find.\r\n\r\nI feel good about it and I think it is complete.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jsguru72","name":"jsguru72","emailAddress":"js at storta dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John Storta Jr.","active":true},"created":"2010-02-18T19:28:57.035+0000","updated":"2010-02-18T19:28:57.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12835396","id":"12835396","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Great. I'll try to have a closer look at the patch in my environment, and\r\nunless I encounter any problems I'll try to commit it soon.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-02-18T21:03:01.578+0000","updated":"2010-02-18T21:03:01.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/12835978","id":"12835978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks John for the patch! Your change seems to work great\r\nin my environment, so I've committed it to the trunk as revision 911999.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-02-19T21:53:54.332+0000","updated":"2010-02-19T21:53:54.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12432431/comment/13685220","id":"13685220","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:22.919+0000","updated":"2013-06-17T09:19:22.919+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4341/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06wk7:"}}