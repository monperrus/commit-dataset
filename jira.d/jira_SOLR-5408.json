{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12676857","self":"https://issues.apache.org/jira/rest/api/latest/issue/12676857","key":"SOLR-5408","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325762","id":"12325762","description":"Bugfix release after 4.6","name":"4.6.1","archived":false,"released":true,"releaseDate":"2014-01-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-11-11 22:37:13.267","customfield_12312323":null,"customfield_12310420":"356233","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1318056599_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-11-15T19:59:13.101+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5408/watchers","watchCount":5,"isWatching":false},"created":"2013-10-31T13:51:36.529+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324743","id":"12324743","description":"Major release after 4.4","name":"4.5","archived":false,"released":true,"releaseDate":"2013-10-05"}],"issuelinks":[{"id":"12377789","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12377789","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12657108","key":"SOLR-5027","self":"https://issues.apache.org/jira/rest/api/2/issue/12657108","fields":{"summary":"Field Collapsing PostFilter","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png","name":"New Feature","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-12-21T14:40:54.014+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"When using the collapsing query parser, only the last sort field appears to be used.\r\n\r\nhttp://172.18.0.10:8080/solr/product/select_eng?sort=score%20desc,name_sort_eng%20desc&qf=name_eng^3+brand^2+categories_term_eng+sku+upc+promoTag+model+related_terms_eng&pf2=name_eng^2&defType=edismax&rows=12&pf=name_eng~5^3&start=0&q=ipad&boost=sqrt(popularity)&qt=/select_eng&fq=productType:MERCHANDISE&fq=merchant:bestbuycanada&fq=(*:*+AND+-all_all_suppressed_b_ovly:[*+TO+*]+AND+-rbc_all_suppressed_b_ovly:[*+TO+*]+AND+-rbc_cpx_suppressed_b_ovly:[*+TO+*])+OR+(all_all_suppressed_b_ovly:false+AND+-rbc_all_suppressed_b_ovly:[*+TO+*]+AND+-rbc_cpx_suppressed_b_ovly:[*+TO+*])+OR+(rbc_all_suppressed_b_ovly:false+AND+-rbc_cpx_suppressed_b_ovly:[*+TO+*])+OR+(rbc_cpx_suppressed_b_ovly:false)&fq=translations:eng&fl=psid,name_eng,score&debug=true&debugQuery=true&fq={!collapse+field%3DgroupId+nullPolicy%3Dexpand}\r\n\r\n\r\n<result name=\"response\" numFound=\"5927\" start=\"0\" maxScore=\"5.6674457\">\r\n<doc>\r\n<str name=\"psid\">3002010250210</str>\r\n<str name=\"name_eng\">\r\nZOTAC ZBOX nano XS AD13 Plus All-In-One PC (AMD E2-1800/2GB RAM/64GB SSD)\r\n</str>\r\n<float name=\"score\">0.41423172</float>\r\n</doc>\r\n\r\n\r\nThe same query without using the collapsing query parser produces the expected result.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"356521","summary":"CollapsingQParserPlugin scores incorrectly when multiple sort criteria are used","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bchapman","name":"bchapman","emailAddress":"bchapman at bridge2solutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brandon Chapman","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bchapman","name":"bchapman","emailAddress":"bchapman at bridge2solutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brandon Chapman","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":22,"total":22,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13819524","id":"13819524","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"I was able to reproduce and am investigating what the issue is.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-11T22:37:13.267+0000","updated":"2013-11-11T22:37:13.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13819543","id":"13819543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Brandon,\r\n\r\nI believe this patch should resolve the issue. It was created on branch_4x. If it doesn't apply to your build, let me know and I'll create a patch for the version you're working with.\r\n\r\nThe problem was that the scorer needed to be set on the delegate collecter after each segment reader was set. The initial code was setting the scorer on the delegate collector only once, which worked fine for single sort critera. \r\n\r\nJoel\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-11T22:54:26.526+0000","updated":"2013-11-11T22:54:26.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13819545","id":"13819545","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"I'll add a test case for this as well going forward.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-11T22:55:22.376+0000","updated":"2013-11-11T22:55:22.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13819677","id":"13819677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1540904 from [~joel.bernstein] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1540904 ]\r\n\r\nSOLR-5408 Fix CollapsingQParserPlugin issue with compound sort criteria","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T00:51:00.449+0000","updated":"2013-11-12T00:51:00.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13819728","id":"13819728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehatcher","name":"ehatcher","emailAddress":"ehatcher at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ehatcher&avatarId=22298","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ehatcher&avatarId=22298","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ehatcher&avatarId=22298","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ehatcher&avatarId=22298"},"displayName":"Erik Hatcher","active":true},"body":"Here's a test case with Joel's fix merged in too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehatcher","name":"ehatcher","emailAddress":"ehatcher at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ehatcher&avatarId=22298","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ehatcher&avatarId=22298","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ehatcher&avatarId=22298","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ehatcher&avatarId=22298"},"displayName":"Erik Hatcher","active":true},"created":"2013-11-12T01:49:31.748+0000","updated":"2013-11-12T01:49:31.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13819746","id":"13819746","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1540922 from [~joel.bernstein] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1540922 ]\r\n\r\nSOLR-5408 Fix CollapsingQParserPlugin issue with compound sort criteria","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T02:30:43.124+0000","updated":"2013-11-12T02:30:43.124+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820279","id":"13820279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Erick,\r\n\r\nI like the a test case. Only one concern and that is the assertion of 5 segments. Could be a race condition here where a background merge gets done in between commits, causing there to be fewer then 5 segments.\r\n\r\nI was thinking about just taking out this assertion and using the rest of the test. All we need is there to be more then 1 segment to ensure the test is valid.\r\n\r\nLet me know what you think,\r\n\r\nThanks,\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-12T17:48:51.129+0000","updated":"2013-11-12T17:48:51.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820368","id":"13820368","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Further testing shows the bug is still present after this patch. Continuing to investigate...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-12T19:16:17.623+0000","updated":"2013-11-12T19:16:17.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820397","id":"13820397","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehatcher","name":"ehatcher","emailAddress":"ehatcher at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ehatcher&avatarId=22298","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ehatcher&avatarId=22298","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ehatcher&avatarId=22298","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ehatcher&avatarId=22298"},"displayName":"Erik Hatcher","active":true},"body":"bq.  Only one concern and that is the assertion of 5 segments... All we need is there to be more then 1 segment to ensure the test is valid.\r\n\r\n+1, by all means modify the test to whatever makes sense here.  Maybe {code}assertTrue(\"Must be more than one segment\", searcherRef.get().getIndexReader().leaves().size() > 1){code} or something like that?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehatcher","name":"ehatcher","emailAddress":"ehatcher at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ehatcher&avatarId=22298","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ehatcher&avatarId=22298","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ehatcher&avatarId=22298","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ehatcher&avatarId=22298"},"displayName":"Erik Hatcher","active":true},"created":"2013-11-12T20:11:50.420+0000","updated":"2013-11-12T20:11:50.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820400","id":"13820400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehatcher","name":"ehatcher","emailAddress":"ehatcher at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ehatcher&avatarId=22298","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ehatcher&avatarId=22298","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ehatcher&avatarId=22298","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ehatcher&avatarId=22298"},"displayName":"Erik Hatcher","active":true},"body":"bq. Further testing shows the bug is still present after this patch.\r\n\r\nUnder what conditions?  Can you post a failing test case?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ehatcher","name":"ehatcher","emailAddress":"ehatcher at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=ehatcher&avatarId=22298","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=ehatcher&avatarId=22298","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=ehatcher&avatarId=22298","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=ehatcher&avatarId=22298"},"displayName":"Erik Hatcher","active":true},"created":"2013-11-12T20:13:09.469+0000","updated":"2013-11-12T20:13:09.469+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820424","id":"13820424","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"When I started testing with a larger dataset (millions) it become apparent pretty quickly that things were still broken with the score sorting when other criteria is used.\r\n\r\nI'm about to post the fix that worked on the larger data set.\r\n\r\nI'll have to give some thought into how get this to break with a small test case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-12T20:38:11.361+0000","updated":"2013-11-12T20:38:31.326+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820431","id":"13820431","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"I just posted a new patch.\r\n\r\nThis patch makes a change to the \"dummy\" scorer that is passed down to the delegate collector.\r\n\r\nThe issue was that certain priority queue implementations wrap the scorer in a cache that saves the score for the last docId. For this cache to work properly the dummy scorer needed to implement the docID() method properly. This patch does that.\r\n\r\nNot all the priority queue implementations use this technique, so depending on how the query is executed you may or may not hit the bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-12T20:45:33.224+0000","updated":"2013-11-12T20:45:46.234+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820434","id":"13820434","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Brandon,\r\n\r\nIf you want to post your version of the CollapsingQParserPlugin directly to this ticket. I will make the changes to the version you have and post it back.\r\n\r\nOtherwise, I will shortly be committing this fix to trunk and 4x so you could replace your version with the latest version.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-12T20:48:53.523+0000","updated":"2013-11-12T20:48:53.523+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820449","id":"13820449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1541232 from [~joel.bernstein] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1541232 ]\r\n\r\nSOLR-5408 Fixed issue with scorer","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T20:53:52.742+0000","updated":"2013-11-12T20:53:52.742+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820453","id":"13820453","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bchapman","name":"bchapman","emailAddress":"bchapman at bridge2solutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brandon Chapman","active":true},"body":"Attached patch that we are using.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bchapman","name":"bchapman","emailAddress":"bchapman at bridge2solutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brandon Chapman","active":true},"created":"2013-11-12T20:55:56.830+0000","updated":"2013-11-12T20:55:56.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820505","id":"13820505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Brandon,\r\n\r\nI'll edit your version of the CollapsingQParserPlugin directly and post that back to the ticket.\r\n\r\nSo just attach the CollapserQParserPlugin.java file.\r\n\r\nJoel ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-12T21:38:10.449+0000","updated":"2013-11-12T21:38:10.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820507","id":"13820507","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bchapman","name":"bchapman","emailAddress":"bchapman at bridge2solutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brandon Chapman","active":true},"body":"attaching java file instead of patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bchapman","name":"bchapman","emailAddress":"bchapman at bridge2solutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brandon Chapman","active":true},"created":"2013-11-12T21:41:19.833+0000","updated":"2013-11-12T21:41:19.833+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820569","id":"13820569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Brandon,\r\n\r\nI put a file up for you to test. I don't have the same build as you have anymore so I won't be able to compile and test. But the changes were very small, so I suspect they will work.\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-12T22:28:01.910+0000","updated":"2013-11-12T22:28:01.910+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13820575","id":"13820575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1541277 from [~joel.bernstein] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1541277 ]\r\n\r\nSOLR-5408 Fixed issue with scorer","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-12T22:30:43.957+0000","updated":"2013-11-12T22:30:43.957+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13821735","id":"13821735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bchapman","name":"bchapman","emailAddress":"bchapman at bridge2solutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brandon Chapman","active":true},"body":"Joel, \r\n\r\nThe file you provided worked. I did a brief test in our staging environment for the sorting and ran all our integration tests.\r\n\r\nThanks,\r\n\r\nBrandon","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bchapman","name":"bchapman","emailAddress":"bchapman at bridge2solutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Brandon Chapman","active":true},"created":"2013-11-13T19:36:43.723+0000","updated":"2013-11-13T19:36:43.723+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13822374","id":"13822374","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Brandon,\r\n\r\nThat's good news. This fix has been committed to trunk and 4x. Thanks for reporting.\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-14T12:28:23.187+0000","updated":"2013-11-14T12:28:23.187+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12676857/comment/13854793","id":"13854793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1552875 from [~joel.bernstein] in branch 'dev/branches/lucene_solr_4_6'\r\n[ https://svn.apache.org/r1552875 ]\r\n\r\nSOLR-5408: CollapsingQParserPlugin scores incorrectly when multiple sort criteria are used","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-21T05:24:52.338+0000","updated":"2013-12-21T05:24:52.338+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5408/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1peuv:"}}