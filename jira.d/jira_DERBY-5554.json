{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12536241","self":"https://issues.apache.org/jira/rest/api/latest/issue/12536241","key":"DERBY-5554","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-12-23 08:25:34.597","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"221924","customfield_12310222":"1_*:*_1_*:*_18020979447_*|*_5_*:*_2_*:*_28588476664_*|*_4_*:*_1_*:*_44036","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-06-14T16:54:41.151+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5554/watchers","watchCount":6,"isWatching":false},"created":"2011-12-23T05:49:41.024+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_backport_reject_10_8","derby_triage10_9"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12354198","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12354198","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12346111","key":"DERBY-1520","self":"https://issues.apache.org/jira/rest/api/2/issue/12346111","fields":{"summary":"Document new SYSCS_DIAG tables","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}},{"id":"12354196","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12354196","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12357812","key":"DERBY-2152","self":"https://issues.apache.org/jira/rest/api/2/issue/12357812","fields":{"summary":"Support diagnostic vti tables that take parameters, such as SpaceTable","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12389137","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12389137","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12717893","key":"DERBY-6593","self":"https://issues.apache.org/jira/rest/api/2/issue/12717893","fields":{"summary":"Using a natural join, you can invoke a table function with an argument which is outside the scope of the query block.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12352583","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12352583","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12557004","key":"DERBY-5779","self":"https://issues.apache.org/jira/rest/api/2/issue/12557004","fields":{"summary":"Table functions should only accept arguments which are constant in their query block.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12353806","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12353806","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12595142","key":"DERBY-5822","self":"https://issues.apache.org/jira/rest/api/2/issue/12595142","fields":{"summary":"Document the new SQL standard behavior of the SPACE_TABLE vti","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-06-02T12:37:25.353+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"With the latest 10.8.2.2 binary distribution, the following short script produces a NullPointerException:\r\n\r\njava -Dij.exceptionTrace=true org.apache.derby.tools.ij\r\nij> connect 'jdbc:derby:brydb;create=true';\r\nij> create table t1 (a int);\r\nij> SELECT T2.*, systabs.*, syscgs.conglomeratenumber\r\n    FROM \r\n        SYS.SYSTABLES systabs, sys.sysconglomerates syscgs,\r\n        TABLE (SYSCS_DIAG.SPACE_TABLE(systabs.tablename)) AS T2\r\n    WHERE systabs.tabletype = 'T' and systabs.tableid = syscgs.tableid;\r\n\r\n\r\nThe exception trace is pasted below:\r\n\r\nERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.\r\njava.sql.SQLException: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.seeNextException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.Main.go(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.Main.main(Unknown Source)\r\n\tat org.apache.derby.tools.ij.main(Unknown Source)\r\nCaused by: java.sql.SQLException: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\r\n\t... 18 more\r\nCaused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n\t... 15 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.derby.exe.acf81e0010x0134x6972x0511x0000033820000.g0(Unknown Source)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:616)\r\n\tat org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.VTIResultSet.openCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.JoinResultSet.openRight(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\r\n\t... 11 more\r\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\r\njava.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.Util.javaException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.Main.go(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)\r\n\tat org.apache.derby.impl.tools.ij.Main.main(Unknown Source)\r\n\tat org.apache.derby.tools.ij.main(Unknown Source)\r\nCaused by: java.sql.SQLException: Java exception: ': java.lang.NullPointerException'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\r\n\t... 19 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.derby.exe.acf81e0010x0134x6972x0511x0000033820000.g0(Unknown Source)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:616)\r\n\tat org.apache.derby.impl.services.reflect.ReflectMethod.invoke(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.VTIResultSet.openCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.JoinResultSet.openRight(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.JoinResultSet.openCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\r\n\t... 11 more\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10365","value":"Crash","id":"10365"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35614","summary":"NullPointerException in generated VTI code","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10102","value":"Patch Available","id":"10102"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":46,"total":46,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13175328","id":"13175328","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Seen all the way back to 10.3.1.4 (earlier releases didn't support the syntax - DERBY-2152).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-12-23T08:25:34.597+0000","updated":"2011-12-23T08:25:34.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13279085","id":"13279085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The failing query looks very similar to the sample query for SYSCS_DIAG.SPACE_TABLE found in the Reference Manual section titled \"SYSCS_DIAG diagnostic tables and functions\":\r\n\r\nSELECT T2.*\r\n    FROM \r\n        SYS.SYSTABLES systabs,\r\n        TABLE (SYSCS_DIAG.SPACE_TABLE(systabs.tablename)) AS T2\r\n    WHERE systabs.tabletype = 'T'\r\n\r\nI confess that I don't understand the meaning of either query. When we implemented user-defined table functions, we specified that the arguments to the table function should be expressions built from the following:\r\n\r\n1) literals\r\n2) ? parameters\r\n3) correlated references to variables in outer query blocks\r\n\r\nThat is, the arguments were supposed to be constant within the query block. We specifically did not want table function arguments to be variables from other tables in the FROM list. However, we don't enforce this limitation. You get a similar NPE if you replace the SYSCS_DIAG.SPACE_TABLE element in the FROM list with an invocation of a user defined table function which takes the SYSTABLES.TABLENAME variable as an argument.\r\n\r\nI'm trying to figure out what these queries mean. My usual approach to understanding a query is to follow these steps:\r\n\r\nA) Compute the cartesian product of the elements in the FROM list.\r\n\r\nB) Then join and restrict by applying the WHERE clause to the cartesian product.\r\n\r\nC) Then apply the other clauses in an order which doesn't affect this discussion.\r\n\r\nWith these queries, what is (A)? I don't see a cartesian product here because there is an implicit, undefined join in the FROM list.\r\n\r\nMy gut feeling is that these may be illegal queries, but I haven't found the relevant chapter and verse in the SQL Standard. I would be interested in other people's theories about the meaning of these queries and how you thread your way through the SQL Standard in order to determine that meaning.\r\n\r\nThanks,\r\n-Rick\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-18T19:01:45.290+0000","updated":"2012-05-18T19:01:45.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13279391","id":"13279391","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I think the intention is clear: you want a union of tables resulting from subtables of the form TABLE (SYSCS_DIAG.SPACE_TABLE(<name of a system table>), where <name of a system table> would range over all the system tables of type 'T'. Now, how would a correct/better query for this look? It would need to employ correlated references to variables in outer query blocks, since literal and ? are not applicable here...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-05-19T01:28:33.764+0000","updated":"2012-05-19T01:28:33.764+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13280001","id":"13280001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The query passes if I add an optimizer override to force the table function to be the inner table in the join (which makes some sense, since otherwise the argument to the table function would not have a known value):\r\n\r\nSELECT T2.*, systabs.*, syscgs.conglomeratenumber\r\n    FROM --DERBY-PROPERTIES joinOrder=fixed\r\n        SYS.SYSTABLES systabs, sys.sysconglomerates syscgs,\r\n        TABLE (SYSCS_DIAG.SPACE_TABLE(systabs.tablename)) AS T2\r\n    WHERE systabs.tabletype = 'T' and systabs.tableid = syscgs.tableid;\r\n\r\nIf I reverse the join order, I see this error:\r\n\r\nij> SELECT T2.*, systabs.*, syscgs.conglomeratenumber\r\n>    FROM --DERBY-PROPERTIES joinOrder=fixed\r\n>        TABLE (SYSCS_DIAG.SPACE_TABLE(systabs.tablename)) AS T2, sys.sysconglomerates syscgs, SYS.SYSTABLES systabs\r\n>    WHERE systabs.tabletype = 'T' and systabs.tableid = syscgs.tableid; \r\nERROR 42Y70: The user specified an illegal join order. This could be caused by a join column from an inner table being passed as a parameter to an external virtual table.\r\n\r\nThe error message implies that the original query was supposed to work, I think, but the optimizer for some reason didn't enforce the correct ordering.\r\n\r\nOr maybe the optimizer does enforce the requirement that the table function call must be the inner table relative to the table from which it takes its arguments, but the query only works if the table function call is the innermost table? For example, it does accept the following forced join order, in which systabs.tablename should be known when SPACE_TABLE is called, but it still fails with a NullPointerException during execution:\r\n\r\nSELECT T2.*, systabs.*, syscgs.conglomeratenumber\r\n    FROM --DERBY-PROPERTIES joinOrder=fixed\r\n        SYS.SYSTABLES systabs,\r\n        TABLE (SYSCS_DIAG.SPACE_TABLE(systabs.tablename)) AS T2,\r\n        sys.sysconglomerates syscgs\r\n    WHERE systabs.tabletype = 'T' and systabs.tableid = syscgs.tableid;","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-05-21T08:03:25.064+0000","updated":"2012-05-21T08:03:25.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13280235","id":"13280235","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Note that Derby does not allow subqueries in the FROM list to join to other tables in the query block. This behavior of Derby seems correct to me. At the very least it is odd that you can get around this limitation by wrapping the query in a table function.\r\n\r\nij> connect 'jdbc:derby:memory:db;create=true';\r\nij> create table t1 ( a int );\r\n0 rows inserted/updated/deleted\r\nij> create table t2( b int );\r\n0 rows inserted/updated/deleted\r\nij> select *\r\nfrom t1 t, ( select * from t2 ) s\r\nwhere s.b > t.a;\r\nA          |B          \r\n-----------------------\r\n\r\n0 rows selected\r\nij> select *\r\nfrom t1 t\r\nwhere exists ( select * from t2 where b > t.a );\r\nA          \r\n-----------\r\n\r\n0 rows selected\r\nij> select *\r\nfrom t1 t, ( select * from t2 where b > t.a ) s;\r\nERROR 42X04: Column 'T.A' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then 'T.A' is not a column in the target table.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-21T15:49:12.507+0000","updated":"2012-05-21T15:49:12.507+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13281057","id":"13281057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I believe that chapter and verse on this syntax can be found in part 2 of the SQL Standard, section 7.6 (<table reference>), Syntax Rule 6.a:\r\n\r\n\"If TR is contained in a <from clause> FC with no intervening <query expression>, then the scope clause SC of TR is the <select statement: single row> or innermost <query specification> that contains FC. The scope of a range variable of TR is the <select list>, <where clause>, <group by clause>, <having clause>, and <window clause> of SC, together with every <lateral derived table> that is simply contained in FC and is preceded by TR, and every <collection derived table> that is simply contained in FC and is preceded by TR, and the <join condition> of all <joined table>s contained in SC that contain TR. If SC is the <query specification> that is the <query expression body> of a simple table query STQ, then the scope of a range variable of TR also includes the <order by clause> of STQ.\"\r\n\r\nWhen applied to Bryan's original query, this says that the systabs table reference can be mentioned in the query's SELECT list, WHERE clause, GROUP BY clause, HAVING clause, WINDOW clause, and ORDER BY clause. The systabs table reference may be mentioned in the FROM clause only as follows:\r\n\r\na) in some syntax which Derby does not support (lateral derived tables and collection derived tables)\r\n\r\nb) in the ON clause of a JOIN to another tabular data set.\r\n\r\nThe sample SYSCS_DIAG.SPACE_TABLE syntax given in the Reference Manual is illegal and has no meaning.\r\n\r\n\r\nI don't see how to write a legal query which expresses Bryan's intent. We could consider adding a TABLEID column to the SPACE_TABLE output and change the vti's arguments so that they accept the % wildcard (like the metadata calls). Then something like this might capture Bryan's intent:\r\n\r\nSELECT T2.*, systabs.*, syscgs.conglomeratenumber\r\n    FROM\r\n        SYS.SYSTABLES systabs, sys.sysconglomerates syscgs,\r\n        TABLE (SYSCS_DIAG.SPACE_TABLE( '%' )) AS T2\r\n    WHERE systabs.tabletype = 'T'\r\n    and systabs.tableid = syscgs.tableid\r\n    and systabs.tableid = t2.tableid;\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-22T15:55:50.738+0000","updated":"2012-05-22T15:55:50.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13281477","id":"13281477","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Since SPACE_TABLE currently accepts one or two arguments (schema is optional), we could probably also make it to accept zero arguments, and return information for all tables when it's called that way. Then we wouldn't break applications that call their tables %. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-05-23T09:30:38.100+0000","updated":"2012-05-23T09:30:38.100+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13281489","id":"13281489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"By the way, here's an assert failure in a similar query (NPE in insane builds):\r\n\r\nij> select * from sys.systables st, sys.sysconglomerates sc, (select * from table(syscs_diag.space_table(st.tablename)) t2) t3 where st.tabletype='T' and st.tableid=sc.tableid;\r\nERROR XJ001: Java exception: 'ASSERT FAILED Found multiple optimizables that share one or more referenced table numbers (esp: '{0}'), but that should not be the case.: org.apache.derby.shared.common.sanity.AssertFailure'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-05-23T09:56:41.984+0000","updated":"2012-05-23T09:56:41.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13281601","id":"13281601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Anything that makes it easier to call SPACE_TABLE is fine, in my opinion,\r\nsince that's one of the most commonly called functions in our built-in set.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2012-05-23T13:34:46.001+0000","updated":"2012-05-23T13:34:46.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13396162","id":"13396162","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-5554-01-aa-addTableIDcolumn.diff. This patch adds a trailing TABLEID column to the SPACE_TABLE vti. This is the first step toward addressing this issue, as outlined in the plan attached to DERBY-5779. I am running regression tests now.\r\n\r\nTouches the following files:\r\n\r\nM       java/engine/org/apache/derby/diag/SpaceTable.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/SysDiagVTIMappingTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-18T19:10:47.223+0000","updated":"2012-06-18T19:10:47.223+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13396770","id":"13396770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a second rev of the patch: derby-5554-01-ab-addTableIDcolumn.diff. The second rev gets the tableid from a more general location and will work better when we add a no-arg constructor to the vti.\r\n\r\nTests passed cleanly for me on this rev. Committed at subversion revision 1351714.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-19T13:53:39.127+0000","updated":"2012-06-19T13:53:39.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13396891","id":"13396891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-5554-02-aa-0argConstructor.diff. This patch adds a 0-arg constructor to SPACE_TABLE. I am running regression tests now.\r\n\r\nThe meaning of the 0-arg constructor is \"give me information on all conglomerates for all tables\". With this patch, the following statement returns space information on all conglomerates:\r\n\r\nselect * from table(syscs_diag.space_table()) x\r\norder by conglomeratename;\r\n\r\nThis patch allows us to re-write the example in the Reference Guide section on SPACE_TABLE. The following new syntax is valid standard SQL:\r\n\r\nselect t2.*\r\n    from\r\n        sys.systables systabs,\r\n        table (syscs_diag.space_table()) as t2\r\n    where systabs.tabletype = 'T'\r\n    and systabs.tableid = t2.tableid;\r\n\r\nBryan's query can now be re-written as follows. Note that the join to SYSCONGLOMERATES gives rise to a cartesian product because there is no unique join column between SYSCONGLOMERATES and SPACE_TABLE. This was true of the original query also:\r\n\r\nselect t2.*, systabs.*, syscgs.conglomeratenumber\r\n    from\r\n        sys.systables systabs, sys.sysconglomerates syscgs,\r\n        table (syscs_diag.space_table()) as t2\r\n    where systabs.tabletype = 'T'\r\n    and systabs.tableid = t2.tableid\r\n    and systabs.tableid = syscgs.tableid;\r\n\r\n\r\n\r\nTouches the following files:\r\n\r\n----------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/catalog/DataDictionaryImpl.java\r\nM       java/engine/org/apache/derby/iapi/sql/dictionary/DataDictionary.java\r\n\r\nExpands the meaning of getConglomerateDescriptors( UUID ). If the UUID argument is null, this method now returns all of the conglomerates in the database.\r\n\r\n----------\r\n\r\nM       java/engine/org/apache/derby/diag/SpaceTable.java\r\n\r\nGives SPACE_TABLE a 0-arg construtor which behaves as described above.\r\n\r\n----------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/SysDiagVTIMappingTest.java\r\n\r\nTests for the new constructor.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-19T16:12:57.726+0000","updated":"2012-06-19T16:12:57.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13396969","id":"13396969","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Tests passed cleanly for me on derby-5554-02-aa-0argConstructor.diff. Committed at subversion revision 1351795.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-19T18:29:20.242+0000","updated":"2012-06-19T18:29:20.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13396975","id":"13396975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Unless someone objects, I am inclined to port 1351714 and 1351795 to the 10.9 and 10.8 branches. That should give quicker relief to people affected by this bug. Because SPACE_TABLE is a vti, no changes were made to catalog data; so it should be ok to port the fixes to release branches. The combined patches change SPACE_TABLE as follows:\r\n\r\n1) The vti now has a trailing TABLEID column.\r\n\r\n2) The vti can now be invoked with a 0-arg constructor.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-19T18:40:44.000+0000","updated":"2012-06-19T18:40:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13398744","id":"13398744","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Ported 1351714 and 1351795 from trunk to the 10.9 branch at subversion revision 1352648.\r\n\r\nPorted 1351714 and 1351795 from trunk to the 10.8 branch at subversion revision 1352652.\r\n\r\nThe port to 10.8 involved a change to SysDiagVTIMappingTest to account for a catalog query which returns different results in 10.8. That is because the SYSUSERS table does not exist in 10.8.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-21T18:56:45.020+0000","updated":"2012-06-21T18:56:45.020+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13403420","id":"13403420","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I have left this issue open because I think the following work should still be done. We can close this issue and open a new issue for the follow-on work if people think that's better:\r\n\r\n1) Formally describe the meaning of the special syntax which we still allow for VTIs but no longer allow for table functions (viz., the joins inside the FROM list).\r\n\r\n2) Fix the optimizer so that query plans are picked which enforce the formal meaning. This is the crux of fixing this issue. Once we fix the optimizer, Bryan's original query should run.\r\n\r\n3) Decide whether we want to document the formal meaning.\r\n\r\nThanks,\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-06-28T19:46:08.943+0000","updated":"2012-06-28T19:46:08.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13405229","id":"13405229","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Linking this issue to DERBY-2152. That is the issue which introduced parameterized diagnostic VTIs.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-02T18:41:59.109+0000","updated":"2012-07-02T18:41:59.109+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13405243","id":"13405243","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Linking to DERBY-1520, the issue which documented parameterized diagnostic VTIs. DERBY-2152 does not discuss the meaning of joining parameterized VTIs in the FROM list. The first mention of this capability is on 2007-03-23 on DERBY-1520. Although DERBY-1520 mentions the capability (and the example made its way into the Reference Guide), there is no discussion of the meaning of these joins.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-02T18:59:24.013+0000","updated":"2012-07-02T18:59:24.013+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13405281","id":"13405281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"There does not seem to be any previous discussion of what it means to join a parameterized diagnostic VTI in the FROM list. DERBY-2152 was a follow-on issue to DERBY-571. It seems to me that the clear intent of those issues was to fit diagnostic VTIs inside the SQL Standard, replacing the Derby-specific constructor syntax. The intent was not to create more syntax outside the SQL Standard. It does not appear that anyone realized the possibility of the illegal join in the FROM list until late in the process of documenting DERBY-2152. It does not appear that anyone at that time was aware that the syntax had no meaning inside the SQL Standard. Certainly there is no discussion of how the syntax violates the Standard and there is no discussion of what the non-standard syntax means.\r\n\r\nThis suggests the following:\r\n\r\n1) Without any guidance from the people who introduced this feature, we will have to try to come up with our own meaning.\r\n\r\n2) We should not document the meaning of the non-standard syntax. The point of DERBY-2152 was to steer people away from Derby extensions and encourage people to use standard syntax.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-02T19:31:15.326+0000","updated":"2012-07-02T19:31:15.326+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13405985","id":"13405985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"In standard SQL, the order of elements in the FROM list does not affect whether the query compiles. This is only partly true for queries which use the FROM list to join VTIs. In particular, non-standard behavior arises when VTIs join with other VTIs. I have observed the following:\r\n\r\n1) The order of non-VTI and non-table-function elements is not significant.\r\n\r\n2) However, a VTI argument can only join to VTIs/table-functions which precede it in the FROM list.\r\n\r\nI don't imagine that anyone joins our argument-bearing VTIs with one another. Our internal metadata queries don't seem to do this. In addition, the diagnostic VTI columns are not meaningful arguments for other diagnostic VTIs. For this reason, I think that it should be ok to put in some bind-time logic which prevents users from writing queries which join diagnostic VTIs to one another in the FROM list. Removing this useless edge-case makes it easier to define the meaning of the remaining, useful joins.\r\n\r\nThe following script demonstrates how you can (and can't) join VTIs to one another in the FROM list today:\r\n\r\nconnect 'jdbc:derby:memory:db;create=true';\r\n\r\nselect t1.*\r\nfrom \r\n    sys.systables systabs,\r\n    table ( syscs_diag.space_table( systabs.tablename ) ) as t1\r\nwhere systabs.tabletype = 'T';\r\n\r\n-- compiles\r\nselect t1.*, t2.*\r\nfrom \r\n    sys.systables systabs,\r\n    table ( syscs_diag.space_table( systabs.tablename ) ) as t1,\r\n    table ( syscs_diag.space_table( t1.conglomeratename ) ) as t2\r\nwhere systabs.tabletype = 'T';\r\n\r\nselect t1.*\r\nfrom \r\n    table ( syscs_diag.space_table( systabs.tablename ) ) as t1,\r\n    sys.systables systabs\r\nwhere systabs.tabletype = 'T';\r\n\r\n-- does not compile\r\nselect t1.*, t2.*\r\nfrom \r\n    sys.systables systabs,\r\n    table ( syscs_diag.space_table( t1.conglomeratename ) ) as t2,\r\n    table ( syscs_diag.space_table( systabs.tablename ) ) as t1\r\nwhere systabs.tabletype = 'T';\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-03T19:46:07.749+0000","updated":"2012-07-03T19:46:07.749+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13405997","id":"13405997","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-5554-03-aa-forbidVTItoVTIjoins.diff. This patch makes it illegal to join two VTIs to one another in the FROM list. Regression tests passed cleanly for me.\r\n\r\n\r\nTouches the following files:\r\n\r\n--------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/FromVTI.java\r\n\r\nForbid the illegal join at bind() time.\r\n\r\n--------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/SysDiagVTIMappingTest.java\r\n\r\nAdd a test case.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-03T20:11:31.445+0000","updated":"2012-07-03T20:11:31.445+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13406095","id":"13406095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"That seems like a reasonable restriction.   It would be good to mention in a release note.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-07-03T21:57:57.546+0000","updated":"2012-07-03T21:57:57.546+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13406102","id":"13406102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Couldn't we just rearrange the order at bind time (top sort) ? So long as there is no circularity, it seems to me the ordering shouldn't be significant, SQL being set oriented and not imperative...\r\n(using a dependency relation expressing that a from list element references another in the way used here)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-07-03T22:05:30.856+0000","updated":"2012-07-03T22:05:30.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13407172","id":"13407172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks, Kathey. I have marked this issue as needing a release note.\r\n\r\nThanks for that additional discussion, Dag. I don't see much value in building more internal support for a non-standard syntax whose use we want to discourage. The only use-case I can imagine for joining VTIs in the FROM list would be for future, internal queries involving new diagnostic VTIs. I think that a better approach to that use-case would be to design the new diagnostic VTIs in such a way that joins in the FROM list are not necessary. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-05T14:38:03.286+0000","updated":"2012-07-05T14:38:03.286+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13407217","id":"13407217","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Committed derby-5554-03-aa-forbidVTItoVTIjoins.diff at subversion revision 1357692.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-05T15:41:47.639+0000","updated":"2012-07-05T15:41:47.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13407220","id":"13407220","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Before defining what it means to join VTIs in the FROM list, it's useful to describe how the clauses in a SQL Standard query are supposed to be evaluated. The following discussion is based on these sections in part 2 of the SQL Standard:\r\n\r\no 7.13 <query expression> - This section describes a Query as a series of Selects, separated by UNION/INTERSECT operators, sorted by an ORDER BY clause, and bounded by FETCH FIRST and OFFSET clauses.\r\n\r\no 7.12 <query specification> - This section describes a Select as a SELECT list on top of a <table expression>.\r\n\r\no 7.4 <table expression> - This section describes the order of the remaining clauses: FROM, WHERE, GROUP BY, HAVING, WINDOW.\r\n\r\n1) Let Q be a query composed of a series of Selects, S1...Sn, separated by UNION/INTERSECT operators, sorted by an ORDER BY clause, and bounded by FETCH FIRST and OFFSET clauses.\r\n\r\n2) We evaluate each Select S as follows:\r\n\r\n  F = the cartesian product of all tables, joined tables, views, subqueries, and table functions in the FROM clause.\r\n\r\n  W = the result of applying the WHERE clause to F\r\n\r\n  G = the result of applying the GROUP BY clause to W\r\n\r\n  H = the result of applying the HAVING clause to G\r\n\r\n  WW = the result of applying the WINDOW clause to H\r\n\r\n  S = the result of applying the SELECT list expressions (including aggregates) to WW\r\n  \r\n3) Now we compute\r\n\r\n  U = the result of applying the UNION/INTERSECT operators to S1...Sn\r\n\r\n  O = the result of applying the ORDER BY clause to U\r\n\r\n  Q = the result of applying the FETCH FIRST and OFFSET clauses to O\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-05T15:45:37.987+0000","updated":"2012-07-05T15:45:37.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13407222","id":"13407222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Now we can give meaning to Queries which join VTI parameters to other tables in the FROM list. This involves redefining the F, W, and S expressions described above.\r\n\r\nNote that VTI arguments can mention columns in tables, joined tables, views, and subqueries. However, VTI arguments may not mention columns in table functions or other VTIs.\r\n\r\no Let V1...Vn be the VTIs which join to other elements in the FROM list.\r\n\r\no Let C be the cartesian product of all other FROM list elements.\r\n\r\no For each Vi, let Ki1...Kim be the columns in C which are mentioned by the arguments to Vi.\r\n\r\no For each Vi, construct a temporary table Ti. The columns in Ti are all of the columns in Vi followed by additional columns Ki1...Kim. For each unique key combination (Ki1, ..., Kim) found in C, insert into Ti the results of evaluating Vi by plugging Ki1...Kim into its arguments.\r\n\r\no For each Vij, add to the WHERE clause the conjunct (C.Kij = Ti.Kij). Call the resulting clause WHERE_2.\r\n\r\no Finally, we construct these new values:\r\n\r\n  F = the cartesian product of C with T1...Tn\r\n\r\n  W = the result of applying WHERE_2 to F\r\n\r\n  S = the result of applying the SELECT list to WW, throwing away all Ti.Kij columns.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-05T15:47:52.336+0000","updated":"2012-07-05T15:47:52.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13407293","id":"13407293","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching the first rev of a release note for this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-05T17:22:55.041+0000","updated":"2012-07-05T17:22:55.041+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13407394","id":"13407394","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks, Rick. My main concern was that the VT be placeable at any joinee position, your proposal handles that, so +1.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2012-07-05T18:55:30.975+0000","updated":"2012-07-05T18:55:30.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13407593","id":"13407593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Rick, thanks for adding the release note.\r\n\r\nDo you think it would be useful to include the *correct* syntax for the (invalid) query given as an example in the release note?\r\n\r\nSomething along the lines of:\r\n\r\n    Applications which rely on these forbidden joins in the FROM list must be re-coded to use legal syntax. For example, the above query should be rewritten as: ...\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2012-07-05T23:27:19.370+0000","updated":"2012-07-05T23:27:19.370+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13407961","id":"13407961","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks, Bryan. That is a good idea. Attaching a second rev of the release note. This presents a different bad query along with an example of how to re-write it so that it will compile.\r\n\r\nThe new bad query joins a user-written table function to SPACE_TABLE in the FROM list. This is the only example I could imagine for a real query which might be affected by this change. Although joins to other SYSCS_DIAG tables and table functions are now forbidden, none of those joins really make any sense to begin with; it's hard to come up with substitute, re-written queries for queries which don't have any meaning!\r\n\r\nThanks,\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-06T12:43:50.032+0000","updated":"2012-07-06T12:43:50.032+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13408471","id":"13408471","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"+1 to the revised release note.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2012-07-07T00:12:18.171+0000","updated":"2012-07-07T00:12:18.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13409730","id":"13409730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-5554-04-aa-forceVTIAfterJoin.diff. This is one approach to making Bryan's query work. Regression tests pass cleanly for me on this patch. I will also attach a second approach to fixing Bryan's query.\r\n\r\nIt appears to me that this is what is going on:\r\n\r\n1) The problem query gives rise to a query plan with the following\r\nshape:\r\n\r\n             SelectList\r\n             /\r\n           HashJoin\r\n           /          \\\r\nNestedLoop     sysconglomerates\r\n            /  \\\r\nsystables   space_table\r\n\r\n2) At run-time, we are trying to initialize space_table from the NestedLoop row rather than from systables. The insertion of the extra HashJoin should have forced a renumbering of the result set number in the systables.tablename column reference. But it didn't.\r\n\r\nThe derby-5554-04-aa-forceVTIAfterJoin.diff patch forces the VTI after all of the base tables in the join order. The VTI is then initialized from a row which has been filled in.\r\n\r\nI am not thrilled with this fix. It fiddles with the optimizer in order to work around a code-generation problem. However, I am attaching this approach as a fallback in case we find a fatal problem with a second approach which I will attach presently. The second approach is more complicated.\r\n\r\nTouches the following files:\r\n\r\n------------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/FromVTI.java\r\n\r\nIf a VTI argument refers to another element in the FROM list, then force the the VTI to follow all non-VTIs in the join order.\r\n\r\n------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/SysDiagVTIMappingTest.java\r\n\r\nAdd Bryan's query as a test case.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-09T19:00:35.909+0000","updated":"2012-07-09T19:00:35.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13409754","id":"13409754","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-5554-04-ab-remapVTIarg.diff, a second approach to fixing Bryan's query. I am running regression tests now.\r\n\r\nThe second approach code generates a reference to the result column in the SYSTABLES base table rather than to a column in a node above it. I am not thrilled by the complexity of this solution and I think that it may not be as general as the first approach of forcing the VTI to an inner slot in the join order. For instance, it may be possible to cook up elaborate queries which still fail because the VTI joins to the output of joined tables or subqueries in the FROM list.\r\n\r\nOn balance, I think this is a better approach because it fixes a code generator problem in the code generator. I'm reluctant to spend more time coming up with a better fix since we want to discourage use of this kind of join.\r\n\r\nThe fix is to have the base tables tell the VTI where their rows are. I could not find an easy way to dig up this information in the existing context available to the code generator. So I added a new method and piece of state to FromVTI for tracking this information.\r\n\r\nTouches the following files:\r\n\r\n-----------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/FromVTI.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/FromBaseTable.java\r\n\r\nBase tables give the location of their result rows to FromVTIs at code generation time.\r\n\r\n-----------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/SysDiagVTIMappingTest.java\r\n\r\nAdds Bryan's query as a test case.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-09T19:21:08.365+0000","updated":"2012-07-09T19:21:08.365+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13409775","id":"13409775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Tests passed cleanly for me on derby-5554-04-ab-remapVTIarg.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-09T19:36:22.001+0000","updated":"2012-07-09T19:36:22.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13410266","id":"13410266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"If I understand the description of the 04-ab patch, it should not be dependent on the join order. That makes me wonder from which row in the base table it reads the value that it passes as an argument to the VTI, if the VTI happens to be the outer table in the join. Will the VTI be executed just once, with the value taken from the first row in the base table? I tried to test it by forcing the join order with an optimizer override, but then I just got \"ERROR 42Y70: The user specified an illegal join order. This could be caused by a join column from an inner table being passed as a parameter to an external virtual table.\" So it may be that the optimizer knows not to use the VTI as the outer table, but it's not entirely obvious to me.\r\n\r\nI tried a variant of Bryan's original query, just with a different ordering of the FROM list, and I'm afraid I still see a NullPointerException with the 04-ab patch:\r\n\r\nij> create table t1(x int);\r\n0 rows inserted/updated/deleted\r\nij> create table t2(y int);\r\n0 rows inserted/updated/deleted\r\nij> SELECT T2.*, systabs.*, syscgs.conglomeratenumber \r\n    FROM \r\n        sys.sysconglomerates syscgs, \r\n        TABLE (SYSCS_DIAG.SPACE_TABLE(systabs.tablename)) AS T2,\r\n        SYS.SYSTABLES systabs\r\n    WHERE systabs.tabletype = 'T' and systabs.tableid = syscgs.tableid;\r\nERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression. (errorCode = 20000)\r\nERROR XJ001: Java exception: ': java.lang.NullPointerException'. (errorCode = 20000)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-07-10T11:44:03.882+0000","updated":"2012-07-10T11:44:03.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13410287","id":"13410287","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for test-driving the patch, Knut. The same query also raises an NPE with the first patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-10T12:24:22.997+0000","updated":"2012-07-10T12:24:22.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13410379","id":"13410379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-5554-04-ac-remapVTIarg.diff, a new rev of the argument-remapping approach. I am running regression tests now.\r\n\r\nThis rev is simpler than the previous attempt. It may also handle more cases than the previous patch. The patch merely touches FromVTI.\r\n\r\nTouches the following files:\r\n\r\n-----------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/FromVTI.java\r\n\r\n1) At bind-time, we save a reference to every FROM list element referenced by the VTI's arguments.\r\n\r\n2) At code-generation time, we build an argument expression from the ResultColumn actually used when the FROM list element was code generated.\r\n\r\n\r\n-----------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/SysDiagVTIMappingTest.java\r\n\r\nAdds Bryan's original query and Knut's re-ordered query as test cases.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-10T14:31:31.340+0000","updated":"2012-07-10T14:31:31.340+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13411444","id":"13411444","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks, Rick. That seems to fix all possible orderings of the from list in that query. However, I still see a NPE if I use the JOIN keyword:\r\n\r\nij> connect 'jdbc:derby:memory:db;create=true';\r\nij> create table t1(x int);\r\n0 rows inserted/updated/deleted\r\nij> create table t2(y int);\r\n0 rows inserted/updated/deleted\r\nij> select tt.* from table(syscs_diag.space_table(st.tablename)) tt join sys.systables st using(tableid);\r\nERROR 38000: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.\r\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\r\n\r\nPerhaps related, if I change the join to an outer join (doesn't matter if it's right or left join), it fails with an assert failure (or NPE with insane jars).\r\n\r\nij> select tt.* from table(syscs_diag.space_table(st.tablename)) tt right join sys.systables st using(tableid);\r\nERROR XJ001: Java exception: 'ASSERT FAILED costEstimate is not expected to be null for org.apache.derby.impl.sql.compile.FromVTI: org.apache.derby.shared.common.sanity.AssertFailure'.\r\n\r\nI do see these errors also without your patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-07-11T12:48:08.376+0000","updated":"2012-07-11T12:48:08.376+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13411490","id":"13411490","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for test-driving the derby-5554-04-ac-remapVTIarg.diff patch, Knut. My instinct is to limit support for this non-standard syntax to the cases documented in the user guides or used by our internal metadata queries. The additional cases you have discovered are probably not being stressed in the wild--at least no-one has filed a bug report for them. We could probably extrapolate a meaning for these additional queries, based on the meaning which we have given to VTI-joins in the FROM list, but I am reluctant to extend the applicability of this Derby extension unless we have to.\r\n\r\nWhat do you think about this plan:\r\n\r\n1) Commit derby-5554-04-ac-remapVTIarg.diff once we're convinced that it works for our metadata queries and for the joins documented in our user guides.\r\n\r\n2) Prepare another patch to raise an error when compiling the additional query families you have discovered.\r\n\r\nThanks,\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-11T13:35:01.022+0000","updated":"2012-07-11T13:35:01.022+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13411534","id":"13411534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"In any event, I think that we need to file a new JIRA to forbid the use of table functions in the additional query families which Knut identified. I see the same errors when I use table functions instead of diagnostic VTIs. The following script shows this:\r\n\r\nconnect 'jdbc:derby:memory:db;create=true';\r\n\r\ncreate function lowerCaseRow( contents varchar( 32672 ) )\r\nreturns table\r\n(\r\n    contents varchar( 32672 )\r\n)\r\nlanguage java parameter style DERBY_JDBC_RESULT_SET no sql\r\nexternal name 'org.apache.derbyTesting.functionTests.tests.lang.TableFunctionTest.lowerCaseRow';\r\n\r\nselect tt.* from table( lowerCaseRow(st.tablename)) tt join sys.systables st on tt.contents = st.tablename;\r\n\r\nselect tt.* from table( lowerCaseRow(st.tablename)) tt right join sys.systables st on tt.contents = st.tablename;\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-11T14:06:31.621+0000","updated":"2012-07-11T14:06:31.621+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13411676","id":"13411676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"For table functions, should those queries be rejected according to the standard?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-07-11T16:07:07.840+0000","updated":"2012-07-11T16:07:07.840+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13411682","id":"13411682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Kathey,\r\n\r\nYes, these queries are another violation of part 2 of the SQL Standard, section 7.6 (<table reference>), Syntax Rule 6.a. I have re-opened DERBY-5779 to continue the work of rejecting these violations. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-11T16:15:22.630+0000","updated":"2012-07-11T16:15:22.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13411738","id":"13411738","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Tests passed cleanly for me on derby-5554-04-ac-remapVTIarg.diff. As an incremental improvement, I have committed the patch at subversion revision 1360306.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-11T17:15:48.776+0000","updated":"2012-07-11T17:15:48.776+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13417401","id":"13417401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Resolving this issue because the work on DERBY-5779 prevents the additional bad syntax. We can re-open this issue if we discover other bad syntax.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-07-18T19:39:20.400+0000","updated":"2012-07-18T19:39:20.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536241/comment/13726762","id":"13726762","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Marking derby_backport_reject_10_8 as this issue required a release note and restricted SQL syntax. Doesn't look appropriate for backport.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-08-01T19:07:06.488+0000","updated":"2013-08-01T19:07:06.488+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-5554/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06gjj:"}}