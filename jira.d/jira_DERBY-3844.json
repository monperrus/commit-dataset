{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12402790","self":"https://issues.apache.org/jira/rest/api/latest/issue/12402790","key":"DERBY-3844","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314182","id":"12314182","description":"Old head of 10.5 branch","name":"10.5.3.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-07-03 09:59:19.549","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23873","customfield_12310222":"3_*:*_1_*:*_1125493380_*|*_1_*:*_1_*:*_46640969956_*|*_6_*:*_2_*:*_8686015202_*|*_5_*:*_1_*:*_2246898605_*|*_4_*:*_1_*:*_952481891","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-07-12T22:47:51.031+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3844/watchers","watchCount":0,"isWatching":false},"created":"2008-08-21T12:50:11.997+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12327897","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12327897","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12440282","key":"DERBY-4440","self":"https://issues.apache.org/jira/rest/api/2/issue/12440282","fields":{"summary":"Intermittent Java deadlock when running LobStreamsTest with insane jars","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12327725","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12327725","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12417271","key":"DERBY-4102","self":"https://issues.apache.org/jira/rest/api/2/issue/12417271","fields":{"summary":"Assert failure or ClassCastException in EmbedBlob when retrieving BLOB >= 32K","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12332802","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12332802","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"inwardIssue":{"id":"12468384","key":"DERBY-4728","self":"https://issues.apache.org/jira/rest/api/2/issue/12468384","fields":{"summary":"10.5 backport effort tracking issue ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-07-12T22:47:51.004+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"I saw this failure when running suites.All to test the patch nested_transaction_v2.diff which is posted on DERBY-3693. The failure did not occur when I reran the test, and I don't believe the patch should have any effect on the code that failed. The ASSERT that is triggered is this one (which indicates that we're trying to unlatch a page that's not latched):\r\n\r\n\t\tif (SanityManager.DEBUG) {\r\n\t\t\tSanityManager.ASSERT(isLatched());\r\n\t\t}\r\n\r\nHere's the full stack trace and thread dump:\r\n\r\n1) testBlobWrite3Param(org.apache.derbyTesting.functionTests.tests.jdbcapi.LobStreamsTest)org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED\r\n\tat org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:98)\r\n\tat org.apache.derby.impl.store.raw.data.BasePage.unlatch(BasePage.java:1319)\r\n\tat org.apache.derby.impl.store.raw.data.OverflowInputStream.fillByteHolder(OverflowInputStream.java:152)\r\n\tat org.apache.derby.impl.store.raw.data.BufferedByteHolderInputStream.read(BufferedByteHolderInputStream.java:44)\r\n\tat java.io.DataInputStream.read(DataInputStream.java:132)\r\n\tat org.apache.derby.impl.jdbc.PositionedStoreStream.read(PositionedStoreStream.java:106)\r\n\tat org.apache.derby.impl.jdbc.AutoPositioningStream.read(AutoPositioningStream.java:113)\r\n\tat org.apache.derby.impl.jdbc.UpdatableBlobStream.read(UpdatableBlobStream.java:194)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbcapi.LobStreamsTest.readBytesFromStream(LobStreamsTest.java:463)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbcapi.LobStreamsTest.compareLob2File(LobStreamsTest.java:488)\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbcapi.LobStreamsTest.testBlobWrite3Param(LobStreamsTest.java:130)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n---------------\r\nStack traces for all live threads:\r\nThread name=derby.antiGC id=280 priority=1 state=WAITING isdaemon=true\r\n\tjava.lang.Object.wait(Native Method)\r\n\tjava.lang.Object.wait(Object.java:485)\r\n\torg.apache.derby.impl.services.monitor.AntiGC.run(BaseMonitor.java:2217)\r\n\tjava.lang.Thread.run(Thread.java:619)\r\n\r\nThread name=Signal Dispatcher id=4 priority=9 state=RUNNABLE isdaemon=true\r\n\r\nThread name=main id=1 priority=5 state=RUNNABLE isdaemon=false\r\n\tjava.lang.Thread.dumpThreads(Native Method)\r\n\tjava.lang.Thread.getAllStackTraces(Thread.java:1477)\r\n\torg.apache.derby.shared.common.sanity.ThreadDump.getStackDumpString(ThreadDump.java:34)\r\n\tsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\torg.apache.derby.shared.common.sanity.AssertFailure$1.run(AssertFailure.java:165)\r\n\tjava.security.AccessController.doPrivileged(Native Method)\r\n\torg.apache.derby.shared.common.sanity.AssertFailure.dumpThreads(AssertFailure.java:159)\r\n\torg.apache.derby.shared.common.sanity.AssertFailure.<init>(AssertFailure.java:82)\r\n\torg.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:98)\r\n\torg.apache.derby.impl.store.raw.data.BasePage.unlatch(BasePage.java:1319)\r\n\torg.apache.derby.impl.store.raw.data.OverflowInputStream.fillByteHolder(OverflowInputStream.java:152)\r\n\torg.apache.derby.impl.store.raw.data.BufferedByteHolderInputStream.read(BufferedByteHolderInputStream.java:44)\r\n\tjava.io.DataInputStream.read(DataInputStream.java:132)\r\n\torg.apache.derby.impl.jdbc.PositionedStoreStream.read(PositionedStoreStream.java:106)\r\n\torg.apache.derby.impl.jdbc.AutoPositioningStream.read(AutoPositioningStream.java:113)\r\n\torg.apache.derby.impl.jdbc.UpdatableBlobStream.read(UpdatableBlobStream.java:194)\r\n\torg.apache.derbyTesting.functionTests.tests.jdbcapi.LobStreamsTest.readBytesFromStream(LobStreamsTest.java:463)\r\n\torg.apache.derbyTesting.functionTests.tests.jdbcapi.LobStreamsTest.compareLob2File(LobStreamsTest.java:488)\r\n\torg.apache.derbyTesting.functionTests.tests.jdbcapi.LobStreamsTest.testBlobWrite3Param(LobStreamsTest.java:130)\r\n\tsun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tsun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tsun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\torg.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:104)\r\n\tjunit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tjunit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tjunit.extensions.TestSetup.run(TestSetup.java:25)\r\n\torg.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\r\nThread name=derby.rawStoreDaemon id=941 priority=5 state=TIMED_WAITING isdaemon=true\r\n\tjava.lang.Object.wait(Native Method)\r\n\torg.apache.derby.impl.services.daemon.BasicDaemon.rest(BasicDaemon.java:571)\r\n\torg.apache.derby.impl.services.daemon.BasicDaemon.run(BasicDaemon.java:388)\r\n\tjava.lang.Thread.run(Thread.java:619)\r\n\r\nThread name=Timer-3 id=281 priority=5 state=WAITING isdaemon=true\r\n\tjava.lang.Object.wait(Native Method)\r\n\tjava.lang.Object.wait(Object.java:485)\r\n\tjava.util.TimerThread.mainLoop(Timer.java:483)\r\n\tjava.util.TimerThread.run(Timer.java:462)\r\n\r\nThread name=Finalizer id=3 priority=8 state=WAITING isdaemon=true\r\n\tjava.lang.Object.wait(Native Method)\r\n\tjava.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:116)\r\n\tjava.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:132)\r\n\tjava.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)\r\n\r\nThread name=Reference Handler id=2 priority=10 state=WAITING isdaemon=true\r\n\tjava.lang.Object.wait(Native Method)\r\n\tjava.lang.Object.wait(Object.java:485)\r\n\tjava.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)\r\n\r\nThread name=derby.rawStoreDaemon id=933 priority=5 state=TIMED_WAITING isdaemon=true\r\n\tjava.lang.Object.wait(Native Method)\r\n\torg.apache.derby.impl.services.daemon.BasicDaemon.rest(BasicDaemon.java:571)\r\n\torg.apache.derby.impl.services.daemon.BasicDaemon.run(BasicDaemon.java:388)\r\n\tjava.lang.Thread.run(Thread.java:619)\r\n\r\n\r\n---------------","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37968","summary":"ASSERT failure in BasePage.unlatch() when running LobStreamsTest","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Solaris 10, AMD Opteron with 2 CPUs, Java(TM) SE Runtime Environment (build 1.6.0_06-b02), Derby trunk revision 686755","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":20,"total":20,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12726859","id":"12726859","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Triaged July 3, 2009: Assigned normal urgency.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-07-03T09:59:19.549+0000","updated":"2009-07-03T09:59:19.549+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12779436","id":"12779436","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attaching a repro for the bug.\r\nEven though generating the junk data seems to trigger garbage collection, I added calls to do gc and finalization for good measure (I'm aware that the call to do gc may be a no-op).\r\n\r\nThe trouble in this case is the use of the pattern rs.getBlob(1).blobMethod(), followed by another operation on the same BLOB field, and combined with gc/finalization. The result set generates a new Blob object for each call to getBlob, and this object has a finalize-method closing the source stream (and unlatching the source page).\r\n\r\nWithout having studied this in detail, I think there are two main lines of fixing this:\r\n 1) Disallow calling getBlob multiple times on the same column (and the same row).\r\n 2) Make the result set smarter, or somehow make sure the source stream isn't closed too early.\r\n\r\n(1) is the simplest, but may break existing applications (including some of our own tests for sure). I have not consulted the JDBC spec on this.\r\n(2) is probably harder, may have performance impacts and we run the risk of introducing resource leaks (this may be cleaned up in commit/rollback anyway). I think it should be possible to get this right, but it will make the result set slightly fatter.\r\n\r\nThe discussion about calling various result set methods multiple times seems familiar, but I'm not sure we reached consensus the last time...\r\nThe Java SE 6 JavaDoc isn't very authoritative:\r\n\"For maximum portability, result set columns within each row should be read in left-to-right order, and each column should be read only once.\"\r\n\r\nHaving gotten this far in my post, won't this be a problem anyway if the user calls Blob.free?\r\nAssuming obtaining multiple Blob-objects for the same BLOB field is allowed, should a Blob.free affect the other \"instances\"?\r\n\r\n\r\nI fear we are about to wander off into the tall weeds, and in my opinion we should try to improve the situation such that it is clear to the user what is allowed and what isn't when it comes to LOBs and streams. I don't know how much stricter we would have to be, and I'm willing to postpone this until 11.0, but I'd rather do it earlier.\r\nI'm far from having the overview, but note that other situations get us into trouble too. We already have Jiras logged where queries like \"select blob as b1, blob as b2\"  cause errors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-11-18T13:03:46.964+0000","updated":"2009-11-18T13:03:46.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12779480","id":"12779480","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The two separate calls to getBlob() share the same underlying stream, and the finalizer for the first blob\r\nobject closes the stream out from underneath the second blob? Is that correct?\r\n\r\nCould we use a reference-counted wrapper around the stream so that each blob could record\r\nits own \"interest\" in the blob, and would know when it was the last blob to release the stream,\r\nand thus it was safe to close it?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-11-18T15:10:47.056+0000","updated":"2009-11-18T15:10:47.056+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12779935","id":"12779935","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Your understanding is correct, Bryan.\r\n\r\nSomething along the lines you describe will most probably work, but may require changes to the stream class down in store. You have one real source stream, but other streams may be \"spliced off\" from it. Add another couple of layers and you're up into the outer JDBC realm :)\r\n\r\nUnfortunately, I think we have issues we cannot address at this level. I don't have a deep enough understanding of what's going on yet, but I hope to spend some more time investigating soon.\r\nOne thing we have to do, is to agree on what is going to be allowed. From the realm of Blobs, consider these pieces of pseudo-code:\r\n\r\n1) select blob as b1, blob as b2 from blobtable\r\n\r\n2) // Pattern where the Blob references aren't kept. GC has side-effects currently.\r\n    stream = rs.getBlob(1).getBinaryStream()\r\n    length = rs.getBlob(1).length()\r\n    // Do something here, assume GC / finalization will take place.\r\n    // Now read from the stream.\r\n    stream.read(buf) // <-- fails\r\n\r\n3) Blob b1 = rs.getBlob(1)\r\n    // Process b1.\r\n    // Note sure if b2 will be invalid if b1.free() is called here, or if obtaining b2 will latch/lock the resources again.\r\n    // If you obtain b1 and b2 at the same time, and then call free on one of them, the other will be invalidated.\r\n    Blob b2 = rs.getBlob(1)\r\n    // Process b2.\r\n\r\n4) Blob b1 = rs.getBlob(1)\r\n    stream1 = b1.getBinaryStream(1024, 4096)\r\n    stream2 = b1.getBinaryStream(10240, 2048)\r\n    // Process both streams \"concurrently\"\r\n\r\n- (1) is definitely allowed by SQL. This is the simple example, a cross join is more complex and may end up referencing the same Blob multiple times (in different rows of the result).\r\n- In (2), should it be forbidden to call getBlob(1) multiple times, should we return the same Blob object, or should the two Blobs be independent on each other? This gets worse if updates come into play...\r\n- Case (3) is much like (2), but the effects on the two Blob objects are caused by explicit method calls only.\r\n- (4) adds yet another level, and here we support update-aware streams currently. In this case I believe we're talking about changes to this specific Blob-instance.\r\n\r\nI think (1) and (4) may be the more natural use-cases, whereas (2) and (3) can be categorized as corner cases (?). All issues here are related to having several handles to the same source data.\r\nWith the exception of class (1), the user can work around these issues by changing the application code (unless a framework generates / uses code that trigger these issues). The whole thing would just be simpler to deal with if there were clear rules :)\r\n\r\n\r\nRelated Jiras: DERBY-3645, DERBY-3646 and DERBY-3650 (there are probably more)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-11-19T11:04:27.685+0000","updated":"2009-11-19T11:04:27.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12805855","id":"12805855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"We should address this issue, as it is rather confusing for the user and it might also be hard to debug (timing dependent).\r\n\r\nI propose tightening the rules, such that it is only allowed to access a LOB column once (per row) with the ResultSet.get-methods. This will be very much like what we do for the getXStream-methods already.\r\nThe JDBC standard doesn't say much about this, but this sentence from the Java SE 6 API JavaDoc does apply:\r\n\"For maximum portability, result set columns within each row should be read in left-to-right order, and each column should be read only once.\"\r\nIn the list above this means that usages (2) and (3) will be disallowed.\r\n\r\nImplementing this restriction includes at least the following work:\r\n - add code to track column access (for LOB-columns) in the result set implementations\r\n - write a release note, as this change may break existing applications\r\n - rewrite a few of our tests (got 41 errors in total for suites.All, but some of these were caused by resources not being cleaned up after the first failure caused by the change)\r\n   For instance: testClobCharacterWrite1Char(org.apache.derbyTesting.functionTests.tests.jdbcapi.LobStreamsTest)java.sql.SQLException: Complex column value (stream or LOB) in result cannot be retrieved twice\r\n   In this case I just reused the message for streams and modified it to fit both. Should there be two different messages or can the example text above be improved?\r\n\r\nAs an experiment I also tried using the cloning methods added in DERBY-4520. This seemed to work, the repro passed. This suggests that we can add support for retrieving a LOB twice at a later time if we get such requests.\r\nHowever, I haven't investigated fully, and I don't know if there are situations where we have to serve data from non-store streams that aren't implementing CloneableStream.\r\n\r\nWhat do people think about the suggested restriction?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-01-28T10:07:02.088+0000","updated":"2010-01-28T10:07:02.088+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12805897","id":"12805897","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I think it sounds like a reasonable restriction to only allow LOB values to be accessed once. Failing gracefully sounds like a much better option than the current behaviour with intermittent assert failures and Java-level deadlocks. Of course, it would be nice to have a more liberal implementation, but that could be added later if someone finds it useful and feels like implementing it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-01-28T12:48:34.764+0000","updated":"2010-01-28T12:48:34.764+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12805905","id":"12805905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"> java.sql.SQLException: Complex column value (stream or LOB) in\r\n> result cannot be retrieved twice\r\n>\r\n> In this case I just reused the message for streams and modified it\r\n> to fit both. Should there be two different messages or can the\r\n> example text above be improved?\r\n\r\nI think it's fine to share the message between these two cases, since\r\nthey are so similar. I'd remove \"complex column value\", I think, and\r\njust say\r\n\r\n  Stream or LOB value cannot be retrieved more than once","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-01-28T13:01:49.836+0000","updated":"2010-01-28T13:01:49.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12832051","id":"12832051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Patch 1a disallows accessing a LOB column more than once.\r\nHigh level patch description:\r\n o modified message XCL18, and deleted all the translations of it\r\n o added DataValueDescriptor.hasStream, which makes it clearer where we actually want to fetch the stream and where we just want to check if there is a stream or not\r\n   - currently only SQLBlob and SQLClob override the default implementation\r\n o replaced several dvd.getStream() != null  with dvd.hashStream()\r\n   - as part of this I also refactored some code in  EmbedBlob\r\n o renamed variables and methods for checking if a column has already been accessed\r\n o added checks if the LOB column has already been accessed in getBlob and getBlob, both in the embedded and the client driver\r\n    - also added some more comments\r\n    - made the boolean array (columnUsedFlags_) be lazily initialized in the client driver (this included basically rewriting two small methods)\r\n o modified a few tests failing because of the new restriction\r\n o added two regression tests in LobStreamsTest\r\n\r\nI will also have to write a release note for this fix, as existing applications may be affected by it.\r\n\r\nI'm running the full regression tests now, will post the result when they're done.\r\nPatch ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-02-10T16:29:48.519+0000","updated":"2010-02-10T16:29:48.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12832895","id":"12832895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Patch 1b fixes errors in jdbcapi.ClosedObjectTest discovered when running the full regression tests by moving the call to useStreamOrLOB to after the check for if the result set is open (failed with NPE because the meta data is cleared when closing).\r\n\r\nPatch ready for review, re-running tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-02-12T08:53:48.300+0000","updated":"2010-02-12T08:53:48.300+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12833754","id":"12833754","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"I overlooked an error in the compatibility suite. Again, the JDBCDriverTest fails because it fetched LOBs several times from the same column on a single row.\r\nPatch 2a rewrites the test, basically be iterating over the different types and coercions instead of iterating over the rows. The query is executed once per check.\r\nNote that I deleted some unused methods in JDBCDriverTest. There were no comments indicating they would be useful for debugging, so I assumed they were left-overs from the test development phase.\r\n\r\nI compared the output from the original test and the new test to make sure that no tests were lost during the rewrite (to see the output you have to run with drb.tests.debug=true).\r\n\r\nPatch 1b depends on 2a to run cleanly.\r\nPatch ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-02-15T10:40:59.647+0000","updated":"2010-02-15T10:40:59.647+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12833788","id":"12833788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"First take on a release note.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-02-15T12:37:23.104+0000","updated":"2010-02-15T12:37:23.104+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12834169","id":"12834169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Committed patch 2a to trunk with revision 910481.\r\nI'll await at least one successful test run in the nightly regression test before considering committing patch 1a.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-02-16T11:30:08.613+0000","updated":"2010-02-16T11:30:08.613+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12835736","id":"12835736","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Attached patch 1c.\r\nI pulled out the cleanup code, as it just cluttered up the patch too much (will address the issue in a separate Jira).\r\n\r\nCommitted patch 1c to trunk with revision 911793.\r\n\r\nI think this concludes the code work on this issue. Feel free to review the release note.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-02-19T12:58:23.940+0000","updated":"2010-02-19T12:58:23.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12837784","id":"12837784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The release note looks good to me. (One small typo, though: Applications which obtains -> Applications which obtain)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-02-24T13:38:38.596+0000","updated":"2010-02-24T13:38:38.596+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12838252","id":"12838252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Thank you, Knut Anders.\r\n\r\nI fixed the typo and uploaded the release note again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-02-25T08:55:42.345+0000","updated":"2010-02-25T08:55:42.345+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12838264","id":"12838264","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Resolving issue.\r\n\r\nThis fix could be back-ported to 10.5 (maybe even 10.4), but that may break existing applications using get[BC]lob. The problem can / must be fixed in the application code. No changes to the Derby source code is required, but without the changes in patch 1a it is up to the application programmer to do the right thing (Derby won't scream).\r\n\r\nI'm not sure how likely it is that existing applications calling get[BC]lob multiple times work, but since the bug is timing dependent there is a slight chance.\r\nOne argument for back-porting the fix is that one of the symptoms of the underlying problem is a Java deadlock (the other is an exception being raised).\r\n\r\nPlease advice.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-02-25T09:17:55.291+0000","updated":"2010-02-25T09:17:55.291+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12838270","id":"12838270","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I think it's fine not to back-port the fix, since there's a known workaround if someone experiences the bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-02-25T09:25:28.964+0000","updated":"2010-02-25T09:25:28.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12884460","id":"12884460","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Reopen to 10.5 back port","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2010-07-01T22:13:09.091+0000","updated":"2010-07-01T22:13:09.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12887409","id":"12887409","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Assigned to myself for 10.5 backport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-07-12T16:25:39.530+0000","updated":"2010-07-12T16:25:39.530+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12402790/comment/12887574","id":"12887574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"completed 10.5 back port","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2010-07-12T22:47:50.991+0000","updated":"2010-07-12T22:47:50.991+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3844/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06v2n:"}}