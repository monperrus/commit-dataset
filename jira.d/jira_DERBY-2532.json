{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12366794","self":"https://issues.apache.org/jira/rest/api/latest/issue/12366794","key":"DERBY-2532","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314182","id":"12314182","description":"Old head of 10.5 branch","name":"10.5.3.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315343","id":"12315343","description":"Derby 10.6.2.1 Release","name":"10.6.2.1","archived":false,"released":true,"releaseDate":"2010-10-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-10-15 17:30:56.361","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23088","customfield_12310222":"3_*:*_1_*:*_45550420032_*|*_1_*:*_1_*:*_16371478725_*|*_6_*:*_1_*:*_30119_*|*_5_*:*_1_*:*_0_*|*_4_*:*_1_*:*_37625467627","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-06-04T09:56:14.157+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2532/watchers","watchCount":1,"isWatching":false},"created":"2007-04-09T05:52:57.654+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12315669","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12315669","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"32841","key":"DERBY-310","self":"https://issues.apache.org/jira/rest/api/2/issue/32841","fields":{"summary":"Document and/or change Derby client code to match behavior with Embedded driver where possible.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12315741","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12315741","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12365918","key":"DERBY-2492","self":"https://issues.apache.org/jira/rest/api/2/issue/12365918","fields":{"summary":"convert checkDataSource, checkDataSource30 and checkDriver.java to junit","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-13T21:48:17.781+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11690","id":"11690","name":"Network Client"}],"timeoriginalestimate":null,"description":"In the following scenario from converted test DataSourceTest:\r\n(non-tested code based on the test code)\r\n----------------\r\n        ClientXADataSource dsx = new ClientXADataSource();\r\n        dsx.setDatabaseName(\"tstdb\");\r\n        XAConnection xac = dsx.getXAConnection();\r\n        XAConnection xac2 = dsx.getXAConnection();\r\n        XAResource xar2 = xac2.getXAResource();\r\n        xac2.close();\r\n\r\n        // allow close on already closed XAConnection\r\n        xac2.close();\r\n        try {\r\n            xac2.getXAResource();\r\n            // Network Server does not think this is worth an exception.\r\n        } catch (SQLException sqle) {\r\n            System.out.println(\"expect a 08003 as with Embedded\");\r\n        }\r\n------------------\r\nWith DerbyNetClient, the xac2.getXAResource() does not return an SQLException.\r\n\r\nThis ought to be documented if expected, or fixed.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10363","value":"Embedded/Client difference","id":"10363"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37626","summary":"Client does not return SQLException on XAConnection.getXAResource() on a closed connection, Embedded does","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":18,"total":18,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12534906","id":"12534906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Duplicate of DERBY-1018\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-10-15T17:30:56.361+0000","updated":"2007-10-15T17:30:56.361+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12534907","id":"12534907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"accidentally closed wrong issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-10-15T17:31:26.493+0000","updated":"2007-10-15T17:31:26.493+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12650906","id":"12650906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"body":"do you think allowing a close on an already closed connection is also an issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"created":"2008-11-26T09:45:05.561+0000","updated":"2008-11-26T09:45:05.561+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12650924","id":"12650924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Calling close on a connection that has already been closed is not a problem for java.sql.Connection, according to the Java SE 6 API JavaDoc:\r\n\"Calling the method close on a Connection object that is already closed is a no-op.\"\r\n\r\nI couldn't find any other information in the JavaDoc for XAConnection or PooledConnection. I know XAConnection doesn't implement java.sql.Connection, but maybe it can be used as a guideline?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2008-11-26T10:15:49.897+0000","updated":"2008-11-26T10:15:49.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12650927","id":"12650927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"body":"as per the sourcecode of ClientXAConnection,\r\na close() call will call its super.close().\r\nie,the close() of ClientPooledConnection class.\r\nnow in CPC's close(),we check if the connection is\r\nalready closed in the log and only if the\r\nconnection is not closed already,it attempts to\r\nclose the connection.Else it simply returns.\r\n\r\nSo there is no scope of an SQL exception as \r\nstated in 2532.\r\n\r\nNow if its required that there shud be an SQLEx\r\nraised,we can simply do that by forcing an SQLEx \r\nusing the 'throw' keyword, instead of returning normally.\r\n\r\nThe current implementation of close function is\r\nas follows:\r\n\r\n\r\n\r\npublic synchronized void close() throws SQLException JavaDoc {\r\n150         try\r\n151         {\r\n152             if (logWriter_ != null) {\r\n153                 logWriter_.traceEntry(this, \"close\");\r\n154             }\r\n155\r\n156             if (logicalConnection_ != null) {\r\n157                 logicalConnection_.nullPhysicalConnection();\r\n158                 logicalConnection_ = null;\r\n159             }\r\n160\r\n161             if (physicalConnection_ == null) {\r\n162                 return;\r\n163             }\r\n164\r\n165             // Even if the physcial connection is marked closed (in the pool),\r\n166 // this will close its underlying resources.\r\n167 physicalConnection_.closeResources();\r\n168         }\r\n169         finally\r\n170         {\r\n171             physicalConnection_ = null;\r\n172         }\r\n173     }\r\n174\r\n\r\n\r\n\r\n\r\n\r\nSo a possible fix is:\r\n\r\n\r\nadd a snippet:\r\nif(logicalConnection_ == null)\r\n{\r\n\tthrow new SQLException(\"Connection already closed\");\r\n\t}\r\n\r\nas shown:\r\n\r\n\r\npublic synchronized void close() throws SQLException JavaDoc {\r\n150         try\r\n151         {\r\n152             if (logWriter_ != null) {\r\n153                 logWriter_.traceEntry(this, \"close\");\r\n154             }\r\n\t\t\r\n\t\tif(logicalConnection_ == null)\r\n\t\t{\r\n\t\t\tthrow new SQLException(\"Connection already closed\");\r\n\t\t}\r\n155\r\n156             if (logicalConnection_ != null) {\r\n157                 logicalConnection_.nullPhysicalConnection();\r\n158                 logicalConnection_ = null;\r\n159             }\r\n160\r\n161             if (physicalConnection_ == null) {\r\n162                 return;\r\n163             }\r\n164\r\n165             // Even if the physcial connection is marked closed (in the pool),\r\n166 // this will close its underlying resources.\r\n167 physicalConnection_.closeResources();\r\n168         }\r\n169         finally\r\n170         {\r\n171             physicalConnection_ = null;\r\n172         }\r\n173     }\r\n174\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"created":"2008-11-26T10:18:53.774+0000","updated":"2008-11-26T10:18:53.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12650928","id":"12650928","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"body":"And if u are interested i will attach the full source code...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"created":"2008-11-26T10:19:25.463+0000","updated":"2008-11-26T10:19:25.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12650932","id":"12650932","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"I'm confused.\r\n\r\nI thought the problem is that XAConnection.getXAResource() doesn't thrown an exception if the XAConnection is closed?\r\nAs far as I understand, it should be allowed to call XAConnection.close() several times, and doing this should not result in an exception.\r\n\r\nSo maybe adding a check to see if the connection has been closed in getXAResource would be a fix? This would match the behavior of the embedded driver.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2008-11-26T10:31:17.940+0000","updated":"2008-11-26T10:31:17.940+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12650948","id":"12650948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"body":"Exactly..i just wanted to confirm that this connection closing is not an issue..i was confused with that comment in the problem statement ( // allow close on already closed XAConnection)...\r\n\r\nAnd now about the \"XAConnection.getXAResource() doesn't thrown an exception if the XAConnection is closed\" issue:\r\n\r\n        ClientXADataSource dsx = new ClientXADataSource();\r\n        XAConnection xac = dsx.getXAConnection();\r\n\r\nHere getXAConnection returns a ClientXAConnection.The getXAResource() method is implemented as:\r\n\r\npublic XAResource JavaDoc getXAResource() throws SQLException JavaDoc {\r\n90         if (logWriter_ != null) {\r\n91             logWriter_.traceExit(this, \"getXAResource\", xares_);\r\n92         }\r\n93\r\n94         return xares_;\r\n95     }\r\n\r\nSo will it be fine if we check whether the logical connection is still alive(can be done the very same way as we did in the previous case,ie the repeated connection closing issue),and if not alive we can force an SQLE .\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"created":"2008-11-26T10:50:04.448+0000","updated":"2008-11-26T10:50:04.448+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12659041","id":"12659041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"body":"Please test this patch[ClientXAConnection.diff].It seems to resolve the issue.The change has to be made on ClientXAConnection.java\r\nI have also uploaded a java file to test the issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"created":"2008-12-24T04:59:39.576+0000","updated":"2008-12-24T05:01:17.637+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12659042","id":"12659042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"body":"This file[Simple.java] helps to test the issue","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"created":"2008-12-24T05:00:28.896+0000","updated":"2008-12-24T05:01:36.586+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12659149","id":"12659149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"checking the 'patch available' property so committers will get reminders about this patch available for review/commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2008-12-24T19:44:52.175+0000","updated":"2008-12-24T19:44:52.175+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12659574","id":"12659574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Thanks for the patch and the repro, Sabari.\r\n\r\nI had a look at the patch and have the following comments;\r\n a) There is no SQLState associated with the exception being thrown. It would be wise to use the existing framework to throw an exception with the SQLState specified by SQLState.NO_CURRENT_CONNECTION (08003). This would also match the embedded driver. You should find examples of this in the client code, otherwise just ask.\r\n\r\n b) Can you regenerate the patch using 'svn diff'? To make it easier for everyone to apply the patch, this should be done from the root directory of the source tree (i.e. /my/home/trunk).\r\n\r\n c) The community has agreed to use spaces (4) instead of tabs for indentation.\r\n\r\n d) (Tiny nit) If you want to use the full name for physicalConnection, it makes more sense to me to use 'super' instead of 'this'. What do you think?\r\n\r\nHave you run the regression tests? BTW, they do take some hours to run.\r\nI think the patch will be ready for commit when the mentioned issues have been addressed.\r\n\r\nRegards,","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2008-12-29T16:11:28.943+0000","updated":"2008-12-29T16:11:28.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12659739","id":"12659739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"body":"\r\nSure, I will do that.\r\nThanks a lot for the comment.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"created":"2008-12-30T03:24:46.993+0000","updated":"2008-12-30T03:24:46.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12660725","id":"12660725","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Reset the patch available flag, a new patch is expected.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-01-05T11:27:54.721+0000","updated":"2009-01-05T11:27:54.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12660786","id":"12660786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"body":"\r\nWill submit the new patch in a few days.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=swordfish333","name":"swordfish333","emailAddress":"swordfish1987 at iwanttobeme dot in","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sabari S Kumar","active":true},"created":"2009-01-05T15:24:46.645+0000","updated":"2009-01-05T15:24:46.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12874568","id":"12874568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Wrapped up Sabari's work in 'derby-2532-1a-getxares_on_closed_conn.diff'.\r\nsuites.All passed.\r\n\r\nPatch ready for review, will commit shortly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-06-02T12:47:29.721+0000","updated":"2010-06-02T12:47:29.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12875547","id":"12875547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Committed patch 1a to trunk with revision 951346.\r\n\r\nIf I don't get any pushback, I'll backport this simple fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-06-04T09:56:14.064+0000","updated":"2010-06-04T09:56:14.064+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12366794/comment/12878551","id":"12878551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Backported to 10.5 with revision 954426 and to 10.6 with revision 954425.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-06-14T12:27:58.063+0000","updated":"2010-06-14T12:27:58.063+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2532/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06syn:"}}