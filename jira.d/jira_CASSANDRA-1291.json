{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12469497","self":"https://issues.apache.org/jira/rest/api/latest/issue/12469497","key":"CASSANDRA-1291","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315251","id":"12315251","description":"","name":"0.7 beta 2","archived":false,"released":true,"releaseDate":"2010-10-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/5","id":"5","description":"All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.","name":"Cannot Reproduce"},"customfield_12310220":"2010-07-20 21:40:49.539","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"10002_*:*_3_*:*_421572130_*|*_1_*:*_3_*:*_790269592_*|*_5_*:*_3_*:*_84226060_*|*_4_*:*_2_*:*_2223156056","customfield_12310420":"20062","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-08-26T15:13:57.767+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1291/watchers","watchCount":2,"isWatching":false},"created":"2010-07-16T21:40:13.929+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-08-28T18:57:29.293+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"Nodetool's ring output on trunk seems to duplicate an ipaddress instead of printing them all.\r\n\r\nTo reproduce: spin up a 3 node cluster and create a keyspace, examine nodetool ring.  One ip address will show up twice, though the tokens are correctly displayed for the three machines.\r\n\r\nThis is a cosmetic error, if you call getLiveNodes via JMX you can see all three IPs.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12450924","id":"12450924","filename":"1291.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-30T22:11:53.862+0000","size":2991,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12450924/1291.txt"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"92105","summary":"nodetool ring prints incorrect IP address","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":29,"total":29,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12890466","id":"12890466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"So bug https://issues.apache.org/jira/browse/CASSANDRA-1304 has been marked duplicate of this bug.\r\n\r\nBut there is a major issue that I am seeing. The load is being divided among the nodes that are seen through nodetool ring command while some of the nodes in the cluster hardly have 2% of data. These are the nodes that are not visible through ring command.\r\n\r\nWhen I run the loadbalance command, the data gets transferred again to a node that is visible in the ring command. The nodes that are not visible in the ring command has minimal of less than 10% of data. load-balance also doesn't help in this case.\r\n\r\nThus in my cluster of 7 nodes, 3 nodes has 90$ of data and other 4 nodes has 10% of data. And when I run loadbalance data keeps getting transferred within the top 3 nodes.\r\n\r\nI am changing the priority to major. Again I am seeing this issue only with DatacenterShardStrategy.\r\n\r\nJignesh","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-07-20T21:40:49.539+0000","updated":"2010-07-20T21:40:49.539+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12890470","id":"12890470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"Also when I run loadbalancing with DatacenterShardStrategy data does get transferred to one of the node visible in the nodetool ring command in the datacenter. And once the streaming is complete, data from DC1 gets transferred to this node in DC2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-07-20T21:46:53.154+0000","updated":"2010-07-20T21:46:53.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12891669","id":"12891669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"Hello,\r\n\r\nThe problem is that in RackAwareStrategy.java and DatacenterShardStrategy.java endpoints are HashSet.\r\n\r\nChanging HashSet to LinkedHashSet will show the full ring with its load. I have tested it and works and fine.\r\n\r\nRackAwareStrategy:\r\nIndex: RackAwareStrategy.java\r\n===================================================================\r\n--- RackAwareStrategy.java      (revision 967162)\r\n+++ RackAwareStrategy.java      (working copy)\r\n@@ -23,6 +23,7 @@\r\n import java.util.ArrayList;\r\n import java.util.HashSet;\r\n import java.util.Iterator;\r\n+import java.util.LinkedHashSet;\r\n import java.util.Set;\r\n\r\n import org.apache.cassandra.config.DatabaseDescriptor;\r\n@@ -47,7 +48,7 @@\r\n     public Set<InetAddress> calculateNaturalEndpoints(Token token, TokenMetadata metadata, String table)\r\n     {\r\n         int replicas = getReplicationFactor(table);\r\n-        Set<InetAddress> endpoints = new HashSet<InetAddress>(replicas);\r\n+        Set<InetAddress> endpoints = new LinkedHashSet<InetAddress>(replicas);\r\n         ArrayList<Token> tokens = metadata.sortedTokens();\r\n\r\n\r\nDatacenterShardStrategy:\r\nIndex: DatacenterShardStrategy.java\r\n===================================================================\r\n--- DatacenterShardStrategy.java        (revision 967162)\r\n+++ DatacenterShardStrategy.java        (working copy)\r\n@@ -97,7 +97,7 @@\r\n         int totalReplicas = getReplicationFactor(table);\r\n         Map<String, Integer> remainingReplicas = new HashMap<String, Integer>(datacenters.get(table));\r\n         Map<String, Set<String>> dcUsedRacks = new HashMap<String, Set<String>>();\r\n-        Set<InetAddress> endpoints = new HashSet<InetAddress>(totalReplicas);\r\n+        Set<InetAddress> endpoints = new LinkedHashSet<InetAddress>(totalReplicas);\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-07-23T16:53:25.859+0000","updated":"2010-07-23T16:53:25.859+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12892301","id":"12892301","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"No longer reproduces on trunk for me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-26T13:06:21.893+0000","updated":"2010-07-26T13:06:21.893+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12892370","id":"12892370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"I downloaded the latest source code from trunk and I still get nodetool to print out the same node multiple times in a cluster. It misses certain nodes and instead of that, it show me the same node 3 or 4 times. I use RackAwareStrategy with 14 nodes.\r\n\r\nI am not getting any problems with the fix that I described above where I am converting HashSet to LinkedHashSet thus preserving the nodes order.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-07-26T16:58:23.940+0000","updated":"2010-07-26T16:58:46.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12892978","id":"12892978","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickmbailey","name":"nickmbailey","emailAddress":"nick at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Bailey","active":true},"body":"Do you have any moves taking place when you see this error? \r\n\r\nLooks like we include pending ranges in the output.  Pending ranges are stored in a HashMultimap which uses a Hashset to store the collection of values for each key.  Since HashSet doesn't guarantee order that could be the issue here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickmbailey","name":"nickmbailey","emailAddress":"nick at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Bailey","active":true},"created":"2010-07-27T23:07:05.287+0000","updated":"2010-07-27T23:07:05.287+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12893247","id":"12893247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"I see this error when running nodetool ring command. The same node appears multiple times and as a result when you bring up or down some nodes it gives you incorrect information. We rely on nodetool for monitoring and were hoping that the ring command shows the accurate picture of all the nodes in the cluster.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-07-28T16:59:58.727+0000","updated":"2010-07-28T16:59:58.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12893254","id":"12893254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cgist","name":"cgist","emailAddress":"christopher dot gist at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Gist","active":true},"body":"I have also observed nodetool ring reporting duplicate IPs on the latest trunk. This was with a 2 node cluster and a keyspace with RF=2 and RackUnawareStrategy. The correct IPs were reported with getLiveNodes via JMX.\r\n\r\nAfter adding a keyspace with RF=1, the output of nodetool ring is as expected with the correct IPs.\r\n\r\nI think this behaviour might be related to nodetool ring using the range of the first non-system keyspace in StorageService.getRangeToEndpointMap(null).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=cgist","name":"cgist","emailAddress":"christopher dot gist at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christopher Gist","active":true},"created":"2010-07-28T17:09:21.527+0000","updated":"2010-07-28T17:09:21.527+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12893349","id":"12893349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickmbailey","name":"nickmbailey","emailAddress":"nick at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Bailey","active":true},"body":"I believe Jignesh's change is almost certainly the problem.  It's not consistently reproduceable because it depends on the hash value of the endpoint.\r\n\r\nJignesh, you should modify RackUnawareStrategy as well and attach and submit the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickmbailey","name":"nickmbailey","emailAddress":"nick at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Bailey","active":true},"created":"2010-07-28T20:19:34.379+0000","updated":"2010-07-28T20:19:34.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12893373","id":"12893373","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"Submitting Patch for RackUnAwareStrategy. Already submitted patches for RackAwareStrategy and DatacenterShardStrategy. See above.\r\nIndex: RackUnawareStrategy.java\r\n===================================================================\r\n--- RackUnawareStrategy.java    (revision 980232)\r\n+++ RackUnawareStrategy.java    (working copy)\r\n@@ -23,6 +23,7 @@\r\n import java.util.ArrayList;\r\n import java.util.HashSet;\r\n import java.util.Iterator;\r\n+import java.util.LinkedHashSet;\r\n import java.util.Set;\r\n\r\n import org.apache.cassandra.config.DatabaseDescriptor;\r\n@@ -45,7 +46,7 @@\r\n     {\r\n         int replicas = getReplicationFactor(table);\r\n         ArrayList<Token> tokens = metadata.sortedTokens();\r\n-        Set<InetAddress> endpoints = new HashSet<InetAddress>(replicas);\r\n+        Set<InetAddress> endpoints = new LinkedHashSet<InetAddress>(replicas);\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-07-28T21:23:19.285+0000","updated":"2010-07-28T21:23:19.285+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894177","id":"12894177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Attachment with Jignesh's consolidated changes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-30T22:11:53.949+0000","updated":"2010-07-30T22:11:53.949+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894178","id":"12894178","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-30T22:17:35.630+0000","updated":"2010-07-30T22:17:35.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894269","id":"12894269","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #505 (See [http://hudson.zones.apache.org/hudson/job/Cassandra/505/])\r\n    Use LinkedHashSet in location strategies to maintain order.  Patch by Jignesh Dhruv reviewed by brandonwilliams for CASSANDRA-1291\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-07-31T12:51:01.980+0000","updated":"2010-07-31T12:51:01.980+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894310","id":"12894310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Reverted previous fix, as this doesn't solve anything when testing with RF=2.  I think Christopher's comment is correct; waiting to see what happens with CASSANDRA-1286 since it's related.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-31T20:16:56.579+0000","updated":"2010-07-31T20:16:56.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894652","id":"12894652","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arya","name":"arya","emailAddress":"goudarzi at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=arya&avatarId=15056","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=arya&avatarId=15056","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=arya&avatarId=15056","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=arya&avatarId=15056"},"displayName":"Arya Goudarzi","active":true},"body":"https://issues.apache.org/jira/browse/CASSANDRA-1341\r\n\r\nWas marked as duplicate of this issue. However my scenario is a bit different. Thought that might bring some new insight.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arya","name":"arya","emailAddress":"goudarzi at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=arya&avatarId=15056","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=arya&avatarId=15056","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=arya&avatarId=15056","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=arya&avatarId=15056"},"displayName":"Arya Goudarzi","active":true},"created":"2010-08-02T18:59:05.778+0000","updated":"2010-08-02T18:59:05.778+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894729","id":"12894729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"I can no longer reproduce this with CASSANDRA-1286 applied.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-08-02T22:13:57.690+0000","updated":"2010-08-02T22:13:57.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894738","id":"12894738","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"With the fix I suggested above, I had no isses with nodetool ring with RF=3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-08-02T22:55:32.584+0000","updated":"2010-08-02T22:55:32.584+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894772","id":"12894772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Jignesh: why should order the items are added to the Set be significant?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-08-03T01:10:31.485+0000","updated":"2010-08-03T01:10:31.485+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894810","id":"12894810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"Hi Jonathan,\r\n\r\nWhat I am seeing is that with RF=2 or more and endpoints being HashSet, displays incorrect nodes/ip in the nodetool ring command. Changing HashSet to LinkedHashSet displays ring correctly with unique ip addresses. I rely on nodetool ring command to determine what nodes are up and their load distribution.\r\nLet me know if I have not answered your question?\r\n\r\nThanks,\r\nJignesh","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-08-03T04:02:19.801+0000","updated":"2010-08-03T04:02:19.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12894938","id":"12894938","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Jignesh,\r\n\r\nThe latest trunk works for you now though, correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-08-03T17:04:32.515+0000","updated":"2010-08-03T17:04:32.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12895019","id":"12895019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"Yes it does work for me.\r\n\r\nThanks for committing the patch in.\r\n\r\nJignesh","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-08-03T20:06:11.445+0000","updated":"2010-08-03T20:06:11.445+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12895020","id":"12895020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Solved by CASSANDRA-1286","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-08-03T20:10:22.428+0000","updated":"2010-08-03T20:10:22.428+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12895043","id":"12895043","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"Oops, turns out I never reverted the patch in this ticket like I said I did.  It's reverted now, let me know if the issue reappears.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-08-03T21:22:26.551+0000","updated":"2010-08-03T21:22:26.551+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12895048","id":"12895048","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"Its not working again. nodetool is displaying wrong IP in the ring command.\r\n\r\nI see that you reverted back to use HashSet instead of LinkedHashSet and I believe that is where the problem is.\r\n\r\nI had no issues with the last svn revision, writes/reads all were working great with that revision too.\r\n\r\nReopening the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-08-03T21:34:47.549+0000","updated":"2010-08-03T21:34:47.549+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12895305","id":"12895305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"The confusing thing to me is that while I can picture situations where code assumes the first node from calculateNaturalEndpoints is special, nodetool ring doesn't hit calculateNaturalEndpoints at all [it's calculated purely from StorageService's TokenMetadata].  So I don't see how LHS vs HS should matter at all.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-08-04T16:22:50.262+0000","updated":"2010-08-04T16:22:50.262+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12895307","id":"12895307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"body":"I believe it does.\r\n\r\nI did put some debugging statements in calculateNaturalEndpoints in RackAwareStrategy before and that is when I realized that the problem is in the way endpoints are stored.\r\n\r\nSo here is my usecase:\r\nI started up a new cluster, no data has been inserted yet. I create the schema with RF=3 on one node which gets replicated on all other nodes. Now I run the nodetool ring command and I see incorrect/duplicate ips in the ring command.\r\n\r\nChanging HashSet back to LinkedHashSet does solve the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jigneshdhruv","name":"jigneshdhruv","emailAddress":"jignesh dot dhruv at cbs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jignesh Dhruv","active":true},"created":"2010-08-04T16:30:51.230+0000","updated":"2010-08-04T16:30:51.230+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12895309","id":"12895309","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I understand that HS -> LHS solves the problem for you, but if we don't understand *why* then we cannot close the bug.\r\n\r\nPlease include a stack trace (e.g. from printStackTrace) from ring to your calculateNaturalEndpoints, because I set a breakpoint there and nodetool ring is not hitting it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-08-04T16:40:17.059+0000","updated":"2010-08-04T16:40:17.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12902894","id":"12902894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Came up empty asking on IRC if anyone testing 0.7 was seeing this. Closing as cannot reproduce until someone can.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-08-26T15:13:57.728+0000","updated":"2010-08-26T15:13:57.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12469497/comment/12903874","id":"12903874","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"I tried to replicate this one more time with a keyspace at RF=2, as Christopher suggested, which had worked in the past.  It no longer works, so I think CASSANDRA-1286 solved this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-08-28T18:57:09.219+0000","updated":"2010-08-28T18:57:29.269+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1291/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g45z:"}}