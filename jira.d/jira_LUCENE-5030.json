{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12650617","self":"https://issues.apache.org/jira/rest/api/latest/issue/12650617","key":"LUCENE-5030","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324742","id":"12324742","description":"Major release after 4.4","name":"4.5","archived":false,"released":true,"releaseDate":"2013-10-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321663","id":"12321663","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-06-13 12:00:30.196","customfield_12312323":null,"customfield_12310420":"330944","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3900544582_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-07-18T14:43:11.007+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-5030/watchers","watchCount":5,"isWatching":false},"created":"2013-06-03T11:14:06.457+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"20.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324143","id":"12324143","description":"Major release after 4.2","name":"4.3","archived":false,"released":true,"releaseDate":"2013-05-05"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-05T10:19:11.614+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"There is a limitation in the current FuzzySuggester implementation: it computes edits in UTF-8 space instead of Unicode character (code point) space. \r\n\r\nThis should be fixable: we'd need to fix TokenStreamToAutomaton to work in Unicode character space, then fix FuzzySuggester to do the same steps that FuzzyQuery does: do the LevN expansion in Unicode character space, then convert that automaton to UTF-8, then intersect with the suggest FST.\r\n\r\nSee the discussion here: http://lucene.472066.n3.nabble.com/minFuzzyLength-in-FuzzySuggester-behaves-differently-for-English-and-Russian-td4067018.html#none","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10121","value":"New","id":"10121"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"331277","summary":"FuzzySuggester has to operate FSTs of Unicode-letters, not UTF-8, to work correctly for 1-byte (like English) and multi-byte (non-Latin) letters","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":59,"total":59,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13682132","id":"13682132","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I've added a test, which demonstrates the bug. I have fixed TokenStreamToAutomaton, but I have no idea, how to update AnalyzingSuggester, which wants bytes instead of chars (ints, which cannot fit a byte).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-13T11:30:53.594+0000","updated":"2013-06-13T11:30:53.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13682162","id":"13682162","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Thanks Artem!\r\n\r\nI think we need to change POS_SEP and HOLE?  256/267 are no longer safe to use?\r\n\r\nAlso, I think TokenStreamToAutomaton should operate with Unicode code points, not code units (java's char)?  Probably we should fork TS2A to a new class (TokenStreamToUnicodeAutomaton or something?).\r\n\r\nThen, in FuzzySuggester, after calling toLevenshteinAutomata and before calling FSTUtil.intersectPrefixPaths, we need to insert a call to UTF32ToUTF8().convert(automaton), just like in CompiledAutomaton.java.  That call will translate the fuzzed-up unicode Automaton into the UTF8 equivalent, and then we should be able to pass that on to intersect.\r\n\r\nAlso, I think you'll need to fix that 255 in FuzzySuggester.toLevenshteinAutomata ... in fact, just remove it, so we use the ctor that passes max unicode code point.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-13T12:00:30.196+0000","updated":"2013-06-13T12:00:30.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13685107","id":"13685107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Now all the tests pass except testRandom when preserveSep is true.\r\n\r\nMichael, can you explain me, how this preserve separator feature works?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-17T08:51:38.504+0000","updated":"2013-06-17T08:51:38.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13685469","id":"13685469","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Hmm POS_SEP and HOLE are still eating into Unicode's space (the last 2\r\ncode points)?  Maybe, we should just use Integer.MAX_VALUE and\r\nMAX_VALUE-1?\r\n\r\nIn fact I think you'll need to make POS_SEP and HOLE consistent across\r\nboth of the TS2A classes.  I think you should just define them in\r\nTokenStreamToAutomaton.java, and then reference those constants from\r\nTokenStreamToUnicodeAutomaton.java?\r\n\r\nThere's a lot of whitespace noise here ... can you remove those\r\nchanges so we can more easily see the \"real\" changes?  Thanks.\r\n\r\nThe preserveSep option means when finding a match we must \"respect\"\r\nthe boundaries between tokens.  It could be you're seeing tests fail\r\nbecause POS_SEP was different between the two classes?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-17T11:38:11.884+0000","updated":"2013-06-17T11:38:11.884+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13685481","id":"13685481","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Sorry for autoformatting, I will upload the patch without it.\r\nSince we use Integer.MAX_VALUE we do not need EscapingTokenStreamToUnicodeAutomaton any more, because the text will not have such a code point?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-17T12:07:03.893+0000","updated":"2013-06-17T12:07:03.893+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13685516","id":"13685516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"BTW, if I replace it with Integer.MAX_VALUE, UTF32ToUTF8().convert(unicodeAutomaton) will not work any more. I mean it will not convert Integer.MAX_VALUE into a sequence of bytes (it converts it into 1fff bf bf bf). So I guess, we still need EscapingTokenStreamToUnicodeAutomaton.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-17T13:02:06.053+0000","updated":"2013-06-17T13:02:06.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13685543","id":"13685543","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"the patch without autoformatting","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-17T13:21:03.717+0000","updated":"2013-06-17T13:21:03.717+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13685551","id":"13685551","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I see, the patch still has autoformatting of some spaces. Sorry, I guess I cannot stop IntelliJ IDEA doing it :(","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-17T13:30:02.623+0000","updated":"2013-06-17T13:30:02.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13685558","id":"13685558","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"with untouched trailing spaces","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-17T13:42:07.798+0000","updated":"2013-06-17T13:42:07.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13685567","id":"13685567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Oh, right, we can't just use MAX_VALUE: it must be a valid unicode char since we will send it through UTF32toUTF8.\r\n\r\nAlso, it's easiest if that char survives to UTF8 as a single byte to keep replaceSep [relatively] simple.\r\n\r\nMaybe we \"steal\" two unicode chars?  Maybe INFO_SEP (U+001F) and INFO_SEP2 (U+001E), and we document that these chars are not allowed on the input?  (We could also try, maybe later as a separate issue, to escape them when they occur, like EscapingTokenStreamToUnicodeAutomaton now does if it sees 0xFF on the input).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-17T13:55:20.640+0000","updated":"2013-06-17T13:55:20.640+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13686447","id":"13686447","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"you already have\r\nprivate static final int PAYLOAD_SEP = '\\u001f';\r\nin AnalyzingSuggester","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-18T06:50:18.084+0000","updated":"2013-06-18T06:50:18.084+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13686482","id":"13686482","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I have fixed testRandom, which repeats the logic of FuzzySuggester.\r\nNow all the tests pass.\r\nPlease, review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-18T07:58:34.592+0000","updated":"2013-06-18T07:58:34.592+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13687822","id":"13687822","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I see, that some tests in AnalyzingSuggesterTest fail, so I have to look what's wrong...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-19T10:02:53.449+0000","updated":"2013-06-19T10:02:53.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13687899","id":"13687899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"now tests in FuzzySuggesterTest and AnalyzingSuggesterTest pass, except for AnalyzingSuggesterTest.testRandom (when preserveSep = true).\r\n\r\nIf I enable VERBOSE, I see, that suggestions are correct. I guess, there is a bug in the test, but I cannot find it.\r\n\r\nCan you please review?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-19T11:54:40.362+0000","updated":"2013-06-19T11:54:40.362+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13687902","id":"13687902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"I dont think changing SEP_LABEL from a single byte to 4 bytes is necessarily a good idea.\r\n\r\nI think benchmarks (size and speed) should be run on this change before we jump into it, I'm also concerned about the determinization and shit being in the middle of an autosuggest request... this seems like it would be way way too slow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-06-19T12:04:12.264+0000","updated":"2013-06-19T12:04:12.264+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13687917","id":"13687917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Possibly we should change it to INFO_SEP2 (U+001E) as Michael suggested for TokenStreamToAutomaton?\r\nDo you like 0x10ffff and 0x10fffe separators in TokenStreamToAutomaton? Won't they slow down the process?\r\nI guess, Michael is the man, who runs benchmarks regularly? I don't know, how to do it...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-19T12:18:50.644+0000","updated":"2013-06-19T12:18:50.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13688185","id":"13688185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"The easy performance tester to run is\r\nlucene/suggest/src/test/org/apache/lucene/search/suggest/LookupBenchmarkTest.java\r\n... we should test that first I think?  I can also run one based on\r\nFreeDB ... the sources are in luceneutil\r\n(https://code.google.com/a/apache-extras.org/p/luceneutil/ ).\r\n\r\nIf the perf hit is too much then one option would be to make it\r\noptional (whether we count edits in Unicode space UTF-8 space), or\r\nmaybe just another suggester class (FuzzyUnicodeSuggester?).\r\n\r\nI think we can use INFO_SEP: yes, this is used for PAYLOAD_SEP, but\r\nthat only means the incoming surfaceForm cannot contain this char, I\r\nthink?  So ... I think we are free to use it in the analyzed form?  Or\r\ndid something go wrong when you tried?\r\n\r\nWhichever chars we use (steal), we should add checks that these chars do not\r\noccur in the input...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-19T17:28:14.918+0000","updated":"2013-06-19T17:28:14.918+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13688924","id":"13688924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I ran this command:\r\n{code}ant -Dtestcase=LookupBenchmarkTest clean test{code}\r\n\r\nand got the same results for the patched and the original version:\r\n{code}[junit4:junit4] Tests summary: 1 suite, 0 tests\r\n     [echo] 5 slowest tests:\r\n[junit4:tophints]  22.95s | org.apache.lucene.search.spell.TestSpellChecker\r\n[junit4:tophints]  22.70s | org.apache.lucene.search.suggest.analyzing.AnalyzingSuggesterTest\r\n[junit4:tophints]  15.08s | org.apache.lucene.search.suggest.fst.TestSort\r\n[junit4:tophints]  11.84s | org.apache.lucene.search.suggest.fst.FSTCompletionTest\r\n[junit4:tophints]  11.24s | org.apache.lucene.search.suggest.analyzing.FuzzySuggesterTest\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-20T06:36:35.522+0000","updated":"2013-06-20T06:36:35.522+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13689073","id":"13689073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I used INFO_SEP and INFO_SEP2 for separators and holes. All the tests pass (I have fixed AnalyzingSuggesterTest.testStolenBytes). The benchmark is improved:\r\n\r\n{code}[junit4:junit4] Suite: org.apache.lucene.search.suggest.LookupBenchmarkTest\r\n[junit4:junit4] Completed in 0.04s, 0 tests\r\n[junit4:junit4] \r\n[junit4:junit4] JVM J0:     1.64 ..     2.34 =     0.71s\r\n[junit4:junit4] Execution time total: 2.36 sec.\r\n[junit4:junit4] Tests summary: 1 suite, 0 tests\r\n     [echo] 5 slowest tests:\r\n[junit4:tophints]  22.95s | org.apache.lucene.search.spell.TestSpellChecker\r\n[junit4:tophints]  15.08s | org.apache.lucene.search.suggest.fst.TestSort\r\n[junit4:tophints]  13.41s | org.apache.lucene.search.suggest.analyzing.AnalyzingSuggesterTest\r\n[junit4:tophints]  11.84s | org.apache.lucene.search.suggest.fst.FSTCompletionTest\r\n[junit4:tophints]  10.78s | org.apache.lucene.search.suggest.analyzing.FuzzySuggesterTest\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-20T09:52:36.808+0000","updated":"2013-06-20T09:52:36.808+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13689155","id":"13689155","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Hi Artem,\r\n\r\nSorry, running the LookupBenchmarkTest is tricky ... you need to make temporary changes in 3 places.  I'm attaching a patch that should let you run it by just doing \"ant test -Dtestcase=LookupBenchmarkTest\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-20T11:22:54.702+0000","updated":"2013-06-20T11:22:54.702+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13689231","id":"13689231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"OK, in general the performance is worse twice.\r\nbefore my patch: Total time: 9 minutes 20 seconds\r\nafter my patch with INFO_SEP and INFO_SEP2: Total time: 18 minutes 31 seconds\r\n\r\nI guess, the reason is UTF32ToUTF8().convert(unicodeAutomaton), so it is better to add correct transitions on the fly... but possibly, you can postpone this for another issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-20T13:21:06.041+0000","updated":"2013-06-20T13:21:06.041+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13689269","id":"13689269","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Hmm can you post the full output of the benchmark?  It measures different things in each test case.\r\n\r\nGiven this, I guess we should make a separate fuzzy suggester class (that measures edit distance in Unicode code point space)?  Or make it a boolean option on the current class ...\r\n\r\nCan you also post your last patch (cutting over to INFO_SEP/2 for the stolen chars)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-20T14:13:26.139+0000","updated":"2013-06-20T14:13:26.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13689296","id":"13689296","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"The last patch with INFO_SEP/2 was posted today 20/Jun/13 at 10:52","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-20T14:49:12.956+0000","updated":"2013-06-20T14:49:12.956+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13689323","id":"13689323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Oh, woops, I missed it.  Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-20T15:18:00.615+0000","updated":"2013-06-20T15:18:00.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13690102","id":"13690102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I'm uploading 3 results of benchmarking:\r\n1) benchmark-old.txt - before the patch\r\n2) benchmark-INFO_SEP.txt - after the patch\r\n3) benchmark-wo_convertion.txt - after the patch, but with commented lines of convertion in several places, like\r\n{code}      //Automaton utf8lookupAutomaton = new UTF32ToUTF8().convert(lookupAutomaton);\r\n      //BasicOperations.determinize(utf8lookupAutomaton);{code}\r\nbecause they are useless for words consisting only latin letters.\r\n\r\nAs you can see the conversion takes too much time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-21T07:47:29.451+0000","updated":"2013-06-21T07:49:07.110+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13690124","id":"13690124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"OK, I will add a new option UNICODE_AWARE = 4, which will switch conversion ON.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-21T08:21:58.254+0000","updated":"2013-06-21T08:21:58.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13690183","id":"13690183","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"I'm a little confused by the results.  E.g., how come AnalyzingSuggester changes so much between old (57 kQPS) and INFO_SEP (27 kQPS) and wo_conversion (41 kQPS), at the 2-4 prefixes len?  And why are the unrelated impls (TSS, FST, WFST, Jaspell) changing so much?  Maybe this is just horrible Hotspot noise?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-21T10:30:46.437+0000","updated":"2013-06-21T10:30:46.437+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13690614","id":"13690614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Oh, duh, the conversion from Unicode -> UTF8, and the determinization, are in AnalyzingSuggester ... so it makes sense that it got slower.\r\n\r\nI agree we should add a UNICODE_AWARE option.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-21T19:15:19.022+0000","updated":"2013-06-21T19:15:19.022+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13691744","id":"13691744","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I have added UNICODE_AWARE option in Lucene and Solr. Should I create a separate Solr issue for Solr updated files or can I upload a patch for all updated files?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-24T07:10:08.560+0000","updated":"2013-06-24T07:10:08.560+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13691817","id":"13691817","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I have uploaded a lucene/solr combo patch with new UNICODE_AWARE option","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-24T09:21:17.510+0000","updated":"2013-06-24T09:21:17.510+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13693227","id":"13693227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Thanks Artem!\r\n\r\nI don't understand why we needed to change\r\nAnalyzingSuggesterTest.testStolenBytes?  That implies something is\r\nwrong w/ the escaping I think?  (Ie, results in that test should not\r\nchange whether SEP is preserved or not).  So I'm confused what\r\nchanged...\r\n\r\nAlso, I think we don't need the check for SEP_LABEL in\r\nAnalyzingSuggester.lookup (that throws IllegalArgumentException)?  (We\r\n\"escape\" this char).  But we should check for HOLE and throw\r\nIllegalArgumentException, since we don't escape it.  And could you add\r\na test confirming you get that exc if you try to add HOLE?  Thanks.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-25T18:14:29.322+0000","updated":"2013-06-25T18:14:29.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13693840","id":"13693840","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Sorry, I don't understand, why testStolenBytes worked before. I have restored it and now it fails. Can you please suggest, what wrong I did?\r\n\r\nAs I understood, if we do not preserve the separator, 1 token with a separator and 2 tokens (which is actually 1 string with a separator) equals after removing the separator in  replaceSep, so we should get 2 results instead of 1 when we do a lookup. No?\r\n\r\nI've added a test for IllegalArgumentException.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-26T08:50:56.725+0000","updated":"2013-06-26T08:50:56.725+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13693867","id":"13693867","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I have restored testStolenBytes completely and now all the tests pass (see [nonlatin_fuzzySuggester_combo2.patch|https://issues.apache.org/jira/secure/attachment/12589721/nonlatin_fuzzySuggester_combo2.patch]).\r\n\r\nBut I'm not sure, what did you mean by 0xff byte in {code}token(new BytesRef(new byte[] {0x61, (byte) 0xff, 0x61})){code}? Letter ÿ or SEP_LABEL?\r\n\r\nNow it is treated as letter ÿ, but in the previous modification of the test I treated it as SEP_LABEL.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-26T09:33:28.757+0000","updated":"2013-06-26T09:35:52.645+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13693931","id":"13693931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Hmm, testStolenBytes should be using the 0x1f byte ... the intention\r\nof the test is to ensure than an incoming token that contains\r\nSEP_LABEL still works correctly (i.e., that the escaping we do is\r\nworking).\r\n\r\nWhen I change the 0xff in the patch back to 0x1f I indeed see the\r\n(unexpected) failure without the PRESERVE_SEP option, which is curious\r\nbecause we do no escaping without PRESERVE_SEP.\r\n\r\nOK I see the issue: before, when POS_SEP was 256 and the input space\r\nwas a byte, replaceSep always worked correctly because there was no\r\nway for any byte input to be confused with POS_SEP.  But now that we\r\nare increasing the input space to all unicode chars, there is not\r\n\"safe\" value for POS_SEP.\r\n\r\nOK given all this I think we should stop trying to not-steal the byte:\r\nI think we should simply declare we steal both 0x1e and 0x1f.  This\r\nmeans we can remove the escaping code, put back your previous code\r\nthat I had asked you to remove (sorry) that threw IAE on 0x1f (and now\r\nalso 0x1e), remove testStolenBytes, and then improve your new\r\ntestIllegalLookupArgument to also verify 0x1f gets the\r\nIllegalArgumentException?\r\n\r\nAlso, we could maybe eliminate some code dup here, e.g. the two\r\ntoFiniteStrings ... maybe by having TS2A and TS2UA share a base class\r\n/ interface.  Hmm, maybe we should just merge TS2UA back into TS2A,\r\nand add a unicodeAware option to it?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-26T12:04:50.044+0000","updated":"2013-06-26T12:04:50.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13694609","id":"13694609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Done. Please, review LUCENE-5030.patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-27T10:45:09.987+0000","updated":"2013-06-27T10:45:09.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13694610","id":"13694610","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"BTW, for your {code}// TODO: is there a Reader from a CharSequence?{code} in AnalyzingSuggester.toLookupAutomaton\r\nThere is org.apache.commons.io.input.CharSequenceReader","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-06-27T10:49:58.349+0000","updated":"2013-06-27T10:49:58.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13694801","id":"13694801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Thanks Artem, new patch looks good.\r\n\r\nThanks for the tip about org.apache.commons.io.input.CharSequenceReader!  I'll update the TODO with this information, but I don't think we should pull in a dep on commons for this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-06-27T15:36:43.328+0000","updated":"2013-06-27T15:36:43.328+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13697173","id":"13697173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"I plan to commit the last patch soon ... thanks Artem!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-01T21:03:02.225+0000","updated":"2013-07-01T21:03:02.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13697537","id":"13697537","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Cool!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-02T05:55:07.595+0000","updated":"2013-07-02T05:55:07.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13697704","id":"13697704","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"{noformat}\r\n+  /** Include this flag in the options parameter to {@link\r\n+   *  #AnalyzingSuggester(Analyzer,Analyzer,int,int,int)} if\r\n+   *  you want your suggester to operate non-ASCII letters. */\r\n+  public static final int UNICODE_AWARE = 4;\r\n{noformat}\r\n\r\nErrr... this implies that there is something wrong with AnalyzingSuggester, or that this option actually *even does anything at all* for AnalyzingSuggester, when in fact it only changes the behavior of FuzzySuggester.\r\n\r\nCan we fix this?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2013-07-02T11:43:24.315+0000","updated":"2013-07-02T11:43:24.315+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13697778","id":"13697778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"The javadocs are fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-02T13:25:41.639+0000","updated":"2013-07-02T13:25:41.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13698951","id":"13698951","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Maybe we should rename UNICODE_AWARE to FUZZY_UNICODE_AWARE?  (Because AnalyzingSuggester itself is already unicode aware... so this flag only impacts FuzzySuggester.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-03T13:27:02.954+0000","updated":"2013-07-03T13:27:02.954+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13699074","id":"13699074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Hmm also \"ant precommit\" is failing ...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-03T15:16:14.400+0000","updated":"2013-07-03T15:16:14.400+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13699304","id":"13699304","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"in ant precommit I get this error:\r\nextra-target.xml:68: javax.script.ScriptException: javax.script.ScriptException: org.tmatesoft.svn.core.SVNException: svn: E155007: 'lucene-solr' is not a working copy\r\n\r\nI use git, not SVN, so I'm a bit confused...\r\n\r\nWhat error do you get?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-03T18:44:20.950+0000","updated":"2013-07-03T18:44:20.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13699329","id":"13699329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"OK no problem, I can fix it.  The javadocs linter is angry that isUnicodeAware has no text (only an @return) ...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-03T19:04:01.411+0000","updated":"2013-07-03T19:04:01.411+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13699443","id":"13699443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"New patch, fixing the linter error, renaming UNICODE_AWARE -> FUZZY_UNICODE_AWARE, and fixing one compilation warning ... I think it's ready.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-03T21:06:17.322+0000","updated":"2013-07-03T21:06:17.322+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13699812","id":"13699812","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"I have renamed the variables in comments and tests for consistency","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-04T07:05:18.760+0000","updated":"2013-07-04T07:05:18.760+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13709695","id":"13709695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Sorry for the long delay here ...\r\n\r\nJust to verify: there is no point to passing FUZZY_UNICODE_AWARE to AnalyzingSuggester, right?\r\n\r\nIn which case, I think we the AnalyzingLookupFactory should not be changed?\r\n\r\nBut, furthermore, I think we can isolate the changes to FuzzySuggester?  E.g., move the FUZZY_UNICODE_AWARE flag down to FuzzySuggester, fix its ctor to strip that option when calling super() and move the isFuzzyUnicodeAware down as well, and then override toLookupAutomaton to do the utf8 conversion + det?\r\n\r\nThis way it's not even possible to send the fuzzy flag to AnalyzingSuggester.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-16T11:55:41.465+0000","updated":"2013-07-16T11:55:41.465+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13710797","id":"13710797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Then I have to override (and copy a lot of code) getTokenStreamToAutomaton, lookup, toFiniteStrings and make a lot of private variables protected.\r\nI think, this is not a good idea.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-17T06:44:39.342+0000","updated":"2013-07-17T06:44:39.342+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13710830","id":"13710830","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Moved the parameter from AnalyzingLookupFactory to FuzzyLookupFactory","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-17T07:49:45.685+0000","updated":"2013-07-17T07:49:45.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13710889","id":"13710889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Michael, I got your idea. I will refactor the code not to use FUZZY_UNICODE_AWARE in AnalyzingSuggester.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-17T09:06:06.439+0000","updated":"2013-07-17T09:06:06.439+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13710905","id":"13710905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"The code is refactored not to touch AnalyzingSuggester. Please, review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-17T09:44:14.001+0000","updated":"2013-07-17T09:44:14.001+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13711050","id":"13711050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Patch looks great!  Thanks Artem.  No more mixing in of fuzzy-ness\r\ninto AnalyzingSuggester.\r\n\r\nIt looks like we are doing the utf8 conversion + det twice per lookup,\r\nonce in convertAutomaton and once in getFullPrefixPaths.  But, I think\r\nthis is inevitable: the first conversion is on the \"straight\"\r\nautomaton, for exactFirst match, and the second one is on the lev\r\nautomaton, for non-exactFirst.\r\n\r\nReally we should only do the first convertAutomaton if exactFirst is\r\ntrue ... but this is an optimization so we don't need to fix it now.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-17T13:08:17.069+0000","updated":"2013-07-17T13:08:17.069+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13712377","id":"13712377","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1504490 from [~mikemccand] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1504490 ]\r\n\r\nLUCENE-5030: FuzzySuggester can optionally measure edits in Unicode code points instead of UTF8 bytes","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-18T14:36:35.380+0000","updated":"2013-07-18T14:36:35.380+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13712380","id":"13712380","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1504492 from [~mikemccand] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1504492 ]\r\n\r\nLUCENE-5030: FuzzySuggester can optionally measure edits in Unicode code points instead of UTF8 bytes","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-18T14:42:10.311+0000","updated":"2013-07-18T14:42:10.311+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13712381","id":"13712381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"OK I committed the last patch with a few small fixes:\r\n\r\n  * Added @lucene.experimental to FuzzySuggester\r\n\r\n  * Removed the added ctor (so we have just two ctors: the easy one,\r\n    which uses all defaults, and the expert one, where you specify\r\n    everything)\r\n\r\n  * Removed System.out.printlns from the test\r\n\r\nThanks Artem!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-18T14:43:11.029+0000","updated":"2013-07-18T14:43:11.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13712408","id":"13712408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"JUHUUUU! :-) Thanks for heavy committing - it took a long time, but now it is good! Many thanks, Uwe","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-07-18T15:21:12.962+0000","updated":"2013-07-18T15:21:12.962+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13712488","id":"13712488","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"body":"Great! Thanks for reviewing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=alukanin","name":"alukanin","emailAddress":"ice_lc at mail dot ru","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Artem Lukanin","active":true},"created":"2013-07-18T16:57:09.578+0000","updated":"2013-07-18T16:57:09.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12650617/comment/13787095","id":"13787095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpountz","name":"jpountz","emailAddress":"jpountz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jpountz&avatarId=16520","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jpountz&avatarId=16520","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jpountz&avatarId=16520","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jpountz&avatarId=16520"},"displayName":"Adrien Grand","active":true},"body":"4.5 release -> bulk close","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpountz","name":"jpountz","emailAddress":"jpountz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jpountz&avatarId=16520","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jpountz&avatarId=16520","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jpountz&avatarId=16520","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jpountz&avatarId=16520"},"displayName":"Adrien Grand","active":true},"created":"2013-10-05T10:19:11.605+0000","updated":"2013-10-05T10:19:11.605+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-5030/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1l3ev:"}}