{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12464558","self":"https://issues.apache.org/jira/rest/api/latest/issue/12464558","key":"CASSANDRA-1093","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315173","id":"12315173","description":"","name":"0.6.4","archived":false,"released":true,"releaseDate":"2010-07-31"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-05-15 23:56:50.479","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"10002_*:*_1_*:*_599079121_*|*_1_*:*_1_*:*_2163292150_*|*_5_*:*_2_*:*_3027712026_*|*_4_*:*_1_*:*_497548584","customfield_12310420":"19989","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-07-26T14:47:20.536+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1093/watchers","watchCount":4,"isWatching":false},"created":"2010-05-14T20:13:28.655+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-07-26T14:47:20.525+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"I've been attempting to use the Binary Memtable (BMT) interface to load a large number of rows. During my testing, I discovered that on larger loads (~1 million rows), occasionally some of the data never appears in the database. This happens in a non-deterministic manner, as sometimes all the data loads fine, and other times a significant chunk goes missing. No errors are ever logged to indicate a problem. I'm attaching some sample code that approximates my application's usage of Cassandra and explains this bug in more detail.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12449452","id":"12449452","filename":"1093.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-14T13:42:58.005+0000","size":3104,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12449452/1093.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12444527","id":"12444527","filename":"cassandra_bmt_test.tar.gz","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"created":"2010-05-14T20:14:38.665+0000","size":10988,"mimeType":"application/x-gzip","content":"https://issues.apache.org/jira/secure/attachment/12444527/cassandra_bmt_test.tar.gz"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"91909","summary":"BinaryMemtable interface silently dropping data.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":"Linux Centos5, Fedora Core 4. Java HotSpot Server 1.6.0_14. See readme for more details.","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":19,"total":19,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12867656","id":"12867656","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"body":"Sample code and instructions for how to run. See readme.txt in the archive.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"created":"2010-05-14T20:14:38.758+0000","updated":"2010-05-14T20:14:38.758+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12867933","id":"12867933","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"body":"I've never seen this happen and I've done many imports. At the very end of the import, are you calling nodetool flush <Keyspace> ? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"created":"2010-05-15T23:56:50.479+0000","updated":"2010-05-15T23:56:50.479+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12867952","id":"12867952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"body":"Tonight I imported 1M rows and verified all rows existed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lenn0x","name":"lenn0x","emailAddress":"cg at chrisgoffinet dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chris Goffinet","active":true},"created":"2010-05-16T05:10:51.075+0000","updated":"2010-05-16T05:10:51.075+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12867953","id":"12867953","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"body":"Yes, I'm flushing each node after the import. I've also tried flushing the system keyspace (no effect). As noted in the readme, I would not be surprised if this problem is unique to my hardware/software configuration and isn't an inherent problem with Cassandra's BMT interface.\r\n\r\nFor what it's worth, I've hacked together a \"workaround\" for this problem by writing SSTables directly (using o.a.c.io.SSTableWriter), copying the generated files to appropriate directories on the nodes, and then restarting the nodes. This solution is bound to result in other bugs, but for now I've verified that there is no lost data with this method.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"created":"2010-05-16T05:16:50.976+0000","updated":"2010-05-16T05:16:50.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12873042","id":"12873042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"can you reproduce using Toby's code, Brandon?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-05-28T16:33:32.387+0000","updated":"2010-05-28T16:33:32.387+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12873104","id":"12873104","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"I can't get it past the generate step without an OOM:\r\n\r\n\r\ncassandra_bmt_test# java -jar -Xmx4096m build/cassandra-bmt-test.jar generate foo 1000000\r\nGenerating data...\r\nException in thread \"main\" java.lang.OutOfMemoryError: Java heap space\r\n        at java.util.ArrayList.<init>(ArrayList.java:132)\r\n        at java.util.ArrayList.<init>(ArrayList.java:139)\r\n        at CassandraBMTTest.generateData(Unknown Source)\r\n        at CassandraBMTTest.main(Unknown Source)\r\n\r\nI'm going to try with < 1M and see if that works.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-05-28T18:46:41.882+0000","updated":"2010-05-28T18:46:41.882+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12873115","id":"12873115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"body":"I've been able to observe the error with a generate parameter of 25,000. Note that the generate step creates the entire randomized data set in memory before writing it to disk, so this test is limited by memory. With a parameter of 25,000 I ran fine with 512MB of heap space, at 100,000 I'd expect you to need around 2GB of heap space. \r\n\r\nThe parameter for the generate step corresponds to a \"document\", and each document results in roughly 100 rows.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"created":"2010-05-28T19:03:40.332+0000","updated":"2010-05-28T19:03:40.332+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12873135","id":"12873135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"I used 100K \"documents\":\r\n\r\nProcessed 4547169 values.\r\nDone.\r\n        Missing documents: 0\r\n        Mismatched documents: 0\r\n        Missing index entries: 0\r\n        Wrong-sized index entries: 0\r\n        Mismatched index entries: 0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-05-28T20:17:09.621+0000","updated":"2010-05-28T20:17:09.621+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12873139","id":"12873139","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"body":"Looks like everything passed. You may want to re-run from start to finish one or two more times (my error didn't occur consistently), but if it still passes at that point then close this issue as CannotReproduce and I'll attribute the problem to my hardware setup. As mentioned I've found somewhat of a workaround. I'll gladly donate my test code as a possible unit test for BMT if needed. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"created":"2010-05-28T20:24:24.400+0000","updated":"2010-05-28T20:24:41.478+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12873156","id":"12873156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"I did another 100K run and it passed:\r\n\r\n\r\nProcessed 4547169 values.\r\nDone.\r\n        Missing documents: 0\r\n        Mismatched documents: 0\r\n        Missing index entries: 0\r\n        Wrong-sized index entries: 0\r\n        Mismatched index entries: 0\r\n\r\nIs it possible you aren't waiting long enough for the flush to complete? (nodetool doesn't block on the flush command, you have to watch the system.log)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-05-28T21:38:51.490+0000","updated":"2010-05-28T21:38:51.490+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12873173","id":"12873173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"body":"Yep, I'm waiting until I see the flush message in the log. It reads something like \"BinaryMemtable@7a82b flushed to disk\".\r\n\r\nOne thing I'm thinking may be causing problems is my nodes being out of sync time-wise. I'll have to verify their clocks, but is it possible that if the clocks differ significantly that values get lost?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"created":"2010-05-28T22:55:13.379+0000","updated":"2010-05-28T22:55:13.379+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12875700","id":"12875700","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"No, that shouldn't happen since the timestamps for columns are supplied by the client.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-06-04T18:42:14.476+0000","updated":"2010-06-04T18:42:14.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12887832","id":"12887832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"BMT is a very fire-and-forget api, so any failure condition will cause messages to be dropped with no way of knowing.\r\n\r\nProbably the most likely one is, under heavy load (network and/or cpu) it's reasonably common for one node in the cluster to be marked \"down\" incorrectly by other nodes in the cluster.  This causes any messages on the MessagingService queue to that node to be dropped summarily, and the pool connection to be re-attempted when the failure detector believes it is \"up\" again.  (See OutboundTcpConnectionPool.reset)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-13T16:33:18.879+0000","updated":"2010-07-13T16:33:18.879+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12887980","id":"12887980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"body":"Thanks for the insight Jonathan. That was my intuition as well, and I observed my cluster periodically marking nodes as down for a second or two. I figured it was random network hiccups, since our network hardware is rather old. It would make sense that these periodic interruptions caused the BMT to lose data.\r\n\r\nWhile looking through the code, I did try to see if I could use BMT with the blocking MessagingService API (in the way the Thrift API works unless ConsistencyLevel.ZERO is specified), but it looks like BMT is hardcoded to be asynchronous. It might be nice for that option to be there, but since this issue appears to only affect me (and I no longer need to use BMT for my purposes), it's a super-low priority suggestion.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"created":"2010-07-13T20:19:24.731+0000","updated":"2010-07-13T20:19:24.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12887991","id":"12887991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"body":"If it is a node is being errantly marked down, in 0.6.3 or later you can try increasing the PhiConvictThreshold configuration directive and see if that helps.  EC2 users are setting it to 10 or 11, 8 is the default.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=brandon.williams","name":"brandon.williams","emailAddress":"driftx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=brandon.williams&avatarId=10054","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=brandon.williams&avatarId=10054","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=brandon.williams&avatarId=10054","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=brandon.williams&avatarId=10054"},"displayName":"Brandon Williams","active":true},"created":"2010-07-13T20:35:42.537+0000","updated":"2010-07-13T20:35:42.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12888047","id":"12888047","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"As it happens, Riptano has a client that is running into this too, so I'll take a stab at fixing it. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-13T22:10:12.815+0000","updated":"2010-07-13T22:10:12.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12888331","id":"12888331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"patch to add response from BinaryVerbHandler, and updates bmt_example to use sendRR","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-14T13:42:58.076+0000","updated":"2010-07-14T13:42:58.076+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12891909","id":"12891909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"body":"Applied and tested the patch, appears to solve the problem. Haven't run multiple tests yet to make sure, but looks good so far. Obviously, this slows down the write, but that's an acceptable loss. It's likely still faster and more efficient than using the thrift API.\r\n\r\nI'll be out of my office for the next three weeks, but I'll try to test more when I get back. Feel free to mark as resolved in the mean time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tjungen","name":"tjungen","emailAddress":"tobias dot jungen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Toby Jungen","active":true},"created":"2010-07-24T02:18:33.134+0000","updated":"2010-07-24T02:18:33.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12464558/comment/12892325","id":"12892325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed, with additional note that wait-for-acks can reduce throughput","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-07-26T14:47:20.504+0000","updated":"2010-07-26T14:47:20.504+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1093/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g2yf:"}}