{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12519051","self":"https://issues.apache.org/jira/rest/api/latest/issue/12519051","key":"MAHOUT-788","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310751","id":"12310751","key":"MAHOUT","name":"Mahout","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310751&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310751&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310751&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310751&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13060","id":"13060","description":"Apache Mahout","name":"Mahout"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316364","id":"12316364","description":"","name":"0.6","archived":false,"released":true,"releaseDate":"2012-02-06"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-08-17 03:19:04.503","customfield_12312323":null,"customfield_12310420":"9274","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_41297840_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-08-17T09:32:11.316+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-788/watchers","watchCount":0,"isWatching":false},"created":"2011-08-16T22:03:53.489+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.png","name":"Trivial","id":"5"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":1800,"aggregatetimeoriginalestimate":1800,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316364","id":"12316364","description":"","name":"0.6","archived":false,"released":true,"releaseDate":"2012-02-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srowen","name":"srowen","emailAddress":"srowen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srowen&avatarId=10104","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srowen&avatarId=10104","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srowen&avatarId=10104","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srowen&avatarId=10104"},"displayName":"Sean Owen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-02-09T14:00:47.469+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312151","id":"12312151","name":"Clustering","description":"Bugs related to any of the clustering packages"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12313154","id":"12313154","name":"Integration"}],"timeoriginalestimate":1800,"description":"ClusterDumper utility never calls flush on the OutputStreamWriter.  As of issue https://issues.apache.org/jira/browse/MAHOUT-679, the output stream is never being closed when it defaults to System.out -- while that's a good thing, it would be nice to flush the stream before exiting the program.  As is, when I run cluster dumper with the -b (substring) option set to something like 50, the stream never gets big enough to overflow the default buffer on my machine, so I see no output.  Even when it does get big enough to overflow the buffer, I still miss the last cluster's summary.  When the output is written to a file, the close() method usually flushes the buffer by default, but it shouldn't hurt to call the flush method either way -- therefore I'd suggest adding in an unconditional call to writer.flush(); in the finally block just before conditionally closing the writer. (line 199 in the org.apache.mahout.utils.clustering.ClusterDumper.run(String[] args) method)\r\n\r\n    } finally {\r\n      writer.flush();\r\n      if (shouldClose) {\r\n        Closeables.closeQuietly(writer);\r\n      }\r\n    }\r\n","customfield_10010":null,"timetracking":{"originalEstimate":"0.5h","remainingEstimate":"0.5h","originalEstimateSeconds":1800,"remainingEstimateSeconds":1800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":1800,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"22633","summary":"ClusterDumper is never flushing output stream","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dscheffy","name":"dscheffy","emailAddress":"dscheffy at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hansen","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dscheffy","name":"dscheffy","emailAddress":"dscheffy at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hansen","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":1800,"percent":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":1800,"percent":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519051/comment/13086099","id":"13086099","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","emailAddress":"lance dot norskog at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true},"body":"A finally clause can throw exceptions in the middle.\r\n\r\n{code}\r\nfinally {\r\n    try { writer.flush(); } catch (Throwable e) {;}\r\n    if (shouldClose) {\r\n        Closeables.closeQuietly(writer);\r\n    }\r\n}\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lancenorskog","name":"lancenorskog","emailAddress":"lance dot norskog at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lance Norskog","active":true},"created":"2011-08-17T03:19:04.503+0000","updated":"2011-08-17T03:19:04.503+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519051/comment/13086101","id":"13086101","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","emailAddress":"ted dot dunning at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true},"body":"Lance,\r\n\r\nThat idiom is hideous.  catch Throwable is almost always a bug.\r\n\r\nBetter by far to say\r\n\r\n{code}\r\n   try {\r\n      ... stuff ...\r\n   } finally {\r\n     try {\r\n       writer.flush();\r\n     } finally {\r\n       if (shouldClose) {\r\n         Closeables.closeQuietly(writer);\r\n       }\r\n     }\r\n{code}\r\n\r\nPushing the flush into the first try clause might be reasonable as well.  If the first part blows out, we don't much care if we flush all data (that might be wrong anyway), but we probably do care to close files.  Thus,\r\n\r\n{code}\r\n   try {\r\n     ... stuff ...\r\n     writer.flush();\r\n   } finally {\r\n     if (shouldClose) {\r\n       Closeables.closeQuietly(writer);\r\n     }\r\n   }\r\n{code}\r\nmight be a better form all round.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","emailAddress":"ted dot dunning at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true},"created":"2011-08-17T03:26:28.324+0000","updated":"2011-08-17T03:26:28.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519051/comment/13086215","id":"13086215","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srowen","name":"srowen","emailAddress":"srowen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srowen&avatarId=10104","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srowen&avatarId=10104","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srowen&avatarId=10104","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srowen&avatarId=10104"},"displayName":"Sean Owen","active":true},"body":"I agree with flush()-ing within the main block. That smells better to me and also still addresses the reported issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=srowen","name":"srowen","emailAddress":"srowen at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=srowen&avatarId=10104","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=srowen&avatarId=10104","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=srowen&avatarId=10104","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=srowen&avatarId=10104"},"displayName":"Sean Owen","active":true},"created":"2011-08-17T09:32:11.324+0000","updated":"2011-08-17T09:32:11.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519051/comment/13086262","id":"13086262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #990 (See [https://builds.apache.org/job/Mahout-Quality/990/])\r\n    MAHOUT-788 flush writer before close\r\n\r\nsrowen : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1158594\r\nFiles : \r\n* /mahout/trunk/integration/src/main/java/org/apache/mahout/utils/clustering/ClusterDumper.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-08-17T12:27:35.755+0000","updated":"2011-08-17T12:27:35.755+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12519051/comment/13086359","id":"13086359","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dscheffy","name":"dscheffy","emailAddress":"dscheffy at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hansen","active":true},"body":"By the way, the bug fix that initiated this behavior (https://issues.apache.org/jira/browse/MAHOUT-679) also applies to SequenceFileDumper and VectorDumper, but was never fixed there (so the output is being flushed when the stream is unconditionally closed).  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dscheffy","name":"dscheffy","emailAddress":"dscheffy at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeff Hansen","active":true},"created":"2011-08-17T14:49:13.679+0000","updated":"2011-08-17T14:49:13.679+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-788/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i048fz:"}}