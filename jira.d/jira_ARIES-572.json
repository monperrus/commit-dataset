{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12498221","self":"https://issues.apache.org/jira/rest/api/latest/issue/12498221","key":"ARIES-572","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319178","id":"12319178","name":"jndi.core-0.3.1","archived":true,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12319181","id":"12319181","name":"jndi uber bundle 0.3.1","archived":true,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":null,"customfield_12312323":null,"customfield_12310420":"66909","customfield_12312320":null,"customfield_12310222":"3_*:*_1_*:*_117267_*|*_1_*:*_1_*:*_14368444937_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-07-26T17:37:35.776+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-572/watchers","watchCount":0,"isWatching":false},"created":"2011-02-10T10:21:33.598+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315310","id":"12315310","description":"","name":"0.3","archived":true,"released":true,"releaseDate":"2011-02-08"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316139","id":"12316139","description":"","name":"0.4","archived":true,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=not","name":"not","emailAddress":"not at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=not&avatarId=10384","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=not&avatarId=10384","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=not&avatarId=10384","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=not&avatarId=10384"},"displayName":"Alasdair Nottingham","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-12-05T11:31:50.435+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313070","id":"12313070","name":"JNDI"}],"timeoriginalestimate":null,"description":"I get a NamingException with the following bundle activator if aries-jndi is present (I tried the current 0.4-SNAPSOT and 0.3):\r\n\r\npublic class Activator implements BundleActivator {\r\n\r\n\t@Override\r\n\tpublic void start(BundleContext bundleContext) throws Exception {\r\n\t\tMap<String, Object> env = new HashMap<String, Object>();\r\n\t\tenv.put(\"osgi.service.jndi.bundleContext\", bundleContext);\r\n\t\tJMXConnectorFactory.connect(new JMXServiceURL(\"service:jmx:rmi:///jndi/rmi://localhost:1717/jmxrmi\"), env);\r\n\t}\r\n\r\n\t@Override\r\n\tpublic void stop(BundleContext arg0) throws Exception {\r\n\t}\r\n}\r\n\r\nThe bundle context in the environment is necessary to work around another issue.\r\n\r\nThe NamingException is thrown by com.sun.jndi.url.rmi.rmiURLContextFactory.getObjectInstance() if the first parameter is not an URL. This method is called from org.apache.aries.jndi.ObjectFactoryHelper.getObjectInstanceUsingObjectFactories(). This method iterates over all registered ObjectFactories to check if there is a better implementation than the one provided in the first argument, however if it comes to Sun's object factory the NamingException occurs (and will be propagated upwards) even though the proxy object that is already there is actually fine.\r\n\r\nTherefore I would propose the following change:\r\nIndex: src/main/java/org/apache/aries/jndi/ObjectFactoryHelper.java\r\n===================================================================\r\n--- src/main/java/org/apache/aries/jndi/ObjectFactoryHelper.java\t(revision 1068918)\r\n+++ src/main/java/org/apache/aries/jndi/ObjectFactoryHelper.java\t(working copy)\r\n@@ -115,6 +115,7 @@\r\n \r\n                     try {\r\n                         result = factory.getObjectInstance(obj, name, nameCtx, environment);\r\n+                    } catch (NamingException e) {\r\n                     } finally {\r\n                         callerContext.ungetService(ref);\r\n                     }\r\n\r\nThe empty catch block is needed because obviously some ObjectFactories throw a NamingException instead of returning null in some circumstances.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"166270","summary":"NamingException in JMXConnectionFactory.connect() calls with JMX over RMI calls","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=siano","name":"siano","emailAddress":"stephan dot siano at sap dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephan Siano","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=siano","name":"siano","emailAddress":"stephan dot siano at sap dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephan Siano","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":2,"total":2,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12498221/comment/12993485","id":"12993485","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=siano","name":"siano","emailAddress":"stephan dot siano at sap dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephan Siano","active":true},"body":"After giving the issue another thought and consulting the javax.spi.naming.ObjectFactory javadoc I guess that the code should not only catch NamingException but all Exceptions and do a break as the exception handler, because the javadoc says:\r\n\"Throws: Exception - if this object factory encountered an exception while attempting to create an object, and no other object factories are to be tried.\". At least the code cannot rely on the implementation just returning null because \"If obj is of any other type [than null, an URL or an array of URL objects], the behavior of getObjectInstance() is determined by the context factory implementation. \", so it is probably legal to throw an exception here as the com.sun.jndi.url.rmi.rmiURLContextFactory does.\r\n\r\nI still don't understand why the ObjectFactoryHelper.getObjectInstance() gets called at all with a valid RMI proxy instance as the first parameter, but if the Exception is caught the code will proceed with the instance it already has, which works fine.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=siano","name":"siano","emailAddress":"stephan dot siano at sap dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephan Siano","active":true},"created":"2011-02-11T13:38:10.357+0000","updated":"2011-02-11T13:38:10.357+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12498221/comment/13000245","id":"13000245","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=siano","name":"siano","emailAddress":"stephan dot siano at sap dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephan Siano","active":true},"body":"getObjectInstanceUsingObjectFactoryBuilders() is using a similar construction, so I attach a patch here","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=siano","name":"siano","emailAddress":"stephan dot siano at sap dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Stephan Siano","active":true},"created":"2011-02-28T11:53:45.935+0000","updated":"2011-02-28T11:53:45.935+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-572/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0stl3:"}}