{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12465506","self":"https://issues.apache.org/jira/rest/api/latest/issue/12465506","key":"DERBY-4679","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315436","id":"12315436","description":"Head of 10.5 branch - version bump for DERBY-4835","name":"10.5.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315343","id":"12315343","description":"Derby 10.6.2.1 Release","name":"10.6.2.1","archived":false,"released":true,"releaseDate":"2010-10-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315564","id":"12315564","description":"First release on the 10.7 branch.","name":"10.7.1.1","archived":false,"released":true,"releaseDate":"2010-12-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-05-27 11:10:35.273","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24406","customfield_12310222":"1_*:*_1_*:*_2834729485_*|*_6_*:*_1_*:*_18947029235_*|*_5_*:*_2_*:*_795314_*|*_4_*:*_1_*:*_1144486223","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-02-16T05:35:05.865+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4679/watchers","watchCount":1,"isWatching":false},"created":"2010-05-26T20:57:45.698+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"20.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10991","id":"10991","description":"snapshot","name":"10.0.2.1","archived":false,"released":true,"releaseDate":"2004-12-06"},{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312027","id":"12312027","description":"","name":"10.2.2.0","archived":false,"released":true,"releaseDate":"2006-12-19"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313142","id":"12313142","description":"","name":"10.3.3.0","archived":false,"released":true,"releaseDate":"2008-05-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314116","id":"12314116","description":"10.5.2 Release July 30 2009 (794445) Now deprecated","name":"10.5.2.0","archived":false,"released":true,"releaseDate":"2009-07-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314117","id":"12314117","description":"Next release after 10.5.2.0 release candidate #1","name":"10.5.3.0","archived":false,"released":true,"releaseDate":"2009-08-21"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12358184","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12358184","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12608438","key":"DERBY-5933","self":"https://issues.apache.org/jira/rest/api/2/issue/12608438","fields":{"summary":"SQL sorting error","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12332363","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12332363","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12466382","key":"DERBY-4695","self":"https://issues.apache.org/jira/rest/api/2/issue/12466382","fields":{"summary":"Internal assignment of tablenumer, columnnumber looks wrong in query tree, although no ill effects are seen.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12332262","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12332262","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12366604","key":"DERBY-2526","self":"https://issues.apache.org/jira/rest/api/2/issue/12366604","fields":{"summary":"Wrong results with queries that use the JOIN ... ON syntax to join with views or other non-base table expressions.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12337263","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12337263","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"inwardIssue":{"id":"12497378","key":"DERBY-4994","self":"https://issues.apache.org/jira/rest/api/2/issue/12497378","fields":{"summary":"10.5 backport effort issue (2011)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-11-15T08:15:13.768+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"select distinct \r\n    t1.ITEM_ID, \r\n    t1.STATE_ID, \r\n    t1.JZ_DISCRIMINATOR \r\nfrom (\r\n    select * \r\n    from \r\n        LM.ABSTRACT_INSTANCE z1 \r\n    where \r\n        z1.JZ_DISCRIMINATOR = 238\r\n) t1 left outer join \r\n    LM.LAB_RESOURCE_OPERATINGSYSTEM j1 on (t1.ITEM_ID = j1.JZ_PARENT_ID) left outer join \r\n         LM.ABSTRACT_INSTANCE t2 on (j1.ITEM_ID = t2.ITEM_ID) left outer join \r\n             LM.OPERATING_SYSTEM_SOFTWARE_INSTALL j2 on (t2.ITEM_ID = j2.JZ_PARENT_ID) left outer join \r\n                 LM.ABSTRACT_INSTANCE t3 on (j2.ITEM_ID = t3.ITEM_ID) left outer join \r\n                     LM.FAMILY t5 on (t2.FAMILY_ITEM_ID = t5.ITEM_ID) left outer join \r\n                         LM.FAMILY t7 on (t1.FAMILY_ITEM_ID = t7.ITEM_ID) \r\nwhere (\r\n    t3.FAMILY_ITEM_ID  in('_5VetVWTeEd-Q8aOqWJPEIQ') and \r\n    (t5.ROOT_ITEM_ID = '_5ZDlwWTeEd-Q8aOqWJPEIQ') and \r\n    (t7.ROOT_ITEM_ID = '_5nN9mmTeEd-Q8aOqWJPEIQ') and \r\n    (t1.VISIBILITY = 0)\r\n)\r\n\r\nThe above query returns no results despite the fact that the database contains results that match the query.  \r\nSlight modifications to the query that shouldn't change the outcome cause it to return the expected results.  For example: changing \r\n\"t3.FAMILY_ITEM_ID  in('_5VetVWTeEd-Q8aOqWJPEIQ')\" \r\nto \r\n\"t3.FAMILY_ITEM_ID  in('_5VetVWTeEd-Q8aOqWJPEIQ', 'blah')\" \r\nor \r\n\"t3.FAMILY_ITEM_ID  = '_5VetVWTeEd-Q8aOqWJPEIQ'\"\r\n\r\nor removing  \r\n\"(t5.ROOT_ITEM_ID = '_5ZDlwWTeEd-Q8aOqWJPEIQ') and \"\r\ndespite the fact that the results show that t5.ROOT_ITEM_ID is equal to the string above.\r\n\r\nNote that there is no error message associated with the incorrect query, it just returns zero rows.\r\n\r\nThe query below doesn't use join statements and works as expected.\r\n\r\nselect distinct \r\n   t1.item_id, \r\n   t1.state_id, \r\n   t1.jz_discriminator\r\nfrom (\r\n        select * \r\n        from \r\n            lm.abstract_instance z1 \r\n        where \r\n            z1.jz_discriminator = 238\r\n    ) t1,\r\n    lm.lab_resource_operatingsystem j1,\r\n    lm.abstract_instance t3,\r\n    lm.operating_system_software_install j2,\r\n    lm.abstract_instance t2,\r\n    lm.family t5,\r\n    lm.family t7\r\nwhere\r\n    t1.item_id = j1.jz_parent_id and\r\n    j1.item_id = t2.item_id and\r\n    t2.item_id = j2.jz_parent_id and\r\n    j2.item_id = t3.item_id and\r\n    t2.family_item_id = t5.item_id and\r\n    t1.family_item_id = t7.item_id and\r\n    t3.family_item_id in ('_5VetVWTeEd-Q8aOqWJPEIQ') and\r\n    t5.root_item_id = '_5ZDlwWTeEd-Q8aOqWJPEIQ' and\r\n    t7.root_item_id = '_5nN9mmTeEd-Q8aOqWJPEIQ' and\r\n    t1.visibility = 0;","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10367","value":"Deviation from standard","id":"10367"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10421","value":"Seen in production","id":"10421"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10366","value":"Wrong query result","id":"10366"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35386","summary":"Several left outer joins causes unstable query with incorrect results","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichar","name":"dirichar","emailAddress":"dirichar at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Richards","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichar","name":"dirichar","emailAddress":"dirichar at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Richards","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"------------------ Java Information ------------------\r\nJava Version:    1.5.0\r\nJava Vendor:     IBM Corporation\r\nJava home:       C:\\jazz-rtc-2.0.0.2\\client\\eclipse\\jdk\\jre\r\nJava classpath:  C:\\Progra~1\\Derby\\Derby10.5.3/lib/derby.jar;C:\\Progra~1\\Derby\\Derby10.5.3/lib/derbynet.jar;C:\\Progra~1\\Derby\\Derby10.5.3/lib/derbyclient.jar;C:\\Progra~1\\Derby\\Derby10.5.3/lib/derbytools.jar\r\nOS name:         Windows XP\r\nOS architecture: x86\r\nOS version:      5.1 build 2600 Service Pack 3\r\nJava user name:  dirichar\r\nJava user home:  C:\\Documents and Settings\\dirichar\r\nJava user dir:   C:\\Program Files\\Derby\\Derby10.5.3\\bin\r\njava.specification.name: Java Platform API Specification\r\njava.specification.version: 1.5\r\n--------- Derby Information --------\r\nJRE - JDBC: J2SE 5.0 - JDBC 3.0\r\n[C:\\Program Files\\Derby\\Derby10.5.3\\lib\\derby.jar] 10.5.3.0 - (802917)\r\n[C:\\Program Files\\Derby\\Derby10.5.3\\lib\\derbytools.jar] 10.5.3.0 - (802917)\r\n[C:\\Program Files\\Derby\\Derby10.5.3\\lib\\derbynet.jar] 10.5.3.0 - (802917)\r\n[C:\\Program Files\\Derby\\Derby10.5.3\\lib\\derbyclient.jar] 10.5.3.0 - (802917)\r\n------------------------------------------------------\r\n----------------- Locale Information -----------------\r\nCurrent Locale :  [English/United States [en_US]]\r\nFound support for locale: [cs]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [de_DE]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [es]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [fr]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [hu]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [it]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [ja_JP]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [ko_KR]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [pl]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [pt_BR]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [ru]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [zh_CN]\r\n\t version: 10.5.3.0 - (802917)\r\nFound support for locale: [zh_TW]\r\n\t version: 10.5.3.0 - (802917)\r\n------------------------------------------------------\r\n","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":41,"total":41,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12872179","id":"12872179","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi David,\r\n\r\nIt would be helpful if you could post the schema for the tables involved in the query, including all constraints and indexes defined on them. Preferably also with enough rows to reproduce the problem.\r\n(The dblook utility could be used to extract schema information. See http://db.apache.org/derby/docs/10.6/tools/ctoolsdblook.html.)\r\n\r\nThere's at least one wrong query result bug affecting joins (DERBY-4372) in 10.5.3.0 that has been fixed in the recently released 10.6.1.0, so it might be worthwhile to check if the bug is still present in the latest version of Derby.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-05-27T11:10:35.273+0000","updated":"2010-05-27T11:10:35.273+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12872227","id":"12872227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichar","name":"dirichar","emailAddress":"dirichar at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Richards","active":true},"body":"I've attached the output of dblook as db.sql and a simplified creation script as sample.sql that includes the relevant tables and columns with sample data.  I also verified that the bug still occurs in 10.6.1.0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichar","name":"dirichar","emailAddress":"dirichar at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Richards","active":true},"created":"2010-05-27T14:20:34.189+0000","updated":"2010-05-27T14:20:34.189+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12872352","id":"12872352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks David. I'm able to reproduce it with the scripts you attached.\r\n\r\nI'm a little puzzled by the fact that rewriting \"t3.FAMILY_ITEM_ID in('_5VetVWTeEd-Q8aOqWJPEIQ')\" to \"t3.FAMILY_ITEM_ID = '_5VetVWTeEd-Q8aOqWJPEIQ'\" changes the result, since Derby actually does that internally before the statement is compiled.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-05-27T20:27:22.093+0000","updated":"2010-05-27T20:27:22.093+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873119","id":"12873119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"With this modified query (inner join t3)\r\n\r\nselect distinct t1.ITEM_ID, t1.state_id, t1.JZ_DISCRIMINATOR from \r\n   (select * from LM.ABSTRACT_INSTANCE z1 where z1.JZ_DISCRIMINATOR = 238) t1 left outer join \r\n    LM.LAB_RESOURCE_OPERATINGSYSTEM j1 on (t1.ITEM_ID = j1.JZ_PARENT_ID) left outer join \r\n    LM.ABSTRACT_INSTANCE t2 on (j1.ITEM_ID = t2.ITEM_ID) left outer join \r\n    LM.OPERATING_SYSTEM_SOFTWARE_INSTALL j2 on (t2.ITEM_ID = j2.JZ_PARENT_ID) inner join\r\n    LM.ABSTRACT_INSTANCE t3 on (j2.ITEM_ID = t3.ITEM_ID) left outer join\r\n    LM.FAMILY t5 on (t2.FAMILY_ITEM_ID = t5.ITEM_ID) left outer join\r\n    LM.FAMILY t7 on (t1.FAMILY_ITEM_ID = t7.ITEM_ID) where \r\n        (t3.FAMILY_ITEM_ID in('_5VetVWTeEd-Q8aOqWJPEIQ') and \r\n        (t5.ROOT_ITEM_ID = '_5ZDlwWTeEd-Q8aOqWJPEIQ') and \r\n        (t7.ROOT_ITEM_ID = '_5nN9mmTeEd-Q8aOqWJPEIQ'));\r\n\r\nthe query works also with the IN formulation.  With the equality\r\nformulation, which was seen to work, the left outer join is\r\ninternally rewritten to inner join. Since the single value IN is rewritten to\r\nequality, Derby could have done that rewrite internally also for that\r\ncase, and the problem would presumably have gone away. I don't this\r\nthis is (necessarily) the root problem, though.\r\n\r\nWith multiple values in the IN clause, this rewrite of the JOIN does\r\nnot happen, however, but that formulation also works. I tried to\r\ndisable temporarily the rewrite to equality  for the single value case\r\n(InListOperatorNode#preprocess), so as to use the multi-probing\r\nstrategy, but the query still fails. (edited: actually it works, finger trouble, see next comment)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-28T19:19:54.436+0000","updated":"2010-05-29T16:35:40.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873127","id":"12873127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"As far as trying the multi-probing case, I was foiled  by the check for same min and max value, which also short circuits to equality (InListOperatorNode, ca line 282). By also commenting out that section, thus forcing the probing strategy, the query worked.\r\nSo, it's the transformation to equality in this context which makes it fail somehow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-28T19:44:23.367+0000","updated":"2010-05-28T19:44:23.367+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873140","id":"12873140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"See this all the way back to 10.0, so not a regression.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-28T20:28:21.711+0000","updated":"2010-05-28T20:28:21.711+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873283","id":"12873283","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I enabled the calls of traceScanParameters in TableScanResultSet for the IN formulation and the equal formulation, uploaded as\r\ntrace-equal.log and trace-in.log. As can be seen, for the IN case, there are two qualifiers being applied to the table FAMILY,\r\nwhereas in the equal case there is only one, column id 1 (ITEM_ID), which is reasonable. In the IN case, there is also pushed down a qualifier on\r\ncolumn id 0 (STATE_ID) which seems wrong. Presumably this is why no rows qualify from FAMILY and hence leads to now rows in all result sets (see enclosed\r\nexecution plan, trace-exec-plan.log).\r\n\r\n-- Edited: The columns mentioned above for FAMILY should be 0: ITEM_ID, 1:ROOT_ITEM_ID. Later investigation shows that the qualifier on column 0 is wrong, see below. (STATE_ID is in another table, sorry for the confusion).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-29T13:28:59.968+0000","updated":"2010-05-29T16:20:28.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873284","id":"12873284","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading the AST dump just after DMLStatementNode#optimizeStatement has called preprocess:\r\n\r\n- in-after-preprocess.log (wrong result)\r\n- ins-after-preprocess.log (correct result)\r\n- equal-after-preprocess.log (correct result)\r\n\r\nI have normalized the node hash numbers for ease of comparison to be ascending integers.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-29T13:51:50.481+0000","updated":"2010-05-29T13:51:50.481+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873298","id":"12873298","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Looking at in-after-preprocess.log, line 4551, I see a restriction predicate on T7 (LM.FAMILY):\r\n\r\nT7.ITEM_ID = CharConstantNode@331['_5VetVWTeEd-Q8aOqWJPEIQ'].\r\n\r\nThis is wrong, because this constant is only ever used in the query against table T3 (LM.ABSTRACT_INSTANCE),\r\nand then against column FAMILY_ITEM_ID. This is the cause of the wrong qualifier which leads to 0 rows from FAMILY as seen.\r\n\r\nOn the other hand, in ins-after-preprocess (correct result), we see two predicates in the final where clause (because the last two joins have been flattened, 4\r\nhalfouterjoinnodes remain:\r\n\r\na) t1.FAMILY_ITEM_ID = T7.ITEM_ID\r\nb) t2.FAMILY_ITEM_ID = T5.ITEM_ID\r\n\r\nFor the single IN case (erroneous), we also have only 4 remaining halfouterjoinnodes, but the b) predicate in the final where clause is missing.\r\n\r\nIn the equal-after-preprocess.log we see only three halfouterjoinnodes, since 3 joins have been flattened, and the final where predicate contains\r\na) and b) plus a new\r\n\r\nc) J2.ITEM_ID = T3.ITEM_ID\r\n\r\nwhich corresponds to the third but the last join, which have been flattened because of the equality. \r\nIn the erroneous case, the left outer join was not converted to an inner join since it did not contain an = operator at the time of LOJ->IJ conversion, so flattening did not happen\r\nand we are left with 4 halfouterjoinnodes. That is less than optimal, but should still work.\r\n\r\nSomehow the preprocessing (all is fine after bind) of the simple IN case has gone wrong.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-29T16:10:59.238+0000","updated":"2010-05-29T16:10:59.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873687","id":"12873687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Two data points: \r\n- Disabling LOJ reordeable has no effect, so it is probably not related to DERBY-4471\r\n- Disabling the call to transforOuterJoins in FromList#preprocess makes the query work","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-31T15:32:38.810+0000","updated":"2010-05-31T15:32:38.810+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873694","id":"12873694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"While keeping the call to transforOuterJoins in FromList#preprocess disabled, I manage to get this version of the query to fail as well. The predicate on t3.FAMILY_ITEM_ID uses explicit equality here, but it not lead to rewrite to inner join of the LOJ with t3 in this case since I disabled transforOuterJoins.\r\n\r\n\"select distinct t1.ITEM_ID, t1.state_id, t1.JZ_DISCRIMINATOR from \r\n (((((((select * from LM.ABSTRACT_INSTANCE z1 where z1.JZ_DISCRIMINATOR = 238) t1  \r\n        left outer join LM.LAB_RESOURCE_OPERATINGSYSTEM j1 on (t1.ITEM_ID = j1.JZ_PARENT_ID))  \r\n       left outer join LM.ABSTRACT_INSTANCE t2 on (j1.ITEM_ID = t2.ITEM_ID))  \r\n      left outer join LM.OPERATING_SYSTEM_SOFTWARE_INSTALL j2 on (t2.ITEM_ID = j2.JZ_PARENT_ID)) \r\n     left outer join LM.ABSTRACT_INSTANCE t3 on (j2.ITEM_ID = t3.ITEM_ID))  \r\n    inner join LM.FAMILY t5 on (t2.FAMILY_ITEM_ID = t5.ITEM_ID))  \r\n   inner join LM.FAMILY t7 on (t1.FAMILY_ITEM_ID = t7.ITEM_ID))  \r\n  where (t3.FAMILY_ITEM_ID ='_5VetVWTeEd-Q8aOqWJPEIQ' and  <------------ explicit \"=\"  also fails when LOJ -> IJ is disabled\r\n        (t5.ROOT_ITEM_ID = '_5ZDlwWTeEd-Q8aOqWJPEIQ') and  \r\n        (t7.ROOT_ITEM_ID ='_5nN9mmTeEd-Q8aOqWJPEIQ'))\"\r\n\r\nThe LOJ->IJ rewrite is not logically required and the bug is now seen to be present without the LOJ->IJ rewriting happeing.\r\n\r\nIn the above query, we have four remaining LOJs. This is also what resulted in the original case after IN is transformed to '=\", since that happens too late for LOJ->IJ to kick in for that case. It does happen for the two last joins, as manually replicated in the above experiment.\r\n\r\nI see that the reason the predicate \"= _5VetVWTeEd-Q8aOqWJPEIQ\" ends up on T7.ITEM_ID is because of the transitive closure computation in PredicatList#searchClauseTransitiveClosure. \r\n\r\nCould it be that the precondition for that is wrong here: a predicate on t3 which has not been flattened is applied transitively to the T7, which has been?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-31T16:14:25.995+0000","updated":"2010-05-31T21:32:49.246+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873761","id":"12873761","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I am starting to convince myself it is plain wrong to apply the transitive closure to predicates on tables not from the outer equi-joins, cf\r\nthe explanation in the Sybase manual:\r\n\r\nhttp://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.infocenter.dc00743.1502/html/queryprocessing/queryprocessing8.htm\r\n\r\n(quote):\r\n (predicate) Transitive closure is used only for normal equi-joins, as shown. join transitive closure is not performed for:\r\n - Non-equi-joins; for example, t1.c1 > t2.c2\r\n - Outer joins; for example, t1.c11 *= t2.c2, or left join or right join  (<------------ NOTE! -Dag's emphasis)\r\n - Joins across subquery boundaries\r\n - Joins used to check referential integrity or the with check option on views\r\n(quote end)\r\n\r\nas well as the Derby docs which explains its rationale here:\r\n\r\nhttp://db.apache.org/derby/docs/10.6/tuning/rtuntransform866587.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-31T19:24:42.635+0000","updated":"2010-05-31T19:24:42.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12873801","id":"12873801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I see that in the table number for t3 in the predicate \"t3.FAMILY_ITEM_ID ='_5VetVWTeEd-Q8aOqWJPEIQ'\" is 9.\r\nHowever, so is also the table number for t1 in the equi-join clause \"t1.FAMILY_ITEM_ID = t7.ITEM_ID)\".\r\n\r\nThis is the immediate reason why the bad predicate is added by the searchClauseTransitiveClosure logic, t3 is assumed to be the same as t1.\r\n\r\nt1 and t3 both have the same underlying base table, i.e. LM.ABSTRACT_INSTANCE.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-05-31T22:02:15.429+0000","updated":"2010-05-31T22:04:55.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12874256","id":"12874256","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I now believe this is a bug related to DERBY-2526 and DERBY-3023.\r\nWhen equi-joins are flattened (JoinNode#flatten), the column references are remapped, cf. calls to\r\nremapColumnReferencesToExpressions.\r\n\r\nDERBY-2526 uncovered a weakness in this remapping in that only table\r\nnumber were updated, not column numbers. The fix to DERBY-2526\r\ncontains this line in\r\nColumnReference#remapColumnReferencesToExpressions:\r\n\r\n   ResultColumn ftRC =\r\n       ft.getResultColumns().getResultColumn(columnName);\r\n\r\nUnfortunately, in this query, using the columnName will not uniquely\r\nidentify the correct result column, since the multi-way's concatenated\r\nlist of result columns (cf. the write-up attached to DERBY-2526:\r\nhttps://issues.apache.org/jira/secure/attachment/12358291/d2526_v1.html)\r\ncontains several columns with the same names, resulting from the fact\r\nthat the query contains self-joins on ABSTRACT_INSTANCE): z1/t1, t2\r\nand t3.\r\n\r\nTo see this happening, apply the patch show.diff and run the attached\r\nprogram Foo.java.  I believe this causes one or more of remappings to\r\ngo awry. The immediate problem is that the remapping of\r\nt3.FAMILY_ITEM_ID chooses the first occurence of FAMILY_ITEM_ID and\r\nands up with the occurence for z1/t1, which leads to the fatal mixup.\r\n\r\n\r\nOutput seen:\r\n\r\n----\r\nmap before: T1.ITEM_ID [null] (tablenum, colnum) = (0, 2) VCid=2\r\nFound 6 columns of the name ITEM_ID\r\nmap after: T1.ITEM_ID [null] (tablenum, colnum) = (11, 2) VCid=2 map from VirtualColumnId\r\nmap before: T1.STATE_ID [null] (tablenum, colnum) = (0, 4) VCid=4\r\nFound 3 columns of the name STATE_ID\r\nmap after: T1.STATE_ID [null] (tablenum, colnum) = (11, 4) VCid=4 map from VirtualColumnId\r\nmap before: T1.JZ_DISCRIMINATOR [null] (tablenum, colnum) = (0, 1) VCid=1\r\nFound 3 columns of the name JZ_DISCRIMINATOR\r\nmap after: T1.JZ_DISCRIMINATOR [null] (tablenum, colnum) = (11, 1) VCid=1 map from VirtualColumnId\r\nmap before: T3.FAMILY_ITEM_ID [null] (tablenum, colnum) = (8, 3) VCid=17\r\nFound 3 columns of the name FAMILY_ITEM_ID\r\nmap after: T3.FAMILY_ITEM_ID [null] (tablenum, colnum) = (11, 3) VCid=17 map from VirtualColumnId\r\nmap before: T5.ROOT_ITEM_ID [null] (tablenum, colnum) = (10, 2) VCid=21\r\nmap after: T5.ROOT_ITEM_ID [null] (tablenum, colnum) = (11, 21) VCid=21 map from VirtualColumnId\r\nmap before: T7.ROOT_ITEM_ID [T7] (tablenum, colnum) = (12, 2) VCid=23\r\nmap after: T7.ROOT_ITEM_ID [T7] (tablenum, colnum) = (12, 2) VCid=23 map from ColumnPosition\r\nmap before: T1.VISIBILITY [null] (tablenum, colnum) = (0, 5) VCid=5\r\nFound 3 columns of the name VISIBILITY\r\nmap after: T1.VISIBILITY [null] (tablenum, colnum) = (11, 5) VCid=5 map from VirtualColumnId\r\n----\r\nmap before: T1.ITEM_ID [null] (tablenum, colnum) = (11, 2) VCid=2\r\nFound 5 columns of the name ITEM_ID\r\nmap after: T1.ITEM_ID [null] (tablenum, colnum) = (9, 2) VCid=2 map from VirtualColumnId\r\nmap before: T1.STATE_ID [null] (tablenum, colnum) = (11, 4) VCid=4\r\nmap after: T1.STATE_ID [null] (tablenum, colnum) = (9, 4) VCid=4 map from VirtualColumnId\r\nmap before: T1.JZ_DISCRIMINATOR [null] (tablenum, colnum) = (11, 1) VCid=1\r\nmap after: T1.JZ_DISCRIMINATOR [null] (tablenum, colnum) = (9, 1) VCid=1 map from VirtualColumnId\r\nmap before: T3.FAMILY_ITEM_ID [null] (tablenum, colnum) = (11, 3) VCid=17\r\nFound 3 columns of the name FAMILY_ITEM_ID\r\nmap after: T3.FAMILY_ITEM_ID [null] (tablenum, colnum) = (9, 3) VCid=17 map from VirtualColumnId\r\nmap before: T5.ROOT_ITEM_ID [T5] (tablenum, colnum) = (11, 21) VCid=21\r\nmap after: T5.ROOT_ITEM_ID [T5] (tablenum, colnum) = (10, 2) VCid=21 map from ColumnPosition\r\nmap before: T1.VISIBILITY [null] (tablenum, colnum) = (11, 5) VCid=5\r\nmap after: T1.VISIBILITY [null] (tablenum, colnum) = (9, 5) VCid=5 map from VirtualColumnId\r\nmap before: T1.FAMILY_ITEM_ID [null] (tablenum, colnum) = (0, 3) VCid=3\r\nFound 3 columns of the name FAMILY_ITEM_ID\r\nmap after: T1.FAMILY_ITEM_ID [null] (tablenum, colnum) = (9, 3) VCid=3 map from VirtualColumnId\r\n----\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-01T21:42:45.417+0000","updated":"2010-06-01T21:42:45.417+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12874258","id":"12874258","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Just for the record, the fix to DERBY-2526 didn't *cause* this problem, it's just that the solution is not sufficient for this case.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-01T21:51:02.112+0000","updated":"2010-06-01T21:51:02.112+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12874791","id":"12874791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading drawing.txt of the query tree at three instances in time, decorated with\r\n(tablenumber, column number) for join predicates and search predicates:\r\n\r\n- before flattening\r\n- after flattening of IJ with T7\r\n- after flattening of IJ with T5\r\n\r\nThis shows in yet another way how \"t3.FAMILY_ITEM_ID\" gets the wrong column number during the flattening process. \r\n\r\nI still don't have a suggestion for how to fix this problem, since the old approach seems broken: Somehow, the correct result column should be identified using *both* the table alias *and* the column name involved. Maybe looking into the matching result columns searching for its alias could work to disambiguate the result column search, if we are always able to find it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-02T20:45:36.547+0000","updated":"2010-06-02T20:45:36.547+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12875163","id":"12875163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"In updated drawing.txt, the search predicate which has a wrong column number is given as:\r\n\r\n  t3.FAMILY_ITEM_ID ='_5VetVWTeEd-Q8aOqWJPEIQ'= (9,3) still wrong, should be (9,13)\r\n\r\nBy manually tweaking it, the query ran successfully.\r\nSo, getting the column re-binding right would fix the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-03T15:52:28.863+0000","updated":"2010-06-03T15:56:37.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12875465","id":"12875465","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"> The immediate problem is that the remapping of \r\n> t3.FAMILY_ITEM_ID chooses the first occurence of FAMILY_ITEM_ID and \r\n> ands up with the occurence for z1/t1, which leads to the fatal mixup. \r\n\r\nYour analysis makes sense to me. Thanks for taking the time to prepare\r\nthe clear writeups and supporting materials. \r\n\r\n>  using the columnName will not uniquely \r\n> identify the correct result column, since the multi-way's concatenated \r\n> list of result columns contains several columns with the same names,\r\n\r\nIt seems like the DERBY-2526 fix did not expect this to occur, and that's where\r\nthe problem lies.\r\n\r\nCan we widen the interface to the getResultColumn() API so that we can\r\ntell it specifically which table number we want the desired column to reside in?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-06-04T04:29:57.653+0000","updated":"2010-06-04T04:29:57.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12875590","id":"12875590","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for your comments, Bryan! Yes, I agree with you proposal that the API could be adjusted here.\r\nI am currently working with an experiment to extend that API method with the desired table&column number instead of the string.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-04T13:20:13.742+0000","updated":"2010-06-04T13:20:13.742+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12875810","id":"12875810","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Attaching a patch which makes the query work basically using the approach suggested.\r\nIt turns out to be slightly more involved than that, cf the code comments, in that\r\n\r\n  a) we fall back on the column name approach when the CR refers to a base table\r\n  b) we have to save the original (tn, cn) pair between flattenings to make the new approach work for multiple join flattenings. \r\n\r\nThe repro showcases the need for both the above modifications to the basic approach.\r\n\r\nIt also adds the test case to JoinTest in a new fixture. Regressions ran ok.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-05T00:34:01.018+0000","updated":"2010-06-05T00:34:01.018+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12875820","id":"12875820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Dag, thanks for the patch!\r\n\r\nI see what you mean, that it's a slightly involved patch, but I haven't thought\r\nof any ways to simplify this; it's a slightly involved problem after all :)\r\n\r\nThe patch may have a few tab-versus-space issues, in particular the\r\nblock comment around line 860 of ColumnReference.java seemed to\r\nhave whitespace-only modifications.\r\n\r\nIt might be nice to add an additional sentence or two to the method\r\ncomments for the new getResultColumn method in ResultColumnList\r\nto indicate that access by the (table-number,column-number) pair is\r\nused by the optimizer when it is flattening queries, and has to use\r\nthis information to uniquely distinguish the column in situations where\r\nthe same table may appear multiple times in the queries with\r\nseparate correlation names.\r\n\r\nIt might be nice to add a comment to the new test case in JoinTest.java,\r\nperhaps something along the lines of:\r\n\r\n   Verify that when transitive closure generates new criteria into\r\n   the query, it isn't confused by situations where the same column name\r\n   appears in a result column list multiple times due to \r\n   flattening of sub-queries.\r\n\r\nObviously the full details will be available in the Jira entry, but it is nice\r\nsometimes to have a brief description of the test's purpose in the test itself.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-06-05T01:20:25.981+0000","updated":"2010-06-05T01:20:25.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12875830","id":"12875830","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks, Bryan! Yes, these are good improvement suggestions!\r\n\r\nAs for the whitespace changes around line 860, I am aware of those,\r\nI was vacillating back and forth on that in order to make the diff look at readable as possible, \r\nbut in the end, I also prefer to keeps the diffs minimal, so I'll reverse that change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-05T01:40:53.690+0000","updated":"2010-06-05T01:40:53.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12875931","id":"12875931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading derby-4679b, which improves on the comments as suggested by Bryan,\r\nand also simplified the logic slightly in ColumnReference change. Regressions ran ok.\r\n\r\nI forgot to mention that the patch also contains a small improvement to the dumping of query trees that I found missing during debugging: let printSubNodes also print sourceResultSet (we no longer need to worry about circularities since nodes are only printed once).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-05T20:19:15.401+0000","updated":"2010-06-05T20:19:15.401+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12875962","id":"12875962","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks for the updated patch, the new comments are very helpful.\r\nI have no further suggestions to offer; I think that your patch improves\r\nthe system (making more queries run correctly) and I think you should\r\nmove forward with it.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2010-06-05T22:49:37.862+0000","updated":"2010-06-05T22:49:37.862+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12876252","id":"12876252","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks, Bryan, for having another look!\r\nCommitted patch derby-4679b as svn 952237 to solve this issue. Not resolving yet, planning to backport to 10.6 branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-07T14:20:25.889+0000","updated":"2010-06-07T14:37:58.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12879104","id":"12879104","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Due to the findings in DERBY-4695, I will hold off back-porting this until that issue is fixed as well.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-15T20:06:14.455+0000","updated":"2010-06-15T20:06:14.455+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12879839","id":"12879839","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading a follow-up patch for this issue, which:\r\n   - adds a sanity check that a found RC has the expected column name (due to the issues seen in DERBY-4695). A wrong (tn, cn) pair might in theory lead us to bind to the wrong result column. In Sane mode, this situation will throw an assert, in insane, we will fall back on the old method of binding using the column name. This makes it safer to back-port this issue fix to the 10.6 branch.\r\n\r\nIf/when we manage to resolve DERB-4695, we can remove the code added in this follow-up patch.\r\nRegressions ran ok.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-17T16:49:57.471+0000","updated":"2010-06-17T16:49:57.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12879934","id":"12879934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I did some more research to understand the limitations of the approach\r\ntaken by the fix in this issue, i.e. locating the result column based\r\non the (tablenumber, columnnumber) pair. It turns out it fails to work\r\nalso when the column reference is to a subquery, which can be\r\nflattened before we get the the join flattening, so the table number\r\nof the CR is no longer to be found, and we fall back on the \"buggy\" approach of\r\nlooking for the column name described above.\r\n\r\nA slight reformulation of the original problem query makes the bug\r\nreappear:\r\n\r\n    \"select distinct t1.ITEM_ID, t1.state_id, t1.JZ_DISCRIMINATOR from \" +\r\n    \"((((((select * from ABSTRACT_INSTANCE z1 where z1.JZ_DISCRIMINATOR = 238) t1 \" +\r\n    \"      left outer join LAB_RESOURCE_OPERATINGSYSTEM j1 on (t1.ITEM_ID = j1.JZ_PARENT_ID)) \" +\r\n    \"     left outer join ABSTRACT_INSTANCE t2 on (j1.ITEM_ID = t2.ITEM_ID)) \" +\r\n    \"    left outer join OPERATING_SYSTEM_SOFTWARE_INSTALL j2 on (t2.ITEM_ID = j2.JZ_PARENT_ID))\" +\r\n    \"   left outer join (select * from ABSTRACT_INSTANCE) tCorr on (j2.ITEM_ID = tCorr.ITEM_ID) \" +\r\n    \"  inner join FAMILY t5 on (t2.FAMILY_ITEM_ID = t5.ITEM_ID)) \" +\r\n    \" inner join FAMILY t7 on (t1.FAMILY_ITEM_ID = t7.ITEM_ID)) \" +\r\n    \"where (tCorr.FAMILY_ITEM_ID IN('_5VetVWTeEd-Q8aOqWJPEIQ') and \" +\r\n    \"      (t5.ROOT_ITEM_ID = '_5ZDlwWTeEd-Q8aOqWJPEIQ') and \" +\r\n    \"      (t7.ROOT_ITEM_ID ='_5nN9mmTeEd-Q8aOqWJPEIQ') and \" +\r\n    \"      (t1.VISIBILITY = 0))\");\r\n\r\nNote that now, instead of t3, we now have a subquery, tCorr.\r\n\r\nHowever, during my research on DERBY-4695, I reported that skipping\r\nthe 2nd bind block in JoinNode (unless we have an OUTER JOIN), made\r\nthe observed numbering inconsistency go away.\r\n\r\nWell, it turns out that skipping the second bind for inner joins makes\r\nthe above query variant work, too, as well as the original problem\r\nquery in this issue, *without* the fix I have already committed for\r\nthis issue!\r\n\r\nIt could be that this is the root problem. Since it also solves the\r\nabove variant, and removes the wrong numbering seen, it seems a better\r\nfix anyway, if regressions tests still hold up. We'll see that soon.\r\n\r\n[Edit: 2010-06-24: \r\n\r\nIt is not the root cause, because the second bind is needed, cf\r\nconclusions in DERBY-4695. The second binding is somewhat\r\nbroken/problematic, though, for two reasons:\r\n\r\n        a) it sometimes leads to wrong column number (see DERBY-4695).\r\n\r\n        b) we can't rebind correctly when subqueries are flattened\r\n        (cf. the above query variant) because the node (and the table\r\n        number) of the column reference representing the subquery\r\n        column is gone, so the approach taken here (i.e. to match the\r\n        result column using table number and column number of the CR)\r\n        fails to locate a matching result column, forcing us back to\r\n        the old approach, which fails due to column names not being\r\n        unique.\r\n]\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-17T21:19:04.177+0000","updated":"2010-06-23T18:26:13.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12880204","id":"12880204","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Sadly, this approach also breaks others queries: they all seem to be characterized by\r\na mix of inner and outer joins. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-18T13:48:11.948+0000","updated":"2010-06-18T13:48:11.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12881724","id":"12881724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Having understood the reason for the inconsistency seen in DERBY-4695, I think I can\r\nconclude that the current patch, with the addition of the follow-up patch should be\r\nsafe in the sense of not causing regressions. Therefore, I now intend to commit\r\nthe follow-up patch and back-port both present patches to the 10.6 branch.\r\n\r\nFurther investigations are necessary to find a way to handle to subquery variant query show above.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-23T16:05:54.897+0000","updated":"2010-06-23T16:12:42.488+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12881728","id":"12881728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed derby-4679-followup as svn 957260.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-23T16:19:25.782+0000","updated":"2010-06-23T16:19:25.782+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12881800","id":"12881800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Back-ported patches to 10.6 branch as svn  957287.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-23T18:14:57.790+0000","updated":"2010-06-23T18:14:57.790+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12882683","id":"12882683","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading another follow-up patch for this issue, which also handles of the\r\na CR to a subquery join participant being rebound after flattening, see detailed comments in the code.\r\nExtra test cases are added to JoinTest#testDerby_4679. Regressions ran ok.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-25T19:00:05.731+0000","updated":"2010-06-25T19:00:05.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12883202","id":"12883202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed derby-4679-2 as svn 958618.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-28T16:12:47.726+0000","updated":"2010-06-28T16:12:47.726+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12883207","id":"12883207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Back-ported to 10.6 as svn 958621, resolving.\r\n\r\nDavid, if you think this issue has been adequately addressed, feel free to close the issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-06-28T16:23:15.135+0000","updated":"2010-06-28T16:23:15.135+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12891574","id":"12891574","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichar","name":"dirichar","emailAddress":"dirichar at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Richards","active":true},"body":"I couldn't find any information on the derby pages about planned releases.  Can someone link me to or provide the information about when the versions with this fix in (10.6.1.1, 10.7.0.0) will be officially released?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dirichar","name":"dirichar","emailAddress":"dirichar at us dot ibm dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Richards","active":true},"created":"2010-07-23T12:53:20.671+0000","updated":"2010-07-23T12:53:20.671+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12893967","id":"12893967","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"I don't think anyone has stepped up to act as the release manager yet.\r\nThe currently empty pages with information about potential upcoming releases are:\r\nhttp://wiki.apache.org/db-derby/DerbyTenSixTwoRelease\r\nhttp://wiki.apache.org/db-derby/DerbyTenSevenOneRelease","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-07-30T08:45:23.480+0000","updated":"2010-07-30T08:45:23.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12989884","id":"12989884","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Reopen for backport.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-02-02T23:40:19.729+0000","updated":"2011-02-02T23:40:19.729+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12995055","id":"12995055","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Assign to myself temporarily for backport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-02-15T23:17:13.384+0000","updated":"2011-02-15T23:17:13.384+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/12995175","id":"12995175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Resolving now that fix has been backported to 10.5\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-02-16T05:35:05.875+0000","updated":"2011-02-16T05:35:05.875+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12465506/comment/13823427","id":"13823427","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update: close all resolved issues that haven't had any activity the last year]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-15T08:15:13.765+0000","updated":"2013-11-15T08:15:13.765+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4679/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06f4v:"}}