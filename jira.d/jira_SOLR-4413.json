{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12631261","self":"https://issues.apache.org/jira/rest/api/latest/issue/12631261","key":"SOLR-4413","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323893","id":"12323893","description":"Major release after 4.1","name":"4.2","archived":false,"released":true,"releaseDate":"2013-03-11"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321664","id":"12321664","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-02-08 17:31:50.207","customfield_12312323":null,"customfield_12310420":"311757","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1314878623_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-02-22T19:07:53.959+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-4413/watchers","watchCount":7,"isWatching":false},"created":"2013-02-07T13:53:15.370+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12322551","id":"12322551","description":"First major release from the 4.x branch: http://svn.apache.org/viewvc/lucene/dev/branches/branch_4x/","name":"4.0","archived":false,"released":true,"releaseDate":"2012-10-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321141","id":"12321141","description":"Major release after 4.0","name":"4.1","archived":false,"released":true,"releaseDate":"2013-01-22"}],"issuelinks":[{"id":"12364456","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12364456","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12632764","key":"SOLR-4469","self":"https://issues.apache.org/jira/rest/api/2/issue/12632764","fields":{"summary":"A new IndexWriter must be opened on SolrCore reload when the index directory has changed and the previous SolrCore's state should not be propagated.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12364617","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12364617","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12632803","key":"SOLR-4471","self":"https://issues.apache.org/jira/rest/api/2/issue/12632803","fields":{"summary":"Replication occurs even when a slave is already up to date.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:34:17.427+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"In [SVN 1420992|http://svn.apache.org/viewvc?view=revision&revision=1420992], {{SolrCore#getIndexDir()}} changed it's implementation from a version that would reflect the value of the index property in {{index.properties}} to one that does not. \r\n\r\nIn 3.6, {{SolrCore#getIndexDir()}} was:\r\n{code:java}\r\npublic String getIndexDir() {\r\n  synchronized (searcherLock) {\r\n    if (_searcher == null)\t  \t\r\n      return dataDir + \"index/\";\r\n    SolrIndexSearcher searcher = _searcher.get();\r\n    return searcher.getIndexDir() == null ? dataDir + \"index/\" : searcher.getIndexDir();\r\n}\r\n{code}\r\n\r\nIn 3.6, {{SolrIndexSearcher}} would be passed the value of {{SolrCore#getNewIndexDir()}} -- which reads index.properties -- in its constructor and return it when {{SolrIndexSearcher#getIndexDir()}} was called.\r\n \r\nIn 4.1, {{SolrCore#getIndexDir()}} is:\r\n{code:java}\r\n  public String getIndexDir() {  \r\n    return dataDir + \"index/\";\r\n  }\r\n{code}\r\n\r\nClients of {{SolrCore#getIndexDir()}} that were expecting the previous behavior are likely to have issues. E.g.:\r\n\r\n--In {{CoreAdminHandler#handleUnloadAction(SolrQueryRequest, SolrQueryResponse)}} if the {{deleteIndex}} flag is set to true, it calls {{core.getDirectoryFactory().remove(core.getIndexDir())}}. If a value other than {{index/}} is set in {{index.properties}}, the wrong directory will be deleted.\r\n\r\n--In {{CoreAdminHandler#getIndexSize(SolrCore)}}, the existence of {{SolrCore#getIndexDir()}} is checked before {{SolrCore#getNewIndexDir()}}. If a value other than {{index/}} is set in {{index.properties}}, this will return the size of the wrong directory.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"312103","summary":"SolrCore#getIndexDir() contract change between 3.6 and 4.1","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=greggny3","name":"greggny3","emailAddress":"greggny3 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gregg Donovan","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=greggny3","name":"greggny3","emailAddress":"greggny3 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gregg Donovan","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":15,"total":15,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13574650","id":"13574650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"AFAICT this changed when I finished making Directory first class. You can't so easily get the index dir from the searcher (which got it from the fs directory). I'll see what we can do to improve it for 4.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-02-08T17:31:50.207+0000","updated":"2013-02-08T17:31:50.207+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13577092","id":"13577092","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=greggny3","name":"greggny3","emailAddress":"greggny3 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gregg Donovan","active":true},"body":"This patch is the full set of changes we needed to make the index.properties edit + core reload reindexing mechanism that we used in 3.6 work in 4.1.\r\n\r\nIn addition to the changes to SolrCore#getIndexDir(), we needed to check for a change of directory when the new SolrCore decided to either inherit a DirectoryFactory, DeletionPolicy, or UpdateHandler from the previous core or reuse the previous core's Directory for a searcher. In each case, the state from the previous core would cause problems when inherited by the new core.\r\n\r\nThe test suite passes with the full set of changes, but I'm not sure they should all be grouped in one JIRA or not. Mark -- please let me know if you think they should be broken out. If not, perhaps we should change the title of this ticket?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=greggny3","name":"greggny3","emailAddress":"greggny3 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gregg Donovan","active":true},"created":"2013-02-12T22:10:28.122+0000","updated":"2013-02-12T22:10:28.122+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13577129","id":"13577129","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"bq.  In each case, the state from the previous core would cause problems when inherited by the new core.\r\n\r\nCould you elaborate on these problems?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-02-12T22:48:02.930+0000","updated":"2013-02-12T22:48:02.930+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13577200","id":"13577200","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=greggny3","name":"greggny3","emailAddress":"greggny3 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gregg Donovan","active":true},"body":"bq. Could you elaborate on these problems?\r\n\r\n*SolrDeletionPolicy*\r\nIn Solr 4.1, a core reload sets the new deletion policy to be the previous core's {{IndexDeletionPolicyWrapper}}:\r\n{code:java}\r\n     SolrCore core = new SolrCore(getName(), getDataDir(), config,\r\n         schema, coreDescriptor, updateHandler, prev);\r\n     core.solrDelPolicy = this.solrDelPolicy;\r\n     return core;\r\n{code}\r\n\r\nThis would cause problems when trying to get the commit points because the commits from the previous directory would be inherited. In our case, we would start with an empty index at {{index/}}. Then, after a reindex, we would have a new index at {{index-<timestamp>/}} at generation 2 (we do one incremental after a reindex before swapping it in). When the ReplicationHandler tried to find the commits for generation 2 during replication, it couldn't find them. {{core.getDeletionPolicy().getCommits()}} would yield the map for {{index/}}, not {{index-<timestamp>/}}.\r\n\r\n\r\n*Directory*\r\nSolr 4.1 has an optimization to use the {{IndexWriter}} from the previous {{SolrCore}} to create a new {{DirectoryReader}}:\r\n{code:java}\r\n      // use the (old) writer to open the first searcher\r\n      RefCounted<IndexWriter> iwRef = null;\r\n      if (prev != null) {\r\n        iwRef = prev.getUpdateHandler().getSolrCoreState().getIndexWriter(null);\r\n        if (iwRef != null) {\r\n          final IndexWriter iw = iwRef.get();\r\n          newReaderCreator = new Callable<DirectoryReader>() {\r\n            @Override\r\n            public DirectoryReader call() throws Exception {\r\n              return DirectoryReader.open(iw, true);\r\n            }\r\n          };\r\n        }\r\n      }\r\n{code}\r\nIn our case, the old core refers to {{index/}} and the core being created is at {{index-<timestamp>/}}, so the {{DirectoryReader}} from the old core points to a directory that is no longer in use. After doing the index.properties update and core reload, the newly created {{SolrIndexSearcher}} would still point to {{index/}}. It would take an empty commit to get a new reader pointed at {{index-<timestamp>/}}.\r\n\r\n\r\n*UpdateHandler*\r\nThe {{UpdateHandler}} has a reference to the {{SolrCoreState}}/{{DefaultSolrCoreState}} which has a reference to the {{SolrIndexWriter}}. So, when we inherited the {{UpdateHandler}} from {{index/}} after the reload pointed to {{index-<timestamp>/}}, commits would still go to {{index/}}.\r\n\r\nIt's unfortunate to lose all of the stats in {{DirectUpdateHandler2}}, but maybe it makes sense to reset them anyway when the {{Directory}} changes?\r\n\r\n*DirectoryFactory*\r\nI should clarify: the reason for not inheriting {{DirectoryFactory}} from the previous core was not actually related to state. Rather, the current logic in 4.1 for whether to inherit the {{DirectoryFactory}} is:\r\n{code:java}\r\n      if (updateHandler == null) {\r\n        initDirectoryFactory();\r\n        solrCoreState = new DefaultSolrCoreState(getDirectoryFactory());\r\n      } else {\r\n        solrCoreState = updateHandler.getSolrCoreState();\r\n        directoryFactory = solrCoreState.getDirectoryFactory();\r\n        this.isReloaded = true;\r\n      }\r\n{code}\r\n\r\nI removed inheriting of the {{DirectoryFactory}} of the previous core because {{SolrCore#getNewIndexDir()}} uses {{this.directoryFactory}} to read {{index.properties}} and {{getNewIndexDir()}} was needed to determine whether the new core was using the same directory as the previous core. Perhaps this can be solved by creating a private version of {{SolrCore#getNewIndexDir}} that takes a {{DirectoryFactory}} as an argument? On second look I don't think I see state in {{DirectoryFactory}} that should cause problems when a new directory is used.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=greggny3","name":"greggny3","emailAddress":"greggny3 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gregg Donovan","active":true},"created":"2013-02-13T00:10:41.435+0000","updated":"2013-02-13T00:10:41.435+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13577267","id":"13577267","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"Thanks Gregg - not sure how soon I can get to this stuff, but I'll certainly try to help you address all of this for 4.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-02-13T01:43:02.903+0000","updated":"2013-02-13T01:43:02.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13577272","id":"13577272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=greggny3","name":"greggny3","emailAddress":"greggny3 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gregg Donovan","active":true},"body":"Thanks, Mark -- much appreciated. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=greggny3","name":"greggny3","emailAddress":"greggny3 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Gregg Donovan","active":true},"created":"2013-02-13T01:47:05.348+0000","updated":"2013-02-13T01:47:05.348+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13579800","id":"13579800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"bq. The UpdateHandler has a reference to the SolrCoreState/DefaultSolrCoreState which has a reference to the SolrIndexWriter. So, when we inherited the UpdateHandler from index/ after the reload pointed to index-<timestamp>/, commits would still go to index/.\r\n\r\nThat seems strange - we handle that in replication by starting up a new writer when we switch indexes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-02-16T14:51:07.370+0000","updated":"2013-02-16T14:51:07.370+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13579801","id":"13579801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"Can you try this patch and see how close it gets you? We may have to go back and forth once or twice.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-02-16T14:53:22.838+0000","updated":"2013-02-16T14:53:22.838+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13580105","id":"13580105","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"Actually, I think you probably need that patch + SOLR-4417","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-02-17T02:41:45.071+0000","updated":"2013-02-17T02:41:45.071+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13580302","id":"13580302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[trunk commit] Mark Robert Miller\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1447089\r\n\r\nSOLR-4413: Fix SolrCore#getIndexDir() to return the current index directory.\r\n\r\nSOLR-4469: A new IndexWriter must be opened on SolrCore reload when the index directory has changed and the previous SolrCore's state should not be  propagated.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-02-17T22:16:16.788+0000","updated":"2013-02-17T22:16:16.788+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13580307","id":"13580307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[branch_4x commit] Mark Robert Miller\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1447090\r\n\r\nSOLR-4413: Fix SolrCore#getIndexDir() to return the current index directory.\r\n\r\nSOLR-4469: A new IndexWriter must be opened on SolrCore reload when the index directory has changed and the previous SolrCore's state should not be  propagated.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-02-17T22:22:11.520+0000","updated":"2013-02-17T22:22:11.520+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13580313","id":"13580313","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"I opened SOLR-4469 for part of this. Everything is in now. Let me know where you run into problems.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-02-17T22:37:35.026+0000","updated":"2013-02-17T22:37:35.026+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13583042","id":"13583042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anithian","name":"anithian","emailAddress":"ANithian at vt dot edu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amit Nithian","active":true},"body":"Is there a way to get this into a minor release of 4.1 (4.1.1 or something). I think this is impacting the replication handler because if you have your index currently located in an index.<timestamp> directory, a full download will inadvertently always happen because none of the local files will exist since it's thinking the index dir is \"index/\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=anithian","name":"anithian","emailAddress":"ANithian at vt dot edu","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Amit Nithian","active":true},"created":"2013-02-21T09:27:01.091+0000","updated":"2013-02-21T09:27:01.091+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13583779","id":"13583779","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elyograg","name":"elyograg","emailAddress":"apache at elyograg dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=elyograg&avatarId=20749","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=elyograg&avatarId=20749","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=elyograg&avatarId=20749","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=elyograg&avatarId=20749"},"displayName":"Shawn Heisey","active":true},"body":"Amit, as I am not a Lucene/Solr committer, I cannot give you an authoritative answer, but I can offer my best guess.  I do not think there will be a 4.1.1 release.  There is already a pledge by one committer to get 4.2 released in the next 2-3 weeks.  It takes almost as much developer effort for a point release as a new minor version, so the effort usually goes towards the new minor version.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=elyograg","name":"elyograg","emailAddress":"apache at elyograg dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=elyograg&avatarId=20749","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=elyograg&avatarId=20749","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=elyograg&avatarId=20749","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=elyograg&avatarId=20749"},"displayName":"Shawn Heisey","active":true},"created":"2013-02-22T01:14:17.391+0000","updated":"2013-02-22T01:14:17.391+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12631261/comment/13654174","id":"13654174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"body":"Closed after release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thetaphi","name":"thetaphi","emailAddress":"uwe at thetaphi dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=thetaphi&avatarId=18956","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=thetaphi&avatarId=18956","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=thetaphi&avatarId=18956","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=thetaphi&avatarId=18956"},"displayName":"Uwe Schindler","active":true},"created":"2013-05-10T10:34:17.424+0000","updated":"2013-05-10T10:34:17.424+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-4413/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1hsv3:"}}