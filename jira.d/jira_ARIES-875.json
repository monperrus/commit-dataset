{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12598995","self":"https://issues.apache.org/jira/rest/api/latest/issue/12598995","key":"ARIES-875","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12322492","id":"12322492","name":"blueprint-core-1.0.1","archived":false,"released":true,"releaseDate":"2012-09-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-07-24 07:07:42.272","customfield_12312323":null,"customfield_12310420":"246108","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_704964017_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-07-24T20:39:44.182+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-875/watchers","watchCount":2,"isWatching":false},"created":"2012-07-16T16:50:20.242+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-24T20:39:44.234+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313048","id":"12313048","name":"Blueprint","description":"OSGi Blueprint Services implementation"}],"timeoriginalestimate":null,"description":"I discovered this when trying to use the \"ConfigurationAdmin\"-service in both blueprint and a BundleActivator. Normally this should work but I get this Exception \r\n{code}\r\njava.lang.NullPointerException\r\n\tat org.apache.felix.cm.impl.ConfigurationAdminImpl.getConfiguration(ConfigurationAdminImpl.java:105)\r\n\tat my.playground.bundle.Activator$ConfigThread.run(Activator.java:29)\r\n{code}\r\nThis is because this ConfigurationAdminImpl has been \"disposed\" after blueprint called \"ungetService\" in ReferenceRecipe#unbind().\r\n\r\nNormally this should go like this:\r\nactivator gets ConfigAdmin-service\r\nblueprint gets ConfigAdmin-service\r\nblueprint ungets ConfigAdmin-service (reference-counter still > 0, so it is not destroyed)\r\nactivator ungets ConfigAdmin-service (reference-counter is now 0, so the dispose-method in the ConfigAdmin is called).\r\n\r\nBut what happens is this:\r\nactivator gets ConfigAdmin-service\r\nblueprint ungets ConfigAdmin-service (reference-counter is now 0, so the dispose-method in the ConfigAdmin is called).\r\nactivator throws NPE because the ConfigAdmin-service has been destroyed.\r\n\r\nThe Problem is that calling ReferenceRecipe#unbind() always *ungets* the service, but ReferenceRecipe#bind() does not *get* the service. Thus the *unget*-operation invalidates the service-reference for some other thread.\r\n\r\nI attached a small demo-bundle to show the behaviour. Deploying it in a karaf-3.0.0-SNAPSHOT should show the NPE on the console.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"41583","summary":"ReferenceRecipe may \"unget\" a service without ever \"getting\" it","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"karaf-3.0.0-SNAPSHOT, Aries-1.0.0-SNAPSHOT","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12598995/comment/13415376","id":"13415376","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"body":"Source and compiled jar for the demo-bundle.\r\nJust deploy it in a Karaf-3.0.0-SNAPSHOT.\r\n(It works correctly in karaf-2.2.5)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"created":"2012-07-16T16:52:46.101+0000","updated":"2012-07-16T16:52:46.101+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12598995/comment/13415378","id":"13415378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"body":"Patch that would fix the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"created":"2012-07-16T16:53:42.646+0000","updated":"2012-07-16T16:53:42.646+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12598995/comment/13421230","id":"13421230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"body":"I think the goal was to have a lazy getService call in order to avoid creating services until actually needed (for example blueprint exposes a ServiceFactory and will delay the actual initialization of the service until asked for).  So I guess it would be better to track if getService has been called and only call ungetService when appropriate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"created":"2012-07-24T07:07:42.272+0000","updated":"2012-07-24T07:07:42.272+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12598995/comment/13421414","id":"13421414","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"body":"attached alternative patch that fixes bind() and unbind() to only call ungetService when getService was called.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=christophg","name":"christophg","emailAddress":"christoph dot gritschenberger at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christoph Gritschenberger","active":true},"created":"2012-07-24T13:47:21.966+0000","updated":"2012-07-24T13:47:40.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12598995/comment/13421740","id":"13421740","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"body":"http://svn.apache.org/viewvc?rev=1365271&view=rev","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"created":"2012-07-24T20:39:44.219+0000","updated":"2012-07-24T20:39:44.219+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-875/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07hdz:"}}