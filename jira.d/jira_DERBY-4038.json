{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12413579","self":"https://issues.apache.org/jira/rest/api/latest/issue/12413579","key":"DERBY-4038","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-07-03 11:20:10.124","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23983","customfield_12310222":"1_*:*_1_*:*_29952039047_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-01-11T17:00:12.063+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4038/watchers","watchCount":0,"isWatching":false},"created":"2009-01-30T00:59:33.016+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313142","id":"12313142","description":"","name":"10.3.3.0","archived":false,"released":true,"releaseDate":"2008-05-12"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-12T22:24:22.786+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"On Z/OS access.sql fails for encryptionAES and encryptionDES. The diff is big but I can't quite make out what the problem is. Maybe just a change of query plans.\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37717","summary":"On Z/OS store/access.sql fails with encryptionAES and encryptionDES","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"java version \"1.6.0\"\r\nJava(TM) SE Runtime Environment (build pmz6460sr3-20081108_01(SR3))\r\nIBM J9 VM (build 2.4, J2RE 1.6.0 IBM J9 2.4 z/OS s390x-64 jvmmz6460-20081107_25433 (JIT enabled, AOT enabled)\r\nJ9VM - 20081105_025433_BHdSMr\r\nJIT  - r9_20081031_1330\r\nGC   - 20081027_AB)\r\nJCL  - 20081106_01\r\n$ pwd","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":13,"total":13,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12668686","id":"12668686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attaching diff and out files for the test failure.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-01-30T01:00:39.044+0000","updated":"2009-01-30T01:00:39.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12726897","id":"12726897","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Triaged for 10.5.2. Removed store component.\r\n\r\nI compared the attached access.out with the canon in the 10.3 branch. The only difference I found was that on some of the lines in the attached file tab characters had been replaced by a \\u00 character.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-07-03T11:20:10.124+0000","updated":"2009-07-03T11:20:10.124+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12779014","id":"12779014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I have played with this for a while, and I've come to 3 conclusions:\r\n1. Knut is right, it seems the only diff is that in some parts of the runtime statistics output the tabs have been replaced by another character\r\n2. This is intermittent.\r\n Kathey reported the failure in the platform tests for 10.5.1.0 and 10.5.1.1 but not for (the discarded) 10.5.2.0.\r\nI ran encryptionAll on a zseries machine a couple of times and never got a failure. I ran derbyall a couple of times and access.sql failed once in encryptionBlowfish - with the character-replacement happening in about 18 instances (as opposed to 7 in the log Kathey attached).\r\n3. the diff output created by the test is singularly unhelpful.\r\n\r\nIt's possible there's something wrong with the generateUTF8OutFile code in functionTests.harness.RunTest; I'm not sure why that would be intermittent though.\r\nOne way to fix this would be to convert the test to junit.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-11-17T17:54:09.441+0000","updated":"2009-11-17T17:54:09.441+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12779290","id":"12779290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I forgot to mention that I ran tests with 10.5.1.1 - because no errors got reported with 10.5.2.0, I wanted to make sure I could duplicate the behavior where it had been reported.\r\n\r\nAfter looking some more, it appears to me that in the one error situation I got (encryptionBlowfish with 18 diffing sections) the .tmp and .out are diffing in the tab characters; so that would point to something not being correct in the Sed class rather than the generateUTF8OutFile method.\r\n\r\nconverting to junit still is the correct thing to do.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-11-18T04:40:04.912+0000","updated":"2009-11-18T04:40:04.912+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12785672","id":"12785672","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I've been working on converting access.sql; and I noticed that section testing \"partial row runtime statistics\" actually has a section that's not doing what it was meant to do judging by the comments; it looks as if there's supposed to be 4 iterations\r\n - no index\r\n - with index\r\n - no index, deleted rows\r\n - with index, deleted rows\r\nBut, because the index does not get dropped anywhere, we get an error creating the index for the fourth iteration, and the 3rd and 4th iterations are exactly the same. \r\nPerhaps the 4th iteration was copied by mistake, for I see that without index, you don't see the \"deleted rows visited\" line in the statistics. \r\nStill, when running the queries without an index but with deleted rows the statistics show a different (higher) number of total rows visited, so I'll be modifying the converted test to exercise that combination too.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-12-04T00:30:16.285+0000","updated":"2009-12-04T00:30:16.285+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12789461","id":"12789461","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I'm attaching a patch that's a first attempt at converting this test.\r\n\r\nI made a few changes where I figured the original test was doing something odd:\r\n- as indicated in a previous comment, changed the sequence of events and updating of statistics in the partial row runtime statistics test case / fixture so it's now doing 4 different things. In doing so, there's no longer a duplicate index warning returned for a create index foo_cover statement; I assumed generating that error that wasn't the point of the test.\r\n- changed the table in the CheckTable call in CS track 2241 test case from 'FOO' to B2441, assuming it was meant to check the table in the test case at hand.\r\n- fixed up test case for cs track 2778:\r\n  - made the create index work\r\n  - fixed up the call using --derby-properties which for some reason gave a syntax error. \r\n- added a few select statements to CS495B (because then I could filter out\r\n  a method to do the test 3 times)\r\n- removed the call to procedure WAIT_FOR_POST_COMMIT as it didn't appear to\r\n  be used anywhere.\r\n\r\nI still need to:\r\n- add it into store._Suite.java (and run suites.All to make sure this test doesn't interfere with other tests)\r\n- hang the encryption scenarios around this one \r\n  (the access.sql test is run with encryption Algorithms AES,Blowfish,CFB,DES,ECB,OFB (through various encryption<ABC>.runalls) and DESede (through encryption all running storemats))\r\n\r\nHowever, I'd like some input on this conversion so far.\r\n- Was I misinterpreting the use of WAIT_FOR_POST_COMMIT? What would be the purpose of it?\r\n- I added more questions in //TODOs within the converted test, the main of which are that it seems to me some of the test cases don't seem to do any checking of what they're supposed to check. For instance, the reclaim deleted rows doesn't seem to check anything is reclaimed.\r\n- Are there obvious improvements to the flow of the test framework?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-12-11T19:01:51.288+0000","updated":"2009-12-11T19:01:51.288+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12790899","id":"12790899","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"comments from review of the patch:\r\n\r\n\r\n> - removed the call to procedure WAIT_FOR_POST_COMMIT as it didn't appear to\r\n> be used anywhere.\r\nsounds good, it is not called so remove all reference to it.\r\n>\r\n> - Was I misinterpreting the use of WAIT_FOR_POST_COMMIT? What would be the pur\r\npose of it?\r\nIt is not called, leftover cruft.\r\n\r\n\r\ncomments on TODO's:\r\n+        // TODO: check on what the following comment from the original test\r\n+        // means. I don't think this test is currently checking whether the\r\n+        // optimizer is picking the index, might be worthwhile adding it.\r\n\r\nAt this point not sure history of this, I would just remove comment.\r\n\r\n+        // as subset of columns, with qualifier not in list\r\n+        //TODO: this comment is not matching the expected results. OK?\r\n+        // should be 5,3,1 and 50,30,10\r\n+        doQuery(st, \"select e, c, a from foo where foo.b = 20\",\r\ncomment looks bad, just fix the comment.\r\n\r\n+    // TODO: how does this check that rows are reclaimed or not? How?\r\nlooks like all work was moved to the subroutine, so probably should move\r\ncomments to the subroutine from the caller.  At least the part of the comments\r\nthat make sense.\r\n\r\nThe code just tries to exercise the post commit path, but agree that it does\r\nnot specifically verify the reclaim.  This is hard to do from a user level\r\ntest, in a way that is reproducible across different hardware, jvms.  The\r\nvalues are just hand picked to exercise different paths through the code.\r\nOne could try to use space table to verify sizes of the tables, but this\r\nhas caused non-reproducible results in cases where timing of background threads\r\nare different.\r\n\r\n// TODO: change this call into a call to SYSCS_DIAG.SPACE_TABLE\r\nI agree, it should use the current supported interface.\r\n\r\n+        // TODO: original test had 1 pages visited.\r\n+        // But now that it's converted, we get 0 pages, which also\r\n+        // seems reasonable to me. Or not?\r\nThis seems like it might be a problem.  Can you print out the full query\r\nplan on failure of the assert.  It is hard to know what is going on from\r\njust this one piece of info.\r\n\r\nThe main point of this test is that is should use the index whether there\r\nare zero or 1 rows.  We choose to force this because if we use index we get\r\nrow level locking, but if we use table scan we are going to get table level\r\nlocking - so better concurrency in the edge case.\r\n\r\n+    // TODO: in which way does this check qualifiers?\r\nqualifiers are just things like a = 1 and b = 20.  When test was written the\r\ncode in language and store to evaluate these were changing.  The changes\r\nespecially had some new logic to handle \"and\" and \"or\".  So the test just\r\nhas some of these cases and tests them by making sure the right results\r\ncome back.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2009-12-15T19:19:27.264+0000","updated":"2009-12-15T19:19:27.264+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12792265","id":"12792265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a second patch. \r\nI've run the test in the suite, and there were 2 NPE failures in unrelated tests because of my changes to the runtimestatisticsParser, so I've fixed that up.\r\nI've also removed a coupld of the TODOs that seemed to be ok.\r\n\r\nI've tried to figure out why the converted test fixtures regarding CS track 4595 show 0 pages visited instead of 1 (with index scans) but I'm no closer.\r\nI've printed them out instead of letting it assert - \r\nin the way this test works currently, various subsequent test fixtures in this same test will fail if one fails, because tables won't get dropped.\r\nI'm attaching the output from the test.\r\n\r\nI'll work on adding the proper SYSCS_DIAG.Spacetable calls next, this patch isn't ready for commit yet.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-12-18T01:07:56.624+0000","updated":"2009-12-18T01:07:56.624+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12794895","id":"12794895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching a 3rd patch. \r\nI think this addresses the previous comments, including using SYSCS_DIAG.SpaceTable calls. The problem with the 0 pages visited was (duh) because no data was actually fetched in the converted test - after I added a check the statistics do show 1 pages visted.\r\n\r\nMy next step is to run this test through the various encryptions.\r\n\r\nI tried to add this test to suites.EncryptionSuite.baseSuite, which then looked like this:\r\n------------\r\n        TestSuite suite = new TestSuite(\"Encryption Algorithm: \" + algorithm);\r\n        //...\r\n        suite.addTestSuite(EncryptionSuite.class);\r\n        suite.addTestSuite(org.apache.derbyTesting.functionTests.tests.store.AccessTest.class);\r\n       return suite;\r\n------------\r\nbut that resulted in the decorateSQL in AccessTest not being honored. \r\n\r\nDoes anyone have a suggestion how to put those two pieces of the puzzle together?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-12-28T19:33:35.015+0000","updated":"2009-12-28T19:33:35.015+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12796317","id":"12796317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I have played with various scenarios...\r\nI can modify AccessTest fixtures to create the PADSTRING stored procedure without using the decorateSQL...\r\nOr I can modify EncryptionSuite to have a setUp and tearDown method to create and shutdown the stored procedure...\r\n\r\nBut the SystemPropertyTestSetup and the Decorator.encryptedDatabase don't work together, because for SystemPropertyTestSetup the database has to be rebooted and the required boot password  is local to Decorator.encryptedDatabase().\r\n\r\nI'll experiment getting a EncryptedSystemPropertyTestSetup, but in the mean time, really the only bit that's affected by not having the SystemProperties is that in the test case for CS1346 (a and b), half the time the length(a) of long1 and long2 is different when we have the property derby.optimizer.ruleBasedOptimization set to true (3240) vs. when it is false (3024).\r\n(the other half of the time it's already 3024 characters). \r\n\r\nIs that part of the test important to be verified with encryption?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2010-01-04T19:41:15.114+0000","updated":"2010-01-04T19:41:15.114+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12797197","id":"12797197","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I would be fine getting the test to run without that property.  I did some investigation and don't see any reason for it for the validity of the test.  My best guess is this is one way a long time ago we used to try to avoid intermittent query plan / ordering problems.\r\n\r\nLooking at the original test I see one of the results is as follows.  Any chance what you are seeing is not \"different\" lengths but different orders.  In that case I would say just throw an order by in and don't worry about the property:\r\n\r\nij> select LENGTH(a) from long2;\r\n1\r\n-----------\r\n3240\r\n3240\r\n3240\r\n3240\r\n3240\r\n3240\r\n3240\r\n3240\r\n3240\r\n3240\r\n3024\r\n3024\r\n3024\r\n3024\r\n3024\r\n3024\r\n3024\r\n3024\r\n3024\r\n3024","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2010-01-06T17:45:57.066+0000","updated":"2010-01-06T17:45:57.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12797799","id":"12797799","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Indeed the difference with that property was an ordering differrence.\r\nI'm uploading patch DERBY-4038.diff_4 which has added order by clauses to the statements showing an ordering difference depending on the property.\r\nSo, now the test willrun *with* the property when it's just the test, but without when the databases are encrypted.\r\nIn this patch I also removed the old access.sql test.\r\nRegressions ran fine.\r\n\r\nI intend to commit this  in a day or so if there are no further comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2010-01-07T21:47:06.099+0000","updated":"2010-01-07T21:47:06.099+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12413579/comment/12798731","id":"12798731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"commited the latest patch with revision 897938.\r\n\r\nIn the past, some of the steps in the access.sql test caused instability (i.e. intermittent errors), specifically in the area of the spacetable checks. The offending checks were removed (see revision 393896), but it's possible that the converted test has some of this. I think those should be handled in separate JIRA issues; the main problem of this issue has been corrected.\r\n(I did run suites.All without errors on zseries with patched jars).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2010-01-11T17:00:11.950+0000","updated":"2010-01-11T17:00:11.950+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4038/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06tiv:"}}