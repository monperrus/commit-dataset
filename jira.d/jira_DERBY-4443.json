{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12440778","self":"https://issues.apache.org/jira/rest/api/latest/issue/12440778","key":"DERBY-4443","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315436","id":"12315436","description":"Head of 10.5 branch - version bump for DERBY-4835","name":"10.5.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315434","id":"12315434","description":"Head of 10.6 branch as of 2014-01-13","name":"10.6.2.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315902","id":"12315902","description":"Head of 10.7 branch as of 2010-11-29","name":"10.7.1.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-06-29 22:26:23.388","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24258","customfield_12310222":"1_*:*_1_*:*_45511565843_*|*_6_*:*_4_*:*_24895382910_*|*_5_*:*_1_*:*_2971440724_*|*_4_*:*_3_*:*_797218729","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-03-23T22:43:31.428+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4443/watchers","watchCount":0,"isWatching":false},"created":"2009-11-16T10:23:23.573+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_triage10_8"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"9.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314117","id":"12314117","description":"Next release after 10.5.2.0 release candidate #1","name":"10.5.3.0","archived":false,"released":true,"releaseDate":"2009-08-21"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12349273","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12349273","type":{"id":"12310040","name":"Required","inward":"is required by","outward":"requires","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310040"},"inwardIssue":{"id":"12546430","key":"DERBY-5654","self":"https://issues.apache.org/jira/rest/api/2/issue/12546430","fields":{"summary":"10.5 Backport issue (2012)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-03-23T22:43:31.726+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11670","id":"11670","name":"Demos/Scripts"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11406","id":"11406","name":"Documentation"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12310670","id":"12310670","name":"Eclipse Plug-in"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11690","id":"11690","name":"Network Client"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"},{"self":"https://issues.apache.org/jira/rest/api/2/component/12312050","id":"12312050","name":"Replication"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11415","id":"11415","name":"Services"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11414","id":"11414","name":"Tools"}],"timeoriginalestimate":null,"description":"Avoid this pattern everywhere:\r\n\r\n\t\t}catch(SQLException se){\r\n\t\t\t//issue a rollback on any errors\r\n\t\t\tconn.rollback();\r\n\t\t\tthrow  se;\r\n\t\t}\r\n\r\nbecause an error in rollback will shadow the original exception.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35850","summary":"Wrap rollback in exception handlers in try-catch","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10423","value":"Newcomer","id":"10423"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10053","value":"Low","id":"10053"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":54,"total":54,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/12778286","id":"12778286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"One place where I've seen this is SystemProcedures. Every method in there uses this anti-pattern.\r\n\r\nInstead of calling rollback directly, a utility function should be defined which either ignores any exceptions in rollback or, preferred, prints/logs the exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-11-16T10:25:14.250+0000","updated":"2009-11-16T10:25:14.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/12883733","id":"12883733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"removing store, as it does not have access to the connection or to SQLException.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2010-06-29T22:26:23.388+0000","updated":"2010-06-29T22:26:23.388+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/12994473","id":"12994473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Triaged for 10.8.   A solution would be to chain the SQLExceptions so both would be returned to the user. Good newcomer issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-02-14T20:28:17.466+0000","updated":"2011-02-14T20:28:17.466+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13003098","id":"13003098","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"I think it's a good point for a new comer. I have provided a patch. In my patch, a method named rollBackWhenSQLExceptionOccurs() is added. I'm not sure there is any other place to use this method , if so, it's better to add this method in an independent util class.\r\n\r\nPlease check it and give some advice, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-06T05:35:29.890+0000","updated":"2011-03-06T05:37:31.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13003238","id":"13003238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"It would be nice if the patch could include a new test which demonstrates the modified behavior\r\nthat occurs with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-07T02:22:50.299+0000","updated":"2011-03-07T02:22:50.299+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13003361","id":"13003361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"It's a good suggestion, Bryan.\r\n\r\nIn fact, I have tried to do some unit testing before submitting the patch. However, I've found neither of the four methods which are affected in this patch is called through out the derby project. Furthermore there is not a test class named with \"SystemProceduresTest\". So, I'm puzzled where to add the test cases.\r\n\r\nPlease give a further advice to help me advance!\r\n\r\nThanks a lot!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-07T14:16:09.154+0000","updated":"2011-03-07T14:16:09.154+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13004365","id":"13004365","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think that the system procedures are called through a clever sort of reflection mechanism, which is why\r\nyou don't see a direct call mechanism in place. Here's a link to these procedures, showing how to\r\ninvoke them: http://db.apache.org/derby/docs/10.7/ref/crefsqlbuiltinsystemprocedures.html\r\n\r\nRegarding an existing test suite, I think that this test suite should run these procedures:\r\norg.apache.derbyTesting.functionTests.tests.tools.ImportExportProcedureTest\r\nThe code for that test is in \r\njava/testing/org/apache/derbyTesting/functionTests/tests/tools/ImportExportProcedureTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-09T04:36:03.405+0000","updated":"2011-03-09T04:36:03.405+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13007479","id":"13007479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Thanks very much, Bryan! As I have been busy with my school affairs, I has just seen your advice, and it is valuable for me. I will go on, and provide a new patch some days later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-16T14:07:21.375+0000","updated":"2011-03-16T14:07:21.375+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13007483","id":"13007483","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Hi, Bryan. I have still another question: How to invoke a failure of \"roll back\" in testing? I need to invoke failures of \"roll back\" to validate my checking. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-16T14:23:37.674+0000","updated":"2011-03-16T14:23:37.674+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13007489","id":"13007489","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think this may be rather tricky. Perhaps other developers have a good idea. One technique,\r\nwhich is artificial, is to deliberate modify the code for rolllback so that it fails. Of course,\r\nthat would not be a permanent change, just a temporary one so that you can exercise your\r\nother altered code paths.\r\n\r\nI suspect that this modification may be rather a hard one to test, unfortunately, so you\r\nmay have to resort to some unusual techniques.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-16T14:37:53.235+0000","updated":"2011-03-16T14:37:53.235+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13007637","id":"13007637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"The usual solution is to use a mock connection that throws Exceptions when rollback() is called.\r\n\r\nIf you look at the code, then you'll see that the connection is created with a call to getDefaultConn(). This will query the InternalDriver for a connection.\r\n\r\nIn your tests, extend InternalDriver and override connect() to return a connection object which throws exceptions for prepareStatement() and rollback():\r\n\r\n@Override\r\npublic PreparedStatement prepareStatement(String sql) { throw SQLException( \"Error in prepareStatement\" ); }\r\n\r\n@Override\r\npublic void rollback() { throw SQLException( \"Error in rollback\" ); }\r\n\r\nMake sure that correct exception is visible outside.\r\n\r\nNote that this messes with internal static variables. To fix that, you may need to create a new driver instance in the tearDown() of your tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2011-03-16T19:20:37.779+0000","updated":"2011-03-16T19:20:37.779+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13007926","id":"13007926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Thanks for your advice, Aaron. \r\n\r\nMock extending InternalDriver seems a good idea. Overriding prepareStatement(String sql) can throw a SQLException for invoking code for rollback, and overriding rollback() can test the new wrapping!\r\n\r\nHowever, I'm still puzzled. It's related to a key problem---- How to inject the mock for SystemProcedures when testing? \r\n\r\nWish for your reply!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-17T14:23:58.284+0000","updated":"2011-03-17T14:23:58.284+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13007930","id":"13007930","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Run the code in a debugger. You will see that the static variable which contains the current InternalDriver is set in the constructor of InternalDriver. So you just need to extend the class, call new on your version and call the system procedure.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2011-03-17T14:34:53.753+0000","updated":"2011-03-17T14:34:53.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13008780","id":"13008780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Yes, Aaron, I have seen the static variable set in the constructor of InternalDriver in the prospective of debugging when Driver40 is installed. As I'm not familiar with DERBY, could you tell me how to \"call new on your version\", please?  That is, how to install my mocking subclass of  InternalDriver in my testing.\r\n\r\nThanks very much!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-19T14:44:09.280+0000","updated":"2011-03-19T14:44:09.280+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13008784","id":"13008784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"I think this is beyond the scope of the bug report. Please ask your questions on stackoverflow.com.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2011-03-19T15:12:36.294+0000","updated":"2011-03-19T15:12:36.294+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13008786","id":"13008786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Often I find that the best way to move forward with a problem is to try writing the code that\r\nyou think you want to write (in this case, a class that would sub-class InternalDriver, perhaps\r\nnamed MockInternalDriver), try\r\nplacing a call to\r\n    InternalDriver myDriver = new MockInternalDriver();\r\nsomewhere in the setUp() method of ImportExportProcedureTest, try it out, and\r\nsee what happens.\r\n\r\nYou can probably put the MockInternalDriver code directly into ImportExportProcedureTest,\r\nas a nested class, so you don't have to create any new source files to do this.\r\n\r\nPut some System.out.println statements into your mock class, so you can see\r\nwhether it is getting run or not, and where it is being used.\r\n\r\nIt probably won't work. But, then you can attach an updated patch, containing the\r\nactual code that you tried, and describe what it did and what you wanted it to do instead.\r\n\r\nIn essence: try writing some code, see how far you get, atttach the code you tried, and\r\na description of where exactly you got stuck, and the community will offer some\r\nsuggestions about what to try next.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-19T15:53:14.390+0000","updated":"2011-03-19T15:53:14.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13008891","id":"13008891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Oh, thanks, Bryan. Your advice is great! I will remember to give a patch before launch a discussion.\r\n\r\nI have written some testing code before, just like I do in the new patch. In the patch, I do \"new MockInternalDriver();\" in the setup() method of my junit test class, however, this sentence will throw a exception as InternalDriver() will check its contextServiceFactory is null.\r\n\r\nI think the key point is to decide where to install the mock of InternalDriver to give it a normal running circumstance, maybe it's related to some .\r\n\r\nComments are welcome.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-20T08:31:24.502+0000","updated":"2011-03-20T08:31:24.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13008910","id":"13008910","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I modified the setUp() method of your patch so that it looks like this:\r\n\r\n\r\n    protected void setUp()\r\n        throws Exception\r\n    {\r\n        System.out.println(\"setUp is called!\");\r\n        openDefaultConnection();\r\n        MockInternalDriver dvr = new MockInternalDriver();\r\n        dvr.stop();\r\n        dvr.boot(false, null);\r\n    }\r\n\r\n\r\nand now the test gets considerably further. It gets to the point where\r\nit tries to make a new connection, and then fails.\r\n\r\nI think that your connect() method in your MockInternalDriver\r\nmust do more than just return an empty MockConnection().\r\n\r\nI think that you have to call super.connect(url, info), and then\r\ntake the real connection that the superclass creates and wrap\r\nthat connection in your MockConnection.\r\n\r\nSo your connect() method should probably look something like:\r\n\r\n    return new MockConnection(super.connect(url, info));\r\n\r\nand your MockConnection class will need to have a private\r\ninternal Connection object that it delegates to.\r\n\r\nDoes that make sense? Hopefully this helps you get further\r\nin building your test case.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-20T15:28:27.933+0000","updated":"2011-03-20T15:28:27.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13010127","id":"13010127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Thanks Bryan very much!\r\n\r\nI have tried following your advice, now, in the new patch, the MockInternalDriver can be instanced and its connect(String url, Properties info) is called indeed, however, its super.connect(url, info) throws a NullException. It seems this way is not OK. I still faced the same question--how to mock a rollback as expected.\r\n\r\nWish for your comments! ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-23T14:01:18.123+0000","updated":"2011-03-23T14:01:18.123+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13010131","id":"13010131","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Can you paste in the NPE exception that you get, with its stack trace?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-23T14:13:57.138+0000","updated":"2011-03-23T14:13:57.138+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13010155","id":"13010155","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Certainly, Bryan.\r\n\r\nsetUp is called!\r\n---------test---------\r\nMockInternalDriver.connect() is called!\r\njava.lang.NullPointerException\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.<init>(TransactionResourceImpl.java:161)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.java:234)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection30.<init>(EmbedConnection30.java:73)\r\n\tat org.apache.derby.jdbc.Driver30.getNewEmbedConnection(Driver30.java:80)\r\n\tat org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:248)\r\n\tat org.apache.derbyTesting.functionTests.tests.tools.RollBackWrappingWhenFailOnImportTest$MockInternalDriver.connect(RollBackWrappingWhenFailOnImportTest.java:56)\r\n\tat org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:582)\r\n\tat java.sql.DriverManager.getConnection(DriverManager.java:154)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:81)\r\n\tat org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(DriverManagerConnector.java:43)\r\n\tat org.apache.derbyTesting.junit.TestConfiguration.openDefaultConnection(TestConfiguration.java:1574)\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.openDefaultConnection(BaseJDBCTestCase.java:428)\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.getConnection(BaseJDBCTestCase.java:110)\r\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.prepareCall(BaseJDBCTestCase.java:317)\r\n\tat org.apache.derbyTesting.functionTests.tests.tools.RollBackWrappingWhenFailOnImportTest.testRollBackWhenFailOnImportTable(RollBackWrappingWhenFailOnImportTest.java:90)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat junit.framework.TestCase.runTest(TestCase.java:164)\r\n\tat junit.framework.TestCase.runBare(TestCase.java:130)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)\r\n\tat junit.framework.TestResult$1.protect(TestResult.java:106)\r\n\tat junit.framework.TestResult.runProtected(TestResult.java:124)\r\n\tat junit.framework.TestResult.run(TestResult.java:109)\r\n\tat junit.framework.TestCase.run(TestCase.java:120)\r\n\tat junit.framework.TestSuite.runTest(TestSuite.java:230)\r\n\tat junit.framework.TestSuite.run(TestSuite.java:225)\r\n\tat org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)\r\n\tat org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)\r\n\tat org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-23T14:45:55.202+0000","updated":"2011-03-23T14:45:55.202+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13010546","id":"13010546","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think that the suggestion I made in an earlier comment, about including the lines\r\n\r\n    dvr.stop();\r\n    dvr.boot(false, null);\r\n\r\nwas not good advice. Those lines are what is causing your current NPE.\r\n\r\nI removed the calls to dvr.stop() and dvr.boot() from the setUp() method of\r\nthe test, and I get much further.\r\n\r\nCan you try making that change in your copy, and see if that gets you further?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-24T03:37:09.937+0000","updated":"2011-03-24T03:37:09.937+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13010726","id":"13010726","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Oh, good message, Bryan! Thanks to your patient advice, I think we have get closer to the aim.\r\n\r\nI have remove the lines \r\n\r\n    dvr.stop();\r\n    dvr.boot(false, null); \r\n, yes the test can run further, but the MockInternalDriver.connect() is not called nay more.\r\n\r\nIf keep the \"dvr.boot(false, null); \", we get what we want just like in patch-3, the MockConnection is created and rollBack() failed as expected.\r\n\r\nI have sumbitted the DERBY-4443-3.patch. Please check it. If it's OK, I will add more test cases, clean code and give a final version.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-24T15:54:17.420+0000","updated":"2011-03-24T15:54:17.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13011014","id":"13011014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Excellent! I am pleased that this approach appears to work. I think that we will\r\nwant to include some comments in the header of the new test to describe the\r\nuse of the Mock testing objects, and to briefly outline the use of the 'dvr.boot'\r\nmethod to install our new mock driver into the test.\r\n\r\nI think you should proceed with this work; it will be great to have the fix, and\r\neven better that we'll have a regression test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-24T23:40:35.765+0000","updated":"2011-03-24T23:40:35.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13011637","id":"13011637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Hi, Bryan. Thanks for your great encourage!\r\n\r\nI have finished the other test cases on importing, cleaned the code, added anotation. Please check it. Thanks again!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-26T14:44:02.409+0000","updated":"2011-03-26T14:44:02.409+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13011647","id":"13011647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"This latest patch is looking pretty good to me: the code changes look clear and\r\nstraightforward, the test looks clear and to-the-point. The test passes for me\r\nwith the patch applied; it also fails as I expect when the code change to\r\nSystemProjects.java is reverted, so the test seems to be testing the change\r\nsuccessfully.\r\n\r\nAaron, you mentioned in the original issue description that we might need to\r\nmake this change in multiple places in Derby; are you aware of any places\r\nbesides SystemProcedures.java where we issue unprotected rollback()\r\ncalls like this?\r\n\r\nI suppose I'm trying to figure out whether this patch would resolve this issue\r\ncompletely, or whether it is a partial solution, and we will need to make\r\nsimilar changes in subsequent patches.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-26T15:42:34.204+0000","updated":"2011-03-26T15:42:34.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13011707","id":"13011707","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"When I run the new test as part of the complete JUnit suite, I see the following exception in my output:\r\n\r\n\r\n..........java.sql.SQLException: Derby system shutdown.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)\r\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\r\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:158)\r\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:222)\r\n        at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:243)\r\n        at org.apache.derbyTesting.functionTests.tests.tools.RollBackWrappingWhenFailOnImportTest$MockInternalDriver.connect(RollBackWrappingWhenFailOnImportTest.java:63)\r\n        at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:144)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:582)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:154)\r\n        at org.apache.derbyTesting.junit.DriverManagerConnector.getConnectionByAttributes(DriverManagerConnector.java:143)\r\n        at org.apache.derbyTesting.junit.DriverManagerConnector.shutEngine(DriverManagerConnector.java:120)\r\n        at org.apache.derbyTesting.junit.TestConfiguration.shutdownEngine(TestConfiguration.java:1635)\r\n        at org.apache.derbyTesting.functionTests.tests.engine.ErrorStreamTest.setUp(ErrorStreamTest.java:101)\r\n        at junit.framework.TestCase.runBare(TestCase.java:125)\r\n        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)\r\n        at junit.framework.TestResult$1.protect(TestResult.java:106)\r\n        at junit.framework.TestResult.runProtected(TestResult.java:124)\r\n        at junit.framework.TestResult.run(TestResult.java:109)\r\n        at junit.framework.TestCase.run(TestCase.java:118)\r\n        at junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n        at junit.framework.TestSuite.run(TestSuite.java:203)\r\n        at junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n        at junit.framework.TestSuite.run(TestSuite.java:203)\r\n        at junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n        at junit.framework.TestSuite.run(TestSuite.java:203)\r\n        at junit.framework.TestSuite.runTest(TestSuite.java:208)\r\n        at junit.framework.TestSuite.run(TestSuite.java:203)\r\n        at junit.textui.TestRunner.doRun(TestRunner.java:116)\r\n        at junit.textui.TestRunner.start(TestRunner.java:172)\r\n        at junit.textui.TestRunner.main(TestRunner.java:138)\r\nCaused by: java.sql.SQLException: Derby system shutdown.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\r\n        ... 29 more\r\nE...............................\r\n\r\nI think that possibly the test needs to be run with a configuration that says it should only be\r\nrun when we are using the embedded driver, not in the network server configuration?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-27T00:22:57.832+0000","updated":"2011-03-27T00:22:57.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13011728","id":"13011728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"It seems strange. How do your mean by \"run the new test as part of the complete JUnit suite\", Bryan?\r\n\r\nI have run the new TestCase both in Eclipse and DOS, they are all OK, just like shown in \"Derby-4443-4.png\". Even in tools._Suite, it can pass tool.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-27T05:13:19.329+0000","updated":"2011-03-27T05:13:19.329+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13011800","id":"13011800","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I did\r\n          java -Xmx512m -XX:MaxPermSize=128m junit.textui.TestRunner org.apache.derbyTesting.functionTests.suites.All >junitAll.out 2>&1\r\n\r\nand the exception was in the junitAll.out.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-27T14:15:23.349+0000","updated":"2011-03-27T14:15:23.349+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13012073","id":"13012073","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I agree that the approach looks fine. Some minor comments:\r\n\r\n- When calling printStackTrace() on the thrown exception, only the rollback exception is thrown. To see the real problem, you either need to call getNextException() or look in derby.log. Would it make sense to change the order here? That is, in rollBackAndThrowSQLException(), change\r\n\r\n            e.setNextException(se);\r\n            throw e;\r\n\r\nto\r\n\r\n            se.setNextException(e);\r\n            throw se;\r\n?\r\n\r\n- There are three calls to printStackTrace() in the test code. It would probably be better to throw the exceptions so that JUnit can report them properly. If the exceptions are expected, it would be better to ignore them (with a comment saying why they should be ignored) or to have some asserts to verify that they are the exceptions we expect.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-03-28T14:22:18.237+0000","updated":"2011-03-28T14:22:18.237+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13012169","id":"13012169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"One thing I forgot to mention... The test uses EmbedConnection30, so it won't work on platforms that don't support at least JDBC 3.0 (for example Java ME with the JSR-169 driver). So the suite() method will have to check JDBC.vmSupportsJDBC3() and return an empty suite if JDBC 3.0 isn't supported by the JVM.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-03-28T18:31:09.173+0000","updated":"2011-03-28T18:31:09.173+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13012515","id":"13012515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Thanks for your advice, Knut and Bryan. It's valuable for me to make progress.\r\n\r\nI have recreated the error with Bryan's command. Here is why it's caused:\r\n\r\nIn the new test class 'RollBackWrappingWhenFailOnImportTest', a mock driver has been loaded, but it has not been shut down any more. In setup() method of engine.ErrorStreamTest which is closed in the completed test, a shutdownEngine() is called, it's used to shut down the current engine. The shutdown operation invokes a call to MockInternalDriver.connect(), which throw a mock connection(not valid here), so a SQLException of \"Derby system shutdown\" is thrown.\r\n\r\nIt's obvious that, 'RollBackWrappingWhenFailOnImportTest' has made a marginal influence on other test cases, so in patch-5, I shut down the mock driver on tearDown(), -----the exception can be ignored safely. Now, everything works well.\r\n\r\nIn patch-5, Knut's advices on printStackTrace() and vmSupportsJDBC3() are adopted. Thanks!\r\n\r\nPlease check the new patch-5!\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-29T15:12:03.971+0000","updated":"2011-03-29T15:12:03.971+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13012835","id":"13012835","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The tests pass successfully in my environment now.\r\n\r\nI intend to commit this patch in the next few days, thanks for all the hard work on it!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-30T03:58:35.262+0000","updated":"2011-03-30T03:58:35.262+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13012859","id":"13012859","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for making these changes. I didn't see any response to my question about the order of the exception chain. If I print the exception thrown by rollBackAndThrowSQLException(), I see this:\r\n\r\njava.sql.SQLException: The exception 'java.sql.SQLException: error in roll back' was thrown while evaluating an expression.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:98)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\r\n\tat org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:278)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:348)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2290)\r\n\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:82)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1334)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1686)\r\n\tat org.apache.derby.impl.jdbc.EmbedCallableStatement.executeStatement(EmbedCallableStatement.java:117)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:308)\r\n\tat org.apache.derbyTesting.functionTests.tests.tools.RollBackWrappingWhenFailOnImportTest.realTestRollBackWhenImportOnNonexistentFile(RollBackWrappingWhenFailOnImportTest.java:152)\r\n\tat org.apache.derbyTesting.functionTests.tests.tools.RollBackWrappingWhenFailOnImportTest.testRollBackWhenFailOnImportTable(RollBackWrappingWhenFailOnImportTest.java:119)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat junit.framework.TestCase.runTest(TestCase.java:168)\r\n\tat junit.framework.TestCase.runBare(TestCase.java:134)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:112)\r\n\tat junit.framework.TestResult$1.protect(TestResult.java:110)\r\n\tat junit.framework.TestResult.runProtected(TestResult.java:128)\r\n\tat junit.framework.TestResult.run(TestResult.java:113)\r\n\tat junit.framework.TestCase.run(TestCase.java:124)\r\n\tat junit.framework.TestSuite.runTest(TestSuite.java:232)\r\n\tat junit.framework.TestSuite.run(TestSuite.java:227)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:23)\r\n\tat junit.framework.TestResult.runProtected(TestResult.java:128)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:27)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.framework.TestSuite.runTest(TestSuite.java:232)\r\n\tat junit.framework.TestSuite.run(TestSuite.java:227)\r\n\tat junit.textui.TestRunner.doRun(TestRunner.java:116)\r\n\tat junit.textui.TestRunner.start(TestRunner.java:180)\r\n\tat junit.textui.TestRunner.main(TestRunner.java:138)\r\nCaused by: java.sql.SQLException: The exception 'java.sql.SQLException: error in roll back' was thrown while evaluating an expression.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:122)\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:71)\r\n\t... 35 more\r\nCaused by: java.sql.SQLException: error in roll back\r\n\tat org.apache.derbyTesting.functionTests.tests.tools.RollBackWrappingWhenFailOnImportTest$MockInternalDriver$MockConnectionFailWhenRollBack.rollback(RollBackWrappingWhenFailOnImportTest.java:59)\r\n\tat org.apache.derby.catalog.SystemProcedures.rollBackAndThrowSQLException(SystemProcedures.java:1479)\r\n\tat org.apache.derby.catalog.SystemProcedures.SYSCS_IMPORT_TABLE(SystemProcedures.java:1466)\r\n\tat org.apache.derby.exe.aceaa980c4x012fx0589x77eaxffffbc38504a0.g0(Unknown Source)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat org.apache.derby.impl.services.reflect.ReflectMethod.invoke(ReflectMethod.java:46)\r\n\tat org.apache.derby.impl.sql.execute.CallStatementResultSet.open(CallStatementResultSet.java:75)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:436)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:317)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1242)\r\n\t... 28 more\r\n\r\nFor a naive user, this looks like a problem in rollback(), like it did before the fix, and there's no trace of the original \"table not found\" exception without doing some digging in the logs or traversing the getNextException() chain. Any thoughts on whether this is the exception we should report as the primary exception?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-03-30T07:03:17.300+0000","updated":"2011-03-30T07:03:17.300+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13012955","id":"13012955","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Knut Anders, thanks for double-checking that.\r\n\r\nI agree that we would prefer to have the original exception lead the stack\r\ntrace, with the rollback exception chained on afterwards.\r\n\r\nI made your suggested change to rollbackAndThrowSQLException,\r\nand indeed the exception in the stack trace is more relevant to the\r\noriginal problem.\r\n\r\nHowever, this will require adjusting the test, since now the stack trace\r\nlooks different to the assertions in the test code.\r\n\r\nI'll hold off on committing while we discuss this further.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-03-30T13:37:40.686+0000","updated":"2011-03-30T13:37:40.686+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13014032","id":"13014032","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Thanks for your checking, Knut.\r\n\r\nThis problem has perplexed me for some days. After checking again, I accept that \r\n\r\n    private static void rollBackAndThrowSQLException(Connection conn,\r\n            SQLException se) throws SQLException {\r\n        try {\r\n            conn.rollback();\r\n        } catch (SQLException e) {\r\n            se.setNextException(e);\r\n        }\r\n        \r\n        throw se;\r\n    }\r\n\r\nis better, we will get the full SQLException chain. However, it's very strange that when debugging in this situation, the chain will be broken down before thrown to EmbedPreparedStatement.executeUpdate() in Line 309 of EmbedPreparedStatement, and the rollback exception will be lost.\r\n\r\n\r\nIs this situation normal, or is there something special for SQLException launched by rollback(), please?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-03-31T15:49:23.635+0000","updated":"2011-03-31T15:49:23.635+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13014088","id":"13014088","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Does the rollback exception appear if you call getNextException() on the thrown SQLException? You may need to call getNextException() multiple times before you get to the rollback exception. Derby typically adds a next exception for all errors, so the chain may consist of more than two exceptions in this case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-03-31T17:32:40.834+0000","updated":"2011-03-31T17:32:40.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13014639","id":"13014639","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Knut, I have called getNextException() in several places, such as EmbedPreparedStatement.executeUpdate() in Line 309 of EmbedPreparedStatement, and each of they returned null. I also looked into the trace stack when debugging, and haven't seen rollback exception in it.\r\n\r\nMaybe it relates to the simple mocking of InternalDriver and Connection? \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-04-01T14:59:12.193+0000","updated":"2011-04-01T14:59:12.193+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13015356","id":"13015356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It looks like the rollback exception is stripped off by this piece of code in StandardException.unexpectedUserException():\r\n\r\n\t\t// Look for simple wrappers for 3.0.1 - will be cleaned up in main\r\n\t\tif (ferry != null) {\r\n\t\t\tif (ferry.isSimpleWrapper()) {\r\n\t\t\t\tThrowable wrapped = ((SQLException)ferry).getCause();\r\n\t\t\t\tif (wrapped instanceof StandardException)\r\n\t\t\t\t\treturn (StandardException) wrapped;\r\n\t\t\t}\r\n\t\t}\r\n\r\nThis happens when the SQLException needs to be re-thrown as a StandardException, and the error handler finds that it's simpler to remove the top-level SQLException than it is to wrap it in yet another exception. Normally, an SQLException that wraps a StandardException doesn't provide any extra information, so removing it doesn't harm. But in our case the top-level exception carries extra information (the next exception), and it's not really a simple wrapper anymore. Perhaps we need to override setNextException() in EmbedSQLException and clear the simpleWrapper flag if it's called. The comments in the StandardException class give the impression that this \"simple wrapper\" code was a temporary hack that was supposed to be reworked, but they don't give any details on how.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-04-04T11:17:32.869+0000","updated":"2011-04-04T11:17:32.869+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13015423","id":"13015423","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Would it help if we made rollBackAndThrowSQLException throw \r\nsomething other than a SQLException when it caught a rollback() exception?\r\n\r\nFor example, would it help if that catch() block threw a StandardException instead?\r\n\r\nI guess I'm not quite sure I understand what rule StandardException is\r\nenforcing. Is it OK for a StandardException to wrap a StandardException, but\r\nif a SQLException wraps a StandardException than it gets automatically unwrapped?\r\n\r\nI suspect this has to do with improving the external user experience for the\r\ncaller; particularly in client/server scenarios the exceptions that travel from\r\nserver to client tend to get wrapped along the way with uninteresting and not-so-useful\r\nouter exceptions, and so perhaps this code is trying to undo that and get\r\nmore quickly to the underlying exception since it is more likely to reveal the real problem.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-04-04T14:03:41.312+0000","updated":"2011-04-04T14:03:41.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13015456","id":"13015456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"> I guess I'm not quite sure I understand what rule StandardException is\r\n> enforcing. Is it OK for a StandardException to wrap a StandardException, but\r\n> if a SQLException wraps a StandardException than it gets automatically unwrapped?\r\n\r\nIt typically only gets unwrapped if it has been thrown inside a stored\r\nprocedure (only exceptions generated by\r\nPublicAPI.wrapStandardException() are marked as \"simple wrappers\").\r\nWhat it attempts to solve is the problem of passing exceptions through\r\nmultiple layers. Inside the language layer and store, exceptions have\r\nto be passed as StandardExceptions, whereas in the JDBC layer they\r\nhave to be passed as SQLExceptions.\r\n\r\nIn the common case, an exception is generated inside the engine as a\r\nStandardException, and it gets wrapped in an SQLException on its way\r\nout through the JDBC layer. But in the case of stored procedures, the\r\nJDBC layer is reentered from the language layer. The exceptions that\r\nhappen inside the stored procedure are returned to the language layer\r\nas SQLExceptions, but have to be transported as StandardExceptions\r\nthrough the language layer up to the outer JDBC layer. This could be\r\ndone by wrapping the SQLException in a StandardException, but then the\r\nend result would be an SQLException wrapping a StandardException\r\nwrapping an SQLException wrapping a StandardException. By just passing\r\nthe underlying StandardException, we save two layers of indirection.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-04-04T15:16:18.733+0000","updated":"2011-04-04T15:16:18.733+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13022168","id":"13022168","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Hello, I have provided DERBY-4443-6-tmp.patch.\r\n\r\n private static void rollBackAndThrowSQLException(Connection conn,\r\n            SQLException se) throws SQLException {\r\n        try {\r\n            conn.rollback();\r\n        } catch (SQLException e) {\r\n            se.setNextException(e);            \r\n        }\r\n        \r\n        StandardException ste = StandardException.newException(\r\n                se.getSQLState(), (Throwable)se);\r\n        SQLException sqle = new SQLException((Throwable)ste); //this line can not pass compilation\r\n        \r\n        throw sqle;\r\n    }\r\n\r\nIn rollBackAndThrowSQLException() of this patch, SQLException has been wrapped in StandardException, which is wrapped in another SQLException. However, the patch can not pass compilation, and says \"constructor SQLException(java.lang.Throwable) can not be found\". I'm puzzled about it. Please give an advice, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-04-20T15:24:17.768+0000","updated":"2011-04-20T15:24:17.768+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13022175","id":"13022175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think that the compilation error is because this particular class (SystemProcedures.java) is\r\ncompiled against the JSR169 version of SQLException, which you can find in\r\n./java/stubs/jsr169/java/sql/SQLException.java, and that version of SQLException does\r\nnot have a constructor which takes a Throwable.\r\n\r\nWhat did you think about Knut Anders's suggestion of going back to your earlier patch,\r\nand overriding setNextException in EmbedSQLException to clear the simpleWrapper flag?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-04-20T15:33:52.947+0000","updated":"2011-04-20T15:33:52.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13022749","id":"13022749","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Hi, Bryan, thanks for your reminding, I think the new patch 4443-7 can work well now. Please check it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-04-21T13:51:34.169+0000","updated":"2011-04-21T13:51:34.169+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13023074","id":"13023074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Patch 7 builds fine for me and the new test passes cleanly. I also verified that if\r\nI take out the change to EmbedSQLException, the test then fails with the expected\r\nfailure, so I think this is looking very good.\r\n\r\nHoux, have you run the complete test suite with this patch? Or have you just run the new test?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-04-22T01:44:32.024+0000","updated":"2011-04-22T01:44:32.024+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13025266","id":"13025266","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Hi, Bryan. I have only run the tools.Suite, but not suites.All. \r\n\r\nAfter saw your adivce, I have run the complete test (org.apache.derbyTesting.functionTests.suites.All. Is that right ?) sometimes for several times, as been broken down by accident.  The complete test suite takes me more than 5 hours for one run.\r\n\r\nI have seen the result containing some failures, but after run the complete test suite and dividual tests on the original state, I believe they are not caused by the new patch. So the new patch is OK.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-04-26T15:04:02.378+0000","updated":"2011-04-26T15:04:02.378+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13025584","id":"13025584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thank you Houx for the update.\r\n\r\nI understand about the tests; they take a very long time for me, too. I am hoping to\r\nset up a faster machine for running the tests sometime over the summer, but for\r\nnow I am like you, it is quite hard to run the tests. So I don't run the full suite very\r\noften, but I do like to run it on a patch whenever I can.\r\n\r\nI am going to move ahead with committing patch 7.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-04-27T03:29:35.776+0000","updated":"2011-04-27T03:29:35.776+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13025601","id":"13025601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I committed patch 7 to the trunk as revision 1096991.\r\n\r\nThanks for all the hard work on this change; the testing was\r\na bit tricky but I'm pleased that we worked through the issues\r\nto get a test case that solidly demonstrates the new functionality.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-04-27T04:29:29.341+0000","updated":"2011-04-27T04:29:29.341+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13025771","id":"13025771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"body":"Hehe, I have harvested a lot on this issue, thanks very much for your and Knut's patient help!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=houxzhang","name":"houxzhang","emailAddress":"houxzhang at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Houx Zhang","active":true},"created":"2011-04-27T12:38:00.116+0000","updated":"2011-04-27T12:38:00.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13090398","id":"13090398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"reopening for backport to 10.8","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-08-24T18:43:45.122+0000","updated":"2011-08-24T18:43:45.122+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13090400","id":"13090400","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"committed backport to 10.8 with revision 1161226.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-08-24T18:46:42.988+0000","updated":"2011-08-24T18:46:42.988+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13229378","id":"13229378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Reopen for 10.5 backport consideration. If working on the backport for this issue. Temporarily assign yourself and add a comment that you are working on it. When finished, reresolve with the new fix versions or label backport_reject_10_x as appropriate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-03-14T17:19:46.832+0000","updated":"2012-03-14T17:19:46.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13233754","id":"13233754","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I'll attempt backport of this to 10.5.\r\nTemporarily assigned to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-03-20T21:11:32.562+0000","updated":"2012-03-20T21:11:32.562+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12440778/comment/13237239","id":"13237239","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"backported to 10.7 with revision 1304630, to 10.6 with revision 1304632, and to 10.5 with revision 1304636. Resetting assignee and closing again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2012-03-23T22:43:31.601+0000","updated":"2012-03-23T22:43:31.601+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4443/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06hzz:"}}