{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"31589","self":"https://issues.apache.org/jira/rest/api/latest/issue/31589","key":"DERBY-214","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-04-28 02:48:02.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21839","customfield_12310222":"3_*:*_1_*:*_346315000_*|*_1_*:*_1_*:*_3096927000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_21581277000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2005-05-21T07:14:24.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-214/watchers","watchCount":0,"isWatching":false},"created":"2005-04-11T10:47:02.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10993","id":"10993","description":"","name":"10.1.1.0","archived":false,"released":true,"releaseDate":"2005-08-03"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-01-26T02:02:21.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"}],"timeoriginalestimate":null,"description":"The System.exit() calls needs to be removed from the \nDB2jServerImpl.java as this results in the entire application \n(example - Eclipse which is running the Network Server inside \nit) getting shut down.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40827","summary":"Remove System.exit() calls from the DB2jServerImpl.java","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/31589/comment/63912","id":"63912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Hi, Kathey.  I think I can work on this.  Is it OK for NetworkServerControl to call System.exit, or does that need to throw an exception as well?\r\n\r\nThe technique I usually do for a utility that I want callable by another class as well as executable from the command line is for the main() routine to delegate to another public method which throws exceptions and doesn't call System.exit().  Then the main() routine catches any exceptions and calls System.exit(1) if there is an exception or System.exit(0) if there isn't one.  Then classes call the other public method and main() is only used from the command-line.\r\n\r\nDoes that work here?\r\n\r\nThanks,\r\n\r\nDavid","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-04-28T02:48:02.000+0000","updated":"2005-04-28T02:48:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31589/comment/64106","id":"64106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clr","name":"clr","emailAddress":"craig dot russell at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig L Russell","active":true},"body":"Hi,\r\n\r\nI agree that main() should only be used from the command line, and is the only place in the code where System.exit() should be called. The main() method could simply delegate to another method that takes the String args[] parameter. For the purposes of this message, I'll just call it \"execute\". \r\n\r\nAll of the utility programs should use the same method name for the \"execute\" method so it's easy to remember how to invoke it. The \"execute\" then does the parsing of the args. There are lots of Apache commons arg parsers that could be used in the \"execute\", but that's just a bit off topic.\r\n\r\nExecute should throw exceptions, not ever call System.exit. Since the execute method has the same parameters as main, it's easy to remember how to invoke it. \r\n\r\nThe second issue is whether the execute method should be static or not. For consistency, I think that non-static would be the way to go. If we offer different methods of executing, then it would be nice to have all of them behave the same in terms of static vs. non-static. \r\n\r\nThe third issue is where the processing of environment variables should be done. It might be best if the constructor of an instance of the utility class processed the environment variables. That way, regardless of whether main() or a program  called the constructor the behavior would be the same.\r\n\r\nThe fourth issue is whether for ease of use, aother convenience methods could be used. One that takes a single String is desirable. This method, also called execute, could simply parse the input String into a String[] and call the other execute method. An alternative method would take a Map of parameter names and values with the obvious semantics.\r\n\r\nI see a few alternatives\r\n\r\n1. ij.execute(new String[] {\"{\"-p\", \"1567\", \"-h\", \"localhost\" }); \r\n2. ij.setPort(1567); ij.setHost(\"localhost\");ij.execute();\r\n3. ij.execute(\"-p 1567 -h localhost\");\r\n4. Map map = new HashMap(); map.put(\"-p\", \"1567\"); map.put(\"-h\", \"localhost\");  ij.execute(Map map);\r\n\r\nI can see value in all of these techniques depending on what you have on the caller side of the interface. \r\n\r\nRegards,\r\n\r\nCraig","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=clr","name":"clr","emailAddress":"craig dot russell at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Craig L Russell","active":true},"created":"2005-04-30T09:17:49.000+0000","updated":"2005-04-30T09:17:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31589/comment/65363","id":"65363","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"There are a lot of interesting discussions about how to call classes with main().  However, NetworkServerControl already has a well-defined set of routines that are already a documented public interface.  I think that in the case of this particular situation we shouldn't change NetworkServerControl to have a new interface based on any of the proposed models.\r\n\r\nThere has also been a discussion about moving argument processing out of DB2jServerImpl (now renamed NetworkServerImpl) and into NetworkServerControl.  But I think that is beyond the scope of this particular JIRA item.\r\n\r\nWhat I am going to do for this is simply move the System.exit() from NetworkServerImpl to NetworkServerControl, and then I will open two separate items: one to relocate argument processing to NetworkServerControl, and another to adjust the other tools that don't already have a documented public interface to follow a calling model we all agree on.\r\n\r\nDavid","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-05-14T07:01:33.000+0000","updated":"2005-05-14T07:01:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31589/comment/65567","id":"65567","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Attached is the patch that should resolve this item.  I relocated the execute method\r\nfrom NetworkServerImpl (previously called DB2jServerImpl) to NetworkServerControl.\r\n\r\nI modified derbynet/testconnection.java so that it checks and makes sure the exit\r\nstatus matches what is expected (1 for error, 0 for no error).  \r\n\r\nRan derbyall, all tests pass except for tools/dblook_test.java, which was also failing\r\nin my DERBY-243 tree.  This is an unrelated diff, I'll be logging a bug for this.\r\n\r\nOutput of svn status:\r\n\r\nM      java/drda/org/apache/derby/impl/drda/NetworkServerControlImpl.java\r\nM      java/drda/org/apache/derby/drda/NetworkServerControl.java\r\nM      java/testing/org/apache/derbyTesting/functionTests/tests/derbynet/testcon\r\nnection.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-05-17T07:02:00.000+0000","updated":"2005-05-17T07:02:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31589/comment/65734","id":"65734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"\r\nI committed this patch.\r\nSending        java\\drda\\org\\apache\\derby\\drda\\NetworkServerControl.java\r\nSending        java\\drda\\org\\apache\\derby\\impl\\drda\\NetworkServerControlImpl.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\derbynet\\testconnection.java\r\nTransmitting file data ...\r\nCommitted revision 170862.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-05-19T13:08:42.000+0000","updated":"2005-05-19T13:08:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/31589/comment/65891","id":"65891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"This appears to be fixed,although there was a resulting test failure on Solaris 10 x86 that I am working on (DERBY-303).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-05-21T07:14:24.000+0000","updated":"2005-05-21T07:14:24.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-214/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07cpz:"}}