{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12475310","self":"https://issues.apache.org/jira/rest/api/latest/issue/12475310","key":"MAHOUT-513","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310751","id":"12310751","key":"MAHOUT","name":"Mahout","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310751&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310751&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310751&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310751&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13060","id":"13060","description":"Apache Mahout","name":"Mahout"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314396","id":"12314396","description":"","name":"0.4","archived":false,"released":true,"releaseDate":"2010-10-31"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-09-28 16:24:30.122","customfield_12312323":null,"customfield_12310420":"9550","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_171203707_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-09-30T14:54:04.133+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-513/watchers","watchCount":0,"isWatching":false},"created":"2010-09-28T15:20:40.426+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314281","id":"12314281","description":"","name":"0.3","archived":false,"released":true,"releaseDate":"2010-03-17"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeastman","name":"jeastman","emailAddress":"jeff at windwardsolutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeastman&avatarId=12232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeastman&avatarId=12232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeastman&avatarId=12232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeastman&avatarId=12232"},"displayName":"Jeff Eastman","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-10-31T15:50:32.512+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312151","id":"12312151","name":"Clustering","description":"Bugs related to any of the clustering packages"}],"timeoriginalestimate":null,"description":"Hi Jeff,\r\n\r\nI've been trying out the ClusterEvaluator class today since your recent changes, and I'm running into a problem whereby the average intra-cluster density can be set to NaN. Looking into it, it seems to happen for clusters containing points which are very close to the centroid.  For example, I have a cluster with:\r\n\r\nCentroid:\r\n\r\n{0:0.6075199543688895,1:-0.3165058387409551,2:0.2027106147825682,3:-21.246338574215706,4:-5.875047828899212,5:-0.9835694086952028,6:0.2794019939470805,7:-0.36402079609289717,8:0.5201946127074457,9:-0.47084217746293855,10:-0.14380397719670499,11:-0.10441028152861193,12:0.0698485086335405,13:0.014286758874801297}\r\n\r\nand one of the representative points (3 per cluster):\r\n\r\n[0.6075199543688894, -0.31650583874095506, 0.2027106147825682, -21.2463385742157, -5.875047828899212, -0.9835694086952026, 0.27940199394708054, -0.36402079609289706, 0.5201946127074457, -0.47084217746293855, -0.14380397719670499, -0.10441028152861194, 0.06984850863354047, 0.014286758874801297]\r\n\r\nAs far as I can tell from debugging, the representative points look identical to the centroid of this cluster, but I'm assuming there's some small difference as \"if (!vector.equals(clusterI.getCenter()))\" in ClusterEvaluator.invalidCluster() is always returning false for these points, and so the cluster isn't pruned from the list.\r\n\r\nLater on, in ClusterEvaluator.intraClusterDensity(), the \"min\" and \"max\" distances are ending up with the same value, and the density from \"double density = (sum / count - min) / (max - min);\" is calculated as NaN, e.g. here are the values I'm getting:\r\n\r\nmin = max = 1.5397509610616733E-7\r\ncount = 3\r\nsum = 4.61925288318502E-7\r\nmax - min: 0.0\r\ncount - min: 2.9999998460249038\r\n(sum / count - min) = 0.0\r\n\r\nThis then causes avgDensity to be calculated as NaN. I'm not sure what the solution is here, should invalidCluster() check that the the difference between the centroid and the candidate representative point is greater than a certain threshold, which would cause such a cluster to be pruned? Or is the fix in the intraClusterDensity() calculation to handle the case where min = max?\r\n\r\nBTW would you prefer that I create a Jira to record these issues, or is it okay to send them to the dev list as I've been doing?\r\n\r\nThanks,\r\n\r\nDerek\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"22905","summary":"ClusterEvaluator inter-cluster density returns NaN","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeastman","name":"jeastman","emailAddress":"jeff at windwardsolutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeastman&avatarId=12232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeastman&avatarId=12232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeastman&avatarId=12232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeastman&avatarId=12232"},"displayName":"Jeff Eastman","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeastman","name":"jeastman","emailAddress":"jeff at windwardsolutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeastman&avatarId=12232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeastman&avatarId=12232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeastman&avatarId=12232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeastman&avatarId=12232"},"displayName":"Jeff Eastman","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12475310/comment/12915786","id":"12915786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeastman","name":"jeastman","emailAddress":"jeff at windwardsolutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeastman&avatarId=12232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeastman&avatarId=12232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeastman&avatarId=12232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeastman&avatarId=12232"},"displayName":"Jeff Eastman","active":true},"body":"Hi Derek,\r\n\r\nThanks for your help on this new (experimental) code! If a particular cluster actually has no points assigned to it by one of the clustering jobs, then the centroid of the cluster will be repeated n times in its representative points and the (max-min) will fail as you note. Dirichlet does this quite often, as there are usually more models allocated than receive points in an iteration. The invalidCluster method is attempting to detect this degenerate situation and remove all clusters that would mess up the calculations.\r\n\r\nIn your situation, I gather your representative points are so close to the centroid that (max-min) becomes zero while the centroid vector equality test returns false because there is still some small difference. My hunch is that these clusters need to be pruned too, and adding an epsilon test to invalidCluster would be the right choice. Otherwise, one would have to return a very large number for the normalized density of that cluster and it would radically skew the intra-cluster density average. OTOH, if your clusters really do have distinct representative points you might want a very large intra-cluster density. I'm open to suggestions here. NaN is clearly not helpful.\r\n\r\nIs this a text-clustering problem you are working?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeastman","name":"jeastman","emailAddress":"jeff at windwardsolutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeastman&avatarId=12232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeastman&avatarId=12232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeastman&avatarId=12232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeastman&avatarId=12232"},"displayName":"Jeff Eastman","active":true},"created":"2010-09-28T15:29:55.532+0000","updated":"2010-09-28T15:29:55.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12475310/comment/12915814","id":"12915814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=derekocallaghan","name":"derekocallaghan","emailAddress":"derek dot ocallaghan at ucd dot ie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Derek O'Callaghan","active":true},"body":"Hi Jeff,\r\n\r\nIn this case it appears that there are ~20 points in the cluster, and they're all almost identical to each other. It's a text-clustering problem, using reduced dimensionality, and these original 20 points have almost identical terms. I'm not sure either what the solution is, this is an acceptable cluster which so happens to be quite dense, so it'd be good to see this in the results. Having said that, the average density will then be skewed as you say, as the remaining clusters in this case are nowhere near as dense. I need to think about it a bit more.\r\n\r\nI'm also getting a couple of strange values in the CDbwEvaluator, I suspect it could be a similar issue but I haven't had a chance to confirm it yet.\r\n\r\nThanks,\r\n\r\nDerek","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=derekocallaghan","name":"derekocallaghan","emailAddress":"derek dot ocallaghan at ucd dot ie","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Derek O'Callaghan","active":true},"created":"2010-09-28T16:24:30.122+0000","updated":"2010-09-28T16:24:30.122+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12475310/comment/12915895","id":"12915895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #344 (See [https://hudson.apache.org/hudson/job/Mahout-Quality/344/])\r\n    MAHOUT-513: Added a sequential version of representativePoints extraction. Changed other tests to use it. All tests run\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-09-28T19:54:11.515+0000","updated":"2010-09-28T19:54:11.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12475310/comment/12915982","id":"12915982","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #346 (See [https://hudson.apache.org/hudson/job/Mahout-Quality/346/])\r\n    MAHOUT-513: Reviewed calculations from paper in detail, making some changes that seemed needed. All tests run but I'm still not very confident in the computed numbers\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-09-29T00:37:02.068+0000","updated":"2010-09-29T00:37:02.068+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12475310/comment/12916216","id":"12916216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #347 (See [https://hudson.apache.org/hudson/job/Mahout-Quality/347/])\r\n    MAHOUT-513: hopefully fixed weighting of vectors by adding weightedX\r\nMAHOUT-513\r\n- Created interface GaussianAccumulator and two concrete implementations:\r\n  - RunningSumsGaussianAccumulator uses running sums approach\r\n  - OnlineGaussianAccumulator uses Knuth (Welford) approach\r\n- Added unit test thereof which produces significant std deviations and drastically-odd\r\n  variances. I'm committing this so it can get more eyeballs. It is not used anywhere yet.\r\n- Refactored CDbwClusterEvaluator to use RunningSumsGaussianAccumulator and\r\n  existing tests continue to run\r\n- Cleaned up logging in various clustering algorithms to increase use of debug vs. info\r\n  to reduce log clutter\r\nAll tests run.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-09-29T17:56:09.700+0000","updated":"2010-09-29T17:56:09.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12475310/comment/12916237","id":"12916237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #348 (See [https://hudson.apache.org/hudson/job/Mahout-Quality/348/])\r\n    MAHOUT-513\r\n- removed weighting from GaussianAccumulator.observe(). It's not needed for\r\nCDbw and is problematic in the OnlineGaussianAccumulator.  Tests all run.\r\nMAHOUT-513\r\n- fixed bug in OnlineGaussianAccumulator.getStd()\r\n- added test of variance\r\nall tests now run, though std/variance results are different than with RunningSums\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-09-29T18:55:22.028+0000","updated":"2010-09-29T18:55:22.028+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12475310/comment/12916497","id":"12916497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeastman","name":"jeastman","emailAddress":"jeff at windwardsolutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeastman&avatarId=12232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeastman&avatarId=12232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeastman&avatarId=12232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeastman&avatarId=12232"},"displayName":"Jeff Eastman","active":true},"body":"Replacing the standard deviation computation and some other algorithm changes seem to have resolved this issue. Marking Fixed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jeastman","name":"jeastman","emailAddress":"jeff at windwardsolutions dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jeastman&avatarId=12232","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jeastman&avatarId=12232","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jeastman&avatarId=12232","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jeastman&avatarId=12232"},"displayName":"Jeff Eastman","active":true},"created":"2010-09-30T14:54:04.111+0000","updated":"2010-09-30T14:54:04.111+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-513/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i04a4f:"}}