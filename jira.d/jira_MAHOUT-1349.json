{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12677052","self":"https://issues.apache.org/jira/rest/api/latest/issue/12677052","key":"MAHOUT-1349","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310751","id":"12310751","key":"MAHOUT","name":"Mahout","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310751&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310751&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310751&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310751&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13060","id":"13060","description":"Apache Mahout","name":"Mahout"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324577","id":"12324577","description":"Last release before 0.10.0, will contain the features for 0.10.0, the time between 0.9 and 0.10.0 is going to be used to stabilize the release","name":"0.9","archived":false,"released":true,"releaseDate":"2014-02-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-12-07 19:24:16.687","customfield_12312323":null,"customfield_12310420":"356428","customfield_12312320":null,"customfield_12310222":"3_*:*_1_*:*_40063_*|*_10002_*:*_2_*:*_101509976_*|*_1_*:*_2_*:*_3133427351_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-12-08T23:35:34.861+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-1349/watchers","watchCount":4,"isWatching":false},"created":"2013-11-01T12:59:17.506+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319261","id":"12319261","description":"Primarily a cleanup and refactoring release. Some new functionality which has been previously completed and tested may be introduced.","name":"0.7","archived":false,"released":true,"releaseDate":"2012-05-15"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12320153","id":"12320153","description":"The release will stabilize core components, improve performances and adds new streaming algorithms. Unmaintained code is getting killed as part of this","name":"0.8","archived":false,"released":true,"releaseDate":"2013-07-25"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smarthi","name":"smarthi","emailAddress":"smarthi at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suneel Marthi","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-02-03T07:57:20.372+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313154","id":"12313154","name":"Integration"}],"timeoriginalestimate":null,"description":"I'm not sure if I'm doing something wrong here, or if ClusterDumper does\r\nnot support my (fairly simple) use case\r\n\r\nI had a repository of 500K documents, for which I generated the input\r\nvectors and a dictionary using some custom code (not seq2sparse etc).\r\n\r\nI hashed the features with max size 5M (because I didn't know how many\r\nfeatures were in the dataset and wanted to minimize collisions).\r\n\r\nThe kmeans ran fine and generate sensible looking results, but when I tried\r\nto run ClusterDumper I got the following error:\r\n\r\n#bash> bin/mahout clusterdump -dt sequencefile -d\r\n completed/5159bba4e4b0718d03c8cf79_/EmailContentAnalytics_dict_5159bba4e4b0718d03c8cf79/part-*\r\n-i test-kmeans/clusters-19 -b 10 -n 10 -sp 10 -o ~/test-kmeans-out\r\nRunning on hadoop, using /usr/bin/hadoop and HADOOP_CONF_DIR=\r\nMAHOUT-JOB: /opt/mahout-distribution-0.7/mahout-examples-0.7-job.jar\r\n13/05/17 08:26:41 INFO common.AbstractJob: Command line arguments:\r\n{--dictionary=[completed/5159bba4e4b0718d03c8cf79_/EmailContentAnalytics_dict_5159bba4e4b0718d03c8cf79/part-*],\r\n--dictionaryType=[sequencefile],\r\n--distanceMeasure=[org.apache.mahout.common.distance.SquaredEuclideanDistanceMeasure],\r\n--endPhase=[2147483647], --input=[test-kmeans/clusters-19],\r\n--numWords=[10], --output=[/usr/share/tomcat6/test-kmeans-out],\r\n--outputFormat=[TEXT], --samplePoints=[10], --startPhase=[0],\r\n--substring=[10], --tempDir=[temp]}\r\nException in thread \"main\" java.lang.ArrayIndexOutOfBoundsException: 698948\r\n        at\r\norg.apache.mahout.clustering.AbstractCluster.formatVector(AbstractCluster.java:350)\r\n        at\r\norg.apache.mahout.clustering.AbstractCluster.asFormatString(AbstractCluster.java:306)\r\n        at\r\norg.apache.mahout.utils.clustering.ClusterDumperWriter.write(ClusterDumperWriter.java:54)\r\n        at\r\norg.apache.mahout.utils.clustering.AbstractClusterWriter.write(AbstractClusterWriter.java:169)\r\n        at\r\norg.apache.mahout.utils.clustering.AbstractClusterWriter.write(AbstractClusterWriter.java:156)\r\n        at\r\norg.apache.mahout.utils.clustering.ClusterDumper.printClusters(ClusterDumper.java:187)\r\n        at\r\norg.apache.mahout.utils.clustering.ClusterDumper.run(ClusterDumper.java:153)\r\n(...)\r\n\r\nThe error is when it tries to access the dictionary for the feature with\r\nindex 698948\r\n\r\nLooking at the dictionary loading code (\r\nhttp://grepcode.com/file/repo1.maven.org/maven2/org.apache.mahout/mahout-integration/0.7/org/apache/mahout/utils/vectors/VectorHelper.java#VectorHelper.loadTermDictionary%28java.io.File%29\r\n-  checked 0.8 and it hasn't changed)\r\n\r\nIt looks like the dictionary array is sized for the number of unique\r\nkeywords, not the highest index:\r\n\r\n  OpenObjectIntHashMap dict = new OpenObjectIntHashMap();\r\n//...\r\n  String [] dictionary = new String[dict.size()];\r\n\r\nAfter I ran my custom dictionary/feature generation code I discovered I\r\nonly had 517,327 unique features, therefore it is not surprising it would\r\ndie on an index >= 517327 (though I don't understand why it didn't die when trying to load the dictionary file)\r\n\r\nIs there any reason why the VectorHelper code should not create a\r\ndictionary array that has size the highest index read from the dictionary\r\nsequence file (which can be easily calculated during the preceding loop)?\r\n\r\nOr am I misunderstanding something?\r\n\r\nIt worked fine when I reduced the hash size to be <= than the total number\r\nof features, but this is not desirable in general (for me) since I don't\r\nknow the number of features before I run the job (and if I guess too high\r\nthen ClusterDumper crashes)\r\n\r\nAlex Piggott\r\nIKANOW","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"356716","summary":"Clusterdumper/loadTermDictionary crashes when highest index in (sparse) dictionary vector is larger than dictionary vector size?","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AlexAtIkanow","name":"AlexAtIkanow","emailAddress":"apiggott at ikanow dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Piggott","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=AlexAtIkanow","name":"AlexAtIkanow","emailAddress":"apiggott at ikanow dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Alex Piggott","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"N/A","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677052/comment/13842302","id":"13842302","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.musselman","name":"andrew.musselman","emailAddress":"andrew dot musselman at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.musselman&avatarId=18977","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.musselman&avatarId=18977","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.musselman&avatarId=18977","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.musselman&avatarId=18977"},"displayName":"Andrew Musselman","active":true},"body":"Added logic to make array larger of dictionary size and largest index plus one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.musselman","name":"andrew.musselman","emailAddress":"andrew dot musselman at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.musselman&avatarId=18977","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.musselman&avatarId=18977","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.musselman&avatarId=18977","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.musselman&avatarId=18977"},"displayName":"Andrew Musselman","active":true},"created":"2013-12-07T19:24:16.687+0000","updated":"2013-12-07T19:24:16.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677052/comment/13842565","id":"13842565","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.musselman","name":"andrew.musselman","emailAddress":"andrew dot musselman at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.musselman&avatarId=18977","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.musselman&avatarId=18977","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.musselman&avatarId=18977","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.musselman&avatarId=18977"},"displayName":"Andrew Musselman","active":true},"body":"Adding another input path in the setup to test \"indices less than dict size\" as well as converse.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.musselman","name":"andrew.musselman","emailAddress":"andrew dot musselman at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.musselman&avatarId=18977","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.musselman&avatarId=18977","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.musselman&avatarId=18977","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.musselman&avatarId=18977"},"displayName":"Andrew Musselman","active":true},"created":"2013-12-08T17:31:27.759+0000","updated":"2013-12-08T17:31:27.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677052/comment/13842780","id":"13842780","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.musselman","name":"andrew.musselman","emailAddress":"andrew dot musselman at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.musselman&avatarId=18977","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.musselman&avatarId=18977","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.musselman&avatarId=18977","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.musselman&avatarId=18977"},"displayName":"Andrew Musselman","active":true},"body":"Putting the 'plus one' in a better place.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=andrew.musselman","name":"andrew.musselman","emailAddress":"andrew dot musselman at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=andrew.musselman&avatarId=18977","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andrew.musselman&avatarId=18977","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andrew.musselman&avatarId=18977","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andrew.musselman&avatarId=18977"},"displayName":"Andrew Musselman","active":true},"created":"2013-12-08T22:55:28.911+0000","updated":"2013-12-08T22:55:28.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677052/comment/13842794","id":"13842794","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smarthi","name":"smarthi","emailAddress":"smarthi at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suneel Marthi","active":true},"body":"Patch committed to trunk. Thanks Andrew.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smarthi","name":"smarthi","emailAddress":"smarthi at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suneel Marthi","active":true},"created":"2013-12-08T23:35:34.889+0000","updated":"2013-12-08T23:35:34.889+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677052/comment/13842814","id":"13842814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"SUCCESS: Integrated in Mahout-Quality #2358 (See [https://builds.apache.org/job/Mahout-Quality/2358/])\r\nMAHOUT-1349: Clusterdumper/loadTermDictionary crashes when highest index in (sparse) dictionary vector is larger than dictionary vector size (smarthi: rev 1549353)\r\n* /mahout/trunk/CHANGELOG\r\n* /mahout/trunk/integration/src/main/java/org/apache/mahout/utils/vectors/VectorHelper.java\r\n* /mahout/trunk/integration/src/test/java/org/apache/mahout/utils/vectors/VectorHelperTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2013-12-09T00:29:29.075+0000","updated":"2013-12-09T00:29:29.075+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-1349/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1pg27:"}}