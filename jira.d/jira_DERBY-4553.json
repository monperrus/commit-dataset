{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12456589","self":"https://issues.apache.org/jira/rest/api/latest/issue/12456589","key":"DERBY-4553","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-02-19 11:06:16.487","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24334","customfield_12310222":"1_*:*_1_*:*_1344991874_*|*_6_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-03-05T11:04:44.403+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4553/watchers","watchCount":0,"isWatching":false},"created":"2010-02-17T21:28:12.529+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.png","name":"Trivial","id":"5"},"labels":["ij"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-03-05T11:04:44.388+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11414","id":"11414","name":"Tools"}],"timeoriginalestimate":null,"description":"In ij, the statement GETCURRENTROWNUMBER directly write its result to output instead of returning it:\r\n\r\nHere are the faulty lines in ij.ij, method GetCurrentRowNumber():\r\n\t...\r\n\tLocalizedResource.OutputWriter().println(utilInstance.getCurrentRowNumber(rs));\r\n\treturn null;\r\n\r\nThis interferes with testing - and possibly with any external tool using the ij.ij parser.\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38191","summary":"In ij GETCURRENTROWNUMBER directly writeits result  to output","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10423","value":"Newcomer","id":"10423"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12456589/comment/12835044","id":"12835044","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"body":"Attaching a repro for this issue.\r\n\r\nThe repro just create a cursor and add a call to GETCURRENTROWNUMBER at the end of ij7.sql. Running the ToolScripts test suite produce the following result:\r\n  sh$ ant all && java junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.tools.ToolScripts \r\n  [snip]\r\n  .0\r\n  F....0\r\n  F...\r\n  Time: 130.112\r\n  There were 2 failures:\r\n  [snip]\r\n\r\nThe '0's in the output are the result of GETCURRENTROWNUMBER. And are not caught by the test tool. That leads to a failure of the corresponding test.\r\n\r\n----\r\n\r\nBy looking at the source of ij, it seems there is currently no class implementing ijResult suitable to return only one value. An option would be to create a new class derived of ijResultVector to implement scalar results as 1-dimension vector.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"created":"2010-02-17T23:22:26.331+0000","updated":"2010-02-17T23:22:26.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12456589/comment/12835404","id":"12835404","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"body":"Attaching a patch for this issue. Ready for review.\r\n\r\nThis patch introduce the classe ijScalarResult representing a single value returned from an ij statement. ijScalarResult is defined as a subclass of ijVectorResult. I use it to store the integer value returned by getCurrentRowNumber().\r\n\r\nHowever, according to the comment on ijVectorResult, that class is for vectors of /strings/. But, the only usage for such vectors ends up in org.apache.derby.impl.tools.ij.util.DisplayVector(LocalizedOutput, Vector) where a println is issued for each item. So, I don't think it is a problem to feed such a vector with other kind of objects. Moreover, ijVectorResult is package-private so there is little chance  this break anything outside of ij.\r\n\r\n\r\nI wasn't able to find where ij's cursor statements are tested (are they?). So I add a simple test for GETCURRENTROWNUMBER in ij7.sql\r\n\r\n\r\nPass ToolScript test suite:\r\n    sh$ java junit.textui.TestRunner org.apache.derbyTesting.functionTests.tests.tools.ToolScripts \r\n    ........\r\n    Time: 24.031\r\n    \r\n    OK (8 tests)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"created":"2010-02-18T21:14:53.292+0000","updated":"2010-02-18T21:14:53.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12456589/comment/12835698","id":"12835698","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Sylvain,\r\n\r\nThe fix looks fine to me, but I think we need to update the comments if we start allowing other objects than strings in ijVectorResult. I'm wondering, though, if we need the new class, or if it would be better to just add an extra constructor to ijVectorResult that takes a string argument. Not a big issue, but that would give slightly less code and less files to maintain.\r\n\r\n(On a side note, this would not have been an issue if only ijVectorResult had used java.util.List instead of java.util.Vector. Then we could produce a scalar result as simple as this, without any new class or new constructor: \"new ijVectorResult(Collections.singletonList(result)), null);\" But cleaning up the ij code and making it use the more modern collection classes is outside the scope of this issue.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-02-19T11:06:16.487+0000","updated":"2010-02-19T11:06:16.487+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12456589/comment/12835765","id":"12835765","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"body":"Hi Knut,\r\n\r\nThanks for reviewing such a critical issue ;)\r\n\r\nI attach here a new patch for this issue:\r\n- I agree with you to add extra constructors to ijVectorResult instead of coding a new class.\r\n- I have updated the comment about ijVectorResult accepting any object.\r\n\r\nPass derbytools ant ToolScripts test suite.\r\n\r\n\r\nConcerning your side note, I think ij deserves some cleaning up. Both at source level - and maybe as well in terms of functionality? According to a comment in java/tools/org/apache/derby/impl/tools/ij/Main.java, it was first designed as a testing tool. But ij could have some \"advanced\" feature to ease database maintenance tasks. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sleroux","name":"sleroux","emailAddress":"sylvain at chicoree dot fr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sylvain Leroux","active":true},"created":"2010-02-19T14:58:05.846+0000","updated":"2010-02-19T14:58:43.943+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12456589/comment/12835777","id":"12835777","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks, Sylvain! I'll run the full regression test suite and commit the patch if nothing breaks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-02-19T15:27:08.413+0000","updated":"2010-02-19T15:27:08.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12456589/comment/12835916","id":"12835916","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The tests ran cleanly in my environment. Committed revision 911952.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-02-19T19:37:58.301+0000","updated":"2010-02-19T19:37:58.301+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4553/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06wg7:"}}