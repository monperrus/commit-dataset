{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12311071","self":"https://issues.apache.org/jira/rest/api/latest/issue/12311071","key":"DERBY-336","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-06-06 00:57:28.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21905","customfield_12310222":"3_*:*_1_*:*_5406561000_*|*_1_*:*_1_*:*_154512000_*|*_6_*:*_2_*:*_19123588000_*|*_5_*:*_1_*:*_2026311000_*|*_4_*:*_1_*:*_356000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-04-11T01:43:16.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-336/watchers","watchCount":0,"isWatching":false},"created":"2005-06-05T21:54:28.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.png","name":"Trivial","id":"5"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12310184","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12310184","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"29590","key":"DERBY-128","self":"https://issues.apache.org/jira/rest/api/2/issue/29590","fields":{"summary":"Network Server Gives NPE if SQLException has null arguments   (e.g. for ERROR XBM0H)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-29T13:13:26.097+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"When looking at DERBY-128 it became clear that the wrong overload of StandardException::newException() was used when reporting\nSQLState.SERVICE_DIRECTORY_CREATE_ERROR. The message string only takes one parameter so only one additional parameter (other than Throwable) should be used:\n\nPersistentServiceImpl.java:676\n                            throw StandardException.newException(SQLState.SERVICE_DIRECTORY_CREATE_ERROR,\n                                                                 serviceDirectory, null);\n// Calls StandardException.newException(String, Object, Object)\n// Should call StandardException.newException(String, Object)? Or StandardException.newException(String, Throwable, Object)? With the IOException as  \n// Throwable?\n\nPersistentServiceImpl.java:692\n        throw StandardException.newException(SQLState.SERVICE_DIRECTORY_CREATE_ERROR, name, t);\n// Calls StandardException.newException(String, Object, Object)\n// Should call StandardException.newException(String, Throwable, Object)?\n\nBaseDataFileFactory.java:279\n                throw StandardException.newException( SQLState.SERVICE_DIRECTORY_CREATE_ERROR, dataDirectory, ioe);\n\n// Calls StandardException.newException(String, Object, Object)\n// Should call StandardException.newException(String, Throwable, Object)?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39130","summary":"The wrong overload of StandardException::newException() is used in some cases","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Any","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":14,"total":14,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12312680","id":"12312680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"The network sever part of this bug is fixed.\r\n\r\nThe issue of the  SQLException having null arguments has been moved to DERBY-336.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-06-06T00:57:28.000+0000","updated":"2005-06-06T00:57:28.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12312870","id":"12312870","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"This was a little more complicated than I first thought: It looks like there are three different cases of incorrect, or at least unconventional, use of StandardException.newException(...):\r\n\r\n1) newException() is called with and explicit \"null\" argument. \r\nError codes:\r\nSQLState.SERVICE_DIRECTORY_CREATE_ERROR  XBM0H.D=Directory {0} cannot be created.\r\nSQLState.LOG_FULL  XSLA4.D=Cannot write to the log, most likely the log is full.  Please delete unnecessary files.  It is also possible that the file system is read only, or the disk has failed, or some other problems with the media.\r\nSQLState.RAWSTORE_ERROR_RENAMING_FILE  XSRS4.S=Error renaming file (during backup) from {0} to {1}.\r\nSQLState.RAWSTORE_ERROR_COPYING_FILE  XSRS5.S=Error copying file (during backup) from {0} to {1}.\r\n\r\nIn all of these cases it should be safe to remove the \"null\" as it is not used in the message text.\r\n\r\n\r\n2) newException(...) is called with Throwable as the LAST argument, and not the SECOND as it should be.\r\nError codes:\r\nSQLState.AUTH_INVALID_AUTHORIZATION_PROPERTY  28501=Invalid database authorization property ''{0}={1}''.\r\nSQLState.SERVICE_DIRECTORY_CREATE_ERROR  XBM0H.D=Directory {0} cannot be created.\r\n\r\nThese two cases are simply a matter of changing the order of the arguments, i.e. move the Throwable argument.\r\n\r\nSQLState.LANG_FILE_ERROR  X0X63.S=Got IOException ''{0}''.\r\n\r\nThis is a bit more tricky. Clearly the author of the message text intended that a textual representation of the original exception should be inserted into the message text. But this error code is typically used like this:\r\n\r\nStandardException.newException(SQLState.LANG_FILE_ERROR, ioe.toString(), ioe)\r\n\r\nSo even if we fix the order of the arguments (making \"ioe\" the 2nd argument), we have a situation where \"ioe\" is both the next exception, and its string representation gets inserted into the message string. This seems a bit redundant to me, but I'll let the experts decide what to do... :)\r\n\r\n3) newException(...) is called with multiple arguments of type Throwable. \r\nError codes:\r\nSQLState.FILE_CONTAINER_EXCEPTION  XSDG3.D=Meta-data for Container {0} could not be accessed\r\n\r\nThis error code is used as follows:\r\nStandardException.newException(SQLState.FILE_CONTAINER_EXCEPTION, this, ioe)\r\nSo the last \"ioe\" argument appears to be redundant, and should be removed.\r\n\r\nSQLState.FILE_CREATE_NO_CLEANUP     XSDF2.S=Exception during creation of file {0} for container, file could not be removed.  The exeception was: {1}.\r\n\r\nHere it seems that the intention has been to associate two different exceptions with the same StandardExecption:\r\nStandardException.newException(SQLState.FILE_CREATE_NO_CLEANUP, ioe, file, se)\r\nwhere \"ioe\" is an io exception, and \"se\" is a security exception. \"ioe\" will be the next exception, and \"se\"  will be inserted (as string) at {1}. This error code is also used with an explicit \"null\" instead of \"se\".  In this case I guess the explicit \"null\" is warranted, although not very elegant...\r\n\r\nSQLState.FILE_CANNOT_REMOVE_FILE    XSDF4.S=Exception during remove of file {0} for dropped container, file could not be removed {1}.\r\n\r\nThis error code is used in much the same way as the previous one, except that in the case where there is only one execption this is used both as the next exception and as the message argument, rather than using an explicit null.\r\nStandardException.newException(SQLState.FILE_CANNOT_REMOVE_FILE, se, file, se);\r\n\r\nWhen used with two excptions this error reports two io exceptions:\r\nStandardException.newException(SQLState.FILE_CANNOT_REMOVE_FILE, ioe2, file, ioe);\r\n\r\nComments? Please... ;)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2005-06-07T21:01:47.000+0000","updated":"2005-06-07T21:01:47.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12313180","id":"12313180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Kathey Marsden <kmarsdenderby@sbcglobal.net> wrote in Message-id: <42A2114A.4060508@sbcglobal.net>:\r\n>File a bug for the XBM0H exception  being generated with null\r\n>arguments.   File a patch plus your NSinSameJVM test.\r\n>The  NSinSameJVM test will  be a good test of a hard to test\r\n>exception.   I think you need security manager to reproduce and only the\r\n>network server tests run with security manager.  Embedded gets tested\r\n>because network server just makes embedded calls.\r\n\r\nI've tried to modify NSinSameJVM.java to test this, but it seems impossible! As long as the test i run in Network mode it is impossible to verify that the Exception is correctly constucted, because the client only gets an SqlException from the driver. The SqlException only contains the message constructed on the server so unless the null argument is actually inserted into the message, the error will not be observable in the client.\r\nIn embedded mode it is straight-forward to inspect the EmbedSQLException to verify that it is correctly constructed.\r\n\r\nI am starting to think that this type of error should be detected by the StandardException class itself. It should not allow adding more arguments than its message string supports, and not allow null arguments. And perhaps no Throwable args unless it already has a nested exception. These constraints should be enforced when the StandardException is created, (or modified).\r\n\r\nCase 1 and 2 in my first comment can be detected at compile time by adding dummy versions of StandardException.newException(...) that match the incorrect usage, but trigger a compilation error (by throwing an unhandled exception). Unfortunately this will also flag Case 3 as an error, making things more complicated. Maybe another (legal) overload can fix this...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2005-06-10T03:39:07.000+0000","updated":"2005-06-10T03:39:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12314145","id":"12314145","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"The patch fixes the cases where an incorrect overload of StandardException.newException() is used. I used the better matching illegal overload trick to find these cases. Only the two illegal overloads that detected errors have been included in the patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2005-06-21T19:16:43.000+0000","updated":"2005-06-21T19:16:43.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12314354","id":"12314354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Hi, Dyre. I'm kicking off a build and will let you know.  In the meantime, here are my comments on the changes.\r\n\r\nFor the most part this looks good, it's nice to see these cleaned up.  A couple of comments:\r\n\r\n---\r\n\r\nIn RAFContainer.java, you modified one message to say \"(see nested exception)\".\r\n\r\nIt seems to me the last argument of FILE_CANNOT_REMOVE_FILE should not be\r\nthere if all we're going to say is \"see nested exception\".  We should either\r\nremove this argument, or provide the message string.  Note that the writer\r\nof this message may have intended for the exception message to be printed\r\nout in the exception string and that the user could find the details of\r\nthe exception (e.g. the stack trace) by looking in the error log.  My\r\npersonal preference would be to include the exception message, better to\r\nprovide more detail rather than less when it comes to errors.\r\n\r\n--\r\n\r\nThe FILE_CREATE_NO_CLEANUP is a strange beast.  It is only used in *one*\r\nsingle place in the code with both exceptions and is creating some real\r\ncomplexity in the StandardException.newException() methods.  It seems to\r\nme that if all you want to show is the message of an exception, you\r\nshould pass the exception string as an argument, e.g.\r\n\r\n\r\nStandardException.newException(SQLState.FILE_CREATE_NO_CLEANUP,\r\n  ioe, file, se.getMessage());\r\n\r\nIf you modified the once instance where two exceptions are passed to use\r\nthis approach, then you wouldn't need this specialized version of\r\nnewException() two exception objects. You could just use the one that takes\r\n(messageID, Throwable, Object, Object).\r\n\r\n---\r\n\r\nI understand what you're trying to accomplish with the \"dummy\" overloads,\r\nbut it makes me a bit nervous.  It's an odd use of the checked exception\r\nmodel.\r\n\r\nThat said, I think it does work to catch improper usage of the\r\nStandardException.newException().  I just wish there was another way to\r\ndo this...\r\n\r\nOne approach would be to have a setContainedException() method on\r\nStandardException and have a policy that newException *only* takes\r\narguments to the message string.  I think this is a better model than\r\nthe \"fake\" constructor methods, but the drawback is that it would\r\nlikely require a significant rewrite of existing code that pass\r\nexceptions into StandardException.\r\n\r\nThanks,\r\n\r\nDavid\r\n\r\nP.S. I may have other comments on your comment above, but I wanted to focus on your initial patch first.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-06-24T05:56:42.000+0000","updated":"2005-06-24T05:56:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12314532","id":"12314532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Thanks for your comments, David!\r\n\r\nI see what you are saying about FILE_CANNOT_REMOVE_FILE, but look at how it is used other places in the code:\r\n\r\n./java/engine/org/apache/derby/impl/store/raw/data/RFResource.java:261:\r\n           SQLState.FILE_CANNOT_REMOVE_FILE, fileToGo);\r\n./java/engine/org/apache/derby/impl/store/raw/data/RAFContainer.java:1077:\r\n               newException(SQLState.FILE_CANNOT_REMOVE_FILE, se, file,\r\n./java/engine/org/apache/derby/impl/store/raw/data/RAFContainer.java:1102:\r\n                   SQLState.FILE_CANNOT_REMOVE_FILE, ioe2, file, ioe);\r\n./java/engine/org/apache/derby/impl/store/raw/data/RAFContainer.java:1107:\r\n                   SQLState.FILE_CANNOT_REMOVE_FILE, se, file, stub);\r\n./java/engine/org/apache/derby/iapi/reference/SQLState.java:489:        String FILE_CANNOT_REMOVE_FILE                              = \"XSDF4.S\";\r\n\r\nAs you can see, this error message is used both with one and TWO nested exceptions (in much the same way as FILE_CREATE_NO_CLEANUP), \r\nso you cannot remove the additional parameter from the message string. I agree that you can choose to supply the same exception both as the nested exception, and as a parameter, but I doubt that this is why the error message is written the way it is... Also, notice the first use of this message, where NO nested exception is supplied! \r\n---\r\nI think you are correct about using a string argument. However, I was cautioned about converting arguments to string before it is necessary, as this could lead to performance problems,  (if the exception is caught, the conversion to string is unnecessary). But in this particular case I doubt that performance is relevant, so I'll consider changing it... \r\n---\r\nI understand your concerns about the dummy overloads, - it is a non-standard and non-intuitive construct. I was not sure if I should include them in the patch or just use them locally to find the StandardException usages that needed to be fixed. In the end, I decided to include them since it is easy to make another such mistake later, (and you will not be warned about it).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2005-06-27T21:59:42.000+0000","updated":"2005-06-27T21:59:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12314591","id":"12314591","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Hi, Dyre, your responses seem good.  \r\n\r\nThere is still something funny about FILE_CANNOT_REMOVE_FILE.  If there is a case where the second parameter is not even used, I would prefer that that usage be split into a separate message, rather than inserting a dummy string.\r\n\r\nRegarding the dummy overloads: the reason mistakes have been made and you have had to do this is because the semantics of the newException are not clear: when you want to chain an exception, where does it go?   How does one distinguish a chained exception from a parameter to the message string?  It's particularly confusing because in some cases you want an exception in both places (sometimes the same exception, sometimes different exceptions).  \r\n\r\nI think in the name of convenience (e.g. only writing one line to throw the exception) we have created semantic muddiness, and it is now forcing us to do unnatural acts to get the compiler to catch improper usage.  I\r\n\r\nI would like to suggest opening a JIRA item to fix this so the semantics are clear and the compiler can catch mistakes the way it was intended to do so -- with strong typing.  \r\n\r\nPerhaps this could be done as part of the larger task of migrating to J2SE 1.4 chained exceptions...  I can envision only allow message string arguments to newException(), and chaining exceptions be allowed only by calling a separate method on the exception class, e.g.:\r\n\r\ncatch ( IOException ioe ) {\r\n  try { somethingProtected() } \r\n   catch ( SecurityException se ) {\r\n      StandardException stde = StandardException.newException(msgid, arg1, arg2, ioe);  \r\n      se.setCause(ioe)\r\n      stde.setCause(se);\r\n      throw stde;\r\n   }\r\n}\r\n\r\nIn terms of this patch, however, I think what you have works pretty well and prevents further misuse, as long as it's commented extremely well why we're doing this, because it is very odd.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-06-28T15:44:03.000+0000","updated":"2005-06-28T15:44:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12315226","id":"12315226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"New patch, stat output and derbyall_report based on comments from David Van Couvering.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2005-07-07T20:05:52.000+0000","updated":"2005-07-07T20:05:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12315524","id":"12315524","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Diffs look good.  I'll try applying the patch and running the tests.  I'll log a bug about fixing the StandardException semantics.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-07-12T09:39:50.000+0000","updated":"2005-07-12T09:39:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12315768","id":"12315768","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Build runs, derbyall passes with no failures.\r\n\r\n+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-07-14T02:44:28.000+0000","updated":"2005-07-14T02:44:28.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12318069","id":"12318069","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Submitted Dyre's patch, revision 230900\r\n\r\nSending        java/engine/org/apache/derby/impl/db/BasicDatabase.java\r\nSending        java/engine/org/apache/derby/impl/services/monitor/PersistentServiceImpl.java\r\nSending        java/engine/org/apache/derby/impl/sql/conn/GenericLanguageConnectionFactory.java\r\nSending        java/engine/org/apache/derby/impl/sql/execute/JarUtil.java\r\nSending        java/engine/org/apache/derby/impl/store/raw/RawStore.java\r\nSending        java/engine/org/apache/derby/impl/store/raw/data/BaseDataFileFactory.java\r\nSending        java/engine/org/apache/derby/impl/store/raw/data/InputStreamContainer.java\r\nSending        java/engine/org/apache/derby/impl/store/raw/data/RAFContainer.java\r\nSending        java/engine/org/apache/derby/impl/store/raw/log/LogAccessFile.java\r\nSending        java/engine/org/apache/derby/impl/store/raw/log/LogToFile.java\r\nSending        java/testing/org/apache/derbyTesting/functionTests/master/authorize.out\r\nTransmitting file data ............\r\nCommitted revision 230900.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2005-08-09T06:39:01.000+0000","updated":"2005-08-09T06:39:01.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12320765","id":"12320765","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"David Van Couvering Committed revision 230900.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2005-09-01T17:30:52.000+0000","updated":"2005-09-01T17:30:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12373892","id":"12373892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Need to set fixin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2006-04-11T01:37:20.000+0000","updated":"2006-04-11T01:37:20.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12311071/comment/12373895","id":"12373895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Setting fixin to 10.2 since this does not seem important enough to warrant a back-port to 10.1.3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2006-04-11T01:41:58.000+0000","updated":"2006-04-11T01:41:58.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-336/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0728v:"}}