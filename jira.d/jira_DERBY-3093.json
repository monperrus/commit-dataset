{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12379326","self":"https://issues.apache.org/jira/rest/api/latest/issue/12379326","key":"DERBY-3093","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311972","id":"12311972","description":"","name":"10.1.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312251","id":"12312251","description":"Head of 10.2 branch","name":"10.2.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-10-17 00:42:33.941","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23426","customfield_12310222":"3_*:*_1_*:*_154146867_*|*_1_*:*_1_*:*_1874267259_*|*_5_*:*_2_*:*_37684691_*|*_4_*:*_1_*:*_281065240","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-10-26T01:20:23.906+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3093/watchers","watchCount":0,"isWatching":false},"created":"2007-09-28T21:20:59.849+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312027","id":"12312027","description":"","name":"10.2.2.0","archived":false,"released":true,"releaseDate":"2006-12-19"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12317913","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12317913","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12371073","key":"DERBY-2773","self":"https://issues.apache.org/jira/rest/api/2/issue/12371073","fields":{"summary":" testGrantRevokeDDL(org.apache.derbyTesting.functionTests.tests.lang.GrantRevokeDDLTest) throws java.sql.SQLException: The exception 'java.sql.SQLException: A SAVEPOINT with the passed name already exists in the current transaction.' ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12317915","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12317915","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12371419","key":"DERBY-2804","self":"https://issues.apache.org/jira/rest/api/2/issue/12371419","fields":{"summary":"predicatesIntoViews.sql fails (intermittently?) with SAVEPOINT error w/ IBM 15 on Linux.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12317914","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12317914","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12371504","key":"DERBY-2808","self":"https://issues.apache.org/jira/rest/api/2/issue/12371504","fields":{"summary":"triggerRecursion.sql and triggerGeneral.sql intermittently fail with SAVEPOINT error.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:50:53.373+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"While running our app overnight, performing some intensive database operations (primarily deletes), we experienced a transaction failure, with error message \"A SAVEPOINT with the passed name already exists in the current transaction\".  This failure appears to be very intermittent, as I've run the same operation successfully for hours and hours without failure.  Some more information:\n\n1.  I see that there are four JIRA issues which report the same message (DERBY-2773, DERBY-1457, DERBY-2808, DERBY-2804).  I am not sure to what extent if any, the problem I experienced is related to these issues.\n\n•\tAt least three of the above JIRA issues are related to triggers.  Our transaction failure occurred while performing a delete in a table which has delete triggers.\n•\tWe aren't using savepoints explicitly.  Of course, it can be seen in the stack trace that the trigger operation is setting a savepoint.\n•\tOne of the JIRA issues mentions exceeding maximum depth of nested triggers.  Not sure what a nested trigger is, but the trigger we are performing should not (in theory) cause another trigger event.\n\n2.  Here's the stack trace:\n\nCaused by: java.sql.SQLException: A SAVEPOINT with the passed name already exists in the current transaction.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(Unknown Source)\n        at com.referentia.sdf.monitor.samplebase.derby.DerbySampleBase$3.perform(DerbySampleBase.java:682)\n        at com.referentia.sdf.monitor.samplebase.derby.DerbySampleBase.performInTransaction(DerbySampleBase.java:2747)\n        ... 7 more\nCaused by: java.sql.SQLException: A SAVEPOINT with the passed name already exists in the current transaction.\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\n        ... 18 more\nCaused by: ERROR 3B501: A SAVEPOINT with the passed name already exists in the current transaction.\n        at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n        at org.apache.derby.impl.store.raw.xact.Xact.setSavePoint(Unknown Source)\n        at org.apache.derby.impl.store.access.RAMTransaction.setSavePoint(Unknown Source)\n        at org.apache.derby.impl.sql.conn.GenericStatementContext.setSavePoint(Unknown Source)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\n        at org.apache.derby.impl.sql.execute.GenericTriggerExecutor.executeSPS(Unknown Source)\n        at org.apache.derby.impl.sql.execute.RowTriggerExecutor.fireTrigger(Unknown Source)\n        at org.apache.derby.impl.sql.execute.TriggerEventActivator.notifyEvent(Unknown Source)\n        at org.apache.derby.impl.sql.execute.DeleteResultSet.fireAfterTriggers(Unknown Source)\n        at org.apache.derby.impl.sql.execute.DeleteResultSet.open(Unknown Source)\n        at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\n        ... 12 more\n\n3.  Here are the relevant tables and triggers. We have different tables for different \"sample\" data types  in our application (currently int, long, float, double, Boolean, string).  I have shown the int_sample table; the other tables are identical but have a different data type for the value field.  \n\nSample records are first class; time records are second class - they only exist to support sample records.  When there are no remaining sample records for a given time record, the time record can be removed.  It is the job of the trigger to perform this cleanup:  when a record is deleted from any of the sample tables, the time record corresponding to *_sample.fk_time_id is deleted only if there are no remaining records in any of the sample tables which have the same fk_time_id.  So although there are cascading deletes (deleting a time record deletes all of its samples), the trigger should not recurse because the trigger only deletes when there are no associated records.\n \ncreate table time (\n  id                  int not null generated always as identity,\n  time                timestamp not null,\n\n  constraint time_pk primary key (id),\n  constraint time_unique unique (time)\n);\n\ncreate table int_sample (\n  fk_band_id          int not null,\n  fk_time_id          int not null,\n  value               int not null,\n\n  constraint int_sample_pk primary key (fk_band_id, fk_time_id),\n  constraint int_sample_fk_band foreign key (fk_band_id) references band (id) on delete cascade,\n  constraint int_sample_fk_time foreign key (fk_time_id) references time (id) on delete cascade\n);\n\ncreate trigger cascade_delete_unused_time_for_int_sample_trigger\n  after delete on int_sample\n  referencing old as oldrow\n  for each row\n  delete from time where \n  time.id = oldrow.fk_time_id\n  and id not in (select fk_time_id from int_sample) \n  and id not in (select fk_time_id from long_sample) \n  and id not in (select fk_time_id from float_sample) \n  and id not in (select fk_time_id from double_sample) \n  and id not in (select fk_time_id from boolean_sample) \n  and id not in (select fk_time_id from string_sample);\n\n4.  Invocation.  This is very rough pseudocode focusing on the core logic.  In reality, there's a lot more code, but I'm doing the usual stuff, such as using prepared statements, and closing all resources when done.  The key thing is that I'm using two statements in a nested fashion; in the outer statement, I iterate over records in the time table, and in the inner loop I use a second statement to delete records in one of the sample tables.  I can provide the actual code if desired.\n\ndeleteSamples(int bandId, String sampleTable, Object someQueryCriteria) {\n  within transaction {\n    create stmt1 iterating over time ids in time table (restricted by someQueryCriteria)\n      for (time_id in stmt1) {\n        PreparedStatement stmt2 = conn.prepareStatement(String.format(\n        \"delete from %s where fk_band_id = ? and fk_time_id = ?\", sampleTable));\n        set stmt2 parameters and executeUpdate()\n    }\n  }\n}\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37386","summary":"Intermittent transaction failure caused by internal duplicate savepoint name for triggers","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jn","name":"jn","emailAddress":"jim dot newsham at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jim Newsham","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jn","name":"jn","emailAddress":"jim dot newsham at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jim Newsham","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Java 1.6.0_02\n","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":27,"total":27,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12535384","id":"12535384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"In briefly looking into this issue I noticed that the internal savepoint name is created in GenericStatementContext's constructor with the following line of code:\r\n\r\n\t\tinternalSavePointName = \"ISSP\" + hashCode();\r\n\r\nFrom the javadoc for Object:\r\n\r\nIt is not required that if two objects are unequal according to the equals(java.lang.Object) method, then calling the hashCode method on each of the two objects must produce distinct integer results. However, the programmer should be aware that producing distinct integer results for unequal objects may improve the performance of hashtables. \r\n\r\n As much as is reasonably practical, the hashCode method defined by class Object does return distinct integers for distinct objects. (This is typically implemented by converting the internal address of the object into an integer, but this implementation technique is not required by the JavaTM programming language.)\r\n\r\nAnother method of creating unique names should be implemented.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2007-10-17T00:42:33.941+0000","updated":"2007-10-17T00:42:33.941+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12535673","id":"12535673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"That's a good catch, James! Seems like you have found the bug. If the savepoint name only needs to be unique within a transaction, I think we can fix it by maintaining a counter in GenericLanguageConnectionContext and adding a getUniqueSavepointName() method which returns \"ISSP1\", \"ISSP2\", ...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-17T18:53:49.351+0000","updated":"2007-10-17T18:53:49.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536446","id":"12536446","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"Attached is a patch proposal (derby-3093_diff.txt) for review.\r\n\r\nFiles modified: org.apache.derby.impl.sql.conn.GenericStatementContext.java\r\n\r\nI changed the way the internal savepoint name isgenerated that should provide unique savepoint names.\r\n\r\nDerbyall and suites.All ran cleanly. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2007-10-20T17:14:07.338+0000","updated":"2007-10-20T18:37:18.269+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536476","id":"12536476","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for the patch. It looks like a good solution to me. I'll run some tests and commit it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-20T22:35:09.142+0000","updated":"2007-10-20T22:35:09.142+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536478","id":"12536478","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks for working on this problem James!\r\n\r\nTwo questions:\r\n\r\n1) The comments in the JIRA issue talked about making a counter which was unique-per-transaction,\r\nbut the patch looks like it chose a static field instead. Your solution seems fine to me, but since I\r\nnoticed this I thought I'd mention it, and make sure that this was intentional.\r\n\r\n2) It would be nice to have a test program for this situation, particularly since the problem was\r\nintermittent. Is there a way to describe a test that demonstrates the superiority of the new\r\nsavepoint naming technique?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-10-21T00:45:21.997+0000","updated":"2007-10-21T00:45:21.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536517","id":"12536517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Fixed typo in summary (typo was in a keyword, fixed it to make searching easier) and classified the bug as SQL. Also added version 10.2.2.0 and 10.1.3.1 to the affects list, as the same naming scheme is used there.\r\nIn my opinion, this fix should at least be ported to the 10.2 branch, possibly also the 10.1 branch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2007-10-21T18:21:03.093+0000","updated":"2007-10-21T18:21:03.093+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536529","id":"12536529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"Bryan,\r\n\r\nWith regards to your comments:\r\n\r\n1) Yes it was intentional.  It seemed the most straight forward to implement the name creation without making it unique per transaction.\r\n2) I am not sure how we could test this but any suggestions are of course welcome.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2007-10-21T19:22:44.576+0000","updated":"2007-10-21T19:22:44.576+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536540","id":"12536540","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"When I suggested a savepoint name that was unique within a transaction, instead of a globally unique name, it was primarily to avoid the need for synchronization. But when I thought more about it, I think that it would be unnecessarily complex without adding significant value, so James's simpler solution sounds better to me.\r\n\r\nCommitted the patch to trunk with revision 586956 and to 10.3 with revision 586957.\r\n\r\nI intend to commit the fix on the 10.2 branch as well, as requested by Kristian.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-21T21:21:22.927+0000","updated":"2007-10-21T21:21:22.927+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536542","id":"12536542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"As to Bryan's questions about tests, I think this bug is inherently intermittent, and even if we were able to write a test to reproduce it, it would probably be very sensitive to JVM and gc/timing. Combined with the low probability of reintroducing this bug, and the fact that we already have tests that will start failing intermittently if it is reintroduced, I feel comfortable with committing the patch without adding tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-21T21:32:49.238+0000","updated":"2007-10-21T21:32:49.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536545","id":"12536545","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"> James's simpler solution sounds better\r\n\r\nI agree. The new code is simple and clear. Thanks for the follow-up!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-10-21T22:13:51.261+0000","updated":"2007-10-21T22:13:51.261+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536565","id":"12536565","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I am hoping that this issue is the cause of the intermittent test failures that have been reported with some of the IBM jvms, see DERBY-2808, and see for instance http://people.apache.org/~fuzzylogic/derby_test_results/main/testSummary-582051.html\r\n(Although, apparently, these results haven't been updated for several weeks).\r\n\r\nI'll keep an eye out for new reports, or run some tests myself, and see if we can close that one off as a duplicate, or as 'fixed'.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2007-10-22T04:26:32.554+0000","updated":"2007-10-22T04:26:32.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536597","id":"12536597","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed to 10.2 with revision 587034.\r\n\r\nThanks James for fixing the bug, and Myrna for volunteering to keep an eye on the other failures.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-22T08:47:53.907+0000","updated":"2007-10-22T08:47:53.907+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536722","id":"12536722","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I'm close to -1 on this patch, it introduces a single point of synchronization where one is not required. Knut Anders (I think?) has already shown the cost of one of these in Derby with the synchronization required for ensuring the statement plan is up to date.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-10-22T16:03:41.773+0000","updated":"2007-10-22T16:03:41.773+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536770","id":"12536770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Isn't this a cost that you only get when you prepare a statement, not during execution? But Dan is right, that was the reason why I initially suggested names unique only within transaction.\r\n\r\nStill, without the patch, Derby's behaviour is buggy, so I don't think backing the patch out will improve the situation. Anyone is free to improve the code, though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-22T18:01:48.836+0000","updated":"2007-10-22T18:01:48.836+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536782","id":"12536782","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"No, this is an execution time cost for every statement. Though the first two statements on the stack will not hit this as Derby caches two statement contexts per connection.\r\n\r\nNon-final static fields are really something to be avoided in Java, especially in Derby. This synchronizes statements across all connections in all databases using the same Derby version within a single vm.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-10-22T18:20:58.434+0000","updated":"2007-10-22T18:20:58.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536801","id":"12536801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks Dan. In that case I agree that this should be addressed before the issue is closed. James, are you willing to work on making the proposed changes?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-22T19:15:58.641+0000","updated":"2007-10-22T19:15:58.641+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536814","id":"12536814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"Given dan's observation will this be backed out of the branches until the correct fix is available.  \r\nIf someone is signed up to work on it actively I am not as concerned about the trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-10-22T20:01:23.225+0000","updated":"2007-10-22T20:01:23.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536873","id":"12536873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"I will attempt to make the necessary changes.\r\n\r\nIn looking a bit further I found that the LanguageConnectionContext that is passed into the constructor for GenericStatementContext has a method called getUniqueSavepointName that has the following description:\r\n\r\n                                   Get a connection unique system generated name for an unnamed savepoint.\r\n\r\nWould it be appropriate to use this method to create the savepoint name?  If so I will create a new patch that incorporates it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2007-10-23T00:38:36.976+0000","updated":"2007-10-23T00:38:36.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536943","id":"12536943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Mike, I have backed out the fix from 10.2 and 10.3. Leaving it in trunk since James said he'll make the improvements.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-23T08:23:15.703+0000","updated":"2007-10-23T08:23:15.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12536947","id":"12536947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"James, I think LanguageConnectionContext.getUniqueSavepointName() should work. That is, unless there's a possibility that two LCC instances have the same TransactionController, it shouldn't cause duplicate savepoint names. It would be great if someone who's more familiar with this area of the code could comment on whether that's possible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-23T09:08:12.256+0000","updated":"2007-10-23T09:08:12.256+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12537035","id":"12537035","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"getUniqueSavepointName will work - good find.\r\n\r\nThe main relationship for these objects is:\r\n\r\nEmbedConnection   1-1  LanguageConnectionContext  1-1* TransactionController\r\n\r\nOnly one thread is active within these objects at any time (save for garbage collection), this is enforced by synchronization at the JDBC (EmbedConnection) layer.\r\n\r\n* A nested internal transaction leads to another TransactionController but not relevant here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-10-23T15:04:08.310+0000","updated":"2007-10-23T15:04:08.310+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12537175","id":"12537175","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"Attached is an updated patch proposal that uses LanguageConnectionContext.getUniqueSavepointName to generate the savepoint names.  The test cannons for savepointJdbc30_JSR169 and savepointJdbc30_XA needed to be modified as some exception text was affected by the change.\r\n\r\nRan Derbyall and suites.All with no new errors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2007-10-24T00:00:46.724+0000","updated":"2007-10-24T00:00:46.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12537181","id":"12537181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I think we can just use getUniqueSavepointName() as-is.\r\n\r\nie. replace\r\n\r\ninternalSavePointName = \"ISSP\" + lcc.getUniqueSavepointName();\r\n\r\nwith\r\n\r\ninternalSavePointName = lcc.getUniqueSavepointName();","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-10-24T00:31:36.463+0000","updated":"2007-10-24T00:31:36.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12537194","id":"12537194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"body":"Updated patch replacing\r\n\r\ninternalSavePointName = \"ISSP\" + lcc.getUniqueSavepointName();\r\n\r\nwith\r\n\r\ninternalSavePointName = lcc.getUniqueSavepointName();\r\n\r\n\r\nRan Derbyall and suites.All with no new errors.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=james.f.adams","name":"james.f.adams","emailAddress":"derby at xemaps dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"James F. Adams","active":true},"created":"2007-10-24T03:24:41.877+0000","updated":"2007-10-25T08:13:01.352+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12537569","id":"12537569","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The fix looks good and the changes to the master files make sense. All tests ran cleanly in my environment. Committed revision 588202.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-10-25T11:28:44.312+0000","updated":"2007-10-25T11:28:44.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12542005","id":"12542005","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"The improved fix went in more than two weeks ago, and it seems to have made a difference in the occurrences of DERBY-2808 in trunk.\r\n\r\nAny objections to backporting this to 10.3, 10.2 and 10.1?\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2007-11-13T00:38:24.722+0000","updated":"2007-11-13T00:38:24.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12379326/comment/12543617","id":"12543617","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I plan to merge this fix to 10.3. Please let me know if you have any concerns.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-11-19T17:18:13.592+0000","updated":"2007-11-19T17:18:13.592+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3093/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06rhb:"}}