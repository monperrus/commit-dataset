{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12354729","self":"https://issues.apache.org/jira/rest/api/latest/issue/12354729","key":"DERBY-2041","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324243","id":"12324243","description":"First release on the 10.11 branch","name":"10.11.1.1","archived":false,"released":true,"releaseDate":"2014-08-26"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2013-09-13 08:39:32.612","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"30250","customfield_12310222":"3_*:*_1_*:*_1972164171_*|*_1_*:*_1_*:*_221672783379_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-12-05T07:43:03.514+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2041/watchers","watchCount":3,"isWatching":false},"created":"2006-11-03T20:07:16.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":["derby_backport_reject_10_10","derby_triage10_11"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12375194","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12375194","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12408012","key":"DERBY-3940","self":"https://issues.apache.org/jira/rest/api/2/issue/12408012","fields":{"summary":"Dropping a column does not drop triggers which mention that column","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12375193","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12375193","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12479221","key":"DERBY-4887","self":"https://issues.apache.org/jira/rest/api/2/issue/12479221","fields":{"summary":"ALTER TABLE DROP COLUMN leaves the dependent trigger invalid rather than drop it","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12378674","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12378674","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12465638","key":"DERBY-4681","self":"https://issues.apache.org/jira/rest/api/2/issue/12465638","fields":{"summary":"Dropping a column in the table drops the views that use this table","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12378675","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12378675","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12347134","key":"DERBY-1632","self":"https://issues.apache.org/jira/rest/api/2/issue/12347134","fields":{"summary":"During revoke privilege, Derby does not look for replacement privilege for the dependent objects and simply drops the dependent objects. This is not SQL compliant and should be fixed.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12378676","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12378676","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12348900","key":"DERBY-1782","self":"https://issues.apache.org/jira/rest/api/2/issue/12348900","fields":{"summary":"When a privilege is revoked at table level, Derby should only drop objects that require that particular privilege and not all the objects that require some form of privilege on that table.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12376585","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12376585","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12313741","key":"DERBY-534","self":"https://issues.apache.org/jira/rest/api/2/issue/12313741","fields":{"summary":"Support use of the WHEN clause in CREATE TRIGGER statements","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12314018","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12314018","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12345617","key":"DERBY-1490","self":"https://issues.apache.org/jira/rest/api/2/issue/12345617","fields":{"summary":"Provide ALTER TABLE RENAME COLUMN functionality","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12394400","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12394400","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12731721","key":"DERBY-6684","self":"https://issues.apache.org/jira/rest/api/2/issue/12731721","fields":{"summary":"Failure in testDERBY5120NumRowsInSydependsForTrigger when upgrading from 10.11.1.0 to trunk","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12378983","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12378983","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12681009","key":"DERBY-6420","self":"https://issues.apache.org/jira/rest/api/2/issue/12681009","fields":{"summary":"Clarify how DROP statements work on trigger dependencies","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-08-18T19:10:18.987+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"A trigger registers a dependency in the Dependency Manager for those columns which cause the firing of the trigger, but does not register a dependency on tables and columns which are used in the body of the trigger. This means that the trigger may unexpectedly become invalid due to a change to one of those tables and columns in its body, and the user may be surprised that Derby did not warn them of this problem when the underlying table/column change was made.\r\n\r\nAn example of this problem is as follows:\r\n\r\ncreate table t1 (c1 int);\r\ncreate table t2 (c2 int);\r\ncreate trigger tr1 after update of c1 on t1  for each row mode db2sql insert into t2 (c2) values (1);\r\n\r\nWith this set of definitions, Derby will warn/prevent the user about changes to table t1 and column c1, but will not warn the user about changes to table t2 and column c2. If the user drops or renames t2 or c2, the trigger will then give an error the next time it fires.\r\n\r\nIt seems like it would be an improvement for the trigger to record this dependency on table t2 and column c2.\r\n\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40305","summary":"Trigger should register a dependency on tables and columns used in its body","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":23,"total":23,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13766339","id":"13766339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Changing issue type from Improvement to Bug, since the lack of dependency tracking may cause errors later when the trigger that still references dropped objects is fired. Also, the lack of dependency tracking for columns has been reported as a bug by others (DERBY-3940, DERBY-4887).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-09-13T08:39:32.612+0000","updated":"2013-09-13T08:39:32.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13766345","id":"13766345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Here's a repro that shows that dropping a table referenced in the trigger action silently succeeds, and that the invalid trigger still exists afterwards:\r\n\r\n{noformat}\r\nij version 10.10\r\nij> connect 'jdbc:derby:memory:db;create=true';\r\nij> create table t1(x int);\r\n0 rows inserted/updated/deleted\r\nij> create table t2(x int);\r\n0 rows inserted/updated/deleted\r\nij> create trigger tr1 after insert on t1 for each row insert into t2 values 1;\r\n0 rows inserted/updated/deleted\r\nij> drop table t2;\r\n0 rows inserted/updated/deleted\r\nij> insert into t1 values 1,2,3;\r\nERROR 42X05: Table/View 'T2' does not exist. (errorCode = 30000)\r\n{noformat}\r\n\r\nA repro that shows the problem with dropping a column referenced in the trigger action can be found in DERBY-3940.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-09-13T09:02:59.598+0000","updated":"2013-09-13T09:02:59.598+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13790354","id":"13790354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The same problem exists with other SQL objects, such as functions. You can drop a function that's used in a trigger body, but the trigger will fail when it tries to invoke the function.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-10-09T13:44:13.831+0000","updated":"2013-10-09T13:44:13.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13790356","id":"13790356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The WHEN clause (DERBY-534) also suffers from this problem, because its implementation mostly reuses the existing implementation used by the triggered SQL statement. When this bug is fixed, we should make sure that it works both for the WHEN clause and for the triggered SQL statement.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-10-09T13:49:19.022+0000","updated":"2013-10-09T13:49:19.022+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13811184","id":"13811184","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The reference manual says the following in [CREATE TRIGGER statement|http://db.apache.org/derby/docs/10.10/ref/rrefsqlj43125.html]:\r\n\r\n{quote}\r\nThe triggered-SQL-statement can reference database objects other than the table upon which the trigger is declared. If any of these database objects is dropped, the trigger is invalidated. If the trigger cannot be successfully recompiled upon the next execution, the invocation throws an exception and the statement that caused it to fire will be rolled back.\r\n{quote}\r\n\r\nWhen we have fixed the bug, we should update this paragraph.\r\n\r\nAdding \"Documentation\" component.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-01T11:43:47.159+0000","updated":"2013-11-01T11:43:47.159+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13815814","id":"13815814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"DERBY-6390 removed the above mentioned paragraph from the CREATE TRIGGER statement topic. We may consider reintroducing it after fixing this bug (with the actual text changed to reflect the new, corrected behaviour). It may be just fine to leave it out, though, since the new behaviour should be as described in the various DROP statement topics, so there should be no exception to document for triggers.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-07T10:04:13.634+0000","updated":"2013-11-07T10:04:13.634+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13819082","id":"13819082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I'll have a look and see if we can fix this issue by making CREATE TRIGGER register dependencies in a similar way to how CREATE VIEW does it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-11T16:17:58.724+0000","updated":"2013-11-11T16:17:58.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13820240","id":"13820240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It looks like using the same approach as CREATE VIEW might work.\r\n\r\nThe attached patch, register-dependencies.diff, makes CreateTriggerNode register dependencies the same way as CreateViewNode, and pass them on to CreateTriggerConstantAction, which stores those dependencies in SYS.SYSDEPENDS.\r\n\r\nThose changes alone were enough to make DROP TABLE behave as expected. Additionally, TriggerDescriptor.prepareToInvalidate() had to be told to raise an error if some other kinds of SQL objects were dropped, such as functions and views.\r\n\r\nDROP TYPE, DROP SEQUENCE and DROP DERBY AGGREGATE already had the expected behaviour, as they piggybacked on the trigger's SPS and had SPSDescriptor.prepareToInvalidate() raise an error if such a dependency was about to be dropped. Unfortunately, that creates a rather cryptic error message:\r\n\r\nERROR X0Y24: Operation 'DROP DERBY AGGREGATE' cannot be performed on object 'INTMODE' because STATEMENT 'TRIGGERACTN_5ddba7b4-0142-4c61-18e0-000058ee2be7_c6f5a764-0142-4c61-18e0-000058ee2be7' is dependent on that object.\r\n\r\nThe patch moves that error handling from SPSDescriptor to TriggerDescriptor, which makes the error message clearer:\r\n\r\nERROR X0Y25: Operation 'DROP DERBY AGGREGATE' cannot be performed on object 'INTMODE' because TRIGGER 'TR_INTMODE' is dependent on that object.\r\n\r\nThe patch adds a new test case to TriggerTest which verifies that dropping of procedures, functions, table functions, synonyms, sequences, aggregates, views, tables, columns and UDTs works as expected.\r\n\r\nCurrently, many of the existing regression tests fail with the patch. The failures seem to be mainly because the tests attempt to drop a table while there's still a trigger that references it. Those failures are expected, and the tests need to be updated.\r\n\r\nOne thing to consider, is how we expect the behaviour to be on upgrade and downgrade.\r\n\r\nThe current behaviour of the patch is as following:\r\n\r\n# The trigger's dependencies are registered when the trigger is created, so existing triggers will not automatically get the new dependency tracking on upgrade.\r\n# CREATE TRIGGER registers the dependencies even if the database is in soft-upgrade mode. This means the dependencies are still registered after downgrade, but the old version is only partially capable of using the dependencies. (Since it doesn't have the TriggerDescriptor updates, it still won't detect dependencies for example in DROP FUNCTION and DROP VIEW, but it will be able to detect them with DROP TABLE.)\r\n# After upgrade (soft or hard) dropping UDTs, aggregates or sequences will no longer detect dependencies on triggers created with the old version. (Since the trigger dependencies were not registered at CREATE TRIGGER time, and the code that piggybacked on the SPS dependencies is not in the new version.)\r\n\r\nI guess #1 is OK, since existing triggers won't behave worse than before. It might be possible to create some upgrade code that reconstructs the dependencies on upgrade, but that may be more complexity than it's worth.\r\n\r\n#2 is probably OK too, as it makes the behaviour after downgrade more correct, even though it still misses a few cases.\r\n\r\n#3 means that the trigger's dependencies on UDTs, aggregates and sequences are lost on upgrade, and the trigger needs to be dropped and recreated with the new version in order to make the dependency tracking as good as it was in the old version. We should try to find a better way to handle this.\r\n\r\nI can see two quick solutions to that problem:\r\n\r\n# Move the invalidation logic for those three types of SQL objects back from TriggerDescriptor to SPSDescriptor. That means the cryptic error messages are back, but it also means the behaviour does not change on upgrade. (Apart from the messages being somewhat cryptic, the behaviour was correct before upgrade.)\r\n# Have the invalidation logic both in TriggerDescriptor and SPSDescriptor. In that case, we'll have the cryptic message when we drop a UDT/aggregate/sequence used in one of the existing triggers. And if we drop one that is used in a trigger created with the new version, we'll get *both* the cryptic message and the one that shows the actual trigger name, in two SQLExceptions that are linked to each other.\r\n\r\nI guess we could live with either of those solutions even though both are suboptimal.\r\n\r\nAnother option is to keep the logic in SPSDescriptor.prepareToInvalidate() and add some logic to make it look up the actual trigger name in the system tables. But I think that would probably be too much complexity for too little gain in these edge cases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-12T16:51:22.787+0000","updated":"2013-11-12T16:51:22.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13822449","id":"13822449","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I've come to the conclusion that, at least in the first round, we should keep the fix minimal and not try to improve those parts that already work. That is, DROP COLUMN, DROP DERBY AGGREGATE, DROP TYPE and DROP SEQUENCE seem to detect dependent triggers already, so they should be left as they are.\r\n\r\nI've gone through the failing tests and found that they come in the following categories:\r\n* Cleanup code that drops tables/triggers between test cases without paying attention to trigger dependencies. These DROP statements should be reordered so that dependents are dropped before their dependencies.\r\n* Tests that explicitly check for the old behaviour. That is, they verify that trigger dependencies can be dropped, and that the trigger still exists afterwards and fails when it fires. These test cases should instead verify the new behaviour (dropping the dependency fails, and the trigger is still functioning).\r\n* Tests that inspect the contents of the SYS.SYSDEPENDS table, and now see more rows.\r\n\r\nThe one test failure that stood out, was the following (copied from lang/refActions.sql):\r\n\r\n{noformat}\r\nij> create table t1( a int not null primary key , b int , c int not null unique) ;\r\n0 rows inserted/updated/deleted\r\nij> create table t2( x int not null unique references t1(c) ON DELETE CASCADE ) ;\r\n0 rows inserted/updated/deleted\r\nij> create table t3( y int references t2(x) ON DELETE CASCADE) ;\r\n0 rows inserted/updated/deleted\r\nij> create trigger trig_delete after DELETE on t1\r\nfor each row\r\ndelete from t2;\r\n0 rows inserted/updated/deleted\r\nij> drop table t3;\r\nERROR X0Y25: Operation 'DROP TABLE' cannot be performed on object 'T3' because TRIGGER 'TRIG_DELETE' is dependent on that object.\r\n{noformat}\r\n\r\nThe trigger 'TRIG_DELETE' doesn't reference table 'T3', so I found this error puzzling. TRIG_DELETE's action deletes rows from T2, and possibly cascades to T3 because of T3's REFERENCING clause. So it is true that TRIG_DELETE depends on T3. However, it's more of a soft dependency, as its trigger action would still be compilable after T3 is dropped. So I think it wouldn't be unreasonable to expect \"drop table t3\" to succeed in this case, and just have TRIG_DELETE recompile its SPS. I'm not sure if it is possible to distinguish between these kinds of dependencies currently, but at least there is room for improvement in this edge case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-14T13:45:57.440+0000","updated":"2013-11-14T13:45:57.440+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13822451","id":"13822451","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching an updated patch, d2041-1a.diff, which has removed the handling of those DROP statements that already work as expected, and which updates the tests that failed because of the changed behaviour. All regression tests ran cleanly with this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-14T13:49:25.218+0000","updated":"2013-11-14T13:49:25.218+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13823679","id":"13823679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The edge case mentioned above, where a foreign key causes DROP TABLE to think the trigger references the table, seems to happen because DMLModStatementNode.createConstraintDependencies() adds all referencing tables as dependencies. The comments indicate that these dependencies are added in order to make statements recompile if the referencing tables change, and not in order to restrict or cascade DROP operations. One possible way forward might be to make this code skip adding those dependencies if the dependent is a TriggerDescriptor. The dependencies are still added to the SPSDescriptor, so the trigger action should be able to detect that it needs to be recompiled even if the TriggerDescriptor itself doesn't depend on the table.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-15T14:10:50.741+0000","updated":"2013-11-15T14:10:50.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13826417","id":"13826417","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I've given up on the edge case described above for now.\r\n\r\nThe suggested workaround did not work for a number of reasons: DMLModStatementNode.createConstraintDependencies() doesn't get called with the TriggerDescriptor as a dependent. (These dependencies are collected in the auxiliary provider list and copied to the TriggerDescriptor later. In fact, the TriggerDescriptor doesn't even exist yet when the dependencies are collected.) So we cannot tell in that method whether the dependencies are for a trigger or something else. And even if we could tell the difference there, the dependency on the referencing table also gets added via other code paths where it's equally difficult to tell whether it's a trigger dependency.\r\n\r\nAn alternative workaround that I explored, was to make TriggerDescriptor.prepareToInvalidate() check if it was possible to parse and bind the trigger action and ignore the dependency if it was still possible. That approach didn't work either, because the DROP operations check the dependencies before they mark the object as dropped in the system tables, so recompilation of the trigger action during invalidation will not detect that a dependency is about to be dropped.\r\n\r\nThis edge case is somewhat similar to DERBY-1632, DERBY-1782 and DERBY-4681 where the dependency manager is too strict. It might be possible to devise a fix for this particular case, but it might also be that we need to build more flexibility into the dependency tracking to have something that could be used for all these cases. In any case I think the edge case is small enough that the current approach is a net improvement.\r\n\r\nI'm uploading an updated patch (d2041-1b.diff) which cleans up some comments and adds more test cases to TriggerTest.\r\n\r\nAll tests ran cleanly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-19T11:58:47.107+0000","updated":"2013-11-19T11:58:47.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13831286","id":"13831286","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1545179 from [~knutanders] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1545179 ]\r\n\r\nDERBY-2041: Trigger should register a dependency on tables and columns used in its body","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-11-25T08:59:25.952+0000","updated":"2013-11-25T08:59:25.952+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13831356","id":"13831356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I've filed DERBY-6420 to update the documentation, so I'm removing the Documentation component from this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-11-25T11:00:47.954+0000","updated":"2013-11-25T11:00:47.954+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13837879","id":"13837879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching a release note for this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-12-03T16:41:45.378+0000","updated":"2013-12-03T16:41:45.378+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13839306","id":"13839306","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching a patch that adds an upgrade test case that verifies the behaviour on upgrade and downgrade.\r\n\r\nThis is the first upgrade test case that creates a view, and that caused some problems for DatabaseMetaDataTest when it runs as part of the upgrade test suite. The problems happen when DatabaseMetaDataTest cross checks all rows returned by getColumns() against ResultSetMetaData.getSchemaName() and ResultSetMetaData.getTableName(). Those checks fail because the RSMD methods return data for the underlying table and not for the view itself (intentionally, judging by other tests). The patch avoids these problems by making DatabaseMetaDataTest skip the failing checks for columns in views.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-12-04T20:17:41.201+0000","updated":"2013-12-04T20:17:41.201+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13839917","id":"13839917","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1548032 from [~knutanders] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1548032 ]\r\n\r\nDERBY-2041: Trigger should register a dependency on tables and columns used in its body\r\n\r\nAdd an upgrade test to verify how the dependencies are handled after\r\nupgrade and downgrade.\r\n\r\nSkip some cross checking between getColumns() and ResultSetMetaData\r\nfor views in DatabaseMetaDataTest, since those checks only pass for\r\ntables. The upgrade test case adds a view that upsets the meta-data\r\ntest. (This is the first upgrade test that uses views.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-05T07:41:49.393+0000","updated":"2013-12-05T07:41:49.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13839918","id":"13839918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"No more changes are planned for this issue. Marking as resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-12-05T07:43:03.543+0000","updated":"2013-12-05T07:43:03.543+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13913303","id":"13913303","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"consider for 10.10 backport","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2014-02-26T18:46:30.935+0000","updated":"2014-02-26T18:46:30.935+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/13918340","id":"13918340","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I'm marking this as reject backport to 10.10, it seems this issue might cause compatibility issues, judging by the release note.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-03-03T18:12:28.554+0000","updated":"2014-03-03T18:12:28.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/14025172","id":"14025172","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Correct typos in the detailed release note.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-06-09T13:15:15.320+0000","updated":"2014-06-09T13:15:15.320+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/14094963","id":"14094963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1617641 from [~mamtas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1617641 ]\r\n\r\nDERBY-6684(Failure in testDERBY5120NumRowsInSydependsForTrigger when upgrading from 10.11.1.0 to trunk)\r\nWe ran into DERBY-6684 after the fix for DERBY-2041 went into 10.11\r\nThe failure is the expected behavior since when dropping a table,\r\nwe should detect any dependent triggers defined on other tables\r\nand drop table should fail if such dependencies exist. To fix the\r\ntest failure, we just need to switch the order of drop table\r\nDERBY-2041(Trigger should register a dependency on tables and columns used in its body)\r\nDrop ATDC_TAB1 before ATDC_BKUP1 because ATDC_TAB1 has a trigger\r\non it which references ATDC_BKUP1. If we try dropping ATDC_BKUP1\r\nwithout first dropping ATDC_TAB1, there will be an error message\r\nthat trigger ATDC_TAB1_TRG1 depends on ATDC_BKUP1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-08-13T00:43:23.934+0000","updated":"2014-08-13T00:43:23.934+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12354729/comment/14094979","id":"14094979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1617642 from [~mamtas] in branch 'code/branches/10.11'\r\n[ https://svn.apache.org/r1617642 ]\r\n\r\nDERBY-6684(Failure in testDERBY5120NumRowsInSydependsForTrigger when upgrading from 10.11.1.0 to trunk)\r\nBackporting changes from trunk to 10.11. No futher backporting is needed because the test had started failing because of DERBY-2041(Trigger should register a dependency on tables and columns used in its body) but the change for DERBY-2041 went in 10.11 codeline","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-08-13T00:56:06.749+0000","updated":"2014-08-13T00:56:06.749+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2041/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i079hz:"}}