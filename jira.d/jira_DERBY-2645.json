{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12369304","self":"https://issues.apache.org/jira/rest/api/latest/issue/12369304","key":"DERBY-2645","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":null,"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23150","customfield_12310222":"1_*:*_1_*:*_1745403030_*|*_6_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-06-03T23:52:01.676+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2645/watchers","watchCount":0,"isWatching":false},"created":"2007-05-14T19:01:58.646+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-29T22:57:45.191+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"Since activating the upgrade tests for weme6.1 (and resolving some of the failures) I can now see 1 new error and 13 new failures. Some of these may warrant their own bug; some are probably caused by the initial problem.\n\n(In the section below, I'm skipping the junit.extensions.* part of the stack.)\n\nerror:\n2)\n testProcedureSignature(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_1)java.sql.SQLException: PROCEDURE 'GC' already exists.\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.CreateAliasConstantAction.executeConstantAction(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_1.testProcedureSignature(Changes10_1.java:87)\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)\n                      ....\n------------------\n\nfailures: \n6) testProcedureSignature(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_1)junit.framework.AssertionFailedError: Expected error 'XCL47' but no error was thrown.\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:703)\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_1.testProcedureSignature(Changes10_1.java:82)\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\n\tat <unknown class>.<unknown method>(Unknown Source)\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)\n                     ...\n\n\n2) and, 11) \ntestOldVersion(org.apache.derbyTesting.functionTests.tests.upgradeTests.BasicSetup)junit.framework.AssertionFailedError: Old minor (driver):  expected:<0> but was:<3>\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.BasicSetup.testOldVersion(BasicSetup.java:61)\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\n\tat <unknown class>.<unknown method>(Unknown Source)\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)\n                     ...\n--------------------\n\n3), 7) and 12), with a variation in originating line number in Changes10_2:(marked (#) in the stack below).\nand expected error number\n\ntestGrantRevokeStatements(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2)\n(3, 12) junit.framework.ComparisonFailure: Unexpected SQL state. expected:<...X01> but was:<...Z60>\n(7)junit.framework.ComparisonFailure: Unexpected SQL state. expected:<XCL47> but was:<42Z60>\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:523)\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDBCTestCase.java:585)\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:706)\n(3, 12) \tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testGrantRevokeStatements(Changes10_2.java:241)\n(7)                at \norg.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testGrantRevokeStatements(Changes10_2.java:250)\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\n\tat <unknown class>.<unknown method>(Unknown Source)\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)\n                     ...\nCaused by: java.sql.SQLException: GRANT not allowed unless database property derby.database.sqlAuthorization has value 'TRUE'.\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n\tat org.apache.derby.impl.sql.compile.SQLParser.checkSqlStandardAccess(Unknown Source)\n\tat org.apache.derby.impl.sql.compile.SQLParser.grantStatement(Unknown Source)\n\tat org.apache.derby.impl.sql.compile.SQLParser.StatementPart(Unknown Source)\n\tat org.apache.derby.impl.sql.compile.SQLParser.Statement(Unknown Source)\n\tat org.apache.derby.impl.sql.compile.ParserImpl.parseStatement(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:701)\n(3, 12) \tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testGrantRevokeStatements(Changes10_2.java:241)\n(7)\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testGrantRevokeStatements(Changes10_2.java:250)\n\tat \tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\n\t... 64 more\n------------------\n\n4), 8) and 13)\n testDatabaseOwnerChange(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2)junit.framework.ComparisonFailure: AUTHORIZATIONID not valid for SYSIBM expected:<DBA> but was:<APP>\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.checkSystemSchemasOwner(Changes10_2.java:300)\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_2.testDatabaseOwnerChange(Changes10_2.java:282)\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\n\tat <unknown class>.<unknown method>(Unknown Source)\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)\n                     ...\n------------------\n\n5) , 10) and 14)\ntestPolicyReloadingProcedure(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3)junit.framework.AssertionFailedError: Reloading results. expected:<false> but was:<true>\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.tryReloading(Changes10_3.java:362)\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.assertPolicyReloaderDoesNotExist(Changes10_3.java:340)\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.testPolicyReloadingProcedure(Changes10_3.java:311)\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\n\tat <unknown class>.<unknown method>(Unknown Source)\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)\n                     ...\n\n------------------\n\n9) testImportExportLobsProcedures(org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3)junit.framework.AssertionFailedError: Expected error '42Y03' but no error was thrown.\n\tat org.apache.derbyTesting.junit.BaseJDBCTestCase.assertStatementError(BaseJDBCTestCase.java:703)\n\tat org.apache.derbyTesting.functionTests.tests.upgradeTests.Changes10_3.testImportExportLobsProcedures(Changes10_3.java:252)\n\tat java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\n\tat <unknown class>.<unknown method>(Unknown Source)\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:88)\n                     ...\n------------------\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38988","summary":"upgrade test failures with weme 6.1.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"windows 2000, weme6.1 (j2ME/CDCFoundation/JSR169)","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10053","value":"Low","id":"10053"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":2,"total":2,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12369304/comment/12500017","id":"12500017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"The problem only happens when upgrading from 10.0.2.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2007-05-30T03:58:04.142+0000","updated":"2007-05-30T03:58:04.142+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12369304/comment/12501064","id":"12501064","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I didn't fully debug this, but I theorize that what happens, is that the test framework attempts to create an EmbeddedSimpleDataSource, but instead of finding this with the 10.0 derby.jar, it finds the 10.3 version and uses that. Hence, the db is really created with 10.3 and the test fails.\r\n\r\nI did a manual simple test, and created a 10.0.2.1 database (with one very simple table) using jdk15, then used JSR169 to upgrade to 10.3 with soft upgrade, then went back at it with jdk15 and that was fine. Then I used the simple 10.0 database with very simple table and did a hard upgrade to 10.3 with JSR169 and that was fine too.\r\n\r\nI don't think we should automate that test, it was just to make sure upgrade from 10.0 works also for JSR169.\r\n\r\nPrevented test from running upgrade from 10.0 with JSR169 with revisions:\r\n http://svn.apache.org/viewvc?view=rev&revision=542984\r\n http://svn.apache.org/viewvc?view=rev&revision=543809\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2007-06-03T23:52:01.591+0000","updated":"2007-06-03T23:52:01.591+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2645/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i071db:"}}