{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12348177","self":"https://issues.apache.org/jira/rest/api/latest/issue/12348177","key":"DERBY-1718","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-09-17 07:17:04.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22662","customfield_12310222":"3_*:*_1_*:*_390537000_*|*_1_*:*_1_*:*_2711106000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_38585884077","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-09-22T18:47:07.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1718/watchers","watchCount":0,"isWatching":false},"created":"2006-08-17T21:13:04.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-12-13T09:05:11.075+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"creating an after insert trigger with trigger action involving  xml datatype throws following error :\nij> create trigger trigxml after insert on t1 for each statement mode db2sql\ninsert into t2 values (1,\nxmlparse(document '<name> ram </name>' preserve whitespace));\nERROR XSDAJ: Exception during write of a serializable or SQLData object\nERROR XJ001: Java exception: 'org.apache.derby.iapi.types.SqlXmlUtil: java.io.No\nton'.SerializableExcepti\nij>\n\n\nrepro:\nconnect 'jdbc:derby:wombat;create=true';\ncreate table t1 (i int, x xml);\ncreate table t2 (i int, x xml);\n\ninsert into t2 values (1, \nxmlparse(document '<name> suresh </name>' preserve whitespace));\n--- following trigger creation is failing ,. \ncreate trigger trigxml after insert on t1 for each statement mode db2sql \ninsert into t2 values (1, \nxmlparse(document '<name> ram </name>' preserve whitespace));","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39652","summary":"creating an after insert trigger with trigger action involving  xml datatype throws  java.io.NottSerializableException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Java Version:    1.4.2\nJava Vendor:     IBM Corporation","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":13,"total":13,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12435290","id":"12435290","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"From looking at the stack trace, it appears that the SqlXmlUtil class which is used as a \"saved object\" didn't implement the org.apache.derby.iapi.services.io.Formatable interface; thus, causing the java.io.NonSerializableException when the system is externalizing the SPS object during execution of create trigger statement.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-17T07:17:04.000+0000","updated":"2006-09-17T07:17:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12435516","id":"12435516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching initial patch derby1718-trunk-diff01.txt for DERBY-1718.  The fix basically implements the Formatable interface for SqlXmlUtil class.  Currently, it writes out the query expression string instead of the XPath object(its serializable I think), and then later recompiles the query once at evaluation time.  The reason behind this is that I don't  want the stored form to be tied to a particular XML implementation.  But I am open if anyone feels that the Xalan XPath object should be serialized instead.  \r\n\r\nTo run the lang/xml_general.sql and lang/xmlBinding.java, please refer to the instructions in this thread:\r\n\r\nhttp://article.gmane.org/gmane.comp.apache.db.derby.devel/25793\r\n\r\nderbylang and the above xml tests passes.  Running derbyall now.  Appreciate if someone can review this patch.  Thanks.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-18T16:26:08.000+0000","updated":"2006-09-18T16:26:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12435554","id":"12435554","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thanks for picking this up, figuring out the problem, and providing a fix, Yip!\r\n\r\nI reviewed the patch and I agree that it's best to write/read the query expression itself instead of reading/writing a Xalan-specific object--so I think you did this the right way.  I applied the patch and did a full build with no problems.  I also ran the new test case with and without your changes and it behaved as expected--i.e. failed without the patch and passed with it.\r\n\r\nI then ran the xmlSuite (using ibm142) with these changes applied and I noticed that xml_general.sql fails with DerbyNet and DerbyNet client.  Based on your stat file, it looks like only the embedded master file was updated.  Can you run the new test with DerbyNet and DerbyNetClient, as well, and update the master files accordingly?\r\n\r\nOne other very minor comment is the age-old comment of whitespace: prior to this patch all lines in SqlXmlUtil.java used 4 spaces, but I see that the diff01 patch introduces tabs.  I think it'd be best if you could do a find/replace of tabs with spaces in just the SqlXmlUtil file--since the spacing is uniform in that file already, it'd be nice to keep it that way (even if the whole tab/space issue is still far from resolved for the codeline as a whole).\r\n\r\nThe whitespace isssue is a nit and should not block the patch; I do, however, think that the master updates for DerbyNet and DerbyNetClient should be made before the patch is committed...\r\n\r\nNote: assuming you have the required classes in your classpath, you can run all of the XML tests against embedded, JCC, and Derby client by running the \"xmlSuite\" suite.\r\nThanks again for your work on this!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-09-18T19:16:50.000+0000","updated":"2006-09-18T19:16:50.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12435568","id":"12435568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching derby1718-trunk-diff02.txt.  This patch fixes  the whitespace issue + the missing master files from derbynet and derbynetclient.  Thanks for reviewing the patch, Army.  derbyall + xmlSuite passes. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-18T20:33:09.000+0000","updated":"2006-09-18T20:33:09.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12435577","id":"12435577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thank you for the quick follow-up, Yip.  I ran xmlSuite with ibm142 and all tests passed.  I also verified that most of the whitespace in SqlXmlUtil.java has been fixed (there are 3 tabs remaining, but who's counting? ;)\r\n\r\n+1 to commit  derby1718-trunk-diff02.txt\r\n\r\nThanks again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-09-18T21:15:34.000+0000","updated":"2006-09-18T21:15:34.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12435612","id":"12435612","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"patch is available,  marking it a candidate for 10.2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-09-19T00:10:11.000+0000","updated":"2006-09-19T00:10:11.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12435616","id":"12435616","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"Thanks for working on this issue Yip. I will  run derbyall and commit the patch.  Thanks  a lot   for taking time to review the patch , Army. \r\n\r\n/suresh\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2006-09-19T00:19:37.000+0000","updated":"2006-09-19T00:19:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12436061","id":"12436061","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"I did a quick review of this patch. One change that caught my attention is the new\r\nformat id  added in this patch ,  I am wondering if this will cause any upgrade\r\nissues, if some one does soft-upgrade to 10.2, creates the trigger and then\r\nreverts back to 10.1  I think it should not cause any problems during recovery, \r\nbecause it is written as part of another higher level object (Storable Prepared Statement). \r\n\r\nAny one know if the new format id will cause any errors when building the stored\r\nprepared statement descriptors list or when the trigger gets executed on 10.1  ?\r\n\r\n\r\nThanks\r\n-suresh\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2006-09-19T23:43:01.000+0000","updated":"2006-09-19T23:43:01.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12436076","id":"12436076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"> Any one know if the new format id will cause any errors when building the stored\r\n> prepared statement descriptors list or when the trigger gets executed on 10.1  ?\r\n\r\nI don't really know all of the details on how SPS descriptors are \"built\" or what is/is not written to disk for triggers, but I did run the following scenario and everything appears to be working as expected:\r\n\r\n  - Create a 10.1 database\r\n  - Create tables t1 and t2 as shown in the description for this issue\r\n  - Disconnect/shutdown 10.1 database.\r\n  - Connect to 10.1 database with Derby 10.3 codeline, effectively doing a soft upgrade.\r\n  - Create the trigger trigxml as shown in the description for this issue\r\n  - Disconnect/shutdown the database.\r\n  - Reconnect to the database using Derby 10.1 codeline (effectively \"soft downgrade\")\r\n  - Execute an insert statement that fires the trigger.  The insert statement was successful,\r\n    as was the trigger statement action.\r\n\r\nI admit I was a bit surprised to see this work at first.  However, I then looked at the SYS.SYSSTATEMENTs table and I noticed that when I first create the trigger in 10.3, the \"VALID\" column is set to \"true\".  But when I reconnect with 10.1, the \"VALID\" column becomes \"false\".  My understanding is that the \"false\" value means that when the trigger is fired, it will first be RE-compiled before getting executed.  This would in turn mean that the new format id for the 10.3 SqlXmlUtil class will never actually be read when running in 10.1--instead, the trigger statement will be recompiled using 10.1 and thus we don't see any failures.\r\n\r\nI don't know for sure what the mechanism is, but based on this behavior it appears that any attempts to boot a database from a version that is different from the most-recently-booted version causes all stored prepared statements to be marked invalid and thus forces recompilation.  It is this recompilation of the trigger statements which allows the 10.3 trigxml to execute successfully against a 10.1 database after a \"soft downgrade\" back to 10.1.\r\n\r\nThat's my understanding based on the tests I ran; if anyone knows otherwise or would like to add more, please feel free...\r\n\r\nAnd thanks Suresh for taking the time to review the patch.  I wasn't even thinking about upgrade issues when I did my review.  Definitely true that more eyes are better...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2006-09-20T01:19:03.000+0000","updated":"2006-09-20T01:19:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12436093","id":"12436093","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"For this type of minor revision upgrade, all the SPSs stored in SYS.SYSSTATEMENTS will get invalidated at database boot time.  This logic is handled in the DD_Version class.  When the trigger is fired, the SPS will get recompiled.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-09-20T02:54:24.000+0000","updated":"2006-09-20T02:54:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12436121","id":"12436121","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"Committed  to trunk on  revision  448085.. \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2006-09-20T06:12:37.000+0000","updated":"2006-09-20T06:12:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12436966","id":"12436966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"Marking resolved, merged to 10.2 with revision 448085.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-09-22T18:47:07.000+0000","updated":"2006-09-22T18:47:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12348177/comment/12551405","id":"12551405","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"This issue has been resolved for over a year with no further movement. Closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2007-12-13T09:05:11.073+0000","updated":"2007-12-13T09:05:11.073+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1718/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i075gv:"}}