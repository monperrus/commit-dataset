{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12652557","self":"https://issues.apache.org/jira/rest/api/latest/issue/12652557","key":"SOLR-4923","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324324","id":"12324324","description":"Major release after 4.3","name":"4.4","archived":false,"released":true,"releaseDate":"2013-07-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321664","id":"12321664","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-06-13 22:42:22.815","customfield_12312323":null,"customfield_12310420":"332881","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_400858643_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-06-17T20:02:39.885+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-4923/watchers","watchCount":5,"isWatching":false},"created":"2013-06-13T04:41:41.264+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323893","id":"12323893","description":"Major release after 4.1","name":"4.2","archived":false,"released":true,"releaseDate":"2013-03-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-23T18:38:46.511+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312535","id":"12312535","name":"replication (java)","description":"Index replication from master to slaves using pure java"}],"timeoriginalestimate":null,"description":"I was actually trying to debug an issue we experiencing in production where the replica version is ahead from the leader when I noticed this problem.\r\n\r\nFor my tests I'm running two Solr instances with distributed updates (SolrCloud). ZK runs embedded within one of the instances.\r\n\r\nThe test consists on updating one field in single document. If I send an update to the leader the index is replicated correctly. However, if I run the update against the follower replica only the leader is updated correctly. I can reproduce this using both hard and soft commits. Here is the command I'm running:\r\n\r\ncurl \"http://localhost:8999/solr/rulePreview/update?commit=true&softCommit=true\" -H \"Content-Type: text/xml\" --data-binary '<add>...</add>\r\n\r\nIf I execute a second commit against the follower the leader will have the most recent update and the follower will be update from the first commit.\r\n\r\nFor example, my field is named category and initially it contains the value cat_1. If update the value to cat_2 the leader sees the change but the follower doesn't. If a second commit updates the field to cat_3 the leader will return cat_3 but the follower return cat_2. \r\n\r\nReloading the core in the follower fixes the problem.\r\n\r\nThe logs seem to confirm the follower gets the latest index version. However, the version in the logs doesn't matches the on in the Core Admin UI nor Luke. Here are some logs from the leader:\r\n\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.processor.LogUpdateProcessor finish\r\nINFO: [rulePreview_en] webapp=/solr path=/update params={distrib.from=http://192.168.1.106:8998/solr/rulePreview_en/&update.distrib=TOLEADER&wt=javabin&version=2} {add=[importedRedirect1 (1437700518392627200)]} 0 11\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.DirectUpdateHandler2 commit\r\nINFO: start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=true,prepareCommit=false}\r\nJun 12, 2013 10:34:19 PM org.apache.solr.search.SolrIndexSearcher <init>\r\nINFO: Opening Searcher@47e4e06c main\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.DirectUpdateHandler2 commit\r\nINFO: end_commit_flush\r\nJun 12, 2013 10:34:19 PM org.apache.solr.core.QuerySenderListener newSearcher\r\nINFO: QuerySenderListener sending requests to Searcher@47e4e06c main{StandardDirectoryReader(segments_3g:467:nrt _2a(4.2.1):C134/1 _3c(4.2.1):C1)}\r\nJun 12, 2013 10:34:19 PM org.apache.solr.core.QuerySenderListener newSearcher\r\nINFO: QuerySenderListener done.\r\nJun 12, 2013 10:34:19 PM org.apache.solr.core.SolrCore registerSearcher\r\nINFO: [rulePreview_en] Registered new searcher Searcher@47e4e06c main{StandardDirectoryReader(segments_3g:467:nrt _2a(4.2.1):C134/1 _3c(4.2.1):C1)}\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.processor.LogUpdateProcessor finish\r\nINFO: [rulePreview_en] webapp=/solr path=/update params={waitSearcher=true&commit=true&wt=javabin&expungeDeletes=false&commit_end_point=true&version=2&softCommit=true} {commit=} 0 12\r\n\r\nAnd the logs from the follower:\r\n\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.DirectUpdateHandler2 commit\r\nINFO: start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=true,prepareCommit=false}\r\nJun 12, 2013 10:34:19 PM org.apache.solr.search.SolrIndexSearcher <init>\r\nINFO: Opening Searcher@1e23cfc main\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.DirectUpdateHandler2 commit\r\nINFO: end_commit_flush\r\nJun 12, 2013 10:34:19 PM org.apache.solr.core.QuerySenderListener newSearcher\r\nINFO: QuerySenderListener sending requests to Searcher@1e23cfc main{StandardDirectoryReader(segments_3i:463:nrt _2a(4.2.1):C134/1 _3b(4.2.1):C1)}\r\nJun 12, 2013 10:34:19 PM org.apache.solr.core.QuerySenderListener newSearcher\r\nINFO: QuerySenderListener done.\r\nJun 12, 2013 10:34:19 PM org.apache.solr.core.SolrCore registerSearcher\r\nINFO: [rulePreview_en] Registered new searcher Searcher@1e23cfc main{StandardDirectoryReader(segments_3i:463:nrt _2a(4.2.1):C134/1 _3b(4.2.1):C1)}\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.processor.LogUpdateProcessor finish\r\nINFO: [rulePreview_en] webapp=/solr path=/update params={distrib.from=http://192.168.1.106:8999/solr/rulePreview_en/&update.distrib=FROMLEADER&wt=javabin&version=2} {add=[importedRedirect1 (1437700518392627200)]} 0 4\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.SolrCmdDistributor distribCommit\r\nINFO: Distrib commit to:[StdNode: http://192.168.1.106:8999/solr/rulePreview_en/] params:commit_end_point=true&commit=true&softCommit=true&waitSearcher=true&expungeDeletes=false\r\nJun 12, 2013 10:34:19 PM org.apache.solr.update.processor.LogUpdateProcessor finish\r\nINFO: [rulePreview_en] webapp=/solr path=/update params={softCommit=true} {add=[importedRedirect1],commit=} 0 41\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"333209","summary":"Replica index is one version behind sending the commit to non-leader instance","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmerizalde","name":"rmerizalde","emailAddress":"ricardo dot merizalde at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ricardo Merizalde","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rmerizalde","name":"rmerizalde","emailAddress":"ricardo dot merizalde at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ricardo Merizalde","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Solr 4.2.1\r\nOS X 10.8.3","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":14,"total":14,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13682853","id":"13682853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Hmmm...\r\n\r\nI can't explain it -- but i can reproduce this fairly trivially on trunk using the example configs...\r\n\r\n* Spin up two ports using numShards=1...\r\n\r\n{noformat}\r\n$ java -Dbootstrap_confdir=./solr/collection1/conf -Dcollection.configName=myconf -DzkRun -DnumShards=1 -jar start.jar \r\n$ java -Djetty.port=7574 -DzkHost=localhost:9983 -jar start.jar\r\n{noformat}\r\n\r\n* use UI to confirm that 8983 is the leader and 7574 is it's replica\r\n* send a doc to the 7574 replica and observe the results of querying against the two distinct replicas...\r\n\r\n{noformat}\r\n$ curl \"http://localhost:8983/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:7574/solr/collection1/update?commit=true&wt=json&omitHeader=true\" -H 'Content-Type: text/xml' --data-binary '<add><doc><field name=\"id\">HOSS</field><field name=\"cat_s\">1</field></doc></add>'\r\n{}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:8983/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":1,\"start\":0,\"docs\":[{\"id\":\"HOSS\",\"cat_s\":\"1\",\"_version_\":1437767149083951104}]}}\r\n{noformat}\r\n\r\n* wait a bit and retry in case there is some delay in replication...\r\n\r\n{noformat}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":0,\"start\":0,\"docs\":[]}}\r\n{noformat}\r\n\r\n* send a new version of the doc to the 7574 replica and observe the results of querying against the two distinct replicas...\r\n\r\n{noformat}\r\n$ curl \"http://localhost:7574/solr/collection1/update?commit=true&wt=json&omitHeader=true\" -H 'Content-Type: text/xml' --data-binary '<add><doc><field name=\"id\">HOSS</field><field name=\"cat_s\">2</field></doc></add>'\r\n{}\r\n$ curl \"http://localhost:7574/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":1,\"start\":0,\"docs\":[{\"id\":\"HOSS\",\"cat_s\":\"1\",\"_version_\":1437767149083951104}]}}\r\n$ curl \"http://localhost:8983/solr/collection1/select?q=id:HOSS&wt=json&omitHeader=true\"\r\n{\"response\":{\"numFound\":1,\"start\":0,\"docs\":[{\"id\":\"HOSS\",\"cat_s\":\"2\",\"_version_\":1437767405646381056}]}}\r\n{noformat}\r\n\r\nI'll see if i can work up a JUnit test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2013-06-13T22:42:22.815+0000","updated":"2013-06-13T22:42:22.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13682873","id":"13682873","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"Sample logs from the replica during my manual testing...\r\n\r\n{noformat:title=replica @ moment of update}\r\n580025 [qtp541763983-15] INFO  org.apache.solr.update.UpdateHandler  – start commit{,optimize=false,openSearcher=true,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\r\n580142 [qtp541763983-15] INFO  org.apache.solr.core.SolrCore  – SolrDeletionPolicy.onCommit: commits: num=2\r\n\tcommit{dir=NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/home/hossman/lucene/dev/solr/example2/solr/collection1/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@2d508aed; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_b,generation=11}\r\n\tcommit{dir=NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/home/hossman/lucene/dev/solr/example2/solr/collection1/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@2d508aed; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_c,generation=12}\r\n580143 [qtp541763983-15] INFO  org.apache.solr.core.SolrCore  – newest commit generation = 12\r\n580144 [qtp541763983-15] INFO  org.apache.solr.search.SolrIndexSearcher  – Opening Searcher@60d2cd99 main\r\n580145 [qtp541763983-15] INFO  org.apache.solr.update.UpdateHandler  – end_commit_flush\r\n580145 [searcherExecutor-5-thread-1] INFO  org.apache.solr.core.SolrCore  – QuerySenderListener sending requests to Searcher@60d2cd99 main{StandardDirectoryReader(segments_b:15:nrt _3(5.0):c1)}\r\n580146 [searcherExecutor-5-thread-1] INFO  org.apache.solr.core.SolrCore  – QuerySenderListener done.\r\n580151 [searcherExecutor-5-thread-1] INFO  org.apache.solr.core.SolrCore  – [collection1] Registered new searcher Searcher@60d2cd99 main{StandardDirectoryReader(segments_b:15:nrt _3(5.0):c1)}\r\n580170 [qtp541763983-18] INFO  org.apache.solr.update.processor.LogUpdateProcessor  – [collection1] webapp=/solr path=/update params={distrib.from=http://127.0.1.1:8983/solr/collection1/&update.distrib=FROMLEADER&wt=javabin&version=2} {add=[HOSS (1437769792183336960)]} 0 4\r\n580173 [qtp541763983-15] INFO  org.apache.solr.update.SolrCmdDistributor  – Distrib commit to:[StdNode: http://127.0.1.1:8983/solr/collection1/] params:commit_end_point=true&commit=true&softCommit=false&waitSearcher=true&expungeDeletes=false\r\n580426 [qtp541763983-15] INFO  org.apache.solr.update.processor.LogUpdateProcessor  – [collection1] webapp=/solr path=/update params={omitHeader=true&commit=true&wt=json} {add=[HOSS],commit=} 0 402\r\n{noformat}\r\n\r\n{noformat:title=replica a few seconds later}\r\n595170 [commitScheduler-7-thread-1] INFO  org.apache.solr.update.UpdateHandler  – start commit{,optimize=false,openSearcher=false,waitSearcher=true,expungeDeletes=false,softCommit=false,prepareCommit=false}\r\n595355 [commitScheduler-7-thread-1] INFO  org.apache.solr.core.SolrCore  – SolrDeletionPolicy.onCommit: commits: num=2\r\n\tcommit{dir=NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/home/hossman/lucene/dev/solr/example2/solr/collection1/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@2d508aed; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_c,generation=12}\r\n\tcommit{dir=NRTCachingDirectory(org.apache.lucene.store.MMapDirectory@/home/hossman/lucene/dev/solr/example2/solr/collection1/data/index lockFactory=org.apache.lucene.store.NativeFSLockFactory@2d508aed; maxCacheMB=48.0 maxMergeSizeMB=4.0),segFN=segments_d,generation=13}\r\n595355 [commitScheduler-7-thread-1] INFO  org.apache.solr.core.SolrCore  – newest commit generation = 13\r\n595359 [commitScheduler-7-thread-1] INFO  org.apache.solr.search.SolrIndexSearcher  – Opening Searcher@140ffc1 realtime\r\n595360 [commitScheduler-7-thread-1] INFO  org.apache.solr.update.UpdateHandler  – end_commit_flush\r\n{noformat}\r\n\r\nYou can see that the \"explicit\" commit (with \"openSearcher=true\") seems to be happening first, then the replica recieves the distrib update back from the leader, then a \"Distrib commit to: <leader>\" (that i'm not familiar with) is logged by the replica.  A few seconds later, the autoCommit on the replica kicks in, but this uses openSearcher=false since that's what's in solrconfig.xml","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2013-06-13T23:04:32.615+0000","updated":"2013-06-13T23:04:32.615+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13682880","id":"13682880","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"bq. You can see that the \"explicit\" commit (with \"openSearcher=true\") seems to be happening first, then the replica recieves the distrib update back from the leader\r\n\r\nThat sounds like the issue here - the local commit on the replica really needs to come after that update comes back?\r\n\r\nbq.  then a \"Distrib commit to: <leader>\" (that i'm not familiar with) is logged by the replica.\r\n\r\nAfter the local commit, we ask everyone else in the colleciton to commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-06-13T23:12:11.359+0000","updated":"2013-06-13T23:12:11.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13682889","id":"13682889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"I think your test will be key hossman.\r\n\r\nThe following patch is also a good idea, though it does not catch this. It randomly turns off sending only to leaders on CloudSolrServers in tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-06-13T23:17:30.479+0000","updated":"2013-06-13T23:17:30.479+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13683034","id":"13683034","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"[~hossman_lucene@fucit.org] if you can write a test, I *think* the attached patch will likely make it pass.\r\n\r\nIt's also an improvement in general as we were doing a local commit and then committing on everyone else in the collection - it really took the length of two commits at least essentially. This does them all in parallel, and should address the issue by having the replica push it's commit through the solr cmd distributor so that it should play nicer with buffering - rather than just nailing it locally right away.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-06-14T02:50:27.623+0000","updated":"2013-06-14T02:50:27.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13683885","id":"13683885","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"[~markrmiller@gmail.com] here's a patch that modifies BasicDistributedZkTest to reliably produce a failure which i _think_ is the same as the one being dicussed here.\r\n\r\nwith your patch applied, my patch stops failing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2013-06-14T22:53:59.834+0000","updated":"2013-06-14T22:53:59.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13685614","id":"13685614","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[trunk commit] markrmiller\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1493779\r\n\r\nSOLR-4923: Commits to non leaders as part of a request that also contain updates can execute out of order.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-06-17T14:31:22.569+0000","updated":"2013-06-17T14:31:22.569+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13685621","id":"13685621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[trunk commit] markrmiller\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1493782\r\n\r\nSOLR-4923: add optimization CHANGES entry","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-06-17T14:37:49.660+0000","updated":"2013-06-17T14:37:49.660+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13685674","id":"13685674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[trunk commit] markrmiller\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1493829\r\n\r\nSOLR-4923: add missing credit","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-06-17T16:13:38.331+0000","updated":"2013-06-17T16:13:38.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13685717","id":"13685717","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[branch_4x commit] markrmiller\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1493846\r\n\r\nSOLR-4923: Commits to non leaders as part of a request that also contain updates can execute out of order.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-06-17T17:05:03.577+0000","updated":"2013-06-17T17:05:03.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13685771","id":"13685771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[trunk commit] markrmiller\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1493861\r\n\r\nSOLR-4923: do not test if not sending to leaders first","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-06-17T17:58:07.711+0000","updated":"2013-06-17T17:58:07.711+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13685846","id":"13685846","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"body":"[branch_4x commit] markrmiller\r\nhttp://svn.apache.org/viewvc?view=revision&revision=1493885\r\n\r\nSOLR-4923: Commits to non leaders as part of a request that also contain updates can execute out of order.\r\nSOLR-4923: add optimization CHANGES entry\r\nSOLR-4923: add missing credit","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=commit-tag-bot","name":"commit-tag-bot","emailAddress":"root-jira-commit_tag_bot at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=commit-tag-bot&avatarId=16176","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=commit-tag-bot&avatarId=16176","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=commit-tag-bot&avatarId=16176","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=commit-tag-bot&avatarId=16176"},"displayName":"Commit Tag Bot","active":true},"created":"2013-06-17T18:53:32.702+0000","updated":"2013-06-17T18:53:32.702+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13685911","id":"13685911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"body":"Thanks guys!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=markrmiller%40gmail.com","name":"markrmiller@gmail.com","emailAddress":"markrmiller at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=markrmiller%40gmail.com&avatarId=17267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=markrmiller%40gmail.com&avatarId=17267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=markrmiller%40gmail.com&avatarId=17267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=markrmiller%40gmail.com&avatarId=17267"},"displayName":"Mark Miller","active":true},"created":"2013-06-17T20:02:39.903+0000","updated":"2013-06-17T20:02:39.903+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12652557/comment/13716852","id":"13716852","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"body":"Bulk close resolved 4.4 issues","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=steve_rowe","name":"steve_rowe","emailAddress":"sarowe at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Steve Rowe","active":true},"created":"2013-07-23T18:38:46.509+0000","updated":"2013-07-23T18:38:46.509+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-4923/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1lfav:"}}