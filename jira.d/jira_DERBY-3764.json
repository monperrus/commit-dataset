{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12399735","self":"https://issues.apache.org/jira/rest/api/latest/issue/12399735","key":"DERBY-3764","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313143","id":"12313143","description":"Head of 10.3 branch","name":"10.3.3.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-07-07 17:16:02.238","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23829","customfield_12310222":"3_*:*_1_*:*_1028374802_*|*_1_*:*_1_*:*_330089892_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-07-23T09:05:07.617+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3764/watchers","watchCount":0,"isWatching":false},"created":"2008-07-07T15:44:02.923+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"8.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12320871","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12320871","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12325311","key":"DERBY-681","self":"https://issues.apache.org/jira/rest/api/2/issue/12325311","fields":{"summary":"Eliminate the parser's rewriting of the abstract syntax tree for queries with GROUP BY and/or HAVING clauses","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:52:04.159+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"    Running a Query on Derby 10.4.1.3 and 10.3.1.4 I got this error message: Error code 0, SQL state XJ001: Java Exception: '4 >= 4: java.lang.ArrayIndexOutOfBoundsException'.\r\n    After throw this exception the database shutdown and lost the connection.\r\n    I'm updating an application from a previous version of Derby (Bundle-Version: 10.0.2000001 From derby.jar Manifest) so this query works fine in version 10.0.\r\n\r\nThe Query:\r\nselect 0 vlr_proc_anterior\r\n             , 0 vlr_proc_atual\r\n             , sum(vlr_contabil + vlr_ajuste) disp_financeira    \r\n             from contas_remessa rec\r\n             where cd_tipo = 1105 and cd_conta = 4\r\n             group by rec.cd_conta, rec.ds_conta\r\n             union\r\n             select case when cd_tipo = 170 then sum(vlr_contabil) + sum(vlr_ajuste) else 0 end vlr_proc_anterior\r\n                  , case when cd_tipo = 175 then sum(vlr_contabil) + sum(vlr_ajuste) else 0 end vlr_proc_atual\r\n                  , 0 disp_financeira\r\n                  from contas_remessa where cd_tipo in (170, 175) and status = 'S'                       \r\n                  group by cd_tipo\r\n\r\nThe deby log entry:\r\n\r\n----------------------------------------------------------------\r\n2008-07-07 14:44:51.282 GMT:\r\n Booting Derby version The Apache Software Foundation - Apache Derby - 10.3.1.4 - (561794): instance c013800d-011a-fdfb-6fa4-00003451d386\r\non database directory C:\\PAD\\database  \r\n\r\nDatabase Class Loader started - derby.database.classpath=''\r\n2008-07-07 14:46:40.506 GMT Thread[SQLExecution,1,system] (XID = 3441038), (SESSIONID = 0), (DATABASE = C:\\PAD\\database), (DRDAID = null), Cleanup action starting\r\n2008-07-07 14:46:40.506 GMT Thread[SQLExecution,1,system] (XID = 3441038), (SESSIONID = 0), (DATABASE = C:\\PAD\\database), (DRDAID = null), Failed Statement is: select 0 vlr_proc_anterior\r\n             , 0 vlr_proc_atual\r\n             , sum(vlr_contabil + vlr_ajuste) disp_financeira    \r\n             from contas_remessa rec\r\n             where cd_tipo = 1105 and cd_conta = 4\r\n             group by rec.cd_conta, rec.ds_conta\r\n             union\r\n             select case when cd_tipo = 170 then sum(vlr_contabil) + sum(vlr_ajuste) else 0 end vlr_proc_anterior\r\n                  , case when cd_tipo = 175 then sum(vlr_contabil) + sum(vlr_ajuste) else 0 end vlr_proc_atual\r\n                  , 0 disp_financeira\r\n                  from contas_remessa where cd_tipo in (170, 175) and status = 'S'                       \r\n                  group by cd_tipo\r\njava.lang.ArrayIndexOutOfBoundsException: 4 >= 4\r\n\tat java.util.Vector.elementAt(Vector.java:427)\r\n\tat org.apache.derby.impl.sql.compile.QueryTreeNodeVector.elementAt(Unknown Source)\r\n\tat org.apache.derby.impl.sql.compile.ResultColumnList.setUnionResultExpression(Unknown Source)\r\n\tat org.apache.derby.impl.sql.compile.SetOperatorNode.buildRCL(Unknown Source)\r\n\tat org.apache.derby.impl.sql.compile.SetOperatorNode.bindResultColumns(Unknown Source)\r\n\tat org.apache.derby.impl.sql.compile.CursorNode.bindStatement(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\r\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\r\n\tat org.netbeans.modules.db.sql.execute.SQLExecuteHelper.execute(SQLExecuteHelper.java:114)\r\n\tat org.netbeans.modules.db.sql.loader.SQLEditorSupport$SQLExecutor.run(SQLEditorSupport.java:479)\r\n\tat org.openide.util.RequestProcessor$Task.run(RequestProcessor.java:561)\r\n\tat org.openide.util.RequestProcessor$Processor.run(RequestProcessor.java:986)\r\nCleanup action completed","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37274","summary":"Union Query fail on Derby 10.4.1.3","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Windows XP SP2, NetBeans 6.1 (IDE), Pentium 2 Core 512 Ram, Java 1.6.0_05","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":33,"total":33,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611218","id":"12611218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"body":"To create the Test Table","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"created":"2008-07-07T16:36:04.278+0000","updated":"2008-07-07T16:36:04.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611226","id":"12611226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"body":"Derby 10.0 - Works Fine","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"created":"2008-07-07T16:44:55.006+0000","updated":"2008-07-07T16:44:55.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611227","id":"12611227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"body":"Derby 10.0 - Fail","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"created":"2008-07-07T16:45:34.040+0000","updated":"2008-07-07T16:45:34.040+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611231","id":"12611231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"body":"Derby 10.3.1.4 (NetBeans 6.1) - Fail","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"created":"2008-07-07T16:46:57.404+0000","updated":"2008-07-07T16:46:57.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611232","id":"12611232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"body":"Derby 10.4 - Fail","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"created":"2008-07-07T16:47:39.911+0000","updated":"2008-07-07T16:47:39.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611234","id":"12611234","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"body":"Some Data to CONTAS_REMESSA Table","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heleno.alves","name":"heleno.alves","emailAddress":"helenoa at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Heleno da Silva Alves","active":true},"created":"2008-07-07T16:48:53.428+0000","updated":"2008-07-07T16:48:53.428+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611247","id":"12611247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I verified on trunk using the script to create the table and import data.\r\nHere is the debug stack trace. The latest on the 10.2 looks ok. The problem seems to start with 10.3.  Marking as a regression.\r\n\r\nij> select 0 vlr_proc_anterior\r\n             , 0 vlr_proc_atual\r\n             , sum(vlr_contabil + vlr_ajuste) disp_financeira\r\n             from contas_remessa rec\r\n             where cd_tipo = 1105 and cd_conta = 4\r\n             group by rec.cd_conta, rec.ds_conta\r\n             union\r\n             select case when cd_tipo = 170 then sum(vlr_contabil) + sum(vlr_ajuste) else 0 end vlr_proc_anterior\r\n                  , case when cd_tipo = 175 then sum(vlr_contabil) + sum(vlr_ajuste) else 0 end vlr_proc_atual\r\n                  , 0 disp_financeira\r\n                  from contas_remessa where cd_tipo in (170, 175) and status = 'S'\r\n                  group by cd_tipo ;\r\nERROR XJ001: Java exception: 'Array index out of range: 4: java.lang.ArrayIndexOutOfBoundsException'.\r\njava.sql.SQLException: Java exception: 'Array index out of range: 4: java.lang.ArrayIndexOutOfBoundsException'.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:87)\r\n        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:244)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2183)\r\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:614)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:555)\r\n        at org.apache.derby.impl.tools.ij.ij.executeImmediate(ij.java:329)\r\n        at org.apache.derby.impl.tools.ij.utilMain.doCatch(utilMain.java:508)\r\n        at org.apache.derby.impl.tools.ij.utilMain.runScriptGuts(utilMain.java:350)\r\n        at org.apache.derby.impl.tools.ij.utilMain.go(utilMain.java:248)\r\n        at org.apache.derby.impl.tools.ij.Main.go(Main.java:215)\r\n        at org.apache.derby.impl.tools.ij.Main.mainCore(Main.java:181)\r\n        at org.apache.derby.impl.tools.ij.Main.main(Main.java:73)\r\n        at org.apache.derby.tools.ij.main(ij.java:59)\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 4\r\n        at java.util.Vector.elementAt(Vector.java:266)\r\n        at org.apache.derby.impl.sql.compile.QueryTreeNodeVector.elementAt(QueryTreeNodeVector.java:51)\r\n        at org.apache.derby.impl.sql.compile.ResultColumnList.setUnionResultExpression(ResultColumnList.java:2242)\r\n        at org.apache.derby.impl.sql.compile.SetOperatorNode.buildRCL(SetOperatorNode.java:631)\r\n        at org.apache.derby.impl.sql.compile.SetOperatorNode.bindResultColumns(SetOperatorNode.java:558)\r\n        at org.apache.derby.impl.sql.compile.CursorNode.bindStatement(CursorNode.java:239)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepMinion(GenericStatement.java:314)\r\n        at org.apache.derby.impl.sql.GenericStatement.prepare(GenericStatement.java:88)\r\n        at org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(GenericLanguageConne\r\nctionContext.java:794)\r\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:606)\r\n        ... 9 more\r\nij>","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-07-07T17:16:02.238+0000","updated":"2008-07-07T17:16:02.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611571","id":"12611571","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It looks like the bug was introduced in the following revision:\r\n\r\n------------------------------------------------------------------------\r\nr516454 | abrown | 2007-03-09 17:37:20 +0100 (fr, 09 mar 2007) | 8 lines\r\n\r\nDERBY-681: Remove the \"wrap group by's in a subselect\" rewrite in the parser.\r\nThis patch preserves the having clause through bind and optimize phases and\r\nthen, during the final rewrite for aggregates in the GroupByNode, it transforms\r\nthe having clause to a valid restriction. See text file attached to the Jira\r\nfor more information.\r\n\r\nContributed by Manish Khettry (manish_khettry@yahoo.com)\r\n\r\n------------------------------------------------------------------------","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-08T13:14:11.814+0000","updated":"2008-07-08T13:14:11.814+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611741","id":"12611741","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Here's a simpler way to reproduce the bug:\r\n\r\nij> create table t(x int);\r\n0 rows inserted/updated/deleted\r\nij> select sum(x) from t group by x union select sum(x) from t group by x;\r\nERROR XJ001: Java exception: '1 >= 1: java.lang.ArrayIndexOutOfBoundsException'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-08T18:37:18.548+0000","updated":"2008-07-08T18:37:18.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611753","id":"12611753","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The simpler repro doesn't have the exact same stack trace as the reported error. The reported error happens during the bind phase, whereas the simpler repro fails during byte code generation. The simpler repro can also be made into failing during bind by rewriting it to:\r\n\r\nij> create table t(x int);\r\n0 rows inserted/updated/deleted\r\nij> select sum(x) from t group by x union values 1;\r\nERROR XJ001: Java exception: '1 >= 1: java.lang.ArrayIndexOutOfBoundsException'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-08T19:11:18.393+0000","updated":"2008-07-08T19:11:18.393+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611756","id":"12611756","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"It might be as simple as needing an \"isGenerated\" check when manipulating\r\nthe ResultColumn data somewhere in ResultColumnList.setUnionResultExpression()\r\nor perhaps SetOperatorNode.buildRCL()\r\n\r\nIn \"select sum(x) from t group by x\", there should be, conceptually, two\r\nresult columns in the result column list:\r\n - sum(x)\r\n - x\r\n\r\nsum(x) is a normal resultcolumn, while x should have the isGenerated\r\nflag set, indicating that it is sort of a \"shadow\" column which was added\r\nto the result column list in order to enable the sorting and grouping of\r\nthe data, but is not part of the user-visible result column list.\r\n\r\nHope this is useful, it's just sort of an educated guess but I thought it\r\nmight be worth posting if it gave you a place to start poking around.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-07-08T19:15:32.524+0000","updated":"2008-07-08T19:15:32.524+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611786","id":"12611786","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for the suggestion, Bryan. Sounds like that's worth looking into. Here's what I found by taking a brief look at the code mentioned in the stack trace:\r\n\r\nResultColumnList.setUnionResultExpression() asserts that visibleSize() == otherRCL.visibleSize(), which means that the two sub-queries in the union have the same number of columns. But when it iterates over the columns, it uses size() which includes the group by columns. Since the two sub-queries have a different number of columns in the group by clause, an index-out-of-bounds exception is thrown when the method iterates over the group by columns.\r\n\r\nI think setUnionResultExpression() should use visibleSize() instead of size(). I'm assuming here that the non-visible columns are at the end of the RCL (I vaguely recall having read something about that in a comment sometime, but I don't know this code very well). By making this change, I could get the statement to compile, but it failed during execution instead:\r\n\r\norg.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED template.length (2) expected to be = to nCols (1)\r\n\tat org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:162)\r\n\tat org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147)\r\n\tat org.apache.derby.impl.store.access.sort.MergeSort.checkColumnTypes(MergeSort.java:441)\r\n\tat org.apache.derby.impl.store.access.sort.MergeInserter.insert(MergeInserter.java:98)\r\n\tat org.apache.derby.impl.sql.execute.SortResultSet.loadSorter(SortResultSet.java:317)\r\n\tat org.apache.derby.impl.sql.execute.SortResultSet.openCore(SortResultSet.java:268)\r\n\tat org.apache.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(BasicNoPutResultSetImpl.java:245)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:384)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-08T20:22:31.017+0000","updated":"2008-07-08T20:22:31.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12611797","id":"12611797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I agree with you that setUnionResultExpression should be using visibleSize().\r\n\r\nWe may have a number of places to fix, unfortunately.\r\n\r\nThe mergeSort assertion failure feels like a code generation problem, so the\r\nnext step might be to step through GroupByNode.generate() and see if you\r\ncan watch it generating the code, and look for places where it processes the\r\nResultColumnList, and see if there's a place in there where it should be\r\nusing visibleSize (which is 1) instead of size (which is 2).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-07-08T21:03:30.721+0000","updated":"2008-07-08T21:03:30.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612835","id":"12612835","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I haven't had time to check out Bryan's suggestions yet, but I am planning to dig more into to it, so I'm assigning the issue to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-11T11:25:24.196+0000","updated":"2008-07-11T11:25:24.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612839","id":"12612839","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It seems like changing RCL.setUnionResultExpression() to use\r\nvisibleSize() instead of size() is enough to fix the query in the\r\noriginal report.\r\n\r\nThe simpler query (SELECT MAX(x) FROM t GROUP BY x UNION VALUES 1)\r\ndoes however run into another ArrayIndexOutOfBoundsException in\r\nRCL.isExactTypeAndLengthMatch(), which is the same problem as I\r\nmentioned earlier that\r\n   SELECT MAX(x) FROM t GROUP BY x\r\n     UNION\r\n   SELECT MAX(x) FROM t GROUP BY x\r\nwould run into during byte code generation.\r\n\r\nI think the solution for isExactTypeAndLengthMatch() is the same as\r\nfor setUnionResultExpression() -- we should change size() to\r\nvisibleSize().\r\n\r\nAlthough we still see problems during execution with these fixes, we\r\nmay consider checking them in as partial improvements, especially\r\nsince they appear to be enough for the originally reported query.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-11T11:36:31.220+0000","updated":"2008-07-11T11:36:31.220+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612854","id":"12612854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The attached patch fixes setUnionResultExpression() and isExactTypeAndLengthMatch() and adds a test case to GroupByTest which fails with ArrayIndexOutOfBoundsException without the fixes and passes with them. All the regression tests ran cleanly with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-11T12:18:27.223+0000","updated":"2008-07-11T12:18:27.223+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612856","id":"12612856","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Other set operations than UNION have similar problems:\r\n\r\nij> create table t (x int);\r\n0 rows inserted/updated/deleted\r\nij> select sum(x) from t group by x except values 1;\r\nERROR 42X77: Column position '2' is out of range for the query expression.\r\nij> select sum(x) from t group by x intersect values 1;\r\nERROR 42X77: Column position '2' is out of range for the query expression.\r\n\r\nThe above queries worked with Derby 10.2.2.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-11T12:21:50.685+0000","updated":"2008-07-11T12:21:50.685+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612889","id":"12612889","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks for the patch; I agree that addressing these problems as\r\na first step is a good plan.\r\n\r\nThe patch looks quite reasonable to me. Here's a couple thoughts:\r\n\r\n1) In your comment above you said that these changes resolved\r\nthe original form of the query, but not the alternate form. Yet in your\r\npatch both forms of the query are compiled, but the execution is\r\ncommented out. With the patch, is it possible actually execute\r\nthe original form of the query? If so, it seems like the patch should do so.\r\n\r\n2) As you note, there are some other variants that are worth testing,\r\nsuch as different set operations, and perhaps cases where the two\r\nchildren of the union do *not* have the same number of visible columns\r\nor where the data types of the visible columns are not quite matching.\r\nSo if you get a chance to add more test cases, either now or later, that\r\nwould be great.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-07-11T14:34:07.558+0000","updated":"2008-07-11T14:34:07.558+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612892","id":"12612892","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks Bryan, those are all good suggestions. I am planning both to investigate why we don't see the execution problem with the original query, and to add more tests. I'm not sure we can add the original query directly since the attached repro wasn't licensed to the ASF, but once we find out what makes the difference between the queries, it should be easy to add something equivalent to it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-11T14:41:34.916+0000","updated":"2008-07-11T14:41:34.916+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612897","id":"12612897","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I guess I didn't fully answer your first question. The two queries in the test both fail if they are executed. The statement that doesn't fail when it's executed, is the one that is mentioned in the description of the issue and that uses the attached scripts CONSTAS_REMESSA.sql and export_contas_remessas.exp.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-11T14:48:00.135+0000","updated":"2008-07-11T14:48:00.135+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612900","id":"12612900","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Yet another type of failure (only seen with the patch applied, otherwise the out-of-bounds exception is thrown first):\r\n\r\nij> select max(x) from t group by x union all values 1;\r\n1          |X          \r\n-----------------------\r\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\r\n\r\nNote the extra column in addition to the NPE. Wasn't there recently a discussion on derby-user about queries that returned extra columns?\r\n\r\nThe query worked in 10.2.2.0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-11T15:01:47.705+0000","updated":"2008-07-11T15:01:47.705+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12612909","id":"12612909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Yes, there was such a discussion, and it's nice to see that you\r\nappear to have found a reproducible test case. I believe that\r\nthe 2nd column should not have appeared in the output, and\r\nindicates yet more places where the ResultColumnList is misbehaving.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-07-11T15:48:30.250+0000","updated":"2008-07-11T15:48:30.250+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12613545","id":"12613545","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed the 1a patch with revision 676819.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-15T07:35:42.396+0000","updated":"2008-07-15T07:35:42.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12613901","id":"12613901","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It seems like the group by columns of the first sub-expression are always added to the result. When I said the original query worked with the fix that was committed, it wasn't entirely correct, since the result had two extra columns (cd_conta and ds_conta).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-16T10:20:55.134+0000","updated":"2008-07-16T10:20:55.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12613905","id":"12613905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The reason why the original query doesn't fail during execution, is that both sub-queries in the union are empty, so that no data is sorted. If I insert more data into the table, that query also failed:\r\n\r\nij> insert into contas_remessa (cd_remessa,cd_tipo,cd_entidade,cd_mes,cd_conta,automatica,vlr_contabil,status) values (0,170,0,0,0,'',0,'S');\r\n1 row inserted/updated/deleted\r\nij> select 0 vlr_proc_anterior\r\n             , 0 vlr_proc_atual\r\n             , sum(vlr_contabil + vlr_ajuste) disp_financeira\r\n             from contas_remessa rec\r\n             where cd_tipo = 1105 and cd_conta = 4\r\n             group by rec.cd_conta, rec.ds_conta\r\n             union\r\n             select case when cd_tipo = 170 then sum(vlr_contabil) + sum(vlr_ajuste) else 0 end vlr_proc_anterior\r\n                  , case when cd_tipo = 175 then sum(vlr_contabil) + sum(vlr_ajuste) else 0 end vlr_proc_atual\r\n                  , 0 disp_financeira\r\n                  from contas_remessa where cd_tipo in (170, 175) and status = 'S'\r\n                  group by cd_tipo ;\r\n> > > > > > > > > > > ERROR XJ001: Java exception: 'ASSERT FAILED col[3]  is null: org.apache.derby.shared.common.sanity.AssertFailure'.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-16T10:47:07.407+0000","updated":"2008-07-16T10:47:07.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12613924","id":"12613924","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I think the key here is to find out why the group by columns from the first expression in the union are added to the result. It seems to be the case for all the set operations. If you have the following queries\r\n\r\n  A: SELECT SUM(x) FROM t GROUP BY x\r\n  B: VALUES 1\r\n\r\nall of these combinations fail\r\n\r\n  A UNION B\r\n  A UNION ALL B\r\n  A EXCEPT B\r\n  A EXCEPT ALL B\r\n  A INTERSECT B\r\n  A INTERSECT ALL B\r\n\r\nHowever, if the order is reversed (e.g, B UNION A), all of the queries succeed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-16T11:51:42.823+0000","updated":"2008-07-16T11:51:42.823+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12613952","id":"12613952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Not sure if it is the correct fix, but adding a call to resultColumns.removeGeneratedGroupingColumns() after cloning the result column list from the left result set in SetOperatorNode.buildRCL() seems to fix the problem. I think it makes sense to remove the non-visible columns from the cloned RCL at that point, since they are only meaningful for the left result set, not for the union result set. But I'm not sure exactly what's meant by a generated grouping column, so it's not quite clear to me if that's the correct method to call.\r\n\r\nIf it is the correct approach to trim away the non-visible columns from the clone at that point in the code, I think the already committed partial fix is unnecessary, but it shouldn't do any harm.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-16T13:40:01.991+0000","updated":"2008-07-16T13:40:01.991+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12613960","id":"12613960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"A \"generated grouping column\" is precisely the column \"X\" in your\r\n\r\n   select sum(x) from t group by x;\r\n\r\nThat is, it is a column which is used in a GROUP BY expression but\r\nwhich is NOT an explicit result of the query, so it must be invisibly\r\nincluded in the intermediate results in order to support sorting and grouping,\r\nbut it not supposed to be included in the final results.\r\n\r\nremoveGeneratedGroupingColumns sounds like exactly the right\r\nthing to do, and calling it in the Set node sounds correct because of\r\nthis reasoning:\r\n - the grouping is performed in the set's child nodes\r\n - once the generated child nodes have been constructed, the grouping\r\n   columns are no longer needed\r\n - the generated child nodes should not appear in the set's result\r\n\r\nI think that the already-committed partial fix may have perhaps been useful\r\nfor queries such as:\r\n\r\n   select sum(x) from t group by x\r\n       union\r\n   select sum(x), x from t group by x\r\n\r\nbecause if we used RCL.size() rather than RCL.visibleSize() to compare\r\nthe two child nodes, wouldn't we think this query valid, when in fact\r\nit should complain that the two result sets do not have the same \"shape\"?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-07-16T14:00:09.333+0000","updated":"2008-07-16T14:00:09.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12613981","id":"12613981","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks Bryan, it sounds like this is the way to go, then.\r\n\r\nThe query you mentioned perhaps could be helped by the partial fix will probably be handled correctly without that fix as well, because of this code at the beginning of SetOperatorNode.buildRCL():\r\n\r\n\t\t/* Verify that both sides of the union have the same # of columns in their\r\n\t\t * RCL.\r\n\t\t */\r\n\t\tif (leftResultSet.getResultColumns().visibleSize() !=\r\n\t\t\trightResultSet.getResultColumns().visibleSize())\r\n\t\t{\r\n\t\t\tthrow StandardException.newException(SQLState.LANG_UNION_UNMATCHED_COLUMNS,\r\n                                                 getOperatorName());\r\n\t\t}\r\n\r\nI guess we could keep the fix, but perhaps we should add asserts at those places in the code to verify that size()==visibleSize().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-16T15:15:12.663+0000","updated":"2008-07-16T15:15:12.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12615262","id":"12615262","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching a new patch which removes the extra columns in SetOperatorNode.buildRCL and adds asserts to check that size()==visibleSize() where the previous fix was added. It also adds test cases that test all the different set operations and different number of columns and grouping columns.\r\n\r\nAll the regression tests in suites.All and derbyall passed with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-21T14:38:08.244+0000","updated":"2008-07-21T14:38:08.244+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12615285","id":"12615285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Knut, the patch looks great. The new tests are very thorough and complete.\r\nThanks for taking the time to cover all these different cases. +1 to commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-07-21T16:01:02.171+0000","updated":"2008-07-21T16:01:02.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12615547","id":"12615547","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for reviewing the patch and for all your help with this issue, Bryan.\r\nCommitted revision 678668.\r\nI'm leaving the issue open until the fix has been back-ported to 10.3 and 10.4.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-22T08:05:33.228+0000","updated":"2008-07-22T08:05:33.228+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12399735/comment/12615922","id":"12615922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed to 10.4 with revision 679035.\r\nCommitted to 10.3 with revision 679037.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-07-23T09:05:07.504+0000","updated":"2008-07-23T09:05:07.504+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3764/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06qsf:"}}