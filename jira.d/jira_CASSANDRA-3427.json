{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12529483","self":"https://issues.apache.org/jira/rest/api/latest/issue/12529483","key":"CASSANDRA-3427","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12318740","id":"12318740","name":"1.0.2","archived":false,"released":true,"releaseDate":"2011-11-07"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-10-31 15:01:48.338","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"10002_*:*_1_*:*_1627480_*|*_1_*:*_1_*:*_4782454_*|*_5_*:*_1_*:*_0","customfield_12310420":"215343","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-10-31T15:44:26.669+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-3427/watchers","watchCount":2,"isWatching":false},"created":"2011-10-31T13:57:36.798+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["compression"],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-01-31T04:10:17.748+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"The CompressionMetada holds the compressed block offsets in memory. Without being absolutely huge, this is still of non-negligible size as soon as you have a bit of data in the DB. Reallocating this for each read is a very bad idea.\r\n\r\nNote that this only affect range queries, since \"normal\" queries uses CompressedSegmentedFile that does reuse a unique CompressionMetadata instance.\r\n\r\n( Background: http://thread.gmane.org/gmane.comp.db.cassandra.user/21362 )","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12503620","id":"12503620","filename":"0001-debugging.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-11-14T14:22:15.568+0000","size":1720,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12503620/0001-debugging.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12502124","id":"12502124","filename":"3427_v2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-11-03T10:47:52.177+0000","size":9802,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12502124/3427_v2.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12501622","id":"12501622","filename":"3427.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-10-31T15:16:57.410+0000","size":6311,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12501622/3427.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12502099","id":"12502099","filename":"CASSANDRA-3427.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-03T04:55:36.943+0000","size":2554,"mimeType":"binary/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12502099/CASSANDRA-3427.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12503537","id":"12503537","filename":"jmx_jvm_memory-month.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-13T16:55:09.029+0000","size":23717,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12503537/jmx_jvm_memory-month.png"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12503536","id":"12503536","filename":"jmx_jvm_memory-week.png","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-13T16:55:09.019+0000","size":22732,"mimeType":"image/png","content":"https://issues.apache.org/jira/secure/attachment/12503536/jmx_jvm_memory-week.png"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"94632","summary":"CompressionMetadata is not shared across threads, we create a new one for each read","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":22,"total":22,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13140207","id":"13140207","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"This is unfortunately a showstopper for our hadoop jobs querying our production cluster.\r\n\r\nWith 1.0.1 is there any workaround for this issue?\r\nIs it correct that this \"compressed block offsets\" totals to \r\n  (<sstable-size> / <chunk_length>) * 8bytes\r\n\r\nTherefore a change to a higher chunk_length should be an intermediate workaround?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-10-31T15:01:48.338+0000","updated":"2011-10-31T15:01:48.338+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13140221","id":"13140221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"Quite honestly, the best workaround is likely to apply the attached patch on top of 1.0.1 (you can wait for someone to review to get a bit more confidence).\r\n\r\nBecause yes, a bigger chunk_length would diminish the problem, but if you do enough range_queries you would likely still OOM and there is point after which a chunk_length too big is just counter-productive. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-10-31T15:20:51.558+0000","updated":"2011-10-31T15:20:51.558+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13140232","id":"13140232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"body":"Committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2011-10-31T15:44:26.696+0000","updated":"2011-10-31T15:44:26.696+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13140515","id":"13140515","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Rolled out into production. Works a charm! Even on 200Gb sstables.\r\n\r\nSincere appreciations on this one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-10-31T20:10:58.313+0000","updated":"2011-10-31T20:10:58.313+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13142561","id":"13142561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Won't the cache here leak?\r\nMany (most?) sstables are transient (gone after the next minor compaction), but this cache will just grow...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-02T21:25:22.276+0000","updated":"2011-11-02T21:25:22.276+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13142568","id":"13142568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"body":"Oh yes, it seems like I missed that one - we should remove entry from the cache when SSTable gets compacted out. What do you think, Sylvain?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2011-11-02T21:30:59.094+0000","updated":"2011-11-02T21:30:59.094+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13142576","id":"13142576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Or use a ConcurrentLinkedHashMap w/ fixed capacity?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-02T21:38:07.695+0000","updated":"2011-11-02T21:38:07.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13142580","id":"13142580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"body":"yes but that will also imply that we should weight it in memory size instead of number of entries so need to use jamm which is calculation overhead, better just remove unused because we know precisely when to do that...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2011-11-02T21:43:23.541+0000","updated":"2011-11-02T21:43:23.541+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13142838","id":"13142838","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"patch according to Pavel's suggestion","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-03T04:55:37.078+0000","updated":"2011-11-03T04:55:37.078+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13143039","id":"13143039","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"Ok, I think using an object cache is ugly (I know that it was my idea).\r\n\r\nAt first, I tried going with the natural idea, to add the compressionMetadata as a final field of SSTableReader and use that everywhere, ensuring we use one per sstable. Turned out that for SSTableWriter you need to have the metadata existing before the SSTableReader is created and that seemed like a bit of a mess so I backtracked and decided to go with an object cache in CompressionMetada, but more out of laziness than anything else.\r\n\r\nThat was wrong of me to be lazy. We don't need that object cache and if its use is going to leak out of CompressionMetada (like hard coding the addition of the notifier in the DataTracker constructor; which defeats the purpose of the notifier abstraction in the first place) then it's not even clean as far as code is concerned.\r\n\r\nAttaching a v2 patch that remove the cache and do a slight modification of the initial idea, that is it just let CompressedSegmentedFile create the CompressionMetada and have the rest of the code use that. Turns out that once I plug my brain, it's only a few lines of code.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-11-03T10:47:52.325+0000","updated":"2011-11-03T10:47:52.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13143188","id":"13143188","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2011-11-03T14:09:39.321+0000","updated":"2011-11-03T14:09:39.321+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13143195","id":"13143195","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"Alright, committed this new version, thanks","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-11-03T14:17:52.256+0000","updated":"2011-11-03T14:17:52.256+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149279","id":"13149279","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"Handling jvm memory since upgrading to cassandra-1.0 and enabling compression is still a headache.\r\nWhere i used to be able to run w/ Xmx8G i'm now struggling to run with Xmx20G (all caches are disabled) and during startup can hit\r\n{noformat}java.lang.OutOfMemoryError: Java heap space\r\n        at org.apache.cassandra.utils.BigLongArray.<init>(BigLongArray.java:53)\r\n        at org.apache.cassandra.utils.BigLongArray.<init>(BigLongArray.java:39)\r\n        at org.apache.cassandra.io.compress.CompressionMetadata.readChunkOffsets(CompressionMetadata.java:122){noformat}\r\n\r\nI could keep increasing chunk_length (it's already at 256) but this seems awkward just to get a cluster running smoothly. At minimum the calculations for memory requirements for cassandra should be re-written if compression is to take such a large chunk of heap.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-13T11:39:51.028+0000","updated":"2011-11-13T11:39:51.028+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149285","id":"13149285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Does heap usage stay high-post startup?  Can you try forcing a full GC to check that?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-11-13T13:33:31.113+0000","updated":"2011-11-13T13:33:31.113+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149312","id":"13149312","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"bq. Does heap usage stay high-post startup? Can you try forcing a full GC to check that?\r\nYes. GC doesn't seem to help, i'll attach a munin graph that shows it over time. It was running for a number of days just under 20G, but you can see from that how \"squeezed\" it was.\r\n\r\n(invoking full gc via jmx has no noticeable effect on heap used)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-13T16:45:36.610+0000","updated":"2011-11-14T09:44:22.182+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149314","id":"13149314","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"0.8 was running on Xmx8G up until week 44.\r\nat that point we upgraded to 1.0 and enabled compression. The very high memory usage at the beginning of week 44 was to handle the change from chunk_length 16 to 256.\r\nThen for most of week 44 and week 45 we ran with Xmx16G, but this was very \"squeezed\". Now that's OOM, and raising it to 20G didn't help. Currently it's on 30G.\r\n\r\nAlso note we're always used -XX:CMSInitiatingOccupancyFraction=60 for this cluster.\r\n(full java opts are \"-Xss128k -XX:+UseThreadPriorities -XX:ThreadPriorityPolicy=42  -XX:SurvivorRatio=8  -XX:MaxTenuringThreshold=1  -XX:+UseParNewGC  -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -XX:CMSInitiatingOccupancyFraction=60 -XX:+UseCMSInitiatingOccupancyOnly -Xmx30g -Xmx30g -Xmn800M   -XX:ParallelCMSThreads=4  -XX:+CMSIncrementalMode  -XX:+CMSIncrementalPacing  -XX:CMSIncrementalDutyCycleMin=0  -XX:CMSIncrementalDutyCycle=10\". the last 5 were added during week 44 to try and help, ref http://blog.mikiobraun.de/2010/08/cassandra-gc-tuning.html)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-13T16:55:09.148+0000","updated":"2011-11-13T17:08:02.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149637","id":"13149637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"What version exactly are you running now?  1.0.2?  1.0.0 + 3427?  Something else?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-11-14T14:12:49.957+0000","updated":"2011-11-14T14:14:32.365+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149645","id":"13149645","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"I've attached a tiny patch (0001-debugging.patch) that prints in the log the size of the long array we allocate for the chunk offsets. Would you mind trying with this and attach a log of when startup hits one of the OOM you pasted earlier (feel free to use a 8GB heap if it's easier to reproduce). I'd like to know if those offsets are indeed the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-11-14T14:25:36.139+0000","updated":"2011-11-14T14:25:36.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149650","id":"13149650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"I can get you a place to upload the heap dump from an OOM too.  (8GB would be best, since heap analysis requires ram proportional to the heap size.)\r\n\r\nTo rule out the obvious, have you tried running 1.0.x w/o compression?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-11-14T14:30:20.575+0000","updated":"2011-11-14T14:30:20.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149796","id":"13149796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"version: 1.0.2 snapshot (pretty close to release date) + CASSANDRA-3197.\r\nw/o compression: that would require a full compact/scrub. that takes close to 24hrs :-(\r\npatch: i attach that and hopefully have output soon. a heap dump can be done at the same time...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-14T18:14:33.191+0000","updated":"2011-11-14T18:33:28.639+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149861","id":"13149861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"body":"startup log with debug (off 1.0.2 release){noformat}INFO  48:34,688 DatabaseDescriptor: Loading settings from file:/iad/finn/countstatistics/conf/cassandra-prod.yaml\r\nINFO  48:34,782 DatabaseDescriptor: DiskAccessMode 'auto' determined to be mmap, indexAccessMode is mmap\r\nINFO  48:34,792 DatabaseDescriptor: Global memtable threshold is enabled at 512MB\r\nINFO  48:34,890 AbstractCassandraDaemon: JVM vendor/version: Java HotSpot(TM) 64-Bit Server VM/1.6.0_24\r\nINFO  48:34,891 AbstractCassandraDaemon: Heap size: 760414208/8506048512\r\nINFO  48:34,891 AbstractCassandraDaemon: Classpath: /iad/finn/countstatistics/jar/countstatistics.jar:/iad/common/apps/cassandra/lib/jamm-0.2.5.jar\r\nINFO  48:37,158 CLibrary: JNA mlockall successful\r\nINFO  48:37,879 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/Versions-h-42 (256 bytes)\r\nINFO  48:37,879 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/Versions-h-41 (256 bytes)\r\nINFO  48:37,879 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/Versions-h-40 (256 bytes)\r\nINFO  48:37,959 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/IndexInfo-h-3 (223 bytes)\r\nINFO  48:38,001 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/Schema-h-15 (34257 bytes)\r\nINFO  48:38,045 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/Migrations-h-15 (78524 bytes)\r\nINFO  48:38,096 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/LocationInfo-h-150 (80 bytes)\r\nINFO  48:38,096 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/LocationInfo-h-149 (628 bytes)\r\nINFO  48:38,096 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/system/LocationInfo-h-151 (163 bytes)\r\nINFO  48:38,192 DatabaseDescriptor: Loading schema version 1940c630-0be4-11e1-0000-d1695892b1ff\r\nINFO  51:35,136 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191473 (38646535 bytes)\r\nINFO  51:35,136 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-190467 (2284524668 bytes)\r\nINFO  51:35,136 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191469 (254927460 bytes)\r\nINFO  51:35,136 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191475 (30477008 bytes)\r\nINFO  51:35,136 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-114136 (156044360682 bytes)\r\nINFO  51:35,137 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191294 (4585008988 bytes)\r\nINFO  51:35,137 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-190415 (15857295280 bytes)\r\nINFO  51:35,137 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-183183 (196289440978 bytes)\r\nINFO  51:35,137 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191472 (1346076 bytes)\r\nINFO  51:35,137 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-190736 (4626053255 bytes)\r\nINFO  51:35,137 SSTableReader: Opening /iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191435 (1188223188 bytes)\r\nINFO  51:35,187 CompressionMetadata: Allocating chunks index for 5745 chunks for uncompressed size of 1470519 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191472-CompressionInfo.db)\r\nINFO  51:35,421 CompressionMetadata: Allocating chunks index for 129646 chunks for uncompressed size of 33189311 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191475-CompressionInfo.db)\r\nINFO  51:35,544 CompressionMetadata: Allocating chunks index for 165602 chunks for uncompressed size of 42393918 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191473-CompressionInfo.db)\r\nINFO  51:37,171 CompressionMetadata: Allocating chunks index for 1091377 chunks for uncompressed size of 279392485 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191469-CompressionInfo.db)\r\nINFO  51:41,148 CompressionMetadata: Allocating chunks index for 5086138 chunks for uncompressed size of 1302051278 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191435-CompressionInfo.db)\r\nINFO  51:46,351 CompressionMetadata: Allocating chunks index for 9766541 chunks for uncompressed size of 2500234376 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-190467-CompressionInfo.db)\r\nINFO  51:56,717 CompressionMetadata: Allocating chunks index for 19828434 chunks for uncompressed size of 5076078986 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-190736-CompressionInfo.db)\r\nINFO  51:56,897 CompressionMetadata: Allocating chunks index for 19626358 chunks for uncompressed size of 5024347477 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-191294-CompressionInfo.db)\r\nINFO  52:21,670 CompressionMetadata: Allocating chunks index for 67865822 chunks for uncompressed size of 17373650297 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-190415-CompressionInfo.db)\r\nINFO  55:55,920 CompressionMetadata: Allocating chunks index for 666981588 chunks for uncompressed size of 170747286320 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-114136-CompressionInfo.db)\r\nINFO  56:49,620 CompressionMetadata: Allocating chunks index for 840404671 chunks for uncompressed size of 215143595584 (/iad/finn/countstatistics/cassandra-data/countstatisticsCount/thrift_no_finntech_countstats_count_Count_neg8589045746818385983-h-183183-CompressionInfo.db)\r\nERROR 57:51,112 AbstractCassandraDaemon: Fatal exception in thread Thread[SSTableBatchOpen:8,5,main]\r\njava.lang.OutOfMemoryError: Java heap space\r\n\tat org.apache.cassandra.utils.BigLongArray.<init>(BigLongArray.java:53)\r\n\tat org.apache.cassandra.utils.BigLongArray.<init>(BigLongArray.java:39)\r\n\tat org.apache.cassandra.io.compress.CompressionMetadata.readChunkOffsets(CompressionMetadata.java:127)\r\n        ...{noformat}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=michaelsembwever","name":"michaelsembwever","emailAddress":"mick at semb dot wever dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=michaelsembwever&avatarId=10530","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=michaelsembwever&avatarId=10530","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=michaelsembwever&avatarId=10530","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=michaelsembwever&avatarId=10530"},"displayName":"mck","active":true},"created":"2011-11-14T20:06:26.396+0000","updated":"2011-11-14T20:13:28.324+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12529483/comment/13149911","id":"13149911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"body":"That's the stupidest bug ever. It happens we interpret the chunk_length_in_kb not in kb but in bytes.\r\nAnyway, I've created CASSANDRA-3492 to address this.\r\nTurns out if you don't update the chunk_length you're fine because the default is ok, but I guess hitting this issue initially has put you in the wrong spot :(","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=slebresne","name":"slebresne","emailAddress":"sylvain at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=slebresne&avatarId=14630","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=slebresne&avatarId=14630","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=slebresne&avatarId=14630","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=slebresne&avatarId=14630"},"displayName":"Sylvain Lebresne","active":true},"created":"2011-11-14T21:01:45.847+0000","updated":"2011-11-14T21:01:45.847+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-3427/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0gjrj:"}}