{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12329270","self":"https://issues.apache.org/jira/rest/api/latest/issue/12329270","key":"DERBY-1016","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-02-23 08:34:55.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22263","customfield_12310222":"1_*:*_1_*:*_182547026829_*|*_5_*:*_2_*:*_57307547_*|*_4_*:*_1_*:*_2542993","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-12-06T15:14:59.334+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1016/watchers","watchCount":5,"isWatching":false},"created":"2006-02-22T03:07:02.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_backport_reject_10_8","derby_triage10_5_2"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"12.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:19:45.664+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"}],"timeoriginalestimate":null,"description":"javax.transaction.xa.forget (Xid) raises XAER_NOTA exception instead of XA_PROTO on a prepared transaction\r\n\r\nI posted a question to derby-dev about this and heard no response so am assuming it is indeed a bug.\r\n\r\n in  the  XA+ \r\nspecification, it seems like xa_forget should  only be valid for a\r\nheuristically completed transaction, so should  be  XAER_PROTO\r\nand not XAER_NOTA.\r\n\r\n\r\nIn xaStateTran.sql we have this case:\r\n\r\n-- get back into prepared state\r\nxa_start xa_noflags 50;\r\ninsert into xastate values(2);\r\nxa_end xa_success 50;\r\nxa_prepare 50;\r\n\r\nselect * from global_xactTable where gxid is not null order by gxid;\r\n\r\n-- the following should error XAER_NOTA\r\nxa_forget 50;\r\n\r\n\r\n\r\nThe user  code I am looking at handles forget like this. They expect \r\nXAER_PROTO in this case.\r\n              \r\ntry {\r\n             xaRes.forget(xidList[i]);\r\n              System.out.print(\"XA-Transaction [\" + (i+1) + \"]\r\nForgotten. \\n\" );\r\n} catch (XAException XAeForget) {\r\n                        if ( XAeForget.errorCode ==\r\nXAException.XAER_PROTO ) {\r\n                            System.out.print(\"XA-Transaction [\" + (i+1)\r\n+ \"] not heuristically completed yet - Rolling Back instead. \\n\" );\r\n                            xaRes.rollback(xidList[i]);\r\n                            System.out.print(\"XA-Transaction [\" + (i+1)\r\n+ \"] Rolled Back. \\n\" );\r\n                        }\r\n                        if ( XAeForget.getMessage() != null ) {\r\n                            System.out.println(\"XAException \" +\r\nXAeForget.getMessage() );\r\n             ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35726","summary":"javax.transaction.xa.forget (Xid) raises XAER_NOTA exception instead of XA_PROTO on a prepared transaction","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10426","value":"Known fix","id":"10426"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10423","value":"Newcomer","id":"10423"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":46,"total":46,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12367447","id":"12367447","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Reading the javadoc for XAResource I think I agree with you,  XAER_PROTO is the correct error.\r\n\r\nXAResource.recover()\r\n\r\n\"The transaction manager calls this method during recovery to obtain the list of transaction branches that are currently in prepared or heuristically completed states.\"\r\n\r\nXAResource.forget\r\n\r\n\"Tells the resource manager to forget about a heuristically completed transaction branch.\"\r\n\r\nThus a prepared transaction is not a heuristically completed transaction branch and therefore is not a valid state for forget.\r\n\r\n  \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-02-23T08:34:55.000+0000","updated":"2006-02-23T08:34:55.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12368390","id":"12368390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I took a quick look at the store implementation of forget() which is in \r\nopensource/java/engine/org/apache/derby/impl/store/raw/xact/XactXAResourceManager.java!forget().  \r\nIt turns out in this store implementation of XA there is never such a thing as a \r\nheuristically completed transaction, so the implementation just ALWAYS throws\r\n throw StandardException.newException(\r\n         SQLState.STORE_XA_PROTOCOL_VIOLATION);\r\n\r\nI would have assumed that this would have been mapped to PROTO.\r\n\r\nI also seem to remember that in runtime the jdbc layer maintains the XA xid list, so it may be doing a \r\nlookup before calling store, to do the forget.\r\n\r\nThe problem must be in the error mapping from store error to jdbc error.  I am not sure but I believe this mapping\r\nmay be different in network vs. embedded, so it ism portant for the bug reporter to note which system he is using.  My\r\nguess would be embedded , but that is only a guess.\r\n\r\nAnyone know where the mapping for these errors is?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-03-02T08:02:54.000+0000","updated":"2006-03-02T08:02:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12709409","id":"12709409","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"This appears to be a problem for both embedded and network server.  Attached is a reproduction.  As is it runs with embedded but you can comment/'uncomment a few lines to run with Client.\r\n\r\nThere is this highly suspect code in  EmbedXAResource.forget() which may be relevant:\r\n\r\n\r\n  throw new XAException(tranState.isPrepared\r\n            ? XAException.XAER_NOTA \r\n            : XAException.XAER_PROTO);\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-05-14T14:23:04.565+0000","updated":"2009-05-14T14:23:04.565+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12710693","id":"12710693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"body":"I am getting the following error when I try to reproduce the error for DERBY-1016\r\n\r\nReproDerby1016.java:26: cannot find symbol\r\nsymbol  : class utilXid\r\nlocation: class ReproDerby1016\r\n        Xid xid = new utilXid(1,93,18);\r\n                      ^\r\n1 error\r\n\r\nMore Info about the Derby Setup:\r\n\r\nI have checked-out  trunk  source in windows machine and built it  using Ant.\r\nI have created a lib folder in home directory and copied  all jars (jars/sane/*.jar) to lib and set the DERBY_HOME , path , classpath accordingly.\r\nI have put classes folder also in classpath.\r\n\r\nwhat might be the Error.?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"created":"2009-05-19T10:43:33.430+0000","updated":"2009-05-19T10:48:58.158+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12710734","id":"12710734","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"My bad, I neglected to attach this file.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-05-19T13:54:33.211+0000","updated":"2009-05-19T13:54:33.211+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12711238","id":"12711238","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"body":"Thanks Kathey","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"created":"2009-05-20T17:17:47.222+0000","updated":"2009-05-20T17:17:47.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12714079","id":"12714079","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"body":"As pointed out by Kathey , It seems that the error lies in the conditional evaluation of tranState.isPrepared in EmbedXAResource.forget().\r\nAttached is the first/quick/small  patch to it , please review and give your comments.\r\nThank you","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"created":"2009-05-28T17:37:27.115+0000","updated":"2009-05-28T17:37:27.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12714084","id":"12714084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hi Ravinder,\r\n\r\nI think the  code change looks ok. Please add a test to XATransactionTest.  You should also run XATest (currently not in a suite DERBY-4155) to make sure there are no issues associated with the change  and let us know the results of your  Suites.All and derbyall runs.\r\n\r\nThanks \r\n\r\nKathey\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-05-28T17:49:20.419+0000","updated":"2009-05-28T17:49:20.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12717281","id":"12717281","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hi Ravinder,\r\n\r\nI just wanted to check in on this issue.  It would be great to get it committed by July 14,our target release candidate date.  Do you think you will have time to work on it between now and then?\r\n\r\nThanks\r\n\r\nKathey\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-06-08T15:07:25.120+0000","updated":"2009-06-08T15:07:25.120+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12717623","id":"12717623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"body":"Hi Kathey,\r\n\r\nI think I can complete by then.\r\n\r\nthank you","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"created":"2009-06-09T09:18:24.834+0000","updated":"2009-06-09T09:18:24.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12733696","id":"12733696","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Triaged for 10.5.3: assigned normal urgency and noted that a repro is attached.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2009-07-21T16:30:09.713+0000","updated":"2009-07-21T16:30:09.713+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12738443","id":"12738443","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Ravinder told me offline that he would not be able to work on this for a while. Unassigning so someone else can finish it off.  I think the code change is ok. We just need a new test.\r\n\r\nRavinder, I hope you will be able to come back in the near future and pick up another issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-08-03T17:33:13.684+0000","updated":"2009-08-03T17:33:13.684+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12738686","id":"12738686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I'm attaching a second patch that adds a new fixture to XATransaction to test for the existence of this bug. With Ravinder's patch, the fixture passes correctly. I'll be running suites.All with both patches on.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2009-08-03T23:46:46.471+0000","updated":"2009-08-03T23:46:46.471+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12738687","id":"12738687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hi Tiago,\r\nBefore you start your suites.All run. The test should use  the J2EEDataSource class and run with client too. \r\n\r\nAlso I think the arguments in the assertEquals are reversed.\r\nXAeForget.errorCode, XAException.XAER_PROTO\r\n\r\nThe expected code should come first.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-08-03T23:53:15.238+0000","updated":"2009-08-03T23:53:15.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12739713","id":"12739713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I'm attaching a fixed patch. I've also ran suites.All with no failures. However, I ran suites.All under Mac OS X and I was surprised to get a test count that was inferior to 10k tests. If I recall correctly, my Windows and Linux runs always have around 12k tests - is there a logical explanation for this? And is it concerning?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2009-08-05T20:11:45.189+0000","updated":"2009-08-05T20:11:45.189+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12739957","id":"12739957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"body":"Sure , I will be back !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=pandiri","name":"pandiri","emailAddress":"ravinder dot pandiri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ravinder Reddy","active":true},"created":"2009-08-06T09:27:29.965+0000","updated":"2009-08-06T09:27:29.965+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12740193","id":"12740193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Tiago, maybe the upgrade tests, or not all of them, did get run? Did you maybe run with -DderbyTesting.oldReleasePath set to an old directory? Or perhaps you didn't run with it set and there was a problem getting to  'http://svn.apache.org/repos/asf/db/derby/jars'? (like, either that http server was down or you have some sort of firewall protection or had network trouble).\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-08-06T18:48:58.203+0000","updated":"2009-08-06T18:48:58.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12740201","id":"12740201","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"It is possible that the upgrade tests were skipped. I didn't use the derbyTesting.oldReleasePath but network trouble isn't completely out of the picture. I will give it another spin today with derby.tests.trace=true and redirecting the output to a file, then maybe I can see which ones were skipped.\r\n\r\nI'm just worried that this might be a Mac issue, as Macs run Apple's own JDK. In the meanwhile I'm doing my test runs on my trustworthy Ubuntu VM, just to be safe.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2009-08-06T18:56:35.600+0000","updated":"2009-08-06T18:56:35.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12741104","id":"12741104","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Thanks Tiago for your email to the list indicating you ran suites.All successfully. \r\nHowever, I thought it prudent to run derbyall (with ibm16 and sane classes), and it popped one new test failure (apart from a failure in unit/T_RawStoreFactory.unit, similar to the closed DERBY-654, which we can ignore here because I often get it on my machine with this configuration):\r\njdbcapi/xaSimpleNegative.sql. This test apparently already had a test for the XaResource.forget...\r\nAnd as expected, it now shows XAER_PROTO instead of XAER_NOTA.\r\nHowever, it has another test case of XAResource.forget, and that now returns XAER_NOTA instead of XAER_PROTO\r\n\r\nLooking at the code change, this is logical, but I'm just not sure that we're doing the right thing.\r\nShould both cases return XAER_PROTO?\r\n\r\nI looked at the diff for a while, but would like to get the opinion of someone who understands/knows the XA specs better....\r\nThis is the flip/flop section:\r\n-------------------------------------------------\r\nij(XA)> -- start one\r\nxa_start xa_noflags 1;\r\nij(XA)> -- ERROR: can only forget heuristically completed transaction\r\nxa_forget 1;\r\nIJ ERROR: XAER_NOTA                                                          <---returns XAER_PROTO after patch\r\nij(XA)> delete from APP.negative;\r\n1 row inserted/updated/deleted\r\nij(XA)> xa_end xa_success 1;\r\nij(XA)> -- ERROR: now try some bad flag \r\nxa_start xa_suspend 1;\r\nIJ ERROR: XAER_INVAL \r\nij(XA)> -- ERROR: now try some bad flag \r\nxa_start xa_fail 1;\r\nIJ ERROR: XAER_INVAL \r\nij(XA)> xa_prepare 1;\r\nij(XA)> -- can only forget heuristically completed transaction\r\nxa_forget 1;\r\nIJ ERROR: XAER_PROTO                                                     <--returns XAER_NOTA after patch\r\n--------------------------------------------------------------","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-08-09T16:28:59.502+0000","updated":"2009-08-09T16:28:59.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12741105","id":"12741105","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I forgot to say - the test case in xaTransactionTest looks good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-08-09T16:29:34.401+0000","updated":"2009-08-09T16:29:34.401+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12741421","id":"12741421","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"If I understood this properly, XA.forget does return different exceptions depending on the status of the transaction. With this in mind, we probably need to change one occurrence of the XA.forget in the harness test to accommodate for the fact that the exception being thrown for this specific case is now different.\r\n\r\nIs this correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2009-08-10T16:53:24.108+0000","updated":"2009-08-10T16:53:24.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12741501","id":"12741501","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I have not looked closely at this issue or the XA spec in a long time, but my gut instinct is that we should still return XAER_PROTO for this case:\r\n(XA)> xa_prepare 1;\r\nij(XA)> -- can only forget heuristically completed transaction\r\nxa_forget 1;\r\nIJ ERROR: XAER_PROTO <--returns XAER_NOTA after patch \r\n\r\nThe new  behavior seems to contradict the description of the issue: javax.transaction.xa.forget (Xid) raises XAER_NOTA exception instead of XAERR_PROTO on a prepared transaction\r\n\r\nand in general you would think that if the transaction exists you shouldn't get XAER_NOTA (no transaction)\r\n\r\nPlease consult the XA Spec to clarify what the behavior should be.\r\nhttp://www.opengroup.org/publications/catalog/c193.htm","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-08-10T19:23:32.260+0000","updated":"2009-08-10T19:23:32.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12741581","id":"12741581","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I checked the specification that Kathey posted and here's what it has to say about forgetting transactions:\r\n[XAER_NOTA] \r\nThe speciﬁedXIDis not knownbythe resource manager as a heuristically \r\ncompletedXID.\r\n\r\nand\r\n\r\n[XAER_PROTO] \r\nThe routine was invoked in an improper context. See Chapter 6 for details.\r\n\r\nOn further reading, it says the following:\r\nIf a resource manager does not recognise ∗xid, the function fails, returning \r\n[XAER_NOTA].\r\n\r\nSo, I think this is pretty clear that XAER_NOTA is specifically for when we attempt to do an operation on a transaction that is not recognized by the resource manager. Therefore, I think that as long as the transaction exists, the xa_forget call should always return XAER_PROTO in the event of an exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2009-08-10T21:55:45.886+0000","updated":"2009-08-10T21:55:45.886+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12741948","id":"12741948","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I messed up my comment. I had modified the .out to check that it would make the test pass, and instead of from the original .out, I pasted my comment using the modified one.\r\n\r\nSo....\r\nxaSimpleNegative has 2 cases of using of xa_forget:\r\n1:\r\nij(XA)> -- start one\r\nxa_start xa_noflags 1;\r\nij(XA)> -- ERROR: can only forget heuristically completed transaction\r\nxa_forget 1;\r\nIJ ERROR: XAER_PROTO                    <-- returns XAER_NOTA after the patch\r\n\r\n2.:\r\nij(XA)> xa_prepare 1;\r\nij(XA)> -- can only forget heuristically completed transaction\r\nxa_forget 1;\r\nIJ ERROR: XAER_NOTA                     <-- returns XAER_PROTO after the patch\r\n\r\nI'm sorry for the confusion. \r\nSo, based on this, I think the result after the patch makes perfect sense based on the change the patch does...But are both correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2009-08-11T16:34:45.800+0000","updated":"2009-08-11T16:34:45.800+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12742050","id":"12742050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"Me and Kathey have been testing the repro in this issue under both PostgreSQL and DB2. As it turns out, PostgreSQL fails and DB2 passes. The failure I get on PostgreSQL reads as follows:\r\nFAIL: got unexpected exception Heuristic commit/rollback not supported errorCode: -4  calling forget on a prepared transaction\r\n\r\nIt is throwing an error code -4. If we check the XAException class we can see that the error being thrown is actually an XAER_NOTA as opposed to the expected XAER_PROTO.\r\n\r\nHowever, per Kathey's testing, we do get XAER_PROTO on DB2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2009-08-11T20:40:41.158+0000","updated":"2009-08-11T20:40:41.158+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12742086","id":"12742086","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"DB2 also returns XAER_PROTO for the case where forget() is called after start()  (This case now returns XAER_NOTA with the patch)\r\n\r\nMy understanding is that Informix also returns XAER_PROTO  for both cases but I have not confirmed that myself.\r\n\r\nTiago found Postgress returned XAER_NOTA in both cases.\r\n\r\nA couple things to note when trying to sort out the spec and our behavior.  \r\n1) There are no positive cases for forget() with Derby I think. We do not have a method for  heuristic completion, so it is just a matter of which error to throw.  In the xa spec under xa_fprget() it says:\r\n\r\nXAER_NOTA - The specified XID is not known by the resource manager as a heuristically completed XID.\r\n\r\nXAER_PROTO - The routine was invoked in an improper context.\r\n \r\n2) For the original case on which this Jira was based, the user was trying to write a generic recovery program which would forget transactions that had been heuristically completed and rollback if they were not heuristically completed but rather still in a prepared state.  He would first try the forget() and then if that gave an XAER_PROTO would attempt the rollback(). The workaround we gave was to also check for XAER_NOTA.  \r\n\r\n3) It is interesting to note that for other calls XAER_NOTA has a different description.\r\nXAER_NOTA - The specified XID is not known by the resource manager.\r\n\r\nI wish I understood some more about heuristic completion but tend to think that since the only way to differentiate a prepared vs heuristically completed transaction returned by recover() is to call forget, the user was not really calling it in an improper context and someone went out of their way to put that extra condition on the XAER_NOTA exception desription for forget(),  so my somewhat uneasy opinion is that XAER_NOTA is  most appropriate whenever forget() is called with Derby.  Opinions?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-08-11T22:01:30.745+0000","updated":"2009-08-11T22:01:30.745+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12742663","id":"12742663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Just to add in another opinion, I consulted with my colleague with the JCC team (DB2) and he feels XAER_PROTO is correct.  He said:\r\n\"I would say that XAER_PROTO is more appropriate as the resource manager is aware of the XID in prepared state.\"\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-08-13T00:23:29.429+0000","updated":"2009-08-13T00:23:29.429+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12742952","id":"12742952","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"I have been discussing this issue with Kathey and Myrna on IRC and it is generally hard to reach an optimal behavior, mostly because the XA specification is too vague and not very clear on this issue.\r\n\r\nOn MySQL for example, we are able to invoke a forget on a transaction right after we start it, whereas this is not possible in DB2. Also, running the attached repro against MySQL makes it fail with XAER_RMFAIL:\r\nXAER_RMFAIL: The command cannot be executed when global transaction is in the  ACTIVE state\r\n\r\nStill, since we don't have heuristic transactions in Derby, forget will always return an error and never really succeed. This way, we thought the best behavior is to throw XAER_NOTA (not a transaction) whenever the XID doesn't exist and throw XAER_PROTO for all the cases where the XID exists.\r\n\r\nShould no one object to this change, I'll create a patch and go through with it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2009-08-13T20:46:45.153+0000","updated":"2009-08-13T20:46:45.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12742985","id":"12742985","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"That behavior sounds reasonable to me and  provides the most intuitive user feedback I think.  We should have a release note describing the cases that change.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-08-13T21:39:35.226+0000","updated":"2009-08-13T21:39:35.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/12896705","id":"12896705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"body":"Unassigning as I'm working on DERBY-728 and other people might pick this up in the meanwhile.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=espinha","name":"espinha","emailAddress":"tiago dot derby at espinhas dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tiago R. Espinha","active":true},"created":"2010-08-09T21:44:00.053+0000","updated":"2010-08-09T21:44:00.053+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13105414","id":"13105414","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Hi Jayaram,\r\n\r\nThank you for looking at this issue. If you read through the comments you will see that Tiago did most of the work to figure out what the behavior should be.  So the code fix itself should probably just be a few lines plus you will need to add a test to XATest, but you may want to familiarize yourself with XA first.\r\n\r\nHere is some reference material that you might find helpful in learning about XA\r\nThe XA Open Specification\r\nhttps://www2.opengroup.org/ogsys/jsp/publications/PublicationDetails.jsp?publicationid=11144\r\nThe JTA Specification\r\nhttp://www.oracle.com/technetwork/java/javaee/jta/index.html\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-09-15T15:08:57.577+0000","updated":"2011-09-15T15:08:57.577+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13118609","id":"13118609","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"Hi \r\n1) In the attaced test case suite, should we add a case for XAER_NOTA scenario\r\n2) In the atttached test case should we test for a positive scenario where XA_FORGET goes through without any issues\r\n3) Also in simillar lines should we test how XA_FORGET behaves  after a commit or rollback.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-10-01T01:01:40.259+0000","updated":"2011-10-01T01:01:40.259+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13128338","id":"13128338","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"Thanks Kathy,\r\nAs per the issue history, to make the xa_forget to throw the xaer_proto error, modified the patched EmbedXAResource.java from \r\n\r\nthrow new XAException(tranState.isPrepared ? XAException.XAER_PROTO: XAException.XAER_NOTA) \r\nto \r\nthrow     new XAException(XAException.XAER_PROTO)\r\n\r\nAfter making the above change, tried running attached fixture testForgetExceptionDerby1016. But  i get the exception  below. \r\n\r\n1) testForgetExceptionDerby1016(org.apache.derbyTesting.functionTests.tests.jdbcapi.XATransactionTest)junit.framework.AssertionFailedError: \r\nFAIL: Got unexpected exception null errorCode: -4  calling forget on a prepared transaction expected:<-6> but was:<-4>\r\n\tat org.apache.derbyTesting.functionTests.tests.jdbcapi.XATransactionTest.testForgetExceptionDerby1016(XATransactionTest.java:447)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:48)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:116)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n\tat junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n\tat junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n\tat junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\tat org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-10-16T03:54:14.731+0000","updated":"2011-10-16T03:54:14.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13159074","id":"13159074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"Attaching the fix for review. Also attaching the test output.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2011-11-29T04:15:56.108+0000","updated":"2011-11-29T04:15:56.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13159849","id":"13159849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Thanks Jayaram for that patch.\r\n\r\nThere are a couple of concerns with your patch.\r\nFirstly, the .stat file seems to list a number of files that have conflicts. \r\nSecondly, there were some unnecessary whitespace differences, some unnecessary brackets, and there were some left-over references to java.io.PrintStream - probably from some debugging attempts.\r\nUsually, before submitting a patch, it makes sense to review your svn diff result and carefully evaluate your changes...\r\n\r\nApart from that, the patch looked fine to me.\r\nHowever, it seems that the forget method in EmbedXAResource that was changed for this test would return either an XAER_NOTA or XAER_PROTO, and so perhaps it would be nice to have an additional test case for the XAER_NOTA.\r\nI've uploaded a patch that makes those minor adjustments.\r\n\r\nHowever, I have two further questions:\r\n- before submitting this latest patch, you mentioned seeing the test fail. What happened between then and now? Did the problem get resolved by doing a clean build (after ant clobber) perhaps?\r\n- Did you run suites.All?\r\n\r\nI ran jdbcapi._Suite which I think is enough to test the latest patch. That patch is now ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-11-30T06:09:24.911+0000","updated":"2011-11-30T06:09:24.911+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13163118","id":"13163118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I committed the last patch (my modifications based on Jayaram's) with revision 1210686.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-12-05T22:37:28.769+0000","updated":"2011-12-05T22:37:28.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13163623","id":"13163623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Reopening because this check in caused a test failure in jdbcapi/xaSimpleNegative.sql:\r\n\r\n*** Start: xaSimpleNegative jdk1.6.0_24 derbyall:xa 2011-12-06 01:06:38 ***\r\n193 del\r\n< IJ ERROR: XAER_NOTA \r\n193a193\r\n> IJ ERROR: XAER_PROTO \r\nTest Failed.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-12-06T14:32:36.301+0000","updated":"2011-12-06T14:32:36.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13163636","id":"13163636","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"It seems to me the diff in the failing xaSimpleNegative test was exactly in the case for which this bug was logged, this is from xaSimpleNegative.out:\r\nij(XA)> xa_prepare 1;\r\nij(XA)> -- can only forget heuristically completed transaction\r\nxa_forget 1;\r\nIJ ERROR: XAER_PROTO \r\n\r\nSo I updated the master with revision 1210972.\r\nresolving again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2011-12-06T15:14:59.363+0000","updated":"2011-12-06T15:14:59.363+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13222604","id":"13222604","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Although a behavior  correction, this is a behavior change so I think needs a release note and is  probably  not appropriate for backport.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-03-05T20:53:12.331+0000","updated":"2012-03-05T20:53:12.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13276144","id":"13276144","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hello,\r\n\r\nThis issue is marked as needing a release note but no release note has been provided. Could someone please supply a release note? Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-15T19:37:04.757+0000","updated":"2012-05-15T19:37:04.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13278561","id":"13278561","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"body":"Please find the attached release notes. But i was not able to validate the release notes, since i kept getting classnotfound exception when trying to run java org.apache.derbyBuild.ReleaseNoteReader releaseNote.html.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rsjay1976","name":"rsjay1976","emailAddress":"rsjay1976 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jayaram Subramanian","active":true},"created":"2012-05-18T03:59:21.779+0000","updated":"2012-05-18T03:59:21.779+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13278771","id":"13278771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for the first draft of the release note, Jayaram. I have re-worded it slightly. Feel free to correct it further if you think I garbled it.\r\n\r\nIt may be that your classpath did not include the class tree generated by the Derby build. ReleaseNoteReader is compiled into the class tree but it isn't put into any of the Derby jars.\r\n\r\nThanks,\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-18T12:41:55.544+0000","updated":"2012-05-18T12:41:55.544+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13279014","id":"13279014","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think the release note makes it sound like we throw XAER_PROTO in all cases of forget() even if the transaction does not exist. If the transaction does not exist, we still throw XAER_NOTA.\r\n\r\nSo we throw XAER_PROTO for forget() with an active transaction id. XAER_NOTA  if the transaction does not exist.  Prior behavior was we would throw XAER_NOTA in all cases when forget() was called.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-05-18T17:50:47.765+0000","updated":"2012-05-18T17:50:47.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13279041","id":"13279041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a new version of the release note, which hopefully clarifies the point Kathey raised. If this still doesn't look correct, feel free to wordsmith it further.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2012-05-18T18:16:35.548+0000","updated":"2012-05-18T18:16:35.548+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13279124","id":"13279124","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think that looks great. Thanks Rick and Jayaram.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-05-18T19:51:43.517+0000","updated":"2012-05-18T19:51:43.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329270/comment/13685348","id":"13685348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:45.547+0000","updated":"2013-06-17T09:19:45.547+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1016/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06h8f:"}}