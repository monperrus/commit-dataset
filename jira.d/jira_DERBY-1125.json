{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12330399","self":"https://issues.apache.org/jira/rest/api/latest/issue/12330399","key":"DERBY-1125","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-03-18 08:05:51.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22323","customfield_12310222":"1_*:*_1_*:*_432310000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_9587135000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-03-23T05:05:28.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1125/watchers","watchCount":0,"isWatching":false},"created":"2006-03-18T05:00:18.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-07-12T04:11:03.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11405","id":"11405","name":"Build tools"}],"timeoriginalestimate":null,"description":"This security exception can occur if derbyclient.jar is before derby.jar after revision 370815.  \nSee:\nhttp://www.nabble.com/regression-%21-all-tests-in-jdbcapi-fails-for-me-t1298249.html#a3462544\n\n\nFrom Andrew's email:\n\nOn 3/17/06, Andreas Korneliussen <Andreas.Korneliussen@sun.com> wrote:\n> </snip a whole bunch of stuff>\n>\n> Exception: java.lang.SecurityException: sealing violation: can't seal package org.apache.derby.iapi.services.info:\nalready loaded\n\nSee DERBY-848 and DERBY-1046.\n\niapi.services.info.ProductVersionHolder and friends were added to\nderbyclient.jar by David in DERBY-848, specifically with revision\n370815.\n\nThere are two clear solutions: unseal iapi.services.info or copy the\ninfo classes to a new shared info package.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"40528","summary":"Getting security exception when derbyclient.jar is before derby.jar  because classes in iapi.services.info have been added to derbyclient.jar","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12330399/comment/12370904","id":"12370904","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"OK, to be clear, what happened was not that I included the iapi/services/info package, that has been there for a while.\r\n\r\nWhat happened was I *copied* JVMInfo from iapi/services/info to shared/common/info.  At that time I was unaware that iapi/services/info was being included in derbyclient.jar.\r\n\r\nThen Knut discovered that JVMInfo was in two places in derbyclient.jar (iapi/services/info and shared/common/info), so I then excluded services/info/JVMInfo.class from the derbyclient jar file.  Case solved (hah!).\r\n\r\nSo now what happens is that services/info/JVMInfo is loaded from derby.jar when you run with derby.jar and derbyclient.jar in the same classpath.  And then if you have derbyclient.jar in from of derby.jar all other classes from the package services/info are loaded from derbyclient.jar.  This is not allowed for sealed packages, thus the security exception.\r\n\r\nI made my copy of JVMInfo because I had assumed it was a Bad Thing to copy the same classes into two separate jar files.  This is called Code Sharing and is Not Allowed.  But it's been there for quite a while. So in a mixed version environment you can have the same shadowing/compatibility issues that have been painstakingly documented for code sharing in general.\r\n\r\nSo, we have the following choices:\r\n\r\n(1)  I can remove the copy of JVMInfo in shared/common/info, and go back to the way things were.  In my client code I can import org.apache.derby.iapi.services.info.JVMInfo instead of org.apache.derby.shared.common.info.JVMInfo.    This is the way things were and would probably be the simplest solution, but we would continue to have the potential issues around compatibility and shadowing in a mixed version environment.  It is worth noting that this has not come up as an issue as of yet.\r\n\r\n(2) I can copy everything into org.apache.derby.shared.common and fix all client code so it refers to the shared versions of this stuff.  The risk of this is now we have a fair amount of code duplication, and things can get skewed pretty easily\r\n\r\n(3) I can implement the proposal we had earlier, which was to use a build script to automatically make a copy of the classes in iapi/services/info and put them in shared.  The engine code would continue to use iapi/services/info, and the client code would use shared/common/info.  I do have to wonder what is going on with the tools and network jar files, however, as I think they are also making use of iapi/services/info classes.  This could turn into a Big Project if I have to make copies for each jar file.\r\n\r\n(4) Unseal iapi/services/info.  This seems like the wrong way to go.  This is an internal package and we don't want it to be possible to interject \"new\" implementations of these classes from other code bases.\r\n\r\nMy current itch is to put things back the way they were, and solve the longer-term code sharing problem as part of the code sharing JIRA, DERBY-289.  So I am going to go with option (1).  But please let me know if you have an opinion on this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2006-03-18T07:13:29.000+0000","updated":"2006-03-18T07:13:29.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12330399/comment/12370911","id":"12370911","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"I agree, option 1 is the way to go.\r\n\r\nI remembered after you brought it up in option 3 above that currently the code is already duplicated in the tools jar. It is assumed that the network server will be running alongside the engine, so classlister filters out the info classes from derbynet.jar.\r\n\r\nThese classes are fairly stable. JVMInfo is the only one that has seen any change, and that was to add a new identifier for JDK 1.6. That change was made in 10.2. The potential for problems with shadowing, etc. are already there with the duplication in derbytools.jar, I suppose, but I think the potential for problems is minor, and the problem in a mixed environment would be fairly obvious to spot.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2006-03-18T08:05:51.000+0000","updated":"2006-03-18T08:05:51.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12330399/comment/12371345","id":"12371345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am coming into this issue late so might really be misunderstanding things but  I don't   like this idea of importing engine classes into the client no matter how stable  we think they are.  Doing this means that every line of code has to be evaluated for impact.\r\n\r\nThis strategy was discussed on the list previously and the concensus I thought was that for client a copy would be put in the shared directory and at such time as we had a code sharing solution, the files would be combined.  If the files are really that stable it shouldn't be hard to resolve differences.\r\n\r\nAlso, the description of this bug does not describe the circumstances under which a user might see this issue.  I seem to recall that it imposed some sort of required classpath order. Is that correct?\r\n\r\nIf so I think it is a regression and needs to be moved up to Blocker for 10.2.\r\n\r\n\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-03-22T07:41:36.000+0000","updated":"2006-03-22T07:41:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12330399/comment/12371349","id":"12371349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Hi, Kathey, I was wondering when you were going to join in on the fun :)\r\n\r\nThe thing is, that these classes have been imported into the client jar for as long as I have been on the project.  So I can't imagine it can be a regression to put it back the way things were.\r\n\r\nIf you don't like the solution of reverting back to how things were, can you suggest another one?\r\n\r\nThanks,\r\n\r\nDavid","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2006-03-22T07:46:24.000+0000","updated":"2006-03-22T07:46:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12330399/comment/12371352","id":"12371352","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Also, to answer your question, yes, my understanding is that the bug reveals itself when derbyclient.jar is in front of derby.jar.  Please feel free to upgrade to Blocker.  I was working on implementing Solution 1 as described above but I'm on hold now until we can finish our discussion of potential issues around this solution and what the best alternative might be, if any.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2006-03-22T07:52:09.000+0000","updated":"2006-03-22T07:52:09.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12330399/comment/12371361","id":"12371361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks David, that is my mistake. I did not realize that this was part of the sysinfo code imported into client in 10.1. Please go ahead and switch it back to the 10.1 setup.\r\n\r\nThe defect itself  is a regression because a classpath order that worked in 10.1 derbyclient.jar;derby.jar does not currently work in 10.2.  I found the mail:\r\n\r\nhttp://www.nabble.com/regression-%21-all-tests-in-jdbcapi-fails-for-me-t1298249.html#a3462544\r\n\r\nI'll bump it up to Critical I guess.  But a must fix for 10.2 I think. As we get closer to the release I think it is important that product regressions be properly identified and not slip through the cracks so that is why I brought it up.\r\n\r\nThanks for taking care of this issue.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-03-22T08:12:02.000+0000","updated":"2006-03-22T08:12:02.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12330399/comment/12371464","id":"12371464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"body":"Committed revision 387905","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=davidvc","name":"davidvc","emailAddress":"david at vancouvering dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Van Couvering","active":true},"created":"2006-03-23T05:05:26.000+0000","updated":"2006-03-23T05:05:26.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1125/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07avj:"}}