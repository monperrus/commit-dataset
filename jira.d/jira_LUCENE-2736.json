{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12478972","self":"https://issues.apache.org/jira/rest/api/latest/issue/12478972","key":"LUCENE-2736","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316070","id":"12316070","description":"Major release after 3.1","name":"3.2","archived":false,"released":true,"releaseDate":"2011-06-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314025","id":"12314025","description":"Alpha release of the 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-05-17 03:32:16.235","customfield_12312323":null,"customfield_12310420":"11114","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_16850855854_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-05-17T11:36:48.887+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-2736/watchers","watchCount":1,"isWatching":false},"created":"2010-11-03T10:49:13.107+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316070","id":"12316070","description":"Major release after 3.1","name":"3.2","archived":false,"released":true,"releaseDate":"2011-06-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314025","id":"12314025","description":"Alpha release of the 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-06-03T16:37:11.342+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310235","id":"12310235","name":"core/search","description":"issues with search code"}],"timeoriginalestimate":null,"description":"Implementations of {{DocIdSetIterator}} behave differently when advanced is called. Taking the following test for {{OpenBitSet}}, {{DocIdBitSet}} and {{SortedVIntList}} only {{SortedVIntList}} passes the test:\r\n{code:title=org.apache.lucene.search.TestDocIdSet.java|borderStyle=solid}\r\n...\r\n\tpublic void testAdvanceWithOpenBitSet() throws IOException {\r\n\t\tDocIdSet idSet = new OpenBitSet( new long[] { 1121 }, 1 );  // bits 0, 5, 6, 10\r\n\t\tassertAdvance( idSet );\r\n\t}\r\n\r\n\tpublic void testAdvanceDocIdBitSet() throws IOException {\r\n\t\tBitSet bitSet = new BitSet();\r\n\t\tbitSet.set( 0 );\r\n\t\tbitSet.set( 5 );\r\n\t\tbitSet.set( 6 );\r\n\t\tbitSet.set( 10 );\r\n\t\tDocIdSet idSet = new DocIdBitSet(bitSet);\r\n\t\tassertAdvance( idSet );\r\n\t}\r\n\r\n\tpublic void testAdvanceWithSortedVIntList() throws IOException {\r\n\t\tDocIdSet idSet = new SortedVIntList( 0, 5, 6, 10 );\r\n\t\tassertAdvance( idSet );\r\n\t}\t\r\n\r\n\tprivate void assertAdvance(DocIdSet idSet) throws IOException {\r\n\t\tDocIdSetIterator iter = idSet.iterator();\r\n\t\tint docId = iter.nextDoc();\r\n\t\tassertEquals( \"First doc id should be 0\", 0, docId );\r\n\r\n\t\tdocId = iter.nextDoc();\r\n\t\tassertEquals( \"Second doc id should be 5\", 5, docId );\r\n\r\n\t\tdocId = iter.advance( 5 );\r\n\t\tassertEquals( \"Advancing iterator should return the next doc id\", 6, docId );\r\n\t}\r\n{code}\r\n\r\nThe javadoc for {{advance}} says:\r\n{quote}\r\nAdvances to the first *beyond* the current whose document number is greater than or equal to _target_.\r\n{quote}\r\nThis seems to indicate that {{SortedVIntList}} behaves correctly, whereas the other two don't. \r\nJust looking at the {{DocIdBitSet}} implementation advance is implemented as:\r\n{code}\r\nbitSet.nextSetBit(target);\r\n{code}\r\nwhere the docs of {{nextSetBit}} say:\r\n{quote}\r\nReturns the index of the first bit that is set to true that occurs *on or after* the specified starting index\r\n{quote}\r\n","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10121","value":"New","id":"10121"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10120","value":"Patch Available","id":"10120"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"25274","summary":"Wrong implementation of DocIdSetIterator.advance ","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hardy","name":"hardy","emailAddress":"hibernate at ferentschik dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hardy Ferentschik","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hardy","name":"hardy","emailAddress":"hibernate at ferentschik dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hardy Ferentschik","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12478972/comment/13034527","id":"13034527","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"Thanks Hardy for reporting that.\r\n\r\nBut I think this works exactly as documented? Note that the javadocs of advance() state \"*beyond* the current whose document number is *greater than or equal* to target\". Also, there's a note in the javadocs:\r\n\r\n{noformat}\r\n   * <b>NOTE:</b> when <code> target &le; current</code> implementations may opt \r\n   * not to advance beyond their current {@link #docID()}.\r\n{noformat}\r\n\r\nI think that the word 'beyond' is confusing here. Perhaps we can modify the javadocs to:\r\n\r\n\"Advances to the first document whose number is greater than or equal to target\"\r\n\r\nIf there are no objections, or better wording, I'll commit this later today, but only to 3.2/4.0 and not 3.0.2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2011-05-17T03:32:16.235+0000","updated":"2011-05-17T03:32:16.235+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12478972/comment/13034534","id":"13034534","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"Patch with Javadocs fixes. I will commit it later today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2011-05-17T03:57:54.238+0000","updated":"2011-05-17T03:57:54.238+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12478972/comment/13034618","id":"13034618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"body":"Shai, with the modified text the NOTE on \"implementations freedom to not advance beyond in some situations\" becomes strange... I think that the original text stress the fact the \"real intended\" behavior is to do advance beyond current, just that for performance reasons the decision whether to advance beyond in some situations is left for implementation decision, and so, if caller provides a target which is not greater than current, it should be aware of this possibility. \r\n\r\nSo I think it is perhaps better to either not modify this at all, or at most, to add \"(see NOTE below)\" just after \"beyond\":\r\n\r\n{noformat}\r\n-   * Advances to the first beyond the current whose document number is greater\r\n+   * Advances to the first beyond (see NOTE below) the current whose document number is greater\r\n{noformat}\r\n\r\nThis would prevent the confusion I think?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=doronc","name":"doronc","emailAddress":"cdoronc at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=doronc&avatarId=12738","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=doronc&avatarId=12738","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=doronc&avatarId=12738","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=doronc&avatarId=12738"},"displayName":"Doron Cohen","active":true},"created":"2011-05-17T07:46:42.973+0000","updated":"2011-05-17T07:46:42.973+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12478972/comment/13034727","id":"13034727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"Thanks Doron - I changed the javadocs as you suggest.\r\n\r\nCommitted revision 1104159 (3x).\r\nCommitted revision 1104167 (trunk).\r\n\r\nThanks Hardy for reporting that !","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2011-05-17T11:36:48.896+0000","updated":"2011-05-17T11:36:48.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12478972/comment/13043468","id":"13043468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"body":"Bulk closing for 3.2","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rcmuir","name":"rcmuir","emailAddress":"rcmuir at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rcmuir&avatarId=10150","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rcmuir&avatarId=10150","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rcmuir&avatarId=10150","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rcmuir&avatarId=10150"},"displayName":"Robert Muir","active":true},"created":"2011-06-03T16:37:11.331+0000","updated":"2011-06-03T16:37:11.331+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-2736/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i04oqv:"}}