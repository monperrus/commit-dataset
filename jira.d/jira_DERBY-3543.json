{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12391476","self":"https://issues.apache.org/jira/rest/api/latest/issue/12391476","key":"DERBY-3543","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-03-19 20:20:39.701","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23701","customfield_12310222":"1_*:*_1_*:*_6505142439_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_4985957757","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-05-29T01:15:07.648+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3543/watchers","watchCount":0,"isWatching":false},"created":"2008-03-14T18:16:05.209+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12320025","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12320025","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12394319","key":"DERBY-3633","self":"https://issues.apache.org/jira/rest/api/2/issue/12394319","fields":{"summary":"tools/derbyrunjartest.java fails with 'No command given.' (expecting 'No arguments given.')","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-05-04T18:22:00.760+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11410","id":"11410","name":"Network Server"}],"timeoriginalestimate":null,"description":"I noticed that \njava org.apache.derby.drda.NetworkServerControl  -user mary -password mypass\n\nwith no actual command just completes with no usage message.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39333","summary":"NetworkServerControl with options but no command does not give usage message","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":18,"total":18,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12580538","id":"12580538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"body":"\r\nThe same issue is also shown with other command line options, for example:\r\n    java org.apache.derby.drda.NetworkServerControl -noSecurityManager\r\nreturns with no usage message too.\r\n\r\n However that's not for all options, for instance,\r\n    java org.apache.derby.drda.NetworkServerControl -host localhost\r\ndoes return with an error message.\r\n\r\nSeems to be a broader issue with the command/option parsing code in NetworkServerControlImpl.  I keep staring at it for a little more time to see if there's an obvious error and a fix.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"created":"2008-03-19T20:20:39.701+0000","updated":"2008-03-19T20:20:39.701+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12580541","id":"12580541","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"body":"> However that's not for all options, for instance,\r\n>    java org.apache.derby.drda.NetworkServerControl -host localhost\r\n> does return with an error message.\r\n\r\nWell, this is because, there is no \"-host\" option.\r\n\r\nHowever that's not for all options, for instance,\r\n    java org.apache.derby.drda.NetworkServerControl -h localhost\r\nalso does NOT print an error message.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"created":"2008-03-19T20:24:24.453+0000","updated":"2008-03-19T20:24:24.453+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12580589","id":"12580589","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"body":"\r\nHaving had a closer look into this issue, I'm attaching an experimental patch for comments (I quickly tested the patch but did not run any test suites).\r\n\r\nAs stated above, this issue is unrelated to DERBY-2109: The usage text is not printed if any command-line argument has been given, even if a command is still missing.\r\n\r\nFor instance:\r\n    java org.apache.derby.drda.NetworkServerControl\r\nprints the usage text while\r\n    java org.apache.derby.drda.NetworkServerControl -h localhost\r\ndoes not.\r\n\r\nThe patch results changes the behaviour to that a usage message is always printed when no command has been given, regardless of whether any options have been specified.\r\n\r\nThere are a number of finepoints described below.\r\n\r\n--------------------------------------------------------------------------------------\r\n\r\nFirst, there is a swallowed exception, I'd call it a bug, in method NetworkServerControlImpl.findCommand(String[]), around line 2145:\r\n\t\t\t// didn't find command\r\n\t\t\tconsolePropertyMessage(\"DRDA_UnknownCommand.U\", \r\n\t\t\t\t(String) commandArgs.firstElement());\r\n\r\na) When no actual command was given, the Vector commandArgs is still empty.\r\nb) It then happens that commandArgs.firstElement() throws a NoSuchElementException.\r\nc) Unfortunately, this exception is swallowed by the following catch clause:\r\n\t\t} catch (Exception e) {\r\n\t\t\tif (e.getMessage().equals(NetworkServerControlImpl.UNEXPECTED_ERR))\r\n\t\t\t\tthrow e;\r\n\t\t\t//Ignore expected exceptions, they will have been\r\n\t\t\t\t\t\t\t\t\t//handled by the consolePropertyMessage routine\r\n\t\t}\r\n\r\nA fix is very simple: move a closing brace \"}\" a few lines down, so that the block structure becomes:\r\n\t\t\tif (commandArgs.size() > 0)\r\n\t\t\t{\r\n\t\t\t\t...\r\n\r\n\t\t\t\t// didn't find command\r\n\t\t\t\tconsolePropertyMessage(\"DRDA_UnknownCommand.U\", \r\n\t\t\t\t\t(String) commandArgs.firstElement());\r\n\t\t\t}\r\n\r\nWhen no actual command was given, the block is not executed.\r\n\r\nThe method findCommand(String[]) ends with:\r\n\t\treturn COMMAND_UNKNOWN;\r\n\r\n--------------------------------------------------------------------------------------\r\n\r\nSecond, and more importantly, the method NetworkServerControlImpl.parseArgs(String[]) shows some twisted logic:\r\n\r\n        int command = COMMAND_START; \r\n        if (args.length > 0)\r\n            command = findCommand(args);\r\n        else\r\n        {\r\n            consolePropertyMessage(\"DRDA_NoArgs.U\");\r\n        }\r\n        return command;\r\n\r\na) It assigns a default command (\"start\").\r\n\r\nb) However, if no command (or option) it calls\r\n            consolePropertyMessage(\"DRDA_NoArgs.U\");\r\n   which prints a usage message and EXITS -- as I've found out to my surprise.  I didn't expect a method named  consolePropertyMessage() to have such dramatic side-effects.\r\n\r\nc) The usage message clearly indicates that there's no default command:\r\n\r\nUsage: NetworkServerControl <commands>\r\nCommands:\r\nstart [-h <host>] [-p <portnumber>] [-noSecurityManager] [-ssl <sslmode>]\r\nshutdown [-h <host>][-p <portnumber>] [-ssl <sslmode>] [-user <username>] [-pass\r\nword <password>]\r\nping [-h <host>][-p <portnumber>] [-ssl <sslmode>]\r\nsysinfo [-h <host>][-p <portnumber>] [-ssl <sslmode>]\r\nruntimeinfo [-h <host>][-p <portnumber>] [-ssl <sslmode>]\r\nlogconnections {on|off}[-h <host>][-p <portnumber>] [-ssl <sslmode>]\r\nmaxthreads <max>[-h <host>][-p <portnumber>] [-ssl <sslmode>]\r\ntimeslice <milliseconds>[-h <host>][-p <portnumber>] [-ssl <sslmode>]\r\ntrace {on|off} [-s <session id>][-h <host>][-p <portnumber>] [-ssl <sslmode>]\r\ntracedirectory <traceDirectory>[-h <host>][-p <portnumber>] [-ssl <sslmode>]\r\n\r\nd) If, however, any command-line argument was given and findCommand() runs into any problems it returns COMMAND_UNKNOWN, in which case the assigned default command has got overridden.\r\n\r\n\r\nTo summarize: Perhaps, there once was such a thing as a default command (\"start\") in the past, but points b), c), and d) indicate to me that this has not been supported for a while.\r\n\r\nSo, under the assumption that users MUST provide a command to NetworkServerControl and if they have not done so that\r\n- a usage message is to be printed regardless of whether additional options were provided or not and\r\n- NetworkServerControl should then exit\r\nthe method parseArgs(String[]) can be nicely cleaned up and implemented as:\r\n\r\n        int command = findCommand(args);\r\n        if (command == COMMAND_UNKNOWN)\r\n        {\r\n            consolePropertyMessage(\"DRDA_NoArgs.U\");\r\n        }\r\n        return command;\r\n\r\n--------------------------------------------------------------------------------------\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"created":"2008-03-19T22:34:32.066+0000","updated":"2008-03-19T22:34:32.066+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12584356","id":"12584356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"body":"Changing this JIRA's title to reflect that it's a general command-line argument parsing issue and not specific to the new -user/-password options.\r\n\r\nFlagging as \"patch available\" to trigger review and comments on the experimental patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"created":"2008-04-01T23:23:30.958+0000","updated":"2008-04-01T23:23:30.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12586802","id":"12586802","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Hi Martin,\r\n\r\nI definitely think you are onto something here. I definitely think option handling for the server needs an overhaul. I did run the tests with your experimental patch and I saw the following failure (which I have not investigated further):\r\n\r\nThere was 1 failure:\r\n1) testWrongCommands(org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest)junit.framework.AssertionFailedError: expected:<0> but was:<1>\r\n        at org.apache.derbyTesting.junit.BaseTestCase.assertExecJavaCmdAsExpected(BaseTestCase.java:505)\r\n        at org.apache.derbyTesting.functionTests.tests.derbynet.ServerPropertiesTest.testWrongCommands(ServerPropertiesTest.java:661)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:103)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:24)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:21)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:25)\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-04-08T13:54:03.130+0000","updated":"2008-04-08T13:54:03.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12589277","id":"12589277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"body":"\r\nDyre Tjeldvoll wrote:\r\n> I definitely think you are onto something here. I definitely think option handling for the server needs an overhaul.\r\n\r\nI wholeheartedly agree.  Just that my patch attempts a cleanup of only a single issue as a first step...\r\n\r\nPlease, find attached the updated patch DERBY-3542-1 (replacing the former patch). The derbyall and junit-all suites pass with no issues.\r\n\r\nThis patch update:\r\n\r\n1) Fixes the issue in ServerPropertiesTest..testWrongCommands(), which I consider a test case bug -- or a really weird behaviour of NetworkServerControl:\r\n    a) When no command was given, NSC exits with a usage message and an error.  Fine.\r\n    b) When an illegal command was given, NSC exits with a usage message but NO error.\r\n\r\n    I changed the test to expect an error return value for case b).\r\n\r\n2) Changes thekey and text of an error message from DRDA_NoArgs.U to\r\n       DRDA_NoCommand.U=No command given.\r\n    to cover the case that some options were given (like \"-h\") but no command (like \"start\").  This is the actual case this JIRA was filed for.\r\n\r\n3) Moves the method  testWrongCommands() from ServerPropertiesTest.java to NetworkServerControlApiTest.java.  Note that the author had put into a code comment that this method may not be in the right place:\r\n    *   Note: maybe these test cases should be moved to another Test,\r\n    *   as they don't actually test any properties. \r\n\r\nWhile the patch now passes the test suites, it would still be useful if other developers with more knowledge of (the history of) NetworkServerControl could have a look and comment on the underlying assumption that there's no support of a default command (btw, the admin guide either doesn't mention any), i.e., users must always provide a command, with or without additional options.\r\n\r\nMartin\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"created":"2008-04-15T23:22:58.689+0000","updated":"2008-04-15T23:22:58.689+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12589506","id":"12589506","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"body":"I was hoping to commit this today, but have a couple of Qs before do so:\r\n\r\n1) logconnections requires an argument \"{on|off}\" according to the usage text from NSC. Perhaps it would be better to keep DRDA_NoArgs.U for this case, and create a new DRDA_NoCommand.U message to handle the no-command-given case?\r\n\r\n2) I'm not very familiar with the DRDA spec - are the DRDA_ messages internal derby naming, or do they relate to the DRDA spec somehow? \r\n\r\n3) How do we handle updates to the other locale files?\r\n\r\n4) The proposed change in NetworkServerControl will break existing, but undocumented, feature as you say. I'm comfortable with this minor change, but would still like some experienced input before I commit. If it is OK, we would probably need a release note and mark for existing application impact?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"created":"2008-04-16T11:41:58.652+0000","updated":"2008-04-16T11:41:58.652+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12589646","id":"12589646","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Re 1) I think it's better to add a new message\r\n\r\nRe 2) I don't know about this...\r\n\r\nRe 3) The translations are done by whomever feels the need; thus, you don't have to do it - unless you feel capable. There's a big step between understanding a language and translating technical matter into a language. \r\nIf there is no text available for a specific error in the (current) locale's message files, English is displayed by default.\r\n\r\nRe 4) In principle, we'd prefer not to break existing functionality, however, in this case, there's essentially nothing happening; with or without error message - I have a hard time imagining someone relying on this behavior in an application. \r\nEven so I think it should get marked for existing application impact, and might as well add a release note to explain.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2008-04-16T16:53:59.144+0000","updated":"2008-04-16T16:53:59.144+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12589839","id":"12589839","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"body":"\r\nRe 1) Missing or wrong number of arguments are indicated by a different error message: DRDA_InvalidNoArgs.  I didn't see any other usage of DRDA_NoArgs.  But if this is dicy, we can keep the key and only change the text.  The specific information that a command was not given is more useful and correct, in my view, then just saying 'No arguments' -- especially when an option has been given\r\n\r\nRe 2) Sorry, don't know about this either but can look it up (when I'm back next week) unless someone who knows DRDA better has spoken to this.\r\n\r\nRe 3) I can add the german translation.  Might it be better then to remove the DRDA_NoArgs messages from the other languages in order to have them shown missing and translated?  It would be obvious when just introducing a new key DRDA_NoCommand.\r\n\r\nRe 4) Must have been a misunderstanding: There is no default command to NetworkServerControl, neither documented nor implemented; we won't break an existing feature or cause any incompatibilities.  But the code looks to me that there once was a default command, and I was wondering if there's an inclination to restore that (because the patch goes the other direction).\r\n\r\nMartin\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"created":"2008-04-17T06:39:09.314+0000","updated":"2008-04-17T06:39:09.314+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12589938","id":"12589938","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"body":"1), 2), 4) \r\nOk. I didn't look for another \"no args\" errormessage. DRDA_InvalidNoArgs.U covers my scenario, so I'm ok with changing DRDA_NoArgs.U to DRDA_NoCommand.U given 2) gives this to be derby internal naming. \r\n\r\n3) I wasn't expecting you to do all the translations Martin, and not before getting this commit'ed. Sorry if I lead you to think so - I was merely raising the question. Thanks to Myrna for answering.\r\n\r\nI'll commit this change tomorrow unless someone speaks up on the DRDA errormessage naming.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"created":"2008-04-17T10:30:04.856+0000","updated":"2008-04-17T10:30:04.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12589976","id":"12589976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"body":"FYI, I did a quick search of the DRDA spec doc, and was not able to find neither \"DRDA_InvalidNoArgs\" nor \"InvalidNoArg\" so my guess is that the naming is indeed internal derby names.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"created":"2008-04-17T11:24:14.366+0000","updated":"2008-04-17T11:24:14.366+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12590001","id":"12590001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thomas said:\r\n>FYI, I did a quick search of the DRDA spec doc, and was not able to find neither >\"DRDA_InvalidNoArgs\" nor \"InvalidNoArg\" so my guess is that the naming is indeed internal derby names.\r\n\r\nFrom what i recall, Thomas is correct.\r\n\r\nKathey\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-04-17T12:31:09.696+0000","updated":"2008-04-17T12:31:09.696+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12590300","id":"12590300","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"body":"Patch file DERBY-3542-1.diff committed at revision 649381","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"created":"2008-04-18T06:21:43.881+0000","updated":"2008-04-18T06:21:43.881+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12590407","id":"12590407","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"body":"Committed to 10.4 branch as revision 649472.\r\n\r\nUpdated fix version to reflect this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"created":"2008-04-18T11:54:30.847+0000","updated":"2008-04-18T11:54:30.847+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12590505","id":"12590505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I think this check in caused a regression in derbyall test derbyrunjartest, see: http://dbtg.thresher.com/derby/test/tinderbox_trunk16/jvm1.6/testing/Limited/testSummary-649382.html","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2008-04-18T16:32:08.221+0000","updated":"2008-04-18T16:32:08.221+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12590557","id":"12590557","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"body":"Sorry about not catching that :/\r\n\r\nMaster for derbyrunjartest needs updating to reflect changed output from NCS.\r\n\r\nAttached DERBY3543-master.diff changes this. I'll commit it later today.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"created":"2008-04-18T18:37:30.309+0000","updated":"2008-04-18T18:37:30.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12590689","id":"12590689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"body":"Regression fixed with DERBY3543-master.diff \r\n- comitted to trunk with revision 649775\r\n- merged to 10.4 with revision 649778","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thomanie","name":"thomanie","emailAddress":"thomas dot nielsen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thomas Nielsen","active":true},"created":"2008-04-19T09:27:46.042+0000","updated":"2008-04-19T09:27:46.042+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12391476/comment/12600663","id":"12600663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"body":"Fixed in revision 649775.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mzaun","name":"mzaun","emailAddress":"martin dot zaun at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Martin Zaun","active":true},"created":"2008-05-29T01:15:07.635+0000","updated":"2008-05-29T01:15:07.635+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3543/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i073hz:"}}