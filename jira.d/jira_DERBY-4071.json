{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12415595","self":"https://issues.apache.org/jira/rest/api/latest/issue/12415595","key":"DERBY-4071","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313401","id":"12313401","description":"Head of 10.4 branch","name":"10.4.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313771","id":"12313771","description":"build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09","name":"10.5.1.1","archived":false,"released":true,"releaseDate":"2009-04-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2009-02-25 16:56:07.358","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24007","customfield_12310222":"1_*:*_1_*:*_1899380877_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_15583839","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-03-19T15:45:45.877+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4071/watchers","watchCount":0,"isWatching":false},"created":"2009-02-25T16:09:25.162+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313142","id":"12313142","description":"","name":"10.3.3.0","archived":false,"released":true,"releaseDate":"2008-05-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12325208","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12325208","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12426302","key":"DERBY-4247","self":"https://issues.apache.org/jira/rest/api/2/issue/12426302","fields":{"summary":"Null pointer exception generated when preparing a statement containing \"IN (?)\" or \"= ?\", but not if using \"IN (?, ?)\" or enclosing the select query in another query.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12323671","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12323671","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12325311","key":"DERBY-681","self":"https://issues.apache.org/jira/rest/api/2/issue/12325311","fields":{"summary":"Eliminate the parser's rewriting of the abstract syntax tree for queries with GROUP BY and/or HAVING clauses","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12324947","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12324947","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12426302","key":"DERBY-4247","self":"https://issues.apache.org/jira/rest/api/2/issue/12426302","fields":{"summary":"Null pointer exception generated when preparing a statement containing \"IN (?)\" or \"= ?\", but not if using \"IN (?, ?)\" or enclosing the select query in another query.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-07-05T16:58:54.777+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"When running a complex query on this table:\r\n\r\n[code]\r\nCreate table DEMO.TEST (\r\n    CHR                            CHARACTER(26)                   ,\r\n    VCHR                           VARCHAR(25)                     )\r\n[code]\r\n\r\nthen I get this exception:\r\n\r\nAssertFailure: ASSERT FAILED col1.getClass() (class ...SQLChar) expected to be the same as col2.getClass() (class ....SQLVarchar)' was thrown while evaluating an expression.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10365","value":"Crash","id":"10365"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38022","summary":"AssertFailure when selecting rows from a table with CHARACTER and VARCHAR columns","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":31,"total":31,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12676688","id":"12676688","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Testcase which demonstrates the behavior","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-02-25T16:10:41.769+0000","updated":"2009-02-25T16:10:41.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12676689","id":"12676689","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"This is the query:\r\n\r\n[code]\r\nSELECT *\r\nFROM DEMO.TEST S\r\nWHERE S.VCHR IN (\r\n        SELECT   VCHR\r\n        FROM     DEMO.TEST\r\n        GROUP BY VCHR\r\n        HAVING   COUNT (VCHR) > 1 \r\n)\r\n  AND CHR NOT IN (\r\n        SELECT   MAX(CHR)\r\n        FROM     DEMO.TEST T\r\n        WHERE    S.VCHR = T.VCHR\r\n        GROUP BY T.VCHR\r\n        HAVING   COUNT(T.VCHR) > 1  \r\n)\r\n[code]\r\n\r\nWhen you swap the two columns, the errors goes away.\r\n\r\nMy problem: I'm using Derby to replicate a legacy DB2 database in my unit tests so I can create patches for an existing system. Therefore, I'd like to have a solution for Derby 10.4.2.0 instead of swapping the columns. Is there a chance for a quick fix?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-02-25T16:11:27.302+0000","updated":"2009-02-25T16:13:56.915+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12676705","id":"12676705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I'm not sure what you mean by \"swap the two columns\". Can you explain further?\r\n\r\nAlso, have you experimented with using CAST() to make the data type conversion more explicit?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-02-25T16:56:07.358+0000","updated":"2009-02-25T16:56:07.358+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12676736","id":"12676736","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"I mean: Make VCHR the first column and CHR the second. Just download the test case, copy it into your Derby project and run it. It contains a \"good\" case and a \"bad\" case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-02-25T18:43:27.360+0000","updated":"2009-02-25T18:43:27.360+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12676759","id":"12676759","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks, I see what you mean now.\r\n\r\nAnd, it fails for me, so thanks very much for the test case!\r\n\r\nI'm afraid I don't know what's wrong, though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-02-25T20:15:46.138+0000","updated":"2009-02-25T20:15:46.138+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12676912","id":"12676912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Good. :) Is it broken in 10.5, too?\r\n\r\nI've found another version that works:\r\n\r\n[code]\r\n        sql =   \"SELECT *\\r\\n\" + \r\n                \"FROM DEMO.TEST2 S\\r\\n\" + \r\n                \"WHERE S.VCHR IN (\\r\\n\" + \r\n                \"        SELECT   VCHR\\r\\n\" + \r\n                \"        FROM     DEMO.TEST2\\r\\n\" + \r\n                \"        GROUP BY VCHR\\r\\n\" + \r\n                \"        HAVING   COUNT (VCHR) > 1 \\r\\n\" + \r\n                \")\\r\\n\" + \r\n                \"  AND S.CHR NOT IN (\\r\\n\" + // Table S\r\n                \"        SELECT   MAX(T.CHR)\\r\\n\" +  // Table T\r\n                \"        FROM     DEMO.TEST2 T\\r\\n\" + \r\n                \"        WHERE    S.VCHR = T.VCHR\\r\\n\" + \r\n                \"        GROUP BY T.VCHR\\r\\n\" + \r\n                \"        HAVING   COUNT(T.VCHR) > 1  \\r\\n\" + \r\n                \")\";\r\n        i = dump (sql);\r\n        assertEquals (1, i);\r\n[code]\r\n\r\nChange: I prefix every CHR column with the table alias. It seems that Derby somehow mixes the columns in the second sub-SELECT.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-02-26T08:21:13.094+0000","updated":"2009-02-26T08:23:47.200+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12676916","id":"12676916","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Update: The quick fix doesn't work with my more complex real table. But it might get you on the right track.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-02-26T08:36:07.799+0000","updated":"2009-02-26T08:36:07.799+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12677993","id":"12677993","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"One possible \"quick fix\" may be to use the production jar files instead of the debug jar files, as the production jars don't have the assertions.\r\n\r\nI don't know if the assert failure exposes a bug or if it's just the assert that is too strict, but this comment indicates that the one who added the assert wasn't completely convinced that it was checking the right thing:\r\n\r\n\t/**\r\n\tCheck that the columns in the row agree with the columns\r\n\tin the template, both in number and in type.\r\n\t<p>\r\n\tXXX (nat) Currently checks that the classes implementing\r\n\teach column are the same -- is this right?\r\n\t**/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-03-02T14:23:03.813+0000","updated":"2009-03-02T14:23:03.813+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12678005","id":"12678005","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"In this case, I think it's unearthing something. If you look at my example, then I'm only comparing columns of the same type, so why is Derby comparing CHAR and VARCHAR internally? This looks like a column mixup.\r\n\r\nOr maybe the MAX() casts CHAR to VARCHAR? But why would it do that? Does it also cast INT to LONG? etc.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-03-02T15:05:46.220+0000","updated":"2009-03-02T15:05:46.220+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12678016","id":"12678016","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I suspect you're right Aaron, it's some sort of a column mixup. During compilation, Derby\r\nconverts table and column references from their string form in the SQL text into an\r\ninternal numeric form which represents columns as ordinal positions into number\r\nresult sets in the query plan. Some parts of this conversion are extremely tricky, and\r\nthere have been bugs in this area in the past.\r\n\r\nIn particular, I find it interesting that your queries reference an expression in the HAVING\r\nclause, and that expression does not also appear in the SELECT clause.\r\n\r\nDoes it change anything if you rewrite your query so that the HAVING expression also\r\nappears in the SELECT list? I think this might require you to introduce yet another level\r\nof sub-selects, so that you'd end up with something like:\r\n\r\n    AND CHR NOT IN ( select a from (\r\n        SELECT MAX(CHR) as a, count(t.vchr) as b\r\n        FROM DEMO.TEST T\r\n        WHERE S.VCHR = T.VCHR\r\n        GROUP BY T.VCHR\r\n        HAVING COUNT(T.VCHR) > 1 ) )\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-03-02T15:18:08.129+0000","updated":"2009-03-02T15:18:08.129+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12678671","id":"12678671","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"I tried that and I got lots of other, weird errors. I've extended the test case.\r\n\r\nFirst of all, you need to give the inner select a name or the SQL won't parse.\r\n\r\nAnd after giving it a name, I get an error because S.VCHR is no longer known in the inner select. The final fix is this:\r\n\r\nSELECT *\r\nFROM DEMO.TEST S\r\nWHERE S.VCHR IN (\r\n        SELECT   T1.VCHR\r\n        FROM     DEMO.TEST T1\r\n        GROUP BY T1.VCHR\r\n        HAVING   COUNT (T1.VCHR) > 1 \r\n)\r\n  AND S.CHR NOT IN ( select x.a from (\r\n        SELECT   MAX(T2.CHR) as a, COUNT(T2.VCHR) as b, T2.VCHR as c\r\n        FROM     DEMO.TEST T2\r\n        GROUP BY T2.VCHR\r\n        HAVING   COUNT(T2.VCHR) > 1  \r\n) as x WHERE    S.VCHR = x.c )\r\n\r\n... drumroll ... which fails with the same error.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-03-04T10:09:02.606+0000","updated":"2009-03-04T10:09:02.606+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12678673","id":"12678673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"New version of the test matching the comment \"Aaron Digulla - 04/Mar/09 02:09 AM\"","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-03-04T10:10:26.412+0000","updated":"2009-03-04T10:10:26.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12679825","id":"12679825","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I find I can reproduce with this simpler query:\r\n\r\n\"SELECT * FROM DEMO.TEST S \" + \r\n            \"WHERE CHR IN ( \" + \r\n            \"        SELECT MAX(CHR) \" + \r\n            \"        FROM DEMO.TEST T \" + \r\n            \"        WHERE S.VCHR = T.VCHR \" + \r\n            \"        GROUP BY T.VCHR \" + \r\n            \"        HAVING COUNT(T.VCHR) > 1 )\"\r\n\r\nI notice similarities with the erroneous mapArray index in DERBY-3880.\r\n\r\nThe ProjectRestrictResultSet under the GroupedAggregateResultSet\r\nshares the result colum of the ##aggregate expression for COUNT\r\nwith the GroupedAggregateResultSet: That RC contains a VirtualColumnNode\r\nwhich contains a column reference to the ##UnaggColumn (T.VCHR). When the\r\nmapArray is contructed it picks of the virtual column id of the ##UnaggColumn (1), which\r\nis wrong, since T.VCHR is column 2 in the underlying table.\r\n\r\nI upload a hack, trialPatch.diff, which makes the above sample work, to illustrate the issue.\r\nNot a solution, of course :)\r\n\r\nThe repro's method testAssertFailure doesn't crash now, although the\r\nresult assert fails: I do not get an empty result set, just looking\r\nquickly at the data I think the query should return a row.\r\n\r\nThe repro's test method testParsesButFails now fails with another error (ClassCastException).\r\n\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-07T04:22:31.355+0000","updated":"2009-03-07T19:25:59.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12679826","id":"12679826","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Link to relevant comment on DERBY-3880:\r\nhttps://issues.apache.org/jira/browse/DERBY-3880?focusedCommentId=12639647#action_12639647\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-07T04:28:36.526+0000","updated":"2009-03-07T04:28:36.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12679905","id":"12679905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I found I could simplify the query still further and get the error:\r\n\r\nSELECT MAX(CHR) FROM DEMO.TEST T \r\n    GROUP BY T.VCHR \r\n    HAVING COUNT(T.VCHR) > 1\r\n\r\nStack trace extract:\r\n.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147)\r\n.derby.impl.store.access.sort.MergeSort.checkColumnTypes(MergeSort.java:471)\r\n.derby.impl.store.access.sort.MergeInserter.insert(MergeInserter.java:98)\r\n.derby.impl.sql.execute.GroupedAggregateResultSet.loadSorter(GroupedAggregateResultSet.java:308)\r\n.derby.impl.sql.execute.GroupedAggregateResultSet.openCore(GroupedAggregateResultSet.java:180)\r\n.derby.impl.sql.execute.ProjectRestrictResultSet.openCore(ProjectRestrictResultSet.java:168)\r\n.derby.impl.sql.execute.BasicNoPutResultSetImpl.open(BasicNoPutResultSetImpl.java:245)\r\n.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)\r\n.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)\r\n.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)\r\n\r\nJust wanted to add a little more detail, my previous comment was too\r\nbrief, I was getting sleepy :)\r\n\r\nThe inputRow from the underlying ProjectRestrictResultSet has wrong\r\ntype for ##aggregate expression for the count aggregator: CHR in stead\r\nof VCHAR, due to the mapArray containing the wrong virtual column (1)\r\ninstead of 2, due to wrong contents in mapArray[2] used by\r\nProjectRestrictNode ca line 1422, to set up the referenced column\r\ndescriptor for runtime. This is picked up by ProjectRestrictResultSet,\r\nca line 107 with the call to getReferencedColumnPositions.\r\n\r\nThese two lines in ProjectRestrictNode:\r\n\r\n\t\t// Map the result columns to the source columns\r\n\t\tint[] mapArray = resultColumns.mapSourceColumns();\r\n\r\npick up the virtual column ids from ProjectRestrictNode#resultColumns.\r\nThe third of those (index 2), the ##aggregate expression for COUNT, is\r\nthe one I referred to in my previous post.\r\n\r\nIt seems it is the fact that the aggregator input expression (for COUNT) is also the column\r\nwe group by (a.k.a. ##UnaggColumn), which is the root of the problem here.. What do you think?\r\nThe group by rewriting is tricky..\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-07T19:18:01.219+0000","updated":"2009-03-07T19:18:01.219+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12679907","id":"12679907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The following works, so it seems the HAVING clause\r\nis needed for the problem to surface:\r\n\r\nSELECT MAX(CHR), COUNT(T.VCHR) FROM DEMO.TEST T \r\n     GROUP BY T.VCHR\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-07T19:34:35.856+0000","updated":"2009-03-07T19:34:35.856+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12679920","id":"12679920","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Great research, Dag! For the record, I ran some tests and found out that the assert failure first appeared when the fix for DERBY-681 went in.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-03-07T22:47:00.133+0000","updated":"2009-03-07T22:47:00.133+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12679927","id":"12679927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Marking as regression. Knut found that this was introduced with the fix for DERBY-681","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-03-07T23:46:51.824+0000","updated":"2009-03-07T23:46:51.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12680383","id":"12680383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I upload a patch, derby-4071, which solves the immediate problem, I\r\nthink. Running regressions now.\r\n\r\nIt contains a patch to GroupByNode as well as a new test case for\r\nGroupByTest.\r\n\r\nIt essentially defers the replacement of group by expressions in the\r\nhaving clause with pointers to the appropriate result column in the\r\ngroup by node. The replacement used to happen at the end of\r\nGroupByNode#addUnAggColumns. The patch moves substitution to after the\r\ncall to GroupByNode#addAggregateColumns has been performed. \r\n\r\nExplanation of the error\r\n-----------------------\r\n\r\nThe substitution is done by a SubstituteExpressionVisitor, which\r\nreplaces all occurences of the group by expression as described\r\nabove. In our case, however, this group by expression is an argument\r\nto an aggregate function, so the having clause contains an\r\nAggregateNode whose operand is the group by column. When the visitor\r\ngets there, the aggregate node's operand is replaced as described,\r\ncf. UnaryOperatorNode#accept (AggregateNode is a subclass).\r\n\r\nThere is a snag, however. This AggregateNode is aliased by the\r\naggregateNode we find in GroupByNode#aggregateVector. And we are not\r\ndone with using the information in aggregateVector yet when\r\naddUnAggColumns has run.\r\n\r\nNotably, in addAggregateColumns, the information on the aggregates are\r\nneeded, and the substitution described above gets in the way:\r\n\r\nWhen constructing the aggregate expression (input) columns, there is a\r\ncall to \r\n\r\n     aggregate.getNewExpressionResultColumn(dd)\r\n\r\nThis uses the operand field of the AggregateNode, whose value has just\r\nbeen replaced for the purposes of the having clause. So, we end up\r\nwith a result column for aggregate expression which is wrong. The \r\nresult column list of GroupByNode ends up looking like this:\r\n\r\nRCL (result column list) \r\n   [0]: #UnaggColumn (the group by column)\r\n      \\\r\n       CR\r\n        \\\r\n        RC\r\n          \\\r\n          VCN\r\n            \\\r\n            RC (basetable)\r\n           \r\n\r\n   [1]: ##aggregate result\r\n   [2]: ##aggregate expression\r\n      \\\r\n      CR\r\n       \\\r\n       RC\r\n         \\\r\n         VCN\r\n           \\\r\n           RCL[0] above, *error* That is, the RC of the group by node!\r\n\r\n   [3]: aggregator\r\n\r\n\r\nIf things were OK we would expect to see:\r\n\r\n\r\nRCL\r\n   [0]: #UnaggColumn (the group by column)\r\n       \\\r\n        :\r\n   [1]: ##aggregate result\r\n   [2]: ##aggregate expression\r\n      \\\r\n      CR\r\n       \\\r\n       RC (underlying ProjectRestrict)\r\n         \\\r\n         CR         \r\n           \\\r\n           RC (bottom ProjectRestrict)\r\n            \\\r\n            VCN \r\n              \\\r\n              RC (basetable)\r\n   [3]: aggregator\r\n\r\nIn the the underlying ProjectRestrictNode, which needs to set up the\r\nmapArray to locate the correct column in the underlying base\r\ntable, this creates havoc:\r\n\r\nThe underlying PRN calls RCL.mapSourceColumns for every RC in the\r\nProjectRestrictNode's RCL (strip off a CR-RC level from GroupByNode's\r\nRCL to picture ProjectRestrictNode's RCL).\r\n\r\nmapSourceColumns extracts the virtual column id from a CR or a VCN. For\r\ncolumn 2 of the underlying ProjectRestrictNode, it sees\r\n\r\n      [2]:\r\n         \\\r\n         VCN\r\n           \\\r\n           RCL[0]\r\n\r\nand there it finds the virtual column number of 1, where we should\r\nhave seen:\r\n\r\n      [2]:\r\n         \\\r\n         CR         \r\n           \\\r\n           RC\r\n            \\\r\n            VCN\r\n              \\\r\n              RC (basetable)\r\n\r\nand found the virtual column number 2. \r\n\r\nWith the patch, the RCLs end up as expected and the repro works.\r\n\r\nSince the substitution \"damages\" the AggregateNode in the\r\naggregateVector, it struck me that any later usage might also be\r\naffected, even with the patch. The aggregateVector is actually being\r\nused again later, in considerPostOptimizeOptimizations. However, that\r\ncode only runs if there is no explicit group by, and max 1 aggregate\r\nfunction which must be max/min, so I am not sure if this would ever be\r\nan issue. And if so, it would only bar an optimization, not give a\r\nwrong result...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-10T05:52:15.822+0000","updated":"2009-03-10T05:52:15.822+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12680464","id":"12680464","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Thanks for the patch! I've successfully applied it to the official 10.4.2.0 release (only the GroupByNode.java; the tests fail) and my application works now!\r\n\r\nDo I have to close this bug as resolved?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-03-10T13:54:59.471+0000","updated":"2009-03-10T13:55:56.500+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12680475","id":"12680475","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Normally the developer resolves the issue when he/she, or the community, feels that the issue has been properly addressed.\r\nThen the reporter should verify the fix and close the issue if the problem is no longer seen.\r\nThis isn't a strict process, but what happens most of the time.\r\n\r\nAs far as I understand, you have already verified that the patch fixes the problem you experienced, but I'm not sure if Dag is done working on this issue yet. The code hasn't been committed to neither the trunk nor the 10.4 branch.\r\nMy opinion is that it is a little early to declare victory, but your feedback on the patch is very welcome and may speed up the process :)\r\n\r\nThank you for taking the time to report bugs and testing out patches!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-03-10T14:36:10.494+0000","updated":"2009-03-10T14:36:10.494+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12680519","id":"12680519","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Regressions passed; please review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-10T15:55:51.309+0000","updated":"2009-03-10T15:55:51.309+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12680520","id":"12680520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for testing the patch, Aaron! Glad it works for 10.4.2 branch also, I didn't get to test that yet.\r\nI will probably back-port the final patch  to the 10.4 branch also.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-10T15:59:44.768+0000","updated":"2009-03-10T15:59:44.768+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12680529","id":"12680529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Dag, thanks for the very thorough writeup and notes. Your analysis makes a lot of sense to me.\r\n\r\nI'm wondering: with your patch, do we still need the DERBY-3880 patch? That is,\r\nwhat happens if you apply your patch, and *undo* the DERBY-3880 patch? Do the\r\nDERBY-4071 and DERBY-3880 test cases then pass? Or do we actually need both\r\npatches to get the column references in the HAVING clause expressions to be\r\nmapped correctly?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2009-03-10T16:36:37.323+0000","updated":"2009-03-10T16:36:37.323+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12680544","id":"12680544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks for looking at the patch, Bryan! The DERBY-3880 patch is still needed, I find;\r\nwithout it the test case testHavingWithInnerJoinDerby3880 starts failing again.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-10T17:31:01.880+0000","updated":"2009-03-10T17:31:01.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12680710","id":"12680710","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I have read through DERBY-3880 and also DERBY-3094 and managed to convince myself\r\nthat the current issue is related but separate, for what it's worth. Thanks for the suggestion, Bryan.\r\nI wish I had read both those issues (nice write-ups!) better before undertaking this one :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-11T00:44:04.017+0000","updated":"2009-03-11T00:44:04.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12682115","id":"12682115","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed this patch as svn 754579 on trunk.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-15T01:31:40.054+0000","updated":"2009-03-15T01:31:40.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12683491","id":"12683491","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed derby-4071-10_4 to the 10.4 branch as svn 756052 (It is a simple merge,\r\nbut the svn merge command didn't give a clean result this time, so I upload an explicit patch),\r\nresolving.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-19T15:44:07.468+0000","updated":"2009-03-19T15:44:07.468+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12683492","id":"12683492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Fixed on 10.4, 10.5 and trunk, so resolving. Aaron, feel free to close the issue now.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-03-19T15:45:45.816+0000","updated":"2009-03-19T15:45:45.816+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12683594","id":"12683594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"body":"Thanks again for the quick fix!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=digulla","name":"digulla","emailAddress":"digulla at hepe dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aaron Digulla","active":true},"created":"2009-03-19T20:05:29.661+0000","updated":"2009-03-19T20:05:29.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12415595/comment/12780834","id":"12780834","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"This bug is also seen in 10.3 (feel free to reopen and backport if desired).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-11-20T23:33:02.079+0000","updated":"2009-11-20T23:33:02.079+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4071/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06ven:"}}