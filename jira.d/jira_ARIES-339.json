{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12467037","self":"https://issues.apache.org/jira/rest/api/latest/issue/12467037","key":"ARIES-339","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314941","id":"12314941","description":"","name":"0.2","archived":true,"released":true,"releaseDate":"2010-09-06"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-06-16 01:23:43.336","customfield_12312323":null,"customfield_12310420":"93951","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_62964649_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-06-16T15:14:04.925+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-339/watchers","watchCount":0,"isWatching":false},"created":"2010-06-15T21:44:40.276+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314941","id":"12314941","description":"","name":"0.2","archived":true,"released":true,"releaseDate":"2010-09-06"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-06-16T15:14:04.913+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313100","id":"12313100","name":"JMX"}],"timeoriginalestimate":null,"description":"1. There's a method annotated with @Before in the abstract test class. Most concrete test classes also have methods annotated with @Before which inside their body also call the the setUp() method from the abstract class. During a build both methods (the one from the abstract class and the one from the concrete one) are called and the one from the subclass is called first :|. This method  setups mbean server and then checks if required mbeans have been registered. After it completes, the the setUp() method from the super class is called directly. It creates a new mbean server - overrides the previous one. The new one is not prepared to be used inside the test method as mbeans haven't been registered yet and there's no code that would wait for those mbeans to be registered. This causes an exception to be thrown in various tests and build to fail. Example:\r\n\r\njava.lang.reflect.InvocationTargetException\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat org.ops4j.pax.exam.rbc.internal.RemoteBundleContextImpl.remoteCall(RemoteBundleContextImpl.java:80)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:305)\r\n\tat sun.rmi.transport.Transport$1.run(Transport.java:159)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat sun.rmi.transport.Transport.serviceCall(Transport.java:155)\r\n\tat sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:535)\r\n\tat sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:790)\r\n\tat sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:649)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n\tat java.lang.Thread.run(Thread.java:619)\r\nCaused by: java.lang.reflect.InvocationTargetException\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n\tat java.lang.reflect.Method.invoke(Method.java:597)\r\n\tat org.ops4j.pax.exam.junit.extender.impl.internal.CallableTestMethodImpl.injectContextAndInvoke(CallableTestMethodImpl.java:134)\r\n\tat org.ops4j.pax.exam.junit.extender.impl.internal.CallableTestMethodImpl.call(CallableTestMethodImpl.java:101)\r\n\t... 19 more\r\nCaused by: java.lang.reflect.UndeclaredThrowableException\r\n\tat $Proxy8.getExportedPackages(Unknown Source)\r\n\tat org.apache.aries.jmx.framework.BundleStateMBeanTest.testMBeanInterface(BundleStateMBeanTest.java:153)\r\n\t... 25 more\r\nCaused by: javax.management.InstanceNotFoundException: osgi.core:type=bundleState,version=1.5\r\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1094)\r\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:833)\r\n\tat com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:761)\r\n\tat javax.management.MBeanServerInvocationHandler.invoke(MBeanServerInvocationHandler.java:288)\r\n\t... 27 more\r\n\r\n2. FrameworkMBeanTest does not wait for the FrameworkMBean at all.\r\n\r\n3. Tests wait 5 seconds for mbeans to be registered. This is often not sufficient enough.\r\n\r\n4. Some other minor changes are required.\r\n\r\nA patch coming soon. \r\n\r\nUnfortunately, the list of JMX itests issues provided above is not complete. Additional experiments need to be carried out and some other fixes will probably be required.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"167593","summary":"Aries builds fail due to incorrectly working setUp() methods in JMX itests","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bartosz","name":"bartosz","emailAddress":"Kowalewski dot Bartosz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bartosz Kowalewski","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bartosz","name":"bartosz","emailAddress":"Kowalewski dot Bartosz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bartosz Kowalewski","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":4,"total":4,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467037/comment/12879133","id":"12879133","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bartosz","name":"bartosz","emailAddress":"Kowalewski dot Bartosz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bartosz Kowalewski","active":true},"body":"Attaching a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bartosz","name":"bartosz","emailAddress":"Kowalewski dot Bartosz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bartosz Kowalewski","active":true},"created":"2010-06-15T21:57:27.282+0000","updated":"2010-06-15T21:57:27.282+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467037/comment/12879222","id":"12879222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"body":"Committed your patch with some additional modifications in revision 955108. Let me know if I missed something. Thanks again for your patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"created":"2010-06-16T01:23:43.336+0000","updated":"2010-06-16T01:23:43.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467037/comment/12879350","id":"12879350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bartosz","name":"bartosz","emailAddress":"Kowalewski dot Bartosz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bartosz Kowalewski","active":true},"body":"Hi Jarek,\r\n\r\nIt looks good. \r\n\r\nSorry for not removing the nice example of copy/paste pattern :-).\r\n\r\nThanks,\r\n  Bartek","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bartosz","name":"bartosz","emailAddress":"Kowalewski dot Bartosz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bartosz Kowalewski","active":true},"created":"2010-06-16T14:31:19.242+0000","updated":"2010-06-16T14:31:19.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12467037/comment/12879359","id":"12879359","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"body":"Great! No problem. Thanks again for the patches.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gawor%40mcs.anl.gov","name":"gawor@mcs.anl.gov","emailAddress":"gawor at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jarek Gawor","active":true},"created":"2010-06-16T15:14:04.889+0000","updated":"2010-06-16T15:14:04.889+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-339/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0t1r3:"}}