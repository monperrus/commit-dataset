{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12520216","self":"https://issues.apache.org/jira/rest/api/latest/issue/12520216","key":"ARIES-736","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12332801","id":"12332801","name":"jpa-2.1.0","archived":false,"released":true,"releaseDate":"2015-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2011-08-26 09:37:06.832","customfield_12312323":null,"customfield_12310420":"63262","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_351567596_*|*_3_*:*_1_*:*_122429461677_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2015-07-17T08:20:59.435+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-736/watchers","watchCount":2,"isWatching":false},"created":"2011-08-26T06:30:30.239+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"0.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315310","id":"12315310","description":"","name":"0.3","archived":true,"released":true,"releaseDate":"2011-02-08"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris%40die-schneider.net","name":"chris@die-schneider.net","emailAddress":"chris at die-schneider dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chris%40die-schneider.net&avatarId=10355","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chris%40die-schneider.net&avatarId=10355","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chris%40die-schneider.net&avatarId=10355","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chris%40die-schneider.net&avatarId=10355"},"displayName":"Christian Schneider","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-07-17T08:22:17.069+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313176","id":"12313176","name":"JPA","description":"RFC 143 JPA Integration"}],"timeoriginalestimate":null,"description":"The OSGi spec states (r4.2 127.3.1):\r\n\"Entity Manager Factory service - Provides an EntityManagerFactory object that depends on a complete\r\nPersistence Unit. That is, it is associated with a registered Data Source Factory service.\"\r\n\r\nThe current behaiviour is, that aries registers a Entity Manager Factory service regardles of the precence of a matching Data Source Factory service (Also see 127.5.3 Data Source Factory Service Matching).\r\nIf no such matching is performed, it alternateively must register a Entity Manager Factory Builder service (not currently supported by Aries see ARIES-735 for reference).\r\n\r\nWhat infact is unclear to me is:\r\n127.5.3 states that: \"Once the Data Source Factory is obtained, the JPA Provider must obtain a DataSource object. This\r\nData Source object must then be used for all relational database access.\"\r\nIt does not state how this DataSource could be handed over to the PersistenceProvider for later usage.\r\n\r\nIt might be suitable to insert a level of indirection here:\r\n- Aries just reads the persitence units and registers an Entity Manager Factory Builder service\r\n- PersistencProvider specific bundles match these with the required data source and register the Entity Manager Factory service\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"166249","summary":"Aries does not take into account the concept of complete/incomplete Persistence Units","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=laeubi","name":"laeubi","emailAddress":"mail at laeubi-soft dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Christoph Läubrich","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=laeubi","name":"laeubi","emailAddress":"mail at laeubi-soft dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Christoph Läubrich","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":3,"total":3,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520216/comment/13091693","id":"13091693","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"body":"As for ARIES-735:\r\n\r\n---------------\r\nThe Aries JPA container is not actually an implementation of the OSGi JPA Service specification. It provides managed JPA, not the unmanged support described in the spec. Part of providing this managed support means that the persistence unit lifecycle in Aries does not really fit with the concept of the EntityManagerFactoryBuilder, or with incomplete persistence units.\r\n\r\nEffectively this support is intentionally missing from Aries because implementing it would prevent us from providing container-managed JPA. As Aries is trying to provide a container-managed programming model this would be a significant issue. I'm happy to look again into whether providing an EntityManagerFactoryBuilder is technically feasible, but as we still won't attempt to pass the current JPA service specification I don't know if providing it would actually help you.\r\n---------------\r\n\r\nThe reasoning for not linking with Data Source Factory services is that for managed JPA one uses managed resources. In the JPA spec (the Java one, not the OSGi one) this is done through JNDI using the <jta-data-source> and <non-jta-data-source> elements. As a result this is also what the Aries container uses. The Aries container offers no integration with the JDBC service, though this could theoretically be added (hopefully without further complicating the lifecycle of the EntityManagerFactory services).\r\n\r\nOne question I do have is the following - How should the Aries container decide when to wait for a DataSourceFactory service rather than passing the JDBC properties on to the persistence provider? It is entirely possible that the user has packaged their JDBC driver along with the persistence unit and does not want to use the JDBC service, just to load the classes as in the JPA spec (again, the Java one).\r\n\r\n\r\nTim","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=timothyjward","name":"timothyjward","emailAddress":"timothyjward at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Timothy Ward","active":true},"created":"2011-08-26T09:37:06.832+0000","updated":"2011-08-26T09:37:26.277+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520216/comment/13091719","id":"13091719","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=laeubi","name":"laeubi","emailAddress":"mail at laeubi-soft dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Christoph Läubrich","active":true},"body":"Okay, I understand the Problem, thanks for your fast reply.\r\nI was not aware about the fact that Aries JPA is not \"OSGi-JPA\" compilant, because it refers to the spec on the modules project page.\r\nAlso I was not aware that the concept of incomplete persitence units where bound to the unmanaged part of the spec.\r\n\r\nI think you can either close this bug or change it to a \"new feature\" one :)\r\n\r\n> How should the Aries container decide when to wait for a DataSourceFactory service rather than passing\r\n> the JDBC properties on to the persistence provider?\r\nAs mentioned above IMO there is a level of indirection needed for this case.\r\nCase 1) There is a PersistenceProvider registered in the system and the persitence unit is not bound or bound to this specific provider the current aproach would fit (and won't break backward compatibility)\r\nCase 2) There is no (or no matching) PersitenceProvider registered in the system, but a suitable DataSourceFactory, then a DataSource Object is obtained from this factory using the JDBC properties of the persistence unit and passed to a Service in the OSGi system implementing for example the following interface:\r\n\r\npublic interface PersistenceProviderBinder {\r\n  /**\r\n * @return a PersistenceProvider bound to this DataSource or <code>null</code> if binding failed\r\n */\r\n  PersistenceProvider bindProvider(DataSource source, Map<?, ?> properties);\r\n}\r\n\r\nAries the could try each service providing this interface and the first which matches wins, and register the returned PersitenceProvider as \"bound to this DataSourceFactory\".\r\nOf course, as soon as the DataSourceFactory becomes unavaiable it shoudl unregister and close the PersistenceProvider.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=laeubi","name":"laeubi","emailAddress":"mail at laeubi-soft dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10443","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10443","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10443","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10443"},"displayName":"Christoph Läubrich","active":true},"created":"2011-08-26T11:39:25.226+0000","updated":"2011-08-26T11:39:25.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12520216/comment/14630979","id":"14630979","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris%40die-schneider.net","name":"chris@die-schneider.net","emailAddress":"chris at die-schneider dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chris%40die-schneider.net&avatarId=10355","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chris%40die-schneider.net&avatarId=10355","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chris%40die-schneider.net&avatarId=10355","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chris%40die-schneider.net&avatarId=10355"},"displayName":"Christian Schneider","active":true},"body":"Since version 2.0.0 Aries JPA also supports creating an EntityManagerFactoryBuilder. See test\r\norg.apache.aries.jpa.container.itest.EclipseAdditionalTest","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chris%40die-schneider.net","name":"chris@die-schneider.net","emailAddress":"chris at die-schneider dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=chris%40die-schneider.net&avatarId=10355","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=chris%40die-schneider.net&avatarId=10355","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=chris%40die-schneider.net&avatarId=10355","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=chris%40die-schneider.net&avatarId=10355"},"displayName":"Christian Schneider","active":true},"created":"2015-07-17T08:20:59.475+0000","updated":"2015-07-17T08:20:59.475+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-736/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0stgf:"}}