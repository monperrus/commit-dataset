{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12374471","self":"https://issues.apache.org/jira/rest/api/latest/issue/12374471","key":"DERBY-2972","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-08-17 14:58:03.568","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23353","customfield_12310222":"1_*:*_1_*:*_4498137465_*|*_6_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-09-14T17:36:09.020+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2972/watchers","watchCount":0,"isWatching":false},"created":"2007-07-24T16:07:11.555+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12316916","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12316916","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12369433","key":"DERBY-2656","self":"https://issues.apache.org/jira/rest/api/2/issue/12369433","fields":{"summary":"Run suites.All against a collated database","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-09-14T17:36:09.000+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"The following update fails with ERROR 42818\nij> update testing set a = PADSTRING('aa',2024) where a = PADSTRING('a',2024);\nERROR 42818: Comparisons between 'VARCHAR' and 'VARCHAR' are not supported.\n\nSee full script below \nonnect 'jdbc:derby:nordb;territory=no_NO;collation=TERRITORY_BASED';\n\nCREATE FUNCTION  PADSTRING (DATA VARCHAR(32000), LENGTH INTEGER) RETURNS VARCHAR(32000) EXTERNAL NAME 'org.apache.derbyTesting.functionTests.util.Formatters.padString' LANGUAGE JAVA PARAMETER STYLE JAVA;\n\ncreate table testing \n\t(a varchar(2024), b varchar(1024), c varchar(1024), d varchar(2048), e varchar(300)) ;\n\n-- insert 9 rows into the table\ninsert into testing values (PADSTRING('1',2024),  PADSTRING('2',1024), \n       PADSTRING('3',1024), PADSTRING('4',2048),  PADSTRING('5',300));\n\ninsert into testing values (PADSTRING('10',2024),  \n       PADSTRING('20',1024), PADSTRING('30',1024), \n       PADSTRING('40',2048), PADSTRING('50',300));\n\ninsert into testing values (PADSTRING('100',2024),  \n       PADSTRING('200',1024), PADSTRING('300',1024), \n       PADSTRING('400',2048), PADSTRING('500',300));\n\ninsert into testing values (PADSTRING('1000',2024),  \n       PADSTRING('2000',1024), PADSTRING('3000',1024), \n       PADSTRING('4000',2048), PADSTRING('5000',300));\n\ninsert into testing values (PADSTRING('10000',2024),  \n       PADSTRING('20000',1024),\tPADSTRING('30000',1024), \n       PADSTRING('40000',2048), PADSTRING('50000',300));\n\ninsert into testing values (PADSTRING('100000',2024), \n       PADSTRING('200000',1024), PADSTRING('300000',1024), \n       PADSTRING('400000',2048), PADSTRING('500000',300));\n\ninsert into testing values (PADSTRING('1000000',2024), \n       PADSTRING('2000000',1024), PADSTRING('3000000',1024), \n       PADSTRING('4000000',2048), PADSTRING('5000000',300));\n\ninsert into testing values (PADSTRING('10000000',2024), \n       PADSTRING('20000000',1024), PADSTRING('30000000',1024), \n       PADSTRING('40000000',2048), PADSTRING('50000000',300));\n\ninsert into testing values (PADSTRING('100000000',2024), \n       PADSTRING('200000000',1024), PADSTRING('300000000',1024), \n       PADSTRING('400000000',2048), PADSTRING('500000000',300));\n\nupdate testing set a = PADSTRING('aa',2024) where a = PADSTRING('a',2024);\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39826","summary":"Update or select with function in the where clause causes with TERRITORY_BASED collation fails with ERROR 42818: Comparisons between 'VARCHAR' and 'VARCHAR' are not supported.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":30,"total":30,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12515015","id":"12515015","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"This issue was found during collation testing DERBY-2656\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-07-24T16:08:28.613+0000","updated":"2007-07-24T16:08:28.613+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12515025","id":"12515025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"This is also an issue with selects \r\nij> select b, e from testing where e = PADSTRING('e',300);\r\nERROR 42818: Comparisons between 'VARCHAR' and 'VARCHAR' are not supported.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-07-24T16:45:33.486+0000","updated":"2007-07-24T16:45:33.486+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12520398","id":"12520398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"According to http://wiki.apache.org/db-derby/BuiltInLanguageBasedOrderingDERBY-1478:\r\n\r\n7)For user defined functions' that return character string type, the return type's collation will have the same collation as of the character set of the schema that the function is defined in. The collation derivation will be implicit.\r\n\r\nso there must be something awry in setting that collation.  Builtin functions such as TRIM work fine.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-08-16T22:45:49.260+0000","updated":"2007-08-16T22:45:49.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12520577","id":"12520577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Built-in function TRIM is implemented in it's own compile time node(TernaryOperatorNode) and hence it was very easy to set correct collation setting on it.\r\n\r\nThe processing for user-defined function involve lots of compile time nodes in Derby and they all need to be taken into consideration  when someone works on this Jira entry. I haven't looked at this jira entry enough to provide more info.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-08-17T14:58:03.568+0000","updated":"2007-08-17T14:58:03.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524215","id":"12524215","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is an initial patch for this issue.  It sets collation in JavaToSQLValueNode.java for string types to that of the current schema.  It fixes the cases outlined in this issue, but according to Mamta there may be more places that need to be changed.  \r\n\r\nThe patch also adds tests for function comparisons and order by expression to CollationTest.\r\n\r\nMamta, could you review this patch? Also if you know of other cases that might fail with functions please let me know. I am trying to think of some, but haven't come up with any yet.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-08-31T23:05:12.818+0000","updated":"2007-08-31T23:05:12.818+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524221","id":"12524221","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Kathey> \"It sets collation in JavaToSQLValueNode.java for string types to that of the current schema. \"\r\n\r\nThat doesn't seem to match the rule 7 from the DERBY-1478 wiki page that you quoted in an earlier comment??","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-08-31T23:30:22.333+0000","updated":"2007-08-31T23:30:22.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524223","id":"12524223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Oops, let me have another go at it.  Ignore the previous patch.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-08-31T23:38:00.783+0000","updated":"2007-08-31T23:38:00.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524764","id":"12524764","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am having trouble finding this rule (From the wiki page) in the SQL Spec.  Can someone point me to the section where this is defined?\r\n\r\n7)For user defined functions' that return character string type, the return type's collation will have the same collation as of the character set of the schema that the function is defined in. The collation derivation will be implicit.\r\n\r\nThanks \r\n\r\nKathey\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-04T15:45:14.230+0000","updated":"2007-09-04T15:45:14.230+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524811","id":"12524811","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey, the SQL spec does not have specific blurb about user defined functions and collations. But applying Section 6.1, syntax rules 3b) and 16) for character string types (which is where user defined functions with return type of character string type fall into), the collation type of return of user defined functions is implementation defined. \r\n\r\nIn the thread titled \"some comments on collation wiki page\", if you got Dan's comment http://www.nabble.com/Re%3A-some-comments-on-collation-wiki-page-p9813465.html and then my comment http://www.nabble.com/Re%3A-some-comments-on-collation-wiki-page-p9815841.html, that is where we decided Derby's implementation behavior for user defined functions to be to pick up the collation of the schema in which the function is defined. Hope this helps provide a background info for you.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-09-04T18:19:36.215+0000","updated":"2007-09-04T18:19:36.215+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524815","id":"12524815","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey, you probably know this already, but RoutineAliasInfo  for user defined functions has collation info about function's return type and parameters. The work for RoutineAliasInfo changes went in as part of DERBY-2723. DERBY-2723 was created to make sure that we save correct collation info into the system table for user defined functions. \r\n\r\nI could be wrong because I have not done much research myself, but because there are quite a few compile time nodes involved for user defined functions, I thought we would need changes in handful of compile time nodes to make sure that the collation info from RoutineAliasInfo gets propogated all the way to bind and generate time.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-09-04T18:25:32.328+0000","updated":"2007-09-04T18:25:32.328+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524817","id":"12524817","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Right, \"rule\" 7) in the wiki page is an instance of rule 3) on the same page.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-09-04T18:31:39.715+0000","updated":"2007-09-04T18:31:39.715+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524849","id":"12524849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Dan said:\r\n>, \"rule\" 7) in the wiki page is an instance of rule 3) on the same page.\r\nRule 3 says:\r\n\r\n>We define Derby's implementation-defined character set for such <character string type> to be current >compilation schema's character set. The collation derivation will be implicit.\r\n\r\nShouldn't it then follow that that functions shouldn't it follow that functions should use the current compilation schema as well?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-04T20:07:11.098+0000","updated":"2007-09-04T20:07:11.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524859","id":"12524859","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Sorry, mis-read rule 3 on the wiki page. I think rule 3 on the wiki page would be clearer if it explicit stated Derby's implementation defined rules for when a character string type is not contained in a column definition. As you point out Kathey, the text in 3 does not obviously match a function's definition, though it does if the current compilation schema is taken as the schema the routine is defined in (which I think would be the case when SQL routines are supported).\r\n\r\nDerby's implementation rules might be:\r\n\r\n For a character string type in a routine definition, the collation type will be that of the schema the routine is defined in and derivation will be implicit.\r\n\r\n For a character string type in a CAST expression, the the collation type will be that of the current compilation schema and derivation will be implicit.\r\n\r\n Any other uses of character type definitions??\r\n\r\n \r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-09-04T20:24:04.497+0000","updated":"2007-09-04T20:24:04.497+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524878","id":"12524878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Following are all the bullet items from wiki page http://wiki.apache.org/db-derby/BuiltInLanguageBasedOrderingDERBY-1478 that specifies Derby specific implementation rules (ie where the SQL spec allows the implementation to choose it's own behavior)\r\n1)String literal (specific instance of rule 3)\r\n3)Generic rule for character string type (pickup collation from current compilation schema)\r\n4)CAST (specific instance of rule 3)\r\n6)XMLSERIALIZE, CHAR and VARCHAR functions (specific instance of rule 3)\r\n7)user defined functions (pickup collation from schema where the function is defined)\r\n8)JDBC parameters (pickup collation from context)\r\n10)CURRENT ISOLATION, CURRENT SCHEMA and CURRENT SQLID (pickup collation of character set SQL_IDENTIFIER)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-09-04T21:26:32.331+0000","updated":"2007-09-04T21:26:32.331+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524881","id":"12524881","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Why did we choose to not have the functions follow rule three and use the current compilation schema?\r\nIt seems like that would be a lot clearer to users because they would not have to use casts for literal comparisons to functions because the collation for both would match the current compilation schema,\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-04T21:36:17.647+0000","updated":"2007-09-04T21:36:17.647+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524882","id":"12524882","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Rule 3 on the wiki page is only about situations where a data type definition is explicitly used, like CHAR(10), VARCHAR(10) etc.\r\nSo String literal is not a specific instance of rule 3.\r\n\r\nFrom the list in the last comment, the only additional one is XMLSERIALIZE, leading to\r\n\r\nRoutine definition\r\nXMLSERIALIZE\r\nCAST\r\n\r\nbeing the only implementation defined instances of rule 3.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-09-04T21:37:41.624+0000","updated":"2007-09-04T21:37:41.624+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12524983","id":"12524983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey asked \"Why did we choose to not have the functions follow rule three and use the current compilation schema? \" \r\n\r\nI have copied following from the thread at http://www.nabble.com/Re%3A-some-comments-on-collation-wiki-page-p9815841.html where the decision for function's collation was made. I guess the question at that time was that if we chose current compilation schema, what compilation schema should be picked up ie the current compilation schema when the function is getting defined or the current compilation when the function is getting executed. Based on that, to avoid confusion, decision was made to use the collation of the schema in which the function is defined. \r\n\r\n*******************************************************************************************************************\r\nThe character set of the schema the function is defined in. That keeps it least confusing and easier for the users to understand. \r\nMamta\r\n\r\n On 4/3/07, Daniel John Debrunner <djd@...> wrote: \r\n\r\nhttp://wiki.apache.org/db-derby/BuiltInLanguageBasedOrderingDERBY-1478 \r\n\r\n> 7)For user defined functions' that return character string type, the return type's collation\r\n> will have the same collation as current schema's character set.\r\n\r\nThe \"current schema's\" character set, or the character set of the schema \r\nthe function is defined in? And if it's the current schema, is it\r\ncurrent at function definition time, or current when used?\r\n\r\nDan.\r\n\r\n*******************************************************************************************************************\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-09-05T05:24:49.464+0000","updated":"2007-09-05T05:24:49.464+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12525169","id":"12525169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think that matching the collation of the compilation schema of the executing statement would be easiest for users to understand, because it would match the behavour of string literals and system functions would ve much more likely to work. For example the statement below would execute fine regardless of current schema if we use the compilation schema of the executing statement (as in the attached patch).  If we use the compilation schema of the system schema the user would have to almost always cast the result of system functions.\r\n\r\nVALUES case WHEN SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY('derby.stream.error.logSeverityLevel') = '50000'  THEN 'LOG SHUT\r\nDOWN  ERRORS'\r\nWHEN SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY('derby.stream.error.logSeverityLevel') = '40000' THEN 'SHOW CONN CLOSE ERROR\r\nS'\r\nWHEN SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY('derby.stream.error.logSeverityLevel') = '30000' THEN 'SHOW XACT ROLLBACK ER\r\nRORS'\r\nWHEN SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY('derby.stream.error.logSeverityLevel') = '20000' THEN 'SHOW STMT  ROLLBACK E\r\nRRORS'\r\nWHEN SYSCS_UTIL.SYSCS_GET_DATABASE_PROPERTY('derby.stream.error.logSeverityLevel') = '0' THEN 'SHOW ALL  ERRORS' ELSE 'D\r\nONT KNOW' END;\r\n1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-05T18:04:11.864+0000","updated":"2007-09-05T18:04:11.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12525196","id":"12525196","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey, I can see where you suggestion is coming from when I look at the examples that you provided. But I also feel that when something comes from a specific schema, which in these examples is SYSCS_UTIL, it seems like it should get collation of that schema. This is similar to character columns coming from system schema vs user schema. String literals do not belong to any schema and hence it's seems reasonable to have them take the collation for the current compilation schema. But for stored objects, like user-defined functions, columns belonging to tables, it seems like they should take the collation of their schema.\r\n\r\nI am on the border line on this issue and would be willing to go either way. I wonder if anyone else in the community thinks strongly one way or the other.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-09-05T19:49:07.059+0000","updated":"2007-09-05T19:49:07.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12525465","id":"12525465","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey, I thought more about this issue since yesterday and I believe now that functions should get their collation from their schema because they are stored objects similar to a column. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-09-06T17:07:55.612+0000","updated":"2007-09-06T17:07:55.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12525922","id":"12525922","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey, I have a really old(3mths old), NOT ready for commit or for that matter review, but I thought I would attach it here in case if it is of any value to you. I can't remember all the changes that I mad but I do not think it implemented the complete functionality.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-09-08T15:33:22.433+0000","updated":"2007-09-08T15:33:22.433+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12525934","id":"12525934","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is a patch for this issue.  I am not sure how to cover or even if I can cover the changes in NewInvocationNode.java, but made those changes just based on the fact that it looked like the codepath was impacted.  \r\n\r\nPlease review\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-08T18:05:37.048+0000","updated":"2007-09-08T18:05:37.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12526345","id":"12526345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Kathey, thanks for your work on this non-trivial bug. The patch looks good. I had 2 minor comments\r\n1)Following is part of the changes for StaticMethodCallNode \r\n+\treturnValueToJava.setCollationType(returnType.getCollationType());\r\n+                         returnValueDtd.setCollationDerivation(StringDataValue.COLLATION_DERIVATION_IMPLICIT);\r\nShould the 2nd line say returnValueToJava.setCollationDerivation(StringDataValue.COLLATION_DERIVATION_IMPLICIT);?\r\n\r\n2)Also, can you please add some negative tests for user functions too? One negative test I can think of is failure when using user function in a collation operation against a system character column and then a test to show that CAST will fix that problem. \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-09-11T04:42:04.376+0000","updated":"2007-09-11T04:44:15.558+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12526522","id":"12526522","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks Mamta for the review. On item 1 the second line is not needed as the derivation is set in JavaToSQLValueNode.  For the tests I had a negative test for a system function, but I added positive/negative test for the table function SYSCS_DIAG.LOCK_TABLE as well. I checked into trunk. I will port to 10.3 as soon as tests complete.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-11T16:51:46.753+0000","updated":"2007-09-11T16:51:46.753+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12526582","id":"12526582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"The commit  comment (Revision: 574674) doesn't describe how the issue was fixed, neither do any of the comments here. Can you clarify what direction you took in the patch?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-09-11T20:01:56.141+0000","updated":"2007-09-11T20:01:56.141+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12526589","id":"12526589","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Per the wiki page and Mamta's suggestion the patch the collation will match the collation of the schema where the function is defined.  This means that for TERRITORY_BASED collation database, users executing a query like:\r\n\"select * from SYSCS_DIAG.LOCK_TABLE where tablename = 'LOCKFUNCTESTTABLE'\"\r\n\r\nwill need to either switch to the SYS schema or cast e.g:\r\nselect * from SYSCS_DIAG.LOCK_TABLE where CAST(tablename as VARCHAR(128))= 'LOCKFUNCTESTTABLE\r\n\r\nThe collation type is stored in the RoutineAliasInfo from an earlier patch, so it gets the collation type from there.\r\nTo propogate the collation type from the nodes where it is available to SQLToJavaValueNode, I added setCollationType()/getCollationType methods to JavaValueNode.\r\n\r\nSQLToJavaValueNode always sets the derivation to StringDataValue.COLLATION_DERIVATION_IMPLICIT","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-11T20:18:06.859+0000","updated":"2007-09-11T20:18:06.859+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12526605","id":"12526605","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"> or cast e.g:\r\n> select * from SYSCS_DIAG.LOCK_TABLE where CAST(tablename as VARCHAR(128))= 'LOCKFUNCTESTTABLE \r\n\r\nThat query will be using the incorrect collation and thus should not be used or recommended.\r\nSystem information is collated using UCS_BASIC collation, any queries that deviate from that for reporting system information should not be recommended.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-09-11T21:10:06.105+0000","updated":"2007-09-11T21:10:06.105+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12526607","id":"12526607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"So is true then to say that for system table queries, or using system functions or system table functions, we recommend switching to the SYS schema?  I ask, because in DERBY-2962 I went through and changed all the system queries to use casts to avoid conversion errors.  Was that the wrong thing to do?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-11T21:23:45.921+0000","updated":"2007-09-11T21:23:45.921+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12526619","id":"12526619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Well these two statements are *not* equivalent:\r\n\r\n[in any system schema]\r\nselect * from SYSCS_DIAG.LOCK_TABLE where tablename = 'LOCKFUNCTESTTABLE'\r\n\r\n[in a user schema in a territory based collation database]\r\nselect * from SYSCS_DIAG.LOCK_TABLE where CAST(tablename as VARCHAR(128))= 'LOCKFUNCTESTTABLE'\r\n\r\nThe equality predicate for the first statement matches the comparison rules Derby uses for SQL identifiers.\r\n\r\nThe equality predicate for the second statement doesn't match  the comparison rules Derby uses for SQL identifiers.\r\n\r\nFor any query in a test maybe the difference doesn't matter, but for recommending the correct approach for users it does.\r\n\r\nNote that using parameter markers makes this problem go away, since the equality will match how Derby looks up SQL identifiers.:\r\n\r\nselect * from SYSCS_DIAG.LOCK_TABLE where tablename = ?\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-09-11T22:06:35.033+0000","updated":"2007-09-11T22:06:35.033+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12374471/comment/12527577","id":"12527577","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Fixed and ported to 10.3\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-14T17:36:08.997+0000","updated":"2007-09-14T17:36:08.997+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2972/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i076jj:"}}