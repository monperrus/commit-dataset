{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12535109","self":"https://issues.apache.org/jira/rest/api/latest/issue/12535109","key":"ARIES-802","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316224","id":"12316224","description":"","name":"blueprint-0.4.0","archived":true,"released":true},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321541","id":"12321541","name":"blueprint-core-0.3.2","archived":true,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12322492","id":"12322492","name":"blueprint-core-1.0.1","archived":false,"released":true,"releaseDate":"2012-09-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-02-08 16:08:54.858","customfield_12312323":null,"customfield_12310420":"220793","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_19350516182_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-07-25T07:37:28.970+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-802/watchers","watchCount":0,"isWatching":false},"created":"2011-12-14T08:28:53.157+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319063","id":"12319063","name":"blueprint-core-0.4.1","archived":true,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-07-25T07:37:29.217+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313048","id":"12313048","name":"Blueprint","description":"OSGi Blueprint Services implementation"}],"timeoriginalestimate":null,"description":"I saw this problem several months ago. This problem still occurs in the current trunk 0.4.1-snapshot. \r\n\r\nI have two bundles A and B running and A depends on B. In my concrete case, A is an application scenario bundle depending on B the cxf bundle.\r\n\r\nInitially, both are running and have status Active. When I stop B, A goes to status GracePeriod. When I start B again, A is started but does not come back to status Active but goes to status \"Failure\" with the following error:\r\n\r\n2011-12-14 01:12:49,755 | ERROR | rint Extender: 2 | BlueprintContainerImpl           | container.BlueprintContainerImpl\r\n  362 | 10 - org.apache.aries.blueprint - 0.4.1.SNAPSHOT | Unable to start blueprint container for bundle tmp.test-osgi-cxf-provider-bp\r\norg.apache.aries.blueprint.ComponentNameAlreadyInUseException: Name 'blueprintContainer' is already in use by a registered component\r\n        at org.apache.aries.blueprint.parser.ComponentDefinitionRegistryImpl.registerComponentDefinition(ComponentDefinitionRegistryImpl.java:88)[10:org.apache.aries.blueprint:0.4.1.SNAPSHOT]\r\n        at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:286)[10:org.apache.aries.blueprint:0.4.1.SNAPSHOT]\r\n        at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:241)[10:org.apache.aries.blueprint:0.4.1.SNAPSHOT]\r\n        at org.apache.aries.blueprint.utils.threading.impl.DiscardableRunnable.run(DiscardableRunnable.java:48)[10:org.apache.aries.blueprint:0.4.1.SNAPSHOT]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)[:1.6.0_24]\r\n        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)[:1.6.0_24]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:138)[:1.6.0_24]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:98)[:1.6.0_24]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:206)[:1.6.0_24]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)[:1.6.0_24]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)[:1.6.0_24]\r\n        at java.lang.Thread.run(Thread.java:662)[:1.6.0_24]\r\n\r\n\r\nThe cause of this problem seems to be that this bundle's blueprint container's component definition map is not cleared up prior to getting restarted. This calls ComponentRegistryImpl's registerComponentDefinition and this method checks if the same named component is already in the map. \r\n\r\nI added a line of code to clear up the definition map and this made the bundle start and its status go to Active.\r\n\r\nPlease take a look at the attached file.\r\n\r\nRegards, aki\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"41606","summary":"dependent restart causes ComponentNameAlreadyInUseException: Name 'blueprintContainer' is already in use by a registered component","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ay","name":"ay","emailAddress":"dev-null at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akitoshi Yoshida","active":false},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ay","name":"ay","emailAddress":"dev-null at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akitoshi Yoshida","active":false},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"karaf 2.2.4","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":3,"total":3,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535109/comment/13169183","id":"13169183","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ay","name":"ay","emailAddress":"dev-null at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akitoshi Yoshida","active":false},"body":"aries trunk diff for\r\nM       blueprint/blueprint-core/src/main/java/org/apache/aries/blueprint/container/BlueprintContainerImpl.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ay","name":"ay","emailAddress":"dev-null at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akitoshi Yoshida","active":false},"created":"2011-12-14T08:32:20.117+0000","updated":"2011-12-14T08:32:20.117+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535109/comment/13203699","id":"13203699","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"body":"I think the reset method should be called each time before the fist call to registerComponentDefinition.\r\nSomethig like \r\n{code}\r\n\r\n                        if (missing.size() > 0) {\r\n                            LOGGER.info(\"Bundle {} is waiting for namespace handlers {}\", bundleContext.getBundle().getSymbolicName(), missing);\r\n                            eventDispatcher.blueprintEvent(new BlueprintEvent(BlueprintEvent.GRACE_PERIOD, getBundleContext().getBundle(), getExtenderBundle(), missing.toArray(new String[missing.size()])));\r\n                            return;\r\n                        }\r\n                        componentDefinitionRegistry.reset();\r\n                        componentDefinitionRegistry.registerComponentDefinition(new PassThroughMetadataImpl(\"blueprintContainer\", this));\r\n{code}\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gnt","name":"gnt","emailAddress":"gnodet at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Guillaume Nodet","active":true},"created":"2012-02-08T16:08:54.858+0000","updated":"2012-02-08T16:08:54.858+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12535109/comment/13204017","id":"13204017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ay","name":"ay","emailAddress":"dev-null at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akitoshi Yoshida","active":false},"body":"Hi Guillaume,\r\nThat would be fine too. My mind was actually torn between these two approaches :-)\r\n\r\nPutting the reset line right in front of the register line will ensure the registry is empty before registration.\r\n\r\nI thought, if the registry becomes dirty only when that waiting-for-the-missing-components happened in the previous time, we could empty the registry at that moment so that the registry stays clean for the next time.\r\n\r\nRegards, aki","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ay","name":"ay","emailAddress":"dev-null at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Akitoshi Yoshida","active":false},"created":"2012-02-08T21:31:59.499+0000","updated":"2012-02-08T21:31:59.499+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-802/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07hj3:"}}