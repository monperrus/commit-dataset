{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12477874","self":"https://issues.apache.org/jira/rest/api/latest/issue/12477874","key":"CASSANDRA-1635","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12315212","id":"12315212","description":"","name":"0.7 beta 3","archived":false,"released":true,"releaseDate":"2010-11-01"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-10-20 17:14:12.556","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"10002_*:*_1_*:*_14157061_*|*_1_*:*_1_*:*_9312864_*|*_5_*:*_1_*:*_0","customfield_12310420":"20228","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-10-20T21:11:21.290+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1635/watchers","watchCount":0,"isWatching":false},"created":"2010-10-20T14:40:11.365+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-10-21T14:55:52.556+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312979","id":"12312979","name":"Tools"}],"timeoriginalestimate":null,"description":"{code}\r\n[default@Keyspace1] create column family Users\r\ncreate column family Users\r\n737c7a71-dc56-11df-8240-e700f669bcfc\r\n[default@Keyspace1] set Users[jsmith][first] = 'John'\r\nset Users[jsmith][first] = 'John'\r\nValue inserted.\r\n[default@Keyspace1] set Users[jsmith][last] = 'Smith'\r\nset Users[jsmith][last] = 'Smith'\r\nValue inserted.\r\n[default@Keyspace1] set Users[jsmith][age] = long(42)\r\nset Users[jsmith][age] = long(42)\r\nValue inserted.\r\n[default@Keyspace1] get Users[jsmith]\r\nget Users[jsmith]\r\n=> (column=6c617374, value=Smith, timestamp=1287584999695000)\r\n=> (column=6669727374, value=John, timestamp=1287584990126000)\r\n=> (column=616765, value=^@^@^@^@^@^@^@*, timestamp=1287585014593000)\r\nReturned 3 results.\r\n{code}","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12457681","id":"12457681","filename":"CASSANDRA-1635.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2010-10-20T17:14:12.481+0000","size":2183,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12457681/CASSANDRA-1635.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12457707","id":"12457707","filename":"CASSANDRA-1635-v2.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2010-10-20T20:44:28.178+0000","size":4119,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12457707/CASSANDRA-1635-v2.patch"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"92474","summary":"cli not picking up type annotation on set","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477874/comment/12923053","id":"12923053","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"body":"Please check after 1615 committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2010-10-20T17:14:12.556+0000","updated":"2010-10-20T17:14:12.556+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477874/comment/12923111","id":"12923111","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"post-1615 I get\r\n\r\n{code}\r\n=> (column=626972746864617465, value=?, timestamp=1287602501548000)\r\n{code}\r\n\r\nAlso, I noticed that it's actually sending\r\n\r\n{code}\r\n        thriftClient_.system_update_column_family(columnFamily);\r\n{code}\r\n\r\nwhen I use a conversion function.  this is not right, we should only issue system_update_column_family for \"update column family\" statements, anything else we infer should stay local.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-10-20T19:24:25.247+0000","updated":"2010-10-20T19:24:25.247+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477874/comment/12923135","id":"12923135","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"body":"my test (after applied CASSANDRA-1635.patch to the latest trunk):\r\n{code}\r\n[default@KS1] create column family Users with comparator=UTF8Type and column_metadata=[{column_name:first, validation_class:UTF8Type}, {column_name:last, validation_class:UTF8Type}]\r\n412367d6-dc83-11df-bf47-e700f669bcfc\r\n[default@KS1] set Users[jsmith][first] = 'John'\r\nValue inserted.\r\n[default@KS1] set Users[jsmith][last] = 'Smith'\r\nValue inserted.\r\n[default@KS1] set Users[jsmith][age] = long(42)\r\nValue inserted.\r\n[default@KS1] get Users[jsmith]\r\n=> (column=last, value=Smith, timestamp=1287604215498000)\r\n=> (column=first, value=John, timestamp=1287604214111000)\r\n=> (column=age, value=42, timestamp=1287604216661000)\r\nReturned 3 results.\r\n{code}\r\n\r\nI use UTF8Type here manually because default comparator for column names is BytesType. Results you get are very weird... \r\n\r\nif you mean convertValueByFunction method then it has boolean withUpdate argument which used to determine if system update is need, I have also added polymorphic convertValueByFunction 3 arguments: columnFamily, columnName and tree argument, which calls convertValueByFunction with withUpdate set to false.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2010-10-20T20:00:36.242+0000","updated":"2010-10-20T20:00:36.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477874/comment/12923149","id":"12923149","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"bq. my test (after applied CASSANDRA-1635.patch to the latest trunk): \r\n\r\nAh, I thought when you said \"Please check after 1615 committed\" that 1615 was supposed to fix it.  I do see value working correctly after 1635 patch.  committed.\r\n\r\nbq. convertValueByFunction method then it has boolean withUpdate argument which used to determine if system update is need, I have also added polymorphic convertValueByFunction 3 arguments: columnFamily, columnName and tree argument, which calls convertValueByFunction with withUpdate set to false.\r\n\r\nsomething is definitely buggy, when I watch the server log I can see it applying the schema migration after the long() set.\r\n\r\nfundamentally side effects to thriftclient have no business in the convertValue method.  update local schema? yes. update server schema? no.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-10-20T20:16:04.756+0000","updated":"2010-10-20T20:16:04.756+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477874/comment/12923163","id":"12923163","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"body":"Sorry for my misleading comment :/ now updates for column defs are performed only locally except \"update column family\" statement.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=xedin","name":"xedin","emailAddress":"pavel dot yaskevich at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Pavel Yaskevich","active":true},"created":"2010-10-20T20:44:28.249+0000","updated":"2010-10-20T20:44:28.249+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477874/comment/12923173","id":"12923173","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"perfect, committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-10-20T21:11:21.269+0000","updated":"2010-10-20T21:11:21.269+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477874/comment/12923473","id":"12923473","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra #572 (See [https://hudson.apache.org/hudson/job/Cassandra/572/])\r\n    avoid updating server schema except for explicit 'update column family'.  patch by Pavel Yaskevich; reviewed by jbellis for CASSANDRA-1635\r\nfix cli value conversion, update readme\r\npatch by Pavel Yaskevich and jbellis for CASSANDRA-1635\r\ncli support for index queries\r\npatch by Pavel Yaskevich; reviewed by jbellis for CASSANDRA-1635\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2010-10-21T14:55:52.538+0000","updated":"2010-10-21T14:55:52.538+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1635/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g6fz:"}}