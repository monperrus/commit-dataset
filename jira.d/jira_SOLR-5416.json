{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12677136","self":"https://issues.apache.org/jira/rest/api/latest/issue/12677136","key":"SOLR-5416","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325762","id":"12325762","description":"Bugfix release after 4.6","name":"4.6.1","archived":false,"released":true,"releaseDate":"2014-01-28"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321664","id":"12321664","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-11-09 17:15:41.674","customfield_12312323":null,"customfield_12310420":"356512","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_4302567936_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-12-21T14:40:08.269+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5416/watchers","watchCount":10,"isWatching":false},"created":"2013-11-01T19:30:40.374+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["group","grouping"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"10.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":172800,"aggregatetimeoriginalestimate":172800,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325000","id":"12325000","description":"Major release after 4.5","name":"4.6","archived":false,"released":true,"releaseDate":"2013-11-24"}],"issuelinks":[{"id":"12377861","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12377861","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"12657108","key":"SOLR-5027","self":"https://issues.apache.org/jira/rest/api/2/issue/12657108","fields":{"summary":"Field Collapsing PostFilter","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/2","id":"2","description":"A new feature of the product, which has yet to be developed.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png","name":"New Feature","subtask":false}}}},{"id":"12380941","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12380941","type":{"id":"12310050","name":"Regression","inward":"is broken by","outward":"breaks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310050"},"outwardIssue":{"id":"12688336","key":"SOLR-5624","self":"https://issues.apache.org/jira/rest/api/2/issue/12688336","fields":{"summary":"Enable QueryResultCache for CollapsingQParserPlugin","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-08-26T12:13:10.376+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310674","id":"12310674","name":"search","description":"Query the search collection"}],"timeoriginalestimate":172800,"description":"Trying to use CollapsingQParserPlugin with facet tagging throws an exception. \r\n\r\n{code}\r\n ModifiableSolrParams params = new ModifiableSolrParams();\r\n    params.add(\"q\", \"*:*\");\r\n    params.add(\"fq\", \"{!collapse field=group_s}\");\r\n    params.add(\"defType\", \"edismax\");\r\n    params.add(\"bf\", \"field(test_ti)\");\r\n    params.add(\"fq\",\"{!tag=test_ti}test_ti:5\");\r\n    params.add(\"facet\",\"true\");\r\n    params.add(\"facet.field\",\"{!ex=test_ti}test_ti\");\r\n    assertQ(req(params), \"*[count(//doc)=1]\", \"//doc[./int[@name='test_ti']='5']\");\r\n{code}","customfield_10010":null,"timetracking":{"originalEstimate":"48h","remainingEstimate":"48h","originalEstimateSeconds":172800,"remainingEstimateSeconds":172800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":172800,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"356800","summary":"CollapsingQParserPlugin breaks Tag/Exclude Faceting","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":172800,"percent":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":172800,"percent":0},"comment":{"startAt":0,"maxResults":48,"total":48,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13813187","id":"13813187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"This patch assumes that only tagged documents have a ord > -1 and scorer = null in the collect() method\r\n\r\nIf there is a better way to identify tagged documents in this collect() method then it should probably be used in place of ord > -1 && scorer == null","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-11-04T20:02:42.965+0000","updated":"2013-11-04T20:02:42.965+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13813315","id":"13813315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"This fix uncovers/creates a new bug:\r\n\r\nError during auto-warming of key:org.apache.solr.search.QueryResultKey@48dfd36d:java.lang.ArrayIndexOutOfBoundsException: 0\r\n\tat org.apache.solr.search.CollapsingQParserPlugin$CollapsingScoreCollector.setNextReader(CollapsingQParserPlugin.java:401)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:618)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:297)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListAndSetNC(SolrIndexSearcher.java:1636)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1363)\r\n\tat org.apache.solr.search.SolrIndexSearcher.access$000(SolrIndexSearcher.java:118)\r\n\tat org.apache.solr.search.SolrIndexSearcher$3.regenerateItem(SolrIndexSearcher.java:465)\r\n\tat org.apache.solr.search.LRUCache.warm(LRUCache.java:188)\r\n\tat org.apache.solr.search.SolrIndexSearcher.warm(SolrIndexSearcher.java:2051)\r\n\tat org.apache.solr.core.SolrCore$4.call(SolrCore.java:1631)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n\tat java.lang.Thread.run(Thread.java:722)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-11-04T21:38:41.887+0000","updated":"2013-11-04T21:38:41.887+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13813325","id":"13813325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Adding a fix for setNextReader function when contexts.length = 0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-11-04T21:43:03.787+0000","updated":"2013-11-04T21:43:03.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13818202","id":"13818202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Hi David,\r\n\r\nI've read through the patch. I don't think we'll be able to solve this issue though from inside of the CollapsingQParserPlugin. The main problem is that the CollapsingQParserPlugin really needs the scorer to be present to work properly. So to get this working we'll need to make sure that the method that builds the docset, builds it in such a way that scorer can be accessed. \r\n\r\nI'll take a look at finding an approach for this.\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-09T17:15:41.674+0000","updated":"2013-11-09T17:15:41.674+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13819180","id":"13819180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Joel,\r\n\r\nI'm currently using my patch and the facet counts are correct and the performance is good. We were looking to roll this out in production where I work. Would you advise against it? What kind of problems could this cause?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-11-11T18:28:58.007+0000","updated":"2013-11-11T18:28:58.007+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13819224","id":"13819224","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"David,\r\n\r\nHere is the flow as I see it with the patch:\r\n1) The intitial search executes and produces a result based on collapsing the groups by score.\r\n2) The facet component needs to regenerate the docset because of the tag/exclude parameters. But the scorer is not present when regenerating the docset, so it is using logic that overwrites the group-head each time. This will result in the document that is found latest in the index becoming the group-head, for each group.\r\n\r\nSo, the result set used to calculate the facet, will be different from the result set used to generate the search results.\r\n\r\nTo keep these in sync you would need to have step 2, also collapse based on score.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-11T19:02:07.546+0000","updated":"2013-11-11T19:02:07.546+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13819237","id":"13819237","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Oh I see.... that won't actually be a problem for me since all of the documents in the group should have the same facet counts. Thanks for the reply. I will wait for a fix. But for now, if I understand your reply correctly, I don't think that will affect my facet counts in a negative manner.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-11-11T19:10:08.267+0000","updated":"2013-11-11T19:10:08.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13819255","id":"13819255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Yes, if all the documents in the same group have the same facet counts then you won't notice this problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-11-11T19:22:25.254+0000","updated":"2013-11-11T19:22:25.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13844692","id":"13844692","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"I uploaded a patch created from trunk which I believe resolves the issues. I started out attempting to fix this in a more generic way but ended up needing to get very specific to not break other test cases. \r\n\r\nThe issue with the other test cases is that the patch I added won't work if the main query is excluded. But for the CollapsingQParserPlugin, then main query is always needed anyway to support collapsing by score. So to not break a test case which excluded the main query, I routed only requests that use the CollapsingQParserPlugin to the new method that scores while creating the docset.\r\n\r\nThe next step is to throw an exception if someone tries to exclude the main query while using the CollapsingQParserPlugin. \r\n\r\nDavid, when you get a chance could you test this patch out and see if it resolves the issue for you. If the patch doesn't apply for you I'll create one for your version of Solr.\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-10T21:37:27.136+0000","updated":"2013-12-10T22:08:52.985+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13845469","id":"13845469","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Added a test case for tag/exclude and also revamped all the tests to better exercise sorting following the collapse.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-11T15:17:33.137+0000","updated":"2013-12-11T15:17:33.137+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13845630","id":"13845630","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Hi Joel I will try to patch it into 4.5.1 and let you know if it works","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-11T18:56:24.762+0000","updated":"2013-12-11T18:56:24.762+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13845668","id":"13845668","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Hi David,\r\n\r\nIt's probably easiest to put two files in place rather then try to patch 4.5.1. I'll attache my version of the CollapsingQParserPlugin and SolrIndexSearcher. You can then just copy them to org/apache/solr/search.\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-11T19:37:02.062+0000","updated":"2013-12-11T19:37:02.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13845678","id":"13845678","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Could you also attach your tests and I'll see if it works","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-11T19:47:12.036+0000","updated":"2013-12-11T19:47:12.036+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13845688","id":"13845688","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"patched it into 4.6. Going to upgrade my servers and do some testing with my index","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-11T20:04:51.889+0000","updated":"2013-12-11T20:04:51.889+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13845852","id":"13845852","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Added empty SearchFilter interface so SolrIndexSearcher can reference something more generic. If a postfilter also implements SearchFilter then the SolrIndexSearcher will call getDocSetScore() rather the getDocSet() when building docsets. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-11T23:42:19.959+0000","updated":"2013-12-11T23:42:19.959+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846549","id":"13846549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"4.6 had some bugs in the DIH. Going to try to patch this into my 4.5.1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T18:17:42.699+0000","updated":"2013-12-12T18:17:42.699+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846576","id":"13846576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Joel,\r\n\r\nThis test is failing:\r\n\r\n{code}\r\nparams = new ModifiableSolrParams();\r\n    params.add(\"q\", \"*:*\");\r\n    params.add(\"fq\", \"{!collapse field=group_s min=test_ti}\");\r\n    params.add(\"sort\", \"score desc,id asc\");\r\n    params.add(\"defType\", \"edismax\");\r\n    params.add(\"bf\", \"field(id)\");\r\n    assertQ(req(params), \"*[count(//doc)=2]\",\r\n                          \"//result/doc[1]/float[@name='id'][.='5.0']\",\r\n                          \"//result/doc[2]/float[@name='id'][.='1.0']\");\r\n{code}\r\n\r\nI'm assuming it's not a problem with the parser and a problem with the test.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T18:45:18.924+0000","updated":"2013-12-12T18:45:18.924+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846600","id":"13846600","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"The test should be ok. It runs successfully for me.  This specifically tests SOLR-5408. Probably you don't have that patch applied. If you overlay the attached java files you'll get both patches.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-12T19:04:17.011+0000","updated":"2013-12-12T19:04:33.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846623","id":"13846623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Overlaying the files doesn't work I get errors resolving:\r\n\r\nimport org.apache.lucene.index.StorableField;\r\nimport org.apache.lucene.index.StoredDocument;\r\n\r\nWould you be able to create a patch for 4.5.1?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T19:20:35.245+0000","updated":"2013-12-12T19:20:35.245+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846632","id":"13846632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"I just checked the patch from SOLR-5408 and it looks like I have that code already.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T19:26:00.754+0000","updated":"2013-12-12T19:26:00.754+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846633","id":"13846633","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"oh wait nevermind. I patched solrIndexsearcher with just your changes... then I overlay your CollapsingQParserPlugin... this might work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T19:27:08.752+0000","updated":"2013-12-12T19:27:08.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846648","id":"13846648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"bah... no good","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T19:33:53.648+0000","updated":"2013-12-12T19:33:53.648+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846663","id":"13846663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"whew! Ok I applied the patches from SOLR-5027, SOLR-5408, and from your latest patch attached to this tracker. All tests now pass. Going to upgrade my servers and see if this works for me. In my current implementation I am getting a lot of errors from SolrCache (the patch I provided) and am running into heap memory errors. I'm wondering if the errors are caused by my patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T19:53:48.967+0000","updated":"2013-12-12T19:53:48.967+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846760","id":"13846760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"I have patched 4.5.1 with your changes. Functionally everything works correctly. But I am seeing the following errors:\r\n\r\n\r\n1672828 [searcherExecutor-5-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@ad693c4:java.lang.NullPointerException\r\n\r\n1672831 [searcherExecutor-5-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@e7384164:java.lang.NullPointerException\r\n\r\n1672834 [searcherExecutor-5-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@569af2fd:java.lang.NullPointerException\r\n\r\n1672837 [searcherExecutor-5-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@45c8d9aa:java.lang.NullPointerException\r\n\r\n1672899 [searcherExecutor-5-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@d8a57011:java.lang.NullPointerException\r\n\r\n1672904 [searcherExecutor-5-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@eb4c3b23:java.lang.NullPointerException","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T21:27:49.004+0000","updated":"2013-12-12T21:27:49.004+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846808","id":"13846808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Joel,\r\n\r\nIs it possible that the tagged documents are ending up in the solr query cache with null values?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T22:08:05.600+0000","updated":"2013-12-12T22:08:05.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846827","id":"13846827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"David,\r\n\r\nI'm not gettting the auto-warm cache errors. I have debug logging on, and autowarming turned on. I ran collapse queries to populate the QueryResultCache and then loaded data. The cache seems to warm properly.\r\n\r\nTry turning debug logging on and see if we can get more of the strack trace.\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-12T22:27:23.797+0000","updated":"2013-12-12T22:27:23.797+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846872","id":"13846872","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"7668111 [searcherExecutor-18-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@cec848a0:java.lang.ArrayIndexOutOfBoundsException: 1\r\n\tat org.apache.solr.search.CollapsingQParserPlugin$CollapsingScoreCollector.setNextReader(CollapsingQParserPlugin.java:402)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:618)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:297)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListAndSetNC(SolrIndexSearcher.java:1662)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1389)\r\n\tat org.apache.solr.search.SolrIndexSearcher.access$000(SolrIndexSearcher.java:118)\r\n\tat org.apache.solr.search.SolrIndexSearcher$3.regenerateItem(SolrIndexSearcher.java:465)\r\n\tat org.apache.solr.search.LRUCache.warm(LRUCache.java:188)\r\n\tat org.apache.solr.search.SolrIndexSearcher.warm(SolrIndexSearcher.java:2077)\r\n\tat org.apache.solr.core.SolrCore$4.call(SolrCore.java:1631)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n\tat java.lang.Thread.run(Thread.java:722)\r\n\r\n7668114 [searcherExecutor-18-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@d9756dd8:java.lang.ArrayIndexOutOfBoundsException: 1\r\n\tat org.apache.solr.search.CollapsingQParserPlugin$CollapsingScoreCollector.setNextReader(CollapsingQParserPlugin.java:402)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:618)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:297)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListAndSetNC(SolrIndexSearcher.java:1662)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1389)\r\n\tat org.apache.solr.search.SolrIndexSearcher.access$000(SolrIndexSearcher.java:118)\r\n\tat org.apache.solr.search.SolrIndexSearcher$3.regenerateItem(SolrIndexSearcher.java:465)\r\n\tat org.apache.solr.search.LRUCache.warm(LRUCache.java:188)\r\n\tat org.apache.solr.search.SolrIndexSearcher.warm(SolrIndexSearcher.java:2077)\r\n\tat org.apache.solr.core.SolrCore$4.call(SolrCore.java:1631)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n\tat java.lang.Thread.run(Thread.java:722)\r\n\r\n7668123 [searcherExecutor-18-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@d38b6b9c:java.lang.ArrayIndexOutOfBoundsException: 1\r\n\tat org.apache.solr.search.CollapsingQParserPlugin$CollapsingScoreCollector.setNextReader(CollapsingQParserPlugin.java:402)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:618)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:297)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListAndSetNC(SolrIndexSearcher.java:1662)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1389)\r\n\tat org.apache.solr.search.SolrIndexSearcher.access$000(SolrIndexSearcher.java:118)\r\n\tat org.apache.solr.search.SolrIndexSearcher$3.regenerateItem(SolrIndexSearcher.java:465)\r\n\tat org.apache.solr.search.LRUCache.warm(LRUCache.java:188)\r\n\tat org.apache.solr.search.SolrIndexSearcher.warm(SolrIndexSearcher.java:2077)\r\n\tat org.apache.solr.core.SolrCore$4.call(SolrCore.java:1631)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n\tat java.lang.Thread.run(Thread.java:722)\r\n\r\n7668165 [searcherExecutor-18-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@9fe9299c:java.lang.ArrayIndexOutOfBoundsException: 1\r\n\tat org.apache.solr.search.CollapsingQParserPlugin$CollapsingScoreCollector.setNextReader(CollapsingQParserPlugin.java:402)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:618)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:297)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListAndSetNC(SolrIndexSearcher.java:1662)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1389)\r\n\tat org.apache.solr.search.SolrIndexSearcher.access$000(SolrIndexSearcher.java:118)\r\n\tat org.apache.solr.search.SolrIndexSearcher$3.regenerateItem(SolrIndexSearcher.java:465)\r\n\tat org.apache.solr.search.LRUCache.warm(LRUCache.java:188)\r\n\tat org.apache.solr.search.SolrIndexSearcher.warm(SolrIndexSearcher.java:2077)\r\n\tat org.apache.solr.core.SolrCore$4.call(SolrCore.java:1631)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n\tat java.lang.Thread.run(Thread.java:722)\r\n\r\n7668169 [searcherExecutor-18-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@94d684c6:java.lang.ArrayIndexOutOfBoundsException: 1\r\n\tat org.apache.solr.search.CollapsingQParserPlugin$CollapsingScoreCollector.setNextReader(CollapsingQParserPlugin.java:402)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:618)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:297)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListAndSetNC(SolrIndexSearcher.java:1662)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1389)\r\n\tat org.apache.solr.search.SolrIndexSearcher.access$000(SolrIndexSearcher.java:118)\r\n\tat org.apache.solr.search.SolrIndexSearcher$3.regenerateItem(SolrIndexSearcher.java:465)\r\n\tat org.apache.solr.search.LRUCache.warm(LRUCache.java:188)\r\n\tat org.apache.solr.search.SolrIndexSearcher.warm(SolrIndexSearcher.java:2077)\r\n\tat org.apache.solr.core.SolrCore$4.call(SolrCore.java:1631)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n\tat java.lang.Thread.run(Thread.java:722)\r\n\r\n7668175 [searcherExecutor-18-thread-1] ERROR org.apache.solr.search.SolrCache  – Error during auto-warming of key:org.apache.solr.search.QueryResultKey@31f8a000:java.lang.ArrayIndexOutOfBoundsException: 1\r\n\tat org.apache.solr.search.CollapsingQParserPlugin$CollapsingScoreCollector.setNextReader(CollapsingQParserPlugin.java:402)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:618)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:297)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListAndSetNC(SolrIndexSearcher.java:1662)\r\n\tat org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1389)\r\n\tat org.apache.solr.search.SolrIndexSearcher.access$000(SolrIndexSearcher.java:118)\r\n\tat org.apache.solr.search.SolrIndexSearcher$3.regenerateItem(SolrIndexSearcher.java:465)\r\n\tat org.apache.solr.search.LRUCache.warm(LRUCache.java:188)\r\n\tat org.apache.solr.search.SolrIndexSearcher.warm(SolrIndexSearcher.java:2077)\r\n\tat org.apache.solr.core.SolrCore$4.call(SolrCore.java:1631)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n\tat java.lang.Thread.run(Thread.java:722)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-12T23:06:35.281+0000","updated":"2013-12-12T23:06:35.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13846953","id":"13846953","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"OK, I believe I see the problem. I'll update this ticket with a new patch shortly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-13T00:12:12.458+0000","updated":"2013-12-13T00:12:25.007+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13847041","id":"13847041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"David,\r\n\r\nThis was actually a pretty nasty bug, that pointed to possible memory leaks as well. The latest patch should resolve your exceptions around cache warming and eliminate the memory leak issues.\r\n\r\nThanks for helping track down these bugs.\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-13T01:46:00.177+0000","updated":"2013-12-13T01:46:00.177+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13847576","id":"13847576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Resolved an issue with sort order when an empty sort param is provided, reported in SOLR-5554.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-13T15:28:03.517+0000","updated":"2013-12-13T15:28:03.517+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13847788","id":"13847788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Thank you for your quick response, I'm actually trying to use your plugin in production as the standard grouping had serious performance issues around facet grouping. I'll try to patch in your latest fix. Thank you for all of your help!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-13T19:03:48.771+0000","updated":"2013-12-13T19:03:48.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13847814","id":"13847814","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"I am attaching a patch with all of the patches for CollapseQParserPlugin up to todays date. This patch is for those of use who want to use this plugin in Solr 4.5.1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-13T19:27:24.023+0000","updated":"2013-12-13T19:27:24.023+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13849605","id":"13849605","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"All tests are passing as well as precommit. I'll wait a day or so to see if any review comments come in and if not I'll commit to trunk, 4x and Solr 4.6.1.\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-16T19:10:48.006+0000","updated":"2013-12-16T19:10:48.006+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13850390","id":"13850390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=er.shruti","name":"er.shruti","emailAddress":"er dot shrutisuri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shruti suri","active":true},"body":"Joel,\r\n\r\nI am getting the following error when i am applying CollapseQParserPluginPatch-solr-4.5.1.patch in solr-4.5.1.\r\n\r\nError\r\n1 out of 1 hunk ignored -- saving rejects to file solr/core/src/java/org/apache/solr/search/QParserPlugin.java.rej\r\npatching file solr/core/ivy.xml\r\nHunk #1 FAILED at 42.\r\n1 out of 1 hunk FAILED -- saving rejects to file solr/core/ivy.xml.rej\r\npatching file solr/core/src/test/org/apache/solr/search/QueryEqualityTest.java\r\nHunk #1 succeeded at 295 (offset 100 lines).\r\npatching file solr/core/src/java/org/apache/solr/search/ScoreFilter.java\r\npatching file solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java\r\nReversed (or previously applied) patch detected!  Assume -R? [n] \r\nApply anyway? [n] \r\nSkipping patch.\r\n2 out of 2 hunks ignored -- saving rejects to file solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java.rej\r\npatching file solr/core/src/test/org/apache/solr/search/TestCollapseQParserPlugin.java\r\npatching file solr/core/src/java/org/apache/solr/search/CollapsingQParserPlugin.java\r\n\r\nRegards\r\nShruti \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=er.shruti","name":"er.shruti","emailAddress":"er dot shrutisuri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shruti suri","active":true},"created":"2013-12-17T12:10:28.764+0000","updated":"2013-12-17T12:10:28.764+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13850479","id":"13850479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Hi Shruti,\r\n\r\nI suspect you have certain parts of the patch already applied. David created this patch, but I believe it applies the CollapsingQParserPlugin all the way back to the original commit. \r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-17T14:08:35.239+0000","updated":"2013-12-17T14:08:35.239+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13851458","id":"13851458","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=er.shruti","name":"er.shruti","emailAddress":"er dot shrutisuri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shruti suri","active":true},"body":"Joel\r\n\r\nPlease tell me steps to integrate it with svn checkout lucene_solr_4_5_1\r\n\r\nShruti","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=er.shruti","name":"er.shruti","emailAddress":"er dot shrutisuri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shruti suri","active":true},"created":"2013-12-18T07:13:48.222+0000","updated":"2013-12-18T07:13:48.222+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13851653","id":"13851653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"David,\r\n\r\nI'd like to credit your work on this ticket in the CHANGES.txt. Let me know if you'd like to use your last name.\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-18T12:45:23.997+0000","updated":"2013-12-18T12:45:23.997+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13851867","id":"13851867","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1551999 from [~joel.bernstein] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1551999 ]\r\n\r\nSOLR-5416: CollapsingQParserPlugin bug with tagging","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-18T16:06:14.153+0000","updated":"2013-12-18T16:06:14.153+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13851918","id":"13851918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1552027 from [~joel.bernstein] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1552027 ]\r\n\r\nSOLR-5416: CollapsingQParserPlugin bug with tagging","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-18T17:05:01.794+0000","updated":"2013-12-18T17:05:01.794+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13851963","id":"13851963","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"wow thanks Joel! Of course I wouldn't mind. My full name is David Boychuck.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2013-12-18T17:52:03.909+0000","updated":"2013-12-18T17:52:03.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13852347","id":"13852347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Thanks David, I think the plan is to get these fixes into Solr 4.6.1. I'll be sure to credit you in the CHANGES.txt\r\n\r\nJoel","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2013-12-18T23:58:16.457+0000","updated":"2013-12-18T23:58:16.457+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13854798","id":"13854798","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1552876 from [~joel.bernstein] in branch 'dev/branches/lucene_solr_4_6'\r\n[ https://svn.apache.org/r1552876 ]\r\n\r\nSOLR-5416: CollapsingQParserPlugin bug with tagging","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-21T06:05:28.043+0000","updated":"2013-12-21T06:05:28.043+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13868280","id":"13868280","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Hi Joel,\r\n\r\nI'm noticing that QueryResultCache is not being used when using this plugin. Is it not supposed to? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2014-01-10T20:48:04.795+0000","updated":"2014-01-10T20:48:04.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13868310","id":"13868310","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"Actually the reason why I had to disable the QueryResultCache for the CollapsingQParserPlugin is this bug. You could trigger this bug by also doing\r\n\r\n1) Executing a query with the CollapsingQParsePlugin combined with facets.\r\n2) The query gets cached in the QueryResultCache. But the docset does not (this is normal for Solr).\r\n3) Execute the same query again, retrieve the query from the QueryResultCache but the docset needs to be regenerated.\r\n4) Regenerating the docset threw the same exception you reported in this ticket because they use the same method.\r\n\r\nI knew this bug existed, so I disabled the queryResultCache for the CollapsingQParserPlugin. But I didn't know tag/exclude would trigger the same bug. You pointed that out.\r\n\r\nNow that this issue is fixed, the CollapsingQParserPlugin will work fine with the QueryResultCache. But I haven't re-enabled it. If you want, you can create another ticket for that. I was planning on doing this for Solr 4.7.\r\n\r\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2014-01-10T21:16:14.480+0000","updated":"2014-01-10T21:16:14.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13868342","id":"13868342","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"Is it something that would be easy to re-enable? I'd like to use it in my 4.5.1 solr","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2014-01-10T21:41:41.964+0000","updated":"2014-01-10T21:41:41.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13868345","id":"13868345","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"body":"https://issues.apache.org/jira/browse/SOLR-5624","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dboychuck","name":"dboychuck","emailAddress":"dboychuck at build dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"David Boychuck","active":true},"created":"2014-01-10T21:43:48.142+0000","updated":"2014-01-10T21:43:48.142+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/13868356","id":"13868356","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"body":"The equals and hashCode methods in the CollapsingPostFilter need to be changed. It's a pretty quick fix and easy to backport. I'll try to get to this early next week. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=joel.bernstein","name":"joel.bernstein","emailAddress":"joel at amberstonelabs dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Joel Bernstein","active":true},"created":"2014-01-10T21:53:16.508+0000","updated":"2014-01-10T21:53:16.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12677136/comment/14110639","id":"14110639","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=er.shruti","name":"er.shruti","emailAddress":"er dot shrutisuri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shruti suri","active":true},"body":"Hi Joel,\r\n\r\nI am facing an issue with Facet count using  shard query and  collapse filter. \r\n\r\nQuery:- \r\nhttp://localhost:8983/solr/core1/select?fq={!collapse%20field=type}&q=type:abc&facet=true&facet.field=type&shards=localhost:8983/solr/core1,localhost:8983/solr/core2\r\n\r\nOutput:-\r\n<result name=\"response\" numFound=\"1\" start=\"0\" maxScore=\"1.0\"></result>\r\n<lst name=\"facet_counts\"> \r\n<lst name=\"facet_queries\"/>\r\n<lst name=\"facet_fields\">\r\n<lst name=\"type\"> \r\n<int name=\"abc\">2</int>\r\n<int name=\"cde\">0</int>\r\n<int name=\"swe\">0</int>\r\n</lst>\r\n</lst>\r\n<lst name=\"facet_dates\"/>\r\n<lst name=\"facet_ranges\"/></lst></response>\r\n\r\nIssue:- In the above output numFound=\"1\" and facet count for abc is 2. While merging results from shards unique Facet count should drop. \r\n\r\nRegards\r\nshruti\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=er.shruti","name":"er.shruti","emailAddress":"er dot shrutisuri at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"shruti suri","active":true},"created":"2014-08-26T12:13:10.376+0000","updated":"2014-08-26T12:13:10.376+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-5416/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1pgkv:"}}