{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12386900","self":"https://issues.apache.org/jira/rest/api/latest/issue/12386900","key":"DERBY-3341","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-03-03 15:41:02.692","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23580","customfield_12310222":"1_*:*_1_*:*_12085864557_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-06-10T21:01:14.344+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3341/watchers","watchCount":0,"isWatching":false},"created":"2008-01-22T23:50:09.787+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12319317","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12319317","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"inwardIssue":{"id":"12354628","key":"DERBY-2034","self":"https://issues.apache.org/jira/rest/api/2/issue/12354628","fields":{"summary":"Tracking of bugs that lead to incorrect results being stored or returned to the client","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/5","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/trivial.png","name":"Trivial","id":"5"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/3","id":"3","description":"A task that needs to be done.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/task.png","name":"Task","subtask":false}}}},{"id":"12319466","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12319466","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12390467","key":"DERBY-3512","self":"https://issues.apache.org/jira/rest/api/2/issue/12390467","fields":{"summary":"Using functions, you can create a LONG VARCHAR value which is longer than the maximum length of a Derby LONG VARCHAR","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:51:19.407+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"Defining a column in the returned type as CHAR(10) requires that the returned value be of length 10 characters.\r\n\r\nDefining a table function with a return type of:\r\n   returns TABLE  column0 char( 10 ), column1 char( 10 ))\r\nseems to just return whatever the Java ResultSet implementation handed it.\r\n\r\nMy guess this is true for all variable length types, no casting of the value occurs when it is returned to the SQL domain.\r\n\r\nJava single value functions and procedure out parameters do perform any required casting to ensure the value is of the declared type.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37346","summary":"TABLE FUNCTION returning CHAR values does not return a correct value if the Java ResultSet class returns a value less than the length of the defined CHAR.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":17,"total":17,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12561525","id":"12561525","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Quick hacked up modification to TableFunctionTest that shows the problem.\r\n\r\nNote the change from\r\n-                else { assertTrue( expectedValue.equals( actualValue ) ); }\r\n+                else { assertEquals(expectedValue, actualValue); }\r\n\r\nThis results in the values being displayed if the test fails and there is more useful and clearer than explicitly performing the equals().\r\n\r\nThe test itself is actually a little hard to get into, it doesn't follow the established JUnit pattern of having fixtures being with test so it's hard to see where the fixtures are. It also seems to duplicate existing utility methods such as testing the contents of result sets and dropping a schema.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2008-01-22T23:59:36.566+0000","updated":"2008-01-22T23:59:36.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12574566","id":"12574566","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The same behavior plagues the diagnostic VTIs. You can demonstrate this by hacking AccessFactoryGlobals.USER_TRANS_NAME to be a long string and then running the following update:\r\n\r\ncreate table t2( col1 varchar(35 ) );\r\n\r\ninsert into t2( col1 )\r\nSELECT type FROM SYSCS_DIAG.TRANSACTION_TABLE;\r\n\r\nThe declared type of TRANSACTION_TABLE.TYPE is varchar( 30 ) but there is no truncating cast in the bind-time plan to cut the hacked value back to 30 characters.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-03T15:41:02.692+0000","updated":"2008-03-03T15:41:02.692+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12574666","id":"12574666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"The bind tree looks correct to me. The compiler has the correct understanding of what SQL types are supposed to correspond to the columns in the user-coded ResultSet. From one point of view, you could say that the problem is that the user has lied: At DDL time the user declared that a string column in a table function has a maximum length, but the actual user-coded implementation of the ResultSet does not obey this contract. I think that, technically, the behavior is undefined right now because ANSI does not have rules about what happens if a Derby-style table function returns an oversized string.\r\n\r\nThe current behavior is unattractive. We are free to define what we think the correct behavior should be--and then we should document that correct behavior. One approach would be to throw a SQLException if the ResultSet does not fulfill the declared contract. However, I think that silently truncating oversized strings would be more useful. The current proposal seems fine:\r\n\r\nIf the customer declares that a string column in a Table Function has a maximum length, and the underlying user-coded ResultSet returns oversized strings, then Derby should silently truncate those strings to the declared maximum length by chopping off trailing characters.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-03T18:53:56.216+0000","updated":"2008-03-03T18:53:56.216+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12574701","id":"12574701","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"The issue is not limited to String values that are too long, it's a generic issue for any variable length types.\r\n\r\nA ResultSet returning the String \"A\" for a CHAR(5) is also incorrect, similar for DECIMAL values with smaller scale than defined.\r\n\r\nCurrently Java functions do silently truncate VARCHAR and CHAR values that are too long, not sure that's correct but I can't yet find any clear indication in the SQL spec (part 13) of what is meant to happen.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2008-03-03T19:39:32.884+0000","updated":"2008-03-03T19:39:32.884+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12574716","id":"12574716","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I think that where we want to end up is that the value taken out of the ResultSet is run through the normalize() method of the declared data type. Does that sound right? If so, is that behavior declared anywhere in our user documentation? I can't find a corresponding description for how the return values of scalar functions are normalized.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-03T20:04:17.489+0000","updated":"2008-03-03T20:04:17.489+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12575371","id":"12575371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-3341-01-coerce.diff. This coerces values as they pass from the Java domain into the SQL domain. The regression tests run cleanly for me except for timeouts in the stress multi tests and a diff in TransactionTable--those errors don't seem related to this work. The fix gives me correct results for the hand-rolled test cases I tried but I would like to add some more systematic cases to the regression tests.\r\n\r\nTouches the following files:\r\n\r\nM      java/engine/org/apache/derby/impl/sql/compile/FromVTI.java\r\n\r\nFor Derby-style Table Functions, the function's return type is generated into the call which instantiates a VTIResultSet.\r\n\r\nM      java/engine/org/apache/derby/impl/sql/execute/GenericResultSetFactory.java\r\nM      java/engine/org/apache/derby/iapi/sql/execute/ResultSetFactory.java\r\n\r\nThe extra argument is added to the signatures of the method which instantiates a VTIResultSet.\r\n\r\nM      java/engine/org/apache/derby/impl/sql/execute/VTIResultSet.java\r\n\r\nFor Derby-style Table Functions, the return type is unwrapped, the type descriptors for the returned columns are extracted, and the values coming out of the user-coded ResultSet are coerced according to those column types. The coercion logic follows the rules described in CastNode.genDataValueConversion().\r\n\r\nM      java/testing/org/apache/derbyTesting/functionTests/tests/lang/TableFunctionTest.java\r\n\r\nModified this test because short string values are now being padded with trailing blanks when they are coerced into long CHAR values.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-05T14:42:45.419+0000","updated":"2008-03-05T14:42:45.419+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12575426","id":"12575426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I haven't looked in detail at the patch but the approach seems unusual to me. The passing of the return types as a string and then unpacking it at execution time seems more like compile time work. Standard functions use a CastNode (ie. operation all figured out at compile time) to perform conversions. That or a NormalizeResultSet would seem more in line with existing code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2008-03-05T17:20:29.607+0000","updated":"2008-03-05T17:20:29.607+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12576347","id":"12576347","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a second rev of a fix: derby-01-da-coerceWithTests.diff. This extends the previous patch as follows:\r\n\r\n1) Adds tests to verify that the behavior is what we expect for CHAR, VARCHAR, BINARY, VARBINARY, LONG VARCHAR, LONG VARBINARY, and DECIMAL.\r\n\r\n2) Adds some extra logic to make the LONG VARCHAR and LONG VARBINARY cases correct. The current cast-based behavior with scalar functions is not correct for LONG VARCHAR (see DERBY-3511) and I suspect it is not correct for LONG VARBINARY either (see DERBY-3512).\r\n\r\nI am running regression tests now. For the record, my first attempt to fix this problem was to insert CASTs into the bound tree. That did not work. We can experiment with other solutions later on. As a first increment, I would like to make the behavior correct.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-07T19:46:45.121+0000","updated":"2008-03-07T19:46:45.121+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12576369","id":"12576369","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-3341-02-aa-refGuide.diff and the corresponding html output. This is a change to the CREATE FUNCTION documentation in the Reference Guide. This adds a paragraph describing how values are coerced as they come out of user-coded ResultSets. Touches the following file:\r\n\r\nM      src/ref/rrefcreatefunctionstatement.dita\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-07T20:53:22.119+0000","updated":"2008-03-07T20:53:22.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12576393","id":"12576393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"> For the record, my first attempt to fix this problem was to insert CASTs into the bound tree. That did not work.\r\n\r\nIt would be interesting to see the details on this to either allow others not to waste their time trying a similar solution or to allow others to get the solution working.\r\nThe benefit of an open source community is to throw code out there and ask opinions on why it doesn't work, usually the whole community benefits through the exposure.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2008-03-07T21:55:37.874+0000","updated":"2008-03-07T21:55:37.874+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12577512","id":"12577512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Committed derby-3341-01-da-coerceWithTests.diff at subversion revision 636004. The old-style regression tests ran cleanly for me last Friday except for a known instability in the stress multi tests. The junit tests hung, however, at the end in the replication tests. Those replication tests have been disabled and the junit tests now run cleanly for me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-11T16:57:32.994+0000","updated":"2008-03-11T16:57:32.994+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12577514","id":"12577514","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Committed doc changes derby-3341-02-aa-refGuide.diff at subversion revision 636007.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-11T17:00:18.275+0000","updated":"2008-03-11T17:00:18.275+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12577516","id":"12577516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Ported 636004 from trunk to 10.4 branch at subversion revision 636010.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-11T17:08:00.061+0000","updated":"2008-03-11T17:08:00.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12577538","id":"12577538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Ported 636007 from docs trunk to 10.4 docs branch at revision 636041.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-03-11T18:09:31.845+0000","updated":"2008-03-11T18:09:31.845+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12578083","id":"12578083","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"I saw two failures when running suites.All with weme6.1 last night, both in TableFunctionTest with similar diffs.  Ex:\r\n\r\nnoSpecialCollation(o.a.dTesting.functionTests.tests.lang.TableFunctionTest)java.sql.SQLException: An attempt was made to get a data value of type 'java.lang.Object' from a data value of type 'DECIMAL'.\r\n at o.a.d.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\r\n at o.a.d.impl.jdbc.Util.generateCsSQLException(Unknown Source)\r\n at o.a.d.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\r\n at o.a.d.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\r\n at o.a.d.impl.jdbc.EmbedConnection.handleException(Unknown Source)\r\n at o.a.d.impl.jdbc.ConnectionChild.handleException(Unknown Source)\r\n at o.a.d.impl.jdbc.EmbedResultSet.closeOnTransactionError(Unknown Source)\r\n at o.a.d.impl.jdbc.EmbedResultSet.movePosition(Unknown Source)\r\n at o.a.d.impl.jdbc.EmbedResultSet.next(Unknown Source)\r\n at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1935)\r\n at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1776)\r\n at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.assertResults(TableFunctionTest.java:1762)\r\n at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.allLegalDatatypesVTIResults(TableFunctionTest.java:1178)\r\n at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.tableFunctionTest(TableFunctionTest.java:921)\r\n at o.a.dTesting.functionTests.tests.lang.TableFunctionTest.noSpecialCollation(TableFunctionTest.java:897)\r\n at java.lang.reflect.AccessibleObject.invokeV(AccessibleObject.java:205)\r\n at o.a.dTesting.junit.BaseTestCase.runBare(BaseTestCase.java:101)\r\nCaused by: ERROR 22005: An attempt was made to get a data value of type 'java.lang.Object' from a data value of type 'DECIMAL'.\r\n at o.a.d.iapi.error.StandardException.newException(Unknown Source)\r\n at o.a.d.iapi.types.DataType.dataTypeConversion(Unknown Source)\r\n at o.a.d.iapi.types.DataType.getObject(Unknown Source)\r\n at o.a.d.impl.sql.execute.VTIResultSet.cast(Unknown Source)\r\n at o.a.d.impl.sql.execute.VTIResultSet.populateFromResultSet(Unknown Source)\r\n at o.a.d.impl.sql.execute.VTIResultSet.getNextRowCore(Unknown Source)\r\n at o.a.d.impl.sql.execute.BasicNoPutResultSetImpl.getNextRow(Unknown Source)\r\n\r\nThe other failure was the \"specialCollation()\" fixture.\r\n\r\nI'm guessing you're not running tests with weme6.1, but any chance you might be able identify the cause?  Or should I file a separate issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-03-12T23:49:08.447+0000","updated":"2008-03-12T23:49:31.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12580808","id":"12580808","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Removing Fix-version for unassigned issues","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-20T16:10:47.710+0000","updated":"2008-03-20T16:10:47.710+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12386900/comment/12604040","id":"12604040","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I believe that this issue can be closed. The odd parameter passing between the compiler and the execution engine was cleaned up by Knut in his patch to DERBY-3616. I think there is an outstanding design issue of where we should coerce values coming out of the Java domain. What is implemented is coercion in the Derby result set which wraps  the Java ResultSet. Another proposal is to perform the coercion via casts above the wrapping Derby result set. If someone wants to pursue that, I think the effort merits its own JIRA and discussion.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2008-06-10T21:01:14.340+0000","updated":"2008-06-10T21:01:14.340+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3341/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06r8f:"}}