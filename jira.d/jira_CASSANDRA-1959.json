{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12495158","self":"https://issues.apache.org/jira/rest/api/latest/issue/12495158","key":"CASSANDRA-1959","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316031","id":"12316031","description":"","name":"0.6.10","archived":false,"released":true,"releaseDate":"2011-01-23"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315199","id":"12315199","description":"","name":"0.7.1","archived":false,"released":true,"releaseDate":"2011-02-14"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2011-01-11 08:21:54.802","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"1_*:*_1_*:*_103088779_*|*_5_*:*_1_*:*_0","customfield_12310420":"20382","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-01-11T23:41:56.022+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1959/watchers","watchCount":0,"isWatching":false},"created":"2011-01-10T19:03:47.243+0000","customfield_10022":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=messi","name":"messi","emailAddress":"messias at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Folke Behrens","active":true},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":14400,"aggregatetimeoriginalestimate":14400,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-12T04:09:59.264+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":14400,"description":"Hi,\r\n\r\nI added a node to the cluster (20 nodes in total) and ran repair on it after a while.\r\n\r\nThe repair still runs, but there are errors in the log file (see below).\r\n\r\nSome of the data in the clsuter has been filled with rc-4. The cluster runs on version 0.7.0 (the release linked on the main cassandra web site).\r\n\r\nAny ideas what might cause this?\r\n(PS. 0.7.0 turns up as unreleased version in Affects Version/s:) \r\n\r\n\r\nINFO [CompactionExecutor:1] 2011-01-10 19:55:20,684 SSTableReader.java (line 158) Opening /hd2/cassandra_md5/data/table_x/table_x-e-4\r\n INFO [CompactionExecutor:1] 2011-01-10 19:55:20,775 SSTableReader.java (line 158) Opening /hd2/cassandra_md5/data/table_x/table_x_meta-e-14\r\nERROR [RequestResponseStage:3] 2011-01-10 19:55:20,856 DebuggableThreadPoolExecutor.java (line 103) Error in ThreadPoolExecutor\r\njava.lang.ArrayIndexOutOfBoundsException: -1\r\n        at java.util.ArrayList.fastRemove(ArrayList.java:441)\r\n        at java.util.ArrayList.remove(ArrayList.java:424)\r\n        at com.google.common.collect.AbstractMultimap.remove(AbstractMultimap.java:219)\r\n        at com.google.common.collect.ArrayListMultimap.remove(ArrayListMultimap.java:60)\r\n        at org.apache.cassandra.net.MessagingService.responseReceivedFrom(MessagingService.java:436)\r\n        at org.apache.cassandra.net.ResponseVerbHandler.doVerb(ResponseVerbHandler.java:40)\r\n        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:63)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n        at java.lang.Thread.run(Thread.java:662)\r\nERROR [RequestResponseStage:3] 2011-01-10 19:55:20,856 AbstractCassandraDaemon.java (line 91) Fatal exception in thread Thread[RequestResponseStage:3,5,main]\r\njava.lang.ArrayIndexOutOfBoundsException: -1\r\n        at java.util.ArrayList.fastRemove(ArrayList.java:441)\r\n        at java.util.ArrayList.remove(ArrayList.java:424)\r\n        at com.google.common.collect.AbstractMultimap.remove(AbstractMultimap.java:219)\r\n        at com.google.common.collect.ArrayListMultimap.remove(ArrayListMultimap.java:60)\r\n        at org.apache.cassandra.net.MessagingService.responseReceivedFrom(MessagingService.java:436)\r\n        at org.apache.cassandra.net.ResponseVerbHandler.doVerb(ResponseVerbHandler.java:40)\r\n        at org.apache.cassandra.net.MessageDeliveryTask.run(MessageDeliveryTask.java:63)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\r\n        at java.lang.Thread.run(Thread.java:662)\r\n","customfield_10010":null,"timetracking":{"originalEstimate":"4h","remainingEstimate":"4h","originalEstimateSeconds":14400,"remainingEstimateSeconds":14400},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12468027","id":"12468027","filename":"1959-v2.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-01-11T17:24:33.320+0000","size":4776,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12468027/1959-v2.txt"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12468057","id":"12468057","filename":"post-1959-v2-cleanup.patch.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=messi","name":"messi","emailAddress":"messias at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Folke Behrens","active":true},"created":"2011-01-11T21:03:39.294+0000","size":15577,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12468057/post-1959-v2-cleanup.patch.txt"}],"customfield_12312340":null,"aggregatetimeestimate":14400,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"92799","summary":"java.lang.ArrayIndexOutOfBoundsException while executing repair on a freshly added node (0.7.0)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tbritz","name":"tbritz","emailAddress":"t dot britz at trendiction dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thibaut","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tbritz","name":"tbritz","emailAddress":"t dot britz at trendiction dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Thibaut","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":14400,"percent":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":14400,"percent":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495158/comment/12979989","id":"12979989","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=messi","name":"messi","emailAddress":"messias at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Folke Behrens","active":true},"body":"Looks like MessagingService.targets needs to be synchronized.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=messi","name":"messi","emailAddress":"messias at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Folke Behrens","active":true},"created":"2011-01-11T08:21:54.802+0000","updated":"2011-01-11T08:21:54.802+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495158/comment/12980174","id":"12980174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickmbailey","name":"nickmbailey","emailAddress":"nick at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Bailey","active":true},"body":"Looks like this was caused by CASSANDRA-1905. Or maybe just exposed by it.\r\n\r\nI think this may be particularly nasty due to the fact that droped responses will lead to inflated timings reported to the DynamicEndpointSnitch.  I'm not sure but I think this may be contributing to flapping in another case where I've seen this error.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nickmbailey","name":"nickmbailey","emailAddress":"nick at datastax dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Nick Bailey","active":true},"created":"2011-01-11T16:46:26.530+0000","updated":"2011-01-11T16:46:26.530+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495158/comment/12980193","id":"12980193","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Right, this is from 1905 and there's definitely a concurrency bug here.\r\n\r\nI don't want to use the synchronized multimap option though since *every* message hits this so we need better concurrency.  v2 is a patch that replaces multimap with a manually constructed Map of Sets.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2011-01-11T17:24:33.368+0000","updated":"2011-01-11T17:24:33.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495158/comment/12980330","id":"12980330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=messi","name":"messi","emailAddress":"messias at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Folke Behrens","active":true},"body":"I saw that you added putTarget() as instance method although targets itself is a static field. This patch cleans up these inconsistencies and makes MessagingService a true singleton.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=messi","name":"messi","emailAddress":"messias at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Folke Behrens","active":true},"created":"2011-01-11T21:03:39.336+0000","updated":"2011-01-11T21:03:39.336+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495158/comment/12980466","id":"12980466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra-0.7 #152 (See [https://hudson.apache.org/hudson/job/Cassandra-0.7/152/])\r\n    convert MessagingService into a true singleton\r\npatch by Folke Behrens; reviewed by jbellis for CASSANDRA-1959\r\nfix race condition in MessagingService.targets\r\npatch by jbellis; reviewed by Folke Behrens for CASSANDRA-1959\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-01-12T00:37:57.770+0000","updated":"2011-01-12T00:37:57.770+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12495158/comment/12980468","id":"12980468","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Cassandra-0.6 #49 (See [https://hudson.apache.org/hudson/job/Cassandra-0.6/49/])\r\n    backport CASSANDRA-1959 from 0.7\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2011-01-12T00:38:08.440+0000","updated":"2011-01-12T00:38:08.440+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-1959/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g8g7:"}}