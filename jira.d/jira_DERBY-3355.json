{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12387341","self":"https://issues.apache.org/jira/rest/api/latest/issue/12387341","key":"DERBY-3355","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313142","id":"12313142","description":"","name":"10.3.3.0","archived":false,"released":true,"releaseDate":"2008-05-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-01-29 17:29:42.619","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23591","customfield_12310222":"1_*:*_1_*:*_491763667_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_117375858","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-02-03T18:58:31.643+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3355/watchers","watchCount":0,"isWatching":false},"created":"2008-01-29T02:22:27.976+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2008-07-25T17:15:30.754+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"' is not a column in the target table., SQL State: 42X04, Error Code: -1\nHi:\nI think I have isolated a bug involving the use of double quotes to define a column name. Here s the SQL to reproduce the bug, followed by the error message generated by the final SQL statement. In order to make the bug go away, eliminate all use of double quotes in the SQL statements below. Note that the identical alter statement succeeds before the insert, and fail after. I have spent a long time trying to isolate this problem, so please take a look.\n\nCREATE TABLE Table2\n(\n   \"c\" VARCHAR(32672)\n);\n\nalter table Table2 ALTER COLUMN \"c\" NULL;\nalter table Table2 ALTER COLUMN \"c\" NOT NULL;\nINSERT INTO Table2(\"c\") VALUES('yo');\nalter table Table2 ALTER COLUMN \"c\" NULL;\nalter table Table2 ALTER COLUMN \"c\" NOT NULL;\n\n\nQuery 1 of 6 elapsed time (seconds) - Total: 0.012, SQL query: 0.012, Building output: 0\n\nQuery 2 of 6 elapsed time (seconds) - Total: 0.003, SQL query: 0.003, Building output: 0\n\nQuery 3 of 6 elapsed time (seconds) - Total: 0.003, SQL query: 0.003, Building output: 0\n1 Row(s) Inserted\nQuery 4 of 6 elapsed time (seconds) - Total: 0.009, SQL query: 0.009, Building output: 0\n\nQuery 5 of 6 elapsed time (seconds) - Total: 0.003, SQL query: 0.003, Building output: 0\nError: java.sql.SQLException: Column 'C' is either not in any table in the FROM list or appears within a join specification and is outside the scope of the join specification or appears in a HAVING clause and is not in the GROUP BY list. If this is a CREATE or ALTER TABLE  statement then 'C' is not a column in the target table., SQL State: 42X04, Error Code: -1\n\n\n-----Inline Message Follows-----\n\nGeoff hendrey wrote:\n> I think I have isolated a bug involving the use of double quotes to\n> define a column name.\n\nHi Geoff, I agree, that is definitely a bug. Your script reproduces\nthe problem for me, on the current Derby trunk.\n\nIt appears that AlterTableConstantAction.validateNotNullConstraint\nis internally generating and executing a statement of the form:\n\n    select count(*) from tab where not (col is not null)\n\nThe code which generates this SQL staement is not properly enclosing\nthe column name in double quotes, as you noticed, so the compiler\nconverts the column name to upper case, and gets the no-such-column error.\n\nCan you open a problem report in Jira so that we can track this down\nand get it fixed?\nhttp://db.apache.org/derby/DerbyBugGuidelines.html\n\nthanks,\n\nbryan","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39442","summary":"Alter Column ... NULL ignores double quotes around column name","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"mac 0s x","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":17,"total":17,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12563583","id":"12563583","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is 'patch.diff', a patch proposal.\r\n\r\nThe patch modifies AlterTableConstantAction.validateNotNullConstraint\r\nto enclose the column name in double quotes when generating\r\nSQL on-the-fly.\r\n\r\nThe patch also adds a variety of test cases to altertable.sql, based\r\non the repro script for this issue, using a variety of table and column\r\nnames in both mixed case and all upper case.\r\n\r\nI'm still running the full regression suite; I'll report back on the results.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-01-29T17:29:42.619+0000","updated":"2008-01-29T17:29:42.619+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12563592","id":"12563592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Any explanation for why the same statement worked once with \"c\" and then failed later?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2008-01-29T17:42:55.029+0000","updated":"2008-01-29T17:42:55.029+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12563599","id":"12563599","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"ALTER TABLE conditionally checks the not null constraint. It first looks\r\nto see if the table is empty or not, by calling getSemiRowCount, which\r\nclassifies the table into having 0, 1, or >1 rows. Then, if the table has\r\nat least 1 row, it generates and executes the problematic SQL with\r\nthe unquoted column name.\r\n\r\nSo the first invocation in the repro script succeeds because the table is empty.\r\n\r\nThe code in question is around line 2420 of AlterTableConstantAction.java:\r\n\r\n            if (cd.getType().isNullable())\r\n            {\r\n                if (numRows > 0)\r\n                {\r\n                    // already found a nullable column so add \"AND\"\r\n                    if (foundNullable)\r\n                        constraintText.append(\" AND \");\r\n                    constraintText.append(\"\\\"\" + columnNames[colCtr] +\r\n                        \"\\\" IS NOT NULL \");\r\n                }\r\n                foundNullable = true;\r\n                nullCols[colCtr] = true;\r\n            }\r\n\r\nThe first time through the repro script, numRows is 0.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-01-29T18:06:55.533+0000","updated":"2008-01-29T18:06:55.533+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12563687","id":"12563687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Suites.all and derbyall completed without errors. Please let me know of\r\nany feedback on the patch proposal.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-01-29T21:55:15.637+0000","updated":"2008-01-29T21:55:15.637+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564102","id":"12564102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Hi Bryan,\r\n\r\nI reviewed at the patch and it looks good to me.  The new test cases fail without the change and pass with it, as expected.\r\n\r\nTwo very minor things that occurred to me while reading the patch:\r\n\r\n  1. Might be nice (though not by any means necessary) to include a comment in AlterTableConstantAction\r\n      that explicitly mentions the motivation for double-quoting the column name.  On the other hand, maybe\r\n      the presence of the double quotes is itself enough to make that clear?  Not a big deal either way.\r\n\r\n  2. I instinctively found myself wondering if column names which had double quotes in them would work\r\n      correctly.  I ran some tests and the answer is Yes, they do work correctly.  Do you think it might be useful\r\n      to add a few test cases for that, just for completeness?  The quick tests that I ran were simply:\r\n\r\n      ij> create table t1 (\"\"\"c\"\"2\" int, \"\"\"\"\"C3\" int);\r\n      0 rows inserted/updated/deleted\r\n      ij> select * from t1;\r\n      \"c\"2       |\"\"C3\r\n      -----------------------\r\n\r\n      0 rows selected\r\n      ij> alter table t1 alter column \"\"\"c\"\"2\" not null;\r\n      0 rows inserted/updated/deleted\r\n      ij> insert into t1 values (null, 2);\r\n      ERROR 23502: Column '\"c\"2'  cannot accept a NULL value.\r\n      ij> alter table t1 alter column \"\"\"\"\"C3\" not null;\r\n      0 rows inserted/updated/deleted\r\n      ij> insert into t1 values (1, null);\r\n      ERROR 23502: Column '\"\"C3'  cannot accept a NULL value.\r\n      ij> alter table t1 alter column \"\"\"\"\"c3\" not null;\r\n      ERROR 42X14: '\"\"c3' is not a column in table or VTI 'T1'.\r\n      ij>   alter table t1 alter column \"\"\"c3\" not null;\r\n      ERROR 42X14: '\"c3' is not a column in table or VTI 'T1'.\r\n      ij> alter table t1 alter column \"c2\" not null;\r\n      ERROR 42X14: 'c2' is not a column in table or VTI 'T1'.\r\n      ij> alter table t1 alter column \"C3\" not null;\r\n      ERROR 42X14: 'C3' is not a column in table or VTI 'T1'.\r\n\r\nNeither of these nits should block the patch, though.  As the regression tests ran cleanly and I can see no other problems with the changes, I'm +1 to commit.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-01-30T17:21:07.263+0000","updated":"2008-01-30T17:21:07.263+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564114","id":"12564114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I'm not sure those quote examples prove anything, not a single one is executed after the table has rows in it, which is where the bug originally was.\r\n\r\nMy guess is that is does not work. The column name in the alter table is \"\"\"c\"\"2\", which will be converted to \"c\"2 internally (as a Java string),\r\nthen the SELECT to check the constraint will use   \"\"c\"2\" which will cause a syntax error.\r\n\r\nWhen writing an identifier as an input for a SQL statement as well as making it delimited value needs to have its double quotes escaped (by using two double quotes). Either no Derby code does this or there is a utility somewhere to output the CNF of an identifier in a form acceptable to a SQL statement.\r\n\r\nGood thinking to raise the issue though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2008-01-30T18:18:53.890+0000","updated":"2008-01-30T18:18:53.890+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564119","id":"12564119","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"> I'm not sure those quote examples prove anything, not a single one is\r\n> executed after the table has rows in it\r\n\r\nGood catch!  Sorry for missing that.  Building on the example I mentioned above:\r\n\r\n  ij> insert into t1 values (1, 2);\r\n  1 row inserted/updated/deleted\r\n  ij> alter table t1 alter column \"\"\"\"\"C3\" null;\r\n  0 rows inserted/updated/deleted\r\n  ij> alter table t1 alter column \"\"\"\"\"C3\" not null;\r\n  ERROR 42X01: Syntax error: Encountered \"\\\"\" at line 1, column 43.\r\n\r\nSo it looks like you're right, the quotes will lead to a syntax error.  Though the specific error in this case seems a tad odd...where'd the slash (\\) come from?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-01-30T18:34:09.201+0000","updated":"2008-01-30T18:34:09.201+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564125","id":"12564125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Dan and Army for the suggestions and fiendishly good tests!\r\n\r\nI cleared the patch available flag; I've got more work to do here.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-01-30T18:46:39.974+0000","updated":"2008-01-30T18:46:39.974+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564140","id":"12564140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"or in the spirit of open source and incremental development commit the patch and address the quote issues in a follow up patch.\r\n\r\nThe current patch improves the situation and makes most cases work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2008-01-30T19:29:14.308+0000","updated":"2008-01-30T19:29:14.308+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564223","id":"12564223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I tried running dblook against a database with Army's fiendish T1 table in it,\r\nand dblook politely produced:\r\n\r\n-- ----------------------------------------------\r\n-- DDL Statements for tables\r\n-- ----------------------------------------------\r\n\r\nCREATE TABLE \"APP\".\"T1\" (\"\"\"c\"\"2\" INTEGER, \"\"\"\"\"C3\" INTEGER);\r\n\r\nSo it seems that somewhere within the Derby source tree there is some code that\r\nunderstands how to take table and column names and properly enquote them.\r\n\r\nHopefully I can track that code down, and have a look to see if it can be easily\r\nrepurposed for use by the ALTER TABLE execution.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-01-30T23:42:24.044+0000","updated":"2008-01-30T23:42:24.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564226","id":"12564226","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Within the engine I think this will work:\r\n\r\n  org.apache.derby.iapi.util.IdUtil.normalToDelimited","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2008-01-30T23:46:10.719+0000","updated":"2008-01-30T23:46:10.719+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564549","id":"12564549","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Dan! IdUtil.normalToDelimited looks perfect.\r\n\r\nAttached is handleQuotes.diff, which uses IdUtil to\r\nhandle the construction of the properly delimited\r\nform of the column name, and also includes more\r\ntest cases in altertable.sql inspired by Army's test cases.\r\n\r\nAdditional feedback is welcome.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-01-31T23:33:25.731+0000","updated":"2008-01-31T23:33:25.731+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12564823","id":"12564823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"body":"Thanks for the updated patch, Bryan.  I re-ran my quoted-column-name queries and they all seem to be working correctly with handleQuotes.diff.  I see no other issues with the patch, so +1 to commit from me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=army","name":"army","emailAddress":"qozinx at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"A B","active":true},"created":"2008-02-01T16:51:09.203+0000","updated":"2008-02-01T16:51:09.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12565080","id":"12565080","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Committed handleQuotes.diff to the trunk as revision 617818.\r\n\r\nIf no additional problems show up over the next few days, I'll\r\ninvestigate merging this fix back to the 10.3 branch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-02-02T15:52:50.504+0000","updated":"2008-02-02T15:52:50.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12565187","id":"12565187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The merge to the 10.3 branch had no conflicts, and all the regression tests passed against 10.3.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-02-03T16:31:28.846+0000","updated":"2008-02-03T16:31:28.846+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12565202","id":"12565202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Committed the merged change to the 10.3 branch as revision 618054.\r\n\r\nThanks much to the reviewers for your help and suggestions!\r\n\r\nGeoff, if you can confirm that this fix works for you and close the issue,\r\nthat would be appeciated.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-02-03T18:58:31.571+0000","updated":"2008-02-03T18:58:31.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12387341/comment/12565633","id":"12565633","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"body":"I dowloaded the latest 10.3.2.2 build, and the problem seems to be fixed.  thanks for the rapid turnaround.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=geoff_hendrey","name":"geoff_hendrey","emailAddress":"geoff_hendrey at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"geoff hendrey","active":true},"created":"2008-02-05T03:34:47.478+0000","updated":"2008-02-05T03:34:47.478+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3355/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i07467:"}}