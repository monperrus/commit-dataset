{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12460748","self":"https://issues.apache.org/jira/rest/api/latest/issue/12460748","key":"CASSANDRA-936","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310865","id":"12310865","key":"CASSANDRA","name":"Cassandra","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310865&avatarId=12034","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310865&avatarId=12034","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310865&avatarId=12034","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310865&avatarId=12034"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/11961","id":"11961","description":"Apache Cassandra related projects","name":"Cassandra"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314867","id":"12314867","description":"","name":"0.6.1","archived":false,"released":true,"releaseDate":"2010-04-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2010-04-01 16:35:44.748","customfield_12312322":null,"customfield_12312323":null,"customfield_12310222":"1_*:*_1_*:*_511620052_*|*_5_*:*_1_*:*_0","customfield_12310420":"19926","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-04-05T19:54:29.820+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-936/watchers","watchCount":0,"isWatching":false},"created":"2010-03-30T21:47:29.768+0000","customfield_10022":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12311124":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-04-05T19:54:29.817+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312978","id":"12312978","name":"Core"}],"timeoriginalestimate":null,"description":"2010-03-30_21:19:02.31041 java.util.concurrent.ExecutionException: java.lang.RuntimeException: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1269983937410.log', position=8780)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.FutureTask.get(FutureTask.java:111)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor.afterExecute(DebuggableThreadPoolExecutor.java:86)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1118)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n2010-03-30_21:19:02.31041 \tat java.lang.Thread.run(Thread.java:636)\r\n2010-03-30_21:19:02.31041 Caused by: java.lang.RuntimeException: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1269983937410.log', position=8780)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n2010-03-30_21:19:02.31041 \t... 2 more\r\n2010-03-30_21:19:02.31041 Caused by: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1269983937410.log', position=8780)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.commitlog.CommitLog.discardCompletedSegments(CommitLog.java:358)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.ColumnFamilyStore$1.runMayThrow(ColumnFamilyStore.java:371)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)\r\n2010-03-30_21:19:02.31041 \t... 6 more\r\n2010-03-30_21:19:02.31041 Caused by: java.util.concurrent.ExecutionException: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1269983937410.log', position=8780)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.FutureTask.get(FutureTask.java:111)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.commitlog.CommitLog.discardCompletedSegments(CommitLog.java:350)\r\n2010-03-30_21:19:02.31041 \t... 8 more\r\n2010-03-30_21:19:02.31041 Caused by: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1269983937410.log', position=8780)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.commitlog.CommitLog.discardCompletedSegmentsInternal(CommitLog.java:378)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.commitlog.CommitLog.access$300(CommitLog.java:72)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.commitlog.CommitLog$6.call(CommitLog.java:344)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n2010-03-30_21:19:02.31041 \tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.commitlog.CommitLogExecutorService.process(CommitLogExecutorService.java:113)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.commitlog.CommitLogExecutorService.access$200(CommitLogExecutorService.java:35)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.db.commitlog.CommitLogExecutorService$1.runMayThrow(CommitLogExecutorService.java:67)\r\n2010-03-30_21:19:02.31041 \tat org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)\r\n2010-03-30_21:19:02.31041 \t... 1 more","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12440784","id":"12440784","filename":"936.txt","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-05T19:20:03.231+0000","size":1111,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12440784/936.txt"}],"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"91753","summary":"Discard Commitlog Exception","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dispalt","name":"dispalt","emailAddress":"dan dot dispaltro at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Di Spaltro","active":true},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dispalt","name":"dispalt","emailAddress":"dan dot dispaltro at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Di Spaltro","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"customfield_12311420":null,"customfield_12311421":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12460748/comment/12852442","id":"12852442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Thought I had this figured out but I was wrong.\r\n\r\nCan you turn on debug logging for the commitlog and include the log up to the next exception?\r\n\r\nYou can do this w/ JConsole under the service.StorageService MBean, Operations group, setLog4jLevel(org.apache.cassandra.db.commitlog, DEBUG)\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-01T16:35:44.748+0000","updated":"2010-04-01T16:35:44.748+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12460748/comment/12852894","id":"12852894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dispalt","name":"dispalt","emailAddress":"dan dot dispaltro at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Di Spaltro","active":true},"body":"2010-04-02_04:12:48.85690 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178196299.log); dirty is 1, \r\n2010-04-02_04:12:48.87690 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178421319.log); dirty is 1, \r\n2010-04-02_04:12:48.87690 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178736305.log); dirty is 1, 5, 15, \r\n2010-04-02_04:12:48.88690 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178971505.log); dirty is 1, 5, 15, \r\n2010-04-02_04:12:48.88690 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179198585.log); dirty is 1, 5, 15, \r\n2010-04-02_04:12:48.99689 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179421825.log); dirty is 1, 5, 7, 9, 15, 2010-04-02_04:12:49.01689 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179734722.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:12:49.04689 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179957332.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:12:49.05689 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180177252.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:12:49.16688 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180484668.log); dirty is 1, 9, 15, \r\n2010-04-02_04:12:49.21688 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180714597.log); dirty is 1, 6, 9, 12, 15, 16, \r\n2010-04-02_04:12:49.23688 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180931705.log); dirty is 1, 3, 5, 6, 9, 12, 14, 15, 16, \r\n2010-04-02_04:12:49.28688 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270181242081.log); dirty is 1, 3, 4, 5, 6, 9, 11, 12, 15, 16, \r\n2010-04-02_04:12:49.29688 DEBUG - Marking replay position 67674133 on commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270181459011.log)2010-04-02_04:14:33.32220 INFO - Rollup4h has reached its threshold; switching in a fresh Memtable at CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181459011.log', position=117622522)\r\n2010-04-02_04:14:33.33219 INFO - Enqueuing flush of Memtable(Rollup4h)@1686682813\r\n2010-04-02_04:14:33.34219 INFO - Writing Memtable(Rollup4h)@1686682813\r\n2010-04-02_04:14:36.60205 INFO - Completed flushing /var/lib/cassandra/data/MonitorApp/Rollup4h-2483-Data.db2010-04-02_04:14:36.60205 DEBUG - discard completed log segments for CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181459011.log', position=117622522), column family 16. CFIDs are {system: TableMetadata({LocationInfo: 0, HintsColumnFamily: 1, }), MonitorApp: TableMetadata({AppCounter: 2, Rollup5m: 3, Rollup20m: 4, TextChangeLog: 5, Rollup12h: 6, CheckDetails: 7, TextArchive: 8, StatusArchive: 9,\r\n NumericArchive: 10, Rollup30m: 11, Rollup1d: 12, StatusChangeLog: 15, ChangeLog: 13, MetricSummary: 14, Rollup60m: 17, Rollup4h: 16, RollupBookeeper: 18, }), }\r\n2010-04-02_04:14:36.60205 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270083637654.log); dirty is 0, 2010-04-02_04:14:36.67204 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270159986913.log); dirty is 10, 2010-04-02_04:14:36.72204 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178196299.log); dirty is 1, \r\n2010-04-02_04:14:36.74204 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178421319.log); dirty is 1, \r\n2010-04-02_04:14:36.80204 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178736305.log); dirty is 1, 5, 15, 2010-04-02_04:14:36.83204 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178971505.log); dirty is 1, 5, 15, \r\n2010-04-02_04:14:36.88204 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179198585.log); dirty is 1, 5, 15, \r\n2010-04-02_04:14:36.91203 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179421825.log); dirty is 1, 5, 7, 9, 15, \r\n2010-04-02_04:14:36.96203 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179734722.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:14:37.01203 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179957332.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:14:37.05203 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180177252.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:14:37.18202 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180484668.log); dirty is 1, 9, 15, \r\n2010-04-02_04:14:37.32202 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180714597.log); dirty is 1, 6, 9, 12, 15, 2010-04-02_04:14:37.35201 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180931705.log); dirty is 1, 3, 5, 6, 9, 12, 14, 15, \r\n2010-04-02_04:14:37.38201 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270181242081.log); dirty is 1, 3, 4, 5, 6, 9, 11, 12, 15, \r\n2010-04-02_04:14:37.40201 DEBUG - Marking replay position 117622522 on commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270181459011.log)\r\n2010-04-02_04:14:37.69200 INFO - Rollup12h has reached its threshold; switching in a fresh Memtable at CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181459011.log', position=130228458)\r\n2010-04-02_04:14:37.70200 INFO - Enqueuing flush of Memtable(Rollup12h)@298933940\r\n2010-04-02_04:14:37.70200 INFO - Writing Memtable(Rollup12h)@298933940\r\n2010-04-02_04:14:39.40192 INFO - Creating new commitlog segment /var/lib/cassandra/commitlog/CommitLog-1270181679401.log\r\n2010-04-02_04:14:39.44192 INFO - Rollup1d has reached its threshold; switching in a fresh Memtable at CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181679401.log', position=169)2010-04-02_04:14:39.45192 INFO - Enqueuing flush of Memtable(Rollup1d)@46303223\r\n2010-04-02_04:14:40.10189 INFO - Completed flushing /var/lib/cassandra/data/MonitorApp/Rollup12h-2511-Data.db\r\n2010-04-02_04:14:40.10189 INFO - Writing Memtable(Rollup1d)@46303223\r\n2010-04-02_04:14:40.10189 DEBUG - discard completed log segments for CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181459011.log', position=130228458), column family 6. CFIDs are {system: T\r\nableMetadata({LocationInfo: 0, HintsColumnFamily: 1, }), MonitorApp: TableMetadata({AppCounter: 2, Rollup5m: 3, Rollup20m: 4, TextChangeLog: 5, Rollup12h: 6, CheckDetails: 7, TextArchive: 8, StatusArchive: 9, \r\nNumericArchive: 10, Rollup30m: 11, Rollup1d: 12, StatusChangeLog: 15, ChangeLog: 13, MetricSummary: 14, Rollup60m: 17, Rollup4h: 16, RollupBookeeper: 18, }), }2010-04-02_04:14:40.10189 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270083637654.log); dirty is 0, \r\n2010-04-02_04:14:40.20189 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270159986913.log); dirty is 10, \r\n2010-04-02_04:14:40.25188 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178196299.log); dirty is 1, \r\n2010-04-02_04:14:40.27188 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178421319.log); dirty is 1, \r\n2010-04-02_04:14:40.30188 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178736305.log); dirty is 1, 5, 15, \r\n2010-04-02_04:14:40.40188 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270178971505.log); dirty is 1, 5, 15, \r\n2010-04-02_04:14:40.44187 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179198585.log); dirty is 1, 5, 15, \r\n2010-04-02_04:14:40.47187 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179421825.log); dirty is 1, 5, 7, 9, 15, \r\n2010-04-02_04:14:40.50187 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179734722.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:14:40.52187 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270179957332.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:14:40.54187 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180177252.log); dirty is 1, 5, 9, 15, \r\n2010-04-02_04:14:40.56187 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180484668.log); dirty is 1, 9, 15, \r\n2010-04-02_04:14:40.67186 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180714597.log); dirty is 1, 9, 12, 15, \r\n2010-04-02_04:14:40.68186 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270180931705.log); dirty is 1, 3, 5, 9, 12, 14, 15, \r\n2010-04-02_04:14:40.76186 DEBUG - Not safe to delete commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270181242081.log); dirty is 1, 3, 4, 5, 9, 11, 12, 15, \r\n2010-04-02_04:14:40.76186 DEBUG - Marking replay position 130228458 on commit log CommitLogSegment(/var/lib/cassandra/commitlog/CommitLog-1270181459011.log)\r\n2010-04-02_04:14:43.51174 INFO - Completed flushing /var/lib/cassandra/data/MonitorApp/Rollup1d-2568-Data.db\r\n2010-04-02_04:14:43.51174 DEBUG - discard completed log segments for CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181679401.log', position=169), column family 12. CFIDs are {system: TableMetadata({LocationInfo: 0, HintsColumnFamily: 1, }), MonitorApp: TableMetadata({AppCounter: 2, Rollup5m: 3, Rollup20m: 4, TextChangeLog: 5, Rollup12h: 6, CheckDetails: 7, TextArchive: 8, StatusArchive: 9, NumericArchive: 10, Rollup30m: 11, Rollup1d: 12, StatusChangeLog: 15, ChangeLog: 13, MetricSummary: 14, Rollup60m: 17, Rollup4h: 16, RollupBookeeper: 18, }), }\r\n2010-04-02_04:14:43.52174 ERROR - Error in executor futuretask\r\n2010-04-02_04:14:43.52174 java.util.concurrent.ExecutionException: java.lang.RuntimeException: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181679401.log', position=169)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.FutureTask.get(FutureTask.java:111)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.concurrent.DebuggableThreadPoolExecutor.afterExecute(DebuggableThreadPoolExecutor.java:86)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1118)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n2010-04-02_04:14:43.52174       at java.lang.Thread.run(Thread.java:636)\r\n2010-04-02_04:14:43.52174 Caused by: java.lang.RuntimeException: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181679401.log', position=169)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:34)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n2010-04-02_04:14:43.52174       ... 2 more\r\n2010-04-02_04:14:43.52174 Caused by: java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181679401.log', position=169)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.commitlog.CommitLog.discardCompletedSegments(CommitLog.java:358)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.ColumnFamilyStore$1.runMayThrow(ColumnFamilyStore.java:371)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)\r\n2010-04-02_04:14:43.52174       ... 6 more\r\n2010-04-02_04:14:43.52174 Caused by: java.util.concurrent.ExecutionException: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181679401.log', position=169)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:252)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.FutureTask.get(FutureTask.java:111)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.commitlog.CommitLog.discardCompletedSegments(CommitLog.java:350)\r\n2010-04-02_04:14:43.52174       ... 8 more\r\n2010-04-02_04:14:43.52174 Caused by: java.lang.AssertionError: discard called on obsolete context CommitLogContext(file='/var/lib/cassandra/commitlog/CommitLog-1270181679401.log', position=169)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.commitlog.CommitLog.discardCompletedSegmentsInternal(CommitLog.java:378)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.commitlog.CommitLog.access$300(CommitLog.java:72)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.commitlog.CommitLog$6.call(CommitLog.java:344)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n2010-04-02_04:14:43.52174       at java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.commitlog.CommitLogExecutorService.process(CommitLogExecutorService.java:113)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.commitlog.CommitLogExecutorService.access$200(CommitLogExecutorService.java:35)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.db.commitlog.CommitLogExecutorService$1.runMayThrow(CommitLogExecutorService.java:67)\r\n2010-04-02_04:14:43.52174       at org.apache.cassandra.utils.WrappedRunnable.run(WrappedRunnable.java:30)\r\n2010-04-02_04:14:43.52174       ... 1 more\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dispalt","name":"dispalt","emailAddress":"dan dot dispaltro at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Di Spaltro","active":true},"created":"2010-04-02T18:02:52.281+0000","updated":"2010-04-02T18:02:52.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12460748/comment/12852895","id":"12852895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dispalt","name":"dispalt","emailAddress":"dan dot dispaltro at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Di Spaltro","active":true},"body":"Those are the log lines before the exception with the commitlog debugging on full.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dispalt","name":"dispalt","emailAddress":"dan dot dispaltro at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dan Di Spaltro","active":true},"created":"2010-04-02T18:04:08.407+0000","updated":"2010-04-02T18:04:08.407+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12460748/comment/12853498","id":"12853498","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"Okay, here's what's happening.\r\n\r\nThe assert in question is\r\n        assert context.position > context.getSegment().getHeader().getPosition(id) : \"discard called on obsolete context \" + context;\r\n\r\nThe first argument, context.position, is \"the position in the current commitlog segment at the time the currently-finishing flush began.\"  The second argument is \"the position we wrote in the commitlog segment header showing where the position was for last-completed flush.\"  If the current flush position is less than the last flush position, then the last flush potentially deleted segments whose data wasn't turned into sstables yet, which would be Very Bad.  If the positions are equal, that would mean we're flushing a CF that hasn't had any new data since the last one, which isn't supposed to happen either.\r\n\r\nBut, there's a discontinuity in the position measuring, and that's when a new commitlog context is swapped in.  Let me give a diagram here of the CL segement's contents:\r\n\r\n{code}\r\nXXXXXXXXXXXXXXYYYYYYYYYYYYYYZZZZZZZZZZZZZ\r\n0             H             F            etc\r\n{code}\r\n\r\nThe first H bytes are the header.  From H to position F represents the first mutation written to the fresh segment.\r\n\r\nNormally, if you force a memtable to flush after a new commitlog segment is rolled in, one of two things will happen:\r\n\r\n(1) you will flush with a context position of H, and a header lastFlushedPosition of 0 (the initial value) or\r\n(2) you will flush with a context position of F or higher, and a header lastFlushedPosition of H (after some writes occur)\r\n\r\nBut, if the flush context gets measured at H before any writes happen, THEN A WRITE OCCURS DURING THE FLUSH BEFORE THE DISCARD PHASE, you will have context position == lastFlushedPosition == H, because making a write calls turnOn which edits lastFlushedAt, even though no flushes have occurred, because lastFlushedAt is also semantically startReplayAt, and 0 is not a valid place to start mutation replay.  So in the latest stacktrace, H == 169, and it's failing in exactly this scenario.\r\n\r\nThe least invasive fix for this in 0.6 is to change the assert from > to >=.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-05T19:20:03.235+0000","updated":"2010-04-05T19:42:45.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12460748/comment/12853508","id":"12853508","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"body":"+1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=gdusbabek","name":"gdusbabek","emailAddress":"gdusbabek at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=gdusbabek&avatarId=10070","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=gdusbabek&avatarId=10070","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=gdusbabek&avatarId=10070","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=gdusbabek&avatarId=10070"},"displayName":"Gary Dusbabek","active":true},"created":"2010-04-05T19:49:32.302+0000","updated":"2010-04-05T19:49:32.302+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12460748/comment/12853516","id":"12853516","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"body":"committed","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jbellis","name":"jbellis","emailAddress":"jbellis at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jbellis&avatarId=18380","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jbellis&avatarId=18380","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jbellis&avatarId=18380","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jbellis&avatarId=18380"},"displayName":"Jonathan Ellis","active":true},"created":"2010-04-05T19:54:29.816+0000","updated":"2010-04-05T19:54:29.816+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/CASSANDRA-936/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0g1zr:"}}