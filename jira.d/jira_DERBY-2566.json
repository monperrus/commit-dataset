{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12367571","self":"https://issues.apache.org/jira/rest/api/latest/issue/12367571","key":"DERBY-2566","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312251","id":"12312251","description":"Head of 10.2 branch","name":"10.2.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-04-19 14:18:43.961","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23106","customfield_12310222":"1_*:*_1_*:*_258138590_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-04-22T12:32:18.721+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2566/watchers","watchCount":0,"isWatching":false},"created":"2007-04-19T12:50:00.131+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312027","id":"12312027","description":"","name":"10.2.2.0","archived":false,"released":true,"releaseDate":"2006-12-19"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:50:06.598+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"If you run this application:\n\n-------- 8< -------\nimport java.sql.*;\nimport java.util.*;\n\npublic class DerbyBug4 {\n    private static String x;\n    private static Random random = new Random(0);\n    private static final int DB_SIZE = 10000;\n\n    public static void main(String[] args) throws Exception {\n        final StringBuilder sbX = new StringBuilder();\n        for (int i = 0; i < 65535; i++) {\n            sbX.append('X');\n        }\n        x = sbX.toString();\n        Class.forName(\"org.apache.derby.jdbc.EmbeddedDriver\");\n        final Connection con =\n            DriverManager.getConnection(\"jdbc:derby:bug;create=true\");\n        createAndFillDatabase(con);\n        updateDatabase(con);\n        con.close();\n    }\n\n    private static void updateDatabase(final Connection con) throws SQLException {\n        final Statement stm = con.createStatement(ResultSet.TYPE_FORWARD_ONLY,\n                ResultSet.CONCUR_UPDATABLE);\n        final ResultSet rs = stm.executeQuery(\"SELECT * FROM journal FOR UPDATE\");\n        for (int row = 1; rs.next(); row++) {\n            update(rs, \"ip\");\n            update(rs, \"sender\");\n            update(rs, \"recipient\");\n            update(rs, \"mailsender\");\n            update(rs, \"mailfrom\");\n            update(rs, \"mailto\");\n            update(rs, \"cc\");\n            update(rs, \"bcc\");\n            update(rs, \"replyto\");\n            update(rs, \"subject\");\n            update(rs, \"attachments\");\n            update(rs, \"status\");\n            update(rs, \"reason\");\n            rs.updateInt(\"totallength\", 0);\n            rs.updateDouble(\"spamscore\", 0);\n            rs.updateRow();\n            if (row % 500 == 0) {\n                System.out.println(\"update: \" + row);\n            }\n        }\n        rs.close();\n        stm.close();\n    }\n\n    private static void createAndFillDatabase(Connection con)\n    throws SQLException {\n        final Statement stm = con.createStatement();\n        stm.executeUpdate(\"CREATE TABLE journal(\"\n                + \"ID VARCHAR(20) PRIMARY KEY default '' NOT NULL,\"\n                + \"IP VARCHAR(45) default '' NOT NULL,\"\n                + \"SENDER VARCHAR(32000) default '' NOT NULL,\"\n                + \"RECIPIENT VARCHAR(32000) default '' NOT NULL,\"\n                + \"MAILSENDER VARCHAR(32000) default '' NOT NULL,\"\n                + \"MAILFROM VARCHAR(32000) default '' NOT NULL,\"\n                + \"MAILTO VARCHAR(32000) default '' NOT NULL,\"\n                + \"CC VARCHAR(32000) default '' NOT NULL,\"\n                + \"BCC VARCHAR(32000) default '' NOT NULL,\"\n                + \"REPLYTO VARCHAR(32000) default '' NOT NULL,\"\n                + \"MAILDATE TIMESTAMP default '0001-01-01 00:00:00',\"\n                + \"RECEIVEDDATE TIMESTAMP default '0001-01-01 00:00:00' NOT NULL,\"\n                + \"SUBJECT VARCHAR(32000) default '' NOT NULL,\"\n                + \"TOTALLENGTH BIGINT default 0 NOT NULL,\"\n                + \"ATTACHMENTS VARCHAR(32000) default '' NOT NULL,\"\n                + \"SPAMSCORE DOUBLE NOT NULL,\"\n                + \"STATUS VARCHAR(11) default 'aborted' NOT NULL,\"\n                + \"REASON VARCHAR(32000) NOT NULL)\");\n        con.commit();\n        stm.close();\n        \n        final PreparedStatement pstm = con.prepareStatement(\n                \"INSERT INTO journal VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)\");\n        for (int i = 0; i < DB_SIZE; i++) {\n            int col = 1;\n            pstm.setString(col++, Integer.toHexString(i));\n            doRandom(pstm, col++, 45);\n            doRandom(pstm, col++, 10);\n            doRandom(pstm, col++, 10);\n            doRandom(pstm, col++, 5);\n            doRandom(pstm, col++, 20);\n            doRandom(pstm, col++, 20);\n            doRandom(pstm, col++, 40);\n            doRandom(pstm, col++, 5);\n            doRandom(pstm, col++, 20);\n            pstm.setTimestamp(col++, random.nextBoolean()\n                                     ? new Timestamp(System.currentTimeMillis())\n                                     : null);\n            pstm.setTimestamp(col++, new Timestamp(System.currentTimeMillis()));\n            doRandom(pstm, col++, 80);\n            pstm.setInt(col++, random.nextInt(10000000));\n            doRandom(pstm, col++, 500);\n            pstm.setDouble(col++, random.nextDouble() * 10);\n            doRandom(pstm, col++, 11);\n            doRandom(pstm, col++, 100);\n            \n            pstm.executeUpdate();\n            if (i % 500 == 0) {\n                con.commit();\n                System.out.println(\"insert: \" + i);\n            }\n        }\n        con.commit();\n        pstm.close();\n    }\n\n    private static void doRandom(PreparedStatement pstm, int pos, int length)\n    throws SQLException {\n        pstm.setString(pos, x.substring(0, random.nextInt(length)));\n    }\n    \n    private static void update(final ResultSet rs, final String field)\n    throws SQLException {\n        rs.updateString(field, x.substring(0, rs.getString(field).length()));\n    }\n}\n-------- 8< -------\n\nyou will get this exception:\n\nException in thread \"main\" java.lang.OutOfMemoryError: Java heap space\n\tat org.apache.derby.iapi.services.io.DynamicByteArrayOutputStream.<init>(Unknown Source)\n\tat org.apache.derby.impl.store.raw.data.StoredPage.storeRecordForUpdate(Unknown Source)\n\tat org.apache.derby.impl.store.raw.data.StoredPage.storeRecord(Unknown Source)\n\tat org.apache.derby.impl.store.raw.data.UpdateOperation.doMe(Unknown Source)\n\tat org.apache.derby.impl.store.raw.log.FileLogger.logAndDo(Unknown Source)\n\tat org.apache.derby.impl.store.raw.xact.Xact.logAndDo(Unknown Source)\n\tat org.apache.derby.impl.store.raw.data.LoggableActions.doAction(Unknown Source)\n\tat org.apache.derby.impl.store.raw.data.LoggableActions.actionUpdate(Unknown Source)\n\tat org.apache.derby.impl.store.raw.data.StoredPage.doUpdateAtSlot(Unknown Source)\n\tat org.apache.derby.impl.store.raw.data.BasePage.updateAtSlot(Unknown Source)\n\tat org.apache.derby.impl.store.access.conglomerate.GenericConglomerateController.replace(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.RowChangerImpl.updateRow(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.UpdateResultSet.collectAffectedRows(Unknown Source)\n\tat org.apache.derby.impl.sql.execute.UpdateResultSet.open(Unknown Source)\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\n\tat org.apache.derby.impl.jdbc.EmbedResultSet.updateRow(Unknown Source)\n\tat DerbyBug4.updateDatabase(DerbyBug4.java:43)\n\tat DerbyBug4.main(DerbyBug4.java:19)\n\n\nIf you enable sanity checks, then this exception occurs:\n\nException in thread \"main\" org.apache.derby.shared.common.sanity.AssertFailure: ASSERT FAILED statementContext is not expected to equal statementContexts[0]\n\tat org.apache.derby.shared.common.sanity.SanityManager.ASSERT(SanityManager.java:120)\n\tat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.popStatementContext(GenericLanguageConnectionContext.java:2095)\n\tat org.apache.derby.impl.jdbc.EmbedResultSet.updateRow(EmbedResultSet.java:3773)\n\tat DerbyBug4.updateDatabase(DerbyBug4.java:43)\n\tat DerbyBug4.main(DerbyBug4.java:19)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37457","summary":"OutOfMemory/Sanity-assert failed when updating database","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kurti","name":"kurti","emailAddress":"apache at huwig dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kurt Huwig","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kurti","name":"kurti","emailAddress":"apache at huwig dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kurt Huwig","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Sun JDK 1.6-b105, Linux 2.6.20\nSun JDK 1.5, Solaris 10","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":12,"total":12,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490075","id":"12490075","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Copied the code provided by Kurt in the comment into a file and renamed the class.\r\nI tried running it with both 10.2.2.0 and current trunk (revision 530343), and they both fail as described.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2007-04-19T14:18:43.961+0000","updated":"2007-04-19T14:18:43.961+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490076","id":"12490076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Added versions 10.1.3.1 and 10.3 (trunk) to the list of affected versions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2007-04-19T14:22:12.563+0000","updated":"2007-04-19T14:22:12.563+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490107","id":"12490107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"I would suggest someone with good knowledge of the object allocations down in store/access took a look at the heap for this one.\r\nOne way to do this would be to use the Java SE 6 platform, run Java with -XX:+HeapDumpOnOutOfMemoryError and then use jhat (remember to increase the heap size for jhat with -J-XmxNNNm).\r\n\r\nFor a quick reference, here are the topmost results with TYPE_FORWARD_ONLY:\r\n242175 instances of class [C\r\n241126 instances of class [[C\r\n241023 instances of class org.apache.derby.iapi.types.SQLVarchar\r\n232557 instances of class java.lang.String\r\n131700 instances of class org.apache.derby.impl.sql.GenericParameter\r\n21353 instances of class org.apache.derby.impl.store.raw.data.StoredRecordHeader\r\n18636 instances of class org.apache.derby.iapi.types.SQLLongint\r\n18126 instances of class org.apache.derby.iapi.types.SQLTimestamp\r\n17843 instances of class org.apache.derby.iapi.types.SQLDouble\r\n10343 instances of class [Lorg.apache.derby.iapi.types.DataValueDescriptor;\r\n9344 instances of class org.apache.derby.impl.sql.execute.ValueRow\r\n9060 instances of class org.apache.derby.iapi.types.SQLRef\r\n8866 instances of class [Ljava.util.HashMap$Entry;\r\n8863 instances of class java.util.HashMap\r\n8808 instances of class java.util.HashSet\r\n8781 instances of class org.apache.derby.impl.sql.GenericParameterValueSet\r\n8781 instances of class [Lorg.apache.derby.iapi.sql.execute.ExecRow;\r\n8781 instances of class [Lorg.apache.derby.impl.sql.GenericParameter;\r\n8780 instances of class org.apache.derby.exe.ac07170079x0112x0ab4x5432x0000003d4b882\r\n8780 instances of class org.apache.derby.impl.sql.execute.CurrentOfResultSet\r\n7909 instances of class org.apache.derby.impl.store.raw.data.RecordId\r\n4100 instances of class [B \r\n\r\n\r\nFor a quick reference, here are the topmost results with TYPE_SCROLL_INSENSITIVE:\r\nInstance Counts for All Classes (including platform)\r\n310979 instances of class [[C\r\n310876 instances of class org.apache.derby.iapi.types.SQLVarchar\r\n174638 instances of class [C\r\n162253 instances of class java.lang.String\r\n84765 instances of class org.apache.derby.impl.sql.GenericParameter\r\n34000 instances of class [Lorg.apache.derby.iapi.types.DataValueDescriptor;\r\n33916 instances of class org.apache.derby.iapi.types.SQLTimestamp\r\n22766 instances of class org.apache.derby.iapi.types.SQLLongint\r\n22609 instances of class org.apache.derby.iapi.types.SQLDouble\r\n17113 instances of class [Z\r\n16958 instances of class org.apache.derby.impl.sql.execute.ValueRow\r\n14337 instances of class org.apache.derby.impl.store.raw.data.StoredRecordHeader\r\n11575 instances of class [B\r\n11306 instances of class org.apache.derby.impl.store.access.conglomerate.OpenConglomerateScratchSpace\r\n11303 instances of class org.apache.derby.impl.sql.execute.IndexRow\r\n11302 instances of class org.apache.derby.iapi.types.SQLRef\r\n8693 instances of class org.apache.derby.impl.store.raw.data.RecordId\r\n5786 instances of class org.apache.derby.iapi.services.io.FormatableBitSet\r\n5744 instances of class [Ljava.util.HashMap$Entry;\r\n5741 instances of class java.util.HashMap \r\n\r\nIf I change the repro to commit for every 500 updates, it runs without error with SCROLL_INSENSITIVE. However, it performs a lot of GC (also some full GC), but maybe this is to be expected in this case?\r\nLast, it is not clear to me what is going on after the update phase. The repro takes a long time to finish up after all the records have been updated; rs.close - 16 s, stmt.close - 0 s, con.close - 31 s. CPU utilization is 100% in this period. Traversing a long list of some kind?\r\n\r\nEven with a commit for every 500 updates, the repro does not complete with TYPE_FORWARD_ONLY. GC goes crazy...\r\n\r\nAnyone got any ideas about this?\r\n\r\n\r\n(FYI, I won't be working on this issue.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2007-04-19T16:51:16.212+0000","updated":"2007-04-19T16:51:16.212+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490116","id":"12490116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kurti","name":"kurti","emailAddress":"apache at huwig dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kurt Huwig","active":true},"body":"I've got a JProfile license, so I can do memory profiling if anyone points me in the right direction.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kurti","name":"kurti","emailAddress":"apache at huwig dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kurt Huwig","active":true},"created":"2007-04-19T17:16:37.052+0000","updated":"2007-04-19T17:16:37.052+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490134","id":"12490134","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"EmbedResultSet.updateRow() creates an activation which isn't closed. With the attached patch (closeactivation.diff) I managed to run the repro with no errors. I haven't run any other tests on the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-04-19T18:38:56.135+0000","updated":"2007-04-19T18:38:56.135+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490140","id":"12490140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"If closing the activation is the correct fix, it looks like there are multiple cases in this file where activation does not get closed:deleteRow(), updateRow(), insertRow(), ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2007-04-19T18:54:09.204+0000","updated":"2007-04-19T18:54:09.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490150","id":"12490150","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I have started derbyall/suites.All with act.close() added to the three methods Mike mentioned. I think the alternative is to do it in CurrentOfResultSet's finalizer, but it sounds cleaner to me to close the activations explicitly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-04-19T19:36:55.588+0000","updated":"2007-04-19T19:36:55.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490294","id":"12490294","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Derbyall and suites.All ran cleanly with the patch that closed the activations used in updateRow(), deleteRow() and insertRow().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-04-20T09:40:10.647+0000","updated":"2007-04-20T09:40:10.647+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490721","id":"12490721","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed revision 531170.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-04-22T12:32:18.640+0000","updated":"2007-04-22T12:32:18.640+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490724","id":"12490724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kurti","name":"kurti","emailAddress":"apache at huwig dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kurt Huwig","active":true},"body":"Will this be ported to 10.2.2.0? I mean Derby should not crash when updating several thoundsands of records, should it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kurti","name":"kurti","emailAddress":"apache at huwig dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kurt Huwig","active":true},"created":"2007-04-22T13:51:22.981+0000","updated":"2007-04-22T13:51:22.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490727","id":"12490727","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"No, it's not supposed to crash. :)\r\nI'll back-port the fix to 10.2.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-04-22T14:06:36.830+0000","updated":"2007-04-22T14:06:36.830+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12367571/comment/12490817","id":"12490817","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed to the 10.2 branch with revision 531345.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2007-04-23T06:11:50.628+0000","updated":"2007-04-23T06:11:50.628+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2566/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06rx3:"}}