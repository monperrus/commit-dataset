{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"30281","self":"https://issues.apache.org/jira/rest/api/latest/issue/30281","key":"DERBY-151","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-08-17 08:15:46.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"21800","customfield_12310222":"3_*:*_1_*:*_183661145_*|*_1_*:*_1_*:*_150694339052_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-12-03T22:33:48.197+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-151/watchers","watchCount":7,"isWatching":false},"created":"2005-02-21T16:00:28.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"10.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10991","id":"10991","description":"snapshot","name":"10.0.2.1","archived":false,"released":true,"releaseDate":"2004-12-06"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12328127","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12328127","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12442460","key":"DERBY-4461","self":"https://issues.apache.org/jira/rest/api/2/issue/12442460","fields":{"summary":"'testD151(...Derby151Test)java.sql.SQLException: Failed to start database' (and more ...) on Suse EE S 10 Linux/IBM 1.6.0, Fedora Core 5/Sun 1.6.0-b105, Win XP/Sun 1.6.0_10","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12328397","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12328397","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12443691","key":"DERBY-4481","self":"https://issues.apache.org/jira/rest/api/2/issue/12443691","fields":{"summary":"multiple log related errors (e.g. ERROR XSLAL in MultiByteClobTest ) started occuring intermittently  in IBM 1.5 runs","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12332947","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12332947","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12469090","key":"DERBY-4741","self":"https://issues.apache.org/jira/rest/api/2/issue/12469090","fields":{"summary":"Make embedded Derby work reliably in the presence of thread interrupts","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12328181","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12328181","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12442673","key":"DERBY-4463","self":"https://issues.apache.org/jira/rest/api/2/issue/12442673","fields":{"summary":"JMX test in nightly test suite failed with:  JMXTest:clientjava.lang.InterruptedException:  ","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12334057","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334057","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12474924","key":"DERBY-4813","self":"https://issues.apache.org/jira/rest/api/2/issue/12474924","fields":{"summary":"TriggerTests failed to apply log record to store","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:48:11.864+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"I've encountered what appears to be a bug related to threading. After an INSERT operation, if the invoking thread terminates too quickly, Derby throws an XSDG.\r\n\r\nThe bug is a bit difficult to isolate but it occurs consistently in the following situation (with a particular database and an operation of a particular size):\r\n\r\nDerby is running in embedded mode with autocommit on.  \r\nThe application performs an INPUT operation from a thread that is not the main thread.  The INPUT is issued using a PreparedStatement.  The INPUT adds ~ 256 records of six fields each. (Note that INSERTs of this size seem to work fine in other contexts.)\r\n \r\nThe preparedStatement.executeUpdate() seems to excute successfully; at least it returns without throwing an exception. \r\n\r\nThe thread that invoked the INPUT operation then terminates (but NOT the application).  The next INPUT operation then results in an\r\n\r\n\"ERROR XSDG1: Page Page(7,Container(0, 1344)) could not be written to disk, please check if disk is full.\"\r\n\r\nThe disk is definitely not full.\r\n\r\nHOWEVER, if I put the calling thread to sleep for a second before it exits, the problem does not occur.\r\n\r\nI'm not quite sure what to make of this.  I was under the impression that most of Derby's activity occurs in the application's threads.  Could Derby be creating a child thread from in the application thread, which dies when the parent thread terminates?\r\n\r\nThanks\r\n\r\n\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10421","value":"Seen in production","id":"10421"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37608","summary":"Thread termination -> XSDG after operation is 'complete'","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bd49","name":"bd49","emailAddress":"b dot wagman at comcast dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barnet Wagman","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bd49","name":"bd49","emailAddress":"b dot wagman at comcast dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Barnet Wagman","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Linux kernel 2.4.21-243-athlon (SuSE 9.0)","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":26,"total":26,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12318946","id":"12318946","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"Without some sort of reproducible case, don't think this issue will be addressed.  Also always include all the \r\nstack trace information from derby.log whenever possible.  \r\n\r\nMy best guess is that somehow a thread interrupt is being sent to the thread issuing the I/O, possibly the interrupt\r\nis even being posted to the thread before the execute statement is being called?  \r\n\r\nTo answer the question, the I/O described above could be issued either by the thread doing the insert , or it could\r\nbe issued by a background thread executing a checkpoint.  The stack track would tell which.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2005-08-17T08:15:46.000+0000","updated":"2005-08-17T08:15:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12327401","id":"12327401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"body":"I'm seeing the same, on Windows XP (Derby 10.1.1.0). Here's my stacktrace:\r\n\r\n[main][14.09.2005 16:37:36,115] DEBUG Request.java:66 - INSERT INTO KUENSTLER (LEBENSDATEN,LITERATUR,GEBURTS_ORT,KUENSTLER_NAME,LEGACY_ID,\"NAME\",GEBURTSDATUM,LAST_MODIFICATION,ERGAENZUNGEN,ADRESSE,GESCHLECHT,STERBEDATUM,VORNAME,BIOGRAPHIE,ID) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)\r\nERROR XSDG1: Page Page(7,Container(0, 1088)) could not be written to disk, please check if disk is full.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.CachedPage.writePage(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.CachedPage.createIdentity(Unknown Source)\r\n\tat org.apache.derby.impl.services.cache.CachedItem.takeOnIdentity(Unknown Source)\r\n\tat org.apache.derby.impl.services.cache.Clock.addEntry(Unknown Source)\r\n\tat org.apache.derby.impl.services.cache.Clock.create(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.FileContainer.initPage(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.FileContainer.newPage(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.BaseContainer.addPage(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(Unknown Source)\r\n\tat org.apache.derby.impl.store.access.heap.HeapController.doInsert(Unknown Source)\r\n\tat org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(Unknown Source)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"created":"2005-09-14T23:41:52.000+0000","updated":"2005-09-14T23:41:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12327827","id":"12327827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"body":"I might add that the disk is not full, and in contrast to the original poster, it doesn't seem to be a threading issue. As the stacktrace shows, it is the thread that issued the UPDATE statement that gets the exception.\r\n\r\nI've got the following non-default page cache settings:\r\n\r\nderby.storage.pageCacheSize = 320\r\nderby.storage.pageSize = 16384","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"created":"2005-09-14T23:46:45.000+0000","updated":"2005-09-14T23:46:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12329329","id":"12329329","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"derby.log  occasional has more information than the above stack mentioned.   In most cases , some sort of  IO  exception has\r\nto happen for  the above error to occur,  all  the exception are nested inside the SQL Exception.    If the derby.log file is still around , \r\nplease attach it  to the jira. \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2005-09-15T02:53:33.000+0000","updated":"2005-09-15T02:53:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12329335","id":"12329335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"body":"Alright, I didn't think of that! Here's the log (I think the last shutdown can be ignored).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"created":"2005-09-15T03:19:46.000+0000","updated":"2005-09-15T03:19:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12329336","id":"12329336","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"body":"Sorry, that was the wrong log! Could someone please delete it? It seems I can't.\r\nHere's the correct one (derby.log)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"created":"2005-09-15T03:21:28.000+0000","updated":"2005-09-15T03:21:28.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12329341","id":"12329341","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"Real cause for the error(ERROR XSDG1: Page Page(7,Container(0, 1088)) could not be written to disk, please check if disk is full. ) is :\r\njava.nio.channels.ClosedByInterruptException\r\n\tat java.nio.channels.spi.AbstractInterruptibleChannel.end(Unknown Source)\r\n\tat sun.nio.ch.FileChannelImpl.force(Unknown Source)\r\n\tat org.apache.derby.impl.io.DirRandomAccessFile4.sync(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.RAFContainer.writePage(Unknown Source)\r\n\tat org.apache.derby.impl.store.raw.data.CachedPage.writePage(Unknown Source)\r\n                     ............\r\n\r\nfile sync is being interrupted , because user is interrupting the thread that is doing the database activity. \r\nMay the  Interrupt exception should be caught  .. and reissue the sync if possible and also generate better error \r\nif  it can not be synced even on a second attempt .  Discussion about transaction log on the user list:\r\nhttp://www.mail-archive.com/derby-user@db.apache.org/msg01577.html\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2005-09-15T03:54:26.000+0000","updated":"2005-09-15T03:54:26.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12329353","id":"12329353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"body":"Trying to catch ClosedByInterruptException in RAFContainer would give a dependency on Java 1.4. Not sure whether that is wanted, and I'm having a bit of a hard time to get build.xml compile it (there is 1.4 classes being used in impl.io without problems?!)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"created":"2005-09-15T05:08:52.000+0000","updated":"2005-09-15T05:08:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12329367","id":"12329367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"body":"For any Eclipse-plugin, Swing or GUI programmers in general seeing this bug: writing to the embedded DB from the UI thread is a bad idea, as that thread gets interrupted very frequently. Moving write operations into their own thread solved the problem for stupid me. \r\nCheers!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jfrantzius","name":"jfrantzius","emailAddress":"jfrantzius at googlemail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jörg von Frantzius","active":true},"created":"2005-09-15T08:08:18.000+0000","updated":"2005-09-15T08:08:18.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12378722","id":"12378722","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I was wondering if anyone  could provide some expanded information on this issue. I am really not all that familiar with running Derby in eclipse and have \r\nsome probably very basic questions which are:\r\n\r\n\r\n1)  I was wondering if  anyone  had some information on accessing Derby \r\nfrom within eclipse and avoiding ClosedByInterruptException  as \r\ndescribed in  DERBY-151.  Do you always need to launch a separate thread for any Derby access when running in eclipse?\r\n\r\n2)  If the answer to #1 is \"Yes\",  is there a Derby solution to this problem that is possible or is it strictly a user issue, for example, if the retry was implemented would that eliminate the requirement to access Derby in a separate thread?\r\n\r\n3) Are there any similar issues with  interuption when accessing with the client driver?\r\n\r\n4) Is using embedded server ok with eclipse?  The plugins doc seems to \r\nimply that you should always use network server and access with Derby \r\nclient.\r\nhttp://db.apache.org/derby/integrate/plugin_help/start_toc.html\r\n\r\n\r\nThanks!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-05-10T03:04:14.000+0000","updated":"2006-05-10T03:04:14.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12566268","id":"12566268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am thinking of closing this issue CannotReproduce. Please let me know if you have any objections.\r\nIt can be reopened if we get a repro.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-02-06T18:51:50.434+0000","updated":"2008-02-06T18:51:50.434+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12566318","id":"12566318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attached is a repro.\r\n\r\nThe good news is that from 10.3 the java.nio.channels.ClosedByInterruptException is linked to the SQLException, so printStackTrace() will show that it's the underlying cause. But the SQLException still says \"please check if disk is full\".\r\n\r\nAnother piece of good news: In an earlier comment, Suresh suggested that we could catch ClosedByInterruptException and use that to reissue the sync() and/or give a better error message. The suggestion was rejected because it would introduce a dependency on Java 1.4 in RAFContainer. From 10.3 we have RAFContainer4 which *is* depending on Java 1.4, so that shouldn't stop us anymore.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-02-06T20:24:31.641+0000","updated":"2008-02-06T20:24:31.641+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12567653","id":"12567653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulasb","name":"paulasb","emailAddress":"paul dot sabatino at 3x dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Sabatino","active":true},"body":"We ran into this same error when running our application over slow network connections. At first we didn't see the connection between the network and the derby error until we started to investigate interrupts. We found that if a thread was ever interrupted and you attempt a commit on that same thread you'll see this error. It seems to be linked to having the threads interrupted flag set.\r\n\r\nHere's how to test it:\r\n1. add a  Thread.interrupted(); right after the interrupt() in the attached test program d151.java. (this clears the interrupted flag)\r\n2. Make sure the DB directory is deleted and rerun the test. It will now complete.\r\n\r\nI managed to fix our application by adjusting our network layer to clear the interrupted flag when we timed out an IO operation. That was how our issue was related to a slow network and not a local disk problem.\r\n\r\nThe error message is misleading since it seems to indicate that there's a problem writing to the file, when really it just misinterpreted the interrupted flag to mean the channel was closed. You might want to fix how the interrupts are checked.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulasb","name":"paulasb","emailAddress":"paul dot sabatino at 3x dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Sabatino","active":true},"created":"2008-02-11T14:50:53.878+0000","updated":"2008-02-11T14:50:53.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12568662","id":"12568662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulasb","name":"paulasb","emailAddress":"paul dot sabatino at 3x dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Sabatino","active":true},"body":"I thought I'd add a little more clarification to this. This error seems to only  come up when the interrupt flag is set on a thread that is doing a commit that which causes a page to be written to disk. I figured this out by modifying the d151.java to take pageSize as an argument and to count how many iterations of insert and interrupt it took to fail. I then varied the pageSize and noted that the number of iterations before failure was proportional to the pageSize. So my guess was that the page was being written somewhere under the covers and causing this error.\r\n\r\nI've attached my test program. I hope this helps resolve this issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=paulasb","name":"paulasb","emailAddress":"paul dot sabatino at 3x dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Paul Sabatino","active":true},"created":"2008-02-13T18:47:30.653+0000","updated":"2008-02-13T18:47:30.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12607454","id":"12607454","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=trejkaz","name":"trejkaz","emailAddress":"trejkaz at trypticon dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Trejkaz","active":true},"body":"I've been wrestling with this issue too.  I can't reproduce it reliably in the live system but it happens often enough to be an annoyance, and our unit tests cause it to occur much more often.\r\n\r\nIn our case it's occurring on one of our own threads so moving database work off the EDT can't help.\r\n\r\nClosing and reopening the connection doesn't make it work again, we have to do a shutdown and start it again, and then it appears to work (until the problem occurs again.)  When running the real application when there is a connection pool in effect, this becomes very hard to do.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=trejkaz","name":"trejkaz","emailAddress":"trejkaz at trypticon dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Trejkaz","active":true},"created":"2008-06-24T02:51:08.381+0000","updated":"2008-06-24T02:51:08.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12746389","id":"12746389","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Running Knut's repro with Java 1.5 or 1.5, I see this error:\r\n\r\nJava exception: 'org/apache/derby/impl/sql/execute/NormalizeResultSet: java.lang.NoClassDefFoundError'.\r\nException in thread \"main\" java.sql.SQLException: No current connection.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:158)\r\n\tat org.apache.derby.impl.jdbc.Util.noCurrentConnection(Util.java:262)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.checkIfClosed(EmbedConnection.java:2179)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.createStatement(EmbedConnection.java:1334)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.createStatement(EmbedConnection.java:1291)\r\n\tat d151.main(d151.java:18)\r\n\r\nwhich seems to be our old friend; the classloader being sensitive to the interrupted flag in the thread. With 1.6\r\nI see the disk is full message, though.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-08-22T01:21:00.399+0000","updated":"2009-08-22T01:21:00.399+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12746393","id":"12746393","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"My observation is really unrelated to the RAFContainer4 situation; if I move the call of Thread.currentThread().interrupt() in d151.java\r\nto *after* the first executeUpdate, this doesn't happen, because all relevant classes have been read by the classloader.\r\nSee DERBY-1338 for details.\r\n\r\nSo really it's just another manifestation of the fact that interrupting a Derby thread is not really healthy.\r\nI think we should just catch the ClosedByInterruptException and create a more explanatory error message, e.g maybe thus:\r\n\r\n\r\nException in thread \"main\" java.sql.SQLException: Derby thread received an interrupt during a write operation, please check your application.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\r\n\tat org.apache.derby.impl.jdbc.Util.seeNextException(Util.java:278)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:398)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\r\n\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2204)\r\n\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1323)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1675)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:302)\r\n\tat d151.main(d151.java:18)\r\nCaused by: java.sql.SQLException: Java exception: ': java.nio.channels.ClosedByInterruptException'.\r\n\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\r\n\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\r\n\tat org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)\r\n\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\r\n\t... 8 more\r\nCaused by: java.nio.channels.ClosedByInterruptException\r\n\tat java.nio.channels.spi.AbstractInterruptibleChannel.end(AbstractInterruptibleChannel.java:184)\r\n\tat sun.nio.ch.FileChannelImpl.write(FileChannelImpl.java:656)\r\n\tat org.apache.derby.impl.store.raw.data.RAFContainer4.writeFull(RAFContainer4.java:496)\r\n\tat org.apache.derby.impl.store.raw.data.RAFContainer4.writePage0(RAFContainer4.java:346)\r\n\tat org.apache.derby.impl.store.raw.data.RAFContainer4.writePage(RAFContainer4.java:291)\r\n\tat org.apache.derby.impl.store.raw.data.CachedPage.writePage(CachedPage.java:787)\r\n\tat org.apache.derby.impl.store.raw.data.CachedPage.createIdentity(CachedPage.java:305)\r\n\tat org.apache.derby.impl.services.cache.ConcurrentCache.create(ConcurrentCache.java:388)\r\n\tat org.apache.derby.impl.store.raw.data.FileContainer.initPage(FileContainer.java:2336)\r\n\tat org.apache.derby.impl.store.raw.data.FileContainer.newPage(FileContainer.java:1800)\r\n\tat org.apache.derby.impl.store.raw.data.BaseContainer.addPage(BaseContainer.java:314)\r\n\tat org.apache.derby.impl.store.raw.data.BaseContainerHandle.addPage(BaseContainerHandle.java:183)\r\n\tat org.apache.derby.impl.store.access.heap.HeapController.doInsert(HeapController.java:302)\r\n\tat org.apache.derby.impl.store.access.heap.HeapController.insertAndFetchLocation(HeapController.java:599)\r\n\tat org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(RowChangerImpl.java:452)\r\n\tat org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(InsertResultSet.java:1022)\r\n\tat org.apache.derby.impl.sql.execute.InsertResultSet.open(InsertResultSet.java:495)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:416)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:297)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1235)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-08-22T01:53:35.502+0000","updated":"2009-08-22T01:53:35.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12746505","id":"12746505","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading a patch that catches the ClosedByInterruptException and \r\nthrows a more meaningful error message as suggested above.\r\nI added a test to the store regression suite and ran it successfully on Windows Vista and OpenSolaris.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-08-22T21:11:37.720+0000","updated":"2009-08-22T21:11:37.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12748795","id":"12748795","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The patch looks good to me. Perhaps \"please check your application\" is a bit vague? What about \"please check your application for the source of the interrupt\"?\r\n\r\nThere may be other I/O calls that are sensitive to interrupts too, but I guess we can address them with a similar fix when they surface.\r\n\r\nSome minor issues in the test:\r\n\r\n- Class name in header is wrong (jdbc4 -> store)\r\n\r\n- getConnection().createStatement() and getConnection().prepareStatement() could be replaced by calls to helper methods in BaseJDBCTestCase","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-08-28T11:58:10.148+0000","updated":"2009-08-28T11:58:10.148+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12749648","id":"12749648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading version \"b\" of this patch.\r\n\r\n- Incorporated Knut's test comments.\r\n\r\n- Changed severity to database; updated ErrorCodeTest to reflect this.\r\n  Rationale: It seems right - I don't know that it's safe to continue\r\n  after this kind of error, and I compared to other IO level errors in\r\n  raw store and mostly seem to have database severity.\r\n\r\n- Made the new Derby151Test not fail even if expected error is not\r\n  seen. I did this to allow for possible different behavior on other\r\n  VMs, JUnit verbose mode would instead print \"Not able to test fix\r\n  for DERBY-151: No interrupt seen\".\r\n\r\n- I added the same handling to read (even if not seen yet) as for\r\n  write. Regressions passed modulo ErrorCodeTest, which i missed\r\n  first time around.\r\n\r\n- Fixed some broken Javadocs.\r\n\r\nReady for review. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-08-31T22:01:18.868+0000","updated":"2009-08-31T22:06:57.970+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12783205","id":"12783205","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Picking this up again; I haven't received any more comments on this, and it seems a net improvement \r\nto me even if it may not be a panacea. I intend to commit this soon, unless anybody has any misgivings.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-11-28T04:45:53.992+0000","updated":"2009-11-28T04:45:53.992+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12785045","id":"12785045","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Hmm, seems there is a problem with patch version b, changing the\r\nseverity to database makes the database try to shut down, which\r\ndoesn't work as long as the interrupt flag is set, I guess, since shutting down attempts more writing operations.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-12-02T23:01:34.206+0000","updated":"2009-12-02T23:01:34.206+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12785085","id":"12785085","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Luckily this turned out to be a red herring, the shutting down does see errors since the channel\r\nhas been closed by the interrupt, but the correct database level exception is returned to the app (XSDG9), and\r\nrebooting+recovery works as expected.\r\n\r\nThis will be seen on derby.log when the shutdown sees the closed channel:\r\n   ERROR XSDG9: Derby thread received an interrupt during a disk I/O operation, please check your application for the source of the interrupt.\r\n   :\r\n   ------------ BEGIN SHUTDOWN ERROR STACK -------------\r\n\r\n   ERROR XSDG1: Page Page(1,Container(0, 1120)) could not be written to disk, please check if disk is full.\r\n   :\r\n   Caused by: java.nio.channels.ClosedChannelException\r\n\r\nUploading derby-151-c, which fixes a bug in the test; it asserted for the wrong SQL state. However, assertSQLState is\r\na bit broken; if it can't match on the top level SQL state, it goes down the chain to see if it can match a wrapped exception.\r\nWhen that fails, it gives up and reports that it found *the innermost* wrapped exception, whereas the application saw the outermost one,\r\ncausing me to suspect the code fix was wrong.\r\n\r\nRunning regressions. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-12-03T00:41:23.181+0000","updated":"2009-12-03T01:11:43.611+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12785367","id":"12785367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed patch derby-151-c as svn 886831.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-12-03T15:56:15.959+0000","updated":"2009-12-03T15:56:15.959+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12785572","id":"12785572","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Uploading an improved test (derby-151-followup.diff), which also tests using the client driver.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-12-03T22:16:47.700+0000","updated":"2009-12-03T22:16:47.700+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/30281/comment/12785584","id":"12785584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed derby-151-followup as svn 886963, resolving.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2009-12-03T22:33:48.030+0000","updated":"2009-12-03T22:33:48.030+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-151/votes","votes":5,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06sun:"}}