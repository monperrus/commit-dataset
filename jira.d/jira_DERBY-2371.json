{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12363497","self":"https://issues.apache.org/jira/rest/api/latest/issue/12363497","key":"DERBY-2371","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312251","id":"12312251","description":"Head of 10.2 branch","name":"10.2.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-02-24 21:31:08.423","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23026","customfield_12310222":"1_*:*_1_*:*_350851167_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-02-27T17:41:18.984+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2371/watchers","watchCount":0,"isWatching":false},"created":"2007-02-23T16:13:47.817+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312027","id":"12312027","description":"","name":"10.2.2.0","archived":false,"released":true,"releaseDate":"2006-12-19"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:49:49.266+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"I'm seeing a problem updating the default value for a VARCHAR column when the column already contains data. I'm, using:\n\nalter table TABLE_NAME alter column COL_NAME DEFAULT 'new value'\n\nand with some VARCHAR columns I get an error like this:\n\nInvalid character string format for type long.; nested exception is java.sql.SQLException: Invalid character string format for type long.\nCaused by: ERROR 22018: Invalid character string format for type long.\n       at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\n       at org.apache.derby.iapi.types.SQLChar.getLong(Unknown Source)\n       at org.apache.derby.impl.sql.execute.AlterTableConstantAction.getColumnMax(Unknown Source)\n       at org.apache.derby.impl.sql.execute.AlterTableConstantAction.modifyColumnDefault(Unknown Source)\n       at org.apache.derby.impl.sql.execute.AlterTableConstantAction.execGuts(Unknown Source)\n       at org.apache.derby.impl.sql.execute.AlterTableConstantAction.executeConstantAction(Unknown Source)\n       at org.apache.derby.impl.sql.execute.MiscResultSet.open(Unknown Source)\n       at org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\n       at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\n       at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n       at org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\n\n\nThis only happens on VARCHAR columns containing data. Columns that are entirely NULL update fine. \n\nThis was discussed on users mailing list:\nhttp://www.nabble.com/problem-with-ALTER-COLUMN-DEFAULT-on-VARCHAR-column-tf3274046.html\nand the conclusion was that it is related to this statement being run internally as part of the updata process:\nSELECT MAX(COL_NAME) FROM TABLE_NAME  \n\nAs reported in that discussion:\n\n-bash-2.05b$ java org.apache.derby.tools.ij\nij version 10.3\nij> connect 'jdbc:derby:brydb';\nij> create table t (a varchar(10));\n0 rows inserted/updated/deleted\nij> alter table t alter column a default 'my val';\n0 rows inserted/updated/deleted\nij> insert into t (a) values ('hi');\n1 row inserted/updated/deleted\nij> alter table t alter column a default 'another val';\nERROR 22018: Invalid character string format for type long.\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37483","summary":"Setting a default value for a VARCHAR column fails when column contains data","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdudgeon","name":"tdudgeon","emailAddress":"tdudgeon at informaticsmatters dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim Dudgeon","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdudgeon","name":"tdudgeon","emailAddress":"tdudgeon at informaticsmatters dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim Dudgeon","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"This probably affects all platforms.","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12363497/comment/12475654","id":"12475654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"The problem arises in AlterTableConstantAction.modifyColumnDefault, which \r\nonly understands two types of modifications that can be made to a column's default value:\r\n - changing the INCREMENT BY value for a generated IDENTITY column\r\n - changing the RESTART WITH value for a generated IDENTITY column\r\n\r\nBut there is a third type of modification that can be made to a column's default\r\nvalue, which is simply to change the default value that is to be used for an\r\nordinary column if no value is provided when inserting a new row into that table.\r\n\r\nThe fix is to add a new ColumnInfo modification type code:\r\n   MODIFY_COLUMN_DEFAULT_VALUE\r\nand to teach ModifyColumnNode and AlterTableConstantAction what to do\r\nfor modifications of type MODIFY_COLUMN_DEFAULT_VALUE.\r\n\r\nI've got a diff ready, and will post it after running the regression tests.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-02-24T21:31:08.423+0000","updated":"2007-02-24T21:31:08.423+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12363497/comment/12475694","id":"12475694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"All the regression tests passed (once I remembered to up the memory for the \r\nJUnit suite). Attached is modifyValue.diff, a proposed patch for this issue. \r\n\r\nThe patch adds a new action code to the ModifyColumnNode to distinguish\r\nthe case where the column modification is for changing the default value,\r\nand does not  involve any generated identity column.\r\n\r\nA new test case is added to altertable.sql, based directly on the repro script.\r\n\r\nPlease let me know your comments and suggestions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-02-25T04:54:35.314+0000","updated":"2007-02-25T04:54:35.314+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12363497/comment/12475820","id":"12475820","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sv204098","name":"sv204098","emailAddress":"vyassaurabh1 at rediffmai dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saurabh Vyas","active":true},"body":"Hi Bryan, I did some quick tests on your patch & it works perfectly fine. \r\n\r\n+1 to commit.\r\n\r\nSaurabh","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sv204098","name":"sv204098","emailAddress":"vyassaurabh1 at rediffmai dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saurabh Vyas","active":true},"created":"2007-02-26T05:31:16.537+0000","updated":"2007-02-26T05:31:16.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12363497/comment/12475893","id":"12475893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Saurabh!\r\n\r\nI intend to commit this patch to the trunk in the next day or so, and then merge the change to 10.2.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-02-26T16:36:34.733+0000","updated":"2007-02-26T16:36:34.733+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12363497/comment/12476008","id":"12476008","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Committed to the trunk as revision 512019. Will merge to 10.2 now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-02-26T21:27:32.618+0000","updated":"2007-02-26T21:27:32.618+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12363497/comment/12476241","id":"12476241","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Merged the trunk change to the 10.2 branch. The altertable.sql file \r\nneeded hand-resolution of the merge, but the rest of the merging\r\nwas straightforward. 10.2 regression tests passed without error.\r\n\r\nCommitted the change to the 10.2 branch as revision 512334.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2007-02-27T17:41:18.945+0000","updated":"2007-02-27T17:41:18.945+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2371/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06s2v:"}}