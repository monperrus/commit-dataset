{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12496754","self":"https://issues.apache.org/jira/rest/api/latest/issue/12496754","key":"DERBY-4985","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314182","id":"12314182","description":"Old head of 10.5 branch","name":"10.5.3.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315434","id":"12315434","description":"Head of 10.6 branch as of 2014-01-13","name":"10.6.2.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12315902","id":"12315902","description":"Head of 10.7 branch as of 2010-11-29","name":"10.7.1.4","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2013-06-17 09:19:49.326","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24575","customfield_12310222":"1_*:*_1_*:*_76558997_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-01-26T22:42:34.357+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4985/watchers","watchCount":1,"isWatching":false},"created":"2011-01-26T01:26:35.360+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314117","id":"12314117","description":"Next release after 10.5.2.0 release candidate #1","name":"10.5.3.0","archived":false,"released":true,"releaseDate":"2009-08-21"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-17T09:19:49.328+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"If derby tests are running with JVM options that slow things down substantially, it can fail with:\r\n1) testBootLock(org.apache.derbyTesting.functionTests.tests.store.BootLockTest)j\r\nunit.framework.ComparisonFailure: Dual boot not detected: check BootLockMinion.l\r\nog expected:<...SDB6> but was:<...CY03>\r\n        at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDB\r\nCTestCase.java:769)\r\n        at org.apache.derbyTesting.junit.BaseJDBCTestCase.assertSQLState(BaseJDB\r\nCTestCase.java:804)\r\n        at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBo\r\notLock(BootLockTest.java:145)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.\r\njava:60)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces\r\nsorImpl.java:37)\r\n        at org.apache.derbyTesting.junit.BaseTestCase.runBare(BaseTestCase.java:\r\n109)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:23)\r\n        at org.apache.derbyTesting.junit.BaseTestSetup.run(BaseTestSetup.java:57\r\n)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:23)\r\n        at junit.extensions.TestDecorator.basicRun(TestDecorator.java:22)\r\n        at junit.extensions.TestSetup$1.protect(TestSetup.java:19)\r\n        at junit.extensions.TestSetup.run(TestSetup.java:23)\r\nCaused by: java.sql.SQLException: Required property 'derby.serviceProtocol' has\r\nnot been set.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLE\r\nxceptionFactory40.java:95)\r\n        at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Util.java:256)\r\n\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnecti\r\non.java:2723)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.<init>(EmbedConnection.jav\r\na:384)\r\n        at org.apache.derby.jdbc.Driver40.getNewEmbedConnection(Driver40.java:68\r\n)\r\n        at org.apache.derby.jdbc.InternalDriver.connect(InternalDriver.java:238)\r\n\r\n        at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:\r\n128)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:322)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:297)\r\n        at org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(D\r\nriverManagerConnector.java:81)\r\n        at org.apache.derbyTesting.junit.DriverManagerConnector.openConnection(D\r\nriverManagerConnector.java:43)\r\n        at org.apache.derbyTesting.junit.TestConfiguration.openDefaultConnection\r\n(TestConfiguration.java:1538)\r\n        at org.apache.derbyTesting.junit.BaseJDBCTestCase.openDefaultConnection(\r\nBaseJDBCTestCase.java:428)\r\n        at org.apache.derbyTesting.junit.BaseJDBCTestCase.getConnection(BaseJDBC\r\nTestCase.java:110)\r\n        at org.apache.derbyTesting.functionTests.tests.store.BootLockTest.testBo\r\notLock(BootLockTest.java:136)\r\n        ... 31 more\r\nCaused by: java.sql.SQLException: Required property 'derby.serviceProtocol' has\r\nnot been set.\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExc\r\neptionFactory.java:45)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransport\r\nAcrossDRDA(SQLExceptionFactory40.java:119)\r\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLE\r\nxceptionFactory40.java:70)\r\n        ... 45 more\r\nCaused by: ERROR XCY03: Required property 'derby.serviceProtocol' has not been s\r\net.\r\n        at org.apache.derby.iapi.error.StandardException.newException(StandardEx\r\nception.java:286)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.startProviderServi\r\nce(BaseMonitor.java:1679)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndSta\r\nrtService(BaseMonitor.java:1560)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentSer\r\nvice(BaseMonitor.java:979)\r\n        at org.apache.derby.iapi.services.monitor.Monitor.startPersistentService\r\n(Monitor.java:550)\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnecti\r\non.java:2686)\r\n        ... 43 more\r\n\r\n\r\nThe test waits for the spawned process to create db.lck and service.properties and then waits three seconds more to make sure the properties have been written, but this might not be enough time.\r\nAlthough I have not seen this myself with unchanged code , I can simulate it on windows by changing StorageFactoryService.saveServiceProperties() to have a sleep between creating the service.properties file and writing the properties out, e.g.\r\n\r\n  try\r\n                        {\r\n                            os = servicePropertiesFile.getOutputStream();\r\n                            try {\r\n                                Thread.sleep(10000);\r\n                            } catch (Exception e) {}\r\n                            properties.store( os, serviceName + MessageService.getTextMessage(MessageId.SERVICE_PROPERTIES_DONT_EDIT));\r\n\r\n\r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36575","summary":"BootLockTest can fail with ERROR XCY03: Required property 'derby.serviceProtocol' has not been set  with slow configurations","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10423","value":"Newcomer","id":"10423"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":3,"total":3,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496754/comment/12987122","id":"12987122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Here is a patch for this issue. BootLockMinion creates a file after it has made the connection and created a table that BootLockTest can check for, so we are really sure that the database creation and connection are complete.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-01-26T18:00:40.759+0000","updated":"2011-01-26T18:00:40.759+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496754/comment/12987127","id":"12987127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I'll run store._Suite and then check in.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-01-26T18:05:42.792+0000","updated":"2011-01-26T18:05:42.792+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12496754/comment/13685366","id":"13685366","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:49.326+0000","updated":"2013-06-17T09:19:49.326+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4985/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06mh3:"}}