{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12388885","self":"https://issues.apache.org/jira/rest/api/latest/issue/12388885","key":"DERBY-3427","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313142","id":"12313142","description":"","name":"10.3.3.0","archived":false,"released":true,"releaseDate":"2008-05-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-02-18 11:16:43.196","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23638","customfield_12310222":"3_*:*_1_*:*_1010176648_*|*_1_*:*_1_*:*_1453895917_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-03-17T06:52:36.808+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3427/watchers","watchCount":0,"isWatching":false},"created":"2008-02-17T18:24:44.243+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312876","id":"12312876","description":"","name":"10.3.2.1","archived":false,"released":true,"releaseDate":"2007-12-10"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12319429","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12319429","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12390245","key":"DERBY-3496","self":"https://issues.apache.org/jira/rest/api/2/issue/12390245","fields":{"summary":"CallableStatement with output parameter leaves cursor open after execution","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:51:29.211+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"setting transaction isolation level to read committed after reading a BLOG record raise ERROR X0X03: Invalid transaction state - held cursor requires same isolation level .\n\n  Using Derby client 10.2  either with Derby  server 10.3  or  10.2   works fine .\n\n  Using Derby Client 10.3  with Derby Server 10.2  also work fine.  ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37331","summary":"setting transaction isolation level to read committed raise ERROR X0X03: Invalid transaction state - held cursor requires same isolation level","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sqldeskt","name":"sqldeskt","emailAddress":"rlevantinh at sqldesktop dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rene Levantinh","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sqldeskt","name":"sqldeskt","emailAddress":"rlevantinh at sqldesktop dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rene Levantinh","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"windows XP Java version 1.6.0_03","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10051","value":"Urgent","id":"10051"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":17,"total":17,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12569737","id":"12569737","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sqldeskt","name":"sqldeskt","emailAddress":"rlevantinh at sqldesktop dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rene Levantinh","active":true},"body":"The server part is the demo found in the distribution file.\r\n\r\n  The client part is a modified version found in the distribution file to reproduce the bug.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sqldeskt","name":"sqldeskt","emailAddress":"rlevantinh at sqldesktop dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rene Levantinh","active":true},"created":"2008-02-17T18:28:51.312+0000","updated":"2008-02-17T18:28:51.312+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12569855","id":"12569855","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"I assume that you mean BLOB (not BLOG)? \r\nAre you saying that this is a regression from 10.2 to 10.3?\r\n\r\nYour example contains quite a bit of code. Can you pinpoint where you're getting the error?\r\nDid you try the same query with other data types (not BLOB/CLOB)?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-02-18T11:16:43.196+0000","updated":"2008-02-18T11:16:43.196+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12569877","id":"12569877","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Dyre, I managed to reproduce it with this ij script:\r\n\r\nconnect 'jdbc:derby://localhost/d3427db;create=true';\r\ncreate table t (b blob);\r\ninsert into t values cast (x'ffff' as blob);\r\nselect * from t;\r\nset isolation rr;\r\n\r\nIt works on 10.2.2.0 and fails with X0X03 on 10.3.1.4, so it seems like it is a regression.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-02-18T12:31:10.860+0000","updated":"2008-02-18T12:31:10.860+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12569891","id":"12569891","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The following commit introduced the problem:\r\n\r\n------------------------------------------------------------------------\r\nr542011 | kahatlen | 2007-05-27 19:56:32 +0200 (Sun, 27 May 2007) | 16 lines\r\n\r\nDERBY-2496: Implement Blob support for Locators\r\n\r\nThe attached patch, enableblobloc.diff, contains the the necessary\r\nchanges to enable the use of locators for Blob. The patch addresses\r\nthe following issues:\r\n\r\n   * Enable the use of locators.\r\n   * Modification of tests that experience changed behavior with locators\r\n   * If stored procedures reports that the given locator can not be\r\n     found, it is assumed that this is because transaction has been\r\n     terminated and an \"Blob accessed after commit\" error is\r\n     reported. This makes the client driver and the embedded driver\r\n     report the same error for this case.\r\n\r\nContributed by Øystein Grøvlen.\r\n\r\n------------------------------------------------------------------------","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-02-18T13:01:03.384+0000","updated":"2008-02-18T13:01:03.384+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12574998","id":"12574998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"A couple of observations about this.\r\n1) The setting of the isolation level fails because the connection has an activation with an open holdable resultset. The statement which created the resultset is '? = CALL SYSIBM.BLOBGETBYTES(?, ?, ?)'\r\n\r\n2) There appears to be something wrong with the transmission of holdability for CallableStatements in the ClientDriver, because \r\n'? = CALL SYSIBM.BLOBGETBYTES(?, ?, ?)' is clearly prepared with ResultSet.CLOSE_CURSORS_AT_COMMIT:\r\n            blobGetBytesCall = connection.prepareCallX\r\n                (\"? = CALL SYSIBM.BLOBGETBYTES(?, ?, ?)\",\r\n                 java.sql.ResultSet.TYPE_FORWARD_ONLY, \r\n                 java.sql.ResultSet.CONCUR_READ_ONLY, \r\n                 java.sql.ResultSet.CLOSE_CURSORS_AT_COMMIT);\r\n\r\nbut when I instrument EmbedCallableStatement I see that on the server the holdability is different:\r\n\t\t\t/* KLUDGE - ? = CALL ... returns a ResultSet().  We\r\n\t\t\t * need executeUpdate to be false in that case.\r\n\t\t\t */\r\n\t\t\torg.apache.derby.iapi.services.monitor.Monitor.logMessage(\"EmbedCallableStatement=\"+getSQLText()\r\n\r\n+\", closeAtCommit:\"+(getResultSetHoldability()==java.sql.ResultSet.CLOSE_CURSORS_AT_COMMIT));\r\n\r\nprints the following to derby.log:\r\nEmbedCallableStatement=? = CALL SYSIBM.BLOBGETLENGTH(?), closeAtCommit:false\r\n\r\nand even\r\nEmbedCallableStatement=call SYSIBM.SQLCAMESSAGE(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)\r\n, closeAtCommit:false\r\n\r\nSeems a bit strange that sSQLCAMESSAGE should need to use a holdable cursor.\r\n\r\n\r\n3) The repro runs fine if I modify EmbedCallableStatement.executeStatement(...) so that it closes the resultset it uses to get the value of the out-parameter, rather than simply setting the variable to null:\r\n\r\n  \t\t\t\ttry\r\n\t\t\t\t{\r\n\t\t\t\t\tDataValueDescriptor returnValue = pvs.getReturnValueForSet();\r\n\t\t\t\t\treturnValue.setValueFromResultSet(results, 1, true);\r\n\t\t\t\t} catch (StandardException e)\r\n\t\t\t\t{\r\n\t\t\t\t\tthrow EmbedResultSet.noStateChangeException(e);\r\n\t\t\t\t}\r\n\t\t\t\tfinally {\r\n\t\t\t\t\torg.apache.derby.iapi.services.monitor.Monitor.\r\n\t\t\t\t\t\tlogMessage(\"result:\"+results);\r\n\t\t\t\t\tresults.close();  // <--- ADDED THIS LINE\r\n\t\t\t\t\tresults = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// This is a form of ? = CALL which current is not a procedure call.\r\n\t\t\t\t// Thus there cannot be any user result sets, so return false. execResult\r\n\t\t\t\t// is set to true since a result set was returned, for the return parameter.\r\n\t\t\t\texecResult = false;\r\n\r\nI have not run any other tests with this change, so I don't know if it has any negative side-effects.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-04T14:22:17.515+0000","updated":"2008-03-04T14:22:17.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575041","id":"12575041","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Here's an alternative (and untested) approach. I changed the network server so that it used the specified holdability instead of the default holdability when preparing calls. It seems to fix the repro.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-04T16:18:16.878+0000","updated":"2008-03-04T16:18:16.878+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575276","id":"12575276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"suites.All ran cleanly with use-holdability.diff. Derbyall had two failures, predicatePushdown and TransactionTable, which are also seen in the nightly testing. I'll clean up the patch and add a test case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-05T09:12:37.266+0000","updated":"2008-03-05T09:12:37.266+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575277","id":"12575277","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"By the way, I think the missing close() mentioned by Dyre may also be a bug, but it's probably a separate issue. (If it is a bug, it should be possible to expose it in embedded mode.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-05T09:21:19.813+0000","updated":"2008-03-05T09:21:19.813+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575324","id":"12575324","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I managed to expose the missing close() in embedded mode. See DERBY-3496.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-05T12:27:13.019+0000","updated":"2008-03-05T12:27:13.019+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575353","id":"12575353","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attached is a patch (d3427.diff) which fixes the bug by using the prepareCall() method with a holdability parameter in DRDAStatement. The patch also removes DRDAStatement.prepareStatementJDBC3() since we can now use Connection.prepareStatement(String,int,int,int) directly. (prepareStatementJDBC3() additionally contains some logic to handle the case where the holdability is uninitialized, but at this point in the code we know that the holdability is initialized because of the call to parsePkgidToFindHoldability().)\r\n\r\nA test case has been added to BlobClob4BlobTest. It fails without the fix in DRDAStatement and succeeds with the fix.\r\n\r\nI saw these errors when running the regression tests:\r\n  - predicatePushdown (DERBY-3479)\r\n  - st_reclaim_longcol (DERBY-1913)\r\n  - TransactionTable (also seen in the nightly tests)\r\n  - ManagementMBeanTest (also seen in the nightly tests)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-05T14:15:36.133+0000","updated":"2008-03-05T14:15:36.133+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575632","id":"12575632","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"The patch fixes a regression (always good), and will most likely reduce the number of holdable cursors used by the NetworkServer which in turn should reduce resource consumption. +1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-06T09:43:21.737+0000","updated":"2008-03-06T09:43:21.737+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575637","id":"12575637","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for reviewing the patch, Dyre. Committed revision 634206.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-06T10:00:31.541+0000","updated":"2008-03-06T10:00:31.541+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575640","id":"12575640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"> which in turn should reduce resource consumption\r\n\r\nThe committed patch does however make all callable statements have a cursor name (before the patch, only prepared statements and statements had cursor names), which could increase the resource consumption. Is there any scenario where a CALL statement can make use of the cursor name, or should I create a follow-up patch which reverts to the old behaviour and skips setting the cursor name for CALLs?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-06T10:06:33.408+0000","updated":"2008-03-06T10:06:33.408+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12575710","id":"12575710","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"Knut> should I create a follow-up patch which reverts to the old behaviour and skips setting the cursor name for CALLs?\r\n\r\nYour CALL (pun intended). I have a hard time seeing that it would make a huge difference, but without testing it you never know, I guess...\r\n\r\nShould we set 'Existing application impact' on this issue? Theoretically, someone could have come to expect that cursors are always holdable for CallableStatement when using the ClientDriver.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-06T13:56:53.326+0000","updated":"2008-03-06T13:56:53.326+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12576133","id":"12576133","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"I'm adding 10.3.2.2 to the list of fix versions as I think this is a good candidate for merging to 10.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2008-03-07T10:57:03.526+0000","updated":"2008-03-07T10:57:03.526+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12578186","id":"12578186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I guess that if we find out that the cursor name does make any difference, it's a better solution to make sure the network server doesn't set a cursor name unless the client has done so, rather than reintroducing the asymmetry between CallableStatement and PreparedStatement. (Of course, the best solution is to fix the overhead of named cursors in the embedded driver, if such an overhead exists.)\r\n\r\nAs to the question about setting 'existing application impact' flag, I'm leaning towards not setting it. Holdable cursors is the default, so the users must have made a deliberate choice that they want non-holdable cursors, and then they shouldn't expect the cursors to be holdable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-13T08:38:50.703+0000","updated":"2008-03-13T08:38:50.703+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12388885/comment/12579331","id":"12579331","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed to 10.3 (revision 637744).\r\n\r\nDerbyall ran cleanly, but suites.All had two failures. Since these failures (XATransactionTest.testXATransactionTimeout and NSSecurityMechanismTest.testNetworkServerSecurityMechanism) seem to happen intermittently in the nightly testing of the branch, I don't think they were caused by the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2008-03-17T06:52:36.795+0000","updated":"2008-03-17T06:52:36.795+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3427/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06r53:"}}