{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12683643","self":"https://issues.apache.org/jira/rest/api/latest/issue/12683643","key":"DERBY-6429","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324243","id":"12324243","description":"First release on the 10.11 branch","name":"10.11.1.1","archived":false,"released":true,"releaseDate":"2014-08-26"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2013-12-10 21:15:24.525","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"362715","customfield_12310222":"1_*:*_1_*:*_3276084913_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-01-16T15:50:54.753+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6429/watchers","watchCount":6,"isWatching":false},"created":"2013-12-09T17:49:29.873+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_backport_reject_10_10"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"7.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324243","id":"12324243","description":"First release on the 10.11 branch","name":"10.11.1.1","archived":false,"released":true,"releaseDate":"2014-08-26"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12379713","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379713","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12678827","key":"DERBY-6414","self":"https://issues.apache.org/jira/rest/api/2/issue/12678827","fields":{"summary":"Incorrect handling when using an UPDATE to SET an identity column to DEFAULT","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12379714","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379714","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12381347","key":"DERBY-3155","self":"https://issues.apache.org/jira/rest/api/2/issue/12381347","fields":{"summary":"Support for SQL:2003 MERGE statement","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12379892","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379892","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12684313","key":"DERBY-6431","self":"https://issues.apache.org/jira/rest/api/2/issue/12684313","fields":{"summary":"Update Developer's Guide topic to include generated columns","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}},{"id":"12380107","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12380107","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12685244","key":"DERBY-6436","self":"https://issues.apache.org/jira/rest/api/2/issue/12685244","fields":{"summary":"Overbroad privileges required when selecting from a view.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12380324","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12380324","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12686174","key":"DERBY-6439","self":"https://issues.apache.org/jira/rest/api/2/issue/12686174","fields":{"summary":"Privileges not checked before scalar subquery is materialized","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12379897","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379897","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12684332","key":"DERBY-6432","self":"https://issues.apache.org/jira/rest/api/2/issue/12684332","fields":{"summary":"INSERT/UPDATE incorrectly require user to have privilege to execute CHECK constraints on the target table.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12379899","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379899","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12684337","key":"DERBY-6433","self":"https://issues.apache.org/jira/rest/api/2/issue/12684337","fields":{"summary":"INSERT/UPDATE incorrectly require user to have privilege to run generation expressions.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12379902","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12379902","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12684343","key":"DERBY-6434","self":"https://issues.apache.org/jira/rest/api/2/issue/12684343","fields":{"summary":"Incorrect privileges may be required for INSERT and DELETE statements.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12380674","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12380674","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12687468","key":"DERBY-6446","self":"https://issues.apache.org/jira/rest/api/2/issue/12687468","fields":{"summary":"Test ordering problem in GrantRevokeDDLTest","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-01-21T00:23:52.336+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"UPDATE statements confuse SELECT and UPDATE privileges. Consider the following SET clause:\r\n\r\n   SET updateColumn = selectColumn\r\n\r\nAccording to part 2 of the 2011 edition of the SQL Standard, that SET clause requires the following privileges:\r\n\r\n1) UPDATE privilege on updateColumn. Privileges for the left side of a SET clause are described by section 14.14 (update statement: searched), access rule 1b.\r\n\r\n2) SELECT privilege on selectColumn. Privileges for the right side of a SET clause are described by section 14.15 (set clause list) and the various productions underneath value expression. In this case, we have a column reference, whose privileges are governed by section 6.7 (column reference), access rule 2.\r\n\r\nHowever, Derby requires the following:\r\n\r\n1') UPDATE privilege on both updateColumn and selectColumn\r\n\r\nWhen we address this bug, we should make corresponding changes to the MERGE statement.\r\n\r\nThe following script shows the current behavior:\r\n\r\nconnect 'jdbc:derby:memory:db;user=test_dbo;create=true';\r\n\r\ncall syscs_util.syscs_create_user( 'TEST_DBO', 'test_dbopassword' );\r\ncall syscs_util.syscs_create_user( 'RUTH', 'ruthpassword' );\r\n\r\nconnect 'jdbc:derby:memory:db;shutdown=true';\r\n\r\nconnect 'jdbc:derby:memory:db;user=test_dbo;password=test_dbopassword' as dbo;\r\n\r\ncreate table t1_025\r\n(\r\n    a int primary key,\r\n    updateColumn int,\r\n    selectColumn int,\r\n    privateColumn int\r\n);\r\n\r\ngrant update ( updateColumn ) on t1_025 to ruth;\r\ngrant select ( selectColumn ) on t1_025 to ruth;\r\n\r\ninsert into t1_025 values ( 1, 100, 1000, 10000 );\r\n\r\nconnect 'jdbc:derby:memory:db;user=ruth;password=ruthpassword' as ruth;\r\n\r\n-- correctly succeeds because ruth has UPDATE privilege on updateColumn\r\nupdate test_dbo.t1_025 set updateColumn = 17;\r\n\r\n-- the error message incorrectly states that the missing privilege\r\n-- is UPDATE privilege on privateColumn\r\nupdate test_dbo.t1_025 set updateColumn = privateColumn;\r\n\r\n-- incorrectly fails.\r\n-- ruth does have UPDATE privilege on updateColumn\r\n-- and SELECT privilege on selectColumn, which should be good enough.\r\n-- however, the error message incorrectly states that the missing privilege\r\n-- is UPDATE privilege on selectColumn.\r\nupdate test_dbo.t1_025 set updateColumn = selectColumn;\r\n\r\n-- incorrectly succeeds even though ruth does not have SELECT privilege on updateColumn\r\nupdate test_dbo.t1_025 set updateColumn = 2 * updateColumn;\r\n\r\nset connection dbo;\r\n\r\nselect * from t1_025 order by a;\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10367","value":"Deviation from standard","id":"10367"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10361","value":"Security","id":"10361"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"363009","summary":"Privilege checks for UPDATE statements are wrong.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[{"id":"12684313","key":"DERBY-6431","self":"https://issues.apache.org/jira/rest/api/2/issue/12684313","fields":{"summary":"Update Developer's Guide topic to include generated columns","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":31,"total":31,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13844297","id":"13844297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Here is a more extensive script, which shows the incorrect permissions behavior of UPDATEs interacting with generated columns, constraints, and triggers.\r\n\r\nconnect 'jdbc:derby:memory:db;user=test_dbo;create=true';\r\n\r\ncall syscs_util.syscs_create_user( 'TEST_DBO', 'test_dbopassword' );\r\ncall syscs_util.syscs_create_user( 'RUTH', 'ruthpassword' );\r\n\r\nconnect 'jdbc:derby:memory:db;shutdown=true';\r\n\r\nconnect 'jdbc:derby:memory:db;user=test_dbo;password=test_dbopassword' as dbo;\r\n\r\ncreate table t2_6429_primary\r\n(\r\n    key1 int,\r\n    key2 int,\r\n    primary key( key1, key2 )\r\n);\r\n\r\ncreate table t1_6429_plain\r\n(\r\n    a int primary key,\r\n    updateColumn int,\r\n    selectColumn int,\r\n    privateColumn int\r\n);\r\n\r\ncreate table t1_6429_generated\r\n(\r\n    a int primary key,\r\n    updateColumn int,\r\n    selectColumn int,\r\n    privateColumn int,\r\n    generatedColumn generated always as ( -updateColumn )\r\n);\r\n\r\ncreate table t1_6429_check\r\n(\r\n    a int primary key,\r\n    updateColumn int,\r\n    selectColumn int,\r\n    privateColumn int,\r\n    checkColumn int,\r\n    check ( updateColumn > checkColumn )\r\n);\r\n\r\ncreate table t1_6429_foreign\r\n(\r\n    a int primary key,\r\n    updateColumn int,\r\n    selectColumn int,\r\n    privateColumn int,\r\n    foreignColumn int,\r\n    foreign key ( updateColumn, foreignColumn ) references t2_6429_primary( key1, key2 )\r\n);\r\n\r\ncreate table t1_6429_trigger\r\n(\r\n    a int primary key,\r\n    updateColumn int,\r\n    selectColumn int,\r\n    privateColumn int,\r\n    triggerContentColumn int\r\n);\r\n\r\ncreate procedure addHistoryRow_6429\r\n(\r\n    actionString varchar( 20 ),\r\n    actionValue int\r\n)\r\nlanguage java parameter style java reads sql data\r\nexternal name 'org.apache.derbyTesting.functionTests.tests.lang.MergeStatementTest.addHistoryRow';\r\n\r\ncreate trigger t1_6429_upd_before\r\nno cascade before update of updateColumn on t1_6429_trigger\r\nreferencing old as old\r\nfor each row\r\ncall addHistoryRow_6429( 'before', old.triggerContentColumn );\r\n\r\ngrant update ( updateColumn ) on t1_6429_plain to ruth;\r\ngrant select ( selectColumn ) on t1_6429_plain to ruth;\r\n\r\ngrant update ( updateColumn ) on t1_6429_generated to ruth;\r\ngrant select ( selectColumn ) on t1_6429_generated to ruth;\r\n\r\ngrant update ( updateColumn ) on t1_6429_check to ruth;\r\ngrant select ( selectColumn ) on t1_6429_check to ruth;\r\n\r\ngrant update ( updateColumn ) on t1_6429_foreign to ruth;\r\ngrant select ( selectColumn ) on t1_6429_foreign to ruth;\r\n\r\ngrant update ( updateColumn ) on t1_6429_trigger to ruth;\r\ngrant select ( selectColumn ) on t1_6429_trigger to ruth;\r\ngrant select ( triggerContentColumn ) on t1_6429_trigger to ruth;\r\ngrant execute on procedure addHistoryRow_6429 to ruth;\r\n\r\ninsert into t2_6429_primary values ( 100, 1 ), ( 17, 1 ), ( 34, 1 );\r\n\r\ninsert into t1_6429_plain( a, updateColumn, selectColumn, privateColumn ) values ( 1, 100, 1000, 10000 );\r\ninsert into t1_6429_generated( a, updateColumn, selectColumn, privateColumn ) values ( 1, 100, 1000, 10000 );\r\ninsert into t1_6429_check( a, updateColumn, selectColumn, privateColumn, checkColumn ) values ( 1, 100, 1000, 10000, -1000 );\r\ninsert into t1_6429_foreign( a, updateColumn, selectColumn, privateColumn, foreignColumn ) values ( 1, 100, 1000, 10000, 1 );\r\ninsert into t1_6429_trigger( a, updateColumn, selectColumn, privateColumn, triggerContentColumn ) values ( 1, 100, 1000, 10000, 1 );\r\n\r\nconnect 'jdbc:derby:memory:db;user=ruth;password=ruthpassword' as ruth;\r\n\r\n--\r\n-- plain\r\n--\r\n\r\n-- correct. succeeds.\r\nupdate test_dbo.t1_6429_plain set updateColumn = 17;\r\n\r\n-- incorrect.\r\n-- the error message incorrectly states that the missing privilege\r\n-- is UPDATE privilege on privateColumn\r\nupdate test_dbo.t1_6429_plain set updateColumn = privateColumn;\r\n\r\n-- incorrect.\r\n-- ruth does have UPDATE privilege on updateColumn\r\n-- and SELECT privilege on selectColumn, which should be good enough.\r\n-- however, the error message incorrectly states that the missing privilege\r\n-- is UPDATE privilege on selectColumn.\r\nupdate test_dbo.t1_6429_plain set updateColumn = selectColumn;\r\n\r\n-- incorrect. should not succeed. ruth does not have SELECT privilege on updateColumn\r\nupdate test_dbo.t1_6429_plain set updateColumn = 2 * updateColumn;\r\n\r\n--\r\n-- generated\r\n--\r\n\r\n-- incorrect.\r\n-- sometimes fails because Derby wants UPDATE priv for generatedColumn.\r\n-- sometimes fails because Derby wants SELECT permission on updateColumn.\r\nupdate test_dbo.t1_6429_generated set updateColumn = 17;\r\n\r\n-- incorrect.\r\n-- sometimes fails because Derby wants UPDATE priv for generatedColumn.\r\n-- sometimes fails because Derby wants SELECT permission on updateColumn.\r\nupdate test_dbo.t1_6429_generated set updateColumn = privateColumn;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have SELECT permission on updateColumn\r\nupdate test_dbo.t1_6429_generated set updateColumn = selectColumn;\r\n\r\n-- incorrect. should fail because ruth does not have SELECT privilege on updateColumn\r\nupdate test_dbo.t1_6429_generated set updateColumn = 2 * updateColumn;\r\n\r\n--\r\n-- check\r\n--\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on checkColumn\r\nupdate test_dbo.t1_6429_check set updateColumn = 17;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on privateColumn\r\nupdate test_dbo.t1_6429_check set updateColumn = privateColumn;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on selectColumn\r\nupdate test_dbo.t1_6429_check set updateColumn = selectColumn;\r\n\r\n--\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on checkColumn\r\nupdate test_dbo.t1_6429_check set updateColumn = 2 * updateColumn;\r\n\r\n--\r\n-- foreign\r\n--\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on foreignColumn\r\nupdate test_dbo.t1_6429_foreign set updateColumn = 17;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on privateColumn\r\nupdate test_dbo.t1_6429_foreign set updateColumn = privateColumn;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on selectColumn\r\nupdate test_dbo.t1_6429_foreign set updateColumn = selectColumn;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on foreignColumn\r\nupdate test_dbo.t1_6429_foreign set updateColumn = 2 * updateColumn;\r\n\r\n--\r\n-- trigger\r\n--\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on triggerContentColumn\r\nupdate test_dbo.t1_6429_trigger set updateColumn = 17;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on privateColumn\r\nupdate test_dbo.t1_6429_trigger set updateColumn = privateColumn;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on selectColumn\r\nupdate test_dbo.t1_6429_trigger set updateColumn = selectColumn;\r\n\r\n-- incorrect.\r\n-- fails because ruth does not have UPDATE permission on triggerContentColumn\r\nupdate test_dbo.t1_6429_trigger set updateColumn = 2 * updateColumn;\r\n\r\nset connection dbo;\r\n\r\nselect * from t1_6429_plain order by a;\r\nselect * from t1_6429_generated order by a;\r\nselect * from t1_6429_check order by a;\r\nselect * from t1_6429_foreign order by a;\r\nselect * from t1_6429_trigger order by a;\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-10T14:22:35.158+0000","updated":"2013-12-10T14:22:35.158+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13844457","id":"13844457","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Here are my thoughts about how foreign keys, generated columns, check constraints, and triggers affect the permissions needed to execute an UPDATE statement. Does anyone have a different opinion?\r\n\r\nThanks,\r\n-Rick\r\n\r\n-----------------------------------------\r\n\r\nForeign Keys\r\n\r\nPermissions for foreign keys are checked when the foreign key is declared. The owner of the foreign table must have REFERENCES privilege on the referenced columns in the primary key table. See part 2, section 11.8 (referential constraint definition), access rule 1. No further permissions checking is required at execution time. I do not see any language indicating that foreign keys become invalid or un-runnable if the owner of the foreign table later loses REFERENCES privilege on the referenced columns. I do not see any indication that the user issuing the UPDATE statement is required to have SELECT privilege on the referenced columns.\r\n\r\n\r\n-----------------------------------------\r\n\r\nGenerated Columns\r\n\r\nThere are two kinds of permissions related to generation clauses:\r\n\r\nG1) SELECT permission on the columns mentioned in the generation clause. I do not see any language in the Standard suggesting that you need explicit SELECT permission on all of the columns mentioned by the generation clause. That permission seems to be implied by the INSERT privilege you enjoy  on the table and the UPDATE privilege you may enjoy on a column mentioned by the generation clause.\r\n\r\nG2) EXECUTE permission on functions invoked by the generation clause. This is addressed by part 2, section 4.28.3 (Execution of SQL-invoked routines). The user executing the UPDATE statement must enjoy EXECUTE permission on the functions invoked by the generation clause if the generation clause is run as a consequence of UPDATing a column.\r\n\r\n\r\n-----------------------------------------\r\n\r\nCheck Constraints\r\n\r\nSimilarly, there are two kinds of permissions related to CHECK constraints:\r\n\r\nC1) SELECT permission on the columns mentioned in the CHECK constraint. I do not see any language in the Standard suggesting that you need explicit SELECT permission on all of the columns mentioned by the CHECK constraint. That permission seems to be implied by the INSERT privilege you enjoy  on the table and the UPDATE privilege you may enjoy on a column mentioned by the CHECK constraint.\r\n\r\nC2) EXECUTE permission on functions invoked by the CHECK constraint. This is addressed by part 2, section 4.28.3 (Execution of SQL-invoked routines). The user executing the UPDATE statement must enjoy EXECUTE permission on the functions invoked by the CHECK constraint.\r\n\r\n\r\n-----------------------------------------\r\n\r\nTriggers\r\n\r\nThere are two kinds of permissions related to triggers:\r\n\r\nT1) The permission to SELECT columns from the source table in order to construct transition variables and transition tables. These permissions are described by part 2 of the Standard, section 11.49 (trigger definition), access rule 3. In order to declare a trigger, the trigger owner must have SELECT privilege on the whole source table if the trigger has transition variables or tables. It is my understanding that the SELECTion of source columns at runtime happens under the original aegis of the trigger owner. Moreover, I don't see any language suggesting that the trigger becomes un-runnable if the trigger owner later loses TRIGGER and/or SELECT privilege on the source table. \r\n\r\nT2) The permission to execute the trigger action. I can't find any language specifying special treatment of permissions for the trigger action. I believe that the trigger action runs with the privileges of the user who invoked the original, triggering INSERT/UPDATE/DELETE.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-10T17:44:29.977+0000","updated":"2013-12-10T17:44:29.977+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13844677","id":"13844677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"> -----------------------------------------\r\n> \r\n> Foreign Keys\r\n> \r\n> Permissions for foreign keys are checked when the foreign key is\r\n> declared. The owner of the foreign table must have REFERENCES\r\n> privilege on the referenced columns in the primary key table. \r\n\r\n\"have\" meaning have a privilege granted (to user of PUBLIC), or\r\ngranted to the current role, right?\r\n\r\n> See part 2, section 11.8 (referential constraint definition), access\r\n> rule 1. No further permissions checking is required at execution\r\n> time. I do not see any language indicating that foreign keys become\r\n> invalid or un-runnable if the owner of the foreign table later loses\r\n> REFERENCES privilege on the referenced columns. \r\n\r\nHmm.. this seems wrong to me. I'd expect this dependency to be\r\ntracked, and Derby to barf (with RESTRICT semantics by default) when\r\nthat privilege was revoked (or cascades as the case might be)...\r\n\r\n> I do not see any\r\n> indication that the user issuing the UPDATE statement is required to\r\n> have SELECT privilege on the referenced columns.\r\n> \r\n> \r\n> -----------------------------------------\r\n> \r\n> Generated Columns\r\n> \r\n> There are two kinds of permissions related to generation clauses:\r\n> \r\n> G1) SELECT permission on the columns mentioned in the generation\r\n> clause. I do not see any language in the Standard suggesting that you\r\n> need explicit SELECT permission on all of the columns mentioned by the\r\n> generation clause. That permission seems to be implied by the INSERT\r\n> privilege you enjoy on the table and the UPDATE privilege you may\r\n> enjoy on a column mentioned by the generation clause.\r\n\r\nMakes sense to me.\r\n\r\n> G2) EXECUTE permission on functions invoked by the generation\r\n> clause. This is addressed by part 2, section 4.28.3 (Execution of\r\n> SQL-invoked routines). The user executing the UPDATE statement must\r\n> enjoy EXECUTE permission on thes functions invoked by the generation\r\n> clause if the generation clause is run as a consequence of UPDATing a\r\n> column.\r\n\r\nHmm.. this doesn't seem right to me. I would have thought the\r\ndefiner/owner of the table containing the generation clause would\r\ncarry that burden alone. In section 10.4 6 SR 6 a), the wording is \r\n\r\n\"If RI is contained in an <SQL schema statement>, then an SQL-invoked\r\nroutine R is an executable routine if and only if R is a possibly\r\ncandidate routine and the applicable privileges for the <authorization\r\nidentifier> that owns the containing schema include EXECUTE on R.\"\r\n\r\nA create table statement is a SQL schema statement, so I think the\r\nabove will apply?\r\n\r\n\r\n> \r\n> \r\n> -----------------------------------------\r\n> \r\n> Check Constraints\r\n> \r\n> Similarly, there are two kinds of permissions related to CHECK constraints:\r\n> \r\n> C1) SELECT permission on the columns mentioned in the CHECK\r\n> constraint. I do not see any language in the Standard suggesting\r\n> that you need explicit SELECT permission on all of the columns\r\n> mentioned by the CHECK constraint. That permission seems to be\r\n> implied by the INSERT privilege you enjoy on the table and the\r\n> UPDATE privilege you may enjoy on a column mentioned by the CHECK\r\n> constraint.\r\n\r\nAgain, makes sense.\r\n\r\n> \r\n> C2) EXECUTE permission on functions invoked by the CHECK\r\n> constraint. This is addressed by part 2, section 4.28.3 (Execution\r\n> of SQL-invoked routines). The user executing the UPDATE statement\r\n> must enjoy EXECUTE permission on the functions invoked by the CHECK\r\n> constraint.\r\n\r\nSame objection as above for generation clause.\r\n\r\n\r\n\r\n> -----------------------------------------\r\n> \r\n> Triggers\r\n> \r\n> There are two kinds of permissions related to triggers:\r\n> \r\n> T1) The permission to SELECT columns from the source table in order\r\n> to construct transition variables and transition tables. These\r\n> permissions are described by part 2 of the Standard, section 11.49\r\n> (trigger definition), access rule 3. In order to declare a trigger,\r\n> the trigger owner must have SELECT privilege on the whole source\r\n> table if the trigger has transition variables or tables. It is my\r\n> understanding that the SELECTion of source columns at runtime\r\n> happens under the original aegis of the trigger owner. Moreover, I\r\n> don't see any language suggesting that the trigger becomes\r\n> un-runnable if the trigger owner later loses TRIGGER and/or SELECT\r\n> privilege on the source table.\r\n\r\nAgain, I'd expect a revoke to barf in this case unless we have drop\r\ncascading...\r\n\r\n> \r\n> T2) The permission to execute the trigger action. I can't find any\r\n> language specifying special treatment of permissions for the trigger\r\n> action. I believe that the trigger action runs with the privileges\r\n> of the user who invoked the original, triggering\r\n> INSERT/UPDATE/DELETE.\r\n\r\nYes, that is my understanding, too.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2013-12-10T21:15:24.525+0000","updated":"2013-12-10T21:15:24.525+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13844813","id":"13844813","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"I went through the SQL spec for UPDATE statement with simple columns (ie with no special clause on the columns involved in the SET clause) and the spec interpretation seems right that the column on the left would require UPDATE privilege and column on the right will require SELECT privilege.\r\n\r\nAs for unique cases for foreign keys,and trigger action, with a quick glance at the spec, from a quick glance at the spec, I was also not able to find information in the spec about what would happen if the REFERENCES or TRIGGER privileges are revoked. It would seem that Derby will/should catch the existing dependencies when those privileges are revoked and  revoke would fail.\r\n\r\nI have question about generated column \"permission related to generation clause : SELECT permission on the columns mentioned in the generation clause. I do not see any language in the Standard suggesting that you need explicit SELECT permission on all of the columns mentioned by the generation clause. That permission seems to be implied by the INSERT privilege you enjoy on the table and the UPDATE privilege you may enjoy on a column mentioned by the generation clause. \" I don't quite understand what you mean by \"the UPDATE privilege you may enjoy on a column mentioned by the generation clause.\"\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-12-10T23:25:15.150+0000","updated":"2013-12-10T23:25:15.150+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13845382","id":"13845382","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for the feedback, Dag and Mamta. Dag, I will respond to your comments later.\r\n\r\nHi Mamta,\r\n\r\nI'm sorry about that confusing wording. I was trying to say the following:\r\n\r\nGiven the following definition...\r\n\r\ncreate table fred.t\r\n(\r\n    a int,\r\n    b int,\r\n    c generated always as ( a + b )\r\n);\r\n\r\n...RUTH can issue the following UDPATE...\r\n\r\nupdate fred.t set a = 1;\r\n\r\n...provided that she enjoys the following GRANT...\r\n\r\ngrant update ( a ) on fred.t to ruth;\r\n\r\n...and she does not need the following additional GRANTs...\r\n\r\ngrant select ( b ) on fred.t to ruth;\r\ngrant update ( c ) on fred.t to ruth;\r\n\r\nHope that's less confusing.\r\n\r\nThanks,\r\n-Rick\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-11T13:21:08.192+0000","updated":"2013-12-11T13:21:08.192+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13845426","id":"13845426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks again for the feedback, Dag. Let me continue the discussion of privileges related to foreign keys.\r\n\r\n-----------------------------\r\n\r\n>> \"have\" meaning have a privilege granted (to user of PUBLIC), or\r\n>> granted to the current role, right?\r\n\r\nPart 2, section 11.8 (referential constraint definition), access rule 1 is all I have to go on:\r\n\r\n\"The applicable privileges for the owner of T shall include REFERENCES for each referenced column.\"\r\n\r\nNote that the Standard is talking about the privileges of the owner of T, not the privileges of the person issuing the DDL. So consider the following statements issued by the DBO:\r\n\r\ncreate table alice.primaryTable\r\n(\r\n    a int primary key\r\n);\r\n\r\ngrant references ( a ) on table alice.primary to ref_role;\r\n\r\ngrant ref_role to fred;\r\n\r\nNow suppose that the DBO issues the following statement:\r\n\r\ncreate table fred.foreignTable\r\n(\r\n    b int references alice.primaryTable( a )\r\n);\r\n\r\nI don't think that FRED has a meaningful default role here which can be used to supplement the privileges needed for this statement. I think that the CREATE TABLE statement should fail. The following GRANT is needed to make it succeed:\r\n\r\ngrant references ( a ) on table alice.primary to fred;\r\n\r\n-----------------------------\r\n\r\n>> Hmm.. this seems wrong to me. I'd expect this dependency to be\r\n>> tracked, and Derby to barf (with RESTRICT semantics by default) when\r\n>> that privilege was revoked (or cascades as the case might be)...\r\n\r\nYes, I agree with you. The following statement will fail...\r\n\r\nrevoke references ( a ) on table alice.primary from fred restrict;\r\n\r\n...if the foreign key was created. The following statement will drop the foreign key...\r\n\r\nrevoke references ( a ) on table alice.primary from fred cascade;\r\n\r\nThat, at least, is my reading of the extensive general rules in part 2, section 12.7 (revoke statement).\r\n\r\nNote that all of this is orthogonal to the privileges required for an UPDATE of fred.foreignTable. If there is a foreign key, it imposes no privilege-checking burden on an UPDATE statement. The UPDATE statement may need to be re-compiled if a foreign key is added or dropped, but the foreign key does not add any privilege checks to the UPDATE statement.\r\n\r\nThanks,\r\n-Rick\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-11T14:18:34.765+0000","updated":"2013-12-11T14:18:34.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13845428","id":"13845428","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks again for the feedback, Dag. Let me continue the discussion of privileges related to triggers.\r\n\r\n-----------------------------\r\n\r\n>> Again, I'd expect a revoke to barf in this case unless we have drop\r\n>> cascading...\r\n\r\nYes, I agree with you.\r\n\r\nThanks,\r\n-Rick\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-11T14:22:50.456+0000","updated":"2013-12-11T14:22:50.456+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13846484","id":"13846484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"In offline conversations with Dag, Knut, Dyre, and Kim, I have come to the conclusion that the authorization context stack (described in the 2011 SQL Standard, part 2, section 4.28.3 (Execution of SQL-invoked routines)) refers to the pushing of a new authorization context AFTER you enter a routine and start executing nested SQL statements inside it. I cannot find any language in the Standard suggesting that the user who issues an INSERT/UPDATE/MERGE statement must have privilege to run routines invoked by CHECK constraints or generated columns. Those routines execute under the aegis of the table owner. So I agree with Dag that we should strike the privilege restrictions mentioned in C2 and G2 above.\r\n\r\nI also think we should strike claim T2 above. The SQL Standard explicitly states that triggered actions execute under the aegis of the trigger owner. Here is the relevant language from the 2011 SQL Standard, part 2, section 4.39.1 (General description of triggers):\r\n\r\n\"A triggered action is always executed under the authorization of the owner of the schema that includes the trigger.\"\r\n\r\nMuch of this is asserted by the Developer's Guide section titled \"Privileges on views, triggers, and constraints\": http://db.apache.org/derby/docs/10.10/devguide/cdevcsecureprivileges.html. That section should be expanded to include generated columns as expressions which execute under the aegis of the table owner.    \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-12T17:38:07.617+0000","updated":"2013-12-12T17:38:07.617+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13846518","id":"13846518","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"As a result of the discussion over the past couple days, I have come to the conclusion that constraints, generated columns, and triggers do not impose any privilege burdens on INSERT/UPDATE/DELETE/MERGE statements. The privilege burdens related to constraints, generated columns, and triggers are satisfied at DDL time.\r\n\r\nAs a result, I would revise the privilege requirements for UPDATE statements as follows. Let P be the union of the privileges granted to the current user and the privileges granted to the current role.\r\n\r\n1) P must contain UPDATE privilege for all columns on the left side of SET operators.\r\n\r\n2) P must contain all privileges needed to evaluate the right side of SET operators and run the WHERE clause. That includes:\r\n\r\na) SELECT privilege on all columns mentioned on the right side of SET operators and by the WHERE clause\r\n\r\nb) EXECUTE privilege on all functions invoked on the right side of SET operators and by the WHERE clause\r\n\r\nc) USAGE privilege on all types, sequences, and aggregates mentioned on the right side of SET operators and by the WHERE clause.\r\n\r\nOther opinions?\r\n\r\nThanks,\r\n-Rick\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-12T18:06:28.978+0000","updated":"2013-12-16T13:19:04.281+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13854291","id":"13854291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6429-01-ab-privilegeFilters.diff. This is a preliminary version of a fix to this bug. I expect that errors will pop up when I run the full regression tests. In addition, I plan to write additional tests. I'm attaching this preliminary version because I think it is a promising approach.\r\n\r\nMy first attempt to fix this bug failed. This is what I tried inside UpdateNode.bindStatement():\r\n\r\n1) Analyze - Collect a list of all the nodes which should give rise to privilege checks.\r\n\r\n2) Bind - Continue binding as usual.\r\n\r\n3) Rebind - At the end of UpdateNode.bindStatement(), create a new CompilerContext and rebind just the nodes which were identified in step 1.\r\n\r\nThis approach failed because step 2 ended up changing the AST in a way which made it impossible to determine the correct permissions during step 3 for certain edge-cases. These cases involved views.\r\n\r\nThe current patch does something subtler:\r\n\r\n1') Analyze - Mark all nodes which should give rise to privilege checks at run time.\r\n\r\n2') Bind - Bind as usual. However, only add privilege checks for the nodes marked during step 1'.\r\n\r\n3') Rebind - Rebind UDT references. These can occur on any ValueNode and so can't be picked up during step 1'.\r\n\r\nThe patch introduces the following abstractions:\r\n\r\nVisitableFilter - This is a generic filter for qualifying QueryTreeNodes\r\n\r\nQueryTreeNode tags - QueryTreeNodes can be tagged for various purposes now.\r\n\r\nThe patch works by tagging QueryTreeNodes during step 1' and then only compiling privilege checks for nodes which pass a TagFilter during step 2'.\r\n\r\nI am hoping that VisitableFilters and QueryTreeNode tags are general tools which may be useful for other purposes.\r\n\r\n\r\nTouches the following files:\r\n\r\n-------------\r\n\r\nA       java/engine/org/apache/derby/iapi/sql/compile/TagFilter.java\r\nM       java/engine/org/apache/derby/iapi/sql/compile/Visitable.java\r\nA       java/engine/org/apache/derby/iapi/sql/compile/VisitableFilter.java\r\n\r\nSupport for filtering QueryTreeNodes based on tags.\r\n\r\n-------------\r\n\r\nM       java/engine/org/apache/derby/iapi/sql/compile/CompilerContext.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/CompilerContextImpl.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/QueryTreeNode.java\r\n\r\nAdds the ability to declare filters for privilege checking.\r\n\r\n-------------\r\n\r\nM       java/engine/org/apache/derby/impl/sql/compile/UpdateNode.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/FromBaseTable.java\r\nM       java/engine/org/apache/derby/impl/sql/compile/StaticMethodCallNode.java\r\n\r\nChanges to limit which QueryTreeNodes give rise to privilege checks for UPDATE statements.\r\n\r\n-------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsHelper.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/store/Derby5234Test.java\r\nM       java/testing/org/apache/derbyTesting/junit/BaseJDBCTestCase.java\r\n\r\nMoves some helper methods which I've been using for years. I want to use these helper method in other test classes, so I'm moving the methods up to BaseJDBCTestCase.\r\n\r\n-------------\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/UDTTest.java\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GrantRevokeDDLTest.java\r\n\r\nNew test for this patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-20T17:45:30.300+0000","updated":"2013-12-20T17:45:30.300+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13854462","id":"13854462","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6429-01-ac-privilegeFilters.diff. The previous rev of the patch tripped some errors:\r\n\r\n1) An NPE introduced by the patch\r\n\r\n2) A number of wrong results which had been canonized in in privilege tests.\r\n\r\nThe new patch addresses these problems and touches the following additional file:\r\n\r\nM       java/testing/org/apache/derbyTesting/functionTests/tests/lang/GeneratedColumnsPermsTest.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-20T19:26:12.583+0000","updated":"2013-12-20T19:26:12.583+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855607","id":"13855607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for looking into this bug, Rick. Your approach sounds good to me.\r\n\r\nWhen I looked through the patch the first time, I was a little confused by some of the naming. Nothing major, but here's what confused me:\r\n\r\n1) I had a hard time wrapping my head around the new concept of \"visitable tags\". Until I found out there was no such thing as a \"visitable tag\". :) It became much clearer to me when I learnt to read \"addVisitableTag\" as \"add a tag to this visitable\" instead of \"add a visitable tag\". Maybe dropping \"visitable\" (which is redundant, anyway, since the methods live in the Visitable interface) and calling the new methods \"addTag\" and \"getTags\" would be sufficient?\r\n\r\n2) TagFilter.UPDATE_PRIVS is very similar to Authorizer.UPDATE_PRIV. However, the nodes that get tagged with UPDATE_PRIVS will actually be checked for SELECT_PRIV. Maybe the constant in TagFilter could be called something that more clearly states that it is for privilege checking of the UPDATE statement (as opposed to checking that the UPDATE privilege is granted).\r\n\r\nSome more nits:\r\n\r\n- TagFilter.accept() could have called visitableTags.contains(_tag) instead of doing it manually in a for loop.\r\n\r\n- Maybe it would be a cleaner interface to have\r\n  boolean hasTag(String tag)\r\n  instead of the method that returns the list of tags in the Visitable interface. That would avoid exposing the internal representation through the interface method (which some static code analyzers tend to frown upon and flag as potential security warnings), and it would simplify two of the three callers of getVisitableTags(). (The third caller, StaticMethodCallNode, still needs the list of tags in order to copy it, but this could be done using a package-private method in QTN instead of via the interface.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-12-23T12:47:50.730+0000","updated":"2013-12-23T12:47:50.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855622","id":"13855622","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I ran the following test on the patch:\r\n\r\n{noformat}\r\nij version 10.11\r\nij> connect 'jdbc:derby:memory:db;create=true;user=dbo';\r\nij> call syscs_util.syscs_set_database_property('derby.database.sqlAuthorization', 'true');\r\n0 rows inserted/updated/deleted\r\nij> connect 'jdbc:derby:memory:db;shutdown=true';\r\nERROR 08006: Database 'memory:db' shutdown.\r\nij> connect 'jdbc:derby:memory:db;user=u1' as u1;\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij(U1)> create table t1(x int, y int, z int);\r\n0 rows inserted/updated/deleted\r\nij(U1)> grant update on t1 to u2;\r\n0 rows inserted/updated/deleted\r\nij(U1)> connect 'jdbc:derby:memory:db;user=u2' as u2;\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij(U2)> update u1.t1 set x = y;\r\n0 rows inserted/updated/deleted\r\nWARNING 02000: No row was found for FETCH, UPDATE or DELETE; or the result of a query is an empty table.\r\n{noformat}\r\n\r\nShouldn't the UPDATE statement have failed because U2 didn't have SELECT permission on U1.T1(Y)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-12-23T13:18:28.187+0000","updated":"2013-12-23T13:18:28.187+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855651","id":"13855651","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for those excellent suggestions, Knut. Attaching derby-6429-01-ad-privilegeFilters.diff, which makes the following changes:\r\n\r\n1) Visitable.addVisitableTag() is renamed to addTag()\r\n\r\n2) Visitable.getVisitableTags() is replaced with taggedWith()\r\n\r\n3) New copyTagsFrom() method is added to QueryTreeNode\r\n\r\n4) TagFilter.UPDATE_PRIVS is renamed to NEED_PRIVS_FOR_UPDATE_STMT\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-23T14:06:06.567+0000","updated":"2013-12-23T14:06:06.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855655","id":"13855655","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for test-driving this patch, Knut. I am able to reproduce the behavior you are seeing. It's wrong. I'll look into it. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-23T14:10:57.601+0000","updated":"2013-12-23T14:10:57.601+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855673","id":"13855673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6429-01-ae-privilegeFilters.diff. This patch fixes the bug Knut tripped across.\r\n\r\nThe problem was that a ColumnReference was being cloned and the tags from the original ColumnReference weren't propagated to the clone. I have added a copyTagsFrom() call to ColumnReference.copyFields(). That fixes this bug. I added a regression test case for this problem to GrantRevokeDDLTest.\r\n\r\nLet me know if you can think of other instances of this bug. The only other parallel to this bug which I found by code inspection was the cloning of ResultColumns. I added a copyTagsFrom() call to ResultColumn.cloneMe().\r\n\r\nThanks!\r\n-Rick\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-23T15:01:01.254+0000","updated":"2013-12-23T15:01:01.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855732","id":"13855732","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for making these changes, Rick.\r\n\r\nI found another anomaly (also seen without the patch):\r\n\r\n{noformat}\r\nij> connect 'jdbc:derby:memory:db;user=u1' as u1;\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij(U1)> create table t1(x int);\r\n0 rows inserted/updated/deleted\r\nij(U1)> create table t2(x int);\r\n0 rows inserted/updated/deleted\r\nij(U1)> insert into t2 values 1, 2;\r\n2 rows inserted/updated/deleted\r\nij(U1)> grant update on t1 to u2;\r\n0 rows inserted/updated/deleted\r\nij(U1)> connect 'jdbc:derby:memory:db;user=u2' as u2;\r\nWARNING 01J14: SQL authorization is being used without first enabling authentication.\r\nij(U2)> update u1.t1 set x = (select x from u1.t2);\r\nERROR 21000: Scalar subquery is only allowed to return a single row.\r\n{noformat}\r\n\r\nI would have expected the UPDATE statement to fail with a privilege error. Instead, it fails with an error message that reveals that U1.T2 contains more than one row. U2 shouldn't be able to get that info without a SELECT privilege on U1.T2, I think.\r\n\r\nIf U1.T2 is empty or contains only one row, the UPDATE statement fails with the expected permission error.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-12-23T16:26:54.271+0000","updated":"2013-12-23T16:26:54.271+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855751","id":"13855751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks for continuing to test-drive this patch, Knut. I am able to reproduce your results. Looking at the stack traces for both experiments (with and without rows in the table in the subquery), here is my theory about what is happening:\r\n\r\n1) The subquery result is being materialized as a OnceResultSet which runs before the UPDATE runs.\r\n\r\n2) But all of the permissions attached to the statement are checked just before the UpdateResultSet executes.\r\n\r\n3) If the OnceResultSet contains more than one row, then it raises the \"Scalar subquery is only allowed to return a single row\" error before the permissions associated with the UpdateResultSet are checked.\r\n\r\nFixing this may required some thought. The permissions are attached to the CompilerContext during the bind() phase. They are not attached to individual query blocks. I think that the decision to materialize the subquery is made during the pre-processing phase of optimization. By that time, we have lost all memory of which query block the permissions came from.\r\n\r\nI would tend to regard this as another bug with privilege management, which deserves its own JIRA. What are your thoughts?\r\n\r\nThanks,\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-23T16:53:29.709+0000","updated":"2013-12-23T16:53:29.709+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855761","id":"13855761","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Maybe we don't have to change the compiler much in order to fix this new issue you've found. The fix may be as simple as performing the runtime privilege checks on the first ResultSet that is materialized. Authorization checks are performed by GenericResultSetFactory.getUpdateResultSet() but not by GenericResultSetFactory.getOnceResultSet().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-23T16:59:42.588+0000","updated":"2013-12-23T16:59:42.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855781","id":"13855781","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It sounds reasonable to handle it as a separate bug, as it can also be seen outside of UPDATE:\r\n\r\n{noformat}\r\nij(U2)> values (select x from u1.s);\r\nERROR 21000: Scalar subquery is only allowed to return a single row.\r\n{noformat}\r\n\r\nI've filed DERBY-6439.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-12-23T17:20:18.629+0000","updated":"2013-12-23T17:20:18.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855811","id":"13855811","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-6429-01-af-privilegeFilters.diff. This patch adds some more test cases. I am running regression tests now.\r\n\r\nThis patch adds tests for cases when views and table functions appear in the WHERE clause and on the right side of SET operators.\r\n\r\nTouches the same files as the previous versions of the patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2013-12-23T18:12:43.591+0000","updated":"2013-12-23T18:12:43.591+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13855895","id":"13855895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1553197 from [~rhillegas] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1553197 ]\r\n\r\nDERBY-6429: Bring privilege checks on UPDATE statements into closer alignment with the SQL Standard; tests passed cleanly on derby-6429-01-af-privilegeFilters.diff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-12-23T20:07:45.964+0000","updated":"2013-12-23T20:07:45.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13864809","id":"13864809","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"It seems like we should mark this jira as not suitable for backport because of compatibility reasons. The privileges required for UPDATE statement with this fix will now be different than those required by previous releases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2014-01-07T22:43:49.752+0000","updated":"2014-01-07T22:43:49.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13865418","id":"13865418","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"That sounds like a reasonable suggestion, Mamta. This bugfix might be especially disruptive. Your question prompted me to mark this issue as needing a release note. How are we tagging issues which are unsuitable for backport? I didn't see an appropriate label, but maybe I need another cup of coffee this morning. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-08T13:35:46.611+0000","updated":"2014-01-08T13:35:46.611+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13866871","id":"13866871","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Rick, I just put a new label \"backport_reject_10_10\" in the label field. Hope that is the right way to mark it reject for backport to 10.10 and prior releases.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2014-01-09T18:17:29.105+0000","updated":"2014-01-09T18:17:29.105+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13866872","id":"13866872","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Also, there were number of privileges related jira that were created while researching on this jira. I am wondering if those should be marked reject for backport and release note required as well. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2014-01-09T18:19:04.508+0000","updated":"2014-01-09T18:19:04.508+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13866875","id":"13866875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks, Mamta. I have added the backport_reject_10_10 label to DERBY-3434. That's where I'm doing the corresponding work for INSERTs and DELETEs. I've already flagged that it needs a release note. I think that should be good enough for the moment. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-09T18:22:45.486+0000","updated":"2014-01-09T18:23:02.787+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13872580","id":"13872580","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a first draft of a release note for this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-15T20:56:22.656+0000","updated":"2014-01-15T20:56:22.656+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13873520","id":"13873520","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I believe that I am done with the changes which I intend to make for this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-16T15:50:54.777+0000","updated":"2014-01-16T15:50:54.777+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/13873542","id":"13873542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a second rev of the release note (corrected a typo).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2014-01-16T16:08:42.955+0000","updated":"2014-01-16T16:08:42.955+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12683643/comment/14284879","id":"14284879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"bulk change to close all issues resolved but not closed and not changed since June 1, 2014.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2015-01-21T00:23:52.327+0000","updated":"2015-01-21T00:23:52.327+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6429/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1qitr:"}}