{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12373115","self":"https://issues.apache.org/jira/rest/api/latest/issue/12373115","key":"DERBY-2905","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2007-07-30 18:15:43.345","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23313","customfield_12310222":"1_*:*_1_*:*_114128407088_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2011-02-15T20:51:27.026+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2905/watchers","watchCount":1,"isWatching":false},"created":"2007-07-05T22:31:20.939+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"25.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312027","id":"12312027","description":"","name":"10.2.2.0","archived":false,"released":true,"releaseDate":"2006-12-19"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12337791","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12337791","type":{"id":"12310010","name":"Incorporates","inward":"is part of","outward":"incorporates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"},"outwardIssue":{"id":"12500202","key":"DERBY-5085","self":"https://issues.apache.org/jira/rest/api/2/issue/12500202","fields":{"summary":"After specifying deregister=false on the engine shutdown URL, Derby forgets that the default behavior is deregister=true","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12340656","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12340656","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12513022","key":"DERBY-5316","self":"https://issues.apache.org/jira/rest/api/2/issue/12513022","fields":{"summary":"Unload old JDBC drivers when done with them in the upgrade tests","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12369673","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12369673","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12647706","key":"DERBY-6224","self":"https://issues.apache.org/jira/rest/api/2/issue/12647706","fields":{"summary":"Issues with latest JDK 8 EA build because of missing SQLPermission","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-09-03T08:31:33.585+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"}],"timeoriginalestimate":null,"description":"After a shutdown of the embedded driver the AutoloadDriver is not unregistered from DriverManager. However it does not support any future loading of connections so it has no value in remaining registered. Since the DriverManager class will remain forever, this means the Derby code will remain forever in the JVM, even if Derby was loaded by a separate class loader.\r\n\r\nRegression from 10.1 since before the AutoloadedDriver the internal driver did unregister itself from the DriverManager on a shutdown.","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35933","summary":"Shutting down embedded Derby does not remove all code, the AutoloadDriver is left registered in the DriverManager.","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":73,"total":73,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12516462","id":"12516462","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"marking urgent since this is a regression.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-07-30T18:15:43.345+0000","updated":"2007-07-30T18:15:43.345+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12516463","id":"12516463","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Reverting this issue to normal urgency. This issue occurs in 10.2. I do not believe that this old issue should block the incremental release of other quality improvements.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2007-07-30T18:22:43.504+0000","updated":"2007-07-30T18:22:43.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12518931","id":"12518931","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"body":"Attaching a reproducible test case with this issue.\r\nAs mentioned in the description, the AutoloadedDriver is not unregistered \r\nfrom the DriverManager. The attached test case shows the behavior as \r\nfollows:\r\n\r\n ** Check for Autoloaded driver before DB shutdown\r\n- Testing with org.apache.derby.jdbc.EmbeddedDriver\r\n- Getting Registered Drivers\r\n        sun.jdbc.odbc.JdbcOdbcDriver\r\n        org.apache.derby.jdbc.AutoloadedDriver\r\n        org.apache.derby.jdbc.ClientDriver\r\n- Shutting Down Database\r\n        Database shut down normally\r\n\r\n** Check for Autoloaded driver after DB shutdown\r\n- Getting Registered Drivers\r\n        sun.jdbc.odbc.JdbcOdbcDriver\r\n        org.apache.derby.jdbc.AutoloadedDriver\r\n        org.apache.derby.jdbc.ClientDriver\r\n\r\nin 10.1, the above test case shows Driver30 successfully unregistering after \r\ndatabase shutdown:\r\n** Check for Autoloaded driver before DB shutdown\r\n- Testing with org.apache.derby.jdbc.EmbeddedDriver\r\n- Getting Registered Drivers\r\n        org.apache.derby.jdbc.Driver30\r\n- Shutting Down Database\r\n        Database shut down normally\r\n\r\n** Check for Autoloaded driver after DB shutdown\r\n- Getting Registered Drivers\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"created":"2007-08-10T07:18:38.151+0000","updated":"2007-08-10T07:18:38.151+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12518937","id":"12518937","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"body":"Attaching an interim patch for this issue.\r\nThe AutoloadedDriver is now unregistering itself from DriverManager\r\nas follows:\r\n** Check for Autoloaded driver before DB shutdown\r\n- Testing with org.apache.derby.jdbc.EmbeddedDriver\r\n- Getting Registered Drivers\r\n        sun.jdbc.odbc.JdbcOdbcDriver\r\n        org.apache.derby.jdbc.ClientDriver\r\n        org.apache.derby.jdbc.AutoloadedDriver\r\n- Shutting Down Database\r\n        Database shut down normally\r\n\r\n** Check for Autoloaded driver after DB shutdown\r\n- Getting Registered Drivers\r\n        sun.jdbc.odbc.JdbcOdbcDriver\r\n        org.apache.derby.jdbc.ClientDriver\r\n\r\n\r\nI appreciate your comments/review.\r\n\r\nThanks\r\nRamin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"created":"2007-08-10T07:54:46.834+0000","updated":"2007-08-10T07:54:46.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12519054","id":"12519054","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Patch looks good. Adding a test case to jdbcapi.AutoloadTest would be good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-08-10T16:21:51.084+0000","updated":"2007-08-10T16:21:51.084+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12520282","id":"12520282","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"body":"Thanks dan for your review.\r\nI am attaching another patch for this issue. I appreciate\r\nyour comments/review.\r\n\r\nThanks\r\nRamin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"created":"2007-08-16T16:03:51.841+0000","updated":"2007-08-16T16:03:51.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12520295","id":"12520295","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Ramin, your patch looks good. I noticed though that for the new entry (JDBC_DRIVER_UNREGISTER_ERROR) in MessageId.java, there was no corresponding error text message entry in org.apache.derby.loc:messages.xml","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2007-08-16T16:35:24.062+0000","updated":"2007-08-16T16:35:24.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12520385","id":"12520385","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"The first patch was simple, just adding a deregister of the driver.\r\n\r\nThe new patch (v1) does a lot more, can you please explain what is going on?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-08-16T21:54:56.463+0000","updated":"2007-08-16T21:54:56.463+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12520410","id":"12520410","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"body":"Hello Dan,\r\n\r\nYes, the v0 patch was simpler however, I noticed that it has some problems.\r\nPlease consider the following scenario:\r\n1) The DB is shut down and therefore, the Autoloaded driver is\r\nunregistered.\r\n2) The user tries to explicitly load the Embedded driver using\r\nClass.forName(..).newInstance()\r\n\r\nWith v0 patch, the user couldn't load the Embedded driver explicitly after\r\nthe DB shutdown and I was getting the \"No Suitable Driver\" error.\r\n\r\nI think the problem was that the DriverManager.registerDriver() was being\r\ncalled in a static block and therefore it was called only once to load the\r\nAutoloadedDriver. With the changes in v1 patch, the user can explicitly load the Embedded\r\ndriver after the DB shutdown and after the Autoloaded driver is being\r\nunregistered. The AutoloadedDriver.registerDriverModule(...) takes care of registering the\r\ndriver when the user is explicitly loading the Embedded driver.\r\n\r\nI am attaching a testcase with this issue. If you apply the v0 patch and run the\r\ntestcase, you will see the behavior I am explaining above.\r\n\r\nThanks\r\nRamin\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"created":"2007-08-16T23:27:12.950+0000","updated":"2007-08-16T23:27:12.950+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12520426","id":"12520426","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"body":"Thanks Mamta for your review. I am attaching the v3 patch \r\naddressing your review comments.\r\nI ran derbyall and suites.All without any errors.\r\n\r\nThanks\r\nRamin","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=moazeni","name":"moazeni","emailAddress":"rmoazeni at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ramin Moazeni","active":true},"created":"2007-08-17T00:36:56.115+0000","updated":"2007-08-17T00:36:56.115+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12524853","id":"12524853","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I working on committing this patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-09-04T20:13:52.298+0000","updated":"2007-09-04T20:13:52.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12524897","id":"12524897","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I reworked the test cases in the v3 patch into AutoLoadTest.java and committed them with revision 572822.\r\nMain changes were:\r\n  don't add an unused method\r\n  split the test cases into two fixtures & reuse some existing code for reloading the embedded driver.\r\n  don't assume JDBC 4\r\n  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-09-04T22:08:04.163+0000","updated":"2007-09-04T22:08:04.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12530136","id":"12530136","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Marking patch available so we hopefully get some comments on this patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-09-25T15:40:07.701+0000","updated":"2007-09-25T15:40:07.701+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12533120","id":"12533120","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"On Sept 4, Dan said\r\n>I working on committing this patch.\r\n\r\nDan, could you give us an update on your review of this issue?  Are there changes needed to the patch?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2007-10-08T12:48:27.044+0000","updated":"2007-10-08T12:48:27.044+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12537404","id":"12537404","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"I think the patch results in code that is brittle, it adds more state about the boot state of the class when it already has a couple of fields trying to manage state.\r\n\r\nIn addition its seems the registering of Derby's embedded driver has become overly complex, some due in part to previous changes, also I think the patch means that the autoloaded driver gets re-used on a re-boot which doesn't seem the right life-cycle for java.sql.Driver.\r\n\r\nI did try thinking about an alternate approach, more in-line with the original code (pre-JDBC 4 autoload) changes where a driver registers itself only, but I then got distracted by other stuff.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2007-10-24T20:12:57.235+0000","updated":"2007-10-24T20:12:57.235+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12543127","id":"12543127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"body":"The last comment seems pretty close to a \"-1\" for the patch. If that is true, perhaps it would be good to remove 'Patch available' for the time being, at least?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dyret","name":"dyret","emailAddress":"Dyre dot Tjeldvoll at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dyre Tjeldvoll","active":true},"created":"2007-11-16T16:24:59.906+0000","updated":"2007-11-16T16:24:59.906+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12611301","id":"12611301","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Ramin, are you still working on this issue. It would be good to unassign yourself if you are not.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2008-07-07T19:29:08.893+0000","updated":"2008-07-07T19:29:08.893+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12977414","id":"12977414","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"A user (Kuber) on IRC was inquiring about this issue. Rick: Do you have any understanding or insight on what need to be done to fix this bug since you worked on autoloaded driver (DERBY-930)?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-01-04T19:03:14.521+0000","updated":"2011-01-04T19:03:14.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12977437","id":"12977437","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Lily,\r\n\r\nIt has been a long time since I thought about this issue and I no longer remember what the issues are. It is not clear to me what will happen if the driver is unregistered when the engine is shut down. Quite likely, that will break driver autoloading since the JRE autoloads drivers only once. The JRE autoloads the drivers on the very first attempt to resolve a connection URL via DriverManager.getConnection(). Subsequent calls to DriverManager.getConnection() do not trigger autoloading. I can understand that some users want to garbage collect the Derby classes after the engine shuts down. It is likely that other users want autoloading behavior to continue after engine shutdown. It may be possible to satisfy both types of users--and it may not be. An ideal solution would do the following:\r\n\r\n1) Unload all (or almost all) of the Derby classes after engine shutdown.\r\n\r\n2) Preserve the autoloading idiom that resolves a connection url provided that some jarball on the classpath provides an appropriate driver.\r\n\r\nWhat happens if you explicitly deregister the Derby driver after engine shutdown? What happens if you reregister the Derby driver later on?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-01-04T20:09:49.083+0000","updated":"2011-01-04T20:09:49.083+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12978895","id":"12978895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Hi Rick:\r\n     Thank you so much for the prompt response and leading me to the ideal solution we would like to have - satisfied users who would like to have the 10.1 behavior and users who would like to have the autoloading behavior. Judging from the timeframe of the discussion, this is not an easy problem to get agreement upon.  I have to admit I don't totally understand all the complication so any health debate is welcome with the modify solution inspire by Ramin and Dan. The DERBY-2905-1.diff is the proposal patch and Repro2905.java is to show Derby behavior before and after this patch.\r\n\r\n     I found this solution solve the following issues\r\n1.\tUnload Derby classes after engine shutdown.\r\n2.\tPreserve 10.1 behavior and support any future loading of connections\r\nDisadvantage:  It does not preserve the autoloading idiom.\r\n\r\nI am proposing Derby allows support any future loading of connections.\r\n\r\nI did not testing the impact of performance for this patch. Suites.all runs clean.\r\n\r\nAny proposal solution is welcome. Thanks!!!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-01-07T18:05:09.766+0000","updated":"2011-01-07T18:05:09.766+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12978916","id":"12978916","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Lily,\r\n\r\nOne way forward may be to separate class-unloading from engine shutdown. I suspect that many users would be satisfied with an explicit api which removed all of the Derby classes, and they would not insist that class-unloading be a side-effect of orderly shutdown. We could document that this new api breaks the autoloading idiom and we could give users instructions on how to reboot the engine and obtain new Derby connections after the unloading. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-01-07T18:56:28.079+0000","updated":"2011-01-07T18:56:28.079+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12980813","id":"12980813","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think shutdown=true with no database specified should shutdown the entire system and deregister the driver as documented.\r\nhttp://db.apache.org/derby/docs/dev/ref/rrefattrib16471.html\r\n\r\nI have seen quite a few cases with memory leaks because Derby is loaded in multiple class loaders and leaking because the shutdown is not performed in the same classloader context as the boot and those applications needed to be changed to make sure the shutdown occurred in the proper loader.   I don't think it is good to add an additional step as all those applications that have made this change would need to add the additional step and their leaks might reoccur upon upgrade of Derby and the JVM as long as this bug exists.\r\n\r\nPerhaps the new API should be to shutdown while keeping the autoloaded driver. Perhaps a new or modified attribute. I am not very good with names but something like, deregister=<true|false> (only valid with shutdown)  and have it default to true.\r\n\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-01-12T17:17:10.801+0000","updated":"2011-01-12T17:17:10.801+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12981202","id":"12981202","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Adding a deregister attribute to the URL when shutting down the system sounds like a good idea to me. I think true would be a reasonable default, as that would make the behaviour consistent with the documentation. I don't think that it would break the autoloading idiom any more than it already is in this case. If we do a getConnection() after a driver shutdown, without doing Class.forName(...).newInstance() in between, we get this exception with the current code:\r\n\r\nException in thread \"main\" java.sql.SQLException: org.apache.derby.jdbc.EmbeddedDriver is not registered with the JDBC driver manager\r\n        at org.apache.derby.jdbc.AutoloadedDriver.getDriverModule(AutoloadedDriver.java:186)\r\n        at org.apache.derby.jdbc.AutoloadedDriver.connect(AutoloadedDriver.java:119)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:620)\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:222)\r\n\r\nIf we make shutdown deregister AutoloadedDriver, we'd probably get a \"No suitable driver\" error instead, but I don't think that's any worse than what we have now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-01-13T10:27:29.727+0000","updated":"2011-01-13T10:27:29.727+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12984247","id":"12984247","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Thanks Knut and Kathey.  I think shutdown=true should shutdown the  entire system and deregister the driver as document. DERBY-2905-2.diff is implementing that. In AutoloadDriver, the _autoloadedDriver is to keep track of the AutoloadedDriver when getConnection is called the first time and did not get trigger on the following calls. This implementation did not truly implement deregister=true other than introduce the attribute.  I am posting the patch to make sure we agree on the proposal and whether I am on the right trace of fixing this issue. \r\n\r\nTo summary the current proposal: \r\nshutdown=true will shutdown the entire system and deregister the driver as document. On top of that, we will introduce deregister attribute. If deregister=false, we will keep the autoloading idiom and allow further getConnection after that. The default behavior for shutdown will be setting deregister=true. \r\n\r\nSome note about the patch:\r\nDriver20.stop will deregister the driver as document when shutdown attribute is set. No change is needed.\r\n\r\nEmbeddedDataSource.java If AutoloadedDriver has been deregister from previous shutdown, just get the current driver.\r\n\r\nAttribute.java introduce deregister attribute\r\n\r\nAutoloadedDriver: handle register and deregister driver. i.e. AutoloadedDriver, Driver40(other if using different version of jvm) Need to know whether it is register driver the first time or after AutoloadedDriver has been initiated. I am using _driverModule to keep track of the derby driver and _autoloadedDriver to keep track of the AutoloadedDriver object. \r\n\r\nWhat is not implemented? The work of deregister=false. \r\n\r\nSuites.all runs clean.  \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-01-20T16:02:16.325+0000","updated":"2011-01-20T16:02:16.325+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12986665","id":"12986665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":" I looked the  DERBY-2905-2.diff patch.   I am not so clear on all the autoloading implications, so it would be good if someone else could take a look too.  Here are my comments.\r\n\r\nIn EmbeddedDataSource findDriver() I think we should just Call DriverManager.getDriver(url) once and save the value. to improve performance and make the code clearer.  I was sort of surprised that finding the driver is done for every connection rather than on instantiating the DataSource, but that was a preexisting situation. \r\n\r\nIn AutoloadedDriver  I wonder if we can avoid having the new activeautoloadeddriver boolean and just use the _autoloadedDriver  and check if it was null. \r\n\r\nIn unregisterDriverManager, I wonder if _autoLoadedDriver should be set to null and also if the driverModule shouild be deregistered  even if the autoloaded driver is registered.\r\n\r\nIn the test we should not import ClientDataSource directly and instead use JDBCDataSource.getDataSource() and also should not assume the driver is Driver40 as it might be Driver30 etc. \r\n\r\nAgain I am pretty fuzzy on this autoloading stuff so it would be good if someone else could look.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-01-25T20:24:26.652+0000","updated":"2011-01-25T20:24:26.652+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12987087","id":"12987087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Thanks Kathey. Yes, it will be great to have someone else look at the patch too. I upload DERBY-2905_3.diff based on your comments.\r\n\r\nIn EmbeddedDataSourceFindDriver(), DriverManager.getDriver(url) is saved to improve performance. Having finding driver in DataSource instead of every connection could improve performance and oo design. Is there any other impact to Derby system?\r\n\r\nI tried to used _autoloadedDriver==null to handle AutoloadedDriver.registerDriverModule smf AutoloadedDriver.unregisterDriverModule. I am trouble by _driverModule not being set at all the appropriate time causing some of the getConnection get \"not suitable driver\" error either after Class.forName(url).newInstance(). I suggest to keep the activeautoloadeddriver Boolean to remember the very first time AutoloadedDriver is initiated and getting deregister from DriverManager.\r\n\r\nThe _autoloadedDriver is set to null in AutoloadedDriver.unregisterDriverModule.\r\n\r\nIn the test, the import of ClientDataSource is taking out and we test unregisterDriverModule on  Driver40, Driver30, and Driver20.\r\n\r\nSuites.all and derbyall run clean. The code is ready to review. It will be nice to see more review. I am writing the code for deregister attribute on shutdown time. \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-01-26T16:50:56.510+0000","updated":"2011-01-26T16:50:56.510+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12987639","id":"12987639","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Regressions ran ok, committed DERBY-2905_3.diff as svn 1063996 for the first part of fix.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-01-27T16:41:47.568+0000","updated":"2011-01-27T16:41:47.568+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12988975","id":"12988975","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"The DERBY-2905_part2_1.diff patch adds the attribute deregistere. The default behavior on shutdown is to deregister AutoloaderDriver. If users specify deregister=false attribute at shutdown, Derby will not deregister AutoloadedDriver. And, getConnection will get a new connection. I still need to write releaseNote.html for this issue.\r\n\r\nI had run more tests on the side. I am still in the middle of getting them into AutoloadTest. The code is ready for review especially on adding new error message part. I am not sure we should add new error message here. Any suggestion is welcome.\r\n\r\nRunning suites.all and derbyall now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-01T00:35:13.877+0000","updated":"2011-02-01T00:35:13.877+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12991598","id":"12991598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching ww.java. This patch shows an odd side-effect of the 1063996 submission. Before that submission, reloading the engine via Class.forName(...) resulted in the AutoloadedDriver being registered. After the 1063996 checkin, the same sequence of steps results in Driver40 being registered. I think it would be better if DriverManager.getDriver() always returned an AutoloadedDriver. I have some misgivings that supporting two paths here is going to give rise to mischief.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-07T20:53:42.265+0000","updated":"2011-02-07T20:53:42.265+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12991970","id":"12991970","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Thanks Rick. I am uploading patch DERBY_2905_part2_2.diff to change the reloading the engine via Class.forName(…) resulted in the AutoloadedDriver registered. This patch also provide the deregister attribute. The default behavior for shutdown=true is to set deregister=true. AutoloadedDriver will not be in DriverManager. If users set deregister=false, the AutoloadDriver will not be deregister from DriverManager. The AutoloadTest create test cases like: default shutdown behavior, deregister=true, deregister=false and also wrong name of deregister attribute. The patch is ready for review. \r\nSuites.all and derby passed before fixing the reload engine resulted in AutoloadedDriver begin registered. I will run the tests again.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-08T13:57:53.258+0000","updated":"2011-02-08T13:57:53.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992020","id":"12992020","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Thanks, Lily. I have applied the patch and verified that it fixes the behavior shown by the ww.java test case. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-08T16:00:44.771+0000","updated":"2011-02-08T16:00:44.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992434","id":"12992434","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Thanks, Rick. The patch is check-in svn 1068842. If the reloading the engine via Class.forName(...).newInstance resulted in AutoloadedDriver registered does not load the desire AutoloadedDriver, please feel free to change the code. Before resync the latest change, Suites.all and derbyall passed. Hope this help, thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-09T11:07:33.626+0000","updated":"2011-02-09T11:07:33.626+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992474","id":"12992474","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Lily, the latest patch (DERBY_2905_part2_2) doesn't have the Apache grant flag set, so I think you should reattach it, so it's legally in order :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-02-09T13:25:47.173+0000","updated":"2011-02-09T13:25:47.173+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992475","id":"12992475","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Oops! You are absolutely right. I reattach DERBY-2905_part2_2_1.diff and check the Apache grant flag. Thank you so much for catching that, Dag.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-09T13:31:43.236+0000","updated":"2011-02-09T13:31:43.236+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992482","id":"12992482","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Looks like there were two new failures in the Tinderbox after the latest commit: http://dbtg.foundry.sun.com/derby/test/tinderbox_trunk16/jvm1.6/testing/testlog/SunOS-5.10_i86pc-i386/1068846-org.apache.derbyTesting.functionTests.suites.All_diff.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-02-09T13:51:31.290+0000","updated":"2011-02-09T13:51:31.290+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992486","id":"12992486","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I read through the latest patch, some small nits and possible a test bug:\r\n\r\n* In AutoloadedDriver, typo in new comment:\r\n  > //This flag is set is deregister attribute is set by user, \r\n                     ** \"if\" instead of second \"is\"\r\n  > //default is true (DERBY-2905)\r\n \r\n  Better insert space after \"//\" too, for readability.\r\n  If I understand this correctly, if the default is \"true\", a more\r\n  correct comment would perhaps be:\r\n\r\n  \"This flag is true unless the deregister attribute has been set to\r\n  false by the user (DERBY-2905).\" \r\n\r\n* InternalDriver, new comment:\r\n  \r\n  > // DERBY-2905, allow users to provide deregister attribute to \r\n  > // left AutoloadedDriver in DriverManager, default value is true\r\n\r\n  \"left AutoloadedDriver\" -> \"leave AutoloadedDriver registered\"\r\n\r\n* AutoloadTest\r\n\r\n  Typo in comment:\r\n\r\n  > * the AutoloadDriver is dergistered from DriverManager.\r\n                                            *** \"dergistered\"\r\n\r\n  This looks like a test bug:\r\n\r\n  > //Case 1: Test the deregister attribute error\r\n  > JDBCDataSource.setBeanProperty(ds, \"connectionAttributes\",\r\n  >    \"shutdown=true;deregiste=false\");\r\n                             ** missing \"r\" in \"deregister\" ?\r\n\r\n  The extraneous blank inside \"true\" below looks suspicious, not sure\r\n  if it works as expected:\r\n \r\n  > JDBCDataSource.setBeanProperty(ds, \"connectionAttributes\",\r\n  >      \"shutdown=tru e;deregister=false\");\r\n                     *** \"tru e\"\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-02-09T13:59:46.534+0000","updated":"2011-02-09T13:59:46.534+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992533","id":"12992533","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Thanks Dag for reviewing the patch.\r\n\r\nI read through the latest patch, some small nits and possible a test bug: \r\n\r\n* In AutoloadedDriver, typo in new comment: \r\n  > //This flag is set is deregister attribute is set by user, \r\n                     ** \"if\" instead of second \"is\" \r\n  > //default is true (DERBY-2905) \r\n>>I change the typo in DERBY-2905_part2_2_2.diff\r\n  \r\n  Better insert space after \"//\" too, for readability. \r\n  If I understand this correctly, if the default is \"true\", a more \r\n  correct comment would perhaps be: \r\n\r\n  \"This flag is true unless the deregister attribute has been set to \r\n  false by the user (DERBY-2905).\" \r\n>>Add the space and change the commend.\r\n\r\n* InternalDriver, new comment: \r\n   \r\n  > // DERBY-2905, allow users to provide deregister attribute to \r\n  > // left AutoloadedDriver in DriverManager, default value is true \r\n\r\n  \"left AutoloadedDriver\" -> \"leave AutoloadedDriver registered\" \r\n>>Change the comment in the new patch.\r\n\r\n* AutoloadTest \r\n\r\n  Typo in comment: \r\n\r\n  > * the AutoloadDriver is dergistered from DriverManager. \r\n                                            *** \"dergistered\" \r\n\r\n>>Change in the patch\r\n  This looks like a test bug: \r\n\r\n  > //Case 1: Test the deregister attribute error \r\n  > JDBCDataSource.setBeanProperty(ds, \"connectionAttributes\", \r\n  > \"shutdown=true;deregiste=false\"); \r\n                             ** missing \"r\" in \"deregister\" ? \r\n>>This is the desire test. The typo is by design. I believe the behavior is expected.\r\nWhen I run in ij, I got:\r\nij> connect 'jdbc:derby:system/wombat;shutdown=true;deregiste=false';\r\nURL Attribute [deregiste=false]\r\n   Attribute is unknown to Derby.\r\nERROR 08006: Database 'system/wombat' shutdown.\r\n\r\n  The extraneous blank inside \"true\" below looks suspicious, not sure \r\n  if it works as expected: \r\n  \r\n  > JDBCDataSource.setBeanProperty(ds, \"connectionAttributes\", \r\n  > \"shutdown=tru e;deregister=false\"); \r\n                     *** \"tru e\" \r\n>>The space is taking out with the new patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-09T15:34:18.765+0000","updated":"2011-02-09T15:34:18.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992536","id":"12992536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Hi Knut:\r\n    When I run it with DERBY-2905_part2_2_2.diff patch. I did not see the two \r\nnew failures.\r\nThis is the my results. I will keep on looking. Please see the following:\r\n$ java -Dderby.tests.trace=true junit.textui.TestRunner org.apache.derbyTesting\r\n.functionTests.tests.jdbc4.Driver40Test\r\n.\r\ntest_jdbc4_1 used 6 ms .\r\ntest_jdbc4_1 used 55 ms\r\nTime: 12.188\r\n\r\nOK (2 tests)\r\n$ java -Dderby.tests.trace=true junit.textui.TestRunner org.apache.derbyTesting\r\n.functionTests.tests.jdbcapi.DriverTest\r\n.\r\ntestDriverCompliantVersion used 194 ms .\r\ntestAcceptsURL used 4 ms .\r\ntestEmbeddedAttributes used 20034 ms .\r\ntestClientAttributes used 4 ms .\r\ntestClientURL used 6 ms .\r\ntestDbNameWithSpaces used 6644 ms .\r\ntestDriverCompliantVersion used 140 ms .\r\ntestAcceptsURL used 4 ms .\r\ntestEmbeddedAttributes used 13573 ms .\r\ntestClientAttributes used 6817 ms .\r\ntestClientURL used 6394 ms .\r\ntestDbNameWithSpaces used 6604 ms\r\nTime: 71.389\r\n\r\nOK (12 tests)\r\n\r\nThanks,\r\nLily\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-09T15:38:57.728+0000","updated":"2011-02-09T15:38:57.728+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12992758","id":"12992758","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Hi Lily,\r\n\r\nI applied the part2_2_2 patch, and I still see the failure in jdbc4.Driver40Test. Or to be precise, I see the failure when I run jdbc4._Suite. I do not see the failure when I run Driver40Test separately. Perhaps the test behaves differently when the driver has been loaded before the test starts?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-02-09T22:33:39.226+0000","updated":"2011-02-09T22:33:39.226+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993069","id":"12993069","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Thanks Knut. You are right, the test does behave differently when the driver has been loaded and shutdown has been issued before the test starts. When we first start embedded engine, AutoloadedDriver40 is created by Derby and loaded in DriverManager. With the current code, reloading engine after shutdown via for.ClassName(…).newInstance will result AutoloadedDriver loaded in DriverManager. Jdbc4.Driver40Test and jdbcapi.DriverTest both assume AutoloadedDriver40 is in DriverManager when JDBC.vmSupportsJDBC4() is true. I am attaching DERBY-2905_part2_2_3.diff patch. This patch assumes the current AutoloadedDriver.registerDriverModule() behavior is correct. If this is not a correct assumption, please feel free to change the code. I did run jdbc4._Suite and jdbcapi._Suite and they are passing on my machine.  Please review the code. If it is okay with everybody, I can check-in when I get home. I am currently in HongKong airport. Happy Chinese New Year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-10T14:39:39.072+0000","updated":"2011-02-10T14:39:39.072+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993166","id":"12993166","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I have looked at the DERBY-2905_part2_2_3.diff patch. It does indeed make Driver40Test succeed. But that is because it disables the tests which Driver40Test is trying to perform. The actual functionality remains broken. After reloading the engine on Java 6 or higher, the registered driver should be an AutoloadedDriver40. That is because that is the driver which contains the getParentLogger() method required by JDBC 4.1. The getParentLogger() method does not exist in AutoloadedDriver.\r\n\r\nHere is the output of ww.java after applying this patch:\r\n\r\norg.apache.derby.jdbc.AutoloadedDriver40@42b307f0\r\norg.apache.derby.jdbc.AutoloadedDriver@236acdd1\r\n\r\nBoth lines should report an AutoloadedDriver40.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-10T18:52:47.127+0000","updated":"2011-02-10T18:52:47.127+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993171","id":"12993171","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I think I lied to you in my comment on 2011-02-08. The DERBY_2905_part2_2.diff patch seems to have changed the reloaded driver from a Driver40 into an AutoloadedDriver. I saw the AutoloadedDriver bit but I missed the fact that it did not end in 40. So that patch made the situation worse. -1 to that patch now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-10T19:02:23.464+0000","updated":"2011-02-10T19:02:23.464+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993638","id":"12993638","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"What user functionality is broken with the DERBY_2905_part2_2.diff?   I have not seen any failures on JDK 1.6. Is it  JDK 1.7 specific related functionality of getParentLogger when the AutoloadedDriver is reloaded after shutdown?   Since there is no regression to previous releases and no JDK 1.7 released. I think it would make sense to file a separate issue for the JDK 1.7 issue and work on that separately as part of the JDBC 4.1 work.\r\n\r\nI think in general the Autoloader code was designed with the assumption that it would never be unloaded with all the references in DataSources and such, so it was quite tricky I think for Lily to figure out how to get the updates in all the right places, but it does work and is a great improvement over the current state.   Maybe the addition of AutoloadedDriver40 warrants a refactoring to remove that assumption.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-02-11T18:58:37.402+0000","updated":"2011-02-11T18:58:37.402+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993647","id":"12993647","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Kathey. Yes the user-visible functionality is visible on JDK 7. The problem also appears on JDK 6 in the form that the registered driver is different after reloading the engine. That will cause tech support a lot of mischief down the road because it will give rise to subtle problems which depend on whether an action is performed before or after reloading the engine. I  have provided a test case which shows the problem of different drivers on JDK 6: ww.java. -1 to your suggestion that this is a JDBC 4.1 problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-11T19:13:35.647+0000","updated":"2011-02-11T19:13:35.647+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993650","id":"12993650","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I take part of that back. Perhaps you cannot see this with ww.java on JDK 6. In any event, I have spent a lot of time implementing JDBC 4.1 and I do not appreciate the problem being kicked over to me.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-11T19:16:44.291+0000","updated":"2011-02-11T19:16:44.291+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993651","id":"12993651","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am not kicking it over to you personally but rather suggesting we file a separate issue and whomever is interested in fixing it can, but as you recall this issue, DERBY-2905 was a regression introduced by your original Autoloader work. Several times your work has introduced outright regressions including this one that you have left to others to fix.  In this case of this regression, Lily has worked hard to fix the regression  and made her plans clear over the course of development.   I am sure it would have been helpful to communicate more about potential conflicts during that process.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-02-11T19:32:11.252+0000","updated":"2011-02-11T19:32:11.252+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993663","id":"12993663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"+1 on communicating more in turn of conflicts and potential fix. I will be more than happy to keep working on resolving getParentLogger issue for AutoloadedDriver. I will definitely appreciate Rick's suggestion for how to proceed.\r\nAs far as I can see, we need to create AutoloadedDriver40 in AutoloadedDriver.registerDriverModule. Something like this:\r\n           if (_autoloadedDriver == null) {\r\n                //Support JDBC 4 or higher (DERBY-2905)\r\n                if (HAVE_DRIVER && HAVE_SQLXML) {\r\n                    AutoloadedDriver40.reloadAutoloadedDriver40();\r\n                }\r\nHowever, I am having compiler error on the line \"AutoloadedDriver40.reloadAutoloadedDriver40 on reflect, invoke etc.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-11T19:54:49.235+0000","updated":"2011-02-11T19:54:49.235+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993673","id":"12993673","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Kathey, no one is faulting Lily's hard work or cleverness here. She has done a great job. But this is tricky code. I think you should avoid personalizing the issue. It is not helpful. Perhaps we should have a friendly chat over a couple beers next week. The -1 stands.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-11T20:10:10.707+0000","updated":"2011-02-11T20:10:10.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993676","id":"12993676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Lily,\r\n\r\nThe following code snippet may help move this forward:\r\n\r\n    public  static  AutoloadedDriver    makeAutoloadedDriver()\r\n    {\r\n        try {\r\n            return (AutoloadedDriver) Class.forName( \"org.apache.derby.jdbc.AutoloadedDriver40\" ).newInstance();\r\n        }\r\n        catch (Throwable t) {}\r\n\r\n        return new AutoloadedDriver();\r\n    }\r\n\r\nHope that's useful.\r\n\r\nRegards,\r\n-Rick","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-11T20:24:10.532+0000","updated":"2011-02-11T20:24:10.532+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993677","id":"12993677","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think there is no reason to veto the patch. The fix is a marked improvement in behavior, fixes the regression  and causes no functional regression from a released version.  Let's file a new issue for the minor getParentLogger  after shutdown issue, fix that and move forward.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-02-11T20:24:16.132+0000","updated":"2011-02-11T20:24:16.132+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993680","id":"12993680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I think that Lily is going to very close to fixing this. Let's help her do that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-11T20:32:26.793+0000","updated":"2011-02-11T20:32:26.793+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993694","id":"12993694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-2905-01-aa-fixAutoloadedDriverReload.diff. This appears to fix the problem with Driver40Test. I will run regression tests.\r\n\r\nThis patch applies the solution from my previous comment.\r\n\r\nTouches the following file:\r\n\r\nM      java/engine/org/apache/derby/jdbc/AutoloadedDriver.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-02-11T20:56:46.108+0000","updated":"2011-02-11T20:56:46.108+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12993695","id":"12993695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Sounds good and thank you for helping. That,  I think is generally is a better approach than rejecting a valuable contribution outright.    Lily filed DERBY-5029 to track the issue moving forward.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-02-11T20:57:46.125+0000","updated":"2011-02-11T20:57:46.125+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12994964","id":"12994964","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Add release notes. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-15T19:48:02.143+0000","updated":"2011-02-15T19:48:02.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12994997","id":"12994997","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Add release notes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-02-15T20:50:37.107+0000","updated":"2011-02-15T20:50:37.107+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/12995096","id":"12995096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Release notes look good. +1.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-02-16T00:46:25.480+0000","updated":"2011-02-16T00:46:25.480+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13000828","id":"13000828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching an updated release note.\r\n\r\nMade the summary a one-liner (\"System shutdown now deregisters the embedded JDBC driver\") and incorporated the information in the original summary into the other sections.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-03-01T11:10:27.571+0000","updated":"2011-03-01T11:10:27.571+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13000947","id":"13000947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Adjusted the release note. Further adjustment may be needed depending on the answer to the question which I just posted on DERBY-5043.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-03-01T16:34:41.989+0000","updated":"2011-03-01T16:34:41.989+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13000983","id":"13000983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I definitely think it was valuable to have information on the deregister attribute in the release note, because it was added as part of this change and especially because it might not make the 10.8 documentation, so +1 to adjusting the releaseNote to include it once again.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-03-01T17:47:23.034+0000","updated":"2011-03-01T17:47:23.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13000991","id":"13000991","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"We should document this attribute in the user guides unless this is an experimental feature which we intend to change in a future release. I will adjust the release note after I have something I can point at. I will hold off building an RC until after this documentation is complete.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-03-01T17:59:06.537+0000","updated":"2011-03-01T17:59:06.537+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13001033","id":"13001033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"We definitely want to keep the functionality. The only thought  of change that came to mind for me in this exchange is that perhaps the double negative might be confusing.   The only possible alternative I could think of would be something like keepregistered=true  instead of deregister=false, but maybe it is fine the way it is as that would be kind of wordy and we would need to change it quickly.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2011-03-01T19:13:29.964+0000","updated":"2011-03-01T19:13:29.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13001061","id":"13001061","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"I don't have strong religion about what to call this attribute. I think that deregister=true is fine. I would prefer to leave it alone now that Kim is in the middle of documenting the feature.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-03-01T19:46:33.649+0000","updated":"2011-03-01T19:46:33.649+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13001070","id":"13001070","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chaase3","name":"chaase3","emailAddress":"camilla dot haase at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kim Haase","active":true},"body":"I might amend that to say, \"Kim, who is already confused enough, is in the middle of documenting the feature\" ;-)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chaase3","name":"chaase3","emailAddress":"camilla dot haase at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kim Haase","active":true},"created":"2011-03-01T19:55:11.168+0000","updated":"2011-03-01T19:55:11.168+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13002317","id":"13002317","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Should we adjust the release note about deregister attribute so it is consistent with documentation?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-03-03T23:25:29.987+0000","updated":"2011-03-03T23:25:29.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13002641","id":"13002641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a new version of the release note for this issue. This version refers the reader to the Reference Manual for more information on the deregister attribute. Does this version look OK?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-03-04T14:59:53.947+0000","updated":"2011-03-04T14:59:53.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13002666","id":"13002666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Thanks Rick. The release note looks great. If there is anything I would add, it will be the actual link of deregister attribute in the Derby Reference Manual. However, I think it will be easy for users just Google it.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-03-04T15:28:27.920+0000","updated":"2011-03-04T15:28:27.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13002670","id":"13002670","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Hi Lily. We could add a link to the documentation for the deregister attribute, but the link won't work while we are evaluating the RC. That is because the 10.8 docs will not have been posted on the Derby site yet. I would prefer to not create that situation. Thanks.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-03-04T15:36:45.084+0000","updated":"2011-03-04T15:36:45.084+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13002683","id":"13002683","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"Thanks Rick. This is like catch 22 problem. :-) No, I wouldn't want to have that situation as well.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-03-04T16:02:22.896+0000","updated":"2011-03-04T16:02:22.896+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13017442","id":"13017442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching a new version of the release note. This version removes the blockquotes which violate the accessibility guidelines at http://www.w3.org/TR/WCAG10/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2011-04-08T13:12:32.087+0000","updated":"2011-04-08T13:12:32.087+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13212640","id":"13212640","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=whisperer","name":"whisperer","emailAddress":"alert_red_sun at freenet dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian","active":true},"body":"I have the feeling this bug is not fixed or I have a similar problem.\r\nI use tomcat 6.0.26 and an embedded derby(Bundle-Name: Apache Derby 10.8 Bundle-Version: 10.8.2000002.1181258). \r\nThere is always the following line logged into the catalina.log on stopping my tomcat.\r\n\r\nSEVERE: A web application registered the JBDC driver [org.apache.derby.jdbc.AutoloadedDriver40] but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=whisperer","name":"whisperer","emailAddress":"alert_red_sun at freenet dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian","active":true},"created":"2012-02-21T15:07:43.247+0000","updated":"2012-02-22T08:26:59.040+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13213466","id":"13213466","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=whisperer","name":"whisperer","emailAddress":"alert_red_sun at freenet dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian","active":true},"body":"\r\nHere my code for the shutdown:\r\n\r\nContext ctx = new InitialContext(env);\r\nEmbeddedConnectionPoolDataSource ds = (EmbeddedConnectionPoolDataSource)ctx.lookup(DB_CONTEXT);\r\nif (ds != null) {\r\n   ds.setShutdownDatabase(\"shutdown\");\r\n   ds.getConnection();\r\n}\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=whisperer","name":"whisperer","emailAddress":"alert_red_sun at freenet dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sebastian","active":true},"created":"2012-02-22T08:55:06.160+0000","updated":"2012-02-22T08:55:06.160+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/13213517","id":"13213517","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Maybe you're just shutting down the database, and not the database engine? To shut down the engine, make sure there's no database name set in the data source by calling ds.setDatabaseName(null) before getConnection().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2012-02-22T10:41:29.146+0000","updated":"2012-02-22T10:41:29.146+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12373115/comment/14119594","id":"14119594","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-09-03T08:31:33.567+0000","updated":"2014-09-03T08:31:33.567+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-2905/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06iif:"}}