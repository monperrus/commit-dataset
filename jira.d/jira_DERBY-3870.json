{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12404018","self":"https://issues.apache.org/jira/rest/api/latest/issue/12404018","key":"DERBY-3870","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317968","id":"12317968","description":"second release on the 10.8 branch","name":"10.8.2.2","archived":false,"released":true,"releaseDate":"2011-10-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12316344","id":"12316344","description":"First release on the 10.9 branch","name":"10.9.1.0","archived":false,"released":true,"releaseDate":"2012-06-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-09-10 02:45:19.396","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23889","customfield_12310222":"3_*:*_2_*:*_943726749_*|*_1_*:*_1_*:*_84735563658_*|*_5_*:*_3_*:*_25068344258_*|*_4_*:*_2_*:*_178911130","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-03-16T16:30:26.990+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3870/watchers","watchCount":3,"isWatching":false},"created":"2008-09-09T19:34:41.310+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_backport_reject_10_7"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"10.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313111","id":"12313111","description":"","name":"10.4.1.3","archived":false,"released":true,"releaseDate":"2008-04-24"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313401","id":"12313401","description":"Head of 10.4 branch","name":"10.4.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314116","id":"12314116","description":"10.5.2 Release July 30 2009 (794445) Now deprecated","name":"10.5.2.0","archived":false,"released":true,"releaseDate":"2009-07-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12339497","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12339497","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12509398","key":"DERBY-5263","self":"https://issues.apache.org/jira/rest/api/2/issue/12509398","fields":{"summary":"xmlTestTriggerWithXMLOperators(org.apache.derbyTesting.functionTests.tests.upgradeTests.BasicSetup) fails with java.lang.NoSuchMethodError","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-06-25T07:58:08.230+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"\r\nWe insert rows into a table using the following prepared statement (through JDBC):\r\n\r\nINSERT INTO USER1.PSTORE values(?,?, XMLPARSE(document CAST (? AS CLOB) preserve whitespace))\r\n\r\nwhere each of the ?'s are replaced with a string.\r\n\r\nOne thread runs fine. Two or more result in the following exception: \r\n\r\norg.apache.derby.client.am.SqlException: Java exception: 'FWK005 parse may not be called while parsing.: org.xml.sax.SAXException'.\r\n\tat org.apache.derby.client.am.SqlException.<init>(Unknown Source)\r\n\tat org.apache.derby.client.am.SqlException.<init>(Unknown Source)\r\n\r\nWe believe that this comes from the dBuilder.parse(InputSource) method.\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10365","value":"Crash","id":"10365"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35869","summary":"Concurrent Inserts of rows with XML data results in an exception","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ronenr%40cs.technion.ac.il","name":"ronenr@cs.technion.ac.il","emailAddress":"ronenr at cs dot technion dot ac dot il","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Royi Ronen","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10426","value":"Known fix","id":"10426"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10424","value":"Repro attached","id":"10424"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ronenr%40cs.technion.ac.il","name":"ronenr@cs.technion.ac.il","emailAddress":"ronenr at cs dot technion dot ac dot il","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Royi Ronen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"System: MS windows server 2003 standard edition service pack 2. Derby is run as a server on port 1527.","customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":32,"total":32,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/12629685","id":"12629685","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"What sort of errors are in your derby.log file? Can you attach it?\r\n\r\nAlso, can you try extracting as much information as possible from\r\nthe client-side exception by using the techniques described at\r\nhttp://wiki.apache.org/db-derby/UnwindExceptionChain\r\nthen posting that information?\r\n\r\nWhat JDK and XML parser are you using?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2008-09-10T02:45:19.396+0000","updated":"2008-09-10T02:45:19.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/12630674","id":"12630674","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aslom","name":"aslom","emailAddress":"aslom at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Aleksander Slominski","active":true},"body":"hi,\r\n\r\ni was able to fix the problem :) i am attaching ZIP file that contains the fix and simple test that can be built with ant after lib directory is created and populated with derby / xerces/ xalan / serializer jars (see README.txt has details).\r\n\r\n> What JDK and XML parser are you using? \r\n\r\nmostly JDK 1.5 and relatively new xerces/xalan version - i could not find exactly which one by looking into jar file of xerces but xalan from MANIFEST.MF is 2.7.1\r\n\r\ni tested with db-derby-10.4.1.3-bin and db-derby-10.4.2.0-bin and also built from SVN db-derby-snapshot-10.5.0.0-694562 - for all the the same error happens\r\n\r\n> What sort of errors are in your derby.log file? Can you attach it? \r\n\r\nthis is typical exception - i am attaching derby log file\r\n\r\n2008-09-11 21:25:55.453 GMT Thread[DRDAConnThread_7,5,main] (XID = 82480), (SESSIONID = 1), (DATABASE = sample), (DRDAID = NF000001.GD9D-449232841661851773{2}), Failed Statement is: INSERT INTO USER1.PSTORE values(?,?, XMLPARSE(document CAST (? AS CLOB) preserve whitespace)) with 3 parameters begin parameter #1: 1_0 :end parameter begin parameter #2: 1abcde0 :end parameter begin parameter #3: CLOB(826) :end parameter \r\nERROR 2200M: Invalid XML DOCUMENT: FWK005 parse may not be called while parsing.\r\n\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\r\n\tat org.apache.derby.iapi.types.XML.XMLParse(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.SqlXmlExecutor.XMLParse(Unknown Source)\r\n\tat org.apache.derby.exe.acc851401ax011cx534ex27f7x00003f5c9d400.e0(Unknown Source)\r\n\tat org.apache.derby.impl.services.reflect.DirectCall.invoke(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTTobjects(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTT(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)\r\nCaused by: org.xml.sax.SAXException: FWK005 parse may not be called while parsing.\r\n\tat org.apache.xerces.parsers.DOMParser.parse(Unknown Source)\r\n\tat org.apache.xerces.jaxp.DocumentBuilderImpl.parse(Unknown Source)\r\n\tat org.apache.derby.iapi.types.SqlXmlUtil$1.run(Unknown Source)\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:246)\r\n\tat org.apache.derby.iapi.types.SqlXmlUtil.serializeToString(Unknown Source)\r\n\t... 17 more\r\n============= begin nested exception, level (1) ===========\r\norg.xml.sax.SAXException: FWK005 parse may not be called while parsing.\r\n\tat org.apache.xerces.parsers.DOMParser.parse(Unknown Source)\r\n\tat org.apache.xerces.jaxp.DocumentBuilderImpl.parse(Unknown Source)\r\n\tat org.apache.derby.iapi.types.SqlXmlUtil$1.run(Unknown Source)\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:246)\r\n\tat org.apache.derby.iapi.types.SqlXmlUtil.serializeToString(Unknown Source)\r\n\tat org.apache.derby.iapi.types.XML.XMLParse(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.SqlXmlExecutor.XMLParse(Unknown Source)\r\n\tat org.apache.derby.exe.acc851401ax011cx534ex27f7x00003f5c9d400.e0(Unknown Source)\r\n\tat org.apache.derby.impl.services.reflect.DirectCall.invoke(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.RowResultSet.getNextRowCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.NormalizeResultSet.getNextRowCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.DMLWriteResultSet.getNextRowCore(Unknown Source)\r\n\tat org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)\r\n\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)\r\n\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAStatement.execute(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTTobjects(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.parseEXCSQLSTT(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)\r\n\tat org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)\r\n\r\n\r\n> Also, can you try extracting as much information as possible from \r\n> the client-side exception by using the techniques described at \r\n> http://wiki.apache.org/db-derby/UnwindExceptionChain \r\n> then posting that information? \r\n\r\nhere it is:\r\n\r\n\r\nserver:\r\n     [java] preparing tables\r\n     [java] conn being returned is:org.apache.derby.client.net.NetConnection@b96\r\n0b96\r\n     [java] tables preparation ended\r\n     [java] preparing XML to String\r\n     [java] preparing workers\r\n     [java] conn being returned is:org.apache.derby.client.net.NetConnection@668\r\n06680\r\n     [java] conn being returned is:org.apache.derby.client.net.NetConnection@46c\r\n046c\r\n     [java] starting 2 threads\r\n     [java] all insert threads started\r\n     [java]\r\n     [java] ----- SQLException -----\r\n     [java]   SQLState:   2200M\r\n     [java]   Error Code: -1\r\n     [java]   Message:    Invalid XML DOCUMENT: FWK005 parse may not be called w\r\nhile parsing.\r\n     [java]\r\n     [java] ----- SQLException -----\r\n     [java]   SQLState:   XJ001\r\n     [java]   Error Code: 99999\r\n     [java]   Message:    Java exception: 'FWK005 parse may not be called while\r\nparsing.: org.xml.sax.SAXException'.\r\n     [java] Exception in thread \"Thread-1\" java.lang.RuntimeException: inserting\r\n 0 failed:null rawXML=<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n     [java] <fn:filenetEvent pstore:class=\"custom\" pstore:id=\"61\"\r\n     [java]     xmlns:fn=\"http://foo.var\"\r\n     [java]     xmlns:pstore=\"http://bar.var\" >\r\n     [java]   <pstore:appID>1abcde0</pstore:appID>\r\n     [java]   <fn:documentID>5EE285D7-AF83-4B62-A2B5-BBB91FE2ADD4</fn:documentID\r\n>\r\n     [java]   <pstore:displayName>Email</pstore:displayName>\r\n     [java]   <fn:to>lisa@maricopa.watson.ibm.com</fn:to>\r\n     [java]   <fn:action>Creation</fn:action>\r\n     [java]   <fn:timeStamp>Wed, 30 Jul 2008 18:33:00</fn:timeStamp>\r\n     [java]   <fn:title>Loan application 101 customer response</fn:title>\r\n     [java]   <fn:systemTimeStamp>1abcde00</fn:systemTimeStamp>\r\n     [java]   <fn:from>chuck@maricopa.watson.ibm.com</fn:from>\r\n     [java]   <fn:documentType>email</fn:documentType>\r\n     [java]   <fn:subject>RE: WeFinance Loan Application 101</fn:subject>\r\n     [java]   <fn:loanID>101</fn:loanID>\r\n     [java]   <fn:actor>lisa</fn:actor>\r\n     [java] </fn:filenetEvent>\r\n     [java]\r\n     [java]     at ThreadInsert.insertSome(Unknown Source)\r\n     [java]     at ThreadInsert.run(Unknown Source)\r\n     [java]     at java.lang.Thread.run(Thread.java:810)\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aslom","name":"aslom","emailAddress":"aslom at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Aleksander Slominski","active":true},"created":"2008-09-12T20:29:37.528+0000","updated":"2008-09-12T20:29:37.528+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/12630675","id":"12630675","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aslom","name":"aslom","emailAddress":"aslom at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Aleksander Slominski","active":true},"body":"regression test and fix for the issues","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aslom","name":"aslom","emailAddress":"aslom at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Aleksander Slominski","active":true},"created":"2008-09-12T20:30:31.292+0000","updated":"2008-09-12T20:30:31.292+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/12630676","id":"12630676","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aslom","name":"aslom","emailAddress":"aslom at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Aleksander Slominski","active":true},"body":"derby log showing error happening server side","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aslom","name":"aslom","emailAddress":"aslom at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Aleksander Slominski","active":true},"created":"2008-09-12T20:31:46.041+0000","updated":"2008-09-12T20:31:46.041+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/12630679","id":"12630679","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aslom","name":"aslom","emailAddress":"aslom at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Aleksander Slominski","active":true},"body":"BTW: the problem seems to stem from the fact that Xerces DocumentBuilder \r\nisn't thread safe as mentioned in \r\nhttp://www.oxygenxml.com/archives/xml-dev/200405/msg00149.html\r\nand the same seems to be true about Serializer.\r\nDocumentBuilderFactory and SerializerFactory seems to be OK \r\nwhen used/shared by multiple threads.\r\n\r\nIf SqlXmlUtil was not shared between threads for exmaple\r\nmade thread private (and possibly recycled after connection is closed) \r\nthen using one DocumentBuilder instance should be fine.\r\n\r\nHowever i was not able to understand life cycle of SqlXmlUtil \r\n(sho is calling SqlXmlExecutor.getSqlXmlUtil()) and what is \r\nelation between activations, connections  and threads ...\r\n\r\nSo proper fix may be to make sure that SqlXmlUtil is safely reused \r\nor not shared between threads ...\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=aslom","name":"aslom","emailAddress":"aslom at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10445","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10445","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10445","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10445"},"displayName":"Aleksander Slominski","active":true},"created":"2008-09-12T20:45:44.900+0000","updated":"2008-09-12T20:45:44.900+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/12726895","id":"12726895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Triaged July 3, 2009: Downgraded to Major, ticked Repro attached and Known fix. Updated Affects versions.\r\nUser has analyzed the issue and proposed how to fix it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2009-07-03T11:16:55.540+0000","updated":"2009-07-03T11:16:55.540+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13031652","id":"13031652","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attached is a JUnit test case that exposes the bug. It runs queries that use all the XML operators in four threads concurrently. The actual failure varies. Sometimes it's a SAXException (FWK005 parse may not be called while parsing), other times it's a NullPointerException.\r\n\r\nI agree that it's wrong to store the SqlXmlUtil instance in the compiled plan. Every activation of the plan should have its own copy. The comments in the code indicate that the caching was there to prevent recompilation of XPath queries for each row when using the XMLQUERY or XMLEXISTS operators. Having one instance per activation would still provide that optimization.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-11T11:39:01.888+0000","updated":"2011-05-11T11:39:01.888+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13031654","id":"13031654","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I checked in the new test case (XMLConcurrencyTest), but disabled it first in XMLSuite so it doesn't get run as part of the regression tests until the bug is fixed.\r\n\r\nCommitted revision 1101839.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-11T11:45:44.588+0000","updated":"2011-05-11T11:45:44.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036154","id":"13036154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The attached patch (1a) seems to fix the bug and allow XML operators to be executed concurrently.\r\n\r\nThe patch makes the following changes:\r\n\r\n1) The SqlXmlUtil instance isn't stored in the compiled plan. Instead, byte code is generated so that a new instance is created the first time the operator is used in an activation (and reused subsequently in the same activation only).\r\n\r\n2) Since the SqlXmlUtil instance is no longer persisted, it no longer implements Formatable, which allowed for removal of a number of methods in the class, as well as entries for the class in RegisteredFormatIds and StoredFormatIds.\r\n\r\n3) Created a new  abstract super-class of UnaryOperatorNode, BinaryOperatorNode and TernaryOperatorNode, in which code that generates byte-code for the different XML operators could be shared. Currently, their only common super-class is ValueNode, which sounds too general for code that's only used by operator nodes.\r\n\r\n4) Enables XMLConcurrencyTest in the regression test suite.\r\n\r\nI've verified that we still don't create/compile the SqlXmlUtil instance for each row with the patch. We do create an instance and compile the XML query on the first row that uses the operator per activation. This also means that if you re-execute a previously executed PreparedStatement, the cached value will be used.\r\n\r\nIn addition to the per-activation compilation of the XML query, we still compile the XML query when creating the SQL query execution plan. This isn't strictly necessary anymore, since the compiled XML query will now be thrown away instead of being stored in the plan. I left the code in there so that syntax errors in the XML query would still generate a compile-time error instead of being delayed to execution-time. I'm open to changing this, but wanted to prevent any behaviour changes in the first iteration.\r\n\r\nOther potential improvements:\r\n\r\n- More common code can probably be pulled from the *naryOperatorNode classes up to their new parent class. But that's outside the scope of this issue.\r\n\r\n- As far as I can see, there's no reason to create a new SqlXmlExecutor instance for every row, as we currently do. The instances are (effectively) immutable, and contain the same values for all rows, so it may make sense to cache the SqlXmlExecutor instances instead of the SqlXmlUtil instances (which can be retrieved from the executors anyway).\r\n\r\n- The SqlXmlExecutor class contains a comment indicating that it belongs in the types package, but it was placed in the execute package because it accessed the Activation class, and the types layer shouldn't depend on the SQL layer. SqlXmlExecutor no longer accesses the Activation class, so it may be possible to move it to the types package now.\r\n\r\nI've run all the regression tests on an earlier version of the patch without seeing any failures. Rerunning the tests now just to be safe, since I've made some small changes to the patch later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-19T12:36:31.327+0000","updated":"2011-05-19T12:36:31.327+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036211","id":"13036211","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"All the regression tests ran cleanly with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-19T14:20:54.197+0000","updated":"2011-05-19T14:20:54.197+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036223","id":"13036223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Your approach seems fine to me. When I was working on the XPLAIN tables I remember thinking\r\nit would be nice if the operator nodes had a closer base class than ValueNode, so that seems\r\nlike a good idea to me.  Isn't it true that the compile classes and the execution classes have a\r\ncommon class hierarchy? Is there a parallel re-factoring of a common base class to be done in\r\nthe other tree? I think that if we move the SqlXmlExecutor from the execute package to the\r\ntypes package, it might be nice to change its name (to remove \"Executor\"). Thanks for cleaning\r\nup this code, it will be nice to have this feature be more reliable.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-05-19T14:31:01.989+0000","updated":"2011-05-19T14:31:01.989+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036379","id":"13036379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks, Bryan.\r\n\r\nI think the execution hierarchy only partially mirrors the compile hierarchy. At least I cannot find any execution classes that correspond to the various operator node classes. The operator nodes seem to be transformed into methods at code-generation time, so there's no class or instance representing them anymore.\r\n\r\nI agree that the \"executor\" name is problematic if we move SqlXmlExecutor to the types package. I'm actually considering a somewhat more drastic approach and remove the class altogether, merging its methods into SqlXmlUtil (which is already in the types package). SqlXmlExecutor is just a thin wrapper around SqlXmlUtil, so I think that would work. Currently, SqlXmlUtil is instantiated once per activation, and SqlXmlExecutor once per row accessed, so they are not a perfect match right now. But as I mentioned in my previous comment, I don't really see any reason why SqlXmlExecutor needs to be instantiated per row, so I'm pretty sure the SqlXmlExecutor class can go away now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-19T19:11:40.578+0000","updated":"2011-05-19T19:11:40.578+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036608","id":"13036608","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"+1 to deleting unnecessary code and classes!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-05-20T00:40:17.028+0000","updated":"2011-05-20T00:40:17.028+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036652","id":"13036652","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"body":"+1 for making SqlXmlUtil and SqlXmlExecutor more intuitive match with per activation or per row access","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lilywei","name":"lilywei","emailAddress":"lilywei at yahoo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Lily Wei","active":true},"created":"2011-05-20T03:43:05.472+0000","updated":"2011-05-20T03:43:05.472+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036753","id":"13036753","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed revision 1125305.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-20T09:59:55.406+0000","updated":"2011-05-20T09:59:55.406+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036785","id":"13036785","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching a followup patch, d3870-2a.diff, which implements the following optimization:\r\n\r\nInstead of doing lazy initialization of the field that holds the SqlXmlUtil instance, when the first row is accessed, the field is now initialized in the activation's constructor. The code generated for the operator can therefore be simplified, as it doesn't need to check if the field is initialized.\r\n\r\nThis change also allows us to remove the redundant compilation of the XML query when the execution plan is created. That redundant compilation was left in the code only to ensure that syntax errors in the XML query were reported at compile-time. Since the activation is created when the statement is prepared, exceptions raised in the activation's constructor will be reported at compile-time (whereas the previous behaviour with lazy initialization would have delayed the error until execution-time).\r\n\r\nAs a consequence, the XML query will now be compiled exactly once per activation. Before this patch, it would be compiled once when creating the plan, and then again once for each activation. Probably not much of an optimization, but it's simpler and feels cleaner that way.\r\n\r\nAll the XML tests passed with the patch. I'll run the full regression test suite too, just in case.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-20T11:30:44.984+0000","updated":"2011-05-20T11:30:44.984+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13036825","id":"13036825","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"All tests passed with the 2a patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-20T13:33:29.420+0000","updated":"2011-05-20T13:33:29.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13037772","id":"13037772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed revision 1126358.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-23T07:44:29.098+0000","updated":"2011-05-23T07:44:29.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13038042","id":"13038042","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"2a looks like a clear improvement to me. +1\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2011-05-23T16:54:12.098+0000","updated":"2011-05-23T16:54:12.098+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13039050","id":"13039050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I'm attaching a new followup patch (3a) which removes the SqlXmlExecutor class. By doing this, we avoid the allocation of one SqlXmlExecutor instance per row seen by an XML operator, and we reduce the amount of code. We still cache the SqlXmlUtil instance in the activation so that the XML queries only have to be compiled once per activation.\r\n\r\nSince SqlXmlExecutor is just a thin wrapper around SqlXmlUtil and XMLDataType, the byte-code generation for the XML operator could be changed to invoke the methods directly on the XMLDataValue objects, passing the cached SqlXmlUtil instance as an argument. Apart from that, only small changes were needed (changing the order and type of arguments in some method signatures where SqlXmlExecutor and XMLDataValue differed, and adding some null handling previously performed by SqlXmlExecutor to the XMLPARSE implementation).\r\n\r\nAll the regression tests passed with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-25T09:33:14.771+0000","updated":"2011-05-25T09:33:14.771+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13039667","id":"13039667","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed revision 1127883.\r\n\r\nMarking the issue as resolved.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-05-26T12:19:09.404+0000","updated":"2011-05-26T12:19:09.404+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13043305","id":"13043305","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Backported the fix to the 10.8 branch (revision 1130983).\r\n\r\nI think we also need to bump the last digit in the version number on the branch in case someone following the updates on the branch has triggers that use XML operators. This is needed because the format of the compiled execution plans has changed, so the triggers need to be recompiled. Bumping the last digit in the version number will make the triggers recompile automatically.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-03T11:15:16.164+0000","updated":"2011-06-03T11:15:16.164+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13043315","id":"13043315","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Uh-oh! Bumping the last digit wasn't enough to get the triggers to recompile cleanly. They fail to read the old plan, which they're just supposed to throw away anyway, because of some serialization error. Possibly because the SqlXmlExecutor class was removed while it's still needed to read the old plans. Seems like the same problem exists when upgrading from 10.8.1.2 to trunk as well, so I'm reopening to fix the upgrade issues.\r\n\r\nI've backed out the fix from the branch until the upgrade issue has been resolved (revision 1131002).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-03T11:49:37.861+0000","updated":"2011-06-03T11:49:37.861+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13043376","id":"13043376","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"It looks like the problems are caused by the code that drops JDBC metadata queries and invalidates stored prepared statement on upgrade. This code scans through SYS.SYSSTATEMENTS and reads every column in every row of the table. When it comes across a statement that uses one of the XML operators, it fails to deserialize the old plan because it contains SqlXmlUtil instances in the savedObject field, and the SqlXmlUtil class doesn't implement Formatable anymore.\r\n\r\nI think the fix is simple. See the attached patch upgrade.diff, which simply makes the upgrade code skip the column that contains the compiled plan. Then the upgrade code is able to fetch the stored statements from the system table and flag them as invalid.\r\n\r\nI would like to add a test case for this in the upgrade tests, but it's a bit tricky since the XML operators aren't always available, and the requirements vary between different versions of Derby, so it's hard to determine whether or not the test case is expected to pass on the platform. I'll give it a try, though.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-03T14:45:37.149+0000","updated":"2011-06-03T14:45:37.149+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13044416","id":"13044416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks for tracking this down! I'm not sure I'd use the word \"simple\" here, but your description\r\nis quite clear, and your upgrade.diff patch looks good to me. I understand your frustration about\r\nthe delicacy of constructing a test to demonstrate this problem, given the platform dependent\r\nXML behavior. Even if you can't easily construct the test, I think that the technique of avoiding\r\nthe problematic compiled-plan column is a reasonable solution, so +1 from me.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2011-06-04T23:46:31.769+0000","updated":"2011-06-04T23:46:31.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13044601","id":"13044601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks for taking a look at the patch, Bryan. I'm uploading a new patch which adds a test case for the upgrade scenario. The test creates a trigger using the old version and verifies that the trigger works after upgrading. Without the fix in the data dictionary, the test fails to boot the database with the new version.\r\n\r\nI think the test handles all combinations of XML ops being supported/not-supported with the old/new Derby version in the running environment. The different cases are handled like this:\r\n\r\n1) If XML ops aren't supported with the new version, the test case is disabled in the test setup (we have helper methods to detect this).\r\n\r\n2) If XML ops are supported with the new version, but not with the old version, the test case runs, but it will detect that CREATE TRIGGER fails with an exception saying XML requirements aren't satisfied. It will immediately return without reporting a failure.\r\n\r\n3) If the situation described in (2) happens, the test case will run in all phases (create, soft-upgrade, post-soft-upgrade, hard-upgrade), but there is no trigger to test. The test case queries the system tables to see if the trigger has been created, and returns immediately if the trigger doesn't exist.\r\n\r\n4) Since XML operators aren't supported at all before version 10.2, and creating the trigger will fail with a different exception than the one we detect as XML requirements not satisfied, the test case is made a no-op if the tested combination uses a too old version. (Actually, it only tests upgrade from 10.3 and newer now. That's because the CREATE TRIGGER statement fails on 10.2 because it lacks the fix for DERBY-1770.)\r\n\r\nAll regression tests passed in my environment.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-05T18:38:59.482+0000","updated":"2011-06-05T18:38:59.482+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13044755","id":"13044755","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed revision 1132546.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-06T09:24:03.921+0000","updated":"2011-06-06T09:24:03.921+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13044837","id":"13044837","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I've now backported the fixes, including the upgrade fix, to the 10.8 branch. I also bumped the version on the branch to 10.8.1.4 in order to make upgrade work for those who follow the branch.\r\n\r\nCommitted revision 1132626.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-06-06T13:24:31.824+0000","updated":"2011-06-06T13:24:31.824+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13229381","id":"13229381","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Reopen for 10.5 backport consideration. If working on the backport for this issue. Temporarily assign yourself and add a comment that you are working on it. When finished, reresolve with the new fix versions or label backport_reject_10_x as appropriate.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-03-14T17:19:47.646+0000","updated":"2012-03-14T17:19:47.646+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13231348","id":"13231348","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Re-resolving this issue without any further backport.\r\nThe portion of this issue suitable for backport was backported all the way to 10.1 with DERBY-5289. The rest looks too involved for a simple backport.  It was actually backported to 10.8 from trunk with a forth digit version bump, so maybe if someone really needed it, they could look at it again.  Marking derby_backport_reject_10_7 for now.\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2012-03-16T16:30:27.054+0000","updated":"2012-03-16T16:30:27.054+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/13685230","id":"13685230","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"[bulk update] Close all resolved issues that haven't been updated for more than one year.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2013-06-17T09:19:24.697+0000","updated":"2013-06-17T09:19:24.697+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12404018/comment/14043158","id":"14043158","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1605285 from [~knutanders] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1605285 ]\r\n\r\nDERBY-6634: Improve test coverage of SqlXmlUtil.java\r\n\r\nRemove dead code from the time when SqlXmlUtil implemented the\r\nFormatable interface (before DERBY-3870).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-06-25T07:58:08.230+0000","updated":"2014-06-25T07:58:08.230+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3870/votes","votes":1,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06i47:"}}