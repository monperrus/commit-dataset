{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12346784","self":"https://issues.apache.org/jira/rest/api/latest/issue/12346784","key":"LUCENE-638","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-07-27 18:56:42.0","customfield_12312323":null,"customfield_12310420":"13115","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_146092000_*|*_6_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-07-29T09:54:11.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-638/watchers","watchCount":1,"isWatching":false},"created":"2006-07-27T17:19:19.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-07-29T09:54:11.000+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[],"timeoriginalestimate":null,"description":"Lucene won't tolerate foreign files in its index directories.  This makes it impossible to keep an index in a CVS or Subversion repository.\n\nFor instance, this exception appears when creating a RAMDirectory from a java.io.File that contains a subdirectory called \".svn\".\n\njava.io.FileNotFoundException: /home/local/ejj/ic/.caches/.search/.index/.svn\n(Is a directory)\n        at java.io.RandomAccessFile.open(Native Method)\n        at java.io.RandomAccessFile.<init>(RandomAccessFile.java:212)\n        at\norg.apache.lucene.store.FSIndexInput$Descriptor.<init>(FSDirectory.java:425)\n        at org.apache.lucene.store.FSIndexInput.<init>(FSDirectory.java:434)\n        at org.apache.lucene.store.FSDirectory.openInput(FSDirectory.java:324)\n        at org.apache.lucene.store.RAMDirectory.<init>(RAMDirectory.java:61)\n        at org.apache.lucene.store.RAMDirectory.<init>(RAMDirectory.java:86)","customfield_10010":null,"timetracking":{},"customfield_12310120":null,"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"27410","summary":"Can't put non-index files (e.g. CVS, SVN directories) in a Lucene index directory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eleanor","name":"eleanor","emailAddress":"ejj at decisionsoft dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eleanor Joslin","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eleanor","name":"eleanor","emailAddress":"ejj at decisionsoft dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eleanor Joslin","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":4,"total":4,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12346784/comment/12423893","id":"12423893","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lucenebugs%40danielnaber.de","name":"lucenebugs@danielnaber.de","emailAddress":"lucenebugs2006 at danielnaber dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Naber","active":true},"body":"What exactly does your code look like? Something else must be wrong because I use an index that's committed to CVS without problems (using Lucene 2.0).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lucenebugs%40danielnaber.de","name":"lucenebugs@danielnaber.de","emailAddress":"lucenebugs2006 at danielnaber dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Naber","active":true},"created":"2006-07-27T18:56:42.000+0000","updated":"2006-07-27T18:56:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12346784/comment/12424048","id":"12424048","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eleanor","name":"eleanor","emailAddress":"ejj at decisionsoft dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eleanor Joslin","active":true},"body":"Here's an example.  Compile and run this with lucene-core-2.0.0.jar in the classpath.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=eleanor","name":"eleanor","emailAddress":"ejj at decisionsoft dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Eleanor Joslin","active":true},"created":"2006-07-28T09:50:16.000+0000","updated":"2006-07-28T09:50:16.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12346784/comment/12424084","id":"12424084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=simonwillnauer","name":"simonwillnauer","emailAddress":"simon dot willnauer at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Willnauer","active":true},"body":"The RAMDirectory class uses the Directory.list() method to create the index input in the constructor. The implementation of FSDirectory returns all containing files of the directory including non lucene files and also all containing directories. \r\nIn my opinion this method should not return non lucene files and directories for consistency. \r\nThe problem does only appear if you create a RamDirectory from a existing index.\r\n\r\nhere is the patch for the trunk: \r\n(I also added a try / finally block in the rename() method to close all streams in the case of an exception on the input stream the output stream would remain open.)\r\nAll test passed, almost no tests in the store package :).\r\n\r\n\r\nIndex: FSDirectory.java\r\n===================================================================\r\n--- FSDirectory.java    (revision 426479) \r\n+++ FSDirectory.java    (working copy) \r\n@@ -211,9 +211,9 @@\r\n     }\r\n   }\r\n \r\n-  /** Returns an array of strings, one for each file in the directory. */ \r\n+  /** Returns an array of strings, one for each lucnene index file in the directory. */ \r\n   public String[] list() {\r\n-    return directory.list(); \r\n+    return directory.list(new IndexFileNameFilter()); \r\n   }\r\n \r\n   /** Returns true iff a file with the given name exists. */\r\n@@ -296,20 +296,23 @@\r\n         throw newExc;\r\n       }\r\n       finally {\r\n-        if (in != null) { \r\n-          try { \r\n-            in.close(); \r\n-          } catch (IOException e) { \r\n-            throw new RuntimeException(\"Cannot close input stream: \" + e.toString(), e); \r\n+    try{       \r\n+          if (in != null) { \r\n+            try { \r\n+              in.close(); \r\n+            } catch (IOException e) { \r\n+              throw new RuntimeException(\"Cannot close input stream: \" + e.toString(), e); \r\n+            } \r\n           }\r\n-        } \r\n-        if (out != null) { \r\n-          try { \r\n-            out.close(); \r\n-          } catch (IOException e) { \r\n-            throw new RuntimeException(\"Cannot close output stream: \" + e.toString(), e); \r\n+    }finally{ \r\n+          if (out != null) { \r\n+            try { \r\n+              out.close(); \r\n+            } catch (IOException e) { \r\n+              throw new RuntimeException(\"Cannot close output stream: \" + e.toString(), e); \r\n+            } \r\n           }\r\n-        } \r\n+    } \r\n       }\r\n     }\r\n   }","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=simonwillnauer","name":"simonwillnauer","emailAddress":"simon dot willnauer at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Willnauer","active":true},"created":"2006-07-28T12:39:44.000+0000","updated":"2006-07-28T12:39:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12346784/comment/12424280","id":"12424280","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lucenebugs%40danielnaber.de","name":"lucenebugs@danielnaber.de","emailAddress":"lucenebugs2006 at danielnaber dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Naber","active":true},"body":"Thanks, this has now been fixed in trunk.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=lucenebugs%40danielnaber.de","name":"lucenebugs@danielnaber.de","emailAddress":"lucenebugs2006 at danielnaber dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel Naber","active":true},"created":"2006-07-29T09:54:11.000+0000","updated":"2006-07-29T09:54:11.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-638/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i051xj:"}}