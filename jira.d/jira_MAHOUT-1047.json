{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12599556","self":"https://issues.apache.org/jira/rest/api/latest/issue/12599556","key":"MAHOUT-1047","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310751","id":"12310751","key":"MAHOUT","name":"Mahout","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310751&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310751&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310751&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310751&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13060","id":"13060","description":"Apache Mahout","name":"Mahout"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320153","id":"12320153","description":"The release will stabilize core components, improve performances and adds new streaming algorithms. Unmaintained code is getting killed as part of this","name":"0.8","archived":false,"released":true,"releaseDate":"2013-07-25"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-07-20 16:04:45.724","customfield_12312323":null,"customfield_12310420":"243566","customfield_12312320":null,"customfield_12310222":"10002_*:*_1_*:*_3285931412_*|*_1_*:*_1_*:*_24081884924_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-06-01T18:21:02.864+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-1047/watchers","watchCount":9,"isWatching":false},"created":"2012-07-20T00:10:46.552+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":["cvb","lda"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319261","id":"12319261","description":"Primarily a cleanup and refactoring release. Some new functionality which has been previously completed and tested may be introduced.","name":"0.7","archived":false,"released":true,"releaseDate":"2012-05-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smarthi","name":"smarthi","emailAddress":"smarthi at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suneel Marthi","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2014-02-03T08:05:53.053+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312151","id":"12312151","name":"Clustering","description":"Bugs related to any of the clustering packages"}],"timeoriginalestimate":null,"description":"After running the new LDA CVB implementation, it hangs and does not terminate the process like every other time I run Mahout\r\n\r\nTerminal output:\r\n\r\n\r\n12/07/19 11:38:49 INFO mapred.LocalJobRunner: \r\n12/07/19 11:38:49 INFO mapred.Task: Task 'attempt_local_0022_m_000000_0' done.\r\n12/07/19 11:38:49 INFO mapred.JobClient:  map 100% reduce 0%\r\n12/07/19 11:38:49 INFO mapred.JobClient: Job complete: job_local_0022\r\n12/07/19 11:38:49 INFO mapred.JobClient: Counters: 8\r\n12/07/19 11:38:49 INFO mapred.JobClient:   File Output Format Counters \r\n12/07/19 11:38:49 INFO mapred.JobClient:     Bytes Written=2247793\r\n12/07/19 11:38:49 INFO mapred.JobClient:   File Input Format Counters \r\n12/07/19 11:38:49 INFO mapred.JobClient:     Bytes Read=1920337\r\n12/07/19 11:38:49 INFO mapred.JobClient:   FileSystemCounters\r\n12/07/19 11:38:49 INFO mapred.JobClient:     FILE_BYTES_READ=1342812616\r\n12/07/19 11:38:49 INFO mapred.JobClient:     FILE_BYTES_WRITTEN=1326092302\r\n12/07/19 11:38:49 INFO mapred.JobClient:   Map-Reduce Framework\r\n12/07/19 11:38:49 INFO mapred.JobClient:     Map input records=2772\r\n12/07/19 11:38:49 INFO mapred.JobClient:     Spilled Records=0\r\n12/07/19 11:38:49 INFO mapred.JobClient:     SPLIT_RAW_BYTES=140\r\n12/07/19 11:38:49 INFO mapred.JobClient:     Map output records=2772\r\n12/07/19 11:38:49 INFO driver.MahoutDriver: Program took 4089950 ms (Minutes: 68.16583333333334)\r\n\r\n$MAHOUT_HOME/mahout cvb -i /home/seth/Scripted/mahout_data/vectors/vectors/vectors-for-cvb/ -o /home/seth/Scripted/mahout_data/clusters/ -ow -k 90 -dt /home/seth/Scripted/mahout_data/distributions -dict /home/seth/Scripted/mahout_data/vectors/vectors/dictionary.file-0 -mt /home/seth/Scripted/mahout_data/temp/ -x 20 -cd 0.05\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"22378","summary":"CVB hangs after completion","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seth","name":"seth","emailAddress":"seth at scripted dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"seth boyles","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=seth","name":"seth","emailAddress":"seth at scripted dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"seth boyles","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"Ubuntu","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":18,"total":18,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13419289","id":"13419289","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hazen","name":"hazen","emailAddress":"andrew dot schlaikjer at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Schlaikjer","active":true},"body":"Hey Seth, Thanks for the report. This is somewhat expected behavior, though it is definitely a bug-- There is a thread pool within the CVB implementation whose threads are not daemon threads and aren't halted cleanly at the end of a run, causing the jvm to hang after the main thread has terminated.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hazen","name":"hazen","emailAddress":"andrew dot schlaikjer at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andy Schlaikjer","active":true},"created":"2012-07-20T16:04:45.724+0000","updated":"2012-07-20T16:04:45.724+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13624758","id":"13624758","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kanjilal","name":"kanjilal","emailAddress":"sxk1969 at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saikat Kanjilal","active":true},"body":"I'd like to help out on this issue and will begin trying to repro and troubleshoot.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kanjilal","name":"kanjilal","emailAddress":"sxk1969 at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saikat Kanjilal","active":true},"created":"2013-04-07T06:58:43.712+0000","updated":"2013-04-12T23:08:17.304+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13631091","id":"13631091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"So this should be in either ModelTrainer or TopicModel - both have thread pools, and I'm not sure which one is causing the hang due to non-daemonization / cleanup.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-04-13T16:51:31.334+0000","updated":"2013-04-13T16:51:31.334+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13633992","id":"13633992","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isabel","name":"isabel","emailAddress":"mainec at isabel-drost dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=isabel&avatarId=16810","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=isabel&avatarId=16810","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=isabel&avatarId=16810","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=isabel&avatarId=16810"},"displayName":"Isabel Drost-Fromm","active":true},"body":"Attached a hack^Wpatch that might help re-produce the issue:\r\n\r\ncom.carrotsearch.randomizedtesting-runner tracks threads spawned during unit tests. I added RandomizedTest as parent class to our Mahout Test class, marked it such to not complain about leaking threads (there are a few test classes that do not join threads), enabled thread leakage tracking only for the TestCVBModelTrainer.\r\n\r\nThe hack about the patch is adding the randomizedtesting-runner dependency to compile instead of to test scope in mahout/math.\r\n\r\nTo use the patch: make sure you have compiled Mahout trunk at least once with \"mvn install\", apply the patch with -p1. Than from the project root build at least mahout/math with \"mvn --projects math install\", after that execute the tweaked test with \"mvn --projects core  -Dtest=TestCVBModelTrainer test\". You should see complaints like the following in the output:\r\n\r\nTests in error: \r\n   » ThreadLeak 32 threads leaked from TEST scope at testInMemoryCVB0(org.apache...\r\n   » ThreadLeak There are still zombie threads that couldn't be terminated:\r\n   1...\r\n   » ThreadLeak 32 threads leaked from SUITE scope at org.apache.mahout.clusteri...\r\n   » ThreadLeak There are still zombie threads that couldn't be terminated:\r\n   1...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isabel","name":"isabel","emailAddress":"mainec at isabel-drost dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=isabel&avatarId=16810","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=isabel&avatarId=16810","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=isabel&avatarId=16810","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=isabel&avatarId=16810"},"displayName":"Isabel Drost-Fromm","active":true},"created":"2013-04-17T12:50:47.676+0000","updated":"2013-04-17T12:50:47.676+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13640425","id":"13640425","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isabel","name":"isabel","emailAddress":"mainec at isabel-drost dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=isabel&avatarId=16810","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=isabel&avatarId=16810","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=isabel&avatarId=16810","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=isabel&avatarId=16810"},"displayName":"Isabel Drost-Fromm","active":true},"body":"Saikat, any luck with re-producing the issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isabel","name":"isabel","emailAddress":"mainec at isabel-drost dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=isabel&avatarId=16810","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=isabel&avatarId=16810","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=isabel&avatarId=16810","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=isabel&avatarId=16810"},"displayName":"Isabel Drost-Fromm","active":true},"created":"2013-04-24T13:17:07.209+0000","updated":"2013-04-24T13:17:07.209+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13640512","id":"13640512","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kanjilal","name":"kanjilal","emailAddress":"sxk1969 at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saikat Kanjilal","active":true},"body":"My apologies, I've been out on vacation, just getting back today,  I tried but cant seem to repro it locally with small dictionary files, will try to use your patch and larger disctionary files.  Also I noticed that in trunk I am running into errors when trying a clean install with maven, the only way to get past this is skipping tests,  have you gotten all tests to run successfully?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kanjilal","name":"kanjilal","emailAddress":"sxk1969 at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saikat Kanjilal","active":true},"created":"2013-04-24T14:52:15.424+0000","updated":"2013-04-24T14:52:15.424+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13640684","id":"13640684","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isabel","name":"isabel","emailAddress":"mainec at isabel-drost dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=isabel&avatarId=16810","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=isabel&avatarId=16810","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=isabel&avatarId=16810","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=isabel&avatarId=16810"},"displayName":"Isabel Drost-Fromm","active":true},"body":"No need for apologies - just wanted to see if anything is blocking you.\r\n\r\nAbout the build - according to the last jenkings build (<https://builds.apache.org/job/Mahout-Quality/>) all should be fine. Which tests are failing for you?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=isabel","name":"isabel","emailAddress":"mainec at isabel-drost dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=isabel&avatarId=16810","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=isabel&avatarId=16810","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=isabel&avatarId=16810","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=isabel&avatarId=16810"},"displayName":"Isabel Drost-Fromm","active":true},"created":"2013-04-24T17:28:27.380+0000","updated":"2013-04-24T17:28:27.380+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13640723","id":"13640723","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amartgon","name":"amartgon","emailAddress":"amartgon at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angel Martinez Gonzalez","active":true},"body":"Hi,\r\nI was trying cvb with the Reuters collection in local mode and it was hanging everytime. I looked into the problem for a while and then I found this bug report.\r\nThe problem was with TopicModel's pool, because it never got shutdown. This patch passes tests and Reuters clustering is not hanging anymore in my machine. Take it with some caution though, because I do not have a complete understanding of the cvb implementation yet.\r\nAlso, I did not mean to change the issue status, I was just trying to upload the patch...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amartgon","name":"amartgon","emailAddress":"amartgon at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angel Martinez Gonzalez","active":true},"created":"2013-04-24T17:55:56.587+0000","updated":"2013-04-24T17:55:56.587+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13640753","id":"13640753","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kanjilal","name":"kanjilal","emailAddress":"sxk1969 at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saikat Kanjilal","active":true},"body":"Never mind, build is working again for me in trunk.   Angel I will apply your patch and retry locally , Isabel is it possible to test Angel's patch outside of a local environment on a hadoop cluster before it gets to Jenkins?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kanjilal","name":"kanjilal","emailAddress":"sxk1969 at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saikat Kanjilal","active":true},"created":"2013-04-24T18:25:48.683+0000","updated":"2013-04-24T18:25:48.683+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13640832","id":"13640832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"So in general, I think this is the right approach, but looking in a little bit reminds me that in mapreduce mode (as in the original bug report status output at the top), \r\n[code]\r\npublic void train(VectorIterable matrix, VectorIterable docTopicCounts) {\r\n[code]\r\nisn't used.  Instead, if you look in \r\n\r\nhttps://github.com/apache/mahout/blob/trunk/core/src/main/java/org/apache/mahout/clustering/lda/cvb/CachingCVB0Mapper.java\r\n\r\nyou see that the ModelTrainer is instantiated and start()'ed in mapper setup, then train() is called per document, then modelTrainer.stop() is called in cleanup.  So just like in this patch, where you call writeModel.stop(); this is probably necessary in the mapper too, or maybe a better place is inside of ModelTrainer.stop() - just make sure we delegate down the calls to stop() on the read/write models when the trainer is stopped too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-04-24T19:37:12.531+0000","updated":"2013-04-24T19:37:12.531+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13641084","id":"13641084","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amartgon","name":"amartgon","emailAddress":"amartgon at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angel Martinez Gonzalez","active":true},"body":"Maybe I am missing something, but TopicModel.stop() is called inside ModelTrainer.stop(), just as you say.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amartgon","name":"amartgon","emailAddress":"amartgon at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angel Martinez Gonzalez","active":true},"created":"2013-04-24T22:33:39.063+0000","updated":"2013-04-24T22:33:39.063+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13641097","id":"13641097","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"Ah yes.  So the critical new lines are:\r\n\r\n[code]\r\n+++ core/src/main/java/org/apache/mahout/clustering/lda/cvb/TopicModel.java\r\n\r\n+  public void stop() {\r\n     for (Updater updater : updaters) {\r\n       updater.shutdown();\r\n     }\r\n+    threadPool.shutdown();\r\n+    try {\r\n+      if (!threadPool.awaitTermination(60, TimeUnit.SECONDS)) {\r\n+        log.warn(\"Threadpool timed out on await termination - jobs still running!\");\r\n+      }\r\n+    } catch (InterruptedException e) {\r\n+        log.error(\"Interrupted shutting down!\", e);\r\n+    }\r\n   }\r\n[code]\r\n\r\nright?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-04-24T22:40:08.473+0000","updated":"2013-04-24T22:40:08.473+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13641118","id":"13641118","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amartgon","name":"amartgon","emailAddress":"amartgon at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angel Martinez Gonzalez","active":true},"body":"Yes, and then this new stop method is called for the readModel and the writeModel inside ModelTrainer.stop().\r\nThe readModel is reused as writeModel in the next iteration, and TopicModel.reset() is necessary for that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amartgon","name":"amartgon","emailAddress":"amartgon at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angel Martinez Gonzalez","active":true},"created":"2013-04-24T22:59:36.948+0000","updated":"2013-04-24T22:59:36.948+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13641140","id":"13641140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"Well, the iterations are only when ModelTrainer#train(VectorIterable) is used, which is never in hadoop-mode, but yes, for InMemoryCollapsedVariationalBayes0, that would be useful.  Actually, is that method even used there.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-04-24T23:14:23.938+0000","updated":"2013-04-24T23:14:23.938+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13641153","id":"13641153","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amartgon","name":"amartgon","emailAddress":"amartgon at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angel Martinez Gonzalez","active":true},"body":"I added writeModel.reset() inside ModelTrainer.start(). This is unnecessary in hadoop-mode, but I think it does no harm. It is needed for InMemoryCollapsedVariationalBayes0.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=amartgon","name":"amartgon","emailAddress":"amartgon at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Angel Martinez Gonzalez","active":true},"created":"2013-04-24T23:26:02.602+0000","updated":"2013-04-24T23:49:44.370+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13641450","id":"13641450","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kanjilal","name":"kanjilal","emailAddress":"sxk1969 at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saikat Kanjilal","active":true},"body":"I tested the initial patch implementation locally and tests work fine, however am wondering whether or not local testing by itself is sufficient for submitting this, let me know if I can help debug further or run more tests with a new patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kanjilal","name":"kanjilal","emailAddress":"sxk1969 at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Saikat Kanjilal","active":true},"created":"2013-04-25T05:42:02.242+0000","updated":"2013-04-25T05:42:02.242+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13672186","id":"13672186","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smarthi","name":"smarthi","emailAddress":"smarthi at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suneel Marthi","active":true},"body":"Tested this patch and committing to trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smarthi","name":"smarthi","emailAddress":"smarthi at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suneel Marthi","active":true},"created":"2013-06-01T18:04:08.520+0000","updated":"2013-06-01T18:04:08.520+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12599556/comment/13672261","id":"13672261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #2026 (See [https://builds.apache.org/job/Mahout-Quality/2026/])\r\n    MAHOUT-1047: CVB hangs after completion (Revision 1488552)\r\n\r\n     Result = SUCCESS\r\nsmarthi : \r\nFiles : \r\n* /mahout/trunk/CHANGELOG\r\n* /mahout/trunk/core/src/main/java/org/apache/mahout/clustering/lda/cvb/ModelTrainer.java\r\n* /mahout/trunk/core/src/main/java/org/apache/mahout/clustering/lda/cvb/TopicModel.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2013-06-01T21:53:37.982+0000","updated":"2013-06-01T21:53:37.982+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-1047/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i046vb:"}}