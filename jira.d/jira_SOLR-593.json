{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12397661","self":"https://issues.apache.org/jira/rest/api/latest/issue/12397661","key":"SOLR-593","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312486","id":"12312486","description":"","name":"1.3","archived":false,"released":true,"releaseDate":"2008-09-16"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2008-07-14 00:57:41.497","customfield_12312323":null,"customfield_12310420":"7015","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_3902514861_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2008-07-21T14:02:06.861+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-593/watchers","watchCount":1,"isWatching":false},"created":"2008-06-06T10:00:12.341+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312486","id":"12312486","description":"","name":"1.3","archived":false,"released":true,"releaseDate":"2008-09-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:40:14.319+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310674","id":"12310674","name":"search","description":"Query the search collection"}],"timeoriginalestimate":null,"description":"The thread dump is:\n\n\"main\" prio=6 tid=0x003f81d8 nid=0x10e4 in Object.wait() [0x0006f000..0x0006fc20]\n        at java.lang.Object.wait(Native Method)\n        - waiting on <0x23dd0188> (a java.lang.Object)\n        at java.lang.Object.wait(Object.java:474)\n        at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:685)\n        - locked <0x23dd0188> (a java.lang.Object)\n        at org.apache.solr.core.SolrCore.getSearcher(SolrCore.java:624)\n        at org.apache.solr.handler.component.QueryElevationComponent.inform(QueryElevationComponent.java:185)\n        - locked <0x23e51ee0> (a java.util.WeakHashMap)\n        at org.apache.solr.core.SolrResourceLoader.inform(SolrResourceLoader.java:264)\n        at org.apache.solr.core.SolrCore.<init>(SolrCore.java:396)\n        - locked <0x27b44b60> (a java.lang.Class)\n        at org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:90)\n        at org.mortbay.jetty.servlet.FilterHolder.doStart(FilterHolder.java:99)\n        at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:40)\n        at org.mortbay.jetty.servlet.ServletHandler.initialize(ServletHandler.java:594)\n        at org.mortbay.jetty.servlet.Context.startContext(Context.java:139)\n        at org.mortbay.jetty.webapp.WebAppContext.startContext(WebAppContext.java:1218)\n        at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:500)\n        at org.mortbay.jetty.webapp.WebAppContext.doStart(WebAppContext.java:448)\n        at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:40)\n        at org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:147)\n        at org.mortbay.jetty.handler.ContextHandlerCollection.doStart(ContextHandlerCollection.java:161)\n        at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:40)\n        at org.mortbay.jetty.handler.HandlerCollection.doStart(HandlerCollection.java:147)\n        at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:40)\n        at org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:117)\n        at org.mortbay.jetty.Server.doStart(Server.java:210)\n        at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:40)\n        at org.mortbay.xml.XmlConfiguration.main(XmlConfiguration.java:929)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:585)\n        at org.mortbay.start.Main.invokeMain(Main.java:183)\n        at org.mortbay.start.Main.start(Main.java:497)\n        at org.mortbay.start.Main.main(Main.java:115)\n\nThe cause is that accessing reader during SolrCoreAware.inform(). Shalin pointed out same thing at:\n\nhttp://www.nabble.com/Accessing-IndexReader-during-core-initialization-hangs-init-td17259235.html#a17259235\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"20595","summary":"Solr hangs at QueryElevationComponent.inform() if elevate.xml is in data directory","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12397661/comment/12613218","id":"12613218","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"body":"bugs in code new since 1.2 should be fixed before 1.3","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hossman","name":"hossman","emailAddress":"hossman_apachejira at fucit dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hossman&avatarId=21247","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hossman&avatarId=21247","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hossman&avatarId=21247","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hossman&avatarId=21247"},"displayName":"Hoss Man","active":true},"created":"2008-07-14T00:57:41.497+0000","updated":"2008-07-14T00:57:41.497+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12397661/comment/12613728","id":"12613728","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Solr has a deadlock when useColdSearcher=false and a plugin calls getSearcher() from inform():\r\n\r\nThe SolrCore constructor prevents warming queries from firing before inform() has been called on plugins.  But if useColdSearcher=false, then those warming queries will need to be completed before the searcher is registered.  If a plugin calls getSearcher() from inform() it will block waiting for the searcher to be registered (which is dependent on completing the inform() calls): deadlock.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-07-15T20:51:58.357+0000","updated":"2008-07-15T20:51:58.357+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12397661/comment/12613731","id":"12613731","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"The simplest solution might be to deprecate/remove useColdSearcher=false","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-07-15T20:58:09.502+0000","updated":"2008-07-15T20:58:09.502+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12397661/comment/12615082","id":"12615082","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"body":"Can we introduce getColdSearcher() method so that SolrCoreAware components can call it to get searcher, instead of getSearcher(), to avoid this deadlock? getColdSearcher() always returns a cold searcher regardless of useColdSearcher setting...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=koji","name":"koji","emailAddress":"koji dot sekiguchi at rondhuit dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=koji&avatarId=17548","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=koji&avatarId=17548","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=koji&avatarId=17548","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=koji&avatarId=17548"},"displayName":"Koji Sekiguchi","active":true},"created":"2008-07-20T11:17:55.254+0000","updated":"2008-07-20T11:17:55.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12397661/comment/12615102","id":"12615102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"bq. Can we introduce getColdSearcher() method so that SolrCoreAware components can call it to get searcher\r\n\r\nThat could work.\r\n\r\nWe could also try to do something more generic like getNewestSearcher() that could be called in any context.  That could also be used internally to use the new lucene reopen() for better efficiency.  But the implementation would be a little tricky.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-07-20T15:39:11.913+0000","updated":"2008-07-20T15:39:11.913+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12397661/comment/12615108","id":"12615108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"This patch implements a getNewestSearcher() method, and keeps a list of searchers that are currently open.\r\n\r\nKeeping a list like this opens a race condition in that someone could aquire a reference from the list just as close is being called.  To protect against this, the list is only accessed when searcherLock is held, and the close() of RefCounted<SolrIndexSearcher> aquires searcherLock and checks the referece count again.  If it's greater than 0, it aborts the close.\r\n\r\nHaving the list will also be useful for using Lucene's new reopen, as well as other future admin actions.\r\n\r\nAll tests pass, but I'm going to do some ad-hoc testing to make sure this hasn't introduced any new issues.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-07-20T17:38:02.410+0000","updated":"2008-07-20T17:38:02.410+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12397661/comment/12615248","id":"12615248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"committed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2008-07-21T14:02:06.837+0000","updated":"2008-07-21T14:02:06.837+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-593/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03vv3:"}}