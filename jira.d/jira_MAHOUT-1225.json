{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12648680","self":"https://issues.apache.org/jira/rest/api/latest/issue/12648680","key":"MAHOUT-1225","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310751","id":"12310751","key":"MAHOUT","name":"Mahout","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310751&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310751&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310751&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310751&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/13060","id":"13060","description":"Apache Mahout","name":"Mahout"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319261","id":"12319261","description":"Primarily a cleanup and refactoring release. Some new functionality which has been previously completed and tested may be introduced.","name":"0.7","archived":false,"released":true,"releaseDate":"2012-05-15"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-05-21 20:44:53.661","customfield_12312323":null,"customfield_12310420":"329035","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_963726982_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-06-01T21:28:59.353+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-1225/watchers","watchCount":8,"isWatching":false},"created":"2013-05-21T17:46:52.388+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["hashset","java","mahout","test"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":172800,"aggregatetimeoriginalestimate":172800,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319261","id":"12319261","description":"Primarily a cleanup and refactoring release. Some new functionality which has been previously completed and tested may be introduced.","name":"0.7","archived":false,"released":true,"releaseDate":"2012-05-15"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-06-03T13:21:09.768+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312270","id":"12312270","name":"Math","description":"Math / Matrix / Vector stuff"}],"timeoriginalestimate":172800,"description":"The code I attached hangs on forever, Eclipse does not print me its stack trace because it does not terminate the program. So I decided to make a small test.java file that you can easily run.\r\n\r\nThis code has the main function that simply runs getItemList() method which successfully executes getDataset() method (here please download mushroom.dat dataset and set the full path into filePath string variable) and the hangs on (the problem happens on a fourth columnValues.add() call). After the dataset was taken into X array, the code simply goes through X column by column and searches for different items in it.\r\n\r\nIf you uncomment IntSet columnValues = new IntOpenHashSet(); and corresponding import headers then everything will work just fine (you will also need to include hppc jar file found here http://labs.carrotsearch.com/hppc.html or below in the attachment).","customfield_10010":null,"timetracking":{"originalEstimate":"48h","remainingEstimate":"48h","originalEstimateSeconds":172800,"remainingEstimateSeconds":172800},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":172800,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"329377","summary":"Sets and maps incorrectly clear() their state arrays (potential endless loops)","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":172800,"percent":0},"customfield_12311024":null,"environment":"Eclipse, linux Fedora 17, Java 1.7, Mahout Maths collections (Set) 0.7, hppc 0.4.3","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":172800,"percent":0},"comment":{"startAt":0,"maxResults":34,"total":34,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13663176","id":"13663176","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"body":"test.java - runnable selfcontained code\r\nmushroom.dat - dataset\r\nhppc-0.4.3.jar - external lib","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"created":"2013-05-21T17:48:28.832+0000","updated":"2013-05-21T17:48:28.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13663384","id":"13663384","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"This is a legitimate bug in clear():\r\n{code}\r\n  public void clear() {\r\n    Arrays.fill(this.state, 0, state.length - 1, FREE);\r\n{code}\r\n\r\nThe \"to\" argument is wrong, it is an exclusive range so it should be state.length. Since the last element of the state array is not cleared it is subsequently filled entirely and indexOfKey hangs on the lookup loop (because all slots are \"taken\").\r\n\r\nSimpler problem reproduction code:\r\n{code}\r\n AbstractIntSet s = new OpenIntHashSet();\r\n            s.clear();\r\n            s.add(23);\r\n            s.add(46);\r\n            s.clear();\r\n            s.add(70);\r\n            s.add(93);\r\n            s.contains(100);\r\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-21T20:44:53.661+0000","updated":"2013-05-21T20:44:53.661+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13663390","id":"13663390","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"body":"Thank you Dawid for your easier example. That's the reason I'm using your library in this case :) Let's see how mahout will work for big data (currently setting up amazon machine). All the supercool programmers say so many good words about mahout which has so obvious bug in hashset. What a crap :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"created":"2013-05-21T20:53:12.690+0000","updated":"2013-05-21T20:53:12.690+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13663401","id":"13663401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"I wouldn't be impolite to people who are trying to help you, Sophie. Software bugs are omnipresent and are not necessarily a result of one's negligence -- very often it's a process of multiple rewrites by many people. In this particular case collections have been ported over from Colt and multiple changes layered.\r\n\r\nJudging from the test code you submitted on this issue I am pretty confident that the choice of collections library is secondary -- your problem is in algorithmic solutions to whatever it is you're trying to achieve.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-21T21:07:06.904+0000","updated":"2013-05-21T21:07:06.904+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13663844","id":"13663844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"I looked quickly at the templates and this pattern is in a few places, actually. It's a trivial patch but I'd say a unit test doing some random blasting of intermixed operations against another implementation (be it Java collections, HPPC, fastutil or whatever else) would be very sensible.\r\n\r\nIf nobody picks it up in the next few hours, I will.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-22T06:27:41.267+0000","updated":"2013-05-22T06:27:41.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13664613","id":"13664613","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmarthal","name":"tmarthal","emailAddress":"marthaler at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Marthaler","active":true},"body":"I looked at it. In the OpenIntHashSet.indexOfKey(int) method, the while loop never completes because the i variable is being decremented as well as incremented (line 226).\r\n\r\nThe fix is to move the\r\n      if (i < 0) {\r\n        i += length;\r\n      }\r\ncode out of the loop.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tmarthal","name":"tmarthal","emailAddress":"marthaler at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tom Marthaler","active":true},"created":"2013-05-22T22:22:01.172+0000","updated":"2013-05-22T22:22:01.172+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13664918","id":"13664918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"No, this is not the right fix, Tom. That loop is correct as open addressing allows a \"wrap around\" in the array and this \"if\" clause does exactly that. The problem is the invariant of indexOf (and other methods in open addressing) is that there is at least one empty slot, which is not the case due to the bug I mentioned.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T06:24:22.978+0000","updated":"2013-05-23T06:24:22.978+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13664970","id":"13664970","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Initial patch that shows how much needs to be done in terms of fixing stuff :)\r\n\r\nI fixed the problem with clear() on the template for OpenIntHashSet but there are several other classes that show non-uniform behavior against Java Util Collections (and they're very likely bugs).\r\n\r\nI'll try to fix these during the day today, time permitting. Stay tuned.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T08:08:32.851+0000","updated":"2013-05-23T08:08:32.851+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665105","id":"13665105","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Final patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T12:24:42.946+0000","updated":"2013-05-23T12:24:42.946+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665109","id":"13665109","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"There are a bunch of issues, actually. In no particular order randomized testing against JUC allowed me to spot the following:\r\n\r\n1. Inconsistent clearing of buffers.\r\n\r\n{code}\r\n-    Arrays.fill(this.state, 0, state.length - 1, FREE);\r\n+    Arrays.fill(this.state, FREE); \r\n{code}\r\n\r\nthis eventually leads to endless loops because invariants are no longer respected. \r\n\r\n2. Unreleased references.\r\n\r\n{code}\r\n-    Arrays.fill(this.state, 0, state.length - 1, FREE);\r\n+    Arrays.fill(this.state, FREE);\r\n+    Arrays.fill(this.table, FREE); \r\n{code}\r\n\r\nSome of the generic collections do not clear buffers properly, never allowing the objects stored inside those buffers to be GCed (unless the following trimToSize() does it, but I don't think it always does).\r\n\r\n3. Inconsistent reference/equals comparisons.\r\n\r\n{code}\r\n-      while (stat[i] != FREE && (stat[i] == REMOVED || tab[i] != key)) {\r\n+      while (stat[i] != FREE && (stat[i] == REMOVED || !key.equals(tab[i]))) { \r\n{code}\r\n\r\nNote that the current code always assumes non-null keys which is not mentioned anywhere. I assumed non-null keys.\r\n\r\n4. Inconsistent return value from add.\r\n\r\n{code}\r\n       int newCapacity = chooseGrowCapacity(this.distinct + 1, this.minLoadFactor, this.maxLoadFactor);\r\n       rehash(newCapacity);\r\n-      return add(key);\r\n+      // we've already added the element so we don't need to add it again.\r\n+      return true; \r\n{code}\r\n\r\nThis is odd, don't even know why this block is there. But the result is inconsistent because the rehashing takes place after the key has been added so a subsequent add() returns an invalid value.\r\n\r\nI did *not* go through the code thoroughly, this is a result of a quick test against JUC. I bet there are other issues in there that may be lurking in the (untested) shadows. While I appreciate the effort put into this code I still think it'd be wiser for Mahout to move on to fastutil, trove or something similar that has a better test coverage.\r\n\r\nI've tried to commit this in but my commit rights have been revoked apparently (perhaps this happens when you're on an emeritus status :).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T12:25:44.556+0000","updated":"2013-05-23T12:31:48.028+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665174","id":"13665174","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"Wait, was this not _exactly_ the bug in https://issues.apache.org/jira/browse/MAHOUT-1186 ?\r\n\r\nHow did this creep back in?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-05-23T13:38:18.831+0000","updated":"2013-05-23T13:38:18.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665180","id":"13665180","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Hi Jake. No idea, really. I just checked out http://svn.apache.org/repos/asf/mahout/collections/trunk and followed from there. I am subscribed to the list but I'm not following much of Mahout's development nowadays.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T13:49:06.351+0000","updated":"2013-05-23T13:49:06.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665184","id":"13665184","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Darn... I think I've been working on an obsolete branch? :) Is this the current one?\r\n\r\nhttp://svn.apache.org/repos/asf/mahout/trunk/math/src/main/java-templates/org/apache/mahout/math/\r\n\r\nI think the old one should be removed or moved under an attic somewhere...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T13:53:03.880+0000","updated":"2013-05-23T13:53:03.880+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665185","id":"13665185","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Yeah... good to know where the current development takes place. I'll reapply this to the current code and will be back if any of these issues still apply.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T13:56:10.368+0000","updated":"2013-05-23T13:56:10.368+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665188","id":"13665188","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"Ah yes, we merged collections back into math a while back.  I'd love to have your test cases added in, more coverage == better!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-05-23T13:59:02.521+0000","updated":"2013-05-23T13:59:02.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665213","id":"13665213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Apologies for the noise -- I've been working on the wrong SVN path.\r\n\r\nThe good news is that most of the issues have been solved on the current master (including Sophie's so I wonder which version she worked with...). \r\n\r\nI attach a patch that adds randomized tests against JUC since these are really effective at catching bugs so in case of refactorings it may be handy. There is also one piggybacked change that clears the table of references on clear() -- test attached (and failing previously).\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T14:17:44.351+0000","updated":"2013-05-23T14:17:44.351+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665248","id":"13665248","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"body":"Dear, I go to http://repo1.maven.org/maven2/org/apache/mahout/mahout-math/0.7/ and download mahout-math-0.7.jar . Does it contain lots of bugs? What is the newest version? If you point me to github then I do not know how to make a jar file out of source. Could you please tell how to get most recent and stable code? I apologise if said bad words about old version.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"created":"2013-05-23T15:05:04.802+0000","updated":"2013-05-23T15:05:04.802+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665250","id":"13665250","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"body":"Would not it be a good idea to release 0.8 version with the most current code especially since almost a year has passed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"created":"2013-05-23T15:06:58.180+0000","updated":"2013-05-23T15:06:58.180+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665275","id":"13665275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","emailAddress":"ted dot dunning at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true},"body":"{quote}\r\nWould not it be a good idea to release 0.8 version with the most current code\r\n{quote}\r\n\r\nYes.  In fact, we are already in the process of stabilizing for a release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdunning","name":"tdunning","emailAddress":"ted dot dunning at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ted Dunning","active":true},"created":"2013-05-23T15:39:39.623+0000","updated":"2013-05-23T15:39:39.623+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665276","id":"13665276","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"body":"I tried to follow http://stackoverflow.com/questions/16717858/how-to-make-jar-out-of-github-sources\r\nbut I get lots of errors and no jar file. Is it possible to make a jar file?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"created":"2013-05-23T15:40:01.396+0000","updated":"2013-05-23T15:40:01.396+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665335","id":"13665335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"To build from trunk (which is what we all do, for the most part), see the wiki, here: https://cwiki.apache.org/confluence/display/MAHOUT/BuildingMahout","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-05-23T16:40:08.663+0000","updated":"2013-05-23T16:40:08.663+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665351","id":"13665351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smarthi","name":"smarthi","emailAddress":"smarthi at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suneel Marthi","active":true},"body":"Sophie, attached is mahout-math.jar from trunk.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=smarthi","name":"smarthi","emailAddress":"smarthi at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suneel Marthi","active":true},"created":"2013-05-23T16:55:30.773+0000","updated":"2013-05-23T16:55:50.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665358","id":"13665358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"body":"Thank you Suneel! What I think is important for a new 0.8 release: make it up to date with java 1.7 version and fix as more bugs as possible.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=sophiesperner","name":"sophiesperner","emailAddress":"sophie dot sperner at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sophie Sperner","active":true},"created":"2013-05-23T17:04:42.655+0000","updated":"2013-05-23T17:04:42.655+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665361","id":"13665361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"I'm not sure everyone's hadoop cluster is on 1.7 (I know ours here at Twitter isn't), so moving to 1.7 seems a little early.\r\n\r\nFixing bugs sounds like a good idea. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-05-23T17:10:05.225+0000","updated":"2013-05-23T17:10:05.225+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13665367","id":"13665367","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Could somebody with permissions remove that dead branch of collections from SVN? Alternatively I'd at least remove the contents of the trunk and place a simple README file redirecting to the new location of current development branch.\r\n\r\nNot that it wasn't a lot of fun debugging but we can save somebody else from the mistake I made. :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-05-23T17:13:26.709+0000","updated":"2013-05-23T17:13:26.709+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13672243","id":"13672243","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robinanil","name":"robinanil","emailAddress":"robinanil at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=robinanil&avatarId=14747","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=robinanil&avatarId=14747","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=robinanil&avatarId=14747","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=robinanil&avatarId=14747"},"displayName":"Robin Anil","active":true},"body":"I am going to submit this for Dawid to close this. Excellent catch and even better testing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robinanil","name":"robinanil","emailAddress":"robinanil at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=robinanil&avatarId=14747","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=robinanil&avatarId=14747","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=robinanil&avatarId=14747","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=robinanil&avatarId=14747"},"displayName":"Robin Anil","active":true},"created":"2013-06-01T21:22:50.947+0000","updated":"2013-06-01T21:22:50.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13672258","id":"13672258","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"body":"Integrated in Mahout-Quality #2026 (See [https://builds.apache.org/job/Mahout-Quality/2026/])\r\n    MAHOUT-1225 Nasty bug in Mahout collections. Sets and maps incorrectly clear() their state arrays (potential endless loops) - author: dweiss (Revision 1488607)\r\n\r\n     Result = SUCCESS\r\nrobinanil : \r\nFiles : \r\n* /mahout/trunk/math/pom.xml\r\n* /mahout/trunk/math/src/main/java-templates/org/apache/mahout/math/map/OpenObjectValueTypeHashMap.java.t\r\n* /mahout/trunk/math/src/test/java/org/apache/mahout/math/randomized\r\n* /mahout/trunk/math/src/test/java/org/apache/mahout/math/randomized/RandomBlasting.java\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","emailAddress":"jira at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true},"created":"2013-06-01T21:53:37.355+0000","updated":"2013-06-01T21:53:37.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13672318","id":"13672318","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"body":"What exactly did you end up submitting Robin?  I thought we had determined that this was fixed already?  You just added the new randomized testing that Dawid added?  OpenObjectValueTypeHashMap still had the issue?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jake.mannix","name":"jake.mannix","emailAddress":"jake dot mannix at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jake Mannix","active":true},"created":"2013-06-02T05:09:01.942+0000","updated":"2013-06-02T05:09:01.942+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13672695","id":"13672695","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Thanks Robin!\r\n\r\nJake - there was still a small issue with clearing references -- a potential memory leak, although in practice probably not encountered. See the test case that was previously failing and you'll see a potential buggy scenario.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-06-02T21:59:49.640+0000","updated":"2013-06-02T21:59:49.640+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13672852","id":"13672852","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Ehm. I've closed this issue as per Robin's comment above but I don't think this was the right way to go -- this should have been left open (with a fixed resolution) until a release is made. Apologies for the noise. I can't reopen it now -- probably missing some Jira's karma to do this. Please correct my mistake if you have admin rights, reopen and then bulk close at release time. Thanks!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-06-03T06:20:50.795+0000","updated":"2013-06-03T06:20:50.795+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13672909","id":"13672909","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robinanil","name":"robinanil","emailAddress":"robinanil at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=robinanil&avatarId=14747","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=robinanil&avatarId=14747","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=robinanil&avatarId=14747","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=robinanil&avatarId=14747"},"displayName":"Robin Anil","active":true},"body":"Could you elaborate on the buggy scenario. I dont see an option to reopen myself.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robinanil","name":"robinanil","emailAddress":"robinanil at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=robinanil&avatarId=14747","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=robinanil&avatarId=14747","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=robinanil&avatarId=14747","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=robinanil&avatarId=14747"},"displayName":"Robin Anil","active":true},"created":"2013-06-03T08:48:39.413+0000","updated":"2013-06-03T08:48:39.413+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13673031","id":"13673031","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Take a look at this test:\r\n{code}\r\n    @Test\r\n    public void testClearTable() throws Exception {\r\n        OpenObjectIntHashMap<Integer> m = new OpenObjectIntHashMap<Integer>();\r\n        m.clear(); // rehash from the default capacity to the next prime after 1 (3).\r\n        m.put(1, 2);\r\n        m.clear(); // Should clear internal references.\r\n        \r\n        Field tableField = m.getClass().getDeclaredField(\"table\");\r\n        tableField.setAccessible(true);\r\n        Object[] table = (Object[]) tableField.get(m);\r\n        \r\n        assertEquals(\r\n            new HashSet<Object>(Arrays.asList(new Object [] { null } )),\r\n            new HashSet<Object>(Arrays.asList(table)));\r\n    }\r\n{code}\r\n\r\nThis fails because clear() does not explicitly erase the table of references. It does call rehash but not always (not if there's no need) in which case the references stay hard-linked. The fix is to:\r\n\r\n{code}\r\n   public void clear() {\r\n     Arrays.fill(this.state, FREE);\r\n+    Arrays.fill(this.table, null);\r\n+\r\n     distinct = 0;\r\n     freeEntries = table.length; // delta\r\n     trimToSize();\r\n{code}\r\n\r\nYou could avoid this by returning a boolean from trimToSize() and checking whether internal buffers have been reallocated (and thus references freed).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-06-03T11:35:48.139+0000","updated":"2013-06-03T11:35:48.139+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13673072","id":"13673072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robinanil","name":"robinanil","emailAddress":"robinanil at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=robinanil&avatarId=14747","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=robinanil&avatarId=14747","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=robinanil&avatarId=14747","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=robinanil&avatarId=14747"},"displayName":"Robin Anil","active":true},"body":"Yes I saw that, thats why I committed your patch. I thought there was something else \r\n\r\nhttp://svn.apache.org/viewvc/mahout/trunk/math/src/main/java-templates/org/apache/mahout/math/map/OpenObjectValueTypeHashMap.java.t?r1=1488607&r2=1488606&pathrev=1488607","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=robinanil","name":"robinanil","emailAddress":"robinanil at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=robinanil&avatarId=14747","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=robinanil&avatarId=14747","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=robinanil&avatarId=14747","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=robinanil&avatarId=14747"},"displayName":"Robin Anil","active":true},"created":"2013-06-03T12:37:08.240+0000","updated":"2013-06-03T12:37:08.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12648680/comment/13673096","id":"13673096","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"body":"Nope, only that. It's fun to see how everything else goes bust when you run those tests on that dead collections branch though.\r\nI'll run those microbenchmarks when I get a spare minute.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dweiss","name":"dweiss","emailAddress":"dawid dot weiss at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Dawid Weiss","active":true},"created":"2013-06-03T13:21:09.768+0000","updated":"2013-06-03T13:21:09.768+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/MAHOUT-1225/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1krpb:"}}