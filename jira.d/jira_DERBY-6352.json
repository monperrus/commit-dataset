{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12670476","self":"https://issues.apache.org/jira/rest/api/latest/issue/12670476","key":"DERBY-6352","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12326753","id":"12326753","description":"head of 10.10 branch","name":"10.10.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12324243","id":"12324243","description":"First release on the 10.11 branch","name":"10.11.1.1","archived":false,"released":true,"releaseDate":"2014-08-26"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2013-10-07 23:08:55.21","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"350305","customfield_12310222":"1_*:*_1_*:*_1730316604_*|*_5_*:*_2_*:*_5453232_*|*_4_*:*_1_*:*_17042420245","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2014-04-30T21:05:15.391+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6352/watchers","watchCount":7,"isWatching":false},"created":"2013-09-25T12:55:25.344+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"6.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323562","id":"12323562","description":"Head of 10.9 branch after releasing 10.9.1.0","name":"10.9.2.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321550","id":"12321550","description":"First release on the 10.10 branch","name":"10.10.1.1","archived":false,"released":true,"releaseDate":"2013-04-15"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12387218","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12387218","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12560378","key":"DERBY-5812","self":"https://issues.apache.org/jira/rest/api/2/issue/12560378","fields":{"summary":"test failure in org.apache.derbyTesting.functionTests.tests.multi.StressMultiTestjava.security.AccessControlException: Access denied (java.lang.RuntimePermission modifyThread)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12383684","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12383684","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12538687","key":"DERBY-5571","self":"https://issues.apache.org/jira/rest/api/2/issue/12538687","fields":{"summary":"IndexStatisticsDaemonImpl.schedule  should wrap Thread.setDaemon() in a privilege block","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12383685","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12383685","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12560378","key":"DERBY-5812","self":"https://issues.apache.org/jira/rest/api/2/issue/12560378","fields":{"summary":"test failure in org.apache.derbyTesting.functionTests.tests.multi.StressMultiTestjava.security.AccessControlException: Access denied (java.lang.RuntimePermission modifyThread)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12386032","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12386032","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12633262","key":"DERBY-6084","self":"https://issues.apache.org/jira/rest/api/2/issue/12633262","fields":{"summary":"org.apache.derbyTesting.functionTests.tests.multi.StressMultiTestjava.security.AccessControlException: Access denied (java.lang.RuntimePermission modifyThread) cascades to 38 errors and 674 failures in nightly test run against ibm16","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12383683","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12383683","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12371617","key":"DERBY-2816","self":"https://issues.apache.org/jira/rest/api/2/issue/12371617","fields":{"summary":"'jdbcapi/secureUsers1.sql' failed with \"..... The connection has been terminated.\" on shutdown","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2015-01-21T00:23:07.185+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11413","id":"11413","name":"Test"}],"timeoriginalestimate":null,"description":"I got a report of the following intermittent (6/60) exception in store.RecoveryAfterBackupTest.\r\nException in thread \"main\" java.security.AccessControlException: Access denied (\"java.lang.RuntimePermission\" \"modifyThread\")\r\n\t\t at java.security.AccessController.throwACE(AccessController.java:100)\r\n\t\t at java.security.AccessController.checkPermission(AccessController.java:174)\r\n\t\t at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n\t\t at java.lang.SecurityManager.checkAccess(SecurityManager.java:676)\r\n\t\t at java.lang.Thread.checkAccess(Thread.java:459)\r\n\t\t at java.lang.Thread.interrupt(Thread.java:588)\r\n\t\t at org.apache.derby.iapi.services.context.ContextService$1.run(Unknown Source)\r\n\t\t at java.security.AccessController.doPrivileged(AccessController.java:274)\r\n\t\t at org.apache.derby.iapi.services.context.ContextService.notifyAllActiveThreads(Unknown Source)\r\n\t\t at org.apache.derby.impl.services.monitor.BaseMonitor.shutdown(Unknown Source)\r\n\t\t at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)\r\n\t\t at org.apache.derby.jdbc.Driver20.connect(Unknown Source)\r\n\t\t at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source)\r\n\t\t at java.sql.DriverManager.getConnection(DriverManager.java:571)\r\n\t\t at java.sql.DriverManager.getConnection(DriverManager.java:233)\r\n\t\t at org.apache.derbyTesting.functionTests.util.TestUtil.getConnection(TestUtil.java:836)\r\n\t\t at org.apache.derbyTesting.functionTests.tests.store.RecoveryAfterBackup.main(RecoveryAfterBackup.java:82)\r\n\r\n\r\nmodifyThread is a necessary permission if interrupting a thread other than the current thread but is not in our policy file for derby.jar.\r\n\r\nThe relevant code in ContextService is:\r\n           for (ContextManager cm : allContexts) {\r\n\r\n\t\t\t\tThread active = cm.activeThread;\r\n\r\n\t\t\t\tif (active == me)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tif (active == null)\r\n\t\t\t\t\tcontinue;\r\n\r\n                final Thread fActive = active;\r\n\t\t\t\tif (cm.setInterrupted(c))\r\n                {\r\n                    AccessController.doPrivileged(\r\n                            new PrivilegedAction<Void>() {\r\n                                public Void run()  {\r\n                                    fActive.interrupt();\r\n                                    return null;\r\n                                }\r\n                            });\r\n                }\r\n\t\t\r\nI am not sure why this has never come up before.  Are we expecting in this context that fActive is the current thread?\r\n\r\n ","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10369","value":"Regression Test Failure","id":"10369"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"350598","summary":"Access denied (\"java.lang.RuntimePermission\" \"modifyThread\") highly intermittent, but e.g. in store.RecoveryAfterBackup test","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"IBM java 7 Derby version 10.10.1.2 - (1494414)","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":35,"total":35,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13788682","id":"13788682","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"In DERBY-2564, Knut said this:\r\n\r\n\" Thread.interrupt() calls Thread.checkAccess() which calls\r\nSecurityManager.checkAccess(Thread).\r\n\r\nhttp://java.sun.com/javase/6/docs/api/java/lang/SecurityManager.html#checkAccess(java.lang.Thread) says:\r\n\r\n> If the thread argument is a system thread (belongs to the thread\r\n> group with a null parent) then this method calls checkPermission\r\n> with the RuntimePermission(\"modifyThread\") permission. If the thread\r\n> argument is not a system thread, this method just returns silently.\r\n\r\nMy guess is that none of Derby's threads are system threads, and\r\ntherefore no permissions are needed with a default security manager.\"\r\n\r\nAnd:\r\n\r\n\"That doesn't mean we don't need to wrap the call in a privileged block, though. A SecurityManager implementation is free to override the checkAccess(Thread) method and perform stricter checks.\"\r\n\r\nDoes this mean that it's fine if a SecurityManager implementation *does* need the modifyThread permission? In which case perhaps we should just add the permission?\r\n\r\nAlso, as Kathey said this is an intermittent problem, does anyone have a theory about why we sometimes would need it and sometimes not? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2013-10-07T23:08:55.210+0000","updated":"2013-10-07T23:08:55.210+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13789354","id":"13789354","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"It looks to me like notifyAllActiveThreads() is meant to only be dealing with Derby threads, and the documentation\r\nknut points at seems to indicate that we should not expect an exception on the call.  So I don't think we should\r\nbe recommending/requiring the modifyThread permission.\r\n\r\nSince it is a \"not expected\" condition, I wonder if we should just catch it in insane and maybe ignore it and hope that it is a timing issue\r\nwith shutdown and the thread being is a wierd state.  Maybe in SANE mode add an assert with as much thread info as possible and the\r\nassert will drive a jvm dump on some jvm's and that might help tell what is going on.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2013-10-08T16:29:30.313+0000","updated":"2013-10-08T16:29:30.313+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13789707","id":"13789707","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"This is a patch with the proposed modification for ContextService...\r\n\r\nI will forward this - backported to 10.10 - to the people who *can* reproduce the problem, and see what they say...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2013-10-08T21:08:35.080+0000","updated":"2013-10-08T21:08:35.080+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13789724","id":"13789724","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I don't think the comments match the actions of the patch, I think \r\nwhat the patch is doing:\r\nif sane thow an assert which will cause system to shut down, it will not \"go on\".\r\n\r\nIn the insane case we will just do a javadump, with nothing in derby.log indicating\r\nwhy.:\r\n+                        // if sane, print out a warning.\r\n+                        // if insane, if this is an IBM jvm, force a jvm dump\r\n+                        // so we can analyze.\r\n+                        // either way, go on, and hope things get cleared away\r\n+                        // automatically in due course\r\n+                        if (SanityManager.DEBUG)\r\n+                        {\r\n+                            SanityManager.THROWASSERT(\"unexpectedly needing an\r\nextra permission.\");\r\n+                            ace.printStackTrace();\r\n+                        }\r\n+                        if (JVMInfo.isIBMJVM()) {\r\n+                            JVMInfo.javaDump();\r\n+                        }\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2013-10-08T21:33:06.963+0000","updated":"2013-10-08T21:33:06.963+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13791142","id":"13791142","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching another patch. I changed my mind about swallowing the exception, I think there is a chance of a hang during system shutdown if we hit it. \r\nBut  we could do with more information. So with sane builds, causing an Assert which will dump info about the current threads to the console, and also identify which Thread is hitting the exception.\r\nWith insane, rethrow the exception, and in the case of an IBM jvm, also cause a java dump to be generated which will also contain a list of the current threads.\r\n\r\nPatch ready for review.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2013-10-10T03:18:16.540+0000","updated":"2013-10-10T03:18:16.540+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13793722","id":"13793722","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1531721 from [~myrna] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1531721 ]\r\n\r\nDERBY-6352; Access denied (\"java.lang.RuntimePermission\" \"modifyThread\") in store.RecoveryAfterBackup test\r\n  adding try/catch code to provide more information when this happens","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-10-13T17:34:51.687+0000","updated":"2013-10-13T17:34:51.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13794848","id":"13794848","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1532175 from [~myrna] in branch 'code/branches/10.10'\r\n[ https://svn.apache.org/r1532175 ]\r\n\r\nDERBY-6352; Access denied (\"java.lang.RuntimePermission\" \"modifyThread\") in store.RecoveryAfterBackup test\r\n  Backport printing of additional info from trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-10-15T03:56:08.796+0000","updated":"2013-10-15T03:56:08.796+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13795181","id":"13795181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Marking Not A Problem, to indicate this is (probably) the correct behavior, we should not need this permission on the threads Derby uses.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2013-10-15T13:34:01.934+0000","updated":"2013-10-15T13:34:01.934+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13795263","id":"13795263","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I think that it is a problem though that we are seeing the access denied error in this context. Possibly a java  Problem?  I think the issue should be reopened until we know and then closed invalid once confirmed and as a java  problem.  I think that is how we have handled jvm issues in the past.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2013-10-15T15:01:30.148+0000","updated":"2013-10-15T15:01:30.148+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13795272","id":"13795272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I think so far things point to this being a java issue, but I'm fine with leaving it open. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2013-10-15T15:06:24.891+0000","updated":"2013-10-15T15:06:24.891+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13836645","id":"13836645","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Just to note, that I also saw this in recent test runs against older branches (10.6 and 10.3) with ibm 1.6.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2013-12-02T16:16:00.917+0000","updated":"2013-12-02T16:16:00.917+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13849423","id":"13849423","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Not sure if it is the same failure but the test failed on trunk(revision 1550872) with IBM jdk 1.6 on Windows machine.\r\nhttp://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm16/1550872-derbyall_diff.txt\r\n\r\n*** Start: RecoveryAfterBackup jdk1.6.0 storeall:storerecovery 2013-12-13 19:47:10 ***\r\n4 del\r\n< Database shutdown completed\r\n5 del\r\n< Starting restore with roll-forward recovery..\r\n6 del\r\n< Verifying database ...\r\n7 del\r\n< Count: 256 Sum: 32640\r\n7 add\r\n> JVMDUMP034I User requested Java dump using 'C:\\jartest\\JarResults.2013-12-13\\ibm16_derbyall\\javacore.20131213.194713.4948.0001.txt' through com.ibm.jvm.Dump.JavaDump\r\n> JVMDUMP010I Java dump written to C:\\jartest\\JarResults.2013-12-13\\ibm16_derbyall\\javacore.20131213.194713.4948.0001.txt\r\n> Exception in thread \"main\" java.security.AccessControlException: Access denied (java.lang.RuntimePermission modifyThread)\r\nTest Failed.\r\n*** End:   RecoveryAfterBackup jdk1.6.0 storeall:storerecovery 2013-12-13 19:47:18 ***","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2013-12-16T18:22:53.986+0000","updated":"2013-12-16T18:22:53.986+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13865842","id":"13865842","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"failed recently in 10.9 nightly testing, ibm16, windows.  Is intermitent as it has only failed a single time in this\r\nnightly testing environment in the past 4 months:\r\nhttp://people.apache.org/~myrnavl/derby_test_results/v10_9/windows/testlog/ibm16/1553785-derbyall_diff.txt\r\n********* Diff file derbyall/storeall/storerecovery/RecoveryAfterBackup.diff\r\n*** Start: RecoveryAfterBackup jdk1.6.0 storeall:storerecovery 2013-12-27 21:32:30 ***\r\n4 del\r\n< Database shutdown completed\r\n5 del\r\n< Starting restore with roll-forward recovery..\r\n6 del\r\n< Verifying database ...\r\n7 del\r\n< Count: 256 Sum: 32640\r\n7 add\r\n> Exception in thread \"main\" java.security.AccessControlException: Access denied (java.lang.RuntimePermission modifyThread)\r\nTest Failed.\r\n*** End:   RecoveryAfterBackup jdk1.6.0 storeall:storerecovery 2013-12-27 21:32:34 ***\r\n------------------------------------------------------","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2014-01-08T20:20:29.019+0000","updated":"2014-01-08T20:20:29.019+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13876902","id":"13876902","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Failed 1/17/2014; windows 2008, ibm 1.6, 10.9.2.2 - (1559317)\r\nhttp://people.apache.org/~myrnavl/derby_test_results/v10_9/windows/testlog/ibm16/1559317-derbyall_diff.txt, diff as earlier failures.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-01-20T22:06:26.550+0000","updated":"2014-01-20T22:06:26.550+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13914847","id":"13914847","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"We have seen this 'modifyThread permission' failure before in rare situations, linking those to this issue...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-27T18:36:25.119+0000","updated":"2014-02-27T18:36:25.119+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13914854","id":"13914854","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"The test store/LogDeviceTest.java failed (with ibm16 SR15) in last night's IBM trunk run, generating a javacore dump, and at the top of the tests' derby.log I found this:\r\n\r\nDatabase Class Loader started - derby.database.classpath=''^M\r\nNew exception raised during cleanup Access denied (java.lang.RuntimePermission modifyThread)^M\r\njava.security.AccessControlException: Access denied (java.lang.RuntimePermission modifyThread)^M\r\n        at java.security.AccessController.throwACE(AccessController.java:100)^M\r\n        at java.security.AccessController.checkPermission(AccessController.java:174)^M\r\n        at java.lang.SecurityManager.checkPermission(SecurityManager.java:544)^M\r\n        at java.lang.SecurityManager.checkAccess(SecurityManager.java:671)^M\r\n        at java.lang.Thread.checkAccess(Thread.java:403)^M\r\n        at java.lang.Thread.interrupt(Thread.java:531)^M\r\n        at org.apache.derby.iapi.services.context.ContextService$1.run(Unknown Source)^M\r\n        at org.apache.derby.iapi.services.context.ContextService$1.run(Unknown Source)^M\r\n        at java.security.AccessController.doPrivileged(AccessController.java:273)^M\r\n        at org.apache.derby.iapi.services.context.ContextService.notifyAllActiveThreads(Unknown Source)^M\r\n        at org.apache.derby.impl.db.DatabaseContextImpl.cleanupOnError(Unknown Source)^M\r\n        at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(Unknown Source)^M\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(Unknown Source)^M\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.<init>(Unknown Source)^M\r\n        at org.apache.derby.jdbc.InternalDriver.getNewEmbedConnection(Unknown Source)^M\r\n        at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)^M\r\n        at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)^M\r\n        at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source)^M\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:419)^M\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:367)^M\r\n        at org.apache.derbyTesting.functionTests.util.TestUtil.getConnection(TestUtil.java:802)^M\r\n        at org.apache.derbyTesting.functionTests.tests.store.LogDeviceTest.shutdown(LogDeviceTest.java:159)^M\r\n        at org.apache.derbyTesting.functionTests.tests.store.LogDeviceTest.runTest(LogDeviceTest.java:101)^M\r\n        at org.apache.derbyTesting.functionTests.tests.store.LogDeviceTest.main(LogDeviceTest.java:53)^M\r\nCleanup action completed^M\r\nNew exception raised during cleanup Access denied (java.lang.RuntimePermission modifyThread)^M\r\njava.security.AccessControlException: Access denied (java.lang.RuntimePermission modifyThread)^M\r\n        at java.security.AccessController.throwACE(AccessController.java:100)^M\r\n        at java.security.AccessController.checkPermission(AccessController.java:174)^M\r\n        at java.lang.SecurityManager.checkPermission(SecurityManager.java:544)^M\r\n        at java.lang.SecurityManager.checkAccess(SecurityManager.java:671)^M\r\n        at java.lang.Thread.checkAccess(Thread.java:403)^M\r\n        at java.lang.Thread.interrupt(Thread.java:531)^M\r\n        at org.apache.derby.iapi.services.context.ContextService$1.run(Unknown Source)^M\r\n        at org.apache.derby.iapi.services.context.ContextService$1.run(Unknown Source)^M\r\n        at java.security.AccessController.doPrivileged(AccessController.java:273)^M\r\n        at org.apache.derby.iapi.services.context.ContextService.notifyAllActiveThreads(Unknown Source)^M\r\n        at org.apache.derby.impl.db.DatabaseContextImpl.cleanupOnError(Unknown Source)^M\r\n        at org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(Unknown Source)^M\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(Unknown Source)^M\r\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)^M\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)^M\r\n        at org.apache.derby.impl.jdbc.EmbedConnection.<init>(Unknown Source)^M\r\n        at org.apache.derby.jdbc.InternalDriver.getNewEmbedConnection(Unknown Source)^M\r\n        at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)^M\r\n        at org.apache.derby.jdbc.InternalDriver.connect(Unknown Source)^M\r\n        at org.apache.derby.jdbc.AutoloadedDriver.connect(Unknown Source)^M\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:419)^M\r\n        at java.sql.DriverManager.getConnection(DriverManager.java:367)^M\r\n        at org.apache.derbyTesting.functionTests.util.TestUtil.getConnection(TestUtil.java:802)^M\r\n        at org.apache.derbyTesting.functionTests.tests.store.LogDeviceTest.shutdown(LogDeviceTest.java:159)^M\r\n        at org.apache.derbyTesting.functionTests.tests.store.LogDeviceTest.runTest(LogDeviceTest.java:101)^M\r\n        at org.apache.derbyTesting.functionTests.tests.store.LogDeviceTest.main(LogDeviceTest.java:53)^M\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-27T18:44:23.261+0000","updated":"2014-02-27T18:59:32.579+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13914886","id":"13914886","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"This error is very frustrating, and very elusive.\r\nHow do we or can we make sure no derby threads are system threads?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-27T18:58:09.427+0000","updated":"2014-02-27T18:58:09.427+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13915126","id":"13915126","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Attaching the javacore files from the test failure in store/LogDeviceTest (modified to remove strings like hostname, username, and the like, and then zipped)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-02-27T22:25:34.096+0000","updated":"2014-02-27T22:25:34.096+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13925823","id":"13925823","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Test failed on 10.8.3.3(revision 1575473) with ibm jdk 1.6 on Windows 2008 machine\r\nhttp://people.apache.org/~myrnavl/derby_test_results/v10_8/windows/testlog/ibm16/1575473-derbyall_diff.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2014-03-10T15:55:28.815+0000","updated":"2014-03-10T15:55:28.815+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13930223","id":"13930223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I don't know where the system thread that causes problems in the test comes from, but I am able to reproduce the AccessControlException in my environment by manually starting a system thread and doing some db operations in that thread while another thread shuts down the engine. See the attached patch test-case.diff. The test case consistently fails for me with AccessControlException (insane) or ASSERT FAILURE (sane).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-03-11T11:13:43.596+0000","updated":"2014-03-11T11:13:43.596+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13942494","id":"13942494","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"The test failed on 10.10.1.4 with IBM JDK 1.6 on March 15th on Linux machine\r\nhttp://people.apache.org/~myrnavl/derby_test_results/v10_10/linux/testlog/ibm16/1577960-derbyall_diff.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2014-03-20T23:15:49.883+0000","updated":"2014-03-20T23:16:52.752+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13942510","id":"13942510","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"body":"Another failure with IBM jdk 1.6, this time on trunk 10.11.0.0(revision 1576555)\r\nhttp://people.apache.org/~myrnavl/derby_test_results/main/windows/testlog/ibm16/1576555-derbyall_diff.txt","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mamtas","name":"mamtas","emailAddress":"msatoor at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mamta A. Satoor","active":true},"created":"2014-03-20T23:28:38.010+0000","updated":"2014-03-20T23:28:38.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13959091","id":"13959091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Another instance of hitting this in a test and not seeing it again.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-04-03T19:04:52.761+0000","updated":"2014-04-03T19:04:52.761+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13964470","id":"13964470","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"I have made a debug build and am waiting for the results of multi iteration test runs in an environment where this reproduces more consistently, hopefully that will tell us what thread (name) is identified as needing the modifyThread permission.\r\n\r\nUntil that information is available, I am wondering:\r\n- should we 'support' Derby activity on system threads? \r\n- if not, should we explicitly document this (and where?)\r\n- assuming we find a reasonable explanation for Derby calling interrupt on a system level thread in the RecoveryAfterBackup test (and even more rare occurrenes in other tests), would it be acceptable to, when we get this exception, just check whether we're dealing with a system level thread and if so, swallow the exception, and only other wise throw the exception?\r\nSomething like this (in ContextService.notifyAllActiveThreads):\r\n                final Thread fActive = active;\r\n\t\tif (cm.setInterrupted(c))\r\n                {\r\n                    // DERBY-6352; in some cases a SecurityException is seen\r\n                    // demanding an explicit granting of modifyThread\r\n                    // permission. Just swallow.\r\n                    try {\r\n                        AccessController.doPrivileged(\r\n                                new PrivilegedAction() {\r\n                                    public Object run()  {\r\n                                        fActive.interrupt();\r\n                                        return null;\r\n                                    }\r\n                                });\r\n                    } catch (java.security.AccessControlException ace) {\r\n                        // if we're seeing the need for modifyThread exception, and\r\n                        // this is a system thread, i.e. no parent thread, then forget about sending\r\n                        // an interrupt.\r\n                        if (ace.getPermission().toString().indexOf(\"modifyThread\")>0) \r\n                        {\r\n                            if(fActive.getThreadGroup().getParent() == null)\r\n                                 continue;\r\n                        }\r\n                        else \r\n                            throw ace;\r\n                    }\r\nPerhaps this is a bit odd as we'd never see the 'modifyThread' permission unless it is a system thread?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-04-09T17:57:17.671+0000","updated":"2014-04-09T17:57:17.671+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13973760","id":"13973760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"The debug runs showed that when we hit the problem in the RecoveryAfterBackup test, it's on a 'Finalizer'  thread.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-04-18T03:44:58.303+0000","updated":"2014-04-18T03:44:58.303+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13979845","id":"13979845","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"In this case, Derby is shutting down the database, right? It seems OK to me to just ignore the exception if the interrupt\r\nhappens as part of the shutdown, since that interrupt is actually generated by Derby itself.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2014-04-24T15:36:15.566+0000","updated":"2014-04-24T15:36:15.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13980607","id":"13980607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Thanks for the comment Dag, yes, Derby is shutting down the database.\r\n\r\nI am fiddling with a couple of options, and trying to make sure I don't mess up...\r\nI'm thinking of basically 2 options:\r\n1. leave the code as it is currently (but remove the no longer needed ibm jvm specific javadump and try to minimize the comments) so catch the exception, then ignore it if we find it's a Finalizer thread\r\n  1.b in sane mode, still throw an assert.\r\n2. only call interrupt except if fActive is a system level thread with the word 'Finalizer' in it.\r\n\r\nI am wondering which is best, and experimenting to see which is fastest.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-04-25T01:35:12.395+0000","updated":"2014-04-25T01:35:12.395+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13980805","id":"13980805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Or perhaps we should ignore all SecurityExceptions when calling interrupt() in this method, regardless of which thread it is? I'm thinking this because:\r\n* I'm not sure we can rely on every JVM having the same name for the finalizer thread.\r\n* There could be other system threads doing database work.\r\n* The interrupt in this method looks like an optimization (active threads will stop earlier), and not an essential part of the shutdown, so it's probably not necessary to abort the shutdown if it is not allowed to interrupt the thread.\r\n\r\nI'm still a little curious to know which finalize() method is causing this, since I didn't think the finalizers in the engine were doing work that would require a context stack.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-04-25T08:37:39.920+0000","updated":"2014-04-25T08:37:39.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13981048","id":"13981048","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Thanks Knut, I'll go and implement this then.\r\nThe Java call Stack from the jvm's informational dump suggests the finalizer comes from the EmbedConnection (this is based on a 10.10.1.4 build):\r\n----------------------------\r\n3XMTHREADINFO      \"Finalizer thread\" J9VMThread:0x00000000007A0200, j9thread_t:0x000000000079F1A0, java/lang/Thread:0x00007F7868697F90, state:B, prio=5\r\n3XMJAVALTHREAD            (java/lang/Thread getId:0xB, isDaemon:true)\r\n3XMTHREADINFO1            (native thread ID:0x4553, native priority:0x5, native policy:UNKNOWN)\r\n3XMTHREADINFO2            (native stack address range from:0x00007F7865B10000, to:0x00007F7865B51000, size:0x41000)\r\n3XMTHREADINFO3           Java callstack:\r\n4XESTACKTRACE                at org/apache/derby/iapi/services/context/SystemContext.cleanupOnError(Bytecode PC:76(Compiled Code))\r\n4XESTACKTRACE                at org/apache/derby/iapi/services/context/ContextManager.cleanupOnError(Bytecode PC:271(Compiled Code))\r\n4XESTACKTRACE                at org/apache/derby/impl/jdbc/TransactionResourceImpl.cleanupOnError(Bytecode PC:6(Compiled Code))\r\n4XESTACKTRACE                at org/apache/derby/impl/jdbc/EmbedConnection.close(Bytecode PC:73(Compiled Code))\r\n4XESTACKTRACE                at org/apache/derby/impl/jdbc/EmbedConnection.finalize(Bytecode PC:12(Compiled Code))\r\n4XESTACKTRACE                at java/lang/J9VMInternals.runFinalize(J9VMInternals.java:438(Compiled Code))\r\n-------------------","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-04-25T14:17:34.803+0000","updated":"2014-04-25T14:17:34.803+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13981065","id":"13981065","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks Myrna. The EmbedConnection.close(StandardException) method does some work within a setup/restoreContextStack() block, which explains why it is seen as an active thread.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-04-25T14:40:10.155+0000","updated":"2014-04-25T14:40:10.155+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13981712","id":"13981712","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"Adding a patch which removes all the debugging printouts and asserts and just does nothing when we see an AccessControlException.\r\nThus, if we do not have enough permission to interrupt a thread, we just let it finish on its own.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2014-04-25T22:36:27.600+0000","updated":"2014-04-25T22:36:27.600+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13982833","id":"13982833","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Thanks, Myrna. The patch looks fine to me. +1 to commit.\r\n\r\nNit: The JVMInfo class is no longer used in ContextService, so the import statement can be removed too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2014-04-28T08:31:01.650+0000","updated":"2014-04-28T08:31:01.650+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13983634","id":"13983634","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1590817 from [~myrna] in branch 'code/trunk'\r\n[ https://svn.apache.org/r1590817 ]\r\n\r\nDERBY-6352; Access denied (\"java.lang.RuntimePermission\" \"modifyThread\") highly intermittent, but e.g. in store.RecoveryAfterBackup test\r\n  When we see a AccessControlException during shutdown in the notifyAll call, do nothing, which lets the Thread finish on its own.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-04-28T21:56:08.593+0000","updated":"2014-04-28T21:56:08.593+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/13984720","id":"13984720","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1591077 from [~myrna] in branch 'code/branches/10.10'\r\n[ https://svn.apache.org/r1591077 ]\r\n\r\nDERBY-6352; Access denied (\"java.lang.RuntimePermission\" \"modifyThread\") highly intermittent, but e.g. in store.RecoveryAfterBackup test\r\n   backport of revision 1590817 from trunk; accepting that if we see an AccessControlException in this spot in the code we let the thread finish on its own.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2014-04-29T20:04:20.395+0000","updated":"2014-04-29T20:04:20.395+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12670476/comment/14284748","id":"14284748","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"body":"bulk change to close all issues resolved but not closed and not changed since June 1, 2014.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=myrna","name":"myrna","emailAddress":"m dot v dot lunteren at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Myrna van Lunteren","active":true},"created":"2015-01-21T00:23:07.172+0000","updated":"2015-01-21T00:23:07.172+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-6352/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1oefr:"}}