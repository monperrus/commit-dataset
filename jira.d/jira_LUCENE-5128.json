{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12658911","self":"https://issues.apache.org/jira/rest/api/latest/issue/12658911","key":"LUCENE-5128","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12324742","id":"12324742","description":"Major release after 4.4","name":"4.5","archived":false,"released":true,"releaseDate":"2013-10-05"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321663","id":"12321663","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2013-07-21 06:04:42.796","customfield_12312323":null,"customfield_12310420":"339104","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_207762920_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2013-07-23T06:37:53.361+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-5128/watchers","watchCount":5,"isWatching":false},"created":"2013-07-20T20:55:10.474+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12323899","id":"12323899","description":"Major release after 4.1","name":"4.2","archived":false,"released":true,"releaseDate":"2013-03-11"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-10-05T10:19:05.233+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310235","id":"12310235","name":"core/search","description":"issues with search code"}],"timeoriginalestimate":null,"description":"ArrayIndexOutOfBoundsException makes it harder to reason about the cause.\r\n\r\nIs there a better way to notify programmers of the cause?","customfield_10010":null,"timetracking":{},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10121","value":"New","id":"10121"},{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10120","value":"Patch Available","id":"10120"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"339424","summary":"Calling IndexSearcher.searchAfter beyond the number of stored documents causes ArrayIndexOutOfBoundsException","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crocket","name":"crocket","emailAddress":"crockabiscuit at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"crocket","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crocket","name":"crocket","emailAddress":"crockabiscuit at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"crocket","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":13,"total":13,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13714651","id":"13714651","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"I made this trivial change and added a test. However, TestShardSearching.testSimple fails if run with -Dtests.seed=3626FF5A675BE28. What happens is that the shard sets after=Integer.MAX_VALUE to denote no more docs should be collected from that shard.\r\n\r\nNow, this is just test code and I'm sure there's a better way to handle it (i.e. why run search at all against that shard if no docs should be collected?), but I checked TopScoreDocCollector and TopFieldCollector to understand where would they throw AIOOBE and I couldn't find the place. Looks like they just ignore any doc passed to collect(). Could you please paste the stacktrace? Perhaps it's a different collector that we need to fix?\r\n\r\nI will also check if it's possible to fix test shards to not search this shard if no docs should be collected","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2013-07-21T06:04:42.796+0000","updated":"2013-07-21T06:04:42.796+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13714653","id":"13714653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"So, while not sending a query to a shard which will return no results is logically ok, there is an issue with it. TopDocs.merge merges TopDocs[] and part of the process is to compute a totalHitsCount, so that the merged TopDocs.totalHits is the sum of all shards' totalHits. Now, imagine that we didn't submit a query to a shard with no more results, then what would happen is that the previous search would return mergedTotalHits=N and the follow-on search (e.g. clicking 'next') would return mergedTotalHits=N-K, where K is the totalHits from the shard that we omitted.\r\n\r\nFixing the test is not easy unless we cache somewhere the totalHits from the previous round. And I assume an app will need to do that too if it wants to omit a shard from a search. But this looks unrelated to this issue, i.e. it's some sort of optimization that we need to put somewhere, maybe searchAfter should also record totalHits for that shard, I'm not sure. But it's unrelated to this issue.\r\n\r\nSo I think at this point it would be better to fix whatever collector that is sensitive to searchAfter exceeding maxDoc, than to fix IndexSearcher to fail fast.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2013-07-21T06:29:53.589+0000","updated":"2013-07-21T06:29:53.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13715127","id":"13715127","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"I think the core change makes sense.  If you pass a too-big doc to searchAfter, something is buggy with the app.\r\n\r\nAnd we should fix TestShardSearching to not abuse the API like that ... it should do its own tracking.\r\n\r\nBut, it'd be good to see the actual stacktrace here first ...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-22T11:35:39.513+0000","updated":"2013-07-22T11:35:39.513+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13715203","id":"13715203","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"bq. it should do its own tracking\r\n\r\nThat's the part that bothers me. If we don't allow passing such searchAfter, we're basically telling apps that they should keep track of their shards, which means they need to maintain state (not that it's hard to maintain in this case). I'd rather first see the exception because from what I checked both TopScoreDocsCollector and TopFieldsCollector should be fine with searchAfter >= reader.maxDoc(), and IndexSearch.searchAfter returns a TopDocs so there aren't many collectors which can be affected. Except maybe if crocket uses DrillSideways...\r\n\r\nOn one hand the core fix makes sense, on the other hand it may unnecessarily complicate apps life. Especially if they need to obtain totalHits ... I wonder if in that case they can run with TotalHitCountCollector instead and construct an empty TopDocs? That's what happens when you currently pass searchAfter=Integer.MAX_VALUE. I'll try to fix the test like that to see if it helps.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2013-07-22T13:42:45.913+0000","updated":"2013-07-22T13:42:45.913+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13715663","id":"13715663","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"I had a chat w/ Mike about what's going on in the test and turns out the test is fine, comments needed some improvements. So I fixed IndexSearcher to throw IllegalArgEx if searchAfter.doc >= maxDoc + fixed test comments (I think they better explain what's going on there -- Mike, appreciate your review!) and set after.doc to maxDoc-1.\r\n\r\nI think it's ready. This all makes sense now (to me). Core tests pass. I'd appreciate some review, but I intend to commit this tomorrow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2013-07-22T21:07:04.812+0000","updated":"2013-07-22T21:07:04.812+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13715669","id":"13715669","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"+1, patch looks great.  Thanks Shai!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2013-07-22T21:10:46.993+0000","updated":"2013-07-22T21:10:46.993+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13716142","id":"13716142","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1505909 from [~shaie] in branch 'dev/trunk'\r\n[ https://svn.apache.org/r1505909 ]\r\n\r\nLUCENE-5128: IndexSearcher.searchAfter should throw IllegalArgumentException if after.doc >= reader.maxDoc()","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-23T06:25:39.329+0000","updated":"2013-07-23T06:25:39.329+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13716147","id":"13716147","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"body":"Commit 1505910 from [~shaie] in branch 'dev/branches/branch_4x'\r\n[ https://svn.apache.org/r1505910 ]\r\n\r\nLUCENE-5128: IndexSearcher.searchAfter should throw IllegalArgumentException if after.doc >= reader.maxDoc()","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jira-bot","name":"jira-bot","emailAddress":"no-reply at urd dot zones dot apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF subversion and git services","active":true},"created":"2013-07-23T06:34:28.676+0000","updated":"2013-07-23T06:34:28.676+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13716154","id":"13716154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"Committed to trunk and 4x. Closing it now, crocket - still it would be good if you can paste the full stacktrace, so we can check if there are collectors that are sensitive to that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2013-07-23T06:37:53.381+0000","updated":"2013-07-23T06:37:53.381+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13717621","id":"13717621","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crocket","name":"crocket","emailAddress":"crockabiscuit at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"crocket","active":true},"body":"Wait until this weekend. I'm going to check the stacktrace this saturday.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crocket","name":"crocket","emailAddress":"crockabiscuit at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"crocket","active":true},"created":"2013-07-23T21:05:10.788+0000","updated":"2013-07-23T21:05:10.788+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13721801","id":"13721801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crocket","name":"crocket","emailAddress":"crockabiscuit at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"crocket","active":true},"body":"Man, I was so foolish.\r\n\r\nIt was my mistake.\r\n\r\n{noformat}TopDocs searchResult=searcher.search(query, hitsPerPage, sort);\r\nfor(Integer p=1; p<page; ++p) {\r\n    searchResult=searcher.searchAfter(\r\n            searchResult.scoreDocs[searchResult.scoreDocs.length-1],\r\n            query, hitsPerPage, sort);\r\n    System.out.println(searchResult.scoreDocs.length);\r\n}{noformat}\r\n\r\nIn the above code snippet, searchResult.scoreDocs.length becomes 0 when I search beyond the number of documents.\r\nBut my code executes searchResult.scoreDocs[searchResult.scoreDocs.length-1] even after searchResult.scoreDocs.length becomes 0.\r\n\r\nThat's why I faced that exception.\r\n\r\nSorry for that.\r\n\r\nif I reported a false issue, what issue did you solve, then?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crocket","name":"crocket","emailAddress":"crockabiscuit at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"crocket","active":true},"created":"2013-07-27T23:41:23.067+0000","updated":"2013-07-27T23:41:58.947+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13721857","id":"13721857","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"body":"Hehe, no problem. Your report uncovered a potential misuse of the searchAfter API. You should always pass the last ScoreDoc that you obtained from the last search. Your code above uses it correctly, although you should check for scoreDocs.length == 0, as you noted.\r\n\r\nAfter enforcing that limitation in IndexSearcher, one test misused the API and had to be fixed as well.\r\n\r\nSo your report, while a false alarm, led to an improvement of the API :). Thank you for that!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=shaie","name":"shaie","emailAddress":"serera at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Shai Erera","active":true},"created":"2013-07-28T04:40:54.023+0000","updated":"2013-07-28T04:40:54.023+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12658911/comment/13787076","id":"13787076","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpountz","name":"jpountz","emailAddress":"jpountz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jpountz&avatarId=16520","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jpountz&avatarId=16520","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jpountz&avatarId=16520","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jpountz&avatarId=16520"},"displayName":"Adrien Grand","active":true},"body":"4.5 release -> bulk close","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jpountz","name":"jpountz","emailAddress":"jpountz at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jpountz&avatarId=16520","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jpountz&avatarId=16520","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jpountz&avatarId=16520","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jpountz&avatarId=16520"},"displayName":"Adrien Grand","active":true},"created":"2013-10-05T10:19:05.221+0000","updated":"2013-10-05T10:19:05.221+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-5128/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i1mhlb:"}}