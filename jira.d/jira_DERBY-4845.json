{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12477235","self":"https://issues.apache.org/jira/rest/api/latest/issue/12477235","key":"DERBY-4845","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[],"aggregatetimespent":null,"resolution":null,"customfield_12310220":"2010-10-14 18:45:28.296","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"24491","customfield_12310222":null,"customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":null,"workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4845/watchers","watchCount":2,"isWatching":false},"created":"2010-10-13T13:34:42.863+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":["derby_triage10_11"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"17.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12316362","id":"12316362","description":"First release on the 10.8 branch","name":"10.8.1.2","archived":false,"released":true,"releaseDate":"2011-04-29"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12370919","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12370919","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12370669","key":"DERBY-2741","self":"https://issues.apache.org/jira/rest/api/2/issue/12370669","fields":{"summary":"Classes in iapi.util are not recompiled when changed if all classes using them are unchanged","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12372261","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12372261","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12389357","key":"DERBY-3450","self":"https://issues.apache.org/jira/rest/api/2/issue/12389357","fields":{"summary":"Reduce module dependencies in Derby","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}},{"id":"12334323","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12334323","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12477150","key":"DERBY-4841","self":"https://issues.apache.org/jira/rest/api/2/issue/12477150","fields":{"summary":"Improve projecthelp for the top level Derby build script","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/4","id":"4","description":"An improvement or enhancement to an existing feature or task.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/improvement.png","name":"Improvement","subtask":false}}}}],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-07-18T09:45:41.374+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11405","id":"11405","name":"Build tools"}],"timeoriginalestimate":null,"description":"Derby is supposed to have an incremental build. That is, if you change a file, then the following command should recompile the file:\r\n\r\n   ant all\r\n\r\nThere are several places in the graph of Derby build targets where this is not true. If you change a file in certain packages, a subsequent \"ant all\" won't notice the change. This issue is a place where we can track these bugs.\r\n\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"36142","summary":"Improve the dependency tracking for our build targets","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10052","value":"Normal","id":"10052"},"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":27,"total":27,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12921074","id":"12921074","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I have noticed that this is the case for package iapi/util/*.java. There may be others.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-10-14T18:45:28.296+0000","updated":"2010-10-14T18:45:28.296+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12921619","id":"12921619","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Committed a small fix to the build file for package iapi/util/ which makes \"ant all\" pick up changes in files: svn1023167","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-10-16T02:07:50.337+0000","updated":"2010-10-16T02:07:50.337+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12921694","id":"12921694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"I used the attached script to find out which files were not picked up by an incremental build. Here's what I found:\r\n\r\n* java/tools/org/apache/derby/iapi/tools/i18n/LocalizedResource.java\r\n\r\nModifications to this file are detected by incremental builds, but it will be compiled using another build target than what's used by full builds. Full builds will compile against Java 1.4.2 libraries, whereas incremental builds will compile against the JSR-169 stubs. Incremental builds fail because the class calls ResultSet.getBigDecimal(int), which is not part of JSR-169.\r\n\r\n* java/engine/org/apache/derby/jdbc/EmbedXAResource.java\r\n* java/engine/org/apache/derby/jdbc/JDBC.java\r\n* java/engine/org/apache/derby/iapi/transaction/TransactionControl.java\r\n* java/engine/org/apache/derby/iapi/transaction/TransactionListener.java\r\n* java/engine/org/apache/derby/iapi/security/SecurityUtil.java\r\n* java/drda/org/apache/derby/mbeans/drda/NetworkServerMBean.java\r\n\r\nModifications to these files are not detected by incremental builds.\r\n\r\nIn addition, none of the files under java/demo/localcal and java/demo/scores are picked up by incremental builds, but they are not compiled by full builds either.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-10-16T14:11:54.561+0000","updated":"2010-10-16T14:11:54.561+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12921735","id":"12921735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Here's a patch for the issue with tools/i18n/LocalizedResource.java.\r\n\r\nM       java/tools/build.xml\r\n\r\nThe classes in impl/tools depend on the classes in iapi/tools, but there are no dependencies the other way around. Therefore, turn around the order of the targets and build iapi before impl. This change ensures that LocalizedResource.java is always compiled against the JSR-169 libraries, so it will now fail to compile both in full builds and in incremental builds.\r\n\r\nM       java/tools/org/apache/derby/iapi/tools/i18n/LocalizedResource.java\r\n\r\nCall getObject() instead of getBigDecimal() when retrieving the value of a DECIMAL column. Since getObject() is part of JSR-169, this will make the class compilable again. getObject() returns a java.math.BigDecimal, so there should be no change for the embedded driver and the client driver. The JSR-169 driver throws an exception when getObject() is called on a DECIMAL column, but LocalizedResource already does introspection to find out if it's safe to retrieve BigDecimal values. On JSR-169 it'll fall back to getString() as it did before.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-10-16T18:56:36.518+0000","updated":"2010-10-16T18:56:36.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12921977","id":"12921977","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Tests ran cleanly with tools-i18n.diff. Committed revision 1023662.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2010-10-18T06:43:36.757+0000","updated":"2010-10-18T06:43:36.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12922760","id":"12922760","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Thanks, Knut! Another build anomaly I noticed:\r\na) ant clobber\r\nb) introduce a syntax error to a file in org.apache.derby.iapi.util, e.g. ByteArray.java\r\nc) ant all, build stops\r\nd) correct error\r\ne) ant all now fails with this error:\r\nC:\\cygwin\\home\\dag\\java\\sb\\sb1\\generated\\java\\org\\apache\\derby\\impl\\sql\\compile\\SQLParser.java:25: package org.apache.derby.iapi.sql does not exist\r\n    [javac] import org.apache.derby.iapi.sql.Statement;\r\n\r\nf) ant clobber all makes all ok again","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2010-10-19T22:35:06.297+0000","updated":"2010-10-19T22:35:06.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12928271","id":"12928271","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-4845-01-aa-removeParserPrep.diff. This patch cleans up an asymmetry in the generation of Derby's grammars. Committed at subversion revision 1031069.\r\n\r\nThis patch should fix certain situations in which you see the following:\r\n\r\n1) You build the codeline from scratch.\r\n\r\n2) But the build dies on a compile-time error.\r\n\r\n3) You fix the compile-time error and try \"ant all\" without doing a clobber, hoping for an incremental finish to the interrupted build.\r\n\r\n4) But now the build dies on unsatisfied references in the generated grammars.\r\n\r\n\r\nTouches the following files:\r\n\r\n-------------\r\n\r\nM      java/tools/org/apache/derby/impl/tools/build.xml\r\n\r\nMake the tools build depend on generation of the ij grammar the same way that the sql interpreter build depends on generation of the sql grammar.\r\n\r\n-------------\r\n\r\nM      build.xml\r\n\r\nStop generating the grammars before they are really needed.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2010-11-04T16:40:30.420+0000","updated":"2010-11-04T16:40:30.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12928319","id":"12928319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Attaching derby-4845-02-aa-flipUtilsAndTypes.diff. This patch fixes a build dependency problem which surfaced when I sync'd with the head of the trunk. Committed at subversion revision 1031174.\r\n\r\nI think that the problem was caused by some submission which made the compilation of ...iapi.util start compiling what's in iapi.types. That latter directory has a special build target which compiles SqlXmlUtil with a special classpath which includes xercesImpl.jar. You can't just compile the contents of iapi.types with the ordinary jdk1.4 classpath.\r\n\r\nThe solution was to flip the order in which we compile ...iapi.util and ...iapi.types. Now we compile ...iapi.types first.\r\n\r\nHopefully this patch doesn't destabilize someone else's build.\r\n\r\nTouches the following file:\r\n\r\nM      java/engine/org/apache/derby/iapi/build.xml\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2010-11-04T19:38:33.707+0000","updated":"2010-11-04T19:38:33.707+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/12998479","id":"12998479","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"One improvement we could make, is changing the ant javac targets so that they don't compile java files that are not explicitly added to the list of files to compile. The way to do this is described here: http://ant.apache.org/manual/Tasks/javac.html#srcdirnote (basically, just add sourcepath=\"\" to the javac targets). If we take that approach, the build will fail when it comes across a dependency that we haven't specified in the build script.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-02-23T18:09:06.698+0000","updated":"2011-02-23T18:09:06.698+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13138222","id":"13138222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"One thing that's causing problems for the dependency tracking is that we compile the impl classes in the engine before we build the iapi classes. Since the impl classes depend on the iapi classes, most of the iapi classes will already have been built when the iapi build target is invoked. Building iapi before impl is the right way to do it, but that doesn't work currently because of some ugly dependencies from iapi to impl that have snuck in and cause some impl classes to be built using the wrong classpath if built that way.\r\n\r\nIt may be a good, incremental improvement if we remove the dependencies from iapi to impl, and then make iapi being built before impl. Once that's done, we can set sourcepath=\"\" on the iapi target (see previous comment) to prevent accidental reintroduction of dependencies on impl classes.\r\n\r\nThe iapi classes currently have many dependencies on implementation classes. Here are three patches that remove some of the dependencies:\r\n\r\n- d4585-iapi-statementnode.diff:\r\n\r\nThe implementation class StatementNode is used in the signatures of methods in the TriggerDescriptor and DataDictionary iapi interfaces. The patch changes the signatures to use the iapi interface Visitable instead of StatementNode. In some cases that's specific enough. In other cases, the impl classes that use these methods need to cast the return value to StatementNode now. Actually, most callers of the methods already cast the return value to StatementNode (which suggests that the a less specific interface has been used in the signature before too) or to sub-classes of StatementNode, and didn't need to be changed.\r\n\r\n- d4845-iapi-resultsetstatistics.diff:\r\n\r\nTo apply this patch, first run: svn mv java/engine/org/apache/derby/impl/sql/execute/rts/ResultSetStatistics.java java/engine/org/apache/derby/iapi/sql/execute/ResultSetStatistics.java\r\n\r\nThe interface ResultSetStatistics lives in the impl sub-tree. However, it is used in the signature of the iapi interface ResultSetStatisticsFactory. It is also the parent of the iapi interface XPLAINVisitor. This suggests that the interface really belongs in iapi and not in impl. The patch moves the interface to iapi and updates import statements to point to the new location.\r\n\r\nd4845-iapi-dependablefinder.diff:\r\n\r\nThe impl classes DDdependableFinder and DDColumnDependableFinder are instantiated directly by the iapi class TupleDescriptor and many of its sub-classes. Since the DD* classes are specific to the data dictionary implementation, the patch adds creator methods to the DataDictionary interface and moves the actual creation of these instances into DataDictionaryImpl. Then we don't need to reference these two implementation classes from iapi classes.\r\n\r\nAll the regression tests ran cleanly with these three patches.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-10-28T11:06:02.595+0000","updated":"2011-10-28T11:06:02.595+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13142120","id":"13142120","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed d4845-iapi-resultsetstatistics.diff with revision 1196542.\r\nCommitted d4845-iapi-statementnode.diff with revision 1196560.\r\nCommitted d4845-iapi-dependablefinder.diff with revision 1196562.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-02T13:05:21.583+0000","updated":"2011-11-02T13:05:21.583+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13143908","id":"13143908","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The NodeFactory class depends on the implementation classes QueryTreeNode, ResultColumnList and ResultSetNode. There's even a comment saying that these classes shouldn't have been used there:\r\n\r\n/* Strictly speaking we shouldn't import classes under the impl hierarchy here\r\n * but this is work in progress.\r\n * manish - Wed Mar 28 13:05:19 PST 2001\r\n */\r\nimport  org.apache.derby.impl.sql.compile.QueryTreeNode;\r\nimport org.apache.derby.impl.sql.compile.ResultColumnList;\r\nimport org.apache.derby.impl.sql.compile.ResultSetNode;\r\n\r\nThe proper fix is to get rid of NodeFactory completely (see DERBY-673), but that's a bigger task. For now, we can make some smaller changes to remove its dependencies on impl classes.\r\n\r\nThe attached patch (d4845-iapi-slimmer-nodefactory.diff) is a first step. It moves the method mapTableAsVTI() into FromBaseTable, the only class that ever calls that method. Similarly, it moves getCreateAliasNode() into the parser (according to the code comments, it was carved out of the parser in order to support ALTER PUBLICATION, which isn't supported by Derby).\r\n\r\nBy moving these methods out of NodeFactory and into the impl classes that use them, the dependencies on ResultColumnList and ResultSetNode go away.\r\n\r\nAll the regression tests passed with the patch.\r\n\r\n(One small change in the patch that may look unrelated, is the signature change for MethodCallNode.addParms(). Now it accepts java.util.List instead of java.util.Vector. This was done so that we didn't have to move the emptyVector field from NodeFactory to FromBaseTable. With the signature change, we could use Collections.EMPTY_LIST instead, and simply remove the emptyVector field from NodeFactory instead of moving it into FromBaseTable.)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-04T10:52:24.416+0000","updated":"2011-11-04T10:52:24.416+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13145332","id":"13145332","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed d4845-iapi-slimmer-nodefactory.diff with revision 1198695.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-07T10:52:34.359+0000","updated":"2011-11-07T10:52:34.359+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13145538","id":"13145538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The previous commit removed references to ResultColumnList and ResultSetNode from NodeFactory, but it still references the impl class QueryTreeNode, which is the return type for the getNode() methods.\r\n\r\nTo avoid exposing the impl class through iapi, I've added a Node interface that QueryTreeNode implements and made the getNode() methods return Node instead of QueryTreeNode. See the attached d4845-iapi-nodefactory-getnode.diff patch.\r\n\r\nAll regression tests ran cleanly with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-07T14:56:30.178+0000","updated":"2011-11-07T14:56:30.178+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13146169","id":"13146169","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed revision 1199160.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-08T08:54:30.962+0000","updated":"2011-11-08T08:54:30.962+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13146401","id":"13146401","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Attaching patch d4845-iapi-unused-imports.diff which removes unused imports in some of the iapi classes. The unused imports included classes in the impl package and caused unnecessary compile-time dependencies on impl from the iapi package.\r\n\r\nCommitted revision 1199348.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-08T17:04:25.218+0000","updated":"2011-11-08T17:04:25.218+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13146432","id":"13146432","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"DataDictionaryImpl has a public boolean field called readOnlyUpgrade. This field is accessed directly, also from iapi code which needs to cast the data dictionary instance to DataDictionaryImpl.\r\n\r\nThe attached patch d4845-iapi-readOnlyUpgrade.diff adds a method called isReadOnlyUpgrade() to the DataDictionary interface so that we don't need to cast the instance to the implementation class in order to access the field.\r\n\r\nAll the regression tests ran cleanly with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-08T17:47:52.831+0000","updated":"2011-11-08T17:47:52.831+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13147573","id":"13147573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed d4845-iapi-readOnlyUpgrade.diff with revision 1200232.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-10T09:17:16.430+0000","updated":"2011-11-10T09:17:16.430+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13147662","id":"13147662","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The previous commit broke the build for those who have\r\njsr169compile.classpath configured:\r\nhttp://mail-archives.apache.org/mod_mbox/db-derby-dev/201111.mbox/%3C20111110092611.21938.qmail%40tyr72%3E\r\n\r\nThe reason seems to be that dependencies on Java SE has sneaked into\r\ncode that's supposed to work on CDC/Foundation Profile. It didn't use\r\nto fail at compile time before because the classes were compiled by a\r\ndifferent target than intended. When we removed some implicit build\r\ndependencies in the previous patch, these classes ended up being\r\ncompiled using the intended target, which used a stricter compile\r\nclasspath than the implicit target used before.\r\n\r\nThis problem could also be seen before the previous commit, by\r\ntouching java/engine/org/apache/derby/impl/db/SlaveDatabase.java and\r\ndoing an incremental build on an otherwise fully compiled source tree.\r\nThis is exactly the kind of problems we want to fix in this JIRA\r\nissue.\r\n\r\nI think this isn't just a build problem, but also a run-time problem\r\non CDC/FP. For example, the following code raises a\r\njava.lang.NoClassDefFoundError with Derby 10.8.2.2 on Oracle Java ME\r\nEmbedded Client:\r\n\r\nEmbeddedSimpleDataSource ds = new EmbeddedSimpleDataSource();\r\nds.setDatabaseName(\"wombat\");\r\nds.setCreateDatabase(\"create\");\r\nds.getConnection().close();\r\n\r\nds.setCreateDatabase(null);\r\nds.setDatabaseName(null);\r\nds.setShutdownDatabase(\"shutdown\");\r\nds.setConnectionAttributes(\"deregister=true\");\r\nds.getConnection();\r\n\r\nWhen the attached patch is applied, it changes to the expected\r\nexception: java.sql.SQLException: Derby system shutdown.\r\n\r\nHere's a description of the changes in d4845-buildbreak.diff:\r\n\r\n* java/engine/org/apache/derby/impl/db/SlaveDatabase.java:\r\n\r\nThis class is supposed to be compiled against CDC/FP libraries (and\r\nnow it actually is), but it references java.sql.Driver and\r\njava.sql.DriverManager, which are not available on that platform. The\r\npatch changes the code to use InternalDriver to shut down the\r\ndatabase. (The original code didn't cause any run-time failures on\r\nCDC/FP because it the code is wrapped in a try/catch that ignores all\r\nexceptions.)\r\n\r\n* java/engine/org/apache/derby/iapi/reference/Limits.java\r\n* java/engine/org/apache/derby/impl/jdbc/LOBStoredProcedure.java\r\n* java/engine/org/apache/derby/impl/sql/catalog/DataDictionaryImpl.java\r\n\r\nDataDictionaryImpl imported LOBStoredProcedure in order to get a\r\nconstant. Since LOBStoredProcedure is not supposed to work on CDC/FP,\r\nwhereas DataDictionaryImpl is, DataDictionaryImpl shouldn't reference\r\nit directly. The patch moves the constants to the Limits interface so\r\nthat DataDictionaryImpl doesn't have to import LOBStoredProcedure.\r\n\r\n* java/engine/org/apache/derby/jdbc/AutoloadedDriver.java\r\n* java/engine/org/apache/derby/jdbc/InternalDriver.java\r\n\r\nInternalDriver calls AutoloadedDriver.setDeregister(), but it should\r\nnot reference code that only works on Java SE, since it is supposed to\r\nwork on CDC/FP. The patch moves the methods setDeregister() and\r\ngetDeregister() to InternalDriver and lets AutoloadedDriver fetch this\r\ninfo from InternalDriver instead.\r\n\r\n\r\nThe build works again with jsr169compile.classpath set when the patch\r\nis applied. No problems were found when running suites.All and\r\nderbyall.\r\n\r\nCommitted revision 1200293.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-10T13:13:03.221+0000","updated":"2011-11-10T13:13:03.221+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13155037","id":"13155037","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"The impl.jdbc.Util class is used by many of the brokered JDBC objects in the iapi.jdbc package. The attached patch, d4845-iapi-stmt-isClosed.diff, removes one usage in BrokeredStatement.isClosed(). That method currently throws a not implemented exception and uses the Util class to generate the exception. The patch instead implements the method in BrokeredStatement and removes the more or less identical overrides in BrokeredStatement40, BrokeredPreparedStatement40 and BrokeredCallableStatement40.\r\n\r\nAll the regression tests ran cleanly with the patch.\r\n\r\nCommitted revision 1204934.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-22T11:46:02.329+0000","updated":"2011-11-22T11:46:02.329+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13155154","id":"13155154","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"BrokeredConnection40 imports EmbedConnection40 in order to be able to call some JDBC 4.1 methods. Typically, we would have added the methods to the EngineConnection interface so that we didn't have to reference the implementation class directly. The problem with these methods was that they had java.util.concurrent.Executor in their signatures, so they couldn't be put into the EngineConnection interface (because it has to be compilable against the CDC/FP libraries, which don't have the Executor interface).\r\n\r\nThe attached patch, d4845-iapi-brokered-connection.diff, adds a new interface (EngineConnection40) which contains these methods. BrokeredConnection40 and EmbedConnection40 implement the interface. This makes it possible to access the methods from BrokeredConnection40 without casting the underlying connection instance to the implementation class EmbedConnection40.\r\n\r\nAll the regression tests ran cleanly with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-22T14:10:04.591+0000","updated":"2011-11-22T14:10:04.591+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13155500","id":"13155500","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed d4845-iapi-brokered-connection.diff to trunk with revision 1205195.\r\n\r\nAttaching another patch, d4845-iapi-brokered-callable-stmt.diff, which fixes a similar dependency in BrokeredCallableStatement40 by introducing an EngineCallableStatement40 interface and making EmbedCallableStatement40 implement that interface. All regression tests ran cleanly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-22T22:31:56.258+0000","updated":"2011-11-22T22:31:56.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13155834","id":"13155834","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed d4845-iapi-brokered-callable-stmt.diff to trunk with revision 1205378.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-23T12:27:33.057+0000","updated":"2011-11-23T12:27:33.057+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13155976","id":"13155976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"As mentioned in an earlier comment, the impl.jdbc.Util class is used by many of the brokered JDBC objects in the iapi.jdbc package to generate SQLExceptions.\r\n\r\nThe attached patch, d4845-iapi-exception-util.diff, makes them stop using the Util class. This is done by creating an iapi interface that SQLExceptionFactory implements, and accessing SQLExceptionFactory through that interface instead of through the Util class.\r\n\r\nAll the regression tests passed with the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-23T17:29:38.131+0000","updated":"2011-11-23T17:29:38.131+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13156598","id":"13156598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed d4845-iapi-exception-util.diff to trunk with revision 1205753.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-11-24T08:50:16.035+0000","updated":"2011-11-24T08:50:16.035+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13174733","id":"13174733","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"d4845-jsr169-nonoptional.diff addresses another issue in the build scripts. Earlier, the JSR-169 specific parts were optional, but now they're always built. However, the build scripts still model the old world, by compiling the mandatory parts first and the (previously) optional parts last. This adds to the complexity of the scripts, and also causes some redundancies (because some of the previously optional targets are now dependencies of the mandatory targets, but the optional targets are still invoked explicitly later in the build process).\r\n\r\nThe patch merges the optional targets with the non-optional ones, so that they get compiled in one go. It also removes the target that rewrites modules.properties for J2ME support, since that information could now be hard-coded in modules.properties.\r\n\r\nI ran the regression tests successfully on both Java 6 and phoneME.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-12-22T10:13:11.958+0000","updated":"2011-12-22T10:13:11.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12477235/comment/13174738","id":"13174738","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"Committed d4845-jsr169-nonoptional.diff with revision 1222151.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2011-12-22T10:19:09.051+0000","updated":"2011-12-22T10:19:09.051+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-4845/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06jsv:"}}