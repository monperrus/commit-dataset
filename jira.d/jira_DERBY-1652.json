{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12347431","self":"https://issues.apache.org/jira/rest/api/latest/issue/12347431","key":"DERBY-1652","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12311972","id":"12311972","description":"","name":"10.1.3.2","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-08-07 14:30:45.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22623","customfield_12310222":"1_*:*_1_*:*_897427000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_16225860382","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-08-17T23:15:28.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1652/watchers","watchCount":0,"isWatching":false},"created":"2006-08-07T13:58:21.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/10920","id":"10920","description":"initial source drop","name":"10.0.2.0","archived":false,"released":true,"releaseDate":"2004-08-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12311953","id":"12311953","description":"","name":"10.1.3.1","archived":false,"released":true,"releaseDate":"2006-06-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12313012","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12313012","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12346807","key":"DERBY-1603","self":"https://issues.apache.org/jira/rest/api/2/issue/12346807","fields":{"summary":"ERROR 54038: \"Maximum depth of nested triggers was exceeded\" occurs when trigger fires after upating 10.1.2.5 jars to 10.1.3.1","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12313112","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12313112","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12332783","key":"DERBY-1261","self":"https://issues.apache.org/jira/rest/api/2/issue/12332783","fields":{"summary":"Two triggers on same table cause \"ERROR 54038: Maximum depth of nested triggers was exceeded.\"","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-30T16:12:53.858+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"Execution  of  an update trigger that updates the same row  as the original update will  recurse forever and exceed the maximum nesting level of 16 so should throw the exception:\nERROR 54038: \"Maximum depth of nested triggers was exceeded\"\n\nHowever, it  does not always throw the exception.   For example:\n\n\nCREATE TABLE \"TEST\" (                                           \n      \n \"TESTID\" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START \n WITH 1,\n INCREMENT BY 1),                                                \n      \n \"INFO\" INTEGER NOT NULL,                                        \n      \n \"TIMESTAMP\" TIMESTAMP NOT NULL DEFAULT \n '1980-01-01-00.00.00.000000'  \n );                                                              \n      \n CREATE TRIGGER UPDATE_TEST                            \n  AFTER UPDATE ON TEST                                 \n  REFERENCING OLD AS OLD                               \n  FOR EACH ROW MODE DB2SQL                             \n  UPDATE TEST SET TIMESTAMP = CURRENT_TIMESTAMP WHERE  \n  TESTID = OLD.TESTID;                                 \n INSERT INTO TEST (INFO) VALUES  \n (1),                            \n (2),                            \n (3); \n\n UPDATE TEST SET INFO = 1 WHERE TESTID = 2; \n\nDoes not throw an exception:\n\nHowever, If the derby jars are updated to a new version, the correct exception is thrown.\n\n Replace derby jars with  new version\n Execute the following in ij:\n UPDATE TEST SET INFO = 1 WHERE TESTID = 2; \n ERROR 54038: Maximum depth of nested triggers was exceeded.\n\n\nNote: This issue stemmed from the Invalid issue,  DERBY-1603, because a user hit the exception after upgrade and thought the exception after upgrade, not the lack of exception before upgrade was the problem. This may be a common user error, so  we need a release note to help mitigate the issue.    I will add one shortly after confirming the correct trigger syntax. \n\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38745","summary":"Update trigger updating the same rows as the original update does not  throw an exception ERROR 54038: \"Maximum depth of nested triggers was exceeded\" as it should","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":18,"total":18,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12426232","id":"12426232","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"body":"Does the comment \"However, If the derby jars are updated to a new version\" mean that the bug is fixed in the new version and so thiis bug is already fixed.\r\nIe. it is just a problem with some older versions and upgrading to the latest 10.1 will mean the exception is always thrown, no matter how the trigger was created?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=djd","name":"djd","emailAddress":"djd at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Daniel John Debrunner","active":true},"created":"2006-08-07T14:30:45.000+0000","updated":"2006-08-07T14:30:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12426240","id":"12426240","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Dan asked:\r\n>Does the comment \"However, If the derby jars are >updated to a new version\" mean that the bug is fixed in >the new version and so thiis bug is already fixed. \r\n\r\nNo if you create this trigger in the latest 10.2 you will see that when it fires it does not give an exception.\r\n\r\nIt is changing versions that  triggers the trigger to start giving the  exception.  So for instance if you create the trigger in 10.1.3.1,   it would fire without error until you moved to  10.1.3.2.  Then you would start seeing the exception when the trigger fires.  This is why I am concerned about user impact with this issue.   The incorrect  trigger will operate as the user might think it would until they upgrade and then  boom, their application works no more.\r\n\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-08-07T14:45:31.000+0000","updated":"2006-08-07T14:45:31.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12426518","id":"12426518","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching patch for DERBY-1652.  The patch is for the 10.1 codebase.  A similar patch is needed for 10.2, which I'll post as soon as derbyall completes.  \r\n\r\nThe cause of the problem is that the trigger descriptor is created after the stored prepared statement(SPS) has been compiled, so the compiled form of the SPS is not aware of that its trigger action can fire on the trigger table itself.  Hence, the constant action was not generated correctly.  \r\n\r\nDuring upgrade, the SPSs are invalidated at database boot time.  The SPS will be recompile when it is being invoked and the recompilation at this point will of course detect the relevent trigger and generate the correct constant action for the SPS and produce the expected behavior when the SPS is executed - throwing an error when it exceeds the trigger's maximum depth in the above case.\r\n\r\nThe simplest solution without introducing another revalidation of the SPS is to create the trigger descriptor first before compiling the SPS.  I ran derbyall and had to go over the testcases which have the wrong master outputs and I have corrected them on this patch.  Appreciate if someone can review this.\r\n\r\nOn a side note, I ran derbyall on a *clean* 10.1 codeline and I see the following\r\nfailures:\r\n\r\nderbyall/derbyall.fail:unit/T_Diagnosticable.unit\r\nderbyall/derbyall.fail:i18n/urlLocale.sql\r\nderbyall/derbyall.fail:i18n/messageLocale.sql\r\nderbyall/derbyall.fail:i18n/iepnegativetests_ES.sql\r\nderbyall/derbynetclientmats/derbynetmats.fail:derbynet/sysinfo.java\r\nderbyall/derbynetmats/derbynetmats.fail:derbynet/sysinfo.java\r\n\r\nIs this a known problem?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-08T09:35:08.000+0000","updated":"2006-08-08T09:35:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12426745","id":"12426745","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Attaching patch for DERBY-1652.  This patch applies to the trunk codeline.  Derbyall still running, will confirm if it passes successfully in subsequent comment.  Nevertheless, the patch is ready for review. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-08T22:05:09.000+0000","updated":"2006-08-08T22:05:09.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12426861","id":"12426861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"derbyall passes with derby1652-trunk-diff01.txt.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-09T07:15:07.000+0000","updated":"2006-08-09T07:15:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12427091","id":"12427091","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"This patch appears to add a duplicate entry to the dependency table.  Need to investigate...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-10T03:47:36.000+0000","updated":"2006-08-10T03:47:36.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12427297","id":"12427297","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"False alarm.  Renabling patch available. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-10T18:07:41.000+0000","updated":"2006-08-10T18:07:41.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12427542","id":"12427542","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"The patch look good. \r\n\r\nWhen the trunk patch is applied I get the desired error on the repro,\r\nwithout it, I do not.  I also checked with soft and hard upgrade (from\r\n10.1 trunk) and its still works in those cases. I did not try out the\r\n10.1 version of the patch.\r\n\r\nThe diagnosis seems correct from looking locally at the code, although\r\nI have not traced the logic fully to where the dependency actually\r\ngets picked up.\r\n\r\nMinor nit on the code: The variable tmpTriggerId may be done away\r\nwith, or at least its comment text updated; it is no longer so\r\nmeaningful now that the sps creation is moved out, but if you prefer,\r\nI am ok with leaving that to the committer's discretion.\r\n\r\n+1\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-08-11T15:20:37.000+0000","updated":"2006-08-11T15:20:37.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12427573","id":"12427573","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Thanks for the taking the time to review this patch, Dag.  The local variable tmpTriggerId is kept because it is still needed later by the createSPS method.  As for when the dependency will get picked up, it is at the trigger action's bind phase.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-11T18:04:28.000+0000","updated":"2006-08-11T18:04:28.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12427903","id":"12427903","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Yes, I know it's used by the createSPS methods; my point was that you\r\ncould do away with it by using TriggerDecriptor#getUUID instead once\r\ntriggerd is created. In the old code, a variable was necessary, since\r\nthe trigger was referenced before creation. Just a detail, I agree.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-08-14T14:33:17.000+0000","updated":"2006-08-14T14:33:17.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12428023","id":"12428023","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I don't know much about this code area but I looked at this patch as I am very keen to see this in to 10.2 and would also like to get it into 10.1 as soon as possible. The approach looks reasonable to me but I have to admit I don't understand the full impact of moving the trigger descriptor creation before  compiling the SPS, so I don't have too much to offer in terms of code review.\r\n\r\nOn the tests, I have some questions about the the test updates\r\nIn updateableResultSet.java  we have this diff.\r\n\r\n                        rs.next();\r\n                        System.out.println(\"column 1 on this row is \" + rs.getInt(1));\r\n                        System.out.println(\"this update row will fire the update trigger which will update all the rows in the table to have c1=1 and hence no more rows will qualify for the resultset\"\r\n);\r\n-                       rs.updateLong(1,123);\r\n+                       rs.updateLong(2,2);\r\n                        rs.updateRow();\r\n                        rs.next();\r\n\r\nBy changing a different value are we still performing the action described?\r\n\r\nSimilarly in triggerGeneral master update we had  previously  positive test cases that now throw an error.  Might we be able to use the workaround you gave me, to specify on which columns the trigger will fire to retain the original semantics of these tests?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-08-15T03:16:25.000+0000","updated":"2006-08-15T03:16:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12428060","id":"12428060","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"For the updatableResultSet.java, yes, it will still perform the action described because the triggers are also modified to preserve the original intention of the test.  \r\n\r\nThe master output for triggerGeneral.sql were incorrect for those testcases, so I just replaced them with the expected results (I thought they were \"negative\" tests with wrong results).  I tried to preserve the original testcase intent whenever I can but the column list specification won't work on those testcases since they are using an \"after insert\" trigger.   And that test file already have tests to insert to another table from the trigger action, so now those tests really become \"negative\"...","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-15T08:00:54.000+0000","updated":"2006-08-15T08:00:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12428161","id":"12428161","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I am looking at committing the trunk submitted diff, assuming there is no objection.  It seems like Dag's comment can be handled as a separate item.  To this end I ran all the tests on XP, sun jdk1.4.2 and got\r\n3 diffs:\r\nderbyall/derbynetmats/DerbyNet/jdbcapi/blobclob4BLOB.diff (known issue showing up in the tinderbox tests)\r\nderbyall/upgrade/Upgrade_10_1_10_2.diff (known issue showing up in the tinderbox tests)\r\nand the following I need to investigate:\r\n*** Start: _Suite jdk1.4.2_07 DerbyNetClient derbynetmats:jdbcapi 2006-08-14 19:\r\n57:40 ***\r\n0 add\r\n> ..................................E...E.\r\n> There were 2 errors:\r\n> 1) testUpdateUpdatedTupleScrollUpdateRow(org.apache.derbyTesting.functionTests\r\n.tests.jdbcapi.URCoveringIndexTest)java.lang.OutOfMemoryError\r\n> 2) testNextOnLastRowForwardOnly(org.apache.derbyTesting.functionTests.tests.jd\r\nbcapi.ScrollResultSetTest)java.lang.OutOfMemoryError\r\n> FAILURES!!!\r\n> Tests run: 817,  Failures: 0,  Errors: 2\r\nTest Failed.\r\n*** End:   _Suite jdk1.4.2_07 DerbyNetClient derbynetmats:jdbcapi 2006-08-14 20:\r\n01:56 ***","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-08-15T16:21:39.000+0000","updated":"2006-08-15T16:21:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12428199","id":"12428199","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Yip said\r\n>I thought they were \"negative\" tests with wrong results\r\nThanks Yip,  I think I got confused because of the comments: \"--after\" and the trigger name: \"tgood\"  don't lend themselves to a negative test.  If more work is done on the patch it might be good to change them for clarity moving forward.\r\n\r\nij> -- after\r\ncreate trigger tgood after insert on x for each statement mode db2sql insert into x values 666;\r\n0 rows inserted/updated/deleted\r\nij> insert into x values 1;\r\nERROR 54038: Maximum depth of nested triggers was exceeded.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-08-15T19:33:49.000+0000","updated":"2006-08-15T19:33:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12428223","id":"12428223","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I reproduced the out of memory on my machine in a clean codeline so do not believe it is caused by this\r\npatch.  I also have reported DERBY-1701 for those out of memory errors which have been showing up in the public regression test runs on a number of platforms. \r\n\r\nI committed this patch as is, feeling the comments above were not worth holding up the patch.  They seem like good things to do, but not necessary to hold up the fix.\r\n\r\nm1_142:97>svn commit\r\n\r\nSending        java\\engine\\org\\apache\\derby\\impl\\sql\\execute\\CreateTriggerConstantAction.java\r\nSending        java\\engine\\org\\apache\\derby\\impl\\store\\raw\\data\\OverflowInputStream.java\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\master\\triggerGeneral.out\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\lang\\triggerGeneral.sql\r\nSending        java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\lang\\updatableResultSet.java\r\nTransmitting file data .....\r\nCommitted revision 431698.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-08-15T20:57:09.000+0000","updated":"2006-08-15T20:57:09.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12428582","id":"12428582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"I think this issue should be considered as resolved once the changes have also been updated to 10.1 codeline.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-17T06:03:35.000+0000","updated":"2006-08-17T06:03:35.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12428584","id":"12428584","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Thanks Yip. Committed to 10.1\r\n\r\nDate: Wed Aug 16 23:32:27 2006\r\nNew Revision: 432165\r\n\r\nURL: http://svn.apache.org/viewvc?rev=432165&view=rev\r\nWe still need the release note as users may hit the error unexpectedly on upgrade and may  need to change their triggers to specify which column in the trigger that will invoke the trigger action per  Yip's suggestion at:\r\nhttp://www.nabble.com/Re%3A--jira--Commented%3A-%28DERBY-1603%29-ERROR-54038%3A-%22Maximum-depth-of-nested-triggers-was-exceeded%22-occurs-when-trigger-fires-after-upating-10.1.2.5-jars-to-10.1.3.1-p5689247.html \r\n\r\nI'm afraid I can't get to that right away after all. It will have to wait a while if I do it.\r\n\r\nThanks \r\n\r\nKathey\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-08-17T06:45:01.000+0000","updated":"2006-08-17T06:45:01.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12347431/comment/12430906","id":"12430906","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"body":"Here is the release note for this jira:\r\n\r\n\r\nRelease Note for DERBY-1652\r\n-------------------------------------------\r\n\r\nPROBLEM\r\n\r\n   In some cases, an after update trigger does not get fired upon itself when its trigger action contains \r\nan update statement on the trigger's subject table.\r\n\r\n\r\nSYMPTOMS\r\n\r\n   (1)  When defining a trigger for the first time for a table, e.g.:\r\n\r\n  \r\n        CREATE TABLE \"TEST\" (\"TESTID\" INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),\r\n                             \"INFO\" INTEGER NOT NULL,\r\n                             \"TIMESTAMP\" TIMESTAMP NOT NULL DEFAULT '1980-01-01-00.00.00.000000');\r\n    \r\n        CREATE TRIGGER UPDATE_TEST\r\n        AFTER UPDATE ON TEST\r\n        REFERENCING OLD AS OLD\r\n        FOR EACH ROW MODE DB2SQL\r\n            UPDATE TEST SET TIMESTAMP = CURRENT_TIMESTAMP WHERE TESTID = OLD.TESTID;\r\n  \r\n        INSERT INTO TEST (INFO) VALUES (1), (2), (3);\r\n\r\n        UPDATE TEST SET INFO = 1 WHERE TESTID = 2;   \r\n\r\n\r\n        The above update statement executes successfully which it is incorrect.  The system should have issued \r\n        SQLSTATE 54038 since it self-triggers to its maximum depth of 16.\r\n\r\n   \r\n   (2)  With the above example, when an user upgrades to a higher version and issues the same update statement:\r\n\r\n        UPDATE TEST SET INFO = 1 WHERE TESTID = 2;  \r\n        ERROR 54038: Maximum depth of nested triggers was exceeded. \r\n\r\n\tThe SQLSTATE 54038 is issued in this case because after database upgrade, the trigger action will be \r\n        invalidated by the system and will force a recompilation of the trigger when it is fired.  The system\r\n        generates the correct execution plan this time and since the trigger behavior have changed, this might \r\n        cause applications to break unexpectedly.\r\n\r\n\r\nCAUSE\r\n\r\n   Derby's did not generate the correct execution plan for self-trigger invocation when such a trigger is declared\r\n   for the first time on the subject table; hence, resulting in the stated problem above.  The affected version is \r\n   Derby 10.0 and 10.1.\r\n\r\n\r\nSOLUTION\r\n\r\n   A fix to resolve the above Derby symptom is available in 10.1 and 10.2.\r\n\r\n\r\nWORKAROUND\r\n\r\n   If self-trigger invocation was not intended by the application, the application can select which column(s) on the\r\n   update statement can cause the trigger to fire in the cREATE TRIGGER statement.  i.e.:\r\n\r\n   CREATE TRIGGER update_test\r\n   AFTER UPDATE OF INFO ON test\r\n   REFERENCING OLD AS old\r\n   FOR EACH ROW MODE DB2SQL\r\n       UPDATE test SET timestamp=current_timestamp WHERE testid=old.testid;\r\n \r\n   In the above statement, the trigger will only fire when an update is made to the \"info\" column instead of any column(s).\r\n\r\n   ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yipng","name":"yipng","emailAddress":"yipng168 at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yip Ng","active":true},"created":"2006-08-28T00:29:55.000+0000","updated":"2006-08-28T00:29:55.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1652/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06zvb:"}}