{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12536345","self":"https://issues.apache.org/jira/rest/api/latest/issue/12536345","key":"SOLR-2987","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319065","id":"12319065","description":"Major release after 3.5","name":"3.6","archived":false,"released":true,"releaseDate":"2012-04-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314992","id":"12314992","description":"Alpha release of 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-01-10 01:14:29.481","customfield_12312323":null,"customfield_12310420":"222028","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1503562210_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-01-10T22:51:35.405+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-2987/watchers","watchCount":0,"isWatching":false},"created":"2011-12-24T13:12:13.297+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317876","id":"12317876","description":"Major release after 3.4","name":"3.5","archived":false,"released":true,"releaseDate":"2011-11-27"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12319065","id":"12319065","description":"Major release after 3.5","name":"3.6","archived":false,"released":true,"releaseDate":"2012-04-12"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314992","id":"12314992","description":"Alpha release of 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:40:27.143+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310674","id":"12310674","name":"search","description":"Query the search collection"}],"timeoriginalestimate":null,"description":"The current error handling in reading an external file field only catches an error when parsing the float value on a line, which then skips that line.  If the key field is a trie field, such as a TrieIntField, and the key value in the file cannot be parsed to an int, loading of the entire file fails.  \r\n\r\nShouldn't the call to get the indexed value of the key should be in the same try/catch as the float parsing for the line?","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"18248","summary":"ExternalFileField With Invalid TrieField Key","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgarski","name":"mgarski","emailAddress":"mgarski at mac dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgarski&avatarId=14848","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgarski&avatarId=14848","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgarski&avatarId=14848","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgarski&avatarId=14848"},"displayName":"Michael Garski","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgarski","name":"mgarski","emailAddress":"mgarski at mac dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgarski&avatarId=14848","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgarski&avatarId=14848","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgarski&avatarId=14848","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgarski&avatarId=14848"},"displayName":"Michael Garski","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":5,"total":5,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536345/comment/13175730","id":"13175730","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgarski","name":"mgarski","emailAddress":"mgarski at mac dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgarski&avatarId=14848","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgarski&avatarId=14848","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgarski&avatarId=14848","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgarski&avatarId=14848"},"displayName":"Michael Garski","active":true},"body":"Stack trace that occurs with a line in the file such as '=34' where the key value is missing:\r\n\r\nDec 23, 2011 8:26:17 AM org.apache.solr.common.SolrException log\r\nSEVERE: java.lang.NumberFormatException: For input string: \"\"\r\n\tat java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\r\n\tat java.lang.Integer.parseInt(Integer.java:493)\r\n\tat java.lang.Integer.parseInt(Integer.java:514)\r\n\tat org.apache.solr.schema.TrieField.readableToIndexed(TrieField.java:314)\r\n\tat org.apache.solr.search.function.FileFloatSource.getFloats(FileFloatSource.java:258)\r\n\tat org.apache.solr.search.function.FileFloatSource.access$000(FileFloatSource.java:59)\r\n\tat org.apache.solr.search.function.FileFloatSource$2.createValue(FileFloatSource.java:130)\r\n\tat org.apache.solr.search.function.FileFloatSource$Cache.get(FileFloatSource.java:161)\r\n\tat org.apache.solr.search.function.FileFloatSource.getCachedFloats(FileFloatSource.java:124)\r\n\tat org.apache.solr.search.function.FileFloatSource.getValues(FileFloatSource.java:83)\r\n\tat org.apache.lucene.queries.function.valuesource.MultiFloatFunction.getValues(MultiFloatFunction.java:65)\r\n\tat org.apache.lucene.queries.function.valuesource.MultiFloatFunction.getValues(MultiFloatFunction.java:65)\r\n\tat org.apache.solr.search.DoubleParser$Function.getValues(ValueSourceParser.java:1056)\r\n\tat org.apache.lucene.queries.function.valuesource.MultiFloatFunction.getValues(MultiFloatFunction.java:65)\r\n\tat org.apache.lucene.queries.function.valuesource.MultiFloatFunction.getValues(MultiFloatFunction.java:65)\r\n\tat org.apache.lucene.queries.function.valuesource.MultiFloatFunction.getValues(MultiFloatFunction.java:65)\r\n\tat org.apache.lucene.queries.function.FunctionQuery$AllScorer.<init>(FunctionQuery.java:119)\r\n\tat org.apache.lucene.queries.function.FunctionQuery$FunctionWeight.scorer(FunctionQuery.java:94)\r\n\tat org.apache.lucene.search.BooleanQuery$BooleanWeight.scorer(BooleanQuery.java:317)\r\n\tat org.apache.lucene.search.FilteredQuery$1.scorer(FilteredQuery.java:153)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:581)\r\n\tat org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:354)\r\n\tat org.apache.solr.search.Grouping.execute(Grouping.java:351)\r\n\tat org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:495)\r\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:194)\r\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)\r\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1478)\r\n\tat org.apache.solr.core.QuerySenderListener.newSearcher(QuerySenderListener.java:59)\r\n\tat org.apache.solr.core.SolrCore$3.call(SolrCore.java:1255)\r\n\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)\r\n\tat java.lang.Thread.run(Thread.java:636)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgarski","name":"mgarski","emailAddress":"mgarski at mac dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgarski&avatarId=14848","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgarski&avatarId=14848","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgarski&avatarId=14848","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgarski&avatarId=14848"},"displayName":"Michael Garski","active":true},"created":"2011-12-24T14:21:27.653+0000","updated":"2011-12-24T14:21:27.653+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536345/comment/13176954","id":"13176954","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgarski","name":"mgarski","emailAddress":"mgarski at mac dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgarski&avatarId=14848","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgarski&avatarId=14848","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgarski&avatarId=14848","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgarski&avatarId=14848"},"displayName":"Michael Garski","active":true},"body":"Patch that moves key lookup to within same try/catch as the value parsing. Corrected exception message to include the field name.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mgarski","name":"mgarski","emailAddress":"mgarski at mac dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=mgarski&avatarId=14848","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=mgarski&avatarId=14848","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=mgarski&avatarId=14848","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=mgarski&avatarId=14848"},"displayName":"Michael Garski","active":true},"created":"2011-12-29T02:29:18.477+0000","updated":"2011-12-29T02:29:18.477+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536345/comment/13182977","id":"13182977","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"body":"Nice catch!\r\n\r\nThe only way I can generate this error is if the *keyfield* is a numeric type. Otherwise, with string types, it works just fine because when the line like \"=76.0\" is parsed, no attempt is made to convert the incoming key to anything. And since there are no terms in the index that match the empty string, this just gets collected as an error and logged. So your patch looks fine.\r\n\r\nI don't see a good way to test this though, at least not in a positive sense. I can include bogus entries in TestFunctionQuery for a start. I can add a test for an *numeric* type keyfield modeled on testExternalFileFieldStringKeys, call it testExternalFileFieldNumericKeys, leave off the key and see if it succeeds. But on a quick glance, I don't see a good way to verify that the errors are appropriately logged. Anyone want to weigh in on whether it's worth the effort?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"created":"2012-01-10T01:14:29.481+0000","updated":"2012-01-10T01:24:17.433+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536345/comment/13183660","id":"13183660","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"body":"Latest patch","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"created":"2012-01-10T22:48:16.628+0000","updated":"2012-01-10T22:48:16.628+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12536345/comment/13183664","id":"13183664","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"body":"Thanks Michael!\r\n\r\ntrunk: r-1229783\r\n3.x:   r-1229782","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=erickerickson","name":"erickerickson","emailAddress":"erickerickson at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Erick Erickson","active":true},"created":"2012-01-10T22:51:35.435+0000","updated":"2012-01-10T22:51:35.435+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-2987/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03hdj:"}}