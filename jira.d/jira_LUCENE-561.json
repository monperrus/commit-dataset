{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12332976","self":"https://issues.apache.org/jira/rest/api/latest/issue/12332976","key":"LUCENE-561","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310853","id":"12310853","description":"mostly 1.9 with deprecated items removed","name":"2.0.0","archived":false,"released":true,"releaseDate":"2006-05-26"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2006-05-19 07:40:00.0","customfield_12312323":null,"customfield_12310420":"13189","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1535538000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_611538000","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-05-19T23:40:52.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-561/watchers","watchCount":1,"isWatching":false},"created":"2006-05-02T05:08:34.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310853","id":"12310853","description":"mostly 1.9 with deprecated items removed","name":"2.0.0","archived":false,"released":true,"releaseDate":"2006-05-26"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2006-06-20T01:11:54.000+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310232","id":"12310232","name":"core/index","description":"issues with indexing code"}],"timeoriginalestimate":null,"description":"In using ParallelReader I've hit two bugs:\n\n1.  ParallelReader.doDelete() and doUndeleteAll() call doDelete() and doUndeleteAll() on the subreaders, but these methods do not set hasChanges.  Thus the changes are lost when the readers are closed.  The fix is to call deleteDocument() and undeleteAll() on the subreaders instead.\n\n2.  ParallelReader discovers the fields in each subindex by using IndexReader.getFieldNames() which only finds fields that have occurred on at least one document.  In general a parallel index is designed with assignments of fields to sub-indexes and term seeks (including searches) may be done on any of those fields, even if no documents in a particular state of the index have yet had an assigned field.  Seeks/searches on fields that have not yet been indexed generated an NPE in ParallelReader's various inner class seek() and next() methods because fieldToReader.get() returns null on the unseen field.  The fix is to extend the add() methods to supply the correct list of fields for each subindex.\n\nPatch that corrects both of these issues attached.\n","customfield_10010":null,"timetracking":{},"customfield_12310120":null,"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"27484","summary":"ParallelReader fails on deletes and on seeks of previously unused fields","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manawiz","name":"manawiz","emailAddress":"chuck at manawiz dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chuck Williams","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manawiz","name":"manawiz","emailAddress":"chuck at manawiz dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chuck Williams","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"All","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12332976/comment/12377339","id":"12377339","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manawiz","name":"manawiz","emailAddress":"chuck at manawiz dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chuck Williams","active":true},"body":"This new version of the patch provides a more general solution for the unknown field NPE problem (the solution for the delete problem is the same and is included in the new patch file).\r\n\r\nFor the NPE problem, the new patch handles the case of an unknown field explicitly in all ParallelReader API's for which it is relevant.  This is quite a few of them, but I think I got them all.\r\n\r\nThe first solution of specifying the field list for each reader was expedient in my applicaiton since all fields are pre-configured and validated on index operations.  However, for Lucene in general such field processing is not required.  E.g., with ParallelReader as it is in Lucene now and with the first version of the patch, a user-entered misspelled field name passed in a Query to search() generates an NPE instead of zero results.  With the new version of the patch, zero resutls are returned properly.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manawiz","name":"manawiz","emailAddress":"chuck at manawiz dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chuck Williams","active":true},"created":"2006-05-02T14:10:44.000+0000","updated":"2006-05-02T14:10:44.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12332976/comment/12412459","id":"12412459","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Chuck, I took a very quick scan, most of it looks fine.\r\nWhat about seek() calls though... if the reader is null, shouldn't termDocs be set to null?\r\n\r\n     public void seek(Term term) throws IOException {\r\n-      termDocs = ((IndexReader)fieldToReader.get(term.field())).termDocs(term);\r\n+      IndexReader reader = ((IndexReader)fieldToReader.get(term.field()));\r\n+      termDocs = reader!=null ? reader.termDocs(term) : null;\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2006-05-19T07:40:00.000+0000","updated":"2006-05-19T07:40:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12332976/comment/12412460","id":"12412460","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manawiz","name":"manawiz","emailAddress":"chuck at manawiz dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chuck Williams","active":true},"body":"Yonik, thanks for looking at this, and good catch!  If there are multiple seeks on the termDocs, one is performed on a known field and not iterated to exahaustion, and then a seek is performed on an unknown field, then without your fix I believe the unknown field would erroneously report remaining documents on the prior known field.\r\n\r\nIt appears nothing I've done hit this pariticular case!  Sorry I missed it...\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manawiz","name":"manawiz","emailAddress":"chuck at manawiz dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chuck Williams","active":true},"created":"2006-05-19T07:58:49.000+0000","updated":"2006-05-19T07:58:49.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12332976/comment/12412532","id":"12412532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"This patch also fixes another little bug... the previous behavior bypassed synchronization of deleteDocument in subreaders.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2006-05-19T22:58:06.000+0000","updated":"2006-05-19T22:58:06.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12332976/comment/12412535","id":"12412535","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Patch applied,  thanks Chuck!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2006-05-19T23:40:52.000+0000","updated":"2006-05-19T23:40:52.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12332976/comment/12416738","id":"12416738","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kohlschuetter","name":"kohlschuetter","emailAddress":"kohlschuetter at l3s dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Kohlschuetter","active":true},"body":"Chuck: Unfortunately, the NPE in seek/next can still be triggered.\r\nSee [#LUCENE-398] for Testcase and a suggested patch.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kohlschuetter","name":"kohlschuetter","emailAddress":"kohlschuetter at l3s dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian Kohlschuetter","active":true},"created":"2006-06-19T17:37:56.000+0000","updated":"2006-06-19T17:37:56.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12332976/comment/12416790","id":"12416790","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manawiz","name":"manawiz","emailAddress":"chuck at manawiz dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chuck Williams","active":true},"body":"Christian,\r\n\r\nThat is a different bug than this one.  This bug has been fixed.\r\n\r\nChuck\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=manawiz","name":"manawiz","emailAddress":"chuck at manawiz dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Chuck Williams","active":true},"created":"2006-06-20T01:11:54.000+0000","updated":"2006-06-20T01:11:54.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-561/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i052dz:"}}