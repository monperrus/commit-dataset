{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12329992","self":"https://issues.apache.org/jira/rest/api/latest/issue/12329992","key":"DERBY-1089","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312027","id":"12312027","description":"","name":"10.2.2.0","archived":false,"released":true,"releaseDate":"2006-12-19"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12312590","id":"12312590","description":"","name":"10.3.1.4","archived":false,"released":true,"releaseDate":"2007-08-10"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-03-11 11:47:45.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22300","customfield_12310222":"1_*:*_1_*:*_22442719000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_33221977730","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-11-23T20:45:13.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1089/watchers","watchCount":3,"isWatching":false},"created":"2006-03-09T02:39:54.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12310615","id":"12310615","description":"","name":"10.1.2.1","archived":false,"released":true,"releaseDate":"2005-11-18"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12314279","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12314279","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"inwardIssue":{"id":"12354214","key":"DERBY-2015","self":"https://issues.apache.org/jira/rest/api/2/issue/12354214","fields":{"summary":"NullPointerException in INSERT ... SELECT with self-joined table and IDENTITY column","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2007-12-13T09:04:50.728+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11408","id":"11408","name":"SQL"}],"timeoriginalestimate":null,"description":"I've been having a problem inserting the result of a join into a table with a generated column. If I rephrase the join clause into a where clause, the problem goes away. And it only seems to happen if the target table has a generated column. Unfortunately, the join that I want to do in my application is pretty complex so I don't think I can rephrase it. But here's a very simplified example of what I'm talking about:\n\nij version 10.1\nij> connect 'jdbc:derby:test;create=true';\nij> create table source (\nsource_id int not null primary key\n);\n0 rows inserted/updated/deleted\nij> insert into source values (0);\ninsert into source values (1);\ninsert into source values (2);\ninsert into source values (3);\ninsert into source values (4);\ninsert into source values (5);\ninsert into source values (6);\ninsert into source values (7);\ninsert into source values (8);\ninsert into source values (9);\n1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> 1 row inserted/updated/deleted\nij> create table dest (\ndest_id int not null primary key\n   generated always as identity,\nsource_id_1 int not null,\nsource_id_2 int not null\n);\n0 rows inserted/updated/deleted\nij> select s1.source_id, s2.source_id\nfrom source as s1\njoin source as s2\non 1 = 1;\nSOURCE_ID  |SOURCE_ID\n-----------------------\n0          |0\n0          |1\n0          |2\n0          |3\n0          |4\n0          |5\n0          |6\n0          |7\n0          |8\n0          |9\n1          |0\n1          |1\n1          |2\n1          |3\n1          |4\n1          |5\n1          |6\n1          |7\n1          |8\n1          |9\n2          |0\n2          |1\n2          |2\n2          |3\n2          |4\n2          |5\n2          |6\n2          |7\n2          |8\n2          |9\n3          |0\n3          |1\n3          |2\n3          |3\n3          |4\n3          |5\n3          |6\n3          |7\n3          |8\n3          |9\n4          |0\n4          |1\n4          |2\n4          |3\n4          |4\n4          |5\n4          |6\n4          |7\n4          |8\n4          |9\n5          |0\n5          |1\n5          |2\n5          |3\n5          |4\n5          |5\n5          |6\n5          |7\n5          |8\n5          |9\n6          |0\n6          |1\n6          |2\n6          |3\n6          |4\n6          |5\n6          |6\n6          |7\n6          |8\n6          |9\n7          |0\n7          |1\n7          |2\n7          |3\n7          |4\n7          |5\n7          |6\n7          |7\n7          |8\n7          |9\n8          |0\n8          |1\n8          |2\n8          |3\n8          |4\n8          |5\n8          |6\n8          |7\n8          |8\n8          |9\n9          |0\n9          |1\n9          |2\n9          |3\n9          |4\n9          |5\n9          |6\n9          |7\n9          |8\n9          |9\n\n100 rows selected\nij> insert into dest (source_id_1, source_id_2)\nselect s1.source_id, s2.source_id\nfrom source as s1\njoin source as s2\non 1 = 1;\n\nERROR XJ001: Java exception: ': java.lang.NullPointerException'.\nij>\n\n\n\nderby.log:\n\n----------------------------------------------------------------\n2006-03-07 20:01:12.152 GMT:\nBooting Derby version The Apache Software Foundation - Apache Derby - 10.1.2.1 - (330608): instance c013800d-0109-d64c-5067-000000172958\non database directory D:\\Documents and Settings\\***\\My Documents\\test\n\nDatabase Class Loader started - derby.database.classpath=''\n2006-03-07 20:01:52.671 GMT Thread[main,5,main] (XID = 124), (SESSIONID = 0), (DATABASE = test), (DRDAID = null), Cleanup action starting\n2006-03-07 20:01:52.671 GMT Thread[main,5,main] (XID = 124), (SESSIONID = 0), (DATABASE = test), (DRDAID = null), Failed Statement is: insert into dest (source_id_1, source_id_2)\nselect s1.source_id, s2.source_id\nfrom source as s1\njoin source as s2\non 1 = 1\njava.lang.NullPointerException\nat org.apache.derby.impl.sql.compile.ResultColumnList.remapColumnReferencesToExpressions(Unknown Source)\nat org.apache.derby.impl.sql.compile.JoinNode.flatten(Unknown Source)\nat org.apache.derby.impl.sql.compile.FromList.flattenFromTables(Unknown Source)\nat org.apache.derby.impl.sql.compile.SelectNode.preprocess(Unknown Source)\nat org.apache.derby.impl.sql.compile.SingleChildResultSetNode.preprocess(Unknown Source)\nat org.apache.derby.impl.sql.compile.DMLStatementNode.optimize(Unknown Source)\nat org.apache.derby.impl.sql.compile.DMLModStatementNode.optimize(Unknown Source)\nat org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\nat org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\nat org.apache.derby.impl.sql.conn.GenericLanguageConnectionContext.prepareInternalStatement(Unknown Source)\nat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\nat org.apache.derby.impl.jdbc.EmbedStatement.execute(Unknown Source)\nat org.apache.derby.impl.tools.ij.ij.executeImmediate(Unknown Source)\nat org.apache.derby.impl.tools.ij.utilMain.doCatch(Unknown Source)\nat org.apache.derby.impl.tools.ij.utilMain.go(Unknown Source)\nat org.apache.derby.impl.tools.ij.Main.go(Unknown Source)\nat org.apache.derby.impl.tools.ij.Main.mainCore(Unknown Source)\nat org.apache.derby.impl.tools.ij.Main14.main(Unknown Source)\nat org.apache.derby.tools.ij.main(Unknown Source)\nCleanup action completed\n\n2006-03-07 20:43:03.759 GMT:\nShutting down instance c013800d-0109-d64c-5067-000000172958\n----------------------------------------------------------------\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"39706","summary":"Derby fails inserting a join into a table with a generated column","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heartburn","name":"heartburn","emailAddress":"markboylan at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Boylan","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=heartburn","name":"heartburn","emailAddress":"markboylan at hotmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mark Boylan","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"WinXP","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":12,"total":12,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12369957","id":"12369957","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crimson","name":"crimson","emailAddress":"mhackett at kanayo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Hackett","active":true},"body":"I think I ran into the same issue today, and when I searched and found this entry, your explanation of the problem helped me come up with a work-around, at least for my situation.\r\n\r\nIf you can split your insert into two stages, first writing the joined data to a temporary table (which doesn't have a generated column), and then copying it out to the destination, that may work. Not an ideal solution by any means, but at least it gets past the roadblock.\r\n\r\nThanks, Mark, for isolating the conditions so well! I hope that will allow someone to track down the problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=crimson","name":"crimson","emailAddress":"mhackett at kanayo dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael Hackett","active":true},"created":"2006-03-11T11:47:45.000+0000","updated":"2006-03-11T11:47:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12378029","id":"12378029","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thod","name":"thod","emailAddress":"apache at seity dot co dot uk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim hodson","active":true},"body":"I also came across this problem today. A related but slightly easier way to get round it, certainly for my case, was to go for something like:\r\n\r\ninsert into table (a, b, c)\r\nselect * from (\r\nselect d, e, calced_f from somewhere\r\n) X\r\n\r\nie to wrap the SQL generating the data with \"select * from (...) x\". This seems to avoid the bug and also avoids having to create and then drop another table. \r\n\r\nThank you both for helping me identify and get round this!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=thod","name":"thod","emailAddress":"apache at seity dot co dot uk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Tim hodson","active":true},"created":"2006-05-05T20:33:46.000+0000","updated":"2006-05-05T20:33:46.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12449216","id":"12449216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Attached is remapSkipNullExpressions_v1.diff, a proposed patch\r\nfor this problem. When an INSERT ... SELECT statement inserts\r\na GENERATED ALWAYS identity column, the identity column's\r\ncolumn reference is NULL, since that column does not have a\r\ncorresponding column in the SELECT list. This NULL expression needs\r\nto be skipped over when remapping column references from the\r\nSELECT column list to the INSERT column list.\r\n\r\nThe patch includes a test. derbyall and suites.All were successful.\r\n\r\nPlease have a look and give me any feedback. Thanks!\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-11-13T01:05:04.000+0000","updated":"2006-11-13T01:05:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12449568","id":"12449568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"I think DERBY-2015 is a duplicate of this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-11-14T05:21:34.000+0000","updated":"2006-11-14T05:21:34.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12450033","id":"12450033","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"I tried this patch on 10.1, 10.2 and 10.3. With the exception of offsets in the 10.1 branch, everything applied cleanly and I was able to build Derby.\r\n\r\nTest results (all with Java SE 5):\r\n 10.3 (475016M): No failures.\r\n 10.2: derbyall OK, many failures due to permissions for suites.All.\r\n 10.1:  derbynet/dataSourcePermissions_net.java, derbynet/testSecMec.java and unit/T_Diagnosticable.unit failed (probably unrelated, have not investigated).\r\n\r\nPatch looks good, but my knowledge of the area of the code is very limited. Another opinion would be good.\r\n\r\nA little nit: There's a mix of tabs and spaces on two of the lines added by the patch (after the if).\r\n\r\nTaken that this patch is a small change to the code, should we merge it to the earlier branches?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2006-11-15T14:02:26.000+0000","updated":"2006-11-15T14:02:26.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12450075","id":"12450075","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Kristian for the review and the testing, it is very helpful. I will fix the tab/space issue prior to committing the change.\r\n\r\nYour suggestion about merging the fix to prior branches is good; I'll at least merge it to 10.2 for sure.\r\n\r\nI'll wait a bit longer to see if there are other comments on the patch. If not, I'll submit it later this week.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-11-15T15:45:28.000+0000","updated":"2006-11-15T15:45:28.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12450452","id":"12450452","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chdh%40inventec.ch","name":"chdh@inventec.ch","emailAddress":"chdh at inventec dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian d'Heureuse","active":true},"body":"Bryan, there are more places in ResultColumnList.java where\r\n  x.getExpression().y()\r\nis called without testing whether x.getExpression() is null.\r\n\r\nThese places are at the following lines in ResultColumnList.java:\r\n 1616  sourceRC.getExpression().setType(resultColumn.getTypeServices());\r\n 1875: resultColumn.getExpression().getClass().getName());\r\n 1879  ((VirtualColumnNode) resultColumn.getExpression()).columnId += adjust;\r\n 2848  if (! rc.getExpression().isCloneable())\r\n 2871  rc.setExpression(rc.getExpression().remapColumnReferencesToExpressions());\r\n     (this is fixed by your patch)\r\n\r\nMaybe it would be reasonable to fix these too?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=chdh%40inventec.ch","name":"chdh@inventec.ch","emailAddress":"chdh at inventec dot ch","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Christian d'Heureuse","active":true},"created":"2006-11-16T16:40:03.000+0000","updated":"2006-11-16T16:40:03.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12450570","id":"12450570","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Thanks Christian! I will investigate these usages.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-11-16T23:23:57.000+0000","updated":"2006-11-16T23:23:57.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12451805","id":"12451805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Hi Christian,\r\n\r\nI spent some time studying the code that you identified, and I set up various experiments to learn how those various lines of code get executed. In all the cases that I could construct, there was no way that I could see to arrive at these lines with a column which is GENERATED ALWAYS. \r\n\r\nI agree with you that the unguarded reference to rc.getExpression() is a concern since we know that in some cases (namely GENERATED ALWAYS columns) it can be null.\r\n\r\nHowever, without a way to actually cause the execution path to reach one of these lines of code with a NULL ResultColumn.expression, I am reluctant to change them.\r\n\r\nMy preference for now is to leave those lines as they are.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-11-21T22:56:45.000+0000","updated":"2006-11-21T22:56:45.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12452293","id":"12452293","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Committed remapSkipNullExpressions_v1.diff to the trunk as revision 478622.\r\n\r\nI intend to merge this change to 10.2 and commit it there as well.\r\n\r\nI also intend to mark DERBY-2015 as a duplicate of this issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-11-23T17:30:42.000+0000","updated":"2006-11-23T17:30:42.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12452325","id":"12452325","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"body":"Merged the trunk patch to the 10.2 branch as revision 478658.\r\n\r\nMarked the issue resolved and cleared Patch Available.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bryanpendleton","name":"bryanpendleton","emailAddress":"bpendleton dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bryan Pendleton","active":true},"created":"2006-11-23T20:45:13.000+0000","updated":"2006-11-23T20:45:13.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12329992/comment/12551322","id":"12551322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"body":"This issue has been resolved for over a year with no further movement. Closing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fuzzylogic","name":"fuzzylogic","emailAddress":"mcintyre dot a at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Andrew McIntyre","active":true},"created":"2007-12-13T09:04:50.724+0000","updated":"2007-12-13T09:04:50.724+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1089/votes","votes":2,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i075sv:"}}