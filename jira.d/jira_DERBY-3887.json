{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12405427","self":"https://issues.apache.org/jira/rest/api/latest/issue/12405427","key":"DERBY-3887","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313401","id":"12313401","description":"Head of 10.4 branch","name":"10.4.2.1","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/12314116","id":"12314116","description":"10.5.2 Release July 30 2009 (794445) Now deprecated","name":"10.5.2.0","archived":false,"released":true,"releaseDate":"2009-07-30"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12313727","id":"12313727","description":"Feature release","name":"10.6.1.0","archived":false,"released":true,"releaseDate":"2010-05-18"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2008-10-04 00:17:39.412","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"23900","customfield_12310222":"1_*:*_1_*:*_22458128422_*|*_5_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-06-16T21:27:25.026+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3887/watchers","watchCount":4,"isWatching":false},"created":"2008-09-29T23:05:16.604+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"3.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313345","id":"12313345","description":"","name":"10.4.2.0","archived":false,"released":true,"releaseDate":"2008-09-05"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12321910","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12321910","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12388932","key":"DERBY-3429","self":"https://issues.apache.org/jira/rest/api/2/issue/12388932","fields":{"summary":"Remove system property derby.system.jmx","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}},{"id":"12331624","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12331624","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12463195","key":"DERBY-4634","self":"https://issues.apache.org/jira/rest/api/2/issue/12463195","fields":{"summary":"Error Message when launching Derby (SEVERE JDBC ERROR)","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}},{"id":"12322284","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12322284","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12399325","key":"DERBY-3745","self":"https://issues.apache.org/jira/rest/api/2/issue/12399325","fields":{"summary":"Derby can leak classloaders in an app server environment","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2011-01-21T17:52:07.406+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12312171","id":"12312171","name":"JMX","description":"Management issues for Derby using the JMX framework"}],"timeoriginalestimate":null,"description":"I'm trying to use embedded Derby as datasource for JBoss and found that it fails with error.\r\nSee stacktrace below.\r\nIt looks like JMX module in Derby conflicts with JBoss JMX.\r\nAfter I have disabled Derby JMX removing \"derby.module.mgmt.jmx=org.apache.derby.impl.services.jmx.JMXManagementService\" line from org\\apache\\derby\\modules.properties file in derby.jar JAR, the bug disappears.\r\n\r\nHow to reproduce the issue:\r\n1). Install JBoss\r\n2). Copy jboss\\docs\\examples\\varia\\derby-plugin.jar into jboss\\server\\default\\lib\r\n3). Copy Derby JAR (derby.jar) into jboss\\server\\default\\lib\r\n4). Copy datasource file into jboss\\server\\default\\lib\r\n5). Start JBoss using bin\\run.bat\r\n\r\n\r\nDatasource file (zzzzz-ds.xml):\r\n\r\n==={{{\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!DOCTYPE datasources\r\n        PUBLIC \"-//JBoss//DTD JBOSS JCA Config 1.5//EN\"\r\n        \"http://www.jboss.org/j2ee/dtd/jboss-ds_1_5.dtd\">\r\n\r\n<datasources>\r\n    <local-tx-datasource>\r\n        <jndi-name>zzzzzDatasource</jndi-name>\r\n        <driver-class>org.apache.derby.jdbc.EmbeddedDriver</driver-class>\r\n        <!--connection-url>jdbc:derby:${jboss.server.data.dir}{/}derby{/}zzzzz;create=true</connection-url-->\r\n        <connection-url>jdbc:derby:IGNORED</connection-url>\r\n        <user-name>IGNORED</user-name>\r\n        <password>IGNORED</password>\r\n        <min-pool-size>5</min-pool-size>\r\n        <max-pool-size>20</max-pool-size>\r\n        <idle-timeout-minutes>5</idle-timeout-minutes>\r\n        <track-statements/>\r\n        <depends>jboss:service=zzzzzDerbyDB</depends>\r\n    </local-tx-datasource>\r\n    \r\n    <!-- Don't forget to install derby-plugin.jar and derby*.jar into jboss/server/default/lib -->\r\n    <mbean code=\"org.jboss.jdbc.DerbyDatabase\" name=\"jboss:service=zzzzzDerbyDB\">\r\n        <attribute name=\"Database\">zzzzz</attribute>\r\n        <attribute name=\"User\">sa</attribute>\r\n        <attribute name=\"Password\"></attribute>\r\n    </mbean>\r\n\r\n</datasources>\r\n===}}}\r\n\r\n\r\nPart of JBoss log with error and stacktrace:\r\n\r\n==={{{\r\n02:40:28,031 INFO  [DerbyDatabase] starting derby jdbc:derby:C:\\opt\\jboss-4.2.3.GA\\server\\default\\data/derby/zzzzz;create=true\r\n02:40:28,468 WARN  [ServiceController] Problem starting service jboss:service=zzzzzDerbyDB\r\njava.lang.ExceptionInInitializerError\r\n        at java.lang.Class.forName0(Native Method)\r\n        at java.lang.Class.forName(Class.java:247)\r\n        at org.jboss.jdbc.DerbyDatabase.getConnection(DerbyDatabase.java:222)\r\n        at org.jboss.jdbc.DerbyDatabase.startService(DerbyDatabase.java:189)\r\n        at org.jboss.system.ServiceMBeanSupport.jbossInternalStart(ServiceMBeanSupport.java:289)\r\n        at org.jboss.system.ServiceMBeanSupport.jbossInternalLifecycle(ServiceMBeanSupport.java:245)\r\n        at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155)\r\n        at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:86)\r\n        at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264)\r\n        at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)\r\n        at org.jboss.system.ServiceController$ServiceProxy.invoke(ServiceController.java:978)\r\n        at $Proxy0.start(Unknown Source)\r\n        at org.jboss.system.ServiceController.start(ServiceController.java:417)\r\n        at sun.reflect.GeneratedMethodAccessor9.invoke(Unknown Source)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155)\r\n        at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:86)\r\n        at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264)\r\n        at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)\r\n        at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210)\r\n        at $Proxy4.start(Unknown Source)\r\n        at org.jboss.deployment.SARDeployer.start(SARDeployer.java:304)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155)\r\n        at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94)\r\n        at org.jboss.mx.interceptor.AbstractInterceptor.invoke(AbstractInterceptor.java:133)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:88)\r\n        at org.jboss.mx.interceptor.ModelMBeanOperationInterceptor.invoke(ModelMBeanOperationInterceptor.java:142)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:88)\r\n        at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264)\r\n        at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)\r\n        at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210)\r\n        at $Proxy42.start(Unknown Source)\r\n        at org.jboss.deployment.XSLSubDeployer.start(XSLSubDeployer.java:197)\r\n        at org.jboss.deployment.MainDeployer.start(MainDeployer.java:1025)\r\n        at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:819)\r\n        at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:782)\r\n        at sun.reflect.GeneratedMethodAccessor21.invoke(Unknown Source)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155)\r\n        at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94)\r\n        at org.jboss.mx.interceptor.AbstractInterceptor.invoke(AbstractInterceptor.java:133)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:88)\r\n        at org.jboss.mx.interceptor.ModelMBeanOperationInterceptor.invoke(ModelMBeanOperationInterceptor.java:142)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:88)\r\n        at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264)\r\n        at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)\r\n        at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210)\r\n        at $Proxy9.deploy(Unknown Source)\r\n        at org.jboss.deployment.scanner.URLDeploymentScanner.deploy(URLDeploymentScanner.java:421)\r\n        at org.jboss.deployment.scanner.URLDeploymentScanner.scan(URLDeploymentScanner.java:634)\r\n        at org.jboss.deployment.scanner.AbstractDeploymentScanner$ScannerThread.doScan(AbstractDeploymentScanner.java:263)\r\n        at org.jboss.deployment.scanner.AbstractDeploymentScanner.startService(AbstractDeploymentScanner.java:336)\r\n        at org.jboss.system.ServiceMBeanSupport.jbossInternalStart(ServiceMBeanSupport.java:289)\r\n        at org.jboss.system.ServiceMBeanSupport.jbossInternalLifecycle(ServiceMBeanSupport.java:245)\r\n        at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155)\r\n        at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:86)\r\n        at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264)\r\n        at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)\r\n        at org.jboss.system.ServiceController$ServiceProxy.invoke(ServiceController.java:978)\r\n        at $Proxy0.start(Unknown Source)\r\n        at org.jboss.system.ServiceController.start(ServiceController.java:417)\r\n        at sun.reflect.GeneratedMethodAccessor9.invoke(Unknown Source)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155)\r\n        at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:86)\r\n        at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264)\r\n        at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)\r\n        at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210)\r\n        at $Proxy4.start(Unknown Source)\r\n        at org.jboss.deployment.SARDeployer.start(SARDeployer.java:304)\r\n        at org.jboss.deployment.MainDeployer.start(MainDeployer.java:1025)\r\n        at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:819)\r\n        at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:782)\r\n        at org.jboss.deployment.MainDeployer.deploy(MainDeployer.java:766)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\r\n        at java.lang.reflect.Method.invoke(Method.java:597)\r\n        at org.jboss.mx.interceptor.ReflectedDispatcher.invoke(ReflectedDispatcher.java:155)\r\n        at org.jboss.mx.server.Invocation.dispatch(Invocation.java:94)\r\n        at org.jboss.mx.interceptor.AbstractInterceptor.invoke(AbstractInterceptor.java:133)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:88)\r\n        at org.jboss.mx.interceptor.ModelMBeanOperationInterceptor.invoke(ModelMBeanOperationInterceptor.java:142)\r\n        at org.jboss.mx.server.Invocation.invoke(Invocation.java:88)\r\n        at org.jboss.mx.server.AbstractMBeanInvoker.invoke(AbstractMBeanInvoker.java:264)\r\n        at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)\r\n        at org.jboss.mx.util.MBeanProxyExt.invoke(MBeanProxyExt.java:210)\r\n        at $Proxy5.deploy(Unknown Source)\r\n        at org.jboss.system.server.ServerImpl.doStart(ServerImpl.java:482)\r\n        at org.jboss.system.server.ServerImpl.start(ServerImpl.java:362)\r\n        at org.jboss.Main.boot(Main.java:200)\r\n        at org.jboss.Main$1.run(Main.java:508)\r\n        at java.lang.Thread.run(Thread.java:619)\r\nCaused by: javax.management.JMRuntimeException: Failed to load MBeanServerBuilder class org.jboss.mx.server.MBeanServerBuilderImpl: java.lang.ClassNotFoundException: org/jboss/mx/server/MBeanServerBuilderImpl\r\n        at javax.management.MBeanServerFactory.checkMBeanServerBuilder(MBeanServerFactory.java:480)\r\n        at javax.management.MBeanServerFactory.getNewMBeanServerBuilder(MBeanServerFactory.java:511)\r\n        at javax.management.MBeanServerFactory.newMBeanServer(MBeanServerFactory.java:298)\r\n        at javax.management.MBeanServerFactory.createMBeanServer(MBeanServerFactory.java:213)\r\n        at javax.management.MBeanServerFactory.createMBeanServer(MBeanServerFactory.java:174)\r\n        at sun.management.ManagementFactory.createPlatformMBeanServer(ManagementFactory.java:302)\r\n        at java.lang.management.ManagementFactory.getPlatformMBeanServer(ManagementFactory.java:504)\r\n        at org.apache.derby.impl.services.jmx.JMXManagementService$3.run(Unknown Source)\r\n        at org.apache.derby.impl.services.jmx.JMXManagementService$3.run(Unknown Source)\r\n        at java.security.AccessController.doPrivileged(Native Method)\r\n        at org.apache.derby.impl.services.jmx.JMXManagementService.findServer(Unknown Source)\r\n        at org.apache.derby.impl.services.jmx.JMXManagementService.boot(Unknown Source)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.boot(Unknown Source)\r\n        at org.apache.derby.impl.services.monitor.TopService.bootModule(Unknown Source)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.startModule(Unknown Source)\r\n        at org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Unknown Source)\r\n        at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(Unknown Source)\r\n        at org.apache.derby.impl.services.monitor.FileMonitor.<init>(Unknown Source)\r\n        at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Unknown Source)\r\n        at org.apache.derby.iapi.jdbc.JDBCBoot.boot(Unknown Source)\r\n        at org.apache.derby.jdbc.EmbeddedDriver.boot(Unknown Source)\r\n        at org.apache.derby.jdbc.EmbeddedDriver.<clinit>(Unknown Source)\r\n        ... 110 more\r\nCaused by: java.lang.ClassNotFoundException: org/jboss/mx/server/MBeanServerBuilderImpl\r\n        at java.lang.Class.forName0(Native Method)\r\n        at java.lang.Class.forName(Class.java:169)\r\n        at javax.management.MBeanServerFactory.loadBuilderClass(MBeanServerFactory.java:427)\r\n        at javax.management.MBeanServerFactory.checkMBeanServerBuilder(MBeanServerFactory.java:465)\r\n        ... 131 more\r\n02:40:29,250 INFO  [ConnectionFactoryBindingService] Bound ConnectionManager 'jboss.jca:service=DataSourceBinding,name=DefaultDS' to JNDI name 'java:DefaultDS'\r\n02:40:29,562 INFO  [A] Bound to JNDI name: queue/A\r\n02:40:29,562 INFO  [B] Bound to JNDI name: queue/B\r\n02:40:29,562 INFO  [C] Bound to JNDI name: queue/C\r\n02:40:29,562 INFO  [D] Bound to JNDI name: queue/D\r\n02:40:29,578 INFO  [ex] Bound to JNDI name: queue/ex\r\n02:40:29,593 INFO  [testTopic] Bound to JNDI name: topic/testTopic\r\n02:40:29,593 INFO  [securedTopic] Bound to JNDI name: topic/securedTopic\r\n02:40:29,609 INFO  [testDurableTopic] Bound to JNDI name: topic/testDurableTopic\r\n02:40:29,609 INFO  [testQueue] Bound to JNDI name: queue/testQueue\r\n02:40:29,656 INFO  [UILServerILService] JBossMQ UIL service available at : /127.0.0.1:8093\r\n02:40:29,703 INFO  [DLQ] Bound to JNDI name: queue/DLQ\r\n02:40:29,875 INFO  [ConnectionFactoryBindingService] Bound ConnectionManager 'jboss.jca:service=ConnectionFactoryBinding,name=JmsXA' to JNDI name 'java:JmsXA'\r\n02:40:30,093 INFO  [TomcatDeployer] deploy, ctxPath=/jmx-console, warUrl=.../deploy/jmx-console.war/\r\n02:40:30,250 ERROR [URLDeploymentScanner] Incomplete Deployment listing:\r\n\r\n--- MBeans waiting for other MBeans ---\r\nObjectName: jboss:service=zzzzzDerbyDB\r\n  State: FAILED\r\n  Reason: java.lang.ExceptionInInitializerError\r\n  Depends On Me:\r\n    jboss.jca:service=ManagedConnectionFactory,name=zzzzzDatasource\r\n\r\n--- MBEANS THAT ARE THE ROOT CAUSE OF THE PROBLEM ---\r\nObjectName: jboss:service=zzzzzDerbyDB\r\n  State: FAILED\r\n  Reason: java.lang.ExceptionInInitializerError\r\n  Depends On Me:\r\n    jboss.jca:service=ManagedConnectionFactory,name=zzzzzDatasource\r\n\r\n\r\n02:40:30,656 INFO  [Http11AprProtocol] Starting Coyote HTTP/1.1 on http-127.0.0.1-8080\r\n02:40:30,687 INFO  [AjpAprProtocol] Starting Coyote AJP/1.3 on ajp-127.0.0.1-8009\r\n02:40:30,703 INFO  [Server] JBoss (MX MicroKernel) [4.2.3.GA (build: SVNTag=JBoss_4_2_3_GA date=200807181439)] Started in 23s:375ms","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10420","value":"Regression","id":"10420"}],"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"37266","summary":"Embedded Derby fails under JBoss because of JMX-related conflicts","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vkhromov","name":"vkhromov","emailAddress":"valery dot khromov at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Valery Khromov","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10422","value":"High Value Fix","id":"10422"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vkhromov","name":"vkhromov","emailAddress":"valery dot khromov at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Valery Khromov","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Windows XP SP2, JBoss 4.2.3.GA, Embedder Derby 10.4.2.0.\r\nAlso tested with JBoss 5.0.0.CR2 with the same result.","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":16,"total":16,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12636778","id":"12636778","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Derby will try to start a JMX server. Looking at the Javadoc for MBeanServerFactory,\r\nhttp://java.sun.com/j2ee/1.4/docs/api/javax/management/MBeanServerFactory.html\r\n I notice that the property javax.management.builder.initial, if set, will be used to decide which builder\r\nto use for the MBeansServer. A possibility is that your environment defines this property\r\nto the missing class \"org.jboss.mx.server.MBeanServerBuilderImpl\", and that class is not\r\non your classpath. Could this be your problem? \r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-10-04T00:17:39.412+0000","updated":"2008-10-04T00:17:39.412+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12637102","id":"12637102","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nlmarco","name":"nlmarco","emailAddress":"Marco at NightLabs dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marco","active":true},"body":"We - http://www.jfire.org - have the same problem and assume that it is a caused by the deployment configuration: Because we use Derby for JBoss' messaging (JBossMQ), we have to put derby.jar into the lib directory (otherwise the JBossMQ fails with exceptions). However, the JMX seems to be in JBoss' deploy directory and therefore Derby has no chance to ever find the class (didn't verify this - just an assumption).\r\n\r\nAdditionally, it might be a problem with timing:  When Derby is loaded, maybe the JMX is not yet started?\r\n\r\nI don't know the best solution to this problem, but I know that we don't need JMX. That's why we deactivated this line mentioned above. However, patching a libraries JAR is not a nice way. Therefore, I'd like to ask for another - more convenient solution:\r\n\r\n1) Instead of an exception, it should simply log a warning and continue (JMX isn't really essential - is it?).\r\n2) It should be possible to provide a system property which deactivates the JMX hooking on startup (to get rid of the WARN log).\r\n\r\nIn the long run, it would be nice to have a clean solution that takes the said problems (deployment location + timing) into account.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=nlmarco","name":"nlmarco","emailAddress":"Marco at NightLabs dot de","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Marco","active":true},"created":"2008-10-06T14:22:34.043+0000","updated":"2008-10-06T14:22:34.043+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12637105","id":"12637105","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Added a link to DERBY-3429, as it contains some discussion regarding disabling/enabling JMX.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2008-10-06T14:26:48.683+0000","updated":"2008-10-06T14:26:48.683+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12637344","id":"12637344","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"I found this code fragment in org.apache.derby.impl.services.jmx#findServer,\r\nnotice the catch clause comment:\r\n\r\n        try {\r\n            mbeanServer = AccessController\r\n                    .doPrivileged(new PrivilegedAction<MBeanServer>() {\r\n                        public MBeanServer run() {\r\n                            return ManagementFactory.getPlatformMBeanServer();\r\n                        }\r\n                    });\r\n            \r\n        } catch (SecurityException se) {\r\n            // Ignoring inability to create or\r\n            // find the mbean server. MBeans can continue\r\n            // to be registered with this service and\r\n            // startMangement() can be called to get\r\n            // them registered with JMX if someone else\r\n            // starts the MBean server.\r\n\r\nPerhaps this ignore action should apply to the classNotFoundException, too?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2008-10-07T01:27:01.695+0000","updated":"2008-10-07T01:27:01.695+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12646351","id":"12646351","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgustie","name":"jgustie","emailAddress":"jeremy at gustie dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Gustie","active":true},"body":"I have been seeing this issue as well, after a little poking around it appears that the JBoss classloader which contains the \"missing\" JBoss server builder is temporarily taken out of context by the DERBY-3745 fix (which sets the context class loader to null) in the JMXManagementService.\r\n\r\nThe \"org.jboss.mx.server.MBeanServerBuilderImpl\" class identified by the \"javax.management.builder.initial\" system property actually lives in the \"JBOSS_HOME/lib/jboss-jmx.jar\" JAR; this class is available on classloader being taken out of context by the DERBY-3745 fix.\r\n\r\nWhat is not clear to me is why the platform MBean server isn't set by JBoss before this code executes: my guess is that this error is occurring before JBoss has fully initialized. If the ManagementFactory.getPlatformMBeanServer gets called anytime before Derby attempts to call it with a null context classloader this might not be a problem since the already created MBeanServerImpl instance would just be returned - like I said, if JBoss is not fully initialized this might not be possible. I'm not familiar enough with JMX or the JBoss implementation to know where this issue would need to be addressed (i.e. is this a JBoss or Derby issue). I don't think that ignoring the ClassNotFoundException would resolve the issue because you may end up masking other problems and making very difficult to track down why the management beans aren't being registered.\r\n\r\nIf you are running JBoss with a security manager, you could in theory deny the Derby JMXManagementService the \"setContextClassLoader\" runtime permission; that would prevent the classloader from being taken out of context (and Derby will silently eat the security exception in the name of backwards compatibility). I'm not sure what other problems that causes though (I haven't tried it).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgustie","name":"jgustie","emailAddress":"jeremy at gustie dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Gustie","active":true},"created":"2008-11-10T20:20:41.850+0000","updated":"2008-11-10T20:20:41.850+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12646592","id":"12646592","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgustie","name":"jgustie","emailAddress":"jeremy at gustie dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Gustie","active":true},"body":"You can enable JBoss to act as the platform MBean server on Java 5+ runtimes using the \"jboss.platform.mbeanserver\" system property (add it to the JBoss run script in the JAVA_OPTS variable). See JBAS-1610 on the JBoss JIRA site. Doing this will ensure that ManagementFactory.getPlatformMBeanServer returns the JBoss MBeanServerImpl instead of trying to create a new one with implementations that are not available.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jgustie","name":"jgustie","emailAddress":"jeremy at gustie dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jeremy Gustie","active":true},"created":"2008-11-11T16:51:30.805+0000","updated":"2008-11-11T16:51:30.805+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12650698","id":"12650698","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnemb","name":"johnemb","emailAddress":"johnemb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John H. Embretsen","active":true},"body":"Some possibly useful reading material for anyone wanting to investigate further:\r\nhttp://blogs.sun.com/jmxetc/entry/the_mystery_of_multiple_mbeanservers","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=johnemb","name":"johnemb","emailAddress":"johnemb at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"John H. Embretsen","active":true},"created":"2008-11-25T19:34:32.505+0000","updated":"2008-11-25T19:34:32.505+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12718910","id":"12718910","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I am thinking I should back out the JMX portiion of the fix for DERBY-3745 to correct this issue, to get rid of the regression and file a new issue for the potential classloader leak that can occur if that fix is backed out.  I will keep the rest of the DERBY-3745 fix as nobody has complained about any issues with that.  Any objections?\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-06-12T17:25:17.566+0000","updated":"2009-06-12T17:25:17.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12718926","id":"12718926","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Here is the patch to back out the JMX related portion of DERBY-3745.   I  am running tests now.   I don't have a reproduction for DERBY-3887, so I would appreciate someone who is seeing this issue could give this patch a try.\r\n\r\nThanks\r\n\r\nKathey","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-06-12T18:11:31.618+0000","updated":"2009-06-12T18:11:31.618+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12719017","id":"12719017","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Tests ran fine.  Marking patch available.  I'll check in as soon as I hear feedback on whether it corrects the issue.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-06-12T23:11:17.897+0000","updated":"2009-06-12T23:11:17.897+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12720358","id":"12720358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"committed change to 10.6,10.5, and 10.4.     I hope some JBOSS users can confirm this  fix. I will file a new issue for the apparent JMX related class loader leak after a bit more research.  \r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-06-16T21:27:24.909+0000","updated":"2009-06-16T21:27:24.909+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12720943","id":"12720943","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"Attached is a reproduction for this issue.  Without the fix, it fails with:\r\nException in thread \"main\" java.lang.ExceptionInInitializerError\r\n\tat java.lang.J9VMInternals.initialize(J9VMInternals.java:222)\r\n\tat java.lang.Class.forNameImpl(Native Method)\r\n\tat java.lang.Class.forName(Class.java:136)\r\n\tat Derby3887.main(Derby3887.java:6)\r\nCaused by: javax.management.JMRuntimeException: Failed to load MBeanServerBuilder class Derby3887: java.lang.ClassNotFoundException: Derby3887\r\n\tat javax.management.MBeanServerFactory.checkMBeanServerBuilder(MBeanServerFactory.java:491)\r\n\tat javax.management.MBeanServerFactory.getNewMBeanServerBuilder(MBeanServerFactory.java:522)\r\n\tat javax.management.MBeanServerFactory.newMBeanServer(MBeanServerFactory.java:309)\r\n\tat javax.management.MBeanServerFactory.createMBeanServer(MBeanServerFactory.java:224)\r\n\tat javax.management.MBeanServerFactory.createMBeanServer(MBeanServerFactory.java:185)\r\n\tat java.lang.management.ManagementFactory.getPlatformMBeanServer(ManagementFactory.java:298)\r\n\tat org.apache.derby.impl.services.jmx.JMXManagementService$3.run(JMXManagementService.java:207)\r\n\tat org.apache.derby.impl.services.jmx.JMXManagementService$3.run(JMXManagementService.java:205)\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:202)\r\n\tat org.apache.derby.impl.services.jmx.JMXManagementService.findServer(JMXManagementService.java:204)\r\n\tat org.apache.derby.impl.services.jmx.JMXManagementService.boot(JMXManagementService.java:114)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2021)\r\n\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:291)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:573)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.startSystemModule(Monitor.java:366)\r\n\tat org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(BaseMonitor.java:398)\r\n\tat org.apache.derby.impl.services.monitor.FileMonitor.<init>(FileMonitor.java:60)\r\n\tat org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Monitor.java:289)\r\n\tat org.apache.derby.iapi.jdbc.JDBCBoot.boot(JDBCBoot.java:69)\r\n\tat org.apache.derby.jdbc.EmbeddedDriver.boot(EmbeddedDriver.java:201)\r\n\tat org.apache.derby.jdbc.EmbeddedDriver.<clinit>(EmbeddedDriver.java:96)\r\n\tat java.lang.J9VMInternals.initializeImpl(Native Method)\r\n\tat java.lang.J9VMInternals.initialize(J9VMInternals.java:200)\r\n\t... 3 more\r\nCaused by: java.lang.ClassNotFoundException: Derby3887\r\n\tat java.lang.Class.forName(Class.java:136)\r\n\tat javax.management.MBeanServerFactory.loadBuilderClass(MBeanServerFactory.java:438)\r\n\tat javax.management.MBeanServerFactory.checkMBeanServerBuilder(MBeanServerFactory.java:476)\r\n\t... 25 more\r\n\r\nand I confirmed it passes with the fix.   I will look at getting this checked in as a regression test, but will still leave this issue in a resolved state since the code fix is checked in.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-06-17T22:14:36.345+0000","updated":"2009-06-17T22:14:36.345+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12720998","id":"12720998","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I found that I am able to make a JUnit test based on the repro which will fail without my change but pass with it, but I can only get it to fail (with the old code) if it is run as the first test.   If other tests booting derby are run prior to this one in the same JVM, I think a successful call to getPlatformMBeanServer() has already been made and thus registered, so the call to getPlatformMBeanServer() is successful.\r\n\r\nI did not immediately see a way to clear the platformMBeanServer.  Please let me know if you know of one.  Otherwise I think I will work on trying to make a call to launch a Junit test in another JVM, which I need for the store recover tests anyway.\r\n\r\nAttached is derby-3887_test_attempt_diff.txt with my initial attempt.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-06-18T00:06:47.551+0000","updated":"2009-06-18T00:06:47.551+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12721735","id":"12721735","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vkhromov","name":"vkhromov","emailAddress":"valery dot khromov at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Valery Khromov","active":true},"body":"Hi Kathey,\r\n\r\nI'd like to test the fix.\r\nIt there a binary build available with this patch?\r\nLatest Derby at http://www.apache.org/dist/db/derby/db-derby-current-bin.tar.gz is 10.5.1.1.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=vkhromov","name":"vkhromov","emailAddress":"valery dot khromov at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Valery Khromov","active":true},"created":"2009-06-19T10:59:59.976+0000","updated":"2009-06-19T10:59:59.976+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12721739","id":"12721739","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"body":"You could try the binaries used in the nightly testing of the 10.5 branch, found here: http://dbtg.thresher.com/derby/bits/10.5/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=knutanders","name":"knutanders","emailAddress":"knut dot hatlen at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Knut Anders Hatlen","active":true},"created":"2009-06-19T11:07:14.414+0000","updated":"2009-06-19T11:07:14.414+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12405427/comment/12871572","id":"12871572","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"body":"Some JBoss users might find this blog entry helpful: http://alistairisrael.wordpress.com/2009/03/31/creating-derby-datasource-in-jboss/\r\n\r\nWhat's the status on the fix?\r\nHas it been confirmed?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kristwaa","name":"kristwaa","emailAddress":"kristwaa at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=kristwaa&avatarId=14736","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kristwaa&avatarId=14736","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kristwaa&avatarId=14736","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kristwaa&avatarId=14736"},"displayName":"Kristian Waagan","active":true},"created":"2010-05-26T08:57:16.986+0000","updated":"2010-05-26T08:57:16.986+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-3887/votes","votes":4,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06qqn:"}}