{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12334154","self":"https://issues.apache.org/jira/rest/api/latest/issue/12334154","key":"DERBY-1323","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2006-05-16 18:29:00.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22436","customfield_12310222":"1_*:*_1_*:*_939230000_*|*_6_*:*_1_*:*_0_*|*_5_*:*_1_*:*_1219915000","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2006-05-23T18:45:38.000+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1323/watchers","watchCount":0,"isWatching":false},"created":"2006-05-12T21:51:48.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"5.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-06-30T16:12:48.827+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11407","id":"11407","name":"JDBC"},{"self":"https://issues.apache.org/jira/rest/api/2/component/11690","id":"11690","name":"Network Client"}],"timeoriginalestimate":null,"description":"Please see enclosed repro.\n\nThese detectability methods fail to check that they can be called in\nsome states. In the repro, calls are allowed while on insert row and\nwhen after last row. These should both fail. Both clients have the\nsame problem. All three detectability methods have the same problem.\n(repro only shows it for a subset of the cases).\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38758","summary":"Detectability methods rowUpdated, rowInserted, rowDeleted can be called from illegal states in both clients","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"subtasks":[],"customfield_12310090":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10101","value":"Release Note Needed","id":"10101"}],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":null,"customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12334154/comment/12402259","id":"12402259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"This patch adds checks for the cases described below, for both\r\nclients, in the JDBC ResultSet API methods rowUpdated, rowDeleted and\r\nrowInserted.\r\n\r\nIn all cases, the exception \"no current row\" (SQLState 24000) is\r\nthrown. A new test has been added to jdbcapi/SURTest.java to exercise\r\nall cases.\r\n\r\nThe JDBC API and specification does not state explicitly what to do in\r\nthese situations, as far as I can see.  For the \"forward only\" case, a\r\nslight, albeit unlikely regression is introduced. I will back out this\r\nchange if people think it is risky. I view it as a correction, though.\r\nThis is the reason for the changed master files for\r\nlang/updatableResultSet.java.\r\n\r\nNow, the cases:\r\n\r\nFor result sets of type TYPE_SCROLL_INSENSITIVE and CONCUR_UPDATABLE:\r\n- before positioning\r\n- on insertRow\r\n- on beforeFirst row\r\n- on afterLast row\r\n- after deleteRow, before new positioning\r\n\r\nFor result sets of type TYPE_FORWARD_ONLY and CONCUR_UPDATABLE:\r\n- before positioning (***)\r\n- on insertRow\r\n- after updateRow, before new positioning (*)\r\n- after deleteRow, before new positioning (**)\r\n- after rs emptied out (***)\r\n\r\nDetectability is currently not implemented for \"forward only\" result\r\nsets and the methods always used to return false, even in the states\r\nindicated. The new checks added by this patch (needed for scrollable\r\nresult sets) introduce a slight regression, in that calls may now\r\nthrow an exception. Cases (*) and (**) broke the regression test as\r\nmentioned, but I think the use of detection methods in these states is\r\nrather meaningless, since Derby can no longer access a row in these\r\ncases anyway - until a next() is performed. Even less problematic\r\nshould be {TYPE_FORWARD_ONLY, CONCUR_READ_ONLY} in the cases (***).\r\n\r\nI have run derbyall with no related errors and the patch is ready for\r\nreview.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-05-15T10:08:51.000+0000","updated":"2006-05-15T10:08:51.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12334154/comment/12411942","id":"12411942","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"body":"Review:\r\n\r\nThe patch looks good. I just have a couple of questions.\r\n\r\n1. java/client/org/apache/derby/client/am/ResultSet.java\r\n\r\nThis check has been added in several places:\r\n\r\n+            if (isOnInsertRow_ || !isValidCursorPosition_) {\r\n+                throw new SqlException\r\n+                    (agent_.logWriter_, \r\n+                     new ClientMessageId(SQLState.NO_CURRENT_ROW));\r\n+            }\r\n\r\nCould it be put in a private method? \r\n\r\n2. java/testing/org/apache/derbyTesting/functionTests/tests/jdbcapi/SURTest.java\r\n\r\nIs it really necessary to use reflection?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"created":"2006-05-16T18:29:00.000+0000","updated":"2006-05-16T18:29:00.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12334154/comment/12412442","id":"12412442","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"This is version 2 of this patch. It addresses both comments of Fernanda's review.\r\nChanges were only made to client code and SURTest.java, so i ran\r\nderbynetclientmats again as well as SURTest on embedded without \r\nproblems(*).\r\n\r\n(*) derbynetclientmats failed on NSinSameJVM.java and DerbyNetNewServer,\r\nthough - I don't think it is related; I ran on a sane build from the classes directory with \r\nSun JDK 1.5.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-05-19T06:09:33.000+0000","updated":"2006-05-19T06:09:33.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12334154/comment/12412784","id":"12412784","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"body":"All of my comments have been addressed in the DERBY-1323-2.diff. \r\n\r\nThe following changes seem unnecessary to me:\r\n[...]\r\n+            checkForClosedResultSet();\r\n+            checkPositionedOnPlainRow();\r\n+\r\n             boolean rowInserted = false;\r\n-            checkForClosedResultSet();\r\n[...]\r\n-            boolean rowDeleted = (resultSetType_ == ResultSet.TYPE_SCROLL_INSENSITIVE) ?\r\n-\t\tcursor_.getIsUpdateDeleteHole() :\r\n-\t\tfalse;\r\n+            boolean rowDeleted = \r\n+                (resultSetType_ == ResultSet.TYPE_SCROLL_INSENSITIVE) ?\r\n+                cursor_.getIsUpdateDeleteHole() : false;\r\n[...]\r\n\r\nI have seen comments against cosmetic changes before, but I am not sure we have a policy against it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fernanda","name":"fernanda","emailAddress":"fernanda dot pizzorno dot derby at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Fernanda Pizzorno","active":true},"created":"2006-05-22T21:49:39.000+0000","updated":"2006-05-22T21:49:39.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12334154/comment/12412918","id":"12412918","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bernt","name":"bernt","emailAddress":"bernt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bernt M. Johnsen","active":true},"body":"Committed revision 408875.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=bernt","name":"bernt","emailAddress":"bernt at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Bernt M. Johnsen","active":true},"created":"2006-05-23T18:45:38.000+0000","updated":"2006-05-23T18:45:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12334154/comment/12435504","id":"12435504","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"body":"Release note for this issue:\r\n\r\n\r\nPROBLEM\r\n\r\nFor a JDBC ResultSet with type TYPE_FORWARD_ONLY, the methods\r\nrowUpdated, rowDeleted and rowInserted could previously be called\r\nwhile not on a row, i.e. before positioning in the result set, while\r\non insertRow, after updateRow before new positioning, after deleteRow\r\nbefore new positioning and when after last row. This is now\r\ndisallowed.\r\n\r\nSYMPTOMS\r\n\r\nCalls to any of these methods while not on a row will now throw\r\nSQLException with SQLState 24000.\r\n\r\nCAUSE\r\n\r\nDerby now disallows these calls when not on a row.\r\n\r\nSOLUTION\r\n\r\nChange the application to not call these methods unless on a row. Note\r\nthat using them at all is rather meaningless for a ResultSet of type\r\nTYPE_FORWARD_ONLY since the returned result will always be 'false'.\r\nThis is because once you modify a row, it can no longer be accessed,\r\nyou need to move to the next row, if there is one, to get a new\r\ncurrent row. Presently in Derby, these methods are only really\r\nmeaningfully useed for result sets of type TYPE_SCROLL_INSENSITIVE and\r\nof concurrency CONCUR_UPDATABLE in which case updated and deleted rows\r\ncan be detected.\r\n\r\nWORKAROUND\r\n\r\nNone.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=dagw","name":"dagw","emailAddress":"dag dot wanvik at oracle dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=dagw&avatarId=16789","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=dagw&avatarId=16789","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=dagw&avatarId=16789","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=dagw&avatarId=16789"},"displayName":"Dag H. Wanvik","active":true},"created":"2006-09-18T15:52:48.000+0000","updated":"2006-09-18T15:52:48.000+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-1323/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06zy7:"}}