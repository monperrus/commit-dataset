{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12378653","self":"https://issues.apache.org/jira/rest/api/latest/issue/12378653","key":"SOLR-360","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310230","id":"12310230","key":"SOLR","name":"Solr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310230&avatarId=22151","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310230&avatarId=22151","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310230&avatarId=22151","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310230&avatarId=22151"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312486","id":"12312486","description":"","name":"1.3","archived":false,"released":true,"releaseDate":"2008-09-16"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2007-09-19 15:58:27.657","customfield_12312323":null,"customfield_12310420":"7234","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_17513389_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2007-09-19T20:03:40.389+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-360/watchers","watchCount":0,"isWatching":false},"created":"2007-09-19T15:11:47.588+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"4.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12312486","id":"12312486","description":"","name":"1.3","archived":false,"released":true,"releaseDate":"2008-09-16"}],"issuelinks":[],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:40:41.534+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12310673","id":"12310673","name":"update","description":"Indexing and updating the search collection"}],"timeoriginalestimate":null,"description":"we were doing some performance testing for the updating aspects of solr and ran into what seems to be a large problem.  we're creating small documents with an id and one field of 1 term only submitting them in batches of 200 with commits every 5000 docs.  when we run the client with 1 thread everything is fine.  when we run it win >1 threads things go south (stack trace is below).  i've attached the junit test which shows the problem.  this happens on both a mac and a pc and when running solr in both jetty and tomcat.  i'll create a junit issue if necessary but i thought i'd see if anyone else had run into this problem first.   \n\nalso, the problem does not seem to surface under solr1.2\n\n(RyanM suggested it might be related to SOLR-215)\n\n(output from junit test)\nStarted thread: 0\nStarted thread: 1\norg.apache.solr.common.SolrException: Current_state_is_not_among_the_states_START_ELEMENT__ATTRIBUTEvalid_for_getAttributeCount__javalangIllegalStateException_Current_state_is_not_among_the_states_START_ELEMENT__ATTRIBUTEvalid_for_getAttributeCount__at_comsunorgapachexercesinternalimplXMLStreamReaderImplgetAttributeCountXMLStreamReaderImpljava598__at_orgapachesolrhandlerXmlUpdateRequestHandlerreadDocXmlUpdateRequestHandlerjava335__at_orgapachesolrhandlerXmlUpdateRequestHandlerprocessUpdateXmlUpdateRequestHandlerjava181__at_orgapachesolrhandlerXmlUpdateRequestHandlerhandleRequestBodyXmlUpdateRequestHandlerjava109__at_orgapachesolrhandlerRequestHandlerBasehandleRequestRequestHandlerBasejava78__at_orgapachesolrcoreSolrCoreexecuteSolrCorejava804__at_orgapachesolrservletSolrDispatchFilterexecuteSolrDispatchFilterjava193__at_orgapachesolrservletSolrDispatchFilterdoFilterSolrDispatchFilterjava161__at_orgmortbayjettyservletServletHandler$CachedChaindoFilterServletHandlerjava1089__at_orgmortbayjettyservletServletHandlerhandleServletHandlerjava365__at_orgmortbayjettysecuritySecurityHandlerhandleSecurityHandlerjava216__at_orgmortbayjettyservletSessionHandlerhandleSessionHandlerjava181__at_orgmortbayjettyhandlerContextHandlerhandleContextHandlerjava712__at_orgmortbayjettywebappWebAppContexthandleWebAppContextjava405__at_orgmortbayjettyhandlerContextHandlerCollectionhandleContextHandlerCollectionjava211__at_orgmortbayjettyhandlerHandlerCollectionhandleHandlerCollectionjava114__at_orgmortbayjettyhandlerHandlerWrapperhandleHandlerWrapperjava139__at_orgmortbayjettyServerhandleServerjava285__at_orgmortbayjettyHttpConnectionhandleRequestHttpConnectionjava502__at_orgmortbayjettyHttpConnection$RequestHandlercontentHttpConnectionjava835__at_orgmortbayjettyHttpParserparseNextHttpParserjava641__at_orgmortbayjettyHttpParserparseAvailableHttpParserjava208__at_orgmortbayje\n\nCurrent_state_is_not_among_the_states_START_ELEMENT__ATTRIBUTEvalid_for_getAttributeCount__javalangIllegalStateException_Current_state_is_not_among_the_states_START_ELEMENT__ATTRIBUTEvalid_for_getAttributeCount__at_comsunorgapachexercesinternalimplXMLStreamReaderImplgetAttributeCountXMLStreamReaderImpljava598__at_orgapachesolrhandlerXmlUpdateRequestHandlerreadDocXmlUpdateRequestHandlerjava335__at_orgapachesolrhandlerXmlUpdateRequestHandlerprocessUpdateXmlUpdateRequestHandlerjava181__at_orgapachesolrhandlerXmlUpdateRequestHandlerhandleRequestBodyXmlUpdateRequestHandlerjava109__at_orgapachesolrhandlerRequestHandlerBasehandleRequestRequestHandlerBasejava78__at_orgapachesolrcoreSolrCoreexecuteSolrCorejava804__at_orgapachesolrservletSolrDispatchFilterexecuteSolrDispatchFilterjava193__at_orgapachesolrservletSolrDispatchFilterdoFilterSolrDispatchFilterjava161__at_orgmortbayjettyservletServletHandler$CachedChaindoFilterServletHandlerjava1089__at_orgmortbayjettyservletServletHandlerhandleServletHandlerjava365__at_orgmortbayjettysecuritySecurityHandlerhandleSecurityHandlerjava216__at_orgmortbayjettyservletSessionHandlerhandleSessionHandlerjava181__at_orgmortbayjettyhandlerContextHandlerhandleContextHandlerjava712__at_orgmortbayjettywebappWebAppContexthandleWebAppContextjava405__at_orgmortbayjettyhandlerContextHandlerCollectionhandleContextHandlerCollectionjava211__at_orgmortbayjettyhandlerHandlerCollectionhandleHandlerCollectionjava114__at_orgmortbayjettyhandlerHandlerWrapperhandleHandlerWrapperjava139__at_orgmortbayjettyServerhandleServerjava285__at_orgmortbayjettyHttpConnectionhandleRequestHttpConnectionjava502__at_orgmortbayjettyHttpConnection$RequestHandlercontentHttpConnectionjava835__at_orgmortbayjettyHttpParserparseNextHttpParserjava641__at_orgmortbayjettyHttpParserparseAvailableHttpParserjava208__at_orgmortbayje\n\nrequest: http://localhost:8983/solr/update?wt=xml&version=2.2\n\tat org.apache.solr.client.solrj.impl.CommonsHttpSolrServer.request(CommonsHttpSolrServer.java:230)\n\tat org.apache.solr.client.solrj.request.UpdateRequest.process(UpdateRequest.java:199)\n\tat org.apache.solr.client.solrj.impl.BaseSolrServer.add(BaseSolrServer.java:46)\n\tat org.apache.solr.client.solrj.impl.BaseSolrServer.add(BaseSolrServer.java:61)\n\tat org.apache.solr.client.solrj.embedded.TestJettyLargeVolume$DocThread.run(TestJettyLargeVolume.java:69)\nException in thread \"DocThread-0\" java.lang.AssertionError: DocThread-0---Current_state_is_not_among_the_states_START_ELEMENT__ATTRIBUTEvalid_for_getAttributeCount__javalangIllegalStateException_Current_state_is_not_among_the_states_START_ELEMENT__ATTRIBUTEvalid_for_getAttributeCount__at_comsunorgapachexercesinternalimplXMLStreamReaderImplgetAttributeCountXMLStreamReaderImpljava598__at_orgapachesolrhandlerXmlUpdateRequestHandlerreadDocXmlUpdateRequestHandlerjava335__at_orgapachesolrhandlerXmlUpdateRequestHandlerprocessUpdateXmlUpdateRequestHandlerjava181__at_orgapachesolrhandlerXmlUpdateRequestHandlerhandleRequestBodyXmlUpdateRequestHandlerjava109__at_orgapachesolrhandlerRequestHandlerBasehandleRequestRequestHandlerBasejava78__at_orgapachesolrcoreSolrCoreexecuteSolrCorejava804__at_orgapachesolrservletSolrDispatchFilterexecuteSolrDispatchFilterjava193__at_orgapachesolrservletSolrDispatchFilterdoFilterSolrDispatchFilterjava161__at_orgmortbayjettyservletServletHandler$CachedChaindoFilterServletHandlerjava1089__at_orgmortbayjettyservletServletHandlerhandleServletHandlerjava365__at_orgmortbayjettysecuritySecurityHandlerhandleSecurityHandlerjava216__at_orgmortbayjettyservletSessionHandlerhandleSessionHandlerjava181__at_orgmortbayjettyhandlerContextHandlerhandleContextHandlerjava712__at_orgmortbayjettywebappWebAppContexthandleWebAppContextjava405__at_orgmortbayjettyhandlerContextHandlerCollectionhandleContextHandlerCollectionjava211__at_orgmortbayjettyhandlerHandlerCollectionhandleHandlerCollectionjava114__at_orgmortbayjettyhandlerHandlerWrapperhandleHandlerWrapperjava139__at_orgmortbayjettyServerhandleServerjava285__at_orgmortbayjettyHttpConnectionhandleRequestHttpConnectionjava502__at_orgmortbayjettyHttpConnection$RequestHandlercontentHttpConnectionjava835__at_orgmortbayjettyHttpParserparseNextHttpParserjava641__at_orgmortbayjettyHttpParserparseAvailableHttpParserjava208__at_orgmortbayje\n\nCurrent_state_is_not_among_the_states_START_ELEMENT__ATTRIBUTEvalid_for_getAttributeCount__javalangIllegalStateException_Current_state_is_not_among_the_states_START_ELEMENT__ATTRIBUTEvalid_for_getAttributeCount__at_comsunorgapachexercesinternalimplXMLStreamReaderImplgetAttributeCountXMLStreamReaderImpljava598__at_orgapachesolrhandlerXmlUpdateRequestHandlerreadDocXmlUpdateRequestHandlerjava335__at_orgapachesolrhandlerXmlUpdateRequestHandlerprocessUpdateXmlUpdateRequestHandlerjava181__at_orgapachesolrhandlerXmlUpdateRequestHandlerhandleRequestBodyXmlUpdateRequestHandlerjava109__at_orgapachesolrhandlerRequestHandlerBasehandleRequestRequestHandlerBasejava78__at_orgapachesolrcoreSolrCoreexecuteSolrCorejava804__at_orgapachesolrservletSolrDispatchFilterexecuteSolrDispatchFilterjava193__at_orgapachesolrservletSolrDispatchFilterdoFilterSolrDispatchFilterjava161__at_orgmortbayjettyservletServletHandler$CachedChaindoFilterServletHandlerjava1089__at_orgmortbayjettyservletServletHandlerhandleServletHandlerjava365__at_orgmortbayjettysecuritySecurityHandlerhandleSecurityHandlerjava216__at_orgmortbayjettyservletSessionHandlerhandleSessionHandlerjava181__at_orgmortbayjettyhandlerContextHandlerhandleContextHandlerjava712__at_orgmortbayjettywebappWebAppContexthandleWebAppContextjava405__at_orgmortbayjettyhandlerContextHandlerCollectionhandleContextHandlerCollectionjava211__at_orgmortbayjettyhandlerHandlerCollectionhandleHandlerCollectionjava114__at_orgmortbayjettyhandlerHandlerWrapperhandleHandlerWrapperjava139__at_orgmortbayjettyServerhandleServerjava285__at_orgmortbayjettyHttpConnectionhandleRequestHttpConnectionjava502__at_orgmortbayjettyHttpConnection$RequestHandlercontentHttpConnectionjava835__at_orgmortbayjettyHttpParserparseNextHttpParserjava641__at_orgmortbayjettyHttpParserparseAvailableHttpParserjava208__at_orgmortbayje\n\nrequest: http://localhost:8983/solr/update?wt=xml&version=2.2\n\tat org.junit.Assert.fail(Assert.java:71)\n\tat org.apache.solr.client.solrj.embedded.TestJettyLargeVolume$DocThread.run(TestJettyLargeVolume.java:92)","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"20824","summary":"Multithread update client causes exceptions and dropped documents","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=willjohnson3","name":"willjohnson3","emailAddress":"willjohnsonsearch at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Will Johnson","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=willjohnson3","name":"willjohnson3","emailAddress":"willjohnsonsearch at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Will Johnson","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":"test fails on both pc + mac, tomcat + jetty all java 1.6","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":11,"total":11,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528783","id":"12528783","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=willjohnson3","name":"willjohnson3","emailAddress":"willjohnsonsearch at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Will Johnson","active":true},"body":"i'll work on the patch to make it  cleaner and run with the build process but i wanted to get this up as soon as possible.  if you drop it into /client/java/solrj/test/org/apache/solr/client/solrj/embedded it compiles/runs with eclipse.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=willjohnson3","name":"willjohnson3","emailAddress":"willjohnsonsearch at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Will Johnson","active":true},"created":"2007-09-19T15:13:58.782+0000","updated":"2007-09-19T15:13:58.782+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528803","id":"12528803","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Grrr... embedded.\r\nDoes it happen with a standalone server also?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-09-19T15:58:27.657+0000","updated":"2007-09-19T15:58:27.657+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528804","id":"12528804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"I hacked up a quick python script to try and reproduce this (attaching).... no dice (script works fine).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-09-19T16:00:18.754+0000","updated":"2007-09-19T16:00:18.754+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528805","id":"12528805","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"This isn't an embedded problem...  it happens through solrj+jetty\r\n\r\nRight now I'm trying to make it happen on the embedded side to see if I can limit it.  It may be a threading problem with the xml parsing in solrj if things work fine with a python client.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2007-09-19T16:11:51.334+0000","updated":"2007-09-19T16:11:51.334+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528843","id":"12528843","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"This appears to be a problem with SOLR-133\r\n\r\nApparently the XMLInputFactory is not thread safe - it was sharing the same inputFactory for every request.\r\n\r\nCreating a new XMLInputFactory for each requests fixes the problem.\r\n\r\n--------------------------------------\r\n\r\nI looked into the XmlUpdateRequestHandler because this was the errors from (the soon to attach) test:\r\n\r\n\r\nThe root error running this 5 times with jetty.\r\n-----------------------------------------------\r\n\r\nSEVERE: java.lang.IllegalStateException: Current state is not among the states START_ELEMENT , ATTRIBUTEvalid for getAttributeCount()\r\n\tat com.sun.org.apache.xerces.internal.impl.XMLStreamReaderImpl.getAttributeCount(XMLStreamReaderImpl.java:661)\r\n\t\r\nSEVERE: java.lang.ArrayIndexOutOfBoundsException: -1\r\n\tat com.sun.org.apache.xerces.internal.util.NamespaceSupport.getURI(NamespaceSupport.java:237)\r\n\t\r\nSEVERE: java.lang.NullPointerException\r\n\tat com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.peekChar(XMLEntityScanner.java:485)\r\n\t\r\nSEVERE: javax.xml.stream.XMLStreamException: ParseError at [row,col]:[1,1212]\r\nMessage: The element type \"doc\" must be terminated by the matching end-tag \"</doc>\".\r\n\tat com.sun.org.apache.xerces.internal.impl.XMLStreamReaderImpl.next(XMLStreamReaderImpl.java:588)\r\n\t\r\nSep 19, 2007 1:39:38 PM org.apache.solr.common.SolrException log\r\nSEVERE: java.lang.NullPointerException\r\n\tat com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.arrangeCapacity(XMLEntityScanner.java:1598)\r\n\t\r\n\t\r\nThe root error running this 5 times embedded.\r\n-----------------------------------------------\r\n\r\nSEVERE: javax.xml.stream.XMLStreamException: ParseError at [row,col]:[-1,-1]\r\nMessage: doc started without an add command!\r\n\tat org.apache.solr.handler.XmlUpdateRequestHandler.processUpdate(XmlUpdateRequestHandler.java:182)\r\n\t\r\nSEVERE: java.lang.NullPointerException\r\n\tat com.sun.org.apache.xerces.internal.impl.XMLEntityScanner.peekChar(XMLEntityScanner.java:485)\r\n\t\r\nSEVERE: javax.xml.stream.XMLStreamException: ParseError at [row,col]:[1,182]\r\nMessage: doc started without an add command!\r\n\tat org.apache.solr.handler.XmlUpdateRequestHandler.processUpdate(XmlUpdateRequestHandler.java:182)\r\n\t\r\norg.apache.solr.client.solrj.SolrServerException: org.apache.solr.client.solrj.SolrServerException: javax.xml.stream.XMLStreamException: ParseError at [row,col]:[1,158]\r\nMessage: Attribute name \"llowDups\" associated with an element type \"add\" must be followed by the ' = ' character.\r\n\t\r\nSEVERE: javax.xml.stream.XMLStreamException: ParseError at [row,col]:[1,21855]\r\nMessage: XML document structures must start and end within the same entity.\r\n\tat com.sun.org.apache.xerces.internal.impl.XMLStreamReaderImpl.next(XMLStreamReaderImpl.java:588)\r\n\t\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2007-09-19T18:00:15.667+0000","updated":"2007-09-19T18:00:15.667+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528849","id":"12528849","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"Blech. Too bad... factory creation looks pretty slow.\r\nApparently all the open-source stax parsers have thread-safe factories once configured.\r\n(and factories normally should be thread safe in general.)\r\n\r\nRyan: does the stax impl in 1.6 show this problem, or does this just show with the external stax jars we picked?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-09-19T18:22:13.901+0000","updated":"2007-09-19T18:22:13.901+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528850","id":"12528850","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"updated will's test to run as jetty or embedded","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2007-09-19T18:28:24.169+0000","updated":"2007-09-19T18:28:24.169+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528861","id":"12528861","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"wow... so if I use the open source package:\r\nFACTORY: com.bea.xml.stream.MXParserFactory@99681b\r\n\r\nno problem\r\n\r\nusing the sun package (included in java6) :\r\nFACTORY: com.sun.xml.internal.stream.XMLInputFactoryImpl@10a3b24\r\n\r\nthen it gets threading errors!!\r\n\r\n- - - - -\r\n\r\nI'm unable to get java6 to prefer using the bea parser -- I was only able to do that from java 5.\r\n\r\nSo... i think we should revert  #577405 and somehow hardcode using the bea parser.  Other ideas?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2007-09-19T18:53:08.864+0000","updated":"2007-09-19T18:53:08.864+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528866","id":"12528866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"body":"I've done some scanning through the factory code, and I think I see the issue.\r\nRyan, could you try \r\nfactory.setProperty(\"reuse-instance\", Boolean.FALSE);\r\nwhen the factory is first created?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yseeley%40gmail.com","name":"yseeley@gmail.com","emailAddress":"yseeley at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yonik Seeley","active":true},"created":"2007-09-19T19:00:05.552+0000","updated":"2007-09-19T19:00:05.552+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528875","id":"12528875","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"\"reuse-instance\" works for java 1.6 but crashes the 1.5 bea factory...\r\n\r\nsolution:\r\n\r\n   inputFactory = BaseXMLInputFactory.newInstance();\r\n    try {\r\n      inputFactory.setProperty(\"reuse-instance\", Boolean.FALSE);\r\n    }\r\n    catch( IllegalArgumentException ex ) {\r\n      // The java 1.5 com.bea.xml does not support this property, but behaves properly in a\r\n      // multi-threaded environment.  Ignore the error for 1.5\r\n      log.info( \"Unable to set the 'reuse-instance' property for the input factory: \"+inputFactory );\r\n    }\r\n\r\n\r\ncommited in rev 577421\r\n\r\nthanks yonik","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2007-09-19T19:44:07.343+0000","updated":"2007-09-19T19:44:07.343+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12378653/comment/12528879","id":"12528879","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"body":"This now works for 1.5 & 1.6\r\n\r\nWill - thanks for pointing this out and submitting a test!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ryantxu","name":"ryantxu","emailAddress":"ryantxu at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ryan McKinley","active":true},"created":"2007-09-19T20:03:40.368+0000","updated":"2007-09-19T20:03:40.368+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/SOLR-360/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i03x9z:"}}