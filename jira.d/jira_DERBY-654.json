{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12325081","self":"https://issues.apache.org/jira/rest/api/latest/issue/12325081","key":"DERBY-654","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/2","id":"2","description":"The problem described is an issue which will never be fixed.","name":"Won't Fix"},"customfield_12310220":"2006-01-10 09:52:04.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22074","customfield_12310222":"1_*:*_1_*:*_117739055383_*|*_6_*:*_1_*:*_0","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-07-21T17:42:04.383+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-654/watchers","watchCount":0,"isWatching":false},"created":"2005-10-28T00:24:29.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"2.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2009-07-21T17:42:04.380+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"I am thinking this is a bug and opening a JIRA issue since I did not get any response to my question in derby-dev. One more thing I noticed is this test passes in 10.1 branch.  It is failing only in trunk.\n\nThe test unit/T_RawStoreFactory.unit fails with an assert failure in CDC/FP. This failure looks like an intermittent one though it is failing all the time now. I have run this test successfully some time back. I would like to find out if this is a bug (Derby or jvm) or just an intermittent failure. I am using j9 foundation  from IBM WCTME5.7.\n\n---------------------------------------------------------------------\ndiff for the test:\n---------------------------------------------------------------------\n < -- Unit Test T_RawStoreFactory finished\n 2 add\n > There should be 0 observers, but we still have 1 observers.\n> Shutting down due to unit test failure.\n---------------------------------------------------------------------\nstack trace for AssertFailure in derby.log is:\n---------------------------------------------------------------------\n FAIL - org.apache.derby.iapi.services.sanity.AssertFailure: ASSERT\nFAILED still on observer list\norg.apache.derby.impl.store.raw.data.TruncateOnCommit@f147d525\norg.apache.derby.iapi.services.sanity.AssertFailure: ASSERT FAILED\nstill on observer list\norg.apache.derby.impl.store.raw.data.TruncateOnCommit@f147d525\n       at org.apache.derby.iapi.services.sanity.SanityManager.THROWASSERT(SanityManager.java:150)\n       at org.apache.derby.impl.store.raw.data.TruncateOnCommit.update(TruncateOnCommit.java:69)\n       at java.util.Observable.notifyObservers(Observable.java:117)\n       at org.apache.derby.iapi.store.raw.xact.RawTransaction.notifyObservers(RawTransaction.java:313)\n       at org.apache.derby.impl.store.raw.xact.Xact.doComplete(Xact.java:1927)\n       at org.apache.derby.impl.store.raw.xact.Xact.preComplete(Xact.java:1880)\n       at org.apache.derby.impl.store.raw.xact.Xact.prepareCommit(Xact.java:726)\n       at org.apache.derby.impl.store.raw.xact.Xact.commit(Xact.java:839)\n       at org.apache.derby.impl.store.raw.xact.Xact.commit(Xact.java:636)\n       at org.apache.derbyTesting.unitTests.store.T_Util.t_commit(T_Util.java:838)\n       at org.apache.derbyTesting.unitTests.store.T_RawStoreFactory.TC001(T_RawStoreFactory.java:7435)\n       at org.apache.derbyTesting.unitTests.store.T_RawStoreFactory.runTempTests(T_RawStoreFactory.java:420)\n       at org.apache.derbyTesting.unitTests.store.T_RawStoreFactory.runTestSet(T_RawStoreFactory.java:247)\n       at org.apache.derbyTesting.unitTests.harness.T_MultiIterations.runTests(T_MultiIterations.java:94)\n       at org.apache.derbyTesting.unitTests.harness.T_MultiThreadedIterations.runTests(T_MultiThreadedIterations.java:91)\n       at org.apache.derbyTesting.unitTests.harness.T_Generic.Execute(T_Generic.java:117)\n       at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.runATest(BasicUnitTestManager.java:183)\n       at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.runTests(BasicUnitTestManager.java:245)\n       at org.apache.derbyTesting.unitTests.harness.BasicUnitTestManager.boot(BasicUnitTestManager.java:92)\n       at org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2008)\n       at org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:290)\n       at org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1846)\n       at org.apache.derby.impl.services.monitor.BaseMonitor.startServices(BaseMonitor.java:966)\n       at org.apache.derby.impl.services.monitor.BaseMonitor.runWithState(BaseMonitor.java:398)\n       at org.apache.derby.impl.services.monitor.FileMonitor.<init>(FileMonitor.java:59)\n       at org.apache.derby.iapi.services.monitor.Monitor.startMonitor(Monitor.java:288)\n       at org.apache.derbyTesting.unitTests.harness.UnitTestMain.main(UnitTestMain.java:50)\n---------------------------------------------------------------------\n\nOn looking at the code, I did not understand how this assert failure can happen. The assert is thrown in following code in TruncateOnCommit: \npublic void update(Observable obj, Object arg) {\n       if (SanityManager.DEBUG) {\n               if (arg == null)\n               SanityManager.THROWASSERT(\"still on observer list \" + this);\n       }\n\nI am puzzled by how 'arg' can become null in this case. As I understand, 'update' method of each Observer gets called by the notifyObserver method in java.util.Observable class. notifyObserver passes 'arg', which describes the type of change, as the second argument to update. In this code path, 'arg' passed to notifyObserver is RawTransaction.COMMIT (which is not null).  However the code has an assert to check for null value which means there is some situation where the 'arg' can become null.  I have not understood what causes this situation but it is always being hit when running in this environment. \n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"38352","summary":"unit/T_RawStoreFactory.unit fails with an assert failure in J2ME/CDC/FP","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"subtasks":[],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=deepa","name":"deepa","emailAddress":"dremesh at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Deepa Remesh","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"IBM WCTME5.7 j9 foundation VM ","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":6,"total":6,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325081/comment/12362271","id":"12362271","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"In addition to answering Deepa's specific questions,  It would be good if someone with some Store knowledge could comment on this assertion  and estimate how serious it is.  We have not seen it manifested in any functional tests, but it does appear to be a regression from 10.1  so perhaps it should be marked with higher priority.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2006-01-10T09:52:04.000+0000","updated":"2006-01-10T09:52:04.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325081/comment/12363680","id":"12363680","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"I ran this test on my win2k/T40 laptop with wctme5.7 and this test passed OK.  I ran this test about 100 times repeatedly and it worked OK.\r\n\r\nIf for someone, this test fails on their machine, can you please post more info - that would help to debug this failure. Thanks. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-01-24T00:18:59.000+0000","updated":"2006-01-24T00:18:59.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325081/comment/12363681","id":"12363681","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"With respect to my earlier comment - Test passed OK with revision: 369993 on trunk (10.2)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-01-24T00:20:08.000+0000","updated":"2006-01-24T00:20:08.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325081/comment/12368793","id":"12368793","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"body":"As I was preparing to disable this test from running in the j9 vms, I ran this test one more time and it failed on my machine (win2k/t40). Looking at the diff, it is similar to the stack trace attached to this jira. \r\n\r\n1)I looked little bit at the code and I think this is the reason that a null arg is passed to the update(Observable obj,Object arg). \r\n\r\nIn Xact.doComplete(), notifyObservers is called either with a commit or abort. After this step, in debug block, there is a check to countObservers and if observers!= 0, then another notifyObservers call is made with an arg of null.  This notify call is sending an arg of null and hence the update of TruncateOnCommit is getting a null arg and the assert failure. \r\n\r\n2) I put printlns and noticed that the first notifyObserver call in Xact.doComplete is actually making to the TruncateOnCommit and there it calls deleteObserver.  I am just not sure why the countObservers does not become 0. My guess is it maybe some timing issue.\r\nPut checks in Xact.preComplete and verified that none of the corrupt conditions were happening here.\r\n\r\n-- I quickly tried if i could run with 10.2 derbyTesting.jar with 10.1 derby.jar but hit a npe in harness stuff. Didnt spend much time looking at it. \r\n\r\nIn the meantime, I am attaching a patch (derby654.diff.txt) to disable this test with the wctme5.7 foundation and wsdd5.6.\r\n\r\nI think we should keep this bug open and someone can look at it and investigate whats the cause for this in the j9 vms. \r\n\r\nIf this is ok, can someone please review and commit this patch. Thanks. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=skambha","name":"skambha","emailAddress":"ksunithaghm at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sunitha Kambhampati","active":true},"created":"2006-03-04T05:58:10.000+0000","updated":"2006-03-04T05:58:10.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325081/comment/12368796","id":"12368796","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"body":"I have committed this change.  Removing it from the regression suite as no one is actively working on fixing this issue.  It is removed from the regression tests suite in the failing platform, so I have removed that component.\r\n\r\nm1_142:1>svn commit\r\n\r\nAdding         java\\testing\\org\\apache\\derbyTesting\\functionTests\\tests\\unit\\T_R\r\nawStoreFactory_app.properties\r\nTransmitting file data .\r\nCommitted revision 382931.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikem","name":"mikem","emailAddress":"mikem_app at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Mike Matrigali","active":true},"created":"2006-03-04T06:20:35.000+0000","updated":"2006-03-04T06:20:35.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12325081/comment/12733743","id":"12733743","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"body":"Closing this issue because the test was disabled on the offending platform and no-one has expressed any interest in this issue in 3 years.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rhillegas","name":"rhillegas","emailAddress":"rhillegas at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Rick Hillegas","active":true},"created":"2009-07-21T17:42:04.366+0000","updated":"2009-07-21T17:42:04.366+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-654/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06xfz:"}}