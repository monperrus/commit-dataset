{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12314126","self":"https://issues.apache.org/jira/rest/api/latest/issue/12314126","key":"DERBY-555","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/10594","id":"10594","key":"DERBY","name":"Derby","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=10594&avatarId=10122","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=10594&avatarId=10122","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=10594&avatarId=10122","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=10594&avatarId=10122"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10090","id":"10090","description":"DB related projects","name":"DB"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12313478","id":"12313478","description":"Head of 10.1 branch. Maintenance version bump for sps update ","name":"10.1.3.3","archived":false,"released":false},{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12310220":"2005-09-03 06:26:07.0","customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"22012","customfield_12310222":"3_*:*_1_*:*_1387422000_*|*_1_*:*_1_*:*_2752552000_*|*_6_*:*_2_*:*_106258229639_*|*_5_*:*_1_*:*_28000_*|*_4_*:*_1_*:*_17273489","customfield_12312320":null,"customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2009-03-03T22:29:22.128+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-555/watchers","watchCount":0,"isWatching":false},"created":"2005-09-02T23:30:57.000+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.png","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/11187","id":"11187","description":"","name":"10.2.1.6","archived":false,"released":true,"releaseDate":"2006-10-02"}],"customfield_12311120":null,"customfield_12312330":null,"issuelinks":[{"id":"12356757","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12356757","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12549919","key":"DERBY-5686","self":"https://issues.apache.org/jira/rest/api/2/issue/12549919","fields":{"summary":"multiple intermittent errors in nightly tests during DriverMgrAuthenticationTest test. reason: An SQL data change is not permitted for a read-only connection, user or database. \t","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2012-08-16T18:45:18.233+0000","customfield_12312335":null,"customfield_12311720":null,"customfield_12312336":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/11412","id":"11412","name":"Store"}],"timeoriginalestimate":null,"description":"1. Inserted data into the database until the disk was full. (5 clients inserting into 5 different tables in parallel.)\n2. Shut down the server\n3. Start the database again without freeing any disk space.\n\nWhen I try to start the database again, I get Null-pointer-exception, regardless of how I connect (have tried embedded, client server, ij, jdbc applications).  I have not tried to free some space on the disk before starting.  \n\nThe call stack is not available right now (the computer I used had to be shut down due to problems with our cooling system), but the exception comes from the following line in RawStore.java:\n     properties.put(Attribute.LOG_DEVICE, logFactory.getCanonicalLogPath());\n\ngetCanonicalLogPath() returns null which results in a NPE in the hash table.\nA quick debug before the computer was stopped, showed that the logFactory was an instance of org.apache.derby.impl.store.raw.log.ReadOnly which always returns null in its  getCanonicalLogPath().\n\nI suspect this may be related to the fact that I ran with the log in a non-default location.\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12310200":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"35494","summary":"Unable to restart after disk is full","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"subtasks":[{"id":"12317580","key":"DERBY-600","self":"https://issues.apache.org/jira/rest/api/2/issue/12317580","fields":{"summary":"Document that DB is booted in read-only mode if not able to create db.lck file","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.png","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/7","id":"7","description":"The sub-task of the issue","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png","name":"Sub-task","subtask":true}}}],"customfield_12310090":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"customfield_12310291":null,"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"environment":"Sun Sparc Solaris, 1.4 JDK, Derby Client/Server","customfield_12311020":null,"customfield_12310050":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":12,"total":12,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12320895","id":"12320895","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Can anyone explain why LogFactory becomes an instance of ReadOnly when I restart the database?  I have not been able to figure out how/where/when that happens.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2005-09-02T23:33:24.000+0000","updated":"2005-09-02T23:33:24.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12320936","id":"12320936","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"One case I can think of  database disk is full and system is unable to create even a lock (db.lck) file also.  In derby , there is this logic that declares database is read only , when it is not able to create files. Idea is  to boot  database in jar files ..etc in read only mode . If   file creation IO error happens to occur , before it load the log factory is loaded , then it  boots the read only verion of the log factory implementation, thinking that databse is read only. \r\n\r\nyou may want to look at the following code to see , if this is what is happening in u'r case:\r\nBaseDataFileFatory.java:\r\n\r\n1)\r\nprivate void bootLogFactory(boolean create, Properties startParams) throws StandardException {\r\nif (isReadOnly())\r\nstartParams.put(LogFactory.RUNTIME_ATTRIBUTES, LogFactory.RT_READONLY);\r\nlogFactory = (LogFactory)\tMonitor.bootServiceModule(create, this, \r\n\t\t\t\t\trawStoreFactory.getLogFactoryModule(), \r\n\t\t\t\t\t\tstartParams);\r\n}\r\n\r\n\r\n2) boot()  method \r\n\r\n3) ,private void privGetJBMSLockOnDB() throws StandardException this method marks the database as readonly , if it is not able to create db.lck files. \r\n--\r\n\r\nMarking database on disk full case seems to be incorrect as u mentioned. Problem here is ,we want to automatically figure out the read only databases,  but java does not  seem have a  DiskFull exception!!  \r\n\r\n\r\nThanks\r\n-suresht\r\n\r\n\r\n  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2005-09-03T06:26:07.000+0000","updated":"2005-09-03T06:26:07.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12320945","id":"12320945","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=forsini","name":"forsini","emailAddress":"francois dot orsini at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Francois Orsini","active":true},"body":"There is no DiskFullException (working) exception in the current JVM - there are a couple of JSR's (i.e. JSR-203) related to this as well as getting access to some extra FS api but it is now planned for jdk 1.6 or possibly later (been requested for years)\r\n\r\nThere is a potential DiskFullException exception workaronud posted below:\r\nhttp://weblog.janek.org/Archive/2004/12/20/ExceptionWhenWritingToAFu.html\r\n(there is also an interesting behavior as far as file creation on a disk full - kinda skeptical about that but eh)\r\n\r\nThere is also no API to return how space is left on a disk (device) - this is part of the related JSR's as well...\r\n\r\n--francois","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=forsini","name":"forsini","emailAddress":"francois dot orsini at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Francois Orsini","active":true},"created":"2005-09-03T09:32:13.000+0000","updated":"2005-09-03T09:32:13.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12322633","id":"12322633","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"The log disk was not full. Neither was the disk where the derby.log file is written.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2005-09-05T16:42:06.000+0000","updated":"2005-09-05T16:42:06.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12329831","id":"12329831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Since it seems not to be possible to detect full disk in Java, my suggestion is to write a message to derby.log when a database is made read-only which states that reason may either be because it is lacking write access or because the disk is full.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2005-09-19T21:10:53.000+0000","updated":"2005-09-19T21:10:53.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12330187","id":"12330187","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"I have attached a patch that aims to resolve this issue as follows:\r\n\r\n- If database is set to read-only, print a message in derby.log about this.\r\n- If the database is read-only, do not worry about log path.  This avoids the null pointer exception. \r\n\r\nThe following files are changed:\r\nM      java/engine/org/apache/derby/impl/store/raw/RawStore.java\r\nM      java/engine/org/apache/derby/impl/store/raw/data/BaseDataFileFactory.java\r\nM      java/engine/org/apache/derby/iapi/reference/MessageId.java\r\nM      java/engine/org/apache/derby/loc/messages_en.properties\r\n\r\nIf this fix is applied, the database will boot in read-only mode if there is not free disk space in the database directory.  A message of this will then be printed to derby.log.  This is far from an ideal solution since an application that experience this will not get any warning/error when connecting.  However, if it laters tries to modify data, it will get exceptions like \"ERROR 25502: An SQL data change is not permitted for a read-only connection, user or database\".  I think many Derby users will be confused by this message since I am not sure the aspects of read-only connections/users/databases are well known to most Derby   users.\r\n\r\nI guess the documentation should be updated to inform about this, but I am not quite sure where to put it.  Any suggestions?\r\n\r\nI have not made any tests for this.  Do people think it is necessary?  It is a bit difficult to make a standard test that fills disk devices.  I could experiment to see if I can get the same NPE problem with a read-only database.\r\n\r\n\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2005-09-22T20:26:25.000+0000","updated":"2005-09-22T20:26:25.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12330529","id":"12330529","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"body":"Hi Øystein, \r\n\r\nTested your patch ,  it looks good .    I have couple of minor questions,   related to the  new error message  :\r\nDatabase located at C:\\suresht\\databases\\wombat has been booted in READ ONLY mod\r\ne. This will occur when the database is located in a jar file.  This may also ha\r\nppen when Derby is not able to write to the database directory; either because i\r\nt does not have the required access rights or because the disk is full.\r\n\r\n1) New Message added will be displayed  on  every boot  from a read only media ,  Not sure if \r\nthis  will be  annoying to  the users who are booting  derby  from a read-only media ?  \r\n\r\n2) Above Message added will never be  displayed  when booted from a JAR file.   reference to jar in read-only mode (\"... This will occur when the database is located in a jar file ...) may not be needed. \r\n\r\n--\r\n\r\nHow about modifying the general boot message to indicate that  the database is booted in  read-only mode ? and  document the special case of disk full scenario some where ? \r\n\r\nI agree with you that  there is no simple way to write a disk full test cases that can be added to nightly runs.  But if you have a test case ,  I  think  it might be  good idea  to  create special  ad-hoc test   directory and put it there ,   so that some one interested can run them manually  at the time of a  release.\r\n \r\nOn a quick scan through the docs,  found   a section  \"Booting databases\"  section in the Developers guide(\"http://db.apache.org/derby/docs/10.1/devguide/) ; may be we can mention the disk full read-only boot  special case there as a note. \r\n\r\nThanks\r\n-suresht\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tsuresh","name":"tsuresh","emailAddress":"suresh dot thalamati at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Suresh Thalamati","active":true},"created":"2005-09-27T09:00:38.000+0000","updated":"2005-09-27T09:00:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12331165","id":"12331165","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"If I understand you correctly, you suggest that I add an extra parameter to the boot message that can be used to indicate that a database is booted in read only mode.  I can do that.  I am a bit afraid that it will be less visible to someone inspecting the log file for the cause of the problem, but I can write READ-ONLY in upper case :-)\r\n\r\nI have now reproduce the same bug by setting the DB directory to read-only.  I will make a test based on that.  Unfortunately, this cannot be added to derbyall before we can use J2SE 6 since there is currently no way to turn write access back on again.  Hence, you will have to manually change the access rights in order to clean up the test directory after the test has been run.\r\n\r\nI will suggest a text to be added to the documentation.  Should I create a separate JIRA issue for this?\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2005-10-03T23:19:12.000+0000","updated":"2005-10-03T23:19:12.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12331265","id":"12331265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Added a new patch that changes the message to derby.log and adds a test for this bug. \r\n\r\nWith this patch, when a database is booted in read-only mode, the boot message in derby.log will contain information about that.\r\n\r\nI have also added a test, TurnsReadOnly.java, that without the fix, get the NPE.  This is not in a disk full scenario, but it also occurs with a read-only DB directory.   Since there is currently no way to turn write access back on from a Java program, the DB directory will be read-only after the test is run.  Hence, the test framework will not be able to clean up the test directory.  Therefore, this test is not added to the derbyall test suite.\r\n\r\nThe following files are changed:\r\n\r\nM      java/engine/org/apache/derby/impl/store/raw/RawStore.java\r\n      Do not check log location for read-only databases (avoids NPE)\r\nM      java/engine/org/apache/derby/impl/store/raw/data/BaseDataFileFactory.java\r\n      Add information to boot message in derby.log when database is booted in read-only mode.\r\nM      java/engine/org/apache/derby/iapi/reference/MessageId.java\r\n      Added message id for the read-only part of the boot message\r\nM      java/engine/org/apache/derby/loc/messages_en.properties\r\n      Added text for the read-only part of the boot message\r\nM      java/testing/org/apache/derbyTesting/functionTests/tests/store/copyfiles.ant\r\n      Added TurnsReadOnly_app.properties\r\nA      java/testing/org/apache/derbyTesting/functionTests/tests/store/TurnsReadOnly.java\r\n      New test that boots a database with log in non-default location, shuts it down, sets DB directory to read-only, boots again and checks that DML is not allowed.\r\nA      java/testing/org/apache/derbyTesting/functionTests/tests/store/TurnsReadOnly_app.properties\r\n      Test properties\r\nA      java/testing/org/apache/derbyTesting/functionTests/master/TurnsReadOnly.out\r\n      Master file for new test.\r\n\r\nI am currently running derbyall and will update report when test is finished.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2005-10-04T20:05:54.000+0000","updated":"2005-10-04T20:05:54.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12332572","id":"12332572","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"body":"Committed by revision 325896","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=oysteing","name":"oysteing","emailAddress":"oystein dot grovlen at sun dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Øystein Grøvlen","active":true},"created":"2005-10-20T21:30:30.000+0000","updated":"2005-10-20T21:30:30.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12332576","id":"12332576","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"I realize it is a bit late to ask this question now that the bug is closed, but is this fix appropriate to port to 10.1 for 10.1.2?\r\nIt seems like something that would be great to have fixed for the release.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2005-10-20T22:01:38.000+0000","updated":"2005-10-20T22:01:38.000+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12314126/comment/12678371","id":"12678371","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"body":"reopening to backport to 10.1. I need the read only boot message there and it will be good to have this fixed in 10.1 anyway.\r\n\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=kmarsden","name":"kmarsden","emailAddress":"kmarsdenderby at sbcglobal dot net","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Kathey Marsden","active":true},"created":"2009-03-03T17:41:28.481+0000","updated":"2009-03-03T17:41:28.481+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/DERBY-555/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i06fsv:"}}