{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12559432","self":"https://issues.apache.org/jira/rest/api/latest/issue/12559432","key":"LUCENE-4114","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310110","id":"12310110","key":"LUCENE","name":"Lucene - Core","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310110&avatarId=10061","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310110&avatarId=10061","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310110&avatarId=10061","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310110&avatarId=10061"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10150","id":"10150","description":"Lucene-related projects","name":"Lucene"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314025","id":"12314025","description":"Alpha release of the 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321663","id":"12321663","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2012-06-05 22:06:39.09","customfield_12312323":null,"customfield_12310420":"243851","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_78420598_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2012-06-06T17:00:36.664+0000","workratio":0,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-4114/watchers","watchCount":6,"isWatching":false},"created":"2012-06-05T19:13:36.166+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":7200,"aggregatetimeoriginalestimate":7200,"customfield_12312330":null,"customfield_12311120":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314025","id":"12314025","description":"Alpha release of the 4.x series","name":"4.0-ALPHA","archived":false,"released":true,"releaseDate":"2012-07-03"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12321663","id":"12321663","description":"Current trunk","name":"Trunk","archived":false,"released":false}],"issuelinks":[],"customfield_12312339":null,"assignee":null,"customfield_12312337":null,"customfield_12312338":null,"updated":"2013-05-10T10:39:39.456+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12314074","id":"12314074","name":"core/codecs","description":"issues with Codecs code"}],"timeoriginalestimate":7200,"description":"My test case has run across an arithmetic bug in FixedStraightBytesImpl - specifically in the @Override on position(int). The combination of size=32 and docID = 70M produces a negative integer and causes a stacktrace in MMapDirectory.seek(long) which I will post below.  I would imagine that this hasn't been hit before because most index shards have less than 70M documents.\r\n\r\nThat is to say, when asking for the docvalue in a FixedStraightBytes field where the size of values are 32 and the docID can be sufficiently high, an arithmetic overflow occurs in line 359 of FixedStraightBytesImpl.java, causing the method to return a negative value when operating on the first (0th) shard with a baseOffset of 0.  This produces an IllegalArgumentException:\r\n\r\nCaused by: java.lang.IllegalArgumentException: Seeking to negative position: MMapIndexInput(_7_5_dv.dat in path=\"/.../_7_dv.cfs\" slice=5:2562955684)\r\n        at org.apache.lucene.store.MMapDirectory$MMapIndexInput.seek(MMapDirectory.java:396)\r\n        at org.apache.lucene.codecs.lucene40.values.FixedStraightBytesImpl$DirectFixedStraightSource.position(FixedStraightBytesImpl.java:359)\r\n        at org.apache.lucene.codecs.lucene40.values.DirectSource.getBytes(DirectSource.java:60)\r\n        at org.apache.lucene.codecs.lucene40.values.FixedStraightBytesImpl$DirectFixedStraightSource.getBytes(FixedStraightBytesImpl.java:349)\r\n        ...","customfield_10010":null,"timetracking":{"originalEstimate":"2h","remainingEstimate":"2h","originalEstimateSeconds":7200,"remainingEstimateSeconds":7200},"customfield_12310120":[{"self":"https://issues.apache.org/jira/rest/api/2/customFieldOption/10121","value":"New","id":"10121"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":7200,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"23905","summary":"Large docID / docvalue size combination produces arithmetic overflow","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waldoppper","name":"waldoppper","emailAddress":"waldoppper at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walt Elder","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waldoppper","name":"waldoppper","emailAddress":"waldoppper at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walt Elder","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":7200,"percent":0},"customfield_12311024":null,"environment":"Ubuntu 10.04\r\nSun Java 6 b26\r\nMultiIndex over six directoryindices with ~80M documents each.","customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":7200,"percent":0},"comment":{"startAt":0,"maxResults":7,"total":7,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559432/comment/13289751","id":"13289751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waldoppper","name":"waldoppper","emailAddress":"waldoppper at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walt Elder","active":true},"body":"Followup: I built my own version of lucene-core with this line corrected (I cast docID to long) and ran my tests successfully.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waldoppper","name":"waldoppper","emailAddress":"waldoppper at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walt Elder","active":true},"created":"2012-06-05T21:40:18.693+0000","updated":"2012-06-05T21:40:18.693+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559432/comment/13289772","id":"13289772","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkrupan","name":"jkrupan","emailAddress":"jack dot krupansky at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkrupan&avatarId=22774","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkrupan&avatarId=22774","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkrupan&avatarId=22774","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkrupan&avatarId=22774"},"displayName":"Jack Krupansky","active":true},"body":"There may be a similar bug at line 345:\r\n\r\n      return data.fillSlice(bytesRef, docID * size, size);\r\n\r\nAnd at line 340 in Lucene40StoredFieldsReader:\r\n\r\nindexStream.seek(HEADER_LENGTH_IDX + docID * 8L);\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkrupan","name":"jkrupan","emailAddress":"jack dot krupansky at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkrupan&avatarId=22774","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkrupan&avatarId=22774","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkrupan&avatarId=22774","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkrupan&avatarId=22774"},"displayName":"Jack Krupansky","active":true},"created":"2012-06-05T22:06:39.090+0000","updated":"2012-06-05T22:06:39.090+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559432/comment/13289775","id":"13289775","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkrupan","name":"jkrupan","emailAddress":"jack dot krupansky at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkrupan&avatarId=22774","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkrupan&avatarId=22774","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkrupan&avatarId=22774","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkrupan&avatarId=22774"},"displayName":"Jack Krupansky","active":true},"body":"Sorry, the latter case is probably okay due to the \"L\" on \"8L\". BUt the former case is just int * int.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jkrupan","name":"jkrupan","emailAddress":"jack dot krupansky at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=jkrupan&avatarId=22774","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jkrupan&avatarId=22774","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jkrupan&avatarId=22774","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jkrupan&avatarId=22774"},"displayName":"Jack Krupansky","active":true},"created":"2012-06-05T22:09:45.908+0000","updated":"2012-06-05T22:09:45.908+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559432/comment/13289827","id":"13289827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Thanks Walt, nice find!\r\n\r\nI attached patch w/ 3 places that could overflow ... can anyone find any others in the DocValues sources...?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2012-06-05T23:00:19.656+0000","updated":"2012-06-05T23:00:19.656+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559432/comment/13290268","id":"13290268","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"body":"Thanks Walt!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mikemccand","name":"mikemccand","emailAddress":"lucene at mikemccandless dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Michael McCandless","active":true},"created":"2012-06-06T17:00:36.741+0000","updated":"2012-06-06T17:00:36.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559432/comment/13290293","id":"13290293","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waldoppper","name":"waldoppper","emailAddress":"waldoppper at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walt Elder","active":true},"body":"Awesome. Thanks all.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=waldoppper","name":"waldoppper","emailAddress":"waldoppper at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Walt Elder","active":true},"created":"2012-06-06T17:44:25.203+0000","updated":"2012-06-06T17:44:25.203+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12559432/comment/13290878","id":"13290878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=simonw","name":"simonw","emailAddress":"simonw at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Willnauer","active":true},"body":"thanks mike!","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=simonw","name":"simonw","emailAddress":"simonw at apache dot org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Simon Willnauer","active":true},"created":"2012-06-07T08:09:23.593+0000","updated":"2012-06-07T08:09:23.593+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/LUCENE-4114/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i04gan:"}}