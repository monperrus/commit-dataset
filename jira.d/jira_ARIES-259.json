{"expand":"renderedFields,names,schema,transitions,operations,editmeta,changelog","id":"12459569","self":"https://issues.apache.org/jira/rest/api/latest/issue/12459569","key":"ARIES-259","fields":{"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false},"timespent":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12310981","id":"12310981","key":"ARIES","name":"Aries","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12310981&avatarId=10065","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12310981&avatarId=10065","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12310981&avatarId=10065","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12310981&avatarId=10065"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/10520","id":"10520","description":"Apache Aries","name":"Aries"}},"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12314792","id":"12314792","description":"","name":"0.1","archived":true,"released":true,"releaseDate":"2010-05-13"}],"aggregatetimespent":null,"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12310220":"2010-03-18 21:43:27.374","customfield_12312323":null,"customfield_12310420":"93872","customfield_12312320":null,"customfield_12310222":"1_*:*_1_*:*_1040727305_*|*_5_*:*_1_*:*_0","customfield_12312321":null,"customfield_12312120":null,"customfield_12312121":null,"resolutiondate":"2010-03-30T21:50:22.626+0000","workratio":-1,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312325":null,"lastViewed":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-259/watchers","watchCount":0,"isWatching":false},"created":"2010-03-18T20:44:55.321+0000","priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12310310":"1.0","customfield_12312331":null,"customfield_12312332":null,"timeestimate":null,"aggregatetimeoriginalestimate":null,"customfield_12312330":null,"customfield_12311120":null,"versions":[],"issuelinks":[{"id":"12330856","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12330856","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12459673","key":"ARIES-260","self":"https://issues.apache.org/jira/rest/api/2/issue/12459673","fields":{"summary":"Reconsider synchronous MBean registration/unregistration","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/1","description":"The issue is open and ready for the assignee to start work on it.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/open.png","name":"Open","id":"1","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/2","id":2,"key":"new","colorName":"blue-gray","name":"New"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.png","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/images/icons/issuetypes/bug.png","name":"Bug","subtask":false}}}}],"customfield_12312339":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamwojtuniak","name":"adamwojtuniak","emailAddress":"adamwojtuniak at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Wojtuniak","active":true},"customfield_12312337":null,"customfield_12312338":null,"updated":"2010-03-30T21:50:22.607+0000","customfield_12312335":null,"customfield_12312336":null,"customfield_12311720":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Complete"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12313100","id":"12313100","name":"JMX"}],"timeoriginalestimate":null,"description":"Closing the MBeanServiceTracker asyncronously triggers JMXAgent.unregisterBeans(MBeanServer server)\r\n\r\nIf there is a unexpected exception while unregistering an MBeanHandler the ones coming after it will not get unregitered.\r\nIn particular I am seeing an unguarded postDeregister hook.\r\n\r\nCaused by: java.lang.IllegalStateException: Invalid BundleContext.\r\n\tat org.apache.felix.framework.BundleContextImpl.checkValidity(BundleContextImpl.java:393)\r\n\tat org.apache.felix.framework.BundleContextImpl.removeBundleListener(BundleContextImpl.java:170)\r\n\tat org.apache.aries.jmx.framework.BundleState.shutDownDispatcher(BundleState.java:353)\r\n\tat org.apache.aries.jmx.framework.BundleState.postDeregister(BundleState.java:293)\r\n\tat org.apache.aries.jmx.framework.RegistrableStandardEmitterMBean.postDeregister(RegistrableStandardEmitterMBean.java:69)\r\n\tat com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.postDeregisterInvoke(DefaultMBeanServerInterceptor.java:1065)\r\n","customfield_10010":null,"timetracking":{},"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"customfield_12312340":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12310921":null,"customfield_12310920":"167504","summary":"MBeans not getting unregistered reliably","creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdiesler","name":"tdiesler","emailAddress":"thomas dot diesler at jboss dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tdiesler&avatarId=21780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tdiesler&avatarId=21780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tdiesler&avatarId=21780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tdiesler&avatarId=21780"},"displayName":"Thomas Diesler","active":true},"subtasks":[],"customfield_12310291":null,"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdiesler","name":"tdiesler","emailAddress":"thomas dot diesler at jboss dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tdiesler&avatarId=21780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tdiesler&avatarId=21780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tdiesler&avatarId=21780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tdiesler&avatarId=21780"},"displayName":"Thomas Diesler","active":true},"customfield_12310290":null,"aggregateprogress":{"progress":0,"total":0},"customfield_12311024":null,"environment":null,"customfield_12311020":null,"duedate":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"comment":{"startAt":0,"maxResults":4,"total":4,"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459569/comment/12847125","id":"12847125","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamwojtuniak","name":"adamwojtuniak","emailAddress":"adamwojtuniak at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Wojtuniak","active":true},"body":"BundleState.shutDownDispatcher is missing a check for bundleContext validity.\r\nBundleContext could be no valid cause of asynchronous unregistration of MBeans.\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamwojtuniak","name":"adamwojtuniak","emailAddress":"adamwojtuniak at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Wojtuniak","active":true},"created":"2010-03-18T21:43:27.374+0000","updated":"2010-03-18T21:43:27.374+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459569/comment/12847136","id":"12847136","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdiesler","name":"tdiesler","emailAddress":"thomas dot diesler at jboss dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tdiesler&avatarId=21780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tdiesler&avatarId=21780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tdiesler&avatarId=21780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tdiesler&avatarId=21780"},"displayName":"Thomas Diesler","active":true},"body":"patch attached","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdiesler","name":"tdiesler","emailAddress":"thomas dot diesler at jboss dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tdiesler&avatarId=21780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tdiesler&avatarId=21780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tdiesler&avatarId=21780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tdiesler&avatarId=21780"},"displayName":"Thomas Diesler","active":true},"created":"2010-03-18T22:29:41.979+0000","updated":"2010-03-18T22:29:41.979+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459569/comment/12847152","id":"12847152","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdiesler","name":"tdiesler","emailAddress":"thomas dot diesler at jboss dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tdiesler&avatarId=21780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tdiesler&avatarId=21780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tdiesler&avatarId=21780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tdiesler&avatarId=21780"},"displayName":"Thomas Diesler","active":true},"body":"This also pertains to ServiceState and generally to any uncought Exception in the JMXAgent.unregisterBeans(MBeanServer server) loop.\r\n\r\nBTW, why is the MBean register/unregister work been done asynchronously. this makes my remote osgi testsuite that delegates to JMX much more complicated.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=tdiesler","name":"tdiesler","emailAddress":"thomas dot diesler at jboss dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=tdiesler&avatarId=21780","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tdiesler&avatarId=21780","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tdiesler&avatarId=21780","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tdiesler&avatarId=21780"},"displayName":"Thomas Diesler","active":true},"created":"2010-03-18T22:49:10.981+0000","updated":"2010-03-18T22:49:10.981+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12459569/comment/12851623","id":"12851623","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamwojtuniak","name":"adamwojtuniak","emailAddress":"adamwojtuniak at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Wojtuniak","active":true},"body":"patch submitted.\r\n\r\nAnswer to your question:\r\nWe decided to use SingleThreadExecutor for better management of MBeans lifecycle. Except framework services the rest is dynamic and\r\nof course MBeanServer which is also registered as a service (for compendium services and MBean server we are using serviceTracker.). \r\nWe are not treating MBeanServer as a static service. So we can't assume that MBean will be registered after jmx bundle is started. \r\nSingleThreadExecutor perfectly fit in that situation cause we can guarantee sequential order of  MBeans registration and unregistration.   \r\n\r\nthanks,\r\nAdam\r\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=adamwojtuniak","name":"adamwojtuniak","emailAddress":"adamwojtuniak at gmail dot com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Adam Wojtuniak","active":true},"created":"2010-03-30T21:50:05.134+0000","updated":"2010-03-30T21:50:05.134+0000"}]},"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/ARIES-259/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12311820":"0|i0t17b:"}}